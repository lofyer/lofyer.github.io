{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Lofyer's Docs \u8bf4\u660e \u8fd9\u4e2a\u7ad9\u70b9\u662f\u6211\u5199\u4e00\u4e9b\u957f\u6587\u6216\u8005\u7cfb\u5217\u6587\u65f6\u5019\u7528\u7684\uff0c\u91cc\u9762\u7684\u5185\u5bb9\u6bd4\u8f83\u968f\u610f\u3002 \u53e6\u5916\uff0c\u968f\u7740\u6211\u5e74\u9f84\u7684\u589e\u957f\uff0c\u77e5\u8bc6\u4e0d\u65ad\u66f4\u65b0\uff0c\u4e4b\u524d\u5199\u7684\u53ef\u80fd\u4e5f\u662f\u9519\u7684\uff0c\u6bd5\u7adf\u6210\u957f\u5c31\u662f\u5426\u5b9a\u81ea\u5df1\u7684\u8fc7\u7a0b\u3002 \u535a\u5ba2\u5730\u5740 lofyer.org \u3002 \u6587\u6863\u5730\u5740 docs.lofyer.org \u3002 \u5f53\u524d\u5185\u5bb9 DataNote \u5b66\u4e60\u4ee3\u7406\u4eba\u5efa\u6a21\u65f6\u7684\u7b14\u8bb0\u5427\uff0c\u7efc\u5408\u4e86\u5f88\u591a\u671f\u95f4\u5e94\u7528\u7684\u522b\u7684\u4e71\u4e03\u516b\u7cdf\u7684\u77e5\u8bc6\uff0c\u6bd4\u5982\u5916\u6c47\u3001\u673a\u5668\u5b66\u4e60\u7b49\u3002 InTheCloud 2012\u5e74\u521a\u5165\u884c\u52302017\u5e74\u95f4\u5b66\u4e60\u7684\u7b14\u8bb0\uff0c\u5df2\u7ecf\u6210\u4e66\u4e86\uff0c\u300aKVM\u79c1\u6709\u4e91\u67b6\u6784\u4e0e\u5b9e\u8df5\u300b\u3002","title":"Home"},{"location":"#lofyers-docs","text":"\u8bf4\u660e \u8fd9\u4e2a\u7ad9\u70b9\u662f\u6211\u5199\u4e00\u4e9b\u957f\u6587\u6216\u8005\u7cfb\u5217\u6587\u65f6\u5019\u7528\u7684\uff0c\u91cc\u9762\u7684\u5185\u5bb9\u6bd4\u8f83\u968f\u610f\u3002 \u53e6\u5916\uff0c\u968f\u7740\u6211\u5e74\u9f84\u7684\u589e\u957f\uff0c\u77e5\u8bc6\u4e0d\u65ad\u66f4\u65b0\uff0c\u4e4b\u524d\u5199\u7684\u53ef\u80fd\u4e5f\u662f\u9519\u7684\uff0c\u6bd5\u7adf\u6210\u957f\u5c31\u662f\u5426\u5b9a\u81ea\u5df1\u7684\u8fc7\u7a0b\u3002 \u535a\u5ba2\u5730\u5740 lofyer.org \u3002 \u6587\u6863\u5730\u5740 docs.lofyer.org \u3002","title":"Lofyer's Docs"},{"location":"#_1","text":"DataNote \u5b66\u4e60\u4ee3\u7406\u4eba\u5efa\u6a21\u65f6\u7684\u7b14\u8bb0\u5427\uff0c\u7efc\u5408\u4e86\u5f88\u591a\u671f\u95f4\u5e94\u7528\u7684\u522b\u7684\u4e71\u4e03\u516b\u7cdf\u7684\u77e5\u8bc6\uff0c\u6bd4\u5982\u5916\u6c47\u3001\u673a\u5668\u5b66\u4e60\u7b49\u3002 InTheCloud 2012\u5e74\u521a\u5165\u884c\u52302017\u5e74\u95f4\u5b66\u4e60\u7684\u7b14\u8bb0\uff0c\u5df2\u7ecf\u6210\u4e66\u4e86\uff0c\u300aKVM\u79c1\u6709\u4e91\u67b6\u6784\u4e0e\u5b9e\u8df5\u300b\u3002","title":"\u5f53\u524d\u5185\u5bb9"},{"location":"datanote/","text":"\u4ee3\u7406\u4eba\u6a21\u578b\u7b14\u8bb0 - ABM\u5728\u73b0\u4ee3\u7ecf\u6d4e\u7684\u5e94\u7528\u66a8\u5916\u6c47\u91cf\u5316\u3001\u65b0\u95fb\u653f\u53f2\u4ea4\u6613\u5b9e\u8df5 \u8fd9\u4e2a\u7b14\u8bb0\u7684\u662f\u7b14\u8005\u7684\u5b66\u4e60\u624b\u8bb0\uff0c\u5185\u5bb9\u5305\u62ec\u7edf\u8ba1\u3001\u5efa\u6a21\uff08EBM\u3001ABM\uff09\u3001\u6570\u636e\u5904\u7406\u5e73\u53f0\u3001\u5916\u6c47\u4fe1\u53f7\u7cfb\u7edf\u3001\u91cf\u5316\u4ea4\u6613\u3001\u673a\u5668\u4eba\u5236\u4f5c\u7b49\u5185\u5bb9\uff0c\u8f83\u4e3a\u7e41\u6742\u3002\u8bfb\u8005\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u914c\u60c5\u9605\u8bfb\u3002\uff08\u610f\u601d\u5c31\u662f\u4f60\u901a\u8bfb\u4e86\u8fd9\u672c\u4e66\u5e76\u4e0d\u4f1a\u5bf9\u4f60\u4ea7\u751f\u592a\u5927\u5f71\u54cd\uff0c\u4f46\u662f\u5982\u679c\u80fd\u6539\u53d8\u4f60\u7684\u4e00\u70b9\u70b9\u601d\u60f3\uff0c\u90a3\u5c31\u662f\u597d\u7684\u3002) \u7b14\u8005\u7684\u7cfb\u7edf\u7406\u8bba\u6765\u4e3b\u8981\u81ea\u4e8e\u81ea\u63a7\u7406\u8bba\uff0c\u5efa\u6a21\u6280\u80fd\u504f\u5411\u4e8eABM\u5efa\u6a21\uff0c\u7136\u540e\u662f\u6570\u5b66\u5efa\u6a21\uff0c\u6700\u540e\u7684\u5e94\u7528\u70b9\uff0c\u4e5f\u5c31\u662f\u672c\u6587\u7684\u8ba1\u7b97\u673a\u4e0e\u4ea4\u6613\u7cfb\u7edf\u3002 \u968f\u7740\u5b66\u4e60\u7684\u6df1\u5165\uff0c\u7b2c\u4e8c\u7ae0\u5185\u5bb9\u9700\u8981\u8fdb\u4e00\u6b65\u6269\u5c55\uff0c\u56e0\u800cagent\u672c\u8eab\u5df2\u7ecf\u4e0d\u591f\uff0c\u9700\u8981\u66f4\u5f3a\u7684\u80fd\u529b\u3002 \u5176\u4e2d\u4f1a\u7275\u6d89\u5230\u5f88\u591a\u65f6\u4e0b\u7684\u70ed\u70b9\uff0c\u6bd4\u5982\u5927\u6570\u636e\u3001\u4e91\u8ba1\u7b97\u3001\u5de5\u4e1a4.0\u3001\u7269\u8054\u7f51\u7b49\uff0c\u8ba1\u7b97\u673a\u5de5\u5177\u5728\u91cf\u5316\u6295\u8d44\u4e2d\u5176\u5b9e\u65e9\u5df2\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5c24\u5176\u8d85\u7b97\u3001\u673a\u5668\u5b66\u4e60\u3001\u9ad8\u901f\u7f51\u7edc\u7b49\u5c16\u7aef\u6280\u672f\u3002\u55ef\uff0c\u53eb\u6cd5\u800c\u5df2\uff0c\u5b83\u4eec\u7ec6\u5316\u5230\u4ea7\u54c1\u5e76\u843d\u5730\u5230\u5e02\u573a\u4e0a\u540e\u5c31\u662f\u4e2a\u5de5\u5177\u3002\u5f53\u7136\uff0c\u5bf9\u8fd9\u4e9b\u5de5\u5177\u7684\u4e13\u4e1a\u638c\u63e1\u7a0b\u5ea6\u51b3\u5b9a\u7740\u4ea7\u54c1\u7684\u8d28\u91cf\uff0c\u4f46\u5c31\u672c\u6587\u800c\u8a00\uff0c\u77e5\u5176\u7136\u4e0e\u6240\u4ee5\u7136\u5373\u53ef\uff0c\u65e0\u9700\u6df1\u7a76\uff0c\u9664\u975e\u9047\u5230\u74f6\u9888\uff08\u53d1\u52a8\u673a\u5236\u9020\u5546\u53ea\u8981\u77e5\u9053\u9009\u7528\u5e76\u91c7\u8d2d\u4ec0\u4e48\u6837\u7684\u9600\u95e8\u3001\u63a7\u5236\u5668\u7b49\u6750\u6599\u7ec4\u4ef6\u5c31\u884c\u4e86\uff0c\u4e0d\u9700\u8981\u6bcf\u4e00\u6837\u4e1c\u897f\u90fd\u81ea\u5df1\u751f\u4ea7\uff09\u3002 \u6700\u7ec8\uff0c\u8fd9\u4e9b\u6240\u6709\u4e1c\u897f\u90fd\u53ef\u4ee5\u4ee5\u670d\u52a1\u5f62\u5f0f\u5305\u88c5\u63d0\u4f9b\u7ed9\u7528\u6237\uff0c\u4ece\u800c\u5f62\u6210XX\u4e91\uff0c\u6bd4\u5982\u8fd9\u4e2a\u5e73\u53f0\u6700\u7ec8\u5f62\u6210\u7684\u4ee3\u7406\u4eba\u5efa\u6a21\u4e91\u3002\u3002\uff08\u4e0d\u597d\u542c\uff09 \u603b\u5171\u5206\u4e3a\u4e09\u4e2a\u90e8\u5206\uff0c\u7b2c\u4e00\u4e2a\u90e8\u5206\u662f\u57fa\u7840\u77e5\u8bc6\uff0c\u5305\u62ec\u7edf\u8ba1\u3001\u7b97\u6cd5\u3001\u6a21\u578b\u3001\u5de5\u5177\uff1b\u7b2c\u4e8c\u4e2a\u90e8\u5206\u662f\u5916\u6c47\u5b9e\u8df5\uff0c\u5305\u62ec\u57fa\u672c\u5206\u6790\u3001\u6280\u672f\u5206\u6790\u3001\u65b0\u95fb\u5206\u6790\u3001\u8206\u8bba\u5206\u6790\u3001\u4fe1\u53f7\u7cfb\u7edf\u3002 \u6700\u540e\uff0c\u5224\u65ad\u4f60\u77e5\u8bc6\u662f\u5426\u7262\u56fa\u7684\u6807\u51c6\u5c31\u662f\u8fd9\u4e2a\u7cfb\u7edf\u7684\u76c8\u5229\u6210\u957f\uff0c\u591a\u7b80\u5355\uff0c\u591a\u76f4\u63a5\uff0c\u591a\u8d64\u88f8\u3002\u5f53\u7136\uff0c\u4f60\u8d5a\u7684\u5c11\u6709\u65f6\u5e76\u4e0d\u662f\u4f60\u77e5\u8bc6\u771f\u7684\u4e0d\u7262\u56fa\uff0c\u800c\u662f\u4f60\u7684\u6a21\u578b\u4ecd\u9700\u4f18\u5316\u3002 \u8fd9\u4e9b\u77e5\u8bc6\u53ef\u80fd\u8d70\u4e86\u5f88\u591a\u5f2f\u8def\uff0c\u4f46\uff0c\u6e38\u620f\u672c\u8eab\u5c31\u662f\u7528\u6765\u63a2\u7d22\u7684\uff0c\u51af\u00b7\u8bfa\u4f0a\u66fc\u8fd8\u7528\u65e0\u7a77\u7ea7\u6570\u7b97\u82cd\u8747\u98de\u591a\u8fdc\u5462\u3002\u8fd8\u6709\u5c31\u662f\u73b0\u884c\u7684\u6e38\u620f\u7406\u8bba\u5728\u5f3a\u52b2\u7684\u8ba1\u7b97\u80fd\u529b\u9762\u524d\u663e\u5f97\u4e0d\u90a3\u4e48\u5408\u9002\uff0c\u6bd4\u5982\u4ed6\u4eec\u4ee5\u56fd\u9645\u8c61\u68cb\u4e3e\u4f8b\u65f6\uff0c\u80af\u5b9a\u4e0d\u77e5\u9053\u73b0\u5728\u8ba1\u7b97\u673a\u62e5\u6709\u51e0\u4e4e\u5168\u90e8\u68cb\u8c31\u4e0e\u7b56\u7565\uff0c\u4eba\u7c7b\u5c31\u8fd9\u70b9\u6218\u80dc\u8ba1\u7b97\u673a\u5f02\u5e38\u56f0\u96be\uff0c\u8fd9\u4e5f\u53ef\u80fd\u4e5f\u9002\u7528\u4e8e\u6b63\u5728\u6d41\u884c\u7684\u56f4\u68cb\u3002 \u4e0e\u8fd9\u4e2a\u7b14\u8bb0\u5bf9\u5e94\u7684\u7f51\u7ad9\u662fhttps://forex.fusionworks.cn\uff0c\u91cc\u9762\u6709\u4e00\u4e9b\u4e2a\u4eba\u4ea4\u6613\u8d44\u6599\u3002 \u54e6\uff0c\u8fd8\u6709\u4e2a\u516c\u4f17\u53f7\uff0cvola\uff01 \u968f\u624b\u8bb0 UPDATE 2020-07 \u597d\u4e45\u6ca1\u66f4\u65b0\u4e86 ```{image} ./images/logo.jpg :align: center 1 2 3 \u8fd9\u91cc\u662f\u4e3b\u67b6\u6784\u56fe\u3002 ```{image} ./images/infra-1.png 1 2 3 4 5 6 7 8 9 10 :maxdepth: 2 posts/ch01.rst posts/ch02.rst posts/ch03.rst posts/ch04.rst posts/ch05.rst posts/ch06.rst posts/ch07.rst posts/about.rst TODO: \u5408\u5e765\u30017\u4e24\u7ae0\u3002 \u7b2c4\u7ae0\u8981\u4e0d\u8981\u4e86\uff1f\u8981\u5427\uff0c\u56de\u5934\u7b80\u5316\u4e00\u4e0b\uff0c\u6ce8\u91cd\u641c\u7d22\u5f15\u64ce\u4e0e\u6570\u636e\u964d\u7ef4\u5373\u53ef\u3002 \u7b2c\u4e03\u7ae0\u4ee5\u53ca\u4ee5\u540e\u7684\u5c31\u522b\u770b\u4e86\u3002","title":"Index"},{"location":"datanote/#-abm","text":"\u8fd9\u4e2a\u7b14\u8bb0\u7684\u662f\u7b14\u8005\u7684\u5b66\u4e60\u624b\u8bb0\uff0c\u5185\u5bb9\u5305\u62ec\u7edf\u8ba1\u3001\u5efa\u6a21\uff08EBM\u3001ABM\uff09\u3001\u6570\u636e\u5904\u7406\u5e73\u53f0\u3001\u5916\u6c47\u4fe1\u53f7\u7cfb\u7edf\u3001\u91cf\u5316\u4ea4\u6613\u3001\u673a\u5668\u4eba\u5236\u4f5c\u7b49\u5185\u5bb9\uff0c\u8f83\u4e3a\u7e41\u6742\u3002\u8bfb\u8005\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u914c\u60c5\u9605\u8bfb\u3002\uff08\u610f\u601d\u5c31\u662f\u4f60\u901a\u8bfb\u4e86\u8fd9\u672c\u4e66\u5e76\u4e0d\u4f1a\u5bf9\u4f60\u4ea7\u751f\u592a\u5927\u5f71\u54cd\uff0c\u4f46\u662f\u5982\u679c\u80fd\u6539\u53d8\u4f60\u7684\u4e00\u70b9\u70b9\u601d\u60f3\uff0c\u90a3\u5c31\u662f\u597d\u7684\u3002) \u7b14\u8005\u7684\u7cfb\u7edf\u7406\u8bba\u6765\u4e3b\u8981\u81ea\u4e8e\u81ea\u63a7\u7406\u8bba\uff0c\u5efa\u6a21\u6280\u80fd\u504f\u5411\u4e8eABM\u5efa\u6a21\uff0c\u7136\u540e\u662f\u6570\u5b66\u5efa\u6a21\uff0c\u6700\u540e\u7684\u5e94\u7528\u70b9\uff0c\u4e5f\u5c31\u662f\u672c\u6587\u7684\u8ba1\u7b97\u673a\u4e0e\u4ea4\u6613\u7cfb\u7edf\u3002 \u968f\u7740\u5b66\u4e60\u7684\u6df1\u5165\uff0c\u7b2c\u4e8c\u7ae0\u5185\u5bb9\u9700\u8981\u8fdb\u4e00\u6b65\u6269\u5c55\uff0c\u56e0\u800cagent\u672c\u8eab\u5df2\u7ecf\u4e0d\u591f\uff0c\u9700\u8981\u66f4\u5f3a\u7684\u80fd\u529b\u3002 \u5176\u4e2d\u4f1a\u7275\u6d89\u5230\u5f88\u591a\u65f6\u4e0b\u7684\u70ed\u70b9\uff0c\u6bd4\u5982\u5927\u6570\u636e\u3001\u4e91\u8ba1\u7b97\u3001\u5de5\u4e1a4.0\u3001\u7269\u8054\u7f51\u7b49\uff0c\u8ba1\u7b97\u673a\u5de5\u5177\u5728\u91cf\u5316\u6295\u8d44\u4e2d\u5176\u5b9e\u65e9\u5df2\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5c24\u5176\u8d85\u7b97\u3001\u673a\u5668\u5b66\u4e60\u3001\u9ad8\u901f\u7f51\u7edc\u7b49\u5c16\u7aef\u6280\u672f\u3002\u55ef\uff0c\u53eb\u6cd5\u800c\u5df2\uff0c\u5b83\u4eec\u7ec6\u5316\u5230\u4ea7\u54c1\u5e76\u843d\u5730\u5230\u5e02\u573a\u4e0a\u540e\u5c31\u662f\u4e2a\u5de5\u5177\u3002\u5f53\u7136\uff0c\u5bf9\u8fd9\u4e9b\u5de5\u5177\u7684\u4e13\u4e1a\u638c\u63e1\u7a0b\u5ea6\u51b3\u5b9a\u7740\u4ea7\u54c1\u7684\u8d28\u91cf\uff0c\u4f46\u5c31\u672c\u6587\u800c\u8a00\uff0c\u77e5\u5176\u7136\u4e0e\u6240\u4ee5\u7136\u5373\u53ef\uff0c\u65e0\u9700\u6df1\u7a76\uff0c\u9664\u975e\u9047\u5230\u74f6\u9888\uff08\u53d1\u52a8\u673a\u5236\u9020\u5546\u53ea\u8981\u77e5\u9053\u9009\u7528\u5e76\u91c7\u8d2d\u4ec0\u4e48\u6837\u7684\u9600\u95e8\u3001\u63a7\u5236\u5668\u7b49\u6750\u6599\u7ec4\u4ef6\u5c31\u884c\u4e86\uff0c\u4e0d\u9700\u8981\u6bcf\u4e00\u6837\u4e1c\u897f\u90fd\u81ea\u5df1\u751f\u4ea7\uff09\u3002 \u6700\u7ec8\uff0c\u8fd9\u4e9b\u6240\u6709\u4e1c\u897f\u90fd\u53ef\u4ee5\u4ee5\u670d\u52a1\u5f62\u5f0f\u5305\u88c5\u63d0\u4f9b\u7ed9\u7528\u6237\uff0c\u4ece\u800c\u5f62\u6210XX\u4e91\uff0c\u6bd4\u5982\u8fd9\u4e2a\u5e73\u53f0\u6700\u7ec8\u5f62\u6210\u7684\u4ee3\u7406\u4eba\u5efa\u6a21\u4e91\u3002\u3002\uff08\u4e0d\u597d\u542c\uff09 \u603b\u5171\u5206\u4e3a\u4e09\u4e2a\u90e8\u5206\uff0c\u7b2c\u4e00\u4e2a\u90e8\u5206\u662f\u57fa\u7840\u77e5\u8bc6\uff0c\u5305\u62ec\u7edf\u8ba1\u3001\u7b97\u6cd5\u3001\u6a21\u578b\u3001\u5de5\u5177\uff1b\u7b2c\u4e8c\u4e2a\u90e8\u5206\u662f\u5916\u6c47\u5b9e\u8df5\uff0c\u5305\u62ec\u57fa\u672c\u5206\u6790\u3001\u6280\u672f\u5206\u6790\u3001\u65b0\u95fb\u5206\u6790\u3001\u8206\u8bba\u5206\u6790\u3001\u4fe1\u53f7\u7cfb\u7edf\u3002 \u6700\u540e\uff0c\u5224\u65ad\u4f60\u77e5\u8bc6\u662f\u5426\u7262\u56fa\u7684\u6807\u51c6\u5c31\u662f\u8fd9\u4e2a\u7cfb\u7edf\u7684\u76c8\u5229\u6210\u957f\uff0c\u591a\u7b80\u5355\uff0c\u591a\u76f4\u63a5\uff0c\u591a\u8d64\u88f8\u3002\u5f53\u7136\uff0c\u4f60\u8d5a\u7684\u5c11\u6709\u65f6\u5e76\u4e0d\u662f\u4f60\u77e5\u8bc6\u771f\u7684\u4e0d\u7262\u56fa\uff0c\u800c\u662f\u4f60\u7684\u6a21\u578b\u4ecd\u9700\u4f18\u5316\u3002 \u8fd9\u4e9b\u77e5\u8bc6\u53ef\u80fd\u8d70\u4e86\u5f88\u591a\u5f2f\u8def\uff0c\u4f46\uff0c\u6e38\u620f\u672c\u8eab\u5c31\u662f\u7528\u6765\u63a2\u7d22\u7684\uff0c\u51af\u00b7\u8bfa\u4f0a\u66fc\u8fd8\u7528\u65e0\u7a77\u7ea7\u6570\u7b97\u82cd\u8747\u98de\u591a\u8fdc\u5462\u3002\u8fd8\u6709\u5c31\u662f\u73b0\u884c\u7684\u6e38\u620f\u7406\u8bba\u5728\u5f3a\u52b2\u7684\u8ba1\u7b97\u80fd\u529b\u9762\u524d\u663e\u5f97\u4e0d\u90a3\u4e48\u5408\u9002\uff0c\u6bd4\u5982\u4ed6\u4eec\u4ee5\u56fd\u9645\u8c61\u68cb\u4e3e\u4f8b\u65f6\uff0c\u80af\u5b9a\u4e0d\u77e5\u9053\u73b0\u5728\u8ba1\u7b97\u673a\u62e5\u6709\u51e0\u4e4e\u5168\u90e8\u68cb\u8c31\u4e0e\u7b56\u7565\uff0c\u4eba\u7c7b\u5c31\u8fd9\u70b9\u6218\u80dc\u8ba1\u7b97\u673a\u5f02\u5e38\u56f0\u96be\uff0c\u8fd9\u4e5f\u53ef\u80fd\u4e5f\u9002\u7528\u4e8e\u6b63\u5728\u6d41\u884c\u7684\u56f4\u68cb\u3002 \u4e0e\u8fd9\u4e2a\u7b14\u8bb0\u5bf9\u5e94\u7684\u7f51\u7ad9\u662fhttps://forex.fusionworks.cn\uff0c\u91cc\u9762\u6709\u4e00\u4e9b\u4e2a\u4eba\u4ea4\u6613\u8d44\u6599\u3002 \u54e6\uff0c\u8fd8\u6709\u4e2a\u516c\u4f17\u53f7\uff0cvola\uff01 \u968f\u624b\u8bb0 UPDATE 2020-07 \u597d\u4e45\u6ca1\u66f4\u65b0\u4e86 ```{image} ./images/logo.jpg :align: center 1 2 3 \u8fd9\u91cc\u662f\u4e3b\u67b6\u6784\u56fe\u3002 ```{image} ./images/infra-1.png 1 2 3 4 5 6 7 8 9 10 :maxdepth: 2 posts/ch01.rst posts/ch02.rst posts/ch03.rst posts/ch04.rst posts/ch05.rst posts/ch06.rst posts/ch07.rst posts/about.rst TODO: \u5408\u5e765\u30017\u4e24\u7ae0\u3002 \u7b2c4\u7ae0\u8981\u4e0d\u8981\u4e86\uff1f\u8981\u5427\uff0c\u56de\u5934\u7b80\u5316\u4e00\u4e0b\uff0c\u6ce8\u91cd\u641c\u7d22\u5f15\u64ce\u4e0e\u6570\u636e\u964d\u7ef4\u5373\u53ef\u3002 \u7b2c\u4e03\u7ae0\u4ee5\u53ca\u4ee5\u540e\u7684\u5c31\u522b\u770b\u4e86\u3002","title":"\u4ee3\u7406\u4eba\u6a21\u578b\u7b14\u8bb0 - ABM\u5728\u73b0\u4ee3\u7ecf\u6d4e\u7684\u5e94\u7528\u66a8\u5916\u6c47\u91cf\u5316\u3001\u65b0\u95fb\u653f\u53f2\u4ea4\u6613\u5b9e\u8df5"},{"location":"datanote/about/","text":"\u5173\u4e8e Author: \u732a\u5927\u58ee Wechat: lofyer_org \u5728\u7ebf\u9605\u8bfb ReadTheDocs: https://datanote.readthedocs.io/zh/latest/ ```{raw} html InTheCloud is licensed under a Creative Commons Attribution 4.0 International License . ```","title":"\u5173\u4e8e"},{"location":"datanote/about/#_1","text":"Author: \u732a\u5927\u58ee Wechat: lofyer_org \u5728\u7ebf\u9605\u8bfb ReadTheDocs: https://datanote.readthedocs.io/zh/latest/ ```{raw} html InTheCloud is licensed under a Creative Commons Attribution 4.0 International License . ```","title":"\u5173\u4e8e"},{"location":"datanote/ch01/","text":"\u7b2c\u4e00\u7ae0 \u6570\u636e\u6536\u96c6\u3001\u7edf\u8ba1 \u5728\u5f00\u59cb\u8fd9\u4e00\u7ae0\u4e4b\u524d\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u8865\u4e60\u4e00\u4e0b\u6570\u5b66\u77e5\u8bc6\uff1b\u8fd8\u6709\u719f\u6089\u4e0b\u5e38\u89c1\u5de5\u5177\uff08\u8bed\u8a00\uff09\uff0c\u4e0d\u5fc5\u591a\u5e74\u5f00\u53d1\u7ecf\u9a8c\uff0c\u4f1a\u5904\u7406\u5e38\u89c1\u6570\u636e\u7ed3\u6784\u3001\u80fd\u683c\u5f0f\u5316\u6587\u4ef6\u5373\u53ef\u3002 \u5efa\u8bae\u5148\u901a\u8bfb\u4e00\u4e0b Scrapy \u4e2d\u6587\u6587\u6863 \uff0c\u8fd9\u6837\u4f60\u4f1a\u7701\u53bb\u597d\u591aGoogle\u7684\u65f6\u95f4\uff1b\u5728 \u77e5\u4e4e \u4e0a\u6709\u8bb8\u591a\u5173\u4e8e \u5927\u6570\u636e \u3001 \u6570\u636e\u6316\u6398 \u7684\u8ba8\u8bba\uff0c\u4f60\u53ef\u4ee5\u53bb\u770b\u770b\u4e86\u89e3\u4e00\u4e9b\u4e1a\u5185\u7684\u52a8\u6001\u3002 \u53e6\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528 Nutch \u6765\u722c\u53d6\uff0c\u5e76\u7528 Solr \u6765\u6784\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u641c\u7d22\u5f15\u64ce\uff0c\u5b83\u4eec\u53ef\u4ee5\u8ddf\u4e0b\u4e00\u7ae0\u8282\u7684Hadoop\u96c6\u6210\u3002 \u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u70b9-- Model Thinking \uff0c\u4f60\u9700\u8981\u7684\u4e0d\u53ea\u662f\u5efa\u6a21\u7684\u77e5\u8bc6\uff0c\u8fd8\u8981\u6709\u5efa\u6a21\u7684\u601d\u60f3\u3002\u6570\u636e\u548c\u7b97\u6cd5\u5e76\u4e0d\u662f\u6700\u91cd\u8981\u7684\uff0c\u91cd\u8981\u7684\u662f\u4f60\u5982\u4f55\u5229\u7528\u8fd9\u4e9b\u6570\u636e\u901a\u8fc7\u4f60\u8bbe\u8ba1\u7684\u6a21\u578b\u6765\u8f93\u51fa\u5bf9\u4f60\u6709\u7528\u7684\u7ed3\u679c\u3002 \u4e0d\u8981\u4ee5\u7f16\u7a0b\u5f00\u59cb\u4f60\u7684\u673a\u5668\u5b66\u4e60\u4e4b\u65c5\uff0c\u8fd9\u6837\u5bb9\u6613\u4f7f\u601d\u7ef4\u53d7\u9650\u4e8e\u8bed\u8a00\uff0c\u901a\u8fc7\u5bf9\u6a21\u578b\u548c\u7ed3\u679c\u7684\u601d\u8003\u8fbe\u5230\u4f60\u7684\u76ee\u7684\uff0c\u7f16\u7a0b\u53ea\u662f\u624b\u6bb5\u4e4b\u4e00\u3002 \u8bdd\u867d\u5982\u6b64\uff0c\u4f46\u662f\u4f60\u5fc5\u987b\u5b66\u4f1a\u7684\u8bed\u8a00\u6709Python\u3001NetLogo\u3001MQL\uff0c\u989d\u5916\u7684\u8bed\u8a00\u4e3aBash\u3001C\u3001C++\uff0c\u5982\u679c\u4f60\u4f1a\u70b9Java\u90a3\u5c31\u66f4\u597d\u5566\u3002\u5982\u4f55\u5b66\u4e60\u5b83\u4eec\uff1fOK\uff0c\u4e0b\u8f7d\u624b\u518c\uff0c\u90a3\u4e9b\u547d\u4ee4\u4e0e\u7c7b\u578b\u4e00\u4e2a\u4e2a\u6572\u7740\u5b66\uff0c\u4e0d\u8981\u6f0f\u8fc7\u4efb\u4f55\u4e00\u4e2a\u3002R\u8bed\u8a00\u7684\u6548\u7387\u53ef\u80fd\u5e76\u4e0d\u662f\u5f88\u597d\uff0c\u5de5\u7a0b\u7c7b\u559c\u6b22Python\uff0c\u79d1\u5b66\u5bb6\u559c\u6b22S-Plus\uff0cR\u4e5f\u6d41\u884c\u3002 \u5efa\u6a21\u5de5\u5177\u8fd9\u5757\u513f\uff0c\u7b14\u8005\u8ba4\u4e3a\u6700\u9002\u5408\u4e2a\u4eba\u5b66\u4e60\u7684\u5f53\u5c5eNetlogo\uff0c\u5176\u4ed6\u5f00\u6e90\u9879\u76ee\u6709\u53ef\u76f4\u63a5\u7528 GAMA \u6216\u8005 Mesa \uff0c\u4e5f\u6709\u5546\u4e1a\u4ea7\u54c1\u6bd4\u5982IBM SPSS\u3001AnyLogic\u7cfb\u5217\uff0c\u6a21\u62df\u80a1\u5e02\u7684\u4e5f\u6709 Altreva Adaptive Modeler \u3001 QLearning Trading \uff0c\u4f46\u662f\u3002\u3002\u3002\u6269\u5c55\u6027\u652f\u6301\u4e0aNetlogo\u7075\u6d3b\u800c\u591a\u6837\uff0c\u5982\u679c\u9700\u8981\u8d85\u7b97\u7248\u672c\u53ef\u4ee5\u4e5f\u53ef\u4ee5\u8bd5\u8bd5Repast\u3002 NetLogo: {download} netlogo_help.7z<../files/netlogo_help.7z> \u5982\u679c\u8bfb\u8005\u5df2\u7ecf\u5177\u5907\u4e86\u4ee5\u4e0b\u51e0\u70b9\u7684\u57fa\u672c\u77e5\u8bc6\uff0c\u90a3\u4e48\uff0c\u8df3\u8fc7\u8fd9\u7ae0\u5427\u3002 1.1 \u6570\u636e\u6536\u96c6 \u6570\u636e\u6536\u96c6\u662f\u5b66\u4e60\u6570\u636e\u5206\u6790\u7684\u5f00\u59cb\u3002 \u4e3a\u4e86\u7701\u53bb\u4e00\u4e9b\u5b66\u4e60\u7684\u9ebb\u70e6\uff0c\u6211\u627e\u4e86\u4e00\u4e9b \u201c\u5927\u201d\u6570\u636e \uff0c\u6709\u4e9b\u4e0a\u767eTB\u7684\u6570\u636e\u5bf9\u975e\u884c\u4e1a\u5185\u7684\u4eba\u6765\u8bf4\u53ef\u80fd\u6beb\u65e0\u610f\u4e49\uff0c\u4f46\u662f\uff0c\u5148\u6765\u4e9b\u6570\u636e\u5427\uff0c\u5b83\u4eec\u5bf9\u5b66\u4e60\u8005\u6765\u8bf4\u8fd8\u662f\u6bd4\u8f83\u5b9e\u7528\u7684\u3002 \u7b80\u5355\u6293\u53d6 \u52a8\u624b\u5199\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u722c\u866b \u5b9e\u9645\u4f7f\u7528\u65f6\u9047\u5230\u7684\u95ee\u9898 \u5206\u5e03\u5f0f\u6293\u53d6 scrapyd scrapy-redis \u4f7f\u7528Nutch + Solr 1.2 \u722c\u866b\u793a\u4f8b 58\u540c\u57ce \u6211\u7b80\u5355\u5199\u4e86\u4e00\u4e2a \u6536\u96c658\u540c\u57ce\u4e2d\u4e0a\u6d77\u51fa\u79df\u623f\u4fe1\u606f\u7684\u722c\u866b \uff0c\u5305\u62ec\u7684\u6761\u76ee\u6709\uff1a \u63cf\u8ff0 \u3001 \u4f4d\u7f6e \u3001 \u4ef7\u683c \u3001 \u623f\u95f4\u6570 \u3001 URL \u3002 \u7531\u4e8e\u8fd9\u4e9b\u4fe1\u606f\u90fd\u53ef\u4ee5\u5728\u5730\u56fe\u4e0a\u8868\u793a\u51fa\u6765\uff0c\u90a3\u6211\u9664\u4e86\u753b\u7edf\u8ba1\u56fe\u4ee5\u5916\u8fd8\u4f1a\u753b\u5b83\u4eec\u5728\u5730\u56fe\u4e0a\u7684\u8868\u793a\u3002 \u77e5\u4e4e http://blog.javachen.com/2014/06/08/using-scrapy-to-cralw-zhihu/ http://segmentfault.com/blog/javachen/1190000000583419 https://github.com/KeithYue/Zhihu_Spider.git \u65b0\u6d6a\u5fae\u535a https://github.com/followyourheart/sina-weibo-crawler 1.3 \u7edf\u8ba1\u5b66\u5173\u952e\u5b57","title":"\u7b2c\u4e00\u7ae0 \u6570\u636e\u6536\u96c6\u3001\u7edf\u8ba1"},{"location":"datanote/ch01/#_1","text":"\u5728\u5f00\u59cb\u8fd9\u4e00\u7ae0\u4e4b\u524d\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u8865\u4e60\u4e00\u4e0b\u6570\u5b66\u77e5\u8bc6\uff1b\u8fd8\u6709\u719f\u6089\u4e0b\u5e38\u89c1\u5de5\u5177\uff08\u8bed\u8a00\uff09\uff0c\u4e0d\u5fc5\u591a\u5e74\u5f00\u53d1\u7ecf\u9a8c\uff0c\u4f1a\u5904\u7406\u5e38\u89c1\u6570\u636e\u7ed3\u6784\u3001\u80fd\u683c\u5f0f\u5316\u6587\u4ef6\u5373\u53ef\u3002 \u5efa\u8bae\u5148\u901a\u8bfb\u4e00\u4e0b Scrapy \u4e2d\u6587\u6587\u6863 \uff0c\u8fd9\u6837\u4f60\u4f1a\u7701\u53bb\u597d\u591aGoogle\u7684\u65f6\u95f4\uff1b\u5728 \u77e5\u4e4e \u4e0a\u6709\u8bb8\u591a\u5173\u4e8e \u5927\u6570\u636e \u3001 \u6570\u636e\u6316\u6398 \u7684\u8ba8\u8bba\uff0c\u4f60\u53ef\u4ee5\u53bb\u770b\u770b\u4e86\u89e3\u4e00\u4e9b\u4e1a\u5185\u7684\u52a8\u6001\u3002 \u53e6\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528 Nutch \u6765\u722c\u53d6\uff0c\u5e76\u7528 Solr \u6765\u6784\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u641c\u7d22\u5f15\u64ce\uff0c\u5b83\u4eec\u53ef\u4ee5\u8ddf\u4e0b\u4e00\u7ae0\u8282\u7684Hadoop\u96c6\u6210\u3002 \u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u70b9-- Model Thinking \uff0c\u4f60\u9700\u8981\u7684\u4e0d\u53ea\u662f\u5efa\u6a21\u7684\u77e5\u8bc6\uff0c\u8fd8\u8981\u6709\u5efa\u6a21\u7684\u601d\u60f3\u3002\u6570\u636e\u548c\u7b97\u6cd5\u5e76\u4e0d\u662f\u6700\u91cd\u8981\u7684\uff0c\u91cd\u8981\u7684\u662f\u4f60\u5982\u4f55\u5229\u7528\u8fd9\u4e9b\u6570\u636e\u901a\u8fc7\u4f60\u8bbe\u8ba1\u7684\u6a21\u578b\u6765\u8f93\u51fa\u5bf9\u4f60\u6709\u7528\u7684\u7ed3\u679c\u3002 \u4e0d\u8981\u4ee5\u7f16\u7a0b\u5f00\u59cb\u4f60\u7684\u673a\u5668\u5b66\u4e60\u4e4b\u65c5\uff0c\u8fd9\u6837\u5bb9\u6613\u4f7f\u601d\u7ef4\u53d7\u9650\u4e8e\u8bed\u8a00\uff0c\u901a\u8fc7\u5bf9\u6a21\u578b\u548c\u7ed3\u679c\u7684\u601d\u8003\u8fbe\u5230\u4f60\u7684\u76ee\u7684\uff0c\u7f16\u7a0b\u53ea\u662f\u624b\u6bb5\u4e4b\u4e00\u3002 \u8bdd\u867d\u5982\u6b64\uff0c\u4f46\u662f\u4f60\u5fc5\u987b\u5b66\u4f1a\u7684\u8bed\u8a00\u6709Python\u3001NetLogo\u3001MQL\uff0c\u989d\u5916\u7684\u8bed\u8a00\u4e3aBash\u3001C\u3001C++\uff0c\u5982\u679c\u4f60\u4f1a\u70b9Java\u90a3\u5c31\u66f4\u597d\u5566\u3002\u5982\u4f55\u5b66\u4e60\u5b83\u4eec\uff1fOK\uff0c\u4e0b\u8f7d\u624b\u518c\uff0c\u90a3\u4e9b\u547d\u4ee4\u4e0e\u7c7b\u578b\u4e00\u4e2a\u4e2a\u6572\u7740\u5b66\uff0c\u4e0d\u8981\u6f0f\u8fc7\u4efb\u4f55\u4e00\u4e2a\u3002R\u8bed\u8a00\u7684\u6548\u7387\u53ef\u80fd\u5e76\u4e0d\u662f\u5f88\u597d\uff0c\u5de5\u7a0b\u7c7b\u559c\u6b22Python\uff0c\u79d1\u5b66\u5bb6\u559c\u6b22S-Plus\uff0cR\u4e5f\u6d41\u884c\u3002 \u5efa\u6a21\u5de5\u5177\u8fd9\u5757\u513f\uff0c\u7b14\u8005\u8ba4\u4e3a\u6700\u9002\u5408\u4e2a\u4eba\u5b66\u4e60\u7684\u5f53\u5c5eNetlogo\uff0c\u5176\u4ed6\u5f00\u6e90\u9879\u76ee\u6709\u53ef\u76f4\u63a5\u7528 GAMA \u6216\u8005 Mesa \uff0c\u4e5f\u6709\u5546\u4e1a\u4ea7\u54c1\u6bd4\u5982IBM SPSS\u3001AnyLogic\u7cfb\u5217\uff0c\u6a21\u62df\u80a1\u5e02\u7684\u4e5f\u6709 Altreva Adaptive Modeler \u3001 QLearning Trading \uff0c\u4f46\u662f\u3002\u3002\u3002\u6269\u5c55\u6027\u652f\u6301\u4e0aNetlogo\u7075\u6d3b\u800c\u591a\u6837\uff0c\u5982\u679c\u9700\u8981\u8d85\u7b97\u7248\u672c\u53ef\u4ee5\u4e5f\u53ef\u4ee5\u8bd5\u8bd5Repast\u3002 NetLogo: {download} netlogo_help.7z<../files/netlogo_help.7z> \u5982\u679c\u8bfb\u8005\u5df2\u7ecf\u5177\u5907\u4e86\u4ee5\u4e0b\u51e0\u70b9\u7684\u57fa\u672c\u77e5\u8bc6\uff0c\u90a3\u4e48\uff0c\u8df3\u8fc7\u8fd9\u7ae0\u5427\u3002","title":"\u7b2c\u4e00\u7ae0 \u6570\u636e\u6536\u96c6\u3001\u7edf\u8ba1"},{"location":"datanote/ch01/#11","text":"\u6570\u636e\u6536\u96c6\u662f\u5b66\u4e60\u6570\u636e\u5206\u6790\u7684\u5f00\u59cb\u3002 \u4e3a\u4e86\u7701\u53bb\u4e00\u4e9b\u5b66\u4e60\u7684\u9ebb\u70e6\uff0c\u6211\u627e\u4e86\u4e00\u4e9b \u201c\u5927\u201d\u6570\u636e \uff0c\u6709\u4e9b\u4e0a\u767eTB\u7684\u6570\u636e\u5bf9\u975e\u884c\u4e1a\u5185\u7684\u4eba\u6765\u8bf4\u53ef\u80fd\u6beb\u65e0\u610f\u4e49\uff0c\u4f46\u662f\uff0c\u5148\u6765\u4e9b\u6570\u636e\u5427\uff0c\u5b83\u4eec\u5bf9\u5b66\u4e60\u8005\u6765\u8bf4\u8fd8\u662f\u6bd4\u8f83\u5b9e\u7528\u7684\u3002","title":"1.1 \u6570\u636e\u6536\u96c6"},{"location":"datanote/ch01/#_2","text":"","title":"\u7b80\u5355\u6293\u53d6"},{"location":"datanote/ch01/#_3","text":"","title":"\u52a8\u624b\u5199\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u722c\u866b"},{"location":"datanote/ch01/#_4","text":"","title":"\u5b9e\u9645\u4f7f\u7528\u65f6\u9047\u5230\u7684\u95ee\u9898"},{"location":"datanote/ch01/#_5","text":"","title":"\u5206\u5e03\u5f0f\u6293\u53d6"},{"location":"datanote/ch01/#scrapyd","text":"","title":"scrapyd"},{"location":"datanote/ch01/#scrapy-redis","text":"","title":"scrapy-redis"},{"location":"datanote/ch01/#nutch-solr","text":"","title":"\u4f7f\u7528Nutch + Solr"},{"location":"datanote/ch01/#12","text":"","title":"1.2 \u722c\u866b\u793a\u4f8b"},{"location":"datanote/ch01/#58","text":"\u6211\u7b80\u5355\u5199\u4e86\u4e00\u4e2a \u6536\u96c658\u540c\u57ce\u4e2d\u4e0a\u6d77\u51fa\u79df\u623f\u4fe1\u606f\u7684\u722c\u866b \uff0c\u5305\u62ec\u7684\u6761\u76ee\u6709\uff1a \u63cf\u8ff0 \u3001 \u4f4d\u7f6e \u3001 \u4ef7\u683c \u3001 \u623f\u95f4\u6570 \u3001 URL \u3002 \u7531\u4e8e\u8fd9\u4e9b\u4fe1\u606f\u90fd\u53ef\u4ee5\u5728\u5730\u56fe\u4e0a\u8868\u793a\u51fa\u6765\uff0c\u90a3\u6211\u9664\u4e86\u753b\u7edf\u8ba1\u56fe\u4ee5\u5916\u8fd8\u4f1a\u753b\u5b83\u4eec\u5728\u5730\u56fe\u4e0a\u7684\u8868\u793a\u3002","title":"58\u540c\u57ce"},{"location":"datanote/ch01/#_6","text":"http://blog.javachen.com/2014/06/08/using-scrapy-to-cralw-zhihu/ http://segmentfault.com/blog/javachen/1190000000583419 https://github.com/KeithYue/Zhihu_Spider.git","title":"\u77e5\u4e4e"},{"location":"datanote/ch01/#_7","text":"https://github.com/followyourheart/sina-weibo-crawler","title":"\u65b0\u6d6a\u5fae\u535a"},{"location":"datanote/ch01/#13","text":"","title":"1.3 \u7edf\u8ba1\u5b66\u5173\u952e\u5b57"},{"location":"datanote/ch02/","text":"\u7b2c\u4e8c\u7ae0 \u673a\u5668\u5b66\u4e60\u57fa\u7840 2.1 numpy \u5feb\u67e5 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 import numpy as np a = np . arange ( 1 , 5 ) data_type = [( 'name' , 'S10' ), ( 'height' , 'float' ), ( 'age' , int )] values = [( 'Arthur' , 1.8 , 41 ), ( 'Lancelot' , 1.9 , 38 ), ( 'Galahad' , 1.7 , 38 )] b = np . array ( values , dtype = data_type ) c = np . arange ( 6 , 10 ) # \u7b26\u53f7 np . sign ( a ) # \u6570\u7ec4\u6700\u5927\u503c a . max () # \u6570\u7ec4\u6700\u5c0f\u503c a . max () # \u533a\u95f4\u5cf0\u5cf0\u503c a . ptp () # \u4e58\u79ef a . prod () # \u7d2f\u79ef a . cumprod () # \u5e73\u5747\u503c a . mean () # \u4e2d\u503c a . median () # \u5dee\u5206 np . diff ( a ) # \u65b9\u5dee np . var ( a ) # \u5143\u7d20\u6761\u4ef6\u67e5\u627e\uff0c\u8fd4\u56deindex\u7684array np . where ( a > 2 ) # \u8fd4\u56de\u7b2c2\uff0c3\uff0c5\u4e2a\u5143\u7d20\u7684array np . take ( a , np . array ( 1 , 2 , 4 )) # \u6392\u5e8f np . msort ( a ) np . sort ( b , kind = 'mergesort' , order = 'height' ) # \u5747\u5206\uff0c\u5947\u6570\u4e2a\u5143\u7d20\u7684array\u4e0d\u53ef\u5206\u5272\u4e3a\u5076\u6570\u3002 np . split ( b , 2 ) # \u521b\u5efa\u5355\u4f4d\u77e9\u9635 np . eye ( 3 ) # \u6700\u5c0f\u4e8c\u4e58\uff0c\u53c2\u6570\u4e3a[x,y,degree]\uff0cdegree\u4e3a\u591a\u9879\u5f0f\u7684\u6700\u9ad8\u6b21\u5e42\uff0c\u8fd4\u56de\u503c\u4e3a\u6240\u6709\u6b21\u5e42\u7684\u7cfb\u6570 np . polyfit ( a , c , 1 ) 2.2 \u76d1\u7763\u5b66\u4e60 \u4fe1\u606f\u5206\u7c7b\u57fa\u7840 \u4fe1\u606f\u7684\u4e0d\u7a33\u5b9a\u6027\u4e3a\u71b5\uff08entropy\uff09\uff0c\u800c\u4fe1\u606f\u589e\u76ca\u4e3a\u6709\u65e0\u6837\u672c\u7279\u5f81\u5bf9\u5206\u7c7b\u95ee\u9898\u5f71\u54cd\u7684\u5927\u5c0f\u3002\u6bd4\u5982\uff0c\u629b\u786c\u5e01\u6b63\u53cd\u4e24\u9762\u5404\u670950%\u6982\u7387\uff0c\u6b64\u65f6\u4e0d\u7a33\u5b9a\u6027\u6700\u5927\uff0c\u71b5\u4e3a1\uff1b\u592a\u9633\u660e\u5929\u7167\u5e38\u5347\u8d77\uff0c\u5219\u662f\u5fc5\u7136\uff0c\u6b64\u4e8b\u4e0d\u7a33\u5b9a\u6027\u6700\u5c0f\uff0c\u71b5\u4e3a0\u3002 \u5047\u8bbe\u4e8b\u4ef6X\uff0c\u53d1\u751f\u6982\u7387\u4e3ax\uff0c\u5176\u4fe1\u606f\u671f\u671b\u503c\u5b9a\u4e49\u4e3a\uff1a \\[ l(X) = -log_2 x \\] \u6574\u4e2a\u4fe1\u606f\u7684\u71b5\u4e3a\uff1a \\[ H = -\\sum^n_{i=1} log_2 x \\] \u5982\u4f55\u627e\u5230\u6700\u597d\u7684\u5206\u7c7b\u7279\u5f81\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 def chooseBestFeatureToSplit ( dataSet ): numFeatures = len ( dataSet [ 0 ]) - 1 #the last column is used for the labels baseEntropy = calcShannonEnt ( dataSet ) bestInfoGain = 0.0 ; bestFeature = - 1 for i in range ( numFeatures ): #iterate over all the features featList = [ example [ i ] for example in dataSet ] #create a list of all the examples of this feature uniqueVals = set ( featList ) #get a set of unique values newEntropy = 0.0 for value in uniqueVals : subDataSet = splitDataSet ( dataSet , i , value ) prob = len ( subDataSet ) / float ( len ( dataSet )) newEntropy += prob * calcShannonEnt ( subDataSet ) infoGain = baseEntropy - newEntropy #calculate the info gain; ie reduction in entropy if ( infoGain > bestInfoGain ): #compare this to the best gain so far bestInfoGain = infoGain #if better than current best, set to best bestFeature = i return bestFeature #returns an integer \u5176\u4e2d \uff0c dataSet\u4e3a\u6240\u6709\u7279\u5f81\u5411\u91cf \uff0c caclShannonEnt () \u8ba1\u7b97\u7279\u5f81\u5411\u91cf\u7684\u71b5 \uff0c splitDataSet () \u5207\u9664\u5411\u91cf\u4e2d\u7684value\u5217 \uff1b infoGain\u5373\u4e3a\u4fe1\u606f\u589e\u76ca \uff0c chooseBestFeatureToSplit\u8fd4\u56de\u6700\u597d\u7684\u7279\u5f81\u5411\u91cf\u7d22\u5f15\u503c \u3002 K\u90bb\u8fd1\u7b97\u6cd5 kNN\u7684\u7b97\u6cd5\u6a21\u578b\u5982\u4e0b\uff1a \u5bf9\u4e8e\u672a\u77e5\u7c7b\u522b\u5c5e\u6027\u7684\u6570\u636e\u4e14\u96c6\u4e2d\u7684\u6bcf\u4e2a\u70b9\u4f9d\u6b21\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u8ba1\u7b97\u5df2\u77e5\u7c7b\u522b\u6570\u636e\u96c6\u4e2d\u7684\u70b9\u4e0e\u5f53\u524d\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb \u6309\u7167\u8ddd\u79bb\u9012\u589e\u4f9d\u6b21\u6392\u5e8f \u9009\u53d6\u4e0e\u5f53\u524d\u70b9\u8ddd\u79bb\u6700\u5c0f\u7684k\u4e2a\u70b9 \u786e\u5b9a\u524dk\u4e2a\u70b9\u6240\u5728\u7c7b\u522b\u7684\u51fa\u73b0\u9891\u7387 \u8fd4\u56de\u524dk\u4e2a\u70b9\u51fa\u73b0\u9891\u7387\u6700\u9ad8\u7684\u7c7b\u522b\u4f5c\u4e3a\u5f53\u524d\u70b9\u7684\u9884\u6d4b\u5206\u7c7b \u4ee3\u7801\u53c2\u8003\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 def classify0 ( inX , dataSet , labels , k ): dataSetSize = dataSet . shape [ 0 ] diffMat = tile ( inX , ( dataSetSize , 1 )) - dataSet sqDiffMat = diffMat ** 2 sqDistances = sqDiffMat . sum ( axis = 1 ) distances = sqDistances ** 0.5 sortedDistIndicies = distances . argsort () classCount = {} for i in range ( k ): voteIlabel = labels [ sortedDistIndicies [ i ]] classCount [ voteIlabel ] = classCount . get ( voteIlabel , 0 ) + 1 sortedClassCount = sorted ( classCount . iteritems (), key = operator . itemgetter ( 1 ), reverse = True ) return sortedClassCount [ 0 ][ 0 ] \u5176\u4e2d \uff0c inX\u4e3a\u8f93\u5165\u5411\u91cf \uff0c dataSet\u4e3a\u6570\u636e\u96c6 \uff0c labels\u4e3a\u6570\u636e\u96c6\u7684\u5206\u7c7b \uff0c \u53ef\u8c03 \u3002 \u8ddd\u79bb\u8ba1\u7b97\u516c\u5f0f\u4e3ad0 = (( x - x0 ) ** 2 + ( y - y0 ) ** 2 ) ** 0.5 \u3002 \u6b64\u79cd\u7b97\u6cd5\u7684\u4f18\u70b9\u4e3a\u7cbe\u5ea6\u9ad8\u3001\u5bf9\u5f02\u5e38\u503c\u4e0d\u654f\u611f\u3001\u4f46\u7f3a\u70b9\u4e5f\u6bd4\u8f83\u660e\u663e\uff0c\u5373\u6570\u636e\u91cf\u5927\u65f6\u5f00\u652f\u76f8\u5bf9\u8f83\u5927\uff0c\u9002\u7528\u4e8e\u6570\u503c\uff0d\u6807\u79f0\u578b\u6570\u636e\u3002 \u51b3\u7b56\u6811 \u51b3\u7b56\u6811\u5373\u5217\u51fa\u4e00\u7cfb\u5217\u9009\u62e9\uff0c\u6839\u636e\u8bad\u7ec3\u96c6\u4e2d\u7684\u5927\u91cf\u5f62\u4f3c\uff08A\u3001B\u3001C\uff09\u4ee5\u53ca\u7ed3\u679cD\u7684\u5411\u91cf\u6765\u9884\u6d4b\u65b0\u8f93\u5165\uff08A'\u3001B'\u3001C'\uff09\u7684\u7ed3\u679cD'\u3002 \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u51b3\u7b56\u6811\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 def createTree ( dataSet , labels ): classList = [ example [ - 1 ] for example in dataSet ] if classList . count ( classList [ 0 ]) == len ( classList ): return classList [ 0 ] #stop splitting when all of the classes are equal if len ( dataSet [ 0 ]) == 1 : #stop splitting when there are no more features in dataSet return majorityCnt ( classList ) bestFeat = chooseBestFeatureToSplit ( dataSet ) bestFeatLabel = labels [ bestFeat ] myTree = { bestFeatLabel :{}} del ( labels [ bestFeat ]) featValues = [ example [ bestFeat ] for example in dataSet ] uniqueVals = set ( featValues ) for value in uniqueVals : subLabels = labels [:] #copy all of labels, so trees don't mess up existing labels myTree [ bestFeatLabel ][ value ] = createTree ( splitDataSet ( dataSet , bestFeat , value ), subLabels ) return myTree \u627e\u5230\u5f71\u54cd\u6700\u5927\u7684\u7279\u5f81bestFeat\u540e \uff0c \u518d\u521b\u5efa\u6b64\u7279\u5f81\u4e0b\u7684\u5206\u7c7b\u5411\u91cf\u521b\u5efa\u5b50\u6811\u5411\u91cf \uff0c \u7136\u540e\u5c06bestFeat\u5206\u79bb\u540e\u7ee7\u7eed\u8fed\u4ee3 \uff0c \u76f4\u81f3\u6240\u6709\u7279\u5f81\u90fd\u8f6c\u6362\u6210\u51b3\u7b56\u8282\u70b9 \u3002 \u539f\u59cb\u6570\u636e\u6bd4\u5982 \uff1a no - surfacing flippers fish 1 yes yes yes 2 yes yes yes 3 yes no no 4 no yes no 5 no yes no \u4f1a\u751f\u6210\u5982\u4e0b\u51b3\u7b56\u6811 \uff1a no - surfacing ? / \\ no / \\ yes fish ( no ) flippers ? / \\ no / \\ yes fish ( no ) fish ( yes ) \u8868\u793a\u6210JSON\u683c\u5f0f \uff0c \u5373python\u5b57\u5178 \uff1a { 'no surfacing' :{ 0 : 'no' , 1 :{ 'flippers' :{ 0 : 'no' , 1 : 'yes' }}} \u6784\u5efa\u51b3\u7b56\u6811\u7684\u65b9\u6cd5\u6bd4\u8f83\u591a \uff0c \u4e5f\u53ef\u4f7f\u7528C4 . 5 \u548cCART\u7b97\u6cd5 \u3002 \u63a5\u4e0b\u6765\u4f7f\u7528\u51b3\u7b56\u6811\u8fdb\u884c\u5206\u7c7b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 def classify ( inputTree , featLabels , testVec ): firstStr = inputTree . keys ()[ 0 ] secondDict = inputTree [ firstStr ] featIndex = featLabels . index ( firstStr ) key = testVec [ featIndex ] valueOfFeat = secondDict [ key ] if isinstance ( valueOfFeat , dict ): classLabel = classify ( valueOfFeat , featLabels , testVec ) else : classLabel = valueOfFeat return classLabel \u5176\u4e2d \uff0c featLabels\u4e3a\u6d4b\u8bd5\u7684\u5224\u65ad\u8282\u70b9 \uff0c \u5373\u7279\u5f81 \uff0c testVec\u4e3a\u5176\u503c \uff0c \u6bd4\u5982classify [ myTree , \"['no-surfacing','flippers']\" ,:[ 1 , 1 ] \"]\uff0c\u5982\u6b64\u7ed3\u679c\u4fbf\u4e3a'no'\u3002 \u4f7f\u7528pickle\u5bf9\u51b3\u7b56\u6811\u8fdb\u884c\u5e8f\u5217\u5316\u5b58\u50a8\uff1a 1 2 3 4 5 6 7 def storeTree ( inputTree , filename ): import pickle fw = open ( filename , 'w' ) pickle . dump ( inputTree , fw ) fw . close () \u5176\u4e2d \uff0c dump\u53ef\u9009\u534f\u8bae\u4e3a0 \uff08 ASCII \uff09\uff0c 1 \uff08 BINARY \uff09\uff0c \u9ed8\u8ba4\u4e3a0 \uff1b \u8bfb\u53d6\u65f6\u4f7f\u7528pickle . load \uff1b \u540c\u6837\u53ef\u4f7f\u7528dumps \uff0c loads\u76f4\u63a5\u5bf9\u5b57\u7b26\u53d8\u91cf\u8fdb\u884c\u64cd\u4f5c \u3002 \u6b64\u79cd\u7b97\u6cd5\u8ba1\u7b97\u590d\u6742\u5ea6\u4e0d\u9ad8\uff0c\u5bf9\u4e2d\u95f4\u503c\u7f3a\u5931\u4e0d\u654f\u611f\uff0c\u4f46\u53ef\u80fd\u4f1a\u4ea7\u751f\u8fc7\u62df\u5408\u7684\u95ee\u9898\u3002 \u6734\u7d20\u8d1d\u53f6\u65af \u8d1d\u53f6\u65af\u6a21\u578b\u662f\u57fa\u4e8e\u72ec\u7acb\u6982\u7387\u7edf\u8ba1\u7684\uff0c\u601d\u60f3\u53ef\u4ee5\u8fd9\u4e48\u8bf4\uff1a \u603b\u51717\u4e2a\u77f3\u5b50\u5728A\u3001B\u4e24\u4e2a\u6876\u4e2d\uff0cA\u6876\u4e2d\u67092\u9ed12\u767d\uff0cB\u6876\u4e2d\u67092\u9ed11\u767d\u3002\u5df2\u77e5\u6761\u4ef6\u4e3a\u77f3\u5b50\u6765\u81eaB\u6876\uff0c\u90a3\u4e48\u5b83\u662f\u767d\u8272\u77f3\u5b50\u7684\u6982\u7387\u53ef\u8868\u793a\u4e3a\uff1a 1 P(white|B)=P(B|white)P(white)/P(B) \u63a5\u4e0b\u6765\uff0c\u5b9a\u4e49\u4e24\u4e2a\u4e8b\u4ef6A\u3001B\uff0cP(A|B)\u4e0eP(B|A)\u76f8\u4e92\u8f6c\u5316\u7684\u8fc7\u7a0b\u5373\u4e3a\uff1a 1 P(B|A)=P(A|B)P(B)/P(A) \u800c\u6734\u7d20\u8d1d\u53f6\u65af\u53ef\u4ee5\u8fd9\u6837\u63cf\u8ff0\uff1a Note \u8bbex={a1,a2,...,am}\u4e3a\u5f85\u5206\u7c7b\u9879\uff0ca\u4e3ax\u7684\u7279\u5f81\u5c5e\u6027\uff0c\u7c7b\u522b\u96c6\u5408\u4e3aC={y1,y2,...,ym}\uff0c\u5982\u679cP(yk|x)=max(P(y1|x),P(y2|x),...,P(yn|x))\uff0c\u5219x\u5c5e\u4e8eyk\u3002 \u6574\u4e2a\u7b97\u6cd5\u6838\u5fc3\u5373\u662f\u7b49\u5f0fP(yi|x)=P(x|yi)P(yi)/P(x)\u3002 \u9996\u5148\u6784\u5efa\u4e00\u4e2a\u5206\u7c7b\u8bad\u7ec3\u51fd\u6570\uff08\u4e8c\u5143\u5206\u7c7b\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 def trainNB0 ( trainMatrix , trainCategory ): numTrainDocs = len ( trainMatrix ) numWords = len ( trainMatrix [ 0 ]) pBad = sum ( trainCategory ) / float ( numTrainDocs ) p0Num = ones ( numWords ); p1Num = ones ( numWords ) #change to ones() p0Denom = 2.0 ; p1Denom = 2.0 #change to 2.0 for i in range ( numTrainDocs ): if trainCategory [ i ] == 1 : p1Num += trainMatrix [ i ] p1Denom += sum ( trainMatrix [ i ]) else : p0Num += trainMatrix [ i ] p0Denom += sum ( trainMatrix [ i ]) p1Vect = log ( p1Num / p1Denom ) #change to log() p0Vect = log ( p0Num / p0Denom ) #change to log() return p0Vect , p1Vect , pBad \u5176\u4e2d \uff0c trainMatrix\u4e3a\u6240\u6709\u8bad\u7ec3\u96c6\u4e2d\u7684\u5e03\u5c14\u5411\u91cf \uff0c \u6bd4\u5982\u4e24\u672c\u4e66A \u3001 B \uff0c \u5176\u4e2dA\u6709\u4e24\u4e2a\u5355\u8bcdx \u3001 y \uff0c B\u6709\u4e24\u4e2a\u5355\u8bcdx \u3001 z \uff0c \u5e76\u4e14A\u662f\u597d\u4e66 \uff08 \u503c\u8ba1\u4e3a0 \uff09\uff0c B\u662f\u70c2\u4e66 \uff08 \u503c\u8ba1\u4e3a0 \uff09\uff0c \u628a\u6240\u6709\u5355\u8bcd\u8fdb\u884c\u6392\u5e8f\u540e\u5f97\u5411\u91cf [ 'x' , 'y' , 'z' ] \uff0c \u5219A\u7684Matrix\u53ef\u8868\u793a\u4e3a [ 1 , 1 , 0 ] \uff0c B\u7684\u4e3a [ 1 , 0 , 1 ] \uff0c \u6240\u4ee5\u6b64\u51fd\u6570\u4e2d\u7684trainMatrix\u5373 [[ 1 , 1 , 0 ],[ 1 , 0 , 1 ]] \uff0c trainCategory\u4e3a [ 0 , 1 ] \u3002 \u51fd\u6570\u8fd4\u56de\u7684\u4e3a\u6982\u7387\u96c6\u7684\u5411\u91cf \u3002 \u5206\u7c7b\u51fd\u6570\uff1a 1 2 3 4 5 6 7 8 9 def classifyNB ( vec2Classify , p0Vec , p1Vec , pClass1 ): p1 = sum ( vec2Classify * p1Vec ) + log ( pClass1 ) #element-wise mult p0 = sum ( vec2Classify * p0Vec ) + log ( 1.0 - pClass1 ) if p1 > p0 : return 1 else : return 0 vec2Classify\u5373\u4e3a\u8981\u5206\u7c7b\u7684\u5411\u91cf \uff0c \u5f62\u5982trainMatrix \uff0c \u968f\u540e\u7684\u4e09\u4e2a\u53c2\u6570\u4e3atrainNB0\u6240\u8fd4\u56de \u3002 p1 \u3001 p0\u53ef\u4ee5\u7406\u89e3\u4e3a\u671f\u671b\u6982\u7387\u503c \uff0c \u6bd4\u8f83\u4e24\u8005\u5927\u5c0f\u5373\u53ef\u5212\u5206 \u3002 \u6d4b\u8bd5\u7528\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 def testingNB (): listOPosts , listClasses = loadDataSet () myVocabList = createVocabList ( listOPosts ) trainMat = [] for postinDoc in listOPosts : trainMat . append ( setOfWords2Vec ( myVocabList , postinDoc )) p0V , p1V , pAb = trainNB0 ( array ( trainMat ), array ( listClasses )) testEntry = [ 'love' , 'my' , 'dalmation' ] thisDoc = array ( setOfWords2Vec ( myVocabList , testEntry )) print testEntry , 'classified as: ' , classifyNB ( thisDoc , p0V , p1V , pAb ) testEntry = [ 'stupid' , 'garbage' ] thisDoc = array ( setOfWords2Vec ( myVocabList , testEntry )) print testEntry , 'classified as: ' , classifyNB ( thisDoc , p0V , p1V , pAb ) \u6574\u4f53\u6765\u8bf4\uff0c\u6734\u7d20\u8d1d\u53f6\u65af\u5206\u7c7b\u65b9\u6cd5\u5728\u6570\u636e\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\u4ecd\u7136\u6709\u6548\uff0c\u4f46\u662f\u5bf9\u6570\u636e\u8f93\u5165\u6bd4\u8f83\u654f\u611f\u3002 Logistic\u56de\u5f52 \u5728\u7edf\u8ba1\u5b66\u4e2d\uff0c\u7ebf\u6027\u56de\u5f52\u662f\u5229\u7528\u79f0\u4e3a\u7ebf\u6027\u56de\u5f52\u65b9\u7a0b\u7684\u6700\u5c0f\u4e8c\u4e58\u51fd\u6570\u5bf9\u4e00\u4e2a\u6216\u591a\u4e2a\u81ea\u53d8\u91cf\u548c\u56e0\u53d8\u91cf\u4e4b\u95f4\u5173\u7cfb\u8fdb\u884c\u5efa\u6a21\u7684\u4e00\u79cd\u56de\u5f52\u5206\u6790\u3002\u8fd9\u79cd\u51fd\u6570\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u79f0\u4e3a\u56de\u5f52\u7cfb\u6570\u7684\u6a21\u578b\u53c2\u6570\u7684\u7ebf\u6027\u7ec4\u5408\u3002\u53ea\u6709\u4e00\u4e2a\u81ea\u53d8\u91cf\u7684\u60c5\u51b5\u79f0\u4e3a\u7b80\u5355\u56de\u5f52\uff0c\u5927\u4e8e\u4e00\u4e2a\u81ea\u53d8\u91cf\u60c5\u51b5\u7684\u53eb\u505a\u591a\u5143\u56de\u5f52\u3002\uff08 \u7ef4\u57fa\u767e\u79d1 \uff09 \u5148\u4ecb\u7ecd\u4e24\u4e2a\u91cd\u8981\u7684\u6570\u5b66\u6982\u5ff5\u3002 \u6700\u5c0f\u4e8c\u4e58\u6cd5\u5219 \u6700\u5c0f\u4e8c\u4e58\u6cd5\uff08\u53c8\u79f0\u6700\u5c0f\u5e73\u65b9\u6cd5\uff09\u662f\u4e00\u79cd\u6570\u5b66\u4f18\u5316\u6280\u672f\u3002\u5b83\u901a\u8fc7\u6700\u5c0f\u5316\u8bef\u5dee\u7684\u5e73\u65b9\u548c\u5bfb\u627e\u6570\u636e\u7684\u6700\u4f73\u51fd\u6570\u5339\u914d\u3002 \u5229\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u53ef\u4ee5\u7b80\u4fbf\u5730\u6c42\u5f97\u672a\u77e5\u7684\u6570\u636e\uff0c\u5e76\u4f7f\u5f97\u8fd9\u4e9b\u6c42\u5f97\u7684\u6570\u636e\u4e0e\u5b9e\u9645\u6570\u636e\u4e4b\u95f4\u8bef\u5dee\u7684\u5e73\u65b9\u548c\u4e3a\u6700\u5c0f\u3002 \u793a\u4f8b1 \u6709\u56db\u4e2a\u6570\u636e\u70b9(1,6)\u3001(2,5)\u3001(3,7)\u3001(4,10)\uff0c\u6211\u4eec\u5e0c\u671b\u627e\u5230\u4e00\u6761\u76f4\u7ebfy=a+bx\u4e0e\u8fd9\u56db\u4e2a\u70b9\u6700\u5339\u914d\u3002 \\[ a+1b=6 \\] \\[ a+2b=5 \\] \\[ a+3b=7 \\] \\[ a+4b=10 \\] \u91c7\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u4f7f\u7b49\u53f7\u4e24\u8fb9\u7684\u65b9\u5dee\u5c3d\u53ef\u80fd\u5c0f\uff0c\u4e5f\u5c31\u662f\u627e\u51fa\u8fd9\u4e2a\u51fd\u6570\u7684\u6700\u5c0f\u503c\uff1a \\[ S(a,b) = [6-(a+1b)]^2+[5-(a+2b)]^2+[7-(a+3b)]^2+[10-(a+4b)]^2 \\] \u7136\u540e\u5bf9S(a,b)\u6c42a,b\u7684\u504f\u5bfc\u6570\uff0c\u4f7f\u5176\u4e3a0\u5f97\u5230\uff1a \\[ \\cfrac{{\\partial}S}{{\\partial}a} = 0 = 8a+20b-56 \\] \\[ \\cfrac{{\\partial}S}{{\\partial}b} = 0 = 20a+60b-154 \\] \u8fd9\u6837\u5c31\u89e3\u51fa\uff1a \\[ a=3.5,b=1.4 \\] \u6240\u4ee5\u76f4\u7ebfy=3.5+1.4x\u662f\u6700\u4f73\u7684\u3002 \u51fd\u6570\u8868\u793a \\[ \\min_{\\vec{b}}{\\sum^n_{i=1}}(y_m-y_i)^2 \\] \u6b27\u51e0\u91cc\u5fb7\u8868\u793a \\[ \\min_{ \\vec{b} } \\| \\vec{y}_{m} ( \\vec{b} ) - \\vec{y} \\|_{2} \\] \u7ebf\u6027\u51fd\u6570\u6a21\u578b \u5178\u578b\u7684\u4e00\u7c7b\u51fd\u6570\u6a21\u578b\u662f\u7ebf\u6027\u51fd\u6570\u6a21\u578b\u3002\u6700\u7b80\u5355\u7684\u7ebf\u6027\u5f0f\u662f \\[ y = b_0 + b_1 t \\] \u5199\u6210\u77e9\u9635\u5f0f\uff0c\u4e3a \\[ \\min_{b_0,b_1}\\left\\|\\begin{pmatrix}1 & t_1 \\\\ \\vdots & \\vdots \\\\ 1 & t_n \\end{pmatrix}\\begin{pmatrix} b_0\\\\ b_1\\end{pmatrix} - \\begin{pmatrix} y_1 \\\\ \\vdots \\\\ y_{n}\\end{pmatrix}\\right\\|_{2} = \\min_b\\|Ab-Y\\|_2 \\] \u76f4\u63a5\u7ed9\u51fa\u8be5\u5f0f\u7684\u53c2\u6570\u89e3\uff1a \\[ b_1 = \\frac{\\sum_{i=1}^n t_iy_i - n \\cdot \\bar t \\bar y}{\\sum_{i=1}^n t_i^2- n \\cdot (\\bar t)^2} \\] \\[ b_0 = \\bar y - b_1 \\bar t \\] \u5176\u4e2d \\[ \\bar t = \\frac{1}{n} \\sum_{i=1}^n t_i \\] \u4e3at\u503c\u7684\u7b97\u672f\u5e73\u5747\u503c\u3002\u4e5f\u53ef\u89e3\u5f97\u5982\u4e0b\u5f62\u5f0f\uff1a \\[ b_1 = \\frac{\\sum_{i=1}^n (t_i - \\bar t)(y_i - \\bar y)}{\\sum_{i=1}^n (t_i - \\bar t)^2} \\] \u793a\u4f8b2 \u968f\u673a\u9009\u5b9a10\u8258\u6218\u8230\uff0c\u5e76\u5206\u6790\u5b83\u4eec\u7684\u957f\u5ea6\u4e0e\u5bbd\u5ea6\uff0c\u5bfb\u627e\u5b83\u4eec\u957f\u5ea6\u4e0e\u5bbd\u5ea6\u4e4b\u95f4\u7684\u5173\u7cfb\u3002\u7531\u4e0b\u9762\u7684\u63cf\u70b9\u56fe\u53ef\u4ee5\u76f4\u89c2\u5730\u770b\u51fa\uff0c\u4e00\u8258\u6218\u8230\u7684\u957f\u5ea6\uff08t\uff09\u4e0e\u5bbd\u5ea6\uff08y\uff09\u57fa\u672c\u5448\u7ebf\u6027\u5173\u7cfb\u3002\u6563\u70b9\u56fe\u5982\u4e0b\uff1a \u4ee5\u4e0b\u56fe\u8868\u5217\u51fa\u4e86\u5404\u6218\u8230\u7684\u6570\u636e\uff0c\u968f\u540e\u6b65\u9aa4\u662f\u91c7\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u786e\u5b9a\u4e24\u53d8\u91cf\u95f4\u7684\u7ebf\u6027\u5173\u7cfb\u3002 \u4eff\u7167\u4e0a\u9762\u7ed9\u51fa\u7684\u4f8b\u5b50 \\[ \\bar t = \\frac {\\sum_{i=1}^n t_i}{n} = \\frac {1678}{10} = 167{.}8 \\] \u5e76\u5f97\u5230\u76f8\u5e94\u7684 \\[ \\bar y = 18{.}41 \\] \u7136\u540e\u786e\u5b9ab1 \\[ b_1 = \\frac{\\sum_{i=1}^n (t_i- \\bar {t})(y_i - \\bar y)}{\\sum_{i=1}^n (t_i- \\bar t)^2} = \\frac{3287{.}820} {20391{.}60} = 0{.}1612 \\; \\] \u53ef\u4ee5\u770b\u51fa\uff0c\u6218\u8230\u7684\u957f\u5ea6\u6bcf\u53d8\u53161m\uff0c\u76f8\u5bf9\u5e94\u7684\u5bbd\u5ea6\u4fbf\u8981\u53d8\u531616cm\u3002\u5e76\u7531\u4e0b\u5f0f\u5f97\u5230\u5e38\u6570\u9879b0\uff1a \\[ b_0 = \\bar y - b_1 \\bar t = 18{.}41 - 0{.}1612 \\cdot 167{.}8 = -8{.}6394 \\] \u53ef\u4ee5\u770b\u51fa\u70b9\u7684\u62df\u5408\u975e\u5e38\u597d\uff0c\u957f\u5ea6\u548c\u5bbd\u5ea6\u7684\u76f8\u5173\u6027\u5927\u7ea6\u4e3a96.03\uff05\u3002 \u5229\u7528Matlab\u5f97\u5230\u62df\u5408\u76f4\u7ebf\uff1a Sigmoid\u51fd\u6570 Sigmoid\u51fd\u6570\u5177\u6709\u5355\u4f4d\u9636\u8dc3\u51fd\u6570\u7684\u6027\u8d28\uff0c\u516c\u5f0f\u8868\u793a\u4e3a\uff1a \\[ \\sigma (z)=\\cfrac{1}{1+e^{-z}} \\] ```{image} ../images/04-01.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 \u6211\u4eec\u5c06\u8f93\u5165\u8bb0\u4e3az\uff0c\u6709\u4e0b\u9762\u7684\u516c\u5f0f\u5f97\u51fa\uff1a $$ z=w_0 x_0 + w_1 x_1 + w_2 x_2 + \\dots + w_n x_n $$ \u4f7f\u7528\u5411\u91cf\u5199\u6cd5\uff1a $$ z=w^T x $$ \u5176\u4e2d\u5411\u91cfx\u662f\u5206\u7c7b\u5668\u7684\u8f93\u5165\u6570\u636e\uff0c\u5411\u91cfw\u5c31\u662f\u6211\u4eec\u8981\u627e\u5230\u7684\u6700\u4f73\u7cfb\u6570\u3002 *\u57fa\u4e8e\u4f18\u5316\u65b9\u6cd5\u786e\u5b9a\u56de\u5f52\u7cfb\u6570* **\u68af\u5ea6\u4e0a\u5347/\u4e0b\u964d\u6cd5** \u68af\u5ea6\u4e0a\u5347\u6cd5/\u4e0b\u964d\u6cd5\u7684\u601d\u60f3\u662f\uff1a\u8981\u627e\u5230\u51fd\u6570\u7684\u6700\u5927\u503c\uff0c\u6700\u597d\u7684\u65b9\u6cd5\u662f\u6cbf\u7740\u8be5\u51fd\u6570\u7684\u68af\u5ea6\u65b9\u5411\u63a2\u5bfb\uff0c\u51fd\u6570f(x,y)\u7684\u68af\u5ea6\u5982\u4e0b\u8868\u793a\uff1a $$ {\\nabla}f(x,y)=\\begin{pmatrix} \\cfrac{{\\partial}f(x,y)}{{\\partial}x} \\\\ \\cfrac{{\\partial}f(x,y)}{{\\partial}y}\\end{pmatrix} $$ \u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\u6b64\u7b97\u6cd5\uff1a > \u4ece\u524d\u6709\u4e00\u5ea7\u5c71\uff0c\u4e00\u4e2a\u61d2\u4eba\u8981\u722c\u5c71\uff0c\u4ed6\u4ece\u5c71\u811a\u4e0b\u7684\u4efb\u610f\u4f4d\u7f6e\u5411\u5c71\u9876\u51fa\u53d1\uff0c\u5e76\u4e14\u77e5\u9053\u7b49\u9ad8\u7ebf\u56fe\u7684\u6bcf\u4e2a\u73af\u4e0a\u90fd\u6709\u4e00\u4e2a\u5bbf\u8425\u70b9\uff0c\u4ed6\u5e0c\u671b\u5728\u8fd9\u4e9b\u5bbf\u8425\u70b9\u4e4b\u95f4\u4fee\u5efa\u4e00\u6761\u7b14\u76f4\u7684\u8def\uff0c\u5e76\u4e14\u8def\u5230\u4e24\u65c1\u7684\u5bbf\u8425\u70b9\u7684\u5782\u76f4\u8ddd\u79bb\u5dee\u7684\u5e73\u65b9\u548c\u5c3d\u53ef\u80fd\u5c0f\u3002\u6bcf\u5230\u4e00\u4e2a\u7b49\u9ad8\u7ebf\u5708\uff0c\u4ed6\u90fd\u4f1a\u6839\u636e\u4ed6\u5728\u4e0a\u4e00\u4e2a\u7b49\u9ad8\u7ebf\u7684\u8ddd\u79bb\u7684\u53d8\u5316\u91cf\u6765\u8c03\u8282\u4ed6\u7684\u5728\u7b49\u9ad8\u7ebf\u4e0a\u7684\u4f4d\u7f6e\uff0c\u4ece\u800c\u4f7f\u516c\u8def\u6ee1\u8db3\u8981\u6c42\u3002 > \u8fd4\u56de\u56de\u5f52\u7cfb\u6570\uff1a ```python def sigmoid(x): return 1.0/(1+math.exp(-x)) def gradAscent(dataMatIn, classLabels): dataMatrix = mat(dataMatIn) #convert to NumPy matrix labelMat = mat(classLabels).transpose() #convert to NumPy matrix m,n = shape(dataMatrix) alpha = 0.001 maxCycles = 500 weights = ones((n,1)) for k in range(maxCycles): #heavy on matrix operations h = sigmoid(dataMatrix*weights) #matrix mult error = (labelMat - h) #vector subtraction weights = weights + alpha * dataMatrix.transpose()* error #matrix mult return weights \u5176\u4e2d\uff0c\u8bef\u5dee\u503c\u4e58\u4ee5\u77e9\u9635\u7684\u8f6c\u79e9\u4ee3\u8868\u68af\u5ea6\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8f7d\u5165\u6570\u636e\u96c6\u5c1d\u8bd5\u753b\u51fa\u6700\u4f73\u62df\u5408\u76f4\u7ebf\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import matplotlib.pyplot as plt def plotBestFit ( w ): weights = w . getA () # \u5c06\u77e9\u9635\u8f6c\u5316\u4e3a\u6570\u7ec4 dataMat , labelMat = loadDataSet () dataArr = array ( dataMat ) n = shape ( dataArr )[ 0 ] x1 = x2 = x3 = x4 = [] for i in range ( n ): if int ( labelMat [ i ] == 1 : x1 . append ( dataArr [ i , 1 ]); y1 . append ( dataArr [ i , 2 ]) else x2 . append ( dataArr [ i , 1 ]); y2 . append ( dataArr [ i , 2 ]) fig = plt . figure () ax = fig . add_subplot ( 111 ) ax . scatter ( x1 , y1 , s = 30 , c = 'red' , markers = 's' ) ax . scatter ( x2 , y2 , s = 30 , c = 'green' ) x = arrange ( - 3.0 , 3.0 , 0.1 ) y = ( - weight [ 0 ] - weights [ 1 ] * x ) / weights [ 2 ] ax . plot ( x , y ) plt . xlabel ( 'X1' ) plt . xlabel ( 'X2' ) plt . show () \u5982\u679c\u5904\u7406\u5927\u91cf\u6570\u636e\u96c6\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u6279\u91cf\u6570\u636e\u96c6\u4e2d\u7684\u5355\u4e2a\u6570\u636e\u70b9\u8fdb\u884c\u7cfb\u6570\u66f4\u65b0\uff0c\u6216\u8005\u4f7f\u7528\u968f\u673a\u6570\u636e\u96c6\u7684\u6570\u636e\u70b9\uff0c\u5206\u522b\u5982\u4e0b\u6240\u793a\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 def stocGradAscentBatch ( dataMatrix , classLabels ): m , n = shape ( dataMatrix ) alpha = 0.01 weights = ones ( n ) for i in range ( m ): h = sigmoid ( sum ( dataMatrix [ i ] * weights )) error = classLabels [ i ] - h weights = weights + alpha * error * dataMatrix [ i ] return weights def stocGradAscentRand ( dataMatrix , classLabels , numIter = 150 ) m , n = shape ( dataMatrix ) weights = ones ( n ) for j in range ( numIter ) dataIndex = range ( m ) for i in range ( m ): alpha = 4 / ( 1.0 + j + i ) + 0.01 # \u8c03\u6574 randIndex = int ( random . uniform ( 0 , len ( dataIndex ))) h = sigmoid ( sum ( dataMatrix [ randIndex ] * weights )) error = classLabels [ randIndex ] - h weights = weights + alpha * error * dataMatrix [ randIndex ] del ( dataIndex [ randIndex ]) # \u5220\u9664\u5df2\u9009\uff0c\u9632\u6b62\u91cd\u590d\u9009\u53d6 \u7ebf\u6027\u56de\u5f52 \u6811\u56de\u5f52 SVM SVM\uff08Supprot Vector Machines\uff09\u5373\u652f\u6301\u5411\u91cf\u673a\uff0c\u5b8c\u5168\u7406\u89e3\u5176\u7406\u8bba\u77e5\u8bc6\u5bf9\u6570\u5b66\u8981\u6c42\u8f83\u9ad8\uff0c\u4ee5\u7b14\u8005\u7684\u4e8c\u534a\u540a\u5b50\u6c34\u5e73\u4e0d\u8db3\u4ee5\u5b8c\u5168\u5e94\u4ed8\uff0c\u6240\u4ee5\uff0c\u6211\u5c31\u57f9\u517b\u4e0b\u611f\u6027\u8ba4\u8bc6\u5427\u3002 \u4ee5\u4e0b\u5185\u5bb9\u6765\u81ea \u54115\u5c81\u5b69\u5b50\u89e3\u91caSVM \uff1a \u684c\u5b50\u4e0a\u6709\u4e24\u79cd\u989c\u8272\u7684\u7403\uff0c ```{image} ../images/svm1.png :align: center 1 2 3 4 \u6211\u4eec\u9700\u8981\u5728\u4e2d\u95f4\u6446\u4e00\u6839\u68cd\u5b50\u628a\u5b83\u4eec\u5206\u5f00\uff0c ```{image} ../images/svm2.png :align: center \u5b8c\u7f8e\uff0c\u90a3\u4e48\u518d\u52a0\u70b9\u7403\uff0c\u53d1\u73b0\u518d\u627e\u5230\u4e00\u4e2a\u5408\u9002\u4f4d\u7f6e\u7684\u8bdd\u6bd4\u8f83\u96be\u4e86\uff08\u4f46\u4ecd\u7136\u53ef\u4ee5\u627e\u5230\uff09\uff0c ```{image} ../images/svm3.png :align: center 1 2 3 4 SVM\u5c31\u662f\u8bd5\u56fe\u628a\u68cd\u653e\u5728\u6700\u4f73\u4f4d\u7f6e\uff0c\u597d\u8ba9\u5728\u68cd\u7684\u4e24\u8fb9\u6709\u5c3d\u53ef\u80fd\u5927\u7684\u95f4\u9699\uff0c ```{image} ../images/svm4.png :align: center \u8fd9\u6839\u68cd\u4ecd\u7136\u53ef\u4ee5\u5206\u5f00\u5b83\u4eec\uff0c ```{image} ../images/svm5.png :align: center 1 2 3 4 \u5982\u679c\uff0c\u8fd9\u6837\u6446\u5462\uff1f ```{image} ../images/svm6.png :align: center \u4f60\u6012\u62cd\u684c\u5b50\uff0c\u5c06\u7403\u9ad8\u9ad8\u5f39\u8d77\uff0c\u7136\u540e\u5411\u5fcd\u7740\u6c34\u679c\u90a3\u6837\u5728\u7a7a\u4e2d\u5212\u8fc7\u7b14\u76f4\u7684\u4e00\u5200\u3002\u5c31\u8fd9\u6837\u5206\u5f00\u4e86\u3002 ```{image} ../images/svm7.png :align: center 1 2 3 4 \u90a3\u4e00\u77ac\uff0c\u7403\u5728\u53e6\u4e00\u4e2a\u7ef4\u5ea6\u88ab\u5b8c\u7f8e\u5206\u5f00\u4e86\uff0c\u50cf\u8fd9\u6837\u3002 ```{image} ../images/svm8.png :align: center \u518d\u4e4b\u540e\u65e0\u804a\u7684\u5927\u4eba\u4eec\uff0c\u628a\u8fd9\u4e9b\u7403\u53eb\u505a data\uff0c\u628a\u68cd\u5b50 \u53eb\u505a classifier, \u6700\u5927\u95f4\u9699\u7684\u628a\u620f\u53eb\u505aoptimization\uff0c \u62cd\u684c\u5b50\u53eb\u505akernelling, \u90a3\u5f20\u7eb8\u53eb\u505ahyperplane\u3002 \u4ee52\u7ef4\u6570\u636e\u4e3a\u4f8b\uff0c\u5373\u5e73\u9762\u4e0a\u7684\u70b9\uff0c\u53ef\u4ee5\u7528\u76f4\u7ebf\u5206\u5272\uff0c\u4e00\u822c\u5f62\u5f0f\u4e3ay=ax+b\uff0c\u5982\u679c\u4e0d\u53ef\u5206\u5272\uff0c\u6211\u4eec\u5c31\u5c06\u5176\u63d0\u9ad8\u4e00\u4e2a\u7ef4\u5ea6\uff0c\u5206\u5272\u7ebf\u53d8\u6210\u4e86\u5206\u5272\u9762\uff08\u8d85\u5e73\u9762\uff09\uff0c\u5199\u4f5c\uff1a \\[ |w^T A+b| \\] \u795e\u7ecf\u7f51\u7edc\uff08\u6df1\u5ea6\u5b66\u4e60\uff09 \u5f3a\u5316\u5b66\u4e60 AdaBoost 2.3 \u65e0\u76d1\u7763\u5b66\u4e60 K-\u5747\u503c\u805a\u7c7b Apriori\u5173\u8054\u5206\u6790 FP-growth\u53d1\u73b0\u9ad8\u9891\u9879 2.4 \u6570\u636e\u53ef\u89c6\u5316 \u6570\u636e\u7edf\u8ba1 Pandas Gephi python-graphviz python-matplotlib Echarts plotnine seaborn \u5730\u7406\u4f4d\u7f6e\u8868\u793a \u767e\u5ea6\u5730\u56feAPI MaxMind GeoIP Microsoft Excel 2013 PowerView\u4f7f\u7528\u793a\u4f8b Kartograph 2.5 \u5b66\u4e60\u5de5\u5177 Online GUI Weka 1 brew cask install weka MOA Orange 1 pip3 install orange KNIME 1 pip3 install knime Library Spark MLlib SciKit NLTK pybrain tensorflow pytorch caffe libsvm numpy matplotlib scratch 2.6 \u663e\u5361\u7684\u529b\u91cf \\[ \\operatorname{ker} f=\\{g\\in G:f(g)=e_{H}\\}{\\mbox{.}} \\]","title":"\u7b2c\u4e8c\u7ae0 \u673a\u5668\u5b66\u4e60\u57fa\u7840"},{"location":"datanote/ch02/#_1","text":"","title":"\u7b2c\u4e8c\u7ae0 \u673a\u5668\u5b66\u4e60\u57fa\u7840"},{"location":"datanote/ch02/#21-numpy","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 import numpy as np a = np . arange ( 1 , 5 ) data_type = [( 'name' , 'S10' ), ( 'height' , 'float' ), ( 'age' , int )] values = [( 'Arthur' , 1.8 , 41 ), ( 'Lancelot' , 1.9 , 38 ), ( 'Galahad' , 1.7 , 38 )] b = np . array ( values , dtype = data_type ) c = np . arange ( 6 , 10 ) # \u7b26\u53f7 np . sign ( a ) # \u6570\u7ec4\u6700\u5927\u503c a . max () # \u6570\u7ec4\u6700\u5c0f\u503c a . max () # \u533a\u95f4\u5cf0\u5cf0\u503c a . ptp () # \u4e58\u79ef a . prod () # \u7d2f\u79ef a . cumprod () # \u5e73\u5747\u503c a . mean () # \u4e2d\u503c a . median () # \u5dee\u5206 np . diff ( a ) # \u65b9\u5dee np . var ( a ) # \u5143\u7d20\u6761\u4ef6\u67e5\u627e\uff0c\u8fd4\u56deindex\u7684array np . where ( a > 2 ) # \u8fd4\u56de\u7b2c2\uff0c3\uff0c5\u4e2a\u5143\u7d20\u7684array np . take ( a , np . array ( 1 , 2 , 4 )) # \u6392\u5e8f np . msort ( a ) np . sort ( b , kind = 'mergesort' , order = 'height' ) # \u5747\u5206\uff0c\u5947\u6570\u4e2a\u5143\u7d20\u7684array\u4e0d\u53ef\u5206\u5272\u4e3a\u5076\u6570\u3002 np . split ( b , 2 ) # \u521b\u5efa\u5355\u4f4d\u77e9\u9635 np . eye ( 3 ) # \u6700\u5c0f\u4e8c\u4e58\uff0c\u53c2\u6570\u4e3a[x,y,degree]\uff0cdegree\u4e3a\u591a\u9879\u5f0f\u7684\u6700\u9ad8\u6b21\u5e42\uff0c\u8fd4\u56de\u503c\u4e3a\u6240\u6709\u6b21\u5e42\u7684\u7cfb\u6570 np . polyfit ( a , c , 1 )","title":"2.1 numpy \u5feb\u67e5"},{"location":"datanote/ch02/#22","text":"","title":"2.2 \u76d1\u7763\u5b66\u4e60"},{"location":"datanote/ch02/#_2","text":"\u4fe1\u606f\u7684\u4e0d\u7a33\u5b9a\u6027\u4e3a\u71b5\uff08entropy\uff09\uff0c\u800c\u4fe1\u606f\u589e\u76ca\u4e3a\u6709\u65e0\u6837\u672c\u7279\u5f81\u5bf9\u5206\u7c7b\u95ee\u9898\u5f71\u54cd\u7684\u5927\u5c0f\u3002\u6bd4\u5982\uff0c\u629b\u786c\u5e01\u6b63\u53cd\u4e24\u9762\u5404\u670950%\u6982\u7387\uff0c\u6b64\u65f6\u4e0d\u7a33\u5b9a\u6027\u6700\u5927\uff0c\u71b5\u4e3a1\uff1b\u592a\u9633\u660e\u5929\u7167\u5e38\u5347\u8d77\uff0c\u5219\u662f\u5fc5\u7136\uff0c\u6b64\u4e8b\u4e0d\u7a33\u5b9a\u6027\u6700\u5c0f\uff0c\u71b5\u4e3a0\u3002 \u5047\u8bbe\u4e8b\u4ef6X\uff0c\u53d1\u751f\u6982\u7387\u4e3ax\uff0c\u5176\u4fe1\u606f\u671f\u671b\u503c\u5b9a\u4e49\u4e3a\uff1a \\[ l(X) = -log_2 x \\] \u6574\u4e2a\u4fe1\u606f\u7684\u71b5\u4e3a\uff1a \\[ H = -\\sum^n_{i=1} log_2 x \\] \u5982\u4f55\u627e\u5230\u6700\u597d\u7684\u5206\u7c7b\u7279\u5f81\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 def chooseBestFeatureToSplit ( dataSet ): numFeatures = len ( dataSet [ 0 ]) - 1 #the last column is used for the labels baseEntropy = calcShannonEnt ( dataSet ) bestInfoGain = 0.0 ; bestFeature = - 1 for i in range ( numFeatures ): #iterate over all the features featList = [ example [ i ] for example in dataSet ] #create a list of all the examples of this feature uniqueVals = set ( featList ) #get a set of unique values newEntropy = 0.0 for value in uniqueVals : subDataSet = splitDataSet ( dataSet , i , value ) prob = len ( subDataSet ) / float ( len ( dataSet )) newEntropy += prob * calcShannonEnt ( subDataSet ) infoGain = baseEntropy - newEntropy #calculate the info gain; ie reduction in entropy if ( infoGain > bestInfoGain ): #compare this to the best gain so far bestInfoGain = infoGain #if better than current best, set to best bestFeature = i return bestFeature #returns an integer \u5176\u4e2d \uff0c dataSet\u4e3a\u6240\u6709\u7279\u5f81\u5411\u91cf \uff0c caclShannonEnt () \u8ba1\u7b97\u7279\u5f81\u5411\u91cf\u7684\u71b5 \uff0c splitDataSet () \u5207\u9664\u5411\u91cf\u4e2d\u7684value\u5217 \uff1b infoGain\u5373\u4e3a\u4fe1\u606f\u589e\u76ca \uff0c chooseBestFeatureToSplit\u8fd4\u56de\u6700\u597d\u7684\u7279\u5f81\u5411\u91cf\u7d22\u5f15\u503c \u3002","title":"\u4fe1\u606f\u5206\u7c7b\u57fa\u7840"},{"location":"datanote/ch02/#k","text":"kNN\u7684\u7b97\u6cd5\u6a21\u578b\u5982\u4e0b\uff1a \u5bf9\u4e8e\u672a\u77e5\u7c7b\u522b\u5c5e\u6027\u7684\u6570\u636e\u4e14\u96c6\u4e2d\u7684\u6bcf\u4e2a\u70b9\u4f9d\u6b21\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u8ba1\u7b97\u5df2\u77e5\u7c7b\u522b\u6570\u636e\u96c6\u4e2d\u7684\u70b9\u4e0e\u5f53\u524d\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb \u6309\u7167\u8ddd\u79bb\u9012\u589e\u4f9d\u6b21\u6392\u5e8f \u9009\u53d6\u4e0e\u5f53\u524d\u70b9\u8ddd\u79bb\u6700\u5c0f\u7684k\u4e2a\u70b9 \u786e\u5b9a\u524dk\u4e2a\u70b9\u6240\u5728\u7c7b\u522b\u7684\u51fa\u73b0\u9891\u7387 \u8fd4\u56de\u524dk\u4e2a\u70b9\u51fa\u73b0\u9891\u7387\u6700\u9ad8\u7684\u7c7b\u522b\u4f5c\u4e3a\u5f53\u524d\u70b9\u7684\u9884\u6d4b\u5206\u7c7b \u4ee3\u7801\u53c2\u8003\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 def classify0 ( inX , dataSet , labels , k ): dataSetSize = dataSet . shape [ 0 ] diffMat = tile ( inX , ( dataSetSize , 1 )) - dataSet sqDiffMat = diffMat ** 2 sqDistances = sqDiffMat . sum ( axis = 1 ) distances = sqDistances ** 0.5 sortedDistIndicies = distances . argsort () classCount = {} for i in range ( k ): voteIlabel = labels [ sortedDistIndicies [ i ]] classCount [ voteIlabel ] = classCount . get ( voteIlabel , 0 ) + 1 sortedClassCount = sorted ( classCount . iteritems (), key = operator . itemgetter ( 1 ), reverse = True ) return sortedClassCount [ 0 ][ 0 ] \u5176\u4e2d \uff0c inX\u4e3a\u8f93\u5165\u5411\u91cf \uff0c dataSet\u4e3a\u6570\u636e\u96c6 \uff0c labels\u4e3a\u6570\u636e\u96c6\u7684\u5206\u7c7b \uff0c \u53ef\u8c03 \u3002 \u8ddd\u79bb\u8ba1\u7b97\u516c\u5f0f\u4e3ad0 = (( x - x0 ) ** 2 + ( y - y0 ) ** 2 ) ** 0.5 \u3002 \u6b64\u79cd\u7b97\u6cd5\u7684\u4f18\u70b9\u4e3a\u7cbe\u5ea6\u9ad8\u3001\u5bf9\u5f02\u5e38\u503c\u4e0d\u654f\u611f\u3001\u4f46\u7f3a\u70b9\u4e5f\u6bd4\u8f83\u660e\u663e\uff0c\u5373\u6570\u636e\u91cf\u5927\u65f6\u5f00\u652f\u76f8\u5bf9\u8f83\u5927\uff0c\u9002\u7528\u4e8e\u6570\u503c\uff0d\u6807\u79f0\u578b\u6570\u636e\u3002","title":"K\u90bb\u8fd1\u7b97\u6cd5"},{"location":"datanote/ch02/#_3","text":"\u51b3\u7b56\u6811\u5373\u5217\u51fa\u4e00\u7cfb\u5217\u9009\u62e9\uff0c\u6839\u636e\u8bad\u7ec3\u96c6\u4e2d\u7684\u5927\u91cf\u5f62\u4f3c\uff08A\u3001B\u3001C\uff09\u4ee5\u53ca\u7ed3\u679cD\u7684\u5411\u91cf\u6765\u9884\u6d4b\u65b0\u8f93\u5165\uff08A'\u3001B'\u3001C'\uff09\u7684\u7ed3\u679cD'\u3002 \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u51b3\u7b56\u6811\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 def createTree ( dataSet , labels ): classList = [ example [ - 1 ] for example in dataSet ] if classList . count ( classList [ 0 ]) == len ( classList ): return classList [ 0 ] #stop splitting when all of the classes are equal if len ( dataSet [ 0 ]) == 1 : #stop splitting when there are no more features in dataSet return majorityCnt ( classList ) bestFeat = chooseBestFeatureToSplit ( dataSet ) bestFeatLabel = labels [ bestFeat ] myTree = { bestFeatLabel :{}} del ( labels [ bestFeat ]) featValues = [ example [ bestFeat ] for example in dataSet ] uniqueVals = set ( featValues ) for value in uniqueVals : subLabels = labels [:] #copy all of labels, so trees don't mess up existing labels myTree [ bestFeatLabel ][ value ] = createTree ( splitDataSet ( dataSet , bestFeat , value ), subLabels ) return myTree \u627e\u5230\u5f71\u54cd\u6700\u5927\u7684\u7279\u5f81bestFeat\u540e \uff0c \u518d\u521b\u5efa\u6b64\u7279\u5f81\u4e0b\u7684\u5206\u7c7b\u5411\u91cf\u521b\u5efa\u5b50\u6811\u5411\u91cf \uff0c \u7136\u540e\u5c06bestFeat\u5206\u79bb\u540e\u7ee7\u7eed\u8fed\u4ee3 \uff0c \u76f4\u81f3\u6240\u6709\u7279\u5f81\u90fd\u8f6c\u6362\u6210\u51b3\u7b56\u8282\u70b9 \u3002 \u539f\u59cb\u6570\u636e\u6bd4\u5982 \uff1a no - surfacing flippers fish 1 yes yes yes 2 yes yes yes 3 yes no no 4 no yes no 5 no yes no \u4f1a\u751f\u6210\u5982\u4e0b\u51b3\u7b56\u6811 \uff1a no - surfacing ? / \\ no / \\ yes fish ( no ) flippers ? / \\ no / \\ yes fish ( no ) fish ( yes ) \u8868\u793a\u6210JSON\u683c\u5f0f \uff0c \u5373python\u5b57\u5178 \uff1a { 'no surfacing' :{ 0 : 'no' , 1 :{ 'flippers' :{ 0 : 'no' , 1 : 'yes' }}} \u6784\u5efa\u51b3\u7b56\u6811\u7684\u65b9\u6cd5\u6bd4\u8f83\u591a \uff0c \u4e5f\u53ef\u4f7f\u7528C4 . 5 \u548cCART\u7b97\u6cd5 \u3002 \u63a5\u4e0b\u6765\u4f7f\u7528\u51b3\u7b56\u6811\u8fdb\u884c\u5206\u7c7b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 def classify ( inputTree , featLabels , testVec ): firstStr = inputTree . keys ()[ 0 ] secondDict = inputTree [ firstStr ] featIndex = featLabels . index ( firstStr ) key = testVec [ featIndex ] valueOfFeat = secondDict [ key ] if isinstance ( valueOfFeat , dict ): classLabel = classify ( valueOfFeat , featLabels , testVec ) else : classLabel = valueOfFeat return classLabel \u5176\u4e2d \uff0c featLabels\u4e3a\u6d4b\u8bd5\u7684\u5224\u65ad\u8282\u70b9 \uff0c \u5373\u7279\u5f81 \uff0c testVec\u4e3a\u5176\u503c \uff0c \u6bd4\u5982classify [ myTree , \"['no-surfacing','flippers']\" ,:[ 1 , 1 ] \"]\uff0c\u5982\u6b64\u7ed3\u679c\u4fbf\u4e3a'no'\u3002 \u4f7f\u7528pickle\u5bf9\u51b3\u7b56\u6811\u8fdb\u884c\u5e8f\u5217\u5316\u5b58\u50a8\uff1a 1 2 3 4 5 6 7 def storeTree ( inputTree , filename ): import pickle fw = open ( filename , 'w' ) pickle . dump ( inputTree , fw ) fw . close () \u5176\u4e2d \uff0c dump\u53ef\u9009\u534f\u8bae\u4e3a0 \uff08 ASCII \uff09\uff0c 1 \uff08 BINARY \uff09\uff0c \u9ed8\u8ba4\u4e3a0 \uff1b \u8bfb\u53d6\u65f6\u4f7f\u7528pickle . load \uff1b \u540c\u6837\u53ef\u4f7f\u7528dumps \uff0c loads\u76f4\u63a5\u5bf9\u5b57\u7b26\u53d8\u91cf\u8fdb\u884c\u64cd\u4f5c \u3002 \u6b64\u79cd\u7b97\u6cd5\u8ba1\u7b97\u590d\u6742\u5ea6\u4e0d\u9ad8\uff0c\u5bf9\u4e2d\u95f4\u503c\u7f3a\u5931\u4e0d\u654f\u611f\uff0c\u4f46\u53ef\u80fd\u4f1a\u4ea7\u751f\u8fc7\u62df\u5408\u7684\u95ee\u9898\u3002","title":"\u51b3\u7b56\u6811"},{"location":"datanote/ch02/#_4","text":"\u8d1d\u53f6\u65af\u6a21\u578b\u662f\u57fa\u4e8e\u72ec\u7acb\u6982\u7387\u7edf\u8ba1\u7684\uff0c\u601d\u60f3\u53ef\u4ee5\u8fd9\u4e48\u8bf4\uff1a \u603b\u51717\u4e2a\u77f3\u5b50\u5728A\u3001B\u4e24\u4e2a\u6876\u4e2d\uff0cA\u6876\u4e2d\u67092\u9ed12\u767d\uff0cB\u6876\u4e2d\u67092\u9ed11\u767d\u3002\u5df2\u77e5\u6761\u4ef6\u4e3a\u77f3\u5b50\u6765\u81eaB\u6876\uff0c\u90a3\u4e48\u5b83\u662f\u767d\u8272\u77f3\u5b50\u7684\u6982\u7387\u53ef\u8868\u793a\u4e3a\uff1a 1 P(white|B)=P(B|white)P(white)/P(B) \u63a5\u4e0b\u6765\uff0c\u5b9a\u4e49\u4e24\u4e2a\u4e8b\u4ef6A\u3001B\uff0cP(A|B)\u4e0eP(B|A)\u76f8\u4e92\u8f6c\u5316\u7684\u8fc7\u7a0b\u5373\u4e3a\uff1a 1 P(B|A)=P(A|B)P(B)/P(A) \u800c\u6734\u7d20\u8d1d\u53f6\u65af\u53ef\u4ee5\u8fd9\u6837\u63cf\u8ff0\uff1a Note \u8bbex={a1,a2,...,am}\u4e3a\u5f85\u5206\u7c7b\u9879\uff0ca\u4e3ax\u7684\u7279\u5f81\u5c5e\u6027\uff0c\u7c7b\u522b\u96c6\u5408\u4e3aC={y1,y2,...,ym}\uff0c\u5982\u679cP(yk|x)=max(P(y1|x),P(y2|x),...,P(yn|x))\uff0c\u5219x\u5c5e\u4e8eyk\u3002 \u6574\u4e2a\u7b97\u6cd5\u6838\u5fc3\u5373\u662f\u7b49\u5f0fP(yi|x)=P(x|yi)P(yi)/P(x)\u3002 \u9996\u5148\u6784\u5efa\u4e00\u4e2a\u5206\u7c7b\u8bad\u7ec3\u51fd\u6570\uff08\u4e8c\u5143\u5206\u7c7b\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 def trainNB0 ( trainMatrix , trainCategory ): numTrainDocs = len ( trainMatrix ) numWords = len ( trainMatrix [ 0 ]) pBad = sum ( trainCategory ) / float ( numTrainDocs ) p0Num = ones ( numWords ); p1Num = ones ( numWords ) #change to ones() p0Denom = 2.0 ; p1Denom = 2.0 #change to 2.0 for i in range ( numTrainDocs ): if trainCategory [ i ] == 1 : p1Num += trainMatrix [ i ] p1Denom += sum ( trainMatrix [ i ]) else : p0Num += trainMatrix [ i ] p0Denom += sum ( trainMatrix [ i ]) p1Vect = log ( p1Num / p1Denom ) #change to log() p0Vect = log ( p0Num / p0Denom ) #change to log() return p0Vect , p1Vect , pBad \u5176\u4e2d \uff0c trainMatrix\u4e3a\u6240\u6709\u8bad\u7ec3\u96c6\u4e2d\u7684\u5e03\u5c14\u5411\u91cf \uff0c \u6bd4\u5982\u4e24\u672c\u4e66A \u3001 B \uff0c \u5176\u4e2dA\u6709\u4e24\u4e2a\u5355\u8bcdx \u3001 y \uff0c B\u6709\u4e24\u4e2a\u5355\u8bcdx \u3001 z \uff0c \u5e76\u4e14A\u662f\u597d\u4e66 \uff08 \u503c\u8ba1\u4e3a0 \uff09\uff0c B\u662f\u70c2\u4e66 \uff08 \u503c\u8ba1\u4e3a0 \uff09\uff0c \u628a\u6240\u6709\u5355\u8bcd\u8fdb\u884c\u6392\u5e8f\u540e\u5f97\u5411\u91cf [ 'x' , 'y' , 'z' ] \uff0c \u5219A\u7684Matrix\u53ef\u8868\u793a\u4e3a [ 1 , 1 , 0 ] \uff0c B\u7684\u4e3a [ 1 , 0 , 1 ] \uff0c \u6240\u4ee5\u6b64\u51fd\u6570\u4e2d\u7684trainMatrix\u5373 [[ 1 , 1 , 0 ],[ 1 , 0 , 1 ]] \uff0c trainCategory\u4e3a [ 0 , 1 ] \u3002 \u51fd\u6570\u8fd4\u56de\u7684\u4e3a\u6982\u7387\u96c6\u7684\u5411\u91cf \u3002 \u5206\u7c7b\u51fd\u6570\uff1a 1 2 3 4 5 6 7 8 9 def classifyNB ( vec2Classify , p0Vec , p1Vec , pClass1 ): p1 = sum ( vec2Classify * p1Vec ) + log ( pClass1 ) #element-wise mult p0 = sum ( vec2Classify * p0Vec ) + log ( 1.0 - pClass1 ) if p1 > p0 : return 1 else : return 0 vec2Classify\u5373\u4e3a\u8981\u5206\u7c7b\u7684\u5411\u91cf \uff0c \u5f62\u5982trainMatrix \uff0c \u968f\u540e\u7684\u4e09\u4e2a\u53c2\u6570\u4e3atrainNB0\u6240\u8fd4\u56de \u3002 p1 \u3001 p0\u53ef\u4ee5\u7406\u89e3\u4e3a\u671f\u671b\u6982\u7387\u503c \uff0c \u6bd4\u8f83\u4e24\u8005\u5927\u5c0f\u5373\u53ef\u5212\u5206 \u3002 \u6d4b\u8bd5\u7528\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 def testingNB (): listOPosts , listClasses = loadDataSet () myVocabList = createVocabList ( listOPosts ) trainMat = [] for postinDoc in listOPosts : trainMat . append ( setOfWords2Vec ( myVocabList , postinDoc )) p0V , p1V , pAb = trainNB0 ( array ( trainMat ), array ( listClasses )) testEntry = [ 'love' , 'my' , 'dalmation' ] thisDoc = array ( setOfWords2Vec ( myVocabList , testEntry )) print testEntry , 'classified as: ' , classifyNB ( thisDoc , p0V , p1V , pAb ) testEntry = [ 'stupid' , 'garbage' ] thisDoc = array ( setOfWords2Vec ( myVocabList , testEntry )) print testEntry , 'classified as: ' , classifyNB ( thisDoc , p0V , p1V , pAb ) \u6574\u4f53\u6765\u8bf4\uff0c\u6734\u7d20\u8d1d\u53f6\u65af\u5206\u7c7b\u65b9\u6cd5\u5728\u6570\u636e\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\u4ecd\u7136\u6709\u6548\uff0c\u4f46\u662f\u5bf9\u6570\u636e\u8f93\u5165\u6bd4\u8f83\u654f\u611f\u3002","title":"\u6734\u7d20\u8d1d\u53f6\u65af"},{"location":"datanote/ch02/#logistic","text":"\u5728\u7edf\u8ba1\u5b66\u4e2d\uff0c\u7ebf\u6027\u56de\u5f52\u662f\u5229\u7528\u79f0\u4e3a\u7ebf\u6027\u56de\u5f52\u65b9\u7a0b\u7684\u6700\u5c0f\u4e8c\u4e58\u51fd\u6570\u5bf9\u4e00\u4e2a\u6216\u591a\u4e2a\u81ea\u53d8\u91cf\u548c\u56e0\u53d8\u91cf\u4e4b\u95f4\u5173\u7cfb\u8fdb\u884c\u5efa\u6a21\u7684\u4e00\u79cd\u56de\u5f52\u5206\u6790\u3002\u8fd9\u79cd\u51fd\u6570\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u79f0\u4e3a\u56de\u5f52\u7cfb\u6570\u7684\u6a21\u578b\u53c2\u6570\u7684\u7ebf\u6027\u7ec4\u5408\u3002\u53ea\u6709\u4e00\u4e2a\u81ea\u53d8\u91cf\u7684\u60c5\u51b5\u79f0\u4e3a\u7b80\u5355\u56de\u5f52\uff0c\u5927\u4e8e\u4e00\u4e2a\u81ea\u53d8\u91cf\u60c5\u51b5\u7684\u53eb\u505a\u591a\u5143\u56de\u5f52\u3002\uff08 \u7ef4\u57fa\u767e\u79d1 \uff09 \u5148\u4ecb\u7ecd\u4e24\u4e2a\u91cd\u8981\u7684\u6570\u5b66\u6982\u5ff5\u3002 \u6700\u5c0f\u4e8c\u4e58\u6cd5\u5219 \u6700\u5c0f\u4e8c\u4e58\u6cd5\uff08\u53c8\u79f0\u6700\u5c0f\u5e73\u65b9\u6cd5\uff09\u662f\u4e00\u79cd\u6570\u5b66\u4f18\u5316\u6280\u672f\u3002\u5b83\u901a\u8fc7\u6700\u5c0f\u5316\u8bef\u5dee\u7684\u5e73\u65b9\u548c\u5bfb\u627e\u6570\u636e\u7684\u6700\u4f73\u51fd\u6570\u5339\u914d\u3002 \u5229\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u53ef\u4ee5\u7b80\u4fbf\u5730\u6c42\u5f97\u672a\u77e5\u7684\u6570\u636e\uff0c\u5e76\u4f7f\u5f97\u8fd9\u4e9b\u6c42\u5f97\u7684\u6570\u636e\u4e0e\u5b9e\u9645\u6570\u636e\u4e4b\u95f4\u8bef\u5dee\u7684\u5e73\u65b9\u548c\u4e3a\u6700\u5c0f\u3002 \u793a\u4f8b1 \u6709\u56db\u4e2a\u6570\u636e\u70b9(1,6)\u3001(2,5)\u3001(3,7)\u3001(4,10)\uff0c\u6211\u4eec\u5e0c\u671b\u627e\u5230\u4e00\u6761\u76f4\u7ebfy=a+bx\u4e0e\u8fd9\u56db\u4e2a\u70b9\u6700\u5339\u914d\u3002 \\[ a+1b=6 \\] \\[ a+2b=5 \\] \\[ a+3b=7 \\] \\[ a+4b=10 \\] \u91c7\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u4f7f\u7b49\u53f7\u4e24\u8fb9\u7684\u65b9\u5dee\u5c3d\u53ef\u80fd\u5c0f\uff0c\u4e5f\u5c31\u662f\u627e\u51fa\u8fd9\u4e2a\u51fd\u6570\u7684\u6700\u5c0f\u503c\uff1a \\[ S(a,b) = [6-(a+1b)]^2+[5-(a+2b)]^2+[7-(a+3b)]^2+[10-(a+4b)]^2 \\] \u7136\u540e\u5bf9S(a,b)\u6c42a,b\u7684\u504f\u5bfc\u6570\uff0c\u4f7f\u5176\u4e3a0\u5f97\u5230\uff1a \\[ \\cfrac{{\\partial}S}{{\\partial}a} = 0 = 8a+20b-56 \\] \\[ \\cfrac{{\\partial}S}{{\\partial}b} = 0 = 20a+60b-154 \\] \u8fd9\u6837\u5c31\u89e3\u51fa\uff1a \\[ a=3.5,b=1.4 \\] \u6240\u4ee5\u76f4\u7ebfy=3.5+1.4x\u662f\u6700\u4f73\u7684\u3002 \u51fd\u6570\u8868\u793a \\[ \\min_{\\vec{b}}{\\sum^n_{i=1}}(y_m-y_i)^2 \\] \u6b27\u51e0\u91cc\u5fb7\u8868\u793a \\[ \\min_{ \\vec{b} } \\| \\vec{y}_{m} ( \\vec{b} ) - \\vec{y} \\|_{2} \\] \u7ebf\u6027\u51fd\u6570\u6a21\u578b \u5178\u578b\u7684\u4e00\u7c7b\u51fd\u6570\u6a21\u578b\u662f\u7ebf\u6027\u51fd\u6570\u6a21\u578b\u3002\u6700\u7b80\u5355\u7684\u7ebf\u6027\u5f0f\u662f \\[ y = b_0 + b_1 t \\] \u5199\u6210\u77e9\u9635\u5f0f\uff0c\u4e3a \\[ \\min_{b_0,b_1}\\left\\|\\begin{pmatrix}1 & t_1 \\\\ \\vdots & \\vdots \\\\ 1 & t_n \\end{pmatrix}\\begin{pmatrix} b_0\\\\ b_1\\end{pmatrix} - \\begin{pmatrix} y_1 \\\\ \\vdots \\\\ y_{n}\\end{pmatrix}\\right\\|_{2} = \\min_b\\|Ab-Y\\|_2 \\] \u76f4\u63a5\u7ed9\u51fa\u8be5\u5f0f\u7684\u53c2\u6570\u89e3\uff1a \\[ b_1 = \\frac{\\sum_{i=1}^n t_iy_i - n \\cdot \\bar t \\bar y}{\\sum_{i=1}^n t_i^2- n \\cdot (\\bar t)^2} \\] \\[ b_0 = \\bar y - b_1 \\bar t \\] \u5176\u4e2d \\[ \\bar t = \\frac{1}{n} \\sum_{i=1}^n t_i \\] \u4e3at\u503c\u7684\u7b97\u672f\u5e73\u5747\u503c\u3002\u4e5f\u53ef\u89e3\u5f97\u5982\u4e0b\u5f62\u5f0f\uff1a \\[ b_1 = \\frac{\\sum_{i=1}^n (t_i - \\bar t)(y_i - \\bar y)}{\\sum_{i=1}^n (t_i - \\bar t)^2} \\] \u793a\u4f8b2 \u968f\u673a\u9009\u5b9a10\u8258\u6218\u8230\uff0c\u5e76\u5206\u6790\u5b83\u4eec\u7684\u957f\u5ea6\u4e0e\u5bbd\u5ea6\uff0c\u5bfb\u627e\u5b83\u4eec\u957f\u5ea6\u4e0e\u5bbd\u5ea6\u4e4b\u95f4\u7684\u5173\u7cfb\u3002\u7531\u4e0b\u9762\u7684\u63cf\u70b9\u56fe\u53ef\u4ee5\u76f4\u89c2\u5730\u770b\u51fa\uff0c\u4e00\u8258\u6218\u8230\u7684\u957f\u5ea6\uff08t\uff09\u4e0e\u5bbd\u5ea6\uff08y\uff09\u57fa\u672c\u5448\u7ebf\u6027\u5173\u7cfb\u3002\u6563\u70b9\u56fe\u5982\u4e0b\uff1a \u4ee5\u4e0b\u56fe\u8868\u5217\u51fa\u4e86\u5404\u6218\u8230\u7684\u6570\u636e\uff0c\u968f\u540e\u6b65\u9aa4\u662f\u91c7\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u786e\u5b9a\u4e24\u53d8\u91cf\u95f4\u7684\u7ebf\u6027\u5173\u7cfb\u3002 \u4eff\u7167\u4e0a\u9762\u7ed9\u51fa\u7684\u4f8b\u5b50 \\[ \\bar t = \\frac {\\sum_{i=1}^n t_i}{n} = \\frac {1678}{10} = 167{.}8 \\] \u5e76\u5f97\u5230\u76f8\u5e94\u7684 \\[ \\bar y = 18{.}41 \\] \u7136\u540e\u786e\u5b9ab1 \\[ b_1 = \\frac{\\sum_{i=1}^n (t_i- \\bar {t})(y_i - \\bar y)}{\\sum_{i=1}^n (t_i- \\bar t)^2} = \\frac{3287{.}820} {20391{.}60} = 0{.}1612 \\; \\] \u53ef\u4ee5\u770b\u51fa\uff0c\u6218\u8230\u7684\u957f\u5ea6\u6bcf\u53d8\u53161m\uff0c\u76f8\u5bf9\u5e94\u7684\u5bbd\u5ea6\u4fbf\u8981\u53d8\u531616cm\u3002\u5e76\u7531\u4e0b\u5f0f\u5f97\u5230\u5e38\u6570\u9879b0\uff1a \\[ b_0 = \\bar y - b_1 \\bar t = 18{.}41 - 0{.}1612 \\cdot 167{.}8 = -8{.}6394 \\] \u53ef\u4ee5\u770b\u51fa\u70b9\u7684\u62df\u5408\u975e\u5e38\u597d\uff0c\u957f\u5ea6\u548c\u5bbd\u5ea6\u7684\u76f8\u5173\u6027\u5927\u7ea6\u4e3a96.03\uff05\u3002 \u5229\u7528Matlab\u5f97\u5230\u62df\u5408\u76f4\u7ebf\uff1a Sigmoid\u51fd\u6570 Sigmoid\u51fd\u6570\u5177\u6709\u5355\u4f4d\u9636\u8dc3\u51fd\u6570\u7684\u6027\u8d28\uff0c\u516c\u5f0f\u8868\u793a\u4e3a\uff1a \\[ \\sigma (z)=\\cfrac{1}{1+e^{-z}} \\] ```{image} ../images/04-01.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 \u6211\u4eec\u5c06\u8f93\u5165\u8bb0\u4e3az\uff0c\u6709\u4e0b\u9762\u7684\u516c\u5f0f\u5f97\u51fa\uff1a $$ z=w_0 x_0 + w_1 x_1 + w_2 x_2 + \\dots + w_n x_n $$ \u4f7f\u7528\u5411\u91cf\u5199\u6cd5\uff1a $$ z=w^T x $$ \u5176\u4e2d\u5411\u91cfx\u662f\u5206\u7c7b\u5668\u7684\u8f93\u5165\u6570\u636e\uff0c\u5411\u91cfw\u5c31\u662f\u6211\u4eec\u8981\u627e\u5230\u7684\u6700\u4f73\u7cfb\u6570\u3002 *\u57fa\u4e8e\u4f18\u5316\u65b9\u6cd5\u786e\u5b9a\u56de\u5f52\u7cfb\u6570* **\u68af\u5ea6\u4e0a\u5347/\u4e0b\u964d\u6cd5** \u68af\u5ea6\u4e0a\u5347\u6cd5/\u4e0b\u964d\u6cd5\u7684\u601d\u60f3\u662f\uff1a\u8981\u627e\u5230\u51fd\u6570\u7684\u6700\u5927\u503c\uff0c\u6700\u597d\u7684\u65b9\u6cd5\u662f\u6cbf\u7740\u8be5\u51fd\u6570\u7684\u68af\u5ea6\u65b9\u5411\u63a2\u5bfb\uff0c\u51fd\u6570f(x,y)\u7684\u68af\u5ea6\u5982\u4e0b\u8868\u793a\uff1a $$ {\\nabla}f(x,y)=\\begin{pmatrix} \\cfrac{{\\partial}f(x,y)}{{\\partial}x} \\\\ \\cfrac{{\\partial}f(x,y)}{{\\partial}y}\\end{pmatrix} $$ \u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\u6b64\u7b97\u6cd5\uff1a > \u4ece\u524d\u6709\u4e00\u5ea7\u5c71\uff0c\u4e00\u4e2a\u61d2\u4eba\u8981\u722c\u5c71\uff0c\u4ed6\u4ece\u5c71\u811a\u4e0b\u7684\u4efb\u610f\u4f4d\u7f6e\u5411\u5c71\u9876\u51fa\u53d1\uff0c\u5e76\u4e14\u77e5\u9053\u7b49\u9ad8\u7ebf\u56fe\u7684\u6bcf\u4e2a\u73af\u4e0a\u90fd\u6709\u4e00\u4e2a\u5bbf\u8425\u70b9\uff0c\u4ed6\u5e0c\u671b\u5728\u8fd9\u4e9b\u5bbf\u8425\u70b9\u4e4b\u95f4\u4fee\u5efa\u4e00\u6761\u7b14\u76f4\u7684\u8def\uff0c\u5e76\u4e14\u8def\u5230\u4e24\u65c1\u7684\u5bbf\u8425\u70b9\u7684\u5782\u76f4\u8ddd\u79bb\u5dee\u7684\u5e73\u65b9\u548c\u5c3d\u53ef\u80fd\u5c0f\u3002\u6bcf\u5230\u4e00\u4e2a\u7b49\u9ad8\u7ebf\u5708\uff0c\u4ed6\u90fd\u4f1a\u6839\u636e\u4ed6\u5728\u4e0a\u4e00\u4e2a\u7b49\u9ad8\u7ebf\u7684\u8ddd\u79bb\u7684\u53d8\u5316\u91cf\u6765\u8c03\u8282\u4ed6\u7684\u5728\u7b49\u9ad8\u7ebf\u4e0a\u7684\u4f4d\u7f6e\uff0c\u4ece\u800c\u4f7f\u516c\u8def\u6ee1\u8db3\u8981\u6c42\u3002 > \u8fd4\u56de\u56de\u5f52\u7cfb\u6570\uff1a ```python def sigmoid(x): return 1.0/(1+math.exp(-x)) def gradAscent(dataMatIn, classLabels): dataMatrix = mat(dataMatIn) #convert to NumPy matrix labelMat = mat(classLabels).transpose() #convert to NumPy matrix m,n = shape(dataMatrix) alpha = 0.001 maxCycles = 500 weights = ones((n,1)) for k in range(maxCycles): #heavy on matrix operations h = sigmoid(dataMatrix*weights) #matrix mult error = (labelMat - h) #vector subtraction weights = weights + alpha * dataMatrix.transpose()* error #matrix mult return weights \u5176\u4e2d\uff0c\u8bef\u5dee\u503c\u4e58\u4ee5\u77e9\u9635\u7684\u8f6c\u79e9\u4ee3\u8868\u68af\u5ea6\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u8f7d\u5165\u6570\u636e\u96c6\u5c1d\u8bd5\u753b\u51fa\u6700\u4f73\u62df\u5408\u76f4\u7ebf\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import matplotlib.pyplot as plt def plotBestFit ( w ): weights = w . getA () # \u5c06\u77e9\u9635\u8f6c\u5316\u4e3a\u6570\u7ec4 dataMat , labelMat = loadDataSet () dataArr = array ( dataMat ) n = shape ( dataArr )[ 0 ] x1 = x2 = x3 = x4 = [] for i in range ( n ): if int ( labelMat [ i ] == 1 : x1 . append ( dataArr [ i , 1 ]); y1 . append ( dataArr [ i , 2 ]) else x2 . append ( dataArr [ i , 1 ]); y2 . append ( dataArr [ i , 2 ]) fig = plt . figure () ax = fig . add_subplot ( 111 ) ax . scatter ( x1 , y1 , s = 30 , c = 'red' , markers = 's' ) ax . scatter ( x2 , y2 , s = 30 , c = 'green' ) x = arrange ( - 3.0 , 3.0 , 0.1 ) y = ( - weight [ 0 ] - weights [ 1 ] * x ) / weights [ 2 ] ax . plot ( x , y ) plt . xlabel ( 'X1' ) plt . xlabel ( 'X2' ) plt . show () \u5982\u679c\u5904\u7406\u5927\u91cf\u6570\u636e\u96c6\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u6279\u91cf\u6570\u636e\u96c6\u4e2d\u7684\u5355\u4e2a\u6570\u636e\u70b9\u8fdb\u884c\u7cfb\u6570\u66f4\u65b0\uff0c\u6216\u8005\u4f7f\u7528\u968f\u673a\u6570\u636e\u96c6\u7684\u6570\u636e\u70b9\uff0c\u5206\u522b\u5982\u4e0b\u6240\u793a\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 def stocGradAscentBatch ( dataMatrix , classLabels ): m , n = shape ( dataMatrix ) alpha = 0.01 weights = ones ( n ) for i in range ( m ): h = sigmoid ( sum ( dataMatrix [ i ] * weights )) error = classLabels [ i ] - h weights = weights + alpha * error * dataMatrix [ i ] return weights def stocGradAscentRand ( dataMatrix , classLabels , numIter = 150 ) m , n = shape ( dataMatrix ) weights = ones ( n ) for j in range ( numIter ) dataIndex = range ( m ) for i in range ( m ): alpha = 4 / ( 1.0 + j + i ) + 0.01 # \u8c03\u6574 randIndex = int ( random . uniform ( 0 , len ( dataIndex ))) h = sigmoid ( sum ( dataMatrix [ randIndex ] * weights )) error = classLabels [ randIndex ] - h weights = weights + alpha * error * dataMatrix [ randIndex ] del ( dataIndex [ randIndex ]) # \u5220\u9664\u5df2\u9009\uff0c\u9632\u6b62\u91cd\u590d\u9009\u53d6","title":"Logistic\u56de\u5f52"},{"location":"datanote/ch02/#_5","text":"","title":"\u7ebf\u6027\u56de\u5f52"},{"location":"datanote/ch02/#_6","text":"","title":"\u6811\u56de\u5f52"},{"location":"datanote/ch02/#svm","text":"SVM\uff08Supprot Vector Machines\uff09\u5373\u652f\u6301\u5411\u91cf\u673a\uff0c\u5b8c\u5168\u7406\u89e3\u5176\u7406\u8bba\u77e5\u8bc6\u5bf9\u6570\u5b66\u8981\u6c42\u8f83\u9ad8\uff0c\u4ee5\u7b14\u8005\u7684\u4e8c\u534a\u540a\u5b50\u6c34\u5e73\u4e0d\u8db3\u4ee5\u5b8c\u5168\u5e94\u4ed8\uff0c\u6240\u4ee5\uff0c\u6211\u5c31\u57f9\u517b\u4e0b\u611f\u6027\u8ba4\u8bc6\u5427\u3002 \u4ee5\u4e0b\u5185\u5bb9\u6765\u81ea \u54115\u5c81\u5b69\u5b50\u89e3\u91caSVM \uff1a \u684c\u5b50\u4e0a\u6709\u4e24\u79cd\u989c\u8272\u7684\u7403\uff0c ```{image} ../images/svm1.png :align: center 1 2 3 4 \u6211\u4eec\u9700\u8981\u5728\u4e2d\u95f4\u6446\u4e00\u6839\u68cd\u5b50\u628a\u5b83\u4eec\u5206\u5f00\uff0c ```{image} ../images/svm2.png :align: center \u5b8c\u7f8e\uff0c\u90a3\u4e48\u518d\u52a0\u70b9\u7403\uff0c\u53d1\u73b0\u518d\u627e\u5230\u4e00\u4e2a\u5408\u9002\u4f4d\u7f6e\u7684\u8bdd\u6bd4\u8f83\u96be\u4e86\uff08\u4f46\u4ecd\u7136\u53ef\u4ee5\u627e\u5230\uff09\uff0c ```{image} ../images/svm3.png :align: center 1 2 3 4 SVM\u5c31\u662f\u8bd5\u56fe\u628a\u68cd\u653e\u5728\u6700\u4f73\u4f4d\u7f6e\uff0c\u597d\u8ba9\u5728\u68cd\u7684\u4e24\u8fb9\u6709\u5c3d\u53ef\u80fd\u5927\u7684\u95f4\u9699\uff0c ```{image} ../images/svm4.png :align: center \u8fd9\u6839\u68cd\u4ecd\u7136\u53ef\u4ee5\u5206\u5f00\u5b83\u4eec\uff0c ```{image} ../images/svm5.png :align: center 1 2 3 4 \u5982\u679c\uff0c\u8fd9\u6837\u6446\u5462\uff1f ```{image} ../images/svm6.png :align: center \u4f60\u6012\u62cd\u684c\u5b50\uff0c\u5c06\u7403\u9ad8\u9ad8\u5f39\u8d77\uff0c\u7136\u540e\u5411\u5fcd\u7740\u6c34\u679c\u90a3\u6837\u5728\u7a7a\u4e2d\u5212\u8fc7\u7b14\u76f4\u7684\u4e00\u5200\u3002\u5c31\u8fd9\u6837\u5206\u5f00\u4e86\u3002 ```{image} ../images/svm7.png :align: center 1 2 3 4 \u90a3\u4e00\u77ac\uff0c\u7403\u5728\u53e6\u4e00\u4e2a\u7ef4\u5ea6\u88ab\u5b8c\u7f8e\u5206\u5f00\u4e86\uff0c\u50cf\u8fd9\u6837\u3002 ```{image} ../images/svm8.png :align: center \u518d\u4e4b\u540e\u65e0\u804a\u7684\u5927\u4eba\u4eec\uff0c\u628a\u8fd9\u4e9b\u7403\u53eb\u505a data\uff0c\u628a\u68cd\u5b50 \u53eb\u505a classifier, \u6700\u5927\u95f4\u9699\u7684\u628a\u620f\u53eb\u505aoptimization\uff0c \u62cd\u684c\u5b50\u53eb\u505akernelling, \u90a3\u5f20\u7eb8\u53eb\u505ahyperplane\u3002 \u4ee52\u7ef4\u6570\u636e\u4e3a\u4f8b\uff0c\u5373\u5e73\u9762\u4e0a\u7684\u70b9\uff0c\u53ef\u4ee5\u7528\u76f4\u7ebf\u5206\u5272\uff0c\u4e00\u822c\u5f62\u5f0f\u4e3ay=ax+b\uff0c\u5982\u679c\u4e0d\u53ef\u5206\u5272\uff0c\u6211\u4eec\u5c31\u5c06\u5176\u63d0\u9ad8\u4e00\u4e2a\u7ef4\u5ea6\uff0c\u5206\u5272\u7ebf\u53d8\u6210\u4e86\u5206\u5272\u9762\uff08\u8d85\u5e73\u9762\uff09\uff0c\u5199\u4f5c\uff1a \\[ |w^T A+b| \\]","title":"SVM"},{"location":"datanote/ch02/#_7","text":"","title":"\u795e\u7ecf\u7f51\u7edc\uff08\u6df1\u5ea6\u5b66\u4e60\uff09"},{"location":"datanote/ch02/#_8","text":"","title":"\u5f3a\u5316\u5b66\u4e60"},{"location":"datanote/ch02/#adaboost","text":"","title":"AdaBoost"},{"location":"datanote/ch02/#23","text":"","title":"2.3 \u65e0\u76d1\u7763\u5b66\u4e60"},{"location":"datanote/ch02/#k-","text":"","title":"K-\u5747\u503c\u805a\u7c7b"},{"location":"datanote/ch02/#apriori","text":"","title":"Apriori\u5173\u8054\u5206\u6790"},{"location":"datanote/ch02/#fp-growth","text":"","title":"FP-growth\u53d1\u73b0\u9ad8\u9891\u9879"},{"location":"datanote/ch02/#24","text":"","title":"2.4 \u6570\u636e\u53ef\u89c6\u5316"},{"location":"datanote/ch02/#_9","text":"Pandas Gephi python-graphviz python-matplotlib Echarts plotnine seaborn","title":"\u6570\u636e\u7edf\u8ba1"},{"location":"datanote/ch02/#_10","text":"\u767e\u5ea6\u5730\u56feAPI MaxMind GeoIP Microsoft Excel 2013 PowerView\u4f7f\u7528\u793a\u4f8b Kartograph","title":"\u5730\u7406\u4f4d\u7f6e\u8868\u793a"},{"location":"datanote/ch02/#25","text":"","title":"2.5 \u5b66\u4e60\u5de5\u5177"},{"location":"datanote/ch02/#online","text":"","title":"Online"},{"location":"datanote/ch02/#gui","text":"Weka 1 brew cask install weka MOA Orange 1 pip3 install orange KNIME 1 pip3 install knime","title":"GUI"},{"location":"datanote/ch02/#library","text":"Spark MLlib SciKit NLTK pybrain tensorflow pytorch caffe libsvm numpy matplotlib scratch","title":"Library"},{"location":"datanote/ch02/#26","text":"\\[ \\operatorname{ker} f=\\{g\\in G:f(g)=e_{H}\\}{\\mbox{.}} \\]","title":"2.6 \u663e\u5361\u7684\u529b\u91cf"},{"location":"datanote/ch03/","text":"\u7b2c\u4e09\u7ae0 ABM\u5efa\u6a21\u57fa\u7840 ABM\u91ca\u4e49 ABM(Agent Based Modeling)\u4e0eEBM(Equation Based Modeling)\u8fd9\u4e24\u79cd\u5efa\u6a21\u65b9\u5f0f\u53d7\u4e0d\u540c\u7684\u4eba\u7fa4\u4e0e\u573a\u666f\u6b22\u8fce\u3002\u6bd4\u5982\u5728\u7ecf\u6d4e\u5b66\u7814\u7a76\u4e2d\uff0c\u65e9\u671fEBM\u4e3a\u4e3b\uff0c\u968f\u7740ABM\u7684\u6d41\u884c\u6709\u90e8\u5206\u4eba\u5219\u5c1d\u8bd5\u4f7f\u7528\u5b83\uff0c\u4f46\u4e0d\u662f\u8bf4\u6709\u5b83\u5c31\u8db3\u591f\u4e86\u3002\u300aABM in Economy\u300b\u8fd9\u672c\u4e66\u505a\u4e86\u4e00\u4e2a\u5f88\u597d\u7684\u793a\u4f8b\uff0cABM\u7ed3\u5408EBM\u53bb\u7814\u7a76\u6a21\u578b\uff0c\u5373EBM\u4f5c\u4e3aABM\u7684\u7406\u8bba\u652f\u6491\uff0c\u4f7f\u7528ABM\u4e88\u4ee5\u8868\u73b0\u6a21\u578b\uff0c\u4ece\u800c\u5229\u4e8e\u89e3\u91ca\u4e0e\u9884\u6d4b\u4e00\u4e2a\u73b0\u8c61\u6216\u8005\u6a21\u578b\u3002 3.1 \u5efa\u6a21\u7684\u79cd\u7c7b Agent Based Modeling\u7684\u5386\u53f2\u4e25\u683c\u6765\u8bf4\u5e76\u4e0d\u7b97\u592a\u4e45\uff0c\u5f88\u591a\u8bba\u6587\u4e2d\u6211\u4eec\u90fd\u53ef\u4ee5\u770b\u5230\u5b83\u662f\u8fd1\u51e0\u5341\u5e74\u624d\u6210\u578b\u7684\u5efa\u6a21\u65b9\u6cd5\u3002 3.2 \u7ecf\u6d4e\u5b66JEL\u5206\u7c7b https://www.aeaweb.org/econlit/jelCodes.php?view=jel 3.3 \u5efa\u6a21\u65b9\u6cd5 3.3.1. ABM\u5efa\u6a21 3.3.2. EBM\u5efa\u6a21 EBM\u4e0d\u662f\u8fd9\u672c\u4e66\u7684\u91cd\u70b9\uff0c\u4f46\u5e76\u4e0d\u662f\u8bf4\u5b83\u4e0d\u91cd\u8981\uff0c\u56e0\u4e3a\u5df2\u7ecf\u6709\u5f88\u591a\u4e66\u53bb\u4ecb\u7ecd\u4e86\uff0c\u8fd9\u91cc\u4ec5\u4ec5 3.4 \u5efa\u6a21\u601d\u8003 \u5904\u7406\u95ee\u9898\u7684\u65b9\u6cd5\u3002 3.5 \u6a21\u578b\u6536\u96c6 Auction Auction theory is an applied branch of economics which deals with how people act in auction markets and researches the properties of auction markets. There are many possible designs (or sets of rules) for an auction and typical issues studied by auction theorists include the efficiency of a given auction design, optimal and equilibrium bidding strategies, and revenue comparison. Auction theory is also used as a tool to inform the design of real-world auctions; most notably auctions for the privatization of public-sector companies or the sale of licenses for use of the electromagnetic spectrum. General idea Auctions are characterized as transactions with a specific set of rules detailing resource allocation according to participants' bids. They are categorized as games with incomplete information because in the vast majority of auctions, one party will possess information related to the transaction that the other party does not (e.g., the bidders usually know their personal valuation of the item, which is unknown to the other bidders and the seller).[1] Auctions take many forms, but they share the characteristic that they are universal and can be used to sell or buy any item. In many cases, the outcome of the auction does not depend on the identity of the bidders (i.e., auctions are anonymous). Most auctions have the feature that participants submit bids, amounts of money they are willing to pay. Standard auctions require that the winner of the auction is the participant with the highest bid. A nonstandard auction does not require this (e.g., a lottery). Types of auction Main article: Auction \u00a7 Types There are traditionally four types of auction that are used for the allocation of a single item: First-price sealed-bid auctions in which bidders place their bid in a sealed envelope and simultaneously hand them to the auctioneer. The envelopes are opened and the individual with the highest bid wins, paying the amount bid. Second-price sealed-bid auctions (Vickrey auctions) in which bidders place their bid in a sealed envelope and simultaneously hand them to the auctioneer. The envelopes are opened and the individual with the highest bid wins, paying a price equal to the second-highest bid. Open ascending-bid auctions (English auctions) in which participants make increasingly higher bids, each stopping bidding when they are not prepared to pay more than the current highest bid. This continues until no participant is prepared to make a higher bid; the highest bidder wins the auction at the final amount bid. Sometimes the lot is only actually sold if the bidding reaches a reserve price set by the seller. Open descending-bid auctions (Dutch auctions) in which the price is set by the auctioneer at a level sufficiently high to deter all bidders, and is progressively lowered until a bidder is prepared to buy at the current price, winning the auction. Most auction theory revolves around these four \"basic\" auction types. However, other auction types have also received some academic study (see Auction Types). Benchmark model The benchmark model for auctions, as defined by McAfee and McMillan (1987), offers a generalization of auction formats, and is based on four assumptions: All of the bidders are risk-neutral. Each bidder has a private valuation for the item independently drawn from some probability distribution. The bidders possess symmetric information. The payment is represented as a function of only the bids. The benchmark model is often used in tandem with the Revelation Principle, which states that each of the basic auction types is structured such that each bidder has incentive to report their valuation honestly. The two are primarily used by sellers to determine the auction type that maximizes the expected price. This optimal auction format is defined such that the item will be offered to the bidder with the highest valuation at a price equal to their valuation, but the seller will refuse to sell the item if they expect that all of the bidders' valuations of the item are less than their own.[1] Relaxing each of the four main assumptions of the benchmark model yields auction formats with unique characteristics: Risk-averse bidders incur some kind of cost from participating in risky behaviors, which affects their valuation of a product. In sealed-bid first-price auctions, risk-averse bidders are more willing to bid more to increase their probability of winning, which, in turn, increases their expected utility. This allows sealed-bid first-price auctions to produce higher expected revenue than English and sealed-bid second-price auctions. In formats with correlated values\u2014where the bidders\u2019 values for the item are not independent\u2014one of the bidders perceiving their value of the item to be high makes it more likely that the other bidders will perceive their own values to be high. A notable example of this instance is the Winner\u2019s curse, where the results of the auction convey to the winner that everyone else estimated the value of the item to be less than they did. Additionally, the linkage principle allows revenue comparisons amongst a fairly general class of auctions with interdependence between bidders' values. The asymmetric model assumes that bidders are separated into two classes that draw valuations from different distributions (i.e., dealers and collectors in an antiques auction). In formats with royalties or incentive payments, the seller incorporates additional factors, especially those that affect the true value of the item (e.g., supply, production costs, and royalty payments), into the price function.[1] Game-theoretic models A game-theoretic auction model is a mathematical game represented by a set of players, a set of actions (strategies) available to each player, and a payoff vector corresponding to each combination of strategies. Generally, the players are the buyer(s) and the seller(s). The action set of each player is a set of bid functions or reservation prices (reserves). Each bid function maps the player's value (in the case of a buyer) or cost (in the case of a seller) to a bid price. The payoff of each player under a combination of strategies is the expected utility (or expected profit) of that player under that combination of strategies. Game-theoretic models of auctions and strategic bidding generally fall into either of the following two categories. In a private value model, each participant (bidder) assumes that each of the competing bidders obtains a random private value from a probability distribution. In a common value model, the participants have equal valuations of the item, but they do not have perfectly accurate information about this valuation. In lieu of knowing the exact valuation of the item, each participant can assume that any other participant obtains a random signal, which can be used to estimate the true valuation, from a probability distribution common to all bidders.[2] Usually, but not always, a private values model assumes that the values are independent across bidders, whereas a common value model usually assumes that the values are independent up to the common parameters of the probability distribution. A more general category for strategic bidding is the affiliated values model, in which the bidder's total utility depends on both their individual private signal and some unknown common value. Both the private value and common value models can be perceived as extensions of the general affiliated values model.[3] Ex-post equilibrium in a simple auction market. When it is necessary to make explicit assumptions about bidders' value distributions, most of the published research assumes symmetric bidders. This means that the probability distribution from which the bidders obtain their values (or signals) is identical across bidders. In a private values model which assumes independence, symmetry implies that the bidders' values are independently and identically distributed (i.i.d.). An important example (which does not assume independence) is Milgrom and Weber's \"general symmetric model\" (1982).[4][5] One of the earlier published theoretical research addressing properties of auctions among asymmetric bidders is Keith Waehrer's 1999 article.[6] Later published research include Susan Athey's 2001 Econometrica article,[7] as well as Reny and Zamir (2004).[8] The first formal analysis of auctions was by William Vickrey (1961). Vickrey considers two buyers bidding for a single item. Each buyer's value, v, is an independent draw from a uniform distribution with support [0,1]. Vickrey showed that in the sealed first-price auction it is an equilibrium bidding strategy for each bidder to bid half his valuation. With more bidders, all drawing a value from the same uniform distribution it is easy to show that the symmetric equilibrium bidding strategy is 1 B(v)=\\left(\\frac{n-1}{n}\\right)v Automata Automata(or Automaton), is a self-operating machine, or a machine or control mechanism designed to automatically follow a predetermined sequence of operations, or respond to predetermined instructions. Some automata, such as bellstrikers in mechanical clocks, are designed to give the illusion to the casual observer that they are operating under their own power. One of the most famous is \"A new kind of science\" by Stephen Wolfram(founder of Wolfram Research Inc.). The writer researched lots patterns of cellular automata. ```{image} ../images/Gospers_glider_gun.gif :align: center 1 2 3 4 5 6 7 8 **Bell Curves** The Bell Curve: Intelligence and Class Structure in American Life is a 1994 book by psychologist Richard J. Herrnstein and political scientist Charles Murray, in which the authors argue that human intelligence is substantially influenced by both inherited and environmental factors and that it is a better predictor of many personal dynamics, including financial income, job performance, birth out of wedlock, and involvement in crime than are an individual's parental socioeconomic status. They also argue that those with high intelligence, the \"cognitive elite\", are becoming separated from those of average and below-average intelligence. The book was controversial, especially where the authors wrote about racial differences in intelligence and discussed the implications of those differences. Shortly after its publication, many people rallied both in criticism and defense of the book. A number of critical texts were written in response to it. ```{image} ../images/TheBellCurve.gif :align: center Collective Coorperation DIKW Entropy Fisher Large Event Linear Long tails Lyapunov Marknov Miller Page Nash Equilibrium Networks Percolation Polya Balancing Process Prisoner Dilemma RandomWalking Risk in tails S Concurve Convex Schellings Shapley Value Six Sigma Spatial Tipping Point Uncertainty Voter EACH 3.6 NetLogo\u6a21\u578b\u5168\u89e3 \u91cc\u9762\u6a21\u578b\u6709\u4e9b\u591a\uff0c\u5b66\u4e60\u8bed\u8a00\u7684\u597d\u7d20\u6750\u3002 Web\u7248\u793a\u4f8b\uff1a ```{raw} html :file: ../files/TrafficGridGoal.html ``` 3.7. \u591a\u7eac\u5ea6\u4e16\u754c\u5386\u53f2\u6a21\u578b \u975e\u5386\u53f2\u7cfb\u7edf\u52a8\u529b\u6a21\u578b World3 \u6a21\u578b \uff0c \u5728\u7ebf\u6a21\u62df \u3002 \u5386\u53f2\u4ee3\u7406\u4eba\u6a21\u578b \u53ef\u5f52\u7c7b\uff08category\uff09\u7684\u7fa4\u4f53\uff1b \u53ef\u8ffd\u6eaf\u7684\u53d1\u5c55\u8f68\u8ff9\uff08track\uff09\uff1b \u53ef\u7528GIS\u63cf\u8ff0\u7684\u7fa4\u4f53\u8f7d\u4f53\uff08container\uff09\uff1b 3.8. \u4ee3\u7406\u4eba\u5916\u6c47\u6a21\u62df(ABM Based Forex Trading Simulation)","title":"\u7b2c\u4e09\u7ae0 ABM\u5efa\u6a21\u57fa\u7840"},{"location":"datanote/ch03/#abm","text":"ABM\u91ca\u4e49 ABM(Agent Based Modeling)\u4e0eEBM(Equation Based Modeling)\u8fd9\u4e24\u79cd\u5efa\u6a21\u65b9\u5f0f\u53d7\u4e0d\u540c\u7684\u4eba\u7fa4\u4e0e\u573a\u666f\u6b22\u8fce\u3002\u6bd4\u5982\u5728\u7ecf\u6d4e\u5b66\u7814\u7a76\u4e2d\uff0c\u65e9\u671fEBM\u4e3a\u4e3b\uff0c\u968f\u7740ABM\u7684\u6d41\u884c\u6709\u90e8\u5206\u4eba\u5219\u5c1d\u8bd5\u4f7f\u7528\u5b83\uff0c\u4f46\u4e0d\u662f\u8bf4\u6709\u5b83\u5c31\u8db3\u591f\u4e86\u3002\u300aABM in Economy\u300b\u8fd9\u672c\u4e66\u505a\u4e86\u4e00\u4e2a\u5f88\u597d\u7684\u793a\u4f8b\uff0cABM\u7ed3\u5408EBM\u53bb\u7814\u7a76\u6a21\u578b\uff0c\u5373EBM\u4f5c\u4e3aABM\u7684\u7406\u8bba\u652f\u6491\uff0c\u4f7f\u7528ABM\u4e88\u4ee5\u8868\u73b0\u6a21\u578b\uff0c\u4ece\u800c\u5229\u4e8e\u89e3\u91ca\u4e0e\u9884\u6d4b\u4e00\u4e2a\u73b0\u8c61\u6216\u8005\u6a21\u578b\u3002","title":"\u7b2c\u4e09\u7ae0 ABM\u5efa\u6a21\u57fa\u7840"},{"location":"datanote/ch03/#31","text":"Agent Based Modeling\u7684\u5386\u53f2\u4e25\u683c\u6765\u8bf4\u5e76\u4e0d\u7b97\u592a\u4e45\uff0c\u5f88\u591a\u8bba\u6587\u4e2d\u6211\u4eec\u90fd\u53ef\u4ee5\u770b\u5230\u5b83\u662f\u8fd1\u51e0\u5341\u5e74\u624d\u6210\u578b\u7684\u5efa\u6a21\u65b9\u6cd5\u3002","title":"3.1 \u5efa\u6a21\u7684\u79cd\u7c7b"},{"location":"datanote/ch03/#32-jel","text":"https://www.aeaweb.org/econlit/jelCodes.php?view=jel","title":"3.2 \u7ecf\u6d4e\u5b66JEL\u5206\u7c7b"},{"location":"datanote/ch03/#33","text":"","title":"3.3 \u5efa\u6a21\u65b9\u6cd5"},{"location":"datanote/ch03/#331-abm","text":"","title":"3.3.1. ABM\u5efa\u6a21"},{"location":"datanote/ch03/#332-ebm","text":"EBM\u4e0d\u662f\u8fd9\u672c\u4e66\u7684\u91cd\u70b9\uff0c\u4f46\u5e76\u4e0d\u662f\u8bf4\u5b83\u4e0d\u91cd\u8981\uff0c\u56e0\u4e3a\u5df2\u7ecf\u6709\u5f88\u591a\u4e66\u53bb\u4ecb\u7ecd\u4e86\uff0c\u8fd9\u91cc\u4ec5\u4ec5","title":"3.3.2. EBM\u5efa\u6a21"},{"location":"datanote/ch03/#34","text":"\u5904\u7406\u95ee\u9898\u7684\u65b9\u6cd5\u3002","title":"3.4 \u5efa\u6a21\u601d\u8003"},{"location":"datanote/ch03/#35","text":"Auction Auction theory is an applied branch of economics which deals with how people act in auction markets and researches the properties of auction markets. There are many possible designs (or sets of rules) for an auction and typical issues studied by auction theorists include the efficiency of a given auction design, optimal and equilibrium bidding strategies, and revenue comparison. Auction theory is also used as a tool to inform the design of real-world auctions; most notably auctions for the privatization of public-sector companies or the sale of licenses for use of the electromagnetic spectrum. General idea Auctions are characterized as transactions with a specific set of rules detailing resource allocation according to participants' bids. They are categorized as games with incomplete information because in the vast majority of auctions, one party will possess information related to the transaction that the other party does not (e.g., the bidders usually know their personal valuation of the item, which is unknown to the other bidders and the seller).[1] Auctions take many forms, but they share the characteristic that they are universal and can be used to sell or buy any item. In many cases, the outcome of the auction does not depend on the identity of the bidders (i.e., auctions are anonymous). Most auctions have the feature that participants submit bids, amounts of money they are willing to pay. Standard auctions require that the winner of the auction is the participant with the highest bid. A nonstandard auction does not require this (e.g., a lottery). Types of auction Main article: Auction \u00a7 Types There are traditionally four types of auction that are used for the allocation of a single item: First-price sealed-bid auctions in which bidders place their bid in a sealed envelope and simultaneously hand them to the auctioneer. The envelopes are opened and the individual with the highest bid wins, paying the amount bid. Second-price sealed-bid auctions (Vickrey auctions) in which bidders place their bid in a sealed envelope and simultaneously hand them to the auctioneer. The envelopes are opened and the individual with the highest bid wins, paying a price equal to the second-highest bid. Open ascending-bid auctions (English auctions) in which participants make increasingly higher bids, each stopping bidding when they are not prepared to pay more than the current highest bid. This continues until no participant is prepared to make a higher bid; the highest bidder wins the auction at the final amount bid. Sometimes the lot is only actually sold if the bidding reaches a reserve price set by the seller. Open descending-bid auctions (Dutch auctions) in which the price is set by the auctioneer at a level sufficiently high to deter all bidders, and is progressively lowered until a bidder is prepared to buy at the current price, winning the auction. Most auction theory revolves around these four \"basic\" auction types. However, other auction types have also received some academic study (see Auction Types). Benchmark model The benchmark model for auctions, as defined by McAfee and McMillan (1987), offers a generalization of auction formats, and is based on four assumptions: All of the bidders are risk-neutral. Each bidder has a private valuation for the item independently drawn from some probability distribution. The bidders possess symmetric information. The payment is represented as a function of only the bids. The benchmark model is often used in tandem with the Revelation Principle, which states that each of the basic auction types is structured such that each bidder has incentive to report their valuation honestly. The two are primarily used by sellers to determine the auction type that maximizes the expected price. This optimal auction format is defined such that the item will be offered to the bidder with the highest valuation at a price equal to their valuation, but the seller will refuse to sell the item if they expect that all of the bidders' valuations of the item are less than their own.[1] Relaxing each of the four main assumptions of the benchmark model yields auction formats with unique characteristics: Risk-averse bidders incur some kind of cost from participating in risky behaviors, which affects their valuation of a product. In sealed-bid first-price auctions, risk-averse bidders are more willing to bid more to increase their probability of winning, which, in turn, increases their expected utility. This allows sealed-bid first-price auctions to produce higher expected revenue than English and sealed-bid second-price auctions. In formats with correlated values\u2014where the bidders\u2019 values for the item are not independent\u2014one of the bidders perceiving their value of the item to be high makes it more likely that the other bidders will perceive their own values to be high. A notable example of this instance is the Winner\u2019s curse, where the results of the auction convey to the winner that everyone else estimated the value of the item to be less than they did. Additionally, the linkage principle allows revenue comparisons amongst a fairly general class of auctions with interdependence between bidders' values. The asymmetric model assumes that bidders are separated into two classes that draw valuations from different distributions (i.e., dealers and collectors in an antiques auction). In formats with royalties or incentive payments, the seller incorporates additional factors, especially those that affect the true value of the item (e.g., supply, production costs, and royalty payments), into the price function.[1] Game-theoretic models A game-theoretic auction model is a mathematical game represented by a set of players, a set of actions (strategies) available to each player, and a payoff vector corresponding to each combination of strategies. Generally, the players are the buyer(s) and the seller(s). The action set of each player is a set of bid functions or reservation prices (reserves). Each bid function maps the player's value (in the case of a buyer) or cost (in the case of a seller) to a bid price. The payoff of each player under a combination of strategies is the expected utility (or expected profit) of that player under that combination of strategies. Game-theoretic models of auctions and strategic bidding generally fall into either of the following two categories. In a private value model, each participant (bidder) assumes that each of the competing bidders obtains a random private value from a probability distribution. In a common value model, the participants have equal valuations of the item, but they do not have perfectly accurate information about this valuation. In lieu of knowing the exact valuation of the item, each participant can assume that any other participant obtains a random signal, which can be used to estimate the true valuation, from a probability distribution common to all bidders.[2] Usually, but not always, a private values model assumes that the values are independent across bidders, whereas a common value model usually assumes that the values are independent up to the common parameters of the probability distribution. A more general category for strategic bidding is the affiliated values model, in which the bidder's total utility depends on both their individual private signal and some unknown common value. Both the private value and common value models can be perceived as extensions of the general affiliated values model.[3] Ex-post equilibrium in a simple auction market. When it is necessary to make explicit assumptions about bidders' value distributions, most of the published research assumes symmetric bidders. This means that the probability distribution from which the bidders obtain their values (or signals) is identical across bidders. In a private values model which assumes independence, symmetry implies that the bidders' values are independently and identically distributed (i.i.d.). An important example (which does not assume independence) is Milgrom and Weber's \"general symmetric model\" (1982).[4][5] One of the earlier published theoretical research addressing properties of auctions among asymmetric bidders is Keith Waehrer's 1999 article.[6] Later published research include Susan Athey's 2001 Econometrica article,[7] as well as Reny and Zamir (2004).[8] The first formal analysis of auctions was by William Vickrey (1961). Vickrey considers two buyers bidding for a single item. Each buyer's value, v, is an independent draw from a uniform distribution with support [0,1]. Vickrey showed that in the sealed first-price auction it is an equilibrium bidding strategy for each bidder to bid half his valuation. With more bidders, all drawing a value from the same uniform distribution it is easy to show that the symmetric equilibrium bidding strategy is 1 B(v)=\\left(\\frac{n-1}{n}\\right)v Automata Automata(or Automaton), is a self-operating machine, or a machine or control mechanism designed to automatically follow a predetermined sequence of operations, or respond to predetermined instructions. Some automata, such as bellstrikers in mechanical clocks, are designed to give the illusion to the casual observer that they are operating under their own power. One of the most famous is \"A new kind of science\" by Stephen Wolfram(founder of Wolfram Research Inc.). The writer researched lots patterns of cellular automata. ```{image} ../images/Gospers_glider_gun.gif :align: center 1 2 3 4 5 6 7 8 **Bell Curves** The Bell Curve: Intelligence and Class Structure in American Life is a 1994 book by psychologist Richard J. Herrnstein and political scientist Charles Murray, in which the authors argue that human intelligence is substantially influenced by both inherited and environmental factors and that it is a better predictor of many personal dynamics, including financial income, job performance, birth out of wedlock, and involvement in crime than are an individual's parental socioeconomic status. They also argue that those with high intelligence, the \"cognitive elite\", are becoming separated from those of average and below-average intelligence. The book was controversial, especially where the authors wrote about racial differences in intelligence and discussed the implications of those differences. Shortly after its publication, many people rallied both in criticism and defense of the book. A number of critical texts were written in response to it. ```{image} ../images/TheBellCurve.gif :align: center Collective Coorperation DIKW Entropy Fisher Large Event Linear Long tails Lyapunov Marknov Miller Page Nash Equilibrium Networks Percolation Polya Balancing Process Prisoner Dilemma RandomWalking Risk in tails S Concurve Convex Schellings Shapley Value Six Sigma Spatial Tipping Point Uncertainty Voter EACH","title":"3.5 \u6a21\u578b\u6536\u96c6"},{"location":"datanote/ch03/#36-netlogo","text":"\u91cc\u9762\u6a21\u578b\u6709\u4e9b\u591a\uff0c\u5b66\u4e60\u8bed\u8a00\u7684\u597d\u7d20\u6750\u3002 Web\u7248\u793a\u4f8b\uff1a ```{raw} html :file: ../files/TrafficGridGoal.html ```","title":"3.6 NetLogo\u6a21\u578b\u5168\u89e3"},{"location":"datanote/ch03/#37","text":"","title":"3.7. \u591a\u7eac\u5ea6\u4e16\u754c\u5386\u53f2\u6a21\u578b"},{"location":"datanote/ch03/#_1","text":"World3 \u6a21\u578b \uff0c \u5728\u7ebf\u6a21\u62df \u3002","title":"\u975e\u5386\u53f2\u7cfb\u7edf\u52a8\u529b\u6a21\u578b"},{"location":"datanote/ch03/#_2","text":"\u53ef\u5f52\u7c7b\uff08category\uff09\u7684\u7fa4\u4f53\uff1b \u53ef\u8ffd\u6eaf\u7684\u53d1\u5c55\u8f68\u8ff9\uff08track\uff09\uff1b \u53ef\u7528GIS\u63cf\u8ff0\u7684\u7fa4\u4f53\u8f7d\u4f53\uff08container\uff09\uff1b","title":"\u5386\u53f2\u4ee3\u7406\u4eba\u6a21\u578b"},{"location":"datanote/ch03/#38-abm-based-forex-trading-simulation","text":"","title":"3.8. \u4ee3\u7406\u4eba\u5916\u6c47\u6a21\u62df(ABM Based Forex Trading Simulation)"},{"location":"datanote/ch04/","text":"\u7b2c\u56db\u7ae0 \u6570\u636e\u5904\u7406\u5e73\u53f0 \u67d0\u4e9b\u65f6\u5019\u5f53\u6211\u4eec\u7684\u6570\u636e\u91cf\u8db3\u591f\u5927\u65f6\uff08\u524d\u63d0\u662f\u6709\u5f88\u591a\u670d\u52a1\u5668\u8d44\u6e90\uff09\uff0c\u5355\u4e00\u7684\u8ba1\u7b97\u7a0b\u5e8f\u5df2\u7ecf\u4e0d\u80fd\u591f\u6ee1\u8db3\u6570\u636e\u5904\u7406\u7684\u9700\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u5f15\u5165\u4e86\u4e13\u95e8\u7684\u6570\u636e\u5904\u7406\u5e73\u53f0\u4ee5\u4f18\u5316\u5de5\u4f5c\u3002 \u5176\u5b9e\uff0c\u5bf9\u4e8e\u4e00\u822c\u7528\u6237\u800c\u8a00\uff0c\u8fd9\u4e9b\u5e73\u53f0\u5e26\u6765\u7684\u4ef7\u503c\u662f\u5c0f\u4e8e\u6240\u6295\u5165\u7684\u6210\u672c\u7684\u3002\u6bd4\u5982\u67d0\u4e9b\u4e92\u8054\u7f51\u516c\u53f8\u7684\u6570\u636e\u5904\u7406\u5e73\u53f0\u662f\u5728\u5176\u591a\u5e74\u78e8\u5408\u4e0b\u624d\u8fbe\u5230\u51e0\u5206\u949f\u6392\u5e8f100TB\u7684\u6548\u7387\u7684\uff0c\u800c\u5f00\u6e90\u7684\u76f4\u63a5\u62ff\u6765\u7528\u82e5\u60f3\u8fbe\u5230\u8fd9\u4e2a\u6548\u7387\u65e0\u5f02\u4e8e\u75f4\u4eba\u8bf4\u68a6\u3002 OK\uff0c\u626f\u8fdc\u4e86\uff0c\u90a3\u4e48\u5bf9\u76ee\u524d\u7b14\u8005\u6570\u636e\u91cf\u4e0d\u52301TB\u7684\u4eba\u6765\u8bf4\uff0c\u6211\u5c31\u770b\u770b\u8fd9\u4e9b\u5e73\u53f0\u600e\u4e48\u5de5\u4f5c\u7684\uff0c\u6d41\u7a0b\u6709\u6ca1\u6709\u53ef\u53d6\u7684\u5730\u65b9\uff0c\u7136\u540e\u52a8\u624b\u64b8\u4e00\u4e2a\u81ea\u5df1\u7528\u7684\u6a21\u578b\u3002 2018-10: \u7ecf\u8fc7\u957f\u671f\u5b9e\u8df5\u540e\uff0cHadoop\u4e4b\u7c7b\u7684\u6570\u636e\u5904\u7406\u5e73\u53f0\u8fdc\u8fdc\u4e0d\u8db3\u4ee5\u79f0\u4e4b\u4e3a\u201c\u5e73\u53f0\u201d\uff0c\u6240\u4ee5\u672c\u7ae0\u5185\u5bb9\u5c06\u6ce8\u91cd\u5de5\u5177\u7684\u7ec4\u5408\uff0c\u5373\u67b6\u6784\uff0c\u8ba9\u8bfb\u8005\u80fd\u591f\u201c\u81ea\u5df1\u642d\u201d\u3002 4.1 Hadoop\u4e0eSpark\u7b80\u4ecb\uff08\u629b\u5f03\uff09 Hadoop\u4e0e\u73b0\u5728\u66f4\u6d41\u884c\u7684Storm\u548cSpark\uff0c\u4ece\u521d\u5b66\u7684\u89d2\u5ea6\u6765\u8bf4\u66f4\u6709\u4ef7\u503c\u3002\u56e0\u4e3aHadoop\u5185\u5bb9\u4e0d\u6b62\u6709MapReduce\uff0c\u66f4\u6709SQL\u5f0f\u7684Yarn\u548cHDFS\u8fd9\u4e00\u4e13\u4e3aMR\u5f00\u53d1\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u6240\u4ee5\u6211\u8ba4\u4e3a\u5728\u57fa\u7840\u5b66\u4e60\u9636\u6bb5\u5b83\u66f4\u5177\u4ee3\u8868\u6027\u3002\u800cStorm\u548cSpark\uff0c\u5b83\u4eec\u7684\u4f18\u52a3\u6211\u73b0\u5728\u5e76\u4e0d\u6e05\u695a\uff0c\u53ea\u77e5\u9053\u524d\u8005\u9002\u7528\u4e8e\u5904\u7406\u8f93\u5165\u8fde\u7ef5\u6570\u636e\uff0c\u540e\u8005\u9002\u7528\u4e8e\u590d\u6742MR\u8fc7\u7a0b\u7684\u6a21\u578b\u3002 4.2 \u6a21\u5757\u90e8\u7f72\uff08\u5355\u673a/\u96c6\u7fa4\uff09 \u73b0\u5728\u90e8\u7f72Hadoop\u7684\u65b9\u5f0f\u6bd4\u8fc7\u53bb\u66f4\u52a0\u5bb9\u6613\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Cloudera Manager \u6216\u8005 Puppet \u53bb\u5b8c\u6210\u4f01\u4e1a\u7ea7\u7684\u90e8\u7f72\uff1b\u5982\u679c\u4f60\u9700\u8981\u6982\u5ff5\u8bc1\u660e\u7c7b\u7684\u5de5\u4f5c\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Hortonworks \u7684\u865a\u62df\u673a\u955c\u50cf \u6216\u8005 Cloudera\u7684\u865a\u62df\u673a\u955c\u50cf \uff0c\u6216\u8005 MapR \uff0c\u5728\u63a5\u4e0b\u6765\u7684\u7ae0\u8282\u4e2d\u6211\u4f1a\u4f7f\u7528rpm\u5305\u8fdb\u884c\u5b89\u88c5\uff0c\u800c\u4e0d\u662f\u6309\u7167 \u5b98\u65b9\u6587\u6863 \u53bb\u90e8\u7f72\u3002 Hue\uff1a Hadoop User Experience \uff0c\u5373web UI \u5355\u8282\u70b9\u90e8\u7f72 \u96c6\u7fa4\u90e8\u7f72 4.3. \u6570\u636e\u5904\u7406\u76ee\u7684 \u8fd9\u91cc\u7684\u6570\u636e\u662f\u5f88\u539f\u59cb\u7684\u6570\u636e\uff0c\u5373DIKW\u6a21\u578b\u4e2d\u7684Data\uff0c\u6211\u4eec\u7684\u76ee\u7684\u5373\u662f\u8981Information\u4ee5\u53caKnowledge\uff0c\u53ca\u6700\u540e\u7684Wisdom\u3002 4.3.1. \u6570\u636e\u964d/\u589e\u7ef4\uff08D\uff09 4.3.2. \u6587\u672c\u641c\u7d22\u5f15\u64ce\uff08I\uff09 4.3.3. \u6570\u636e\u5206\u7c7b\uff08I\uff09 4.3.4. \u6a21\u578b\u8bad\u7ec3\uff08K\uff09 4.3.5. \u6a21\u62df\uff08K\uff09 4.3.6. \u6a21\u5f0f\u8bc6\u522b\uff08K\uff09 4.3.7 \u51b3\u7b56\uff08W\uff09","title":"\u7b2c\u56db\u7ae0 \u6570\u636e\u5904\u7406\u5e73\u53f0"},{"location":"datanote/ch04/#_1","text":"\u67d0\u4e9b\u65f6\u5019\u5f53\u6211\u4eec\u7684\u6570\u636e\u91cf\u8db3\u591f\u5927\u65f6\uff08\u524d\u63d0\u662f\u6709\u5f88\u591a\u670d\u52a1\u5668\u8d44\u6e90\uff09\uff0c\u5355\u4e00\u7684\u8ba1\u7b97\u7a0b\u5e8f\u5df2\u7ecf\u4e0d\u80fd\u591f\u6ee1\u8db3\u6570\u636e\u5904\u7406\u7684\u9700\u6c42\uff0c\u6240\u4ee5\u6211\u4eec\u5f15\u5165\u4e86\u4e13\u95e8\u7684\u6570\u636e\u5904\u7406\u5e73\u53f0\u4ee5\u4f18\u5316\u5de5\u4f5c\u3002 \u5176\u5b9e\uff0c\u5bf9\u4e8e\u4e00\u822c\u7528\u6237\u800c\u8a00\uff0c\u8fd9\u4e9b\u5e73\u53f0\u5e26\u6765\u7684\u4ef7\u503c\u662f\u5c0f\u4e8e\u6240\u6295\u5165\u7684\u6210\u672c\u7684\u3002\u6bd4\u5982\u67d0\u4e9b\u4e92\u8054\u7f51\u516c\u53f8\u7684\u6570\u636e\u5904\u7406\u5e73\u53f0\u662f\u5728\u5176\u591a\u5e74\u78e8\u5408\u4e0b\u624d\u8fbe\u5230\u51e0\u5206\u949f\u6392\u5e8f100TB\u7684\u6548\u7387\u7684\uff0c\u800c\u5f00\u6e90\u7684\u76f4\u63a5\u62ff\u6765\u7528\u82e5\u60f3\u8fbe\u5230\u8fd9\u4e2a\u6548\u7387\u65e0\u5f02\u4e8e\u75f4\u4eba\u8bf4\u68a6\u3002 OK\uff0c\u626f\u8fdc\u4e86\uff0c\u90a3\u4e48\u5bf9\u76ee\u524d\u7b14\u8005\u6570\u636e\u91cf\u4e0d\u52301TB\u7684\u4eba\u6765\u8bf4\uff0c\u6211\u5c31\u770b\u770b\u8fd9\u4e9b\u5e73\u53f0\u600e\u4e48\u5de5\u4f5c\u7684\uff0c\u6d41\u7a0b\u6709\u6ca1\u6709\u53ef\u53d6\u7684\u5730\u65b9\uff0c\u7136\u540e\u52a8\u624b\u64b8\u4e00\u4e2a\u81ea\u5df1\u7528\u7684\u6a21\u578b\u3002 2018-10: \u7ecf\u8fc7\u957f\u671f\u5b9e\u8df5\u540e\uff0cHadoop\u4e4b\u7c7b\u7684\u6570\u636e\u5904\u7406\u5e73\u53f0\u8fdc\u8fdc\u4e0d\u8db3\u4ee5\u79f0\u4e4b\u4e3a\u201c\u5e73\u53f0\u201d\uff0c\u6240\u4ee5\u672c\u7ae0\u5185\u5bb9\u5c06\u6ce8\u91cd\u5de5\u5177\u7684\u7ec4\u5408\uff0c\u5373\u67b6\u6784\uff0c\u8ba9\u8bfb\u8005\u80fd\u591f\u201c\u81ea\u5df1\u642d\u201d\u3002","title":"\u7b2c\u56db\u7ae0 \u6570\u636e\u5904\u7406\u5e73\u53f0"},{"location":"datanote/ch04/#41-hadoopspark","text":"Hadoop\u4e0e\u73b0\u5728\u66f4\u6d41\u884c\u7684Storm\u548cSpark\uff0c\u4ece\u521d\u5b66\u7684\u89d2\u5ea6\u6765\u8bf4\u66f4\u6709\u4ef7\u503c\u3002\u56e0\u4e3aHadoop\u5185\u5bb9\u4e0d\u6b62\u6709MapReduce\uff0c\u66f4\u6709SQL\u5f0f\u7684Yarn\u548cHDFS\u8fd9\u4e00\u4e13\u4e3aMR\u5f00\u53d1\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u6240\u4ee5\u6211\u8ba4\u4e3a\u5728\u57fa\u7840\u5b66\u4e60\u9636\u6bb5\u5b83\u66f4\u5177\u4ee3\u8868\u6027\u3002\u800cStorm\u548cSpark\uff0c\u5b83\u4eec\u7684\u4f18\u52a3\u6211\u73b0\u5728\u5e76\u4e0d\u6e05\u695a\uff0c\u53ea\u77e5\u9053\u524d\u8005\u9002\u7528\u4e8e\u5904\u7406\u8f93\u5165\u8fde\u7ef5\u6570\u636e\uff0c\u540e\u8005\u9002\u7528\u4e8e\u590d\u6742MR\u8fc7\u7a0b\u7684\u6a21\u578b\u3002","title":"4.1 Hadoop\u4e0eSpark\u7b80\u4ecb\uff08\u629b\u5f03\uff09"},{"location":"datanote/ch04/#42","text":"\u73b0\u5728\u90e8\u7f72Hadoop\u7684\u65b9\u5f0f\u6bd4\u8fc7\u53bb\u66f4\u52a0\u5bb9\u6613\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Cloudera Manager \u6216\u8005 Puppet \u53bb\u5b8c\u6210\u4f01\u4e1a\u7ea7\u7684\u90e8\u7f72\uff1b\u5982\u679c\u4f60\u9700\u8981\u6982\u5ff5\u8bc1\u660e\u7c7b\u7684\u5de5\u4f5c\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Hortonworks \u7684\u865a\u62df\u673a\u955c\u50cf \u6216\u8005 Cloudera\u7684\u865a\u62df\u673a\u955c\u50cf \uff0c\u6216\u8005 MapR \uff0c\u5728\u63a5\u4e0b\u6765\u7684\u7ae0\u8282\u4e2d\u6211\u4f1a\u4f7f\u7528rpm\u5305\u8fdb\u884c\u5b89\u88c5\uff0c\u800c\u4e0d\u662f\u6309\u7167 \u5b98\u65b9\u6587\u6863 \u53bb\u90e8\u7f72\u3002 Hue\uff1a Hadoop User Experience \uff0c\u5373web UI","title":"4.2 \u6a21\u5757\u90e8\u7f72\uff08\u5355\u673a/\u96c6\u7fa4\uff09"},{"location":"datanote/ch04/#_2","text":"","title":"\u5355\u8282\u70b9\u90e8\u7f72"},{"location":"datanote/ch04/#_3","text":"","title":"\u96c6\u7fa4\u90e8\u7f72"},{"location":"datanote/ch04/#43","text":"\u8fd9\u91cc\u7684\u6570\u636e\u662f\u5f88\u539f\u59cb\u7684\u6570\u636e\uff0c\u5373DIKW\u6a21\u578b\u4e2d\u7684Data\uff0c\u6211\u4eec\u7684\u76ee\u7684\u5373\u662f\u8981Information\u4ee5\u53caKnowledge\uff0c\u53ca\u6700\u540e\u7684Wisdom\u3002","title":"4.3. \u6570\u636e\u5904\u7406\u76ee\u7684"},{"location":"datanote/ch04/#431-d","text":"","title":"4.3.1. \u6570\u636e\u964d/\u589e\u7ef4\uff08D\uff09"},{"location":"datanote/ch04/#432-i","text":"","title":"4.3.2. \u6587\u672c\u641c\u7d22\u5f15\u64ce\uff08I\uff09"},{"location":"datanote/ch04/#433-i","text":"","title":"4.3.3. \u6570\u636e\u5206\u7c7b\uff08I\uff09"},{"location":"datanote/ch04/#434-k","text":"","title":"4.3.4. \u6a21\u578b\u8bad\u7ec3\uff08K\uff09"},{"location":"datanote/ch04/#435-k","text":"","title":"4.3.5. \u6a21\u62df\uff08K\uff09"},{"location":"datanote/ch04/#436-k","text":"","title":"4.3.6. \u6a21\u5f0f\u8bc6\u522b\uff08K\uff09"},{"location":"datanote/ch04/#437-w","text":"","title":"4.3.7 \u51b3\u7b56\uff08W\uff09"},{"location":"datanote/ch05/","text":"\u7b2c\u4e94\u7ae0 \u5916\u6c47\u4ea4\u6613\u57fa\u7840 \u5bf9\u7684\uff0c\u4e0a\u6765\u5c31\u7ed9\u4f60\u770b\u6280\u672f\u6307\u6807\uff0c\u7edd\u5bf9\u6ca1\u9519\uff01 5.1 \u6280\u672f\u6307\u6807 Bill Williams Indicators Acceleration/Deceleration Oscillator(AC) Acceleration/Deceleration (AC) technical indicator signals the acceleration or deceleration of the current market driving force. How to Use Acceleration/Deceleration The indicator is fluctuating around a median 0.00 (zero) level which corresponds to a relative balance of the market driving force with the acceleration. Positive values signal a growing bullish trend, while negative values may be qualified as a bearish trend development. The indicator changes its direction before any actual trend reversals take place in the market therefore it serves as an early warning sign of probable trend direction changes. The indicator color changes alone are very important as the current green line (irrespectively of the value) warns against long positions the same way as the red one would against selling. To enter the market along with its driving force one needs to watch for both value and color. Two consecutive green columns above the zero level would suggest you to enter the market with a long position while at least two red columns below the zero level might be taken for a command to go short. Fake signals prevail in timeframes smaller than 4 hours. ```{image} ../images/AcceleratorDecelerator.jpg :align: center 1 2 3 4 5 6 7 8 **Acceleration/Deceleration Oscillator Formula (Calculation)** AC bar chart is the difference between the value of 5/34 of the driving force bar chart and 5-period simple moving average, taken from that bar chart. ```{code} AO = SMA(median price, 5)-SMA(median price, 34) AC = AO-SMA(AO, 5) Alligator Alligator is an indicator designed to signal a trend absence, formation and direction. Bill Williams saw the alligator's behavior as an allegory of the market's one: the resting phase is turning into the price-hunting as the alligator awakes so that to come back to sleep after the feeding is over. The longer the alligator is sleeping the hungrier it gets and the stronger the market move will be. How to Use Alligator Indicator The Alligator indicator consists of 13-, 8- and 5-period smoothed moving averages shifted into the future by 8, 5 and 3 bars respectively which are colored blue, red and green representing the alligator\u2019s jaw, teeth and lips. The Alligator is resting when the three averages are twisted together progressing in a narrow range. The more distant the averages become, the sooner the price move will happen. The averages continuing in an upward direction (green followed by red and blue) suggest an emerging uptrend which we interpret as a signal to buy. The averages following each other in the reversed order down the slope are a strong signal of an unfolding downtrend so selling at this point would be more than appropriate. ```{image} ../images/Alligator.jpg :align: center 1 2 3 4 5 6 7 8 **Alligator Indicator Formula (Calculation)** ```{code} MEDIAN PRICE = (HIGH + LOW) / 2 ALLIGATORS JAW = SMMA (MEDEAN PRICE, 13, 8) ALLIGATORS TEETH = SMMA (MEDEAN PRICE, 8, 5) ALLIGATORS LIPS = SMMA (MEDEAN PRICE, 5, 3) Awesome Oscillator(AO) Awesome Oscillator (AO) is a momentum indicator reflecting the precise changes in the market driving force which helps to identify the trend\u2019s strength up to the points of formation and reversal. How to Use Awesome Oscillator There are three main signals which may be seen: Saucer - three consecutive columns above the nought line the first two of which must be colored red (the second one is lower than the first one) while the third one is colored green and higher than the previous (second) one. Such a formation would be a clear Buy signal whilst inverted and vertically flipped formation would serve as a Sell signal. Nought line crossing - the histogram crosses the naught line in an upward direction changing its values from negative to that of positive ones. In this situation we have a Buy signal. The Sell signal would be a reversed pattern. Two pikes - the indicator displays a Buy signal when the figure is formed by two consecutive pikes both of which are below the naught line and the later-formed pike is closer to the zero level than the earlier-formed one. The Sell signal would be given by the reverse formation. ```{image} ../images/AwesomeOscillator.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 **Awesome Oscillator Trading Strategy** Awesome Oscillator Strategy includes 3 ways of trading. The first way is to open a sell position when the oscillator is below the zero line forming a peak, and open a buy position when the oscillator is above the zero line forming a gap. Another way is to open a sell position when the oscillator forms two peaks above the zero line, where the second high is lower than the previous one. And, conversely, traders watch to open a buy position when the oscillator forms to lows below the zero line with the last one not as low as the previous one. The third way is to account crossing the zero line. When the oscillator crosses it from up to down, it is time to open a sell position and when it crosses from down to up, it is time to open a buy position. **Awesome Oscillator Formula (Calculation)** Awesome Oscillator is a 34-period simple moving average, plotted through the central points of the bars (H+L)/2, and subtracted from the 5-period simple moving average, graphed across the central points of the bars (H+L)/2. ```{code} MEDIAN PRICE = (HIGH+LOW)/2 AO = SMA(MEDIAN PRICE, 5)-SMA(MEDIAN PRICE, 34) where SMA \u2014 Simple Moving Average. Fractals Fractals is an indicator highlighting the chart\u2019s local heights and lows where the price movement had stopped and reversed. These reversal points are called respectively Highs and Lows. How to Use Fractal Indicator Bill Williams' Fractals are formed around a group of five consecutive bars the first two of which are successively reaching higher (or diving deeper) and the last two descending lower (or growing higher) with the middle one being the highest (or the lowest) result in the group accordingly. Buy fractal is an arrow pointing to the top Sell fractal is an arrow pointing to the bottom ```{image} ../images/Fractals.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #### Gator Oscillator(GO) The Gator Oscillator (GO) is a supplement to the Alligator indicator and is used alongside with it showing the absolute degree of convergence/divergence of the Alligator's three SMAs pointing at the Alligator's periods of slumber and awakeness (i.e. trending and non-trending market phases). **How to Use Gator Oscillator** Being an oscillator in the form of two histograms built on either side of the naught line, the Gator Oscillator plots the absolute difference between the Alligator\u2019s Jaw and Teeth (blue and red lines) in the positive area and the absolute difference between the Alligator\u2019s Teeth and Lips (red and green lines) in the negative area. The histogram\u2019s bars are colored green if exceeding the previous bar\u2019s volume or red if falling short. The bars of the extreme values are in tune with the strong trend forces. The Alligator's activity periods are divided into the following four: 1. Gator awakes - the bars on different sides of the naught line are colored differently. 2. Gator eats - green bars on both sides of the naught line. 3. Gator fills out - single red bar during the \"eating\" phase. 4. Gator sleeps - the bars on both sides are red ```{image} ../images/GatorOscillator(GO).jpg :align: center Market Facilitation Index The Market Facilitation Index is designed for evaluation the willingness of the market to move the price. The indicator's absolute values alone cannot provide any trading signals unlike it's dynamics in relation to the dynamics of the volume. How to Use Market Facilitation Index The absolute values of the index are represented by the histogram's bars while the comparison of the index and volume dynamics are given in colors which are vital in terms of reading the indicator signs. Green bar - both MFI and volume are up. Increasing trading activity means market movement acceleration. We may join the trend. Blue bar - MFI indicator is up, volume is down. The movement is continuing although the volume has dropped. The trend will soon be reversing. Pink bar - MFI indicator is down, volume is up. The slowing down movement while volume is raising may indicate a possible break through, often a U-turn. Brown bar - both MFI and volume are down. The market is no longer interested in the current direction and is looking for signs of a future development. ```{image} ../images/MarketFacilitationIndex.jpg :align: center 1 2 3 4 5 **Market Facilitation Index Formula (Calculation)** ```{code} BW MFI = (HIGH-LOW)/VOLUME Oscillator Aroon Developed by Tushar Chande in 1995, Aroon is an indicator system that determines whether a stock is trending or not and how strong the trend is. \u201cAroon\u201d means \u201cDawn's Early Light\u201d in Sanskrit. Chande chose this name because the indicators are designed to reveal the beginning of a new trend. The Aroon indicators measure the number of periods since price recorded an x-day high or low. There are two separate indicators: Aroon-Up and Aroon-Down. A 25-day Aroon-Up measures the number of days since a 25-day high. A 25-day Aroon-Down measures the number of days since a 25-day low. In this sense, the Aroon indicators are quite different from typical momentum oscillators, which focus on price relative to time. Aroon is unique because it focuses on time relative to price. Chartists can use the Aroon indicators to spot emerging trends, identify consolidations, define correction periods and anticipate reversals. Calculation The Aroon indicators are shown in percentage terms and fluctuate between 0 and 100. Aroon-Up is based on price highs, while Aroon-Down is based on price lows. These two indicators are plotted side-by-side for easy comparison. The default parameter setting in SharpCharts is 25 and the example below is based on 25 days. 1 2 Aroon-Up = ((25 - Days Since 25-day High)/25) x 100 Aroon-Down = ((25 - Days Since 25-day Low)/25) x 100 ```{image} ../images/aron-1-spyexam.png :align: center 1 2 3 4 Aroon declines as the elapsed time between a new high or low increases. 50 is the cut off point. Because 12.5 days marks the exact middle, a reading of exactly 50 is impossible on a daily chart. It is possible with other timeframes. On daily charts, Aroon is either below 50 (48) or above 50 (52). A reading above 50 means a new high or low was recorded within the last 12 days or less. This is the most recent half of the look-back period. A reading below 50 means a new high or low was recorded within the last 13 days or more {(25-13)/25 x 100 = 48). This is the latter half of the look-back period. The table below shows the range of values for 25-day Aroon-Up and 25-day Aroon-Down ```{image} ../images/aron-6-xlsheet.png :align: center Interpretation The Aroon indicators fluctuate above/below a centerline (50) and are bound between 0 and 100. These three levels are important for interpretation. At its most basic, the bulls have the edge when Aroon-Up is above 50 and Aroon-Down is below 50. This indicates a greater propensity for new x-day highs than lows. The converse is true for a downtrend. The bears have the edge when Aroon-Up is below 50 and Aroon-Down is above 50. A surge to 100 indicates that a trend may be emerging. This can be confirmed with a decline in the other Aroon indicator. For example, a move to 100 in Aroon-Up combined with a decline below 30 in Aroon-Down shows upside strength. Consistently high readings mean prices are regularly hitting new highs or new lows for the specified period. Prices are moving consistently higher when Aroon-Up remains in the 70-100 range for an extended period. Conversely, consistently low readings indicate that prices are seldom hitting new highs or lows. Prices are NOT moving lower when Aroon-Down remains in the 0-30 range for an extended period. This does not mean prices are moving higher though. For that we need to check Aroon-Up. New Trend Emerging There are three stages to an emerging trend signal. First, the Aroon lines will cross. Second, the Aroon lines will cross above/below 50. Third, one of the Aroon lines will reach 100. For example, the first stage of an uptrend signal is when Aroon-Up moves above Aroon-Down. This shows new highs becoming more recent than new lows. Keep in mind that Aroon measures the time elapsed, not the price. The second stage is when Aroon-Up moves above 50 and Aroon-Down moves below 50. The third stage is when Aroon-Up reaches 100 and Aroon-Down remains at relatively low levels. The first and second stages do not always occur in that order. Sometimes Aroon-Up will break above 50 and then above Aroon-Down. Reverse engineering the uptrend stages will give you the emerging downtrend signal. Aroon-Down breaks above Aroon-Up, breaks above 50 and reaches 100. ```{image} ../images/aron-2-csxtrend.png :align: center 1 2 3 4 5 6 7 8 The chart above shows CSX Corp (CSX) with weekly bars and 25-week Aroon. First, notice that the downtrend began weakening as Aroon-Down declined below 50 at the end of 2007 (far left). The first stage of an uptrend was signaled when Aroon-Up moved above Aroon-Down in early 2008 (first orange circle). Aroon-Up continued above 50 and hit 100 as Aroon-Down remained at relatively low levels. Notice how Aroon-Up remained near 100 as the advance continued. This emerging uptrend signal lasted until September 2008 when Aroon-Down broke above Aroon-Up, exceeded 50 and surged to 100 (second orange circle). Notice how Aroon-Down remained near 100 as the downtrend extended. The third trend on this chart was signaled when Aroon-Up surged to 100 in June 2009 and remained above 50 for over a year (third orange circle). Also notice that Aroon-Down remained below 50 for over a year. **Consolidation Period** The Aroon indicators signal a consolidation when both are below 50 and/or both are moving lower with parallel lines. It makes sense that consistent readings below 50 are indicative of flat trading. For 25-day Aroon, readings below 50 mean a 25-day high or low has not been recorded in 13 or more days. Prices are clearly flat when not recording new highs or new lows. Similarly, a consolidation is usually forming when both Aroon-Up and Aroon-Down move lower in parallel fashion and the distance between the two lines is quite small. This narrow parallel decline indicates that some sort of trading range is forming. The first Aroon indicator to break above 50 and hit 100 will trigger the next signal. ```{image} ../images/aron-3-omcflat.png :align: center The chart above shows Omnicom (OMC) with the Aroon indicators moving below 50 in a parallel decline. The width of the channel could be narrower, but we can see the consolidation taking shape on the price chart for confirmation. Both Aroon-Up and Aroon-Down were below 50 in the yellow area. Aroon-Up then broke out and surged to 100, which was before the breakout. Further confirmation came with another Aroon-Up surge at the breakout point. This surge/breakout signaled the end of the consolidation and the beginning of the advance. ```{image} ../images/aron-4-lpntflat.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 The next chart shows Lifepoint Hospitals (LPNT) with 25-day Aroon. Both lines moved lower in May with a parallel decline. The distance between the lines was around 25 points throughout the decline. Aroon-Up and Aroon-Down flattened in June and both remained below 50 for around two weeks as the triangle consolidation extended. Aroon-Down (red) was the first to make its move with a break above 50 just before the triangle break on the price chart. Aroon-Down hit 100 as prices broke triangle support to signal a continuation lower. **Conclusions** Aroon-Up and Aroon-Down are complementary indicators that measure the elapsed time between new x-day highs and lows, respectively. They are shown together so chartists can easily identify the stronger of the two and determine the trend bias. A surge in Aroon-Up combined with a decline in Aroon-Down signals the emergence of an uptrend. Conversely, a surge in Aroon-Down combined with a decline in Aroon-Up signals the start of a downtrend. A consolidation is present when both move lower in parallel fashion or when both remain at low levels (below 30). Chartists can use the Aroon indicators to determine if a security is trending or trading flat and then use other indicators to generate appropriate signals. For example, chartists might use a momentum oscillator to identify oversold levels when 25-week Aroon indicates that the long-term trend is up. #### RSI Bar RSI-Bars is an oscillator, developed by IFC Markets in 2014 as the modification of Relative Strength Index (RSI). RSI-Bars characterizes a stability of a price momentum and allows a definition of a trend potential. A distinctive feature of RSI-Bars is that this indicator takes into account the volatility of a considered instrument within the selected timeframe - values of RSI-Bars are defined with account of price OPEN/HIGH/LOW/CLOSE (OHLC) values and are displayed in the form of chart bars. This allows avoiding of false breakdowns of oscillator trend lines and that\u2019s why traders may use methods of a chart analysis more efficiently in this case. [Download RSI-Bars for Metatrader 4](<http://www.ifcmarkets.com/uploads/RSI-B.zip>) Installation guide: ```{code} Download and extract the zip archive with indicator file .ex4; Open the data directory from the main menu of Metatrader 4 terminal:File =>Open Data Folder; Put an indicator file into the folder MQL4/Indicators of Data Folder; Restart the Metatrader 4 terminal; In order to insert an indicator, open the group of custom indicators in the main menu: Insert=>Indicators=>Custom indicator. Advantages of RSI-Bars oscillator In contrast to the classical Relative Strength Index, developed by J.Wilder, RSI-Bars evaluates an internal volatility. Minimal and maximum limits of bars are constructed on the basis of 4 prices (OHLC). A calculated set is used for the selection of a minimum and maximum value of RSI-Bars. Then a bar structure is formed. ```{image} ../images/rsiformula.jpg :align: center 1 2 3 4 5 6 7 8 An analysis of a candlestick price chart in some cases allows avoiding of a trend false breakdowns. It happens due to the account of additional price information and it internal volatility. At the same way RSI-Bars takes into account a true range of price oscillations, not only a characteristic value of a given timeframe. Due to this property, RSI-Bars allows a correct and convenient use of a chart technical analysis. A comparative analysis of RSI and RSI-Bars is represented on the figure below \u2013 we used H4 candlesticks of a most volatile pair, GBP/USD. As it can be seen, RSI(14) has shown and additional breakdown in contrast with RSI-Bars (14). Moreover, RSI-Bars has detected later and therefore more correct finishing of a downtrend. The use of RSI-Bars is demonstrated in trade examples of everyday analytics releases of IFC Markets. ```{image} ../images/RSI-Bars.png :align: center Application The oscillator works most efficiently in a flat motion. A lower and higher bounds of oscillator values are introduced subjectively (for example 30% and 70%) and correspond to overbought and oversold levels; RSI-Bars can take extreme values during a trend motion. That\u2019s why in this case a use of overbought and oversold levels is incorrect; RSI-Bars allows a definition of standard chart analysis instruments - figures, lines of support and resistance, etc. In this case the indicator should be used for a confirmation of technical analysis. We should take into account that RSI-Bars can give preliminary signals of a trend change; Divergence is the strongest signal of RSI-Bars \u2013 opposite directions of price and oscillator movements are detected in this case. This signal is a harbinger of a possible trend weakening; Values of RSI-Bars lie between 0% and 100%. Average True Range(ATR) The Average True Range (ATR) indicator was introduced by Welles Wilder as a tool to measure the market volatility and volatility alone leaving aside attempts to indicate the direction. Unlike the True Range, the ATR also includes volatility of gaps and limit moves. ATR indicator is good at valuating the market's interest in the price moves for strong moves and break-outs are normally accompanied by large ranges. How to Use ATR Indicator The ATR is used with 14 periods with daily and longer timeframes and reflects the volatility values that are in relation to the trading instrument's price. Low ATR values would normally correspond to a range trading while high values may indicate a trend breakout or breakdown. Average True Range Indicator ```{image} ../images/AverageTrueRange.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 **Average True Range Formula (ATR Calculation)** Average True Range is a moving average of the True Range which is the greatest of the following three values: - The distance from today's high to today's low. - The distance from yesterday's close to today's high. - The distance from yesterday's close to today's low. #### Bollinger Bands The Bollinger Bands indicator (named after its inventor) displays the current market volatility changes, confirms the direction, warns of a possible continuation or break-out of the trend, periods of consolidation, increasing volatility for break-outs as well as pinpoints local highs and lows. **How to Use Bollinger Bands** The indicator consists of the three moving averages: - Upper band - 20-day simple moving average (SMA) plus double standard price deviation. - Middle band - 20-day SMA. - Lower band - 20-day SMA minus double standard price deviation. The increasing distance between the upper and the lower bands while volatility is growing, suggests of a price developing in a trend which direction correlates with the direction of the Middle line. In contrast to the above, at times of decreasing volatility when the bands are closing in, we should be expecting the price to move sidewards in a range. The price moving outside the Bands may indicate either the trend\u2019s continuation (when the bands are floating apart as the volatility increases) or the U-turn of the trend if the initial movement is exhausted. Either way each of the scenarios must be confirmed by other indicators such as RSI, ADX or MACD. Anyhow the price crossing of the Middle line from below or above may be interpreted as a signal to buy or to sell respectively. ```{image} ../images/BollingerBands.jpg :align: center Bollinger Bands Trading Strategy Bollinger Bands trading strategy aims to profit from oversold or overbought conditions on the market. Prices are considered overextended on the upside when they touch the upper band (overbought). They are overextended on the downside, when they touch the lower band (oversold). This strategy is used as an immediate signal to buy or sell the security. The usage of upper and lower bands as price targets is referred to as the simplest way of using Bollinger Bands strategy. If prices cross below the average, the lower band becomes the lower price target. If the prices cross above the same average, the upper band identifies the upper price target. In a Bollinger Band trading system an uptrend is shown by prices fluctuating between upper and middle bands. In such cases if prices cross below the middle band, this warns of a trend reversal to the downside indicating a sell signal. In a downtrend, prices fluctuate between middle and lower bands, and the price crossing above the middle band warns of a trend reversal to the upside, indicating a buy signal. Bollinger Bands Formula (Calculation) 1 2 3 4 5 6 7 8 9 10 The middle line (ML) is a regular Moving Average: ML = SUM [CLOSE, N]/N The top line (TL) is ML a deviation (D) higher: TL = ML + (D*StdDev) The bottom line (BL) is ML a deviation (D) lower. BL = ML \u2014 (D*StdDev) Where: N \u2014 number of periods used in calculation; SMA \u2014 Simple Moving Average; StdDev \u2014 Standard Deviation. Commodity Channel Index(CCI) The Commodity Channel Index is an indicator by Donald Lambert. Despite the original purpose to identify new trends, it\u2019s nowadays widely used to measure the current price levels in relation to the average one. How to Use CCI Indicator Commodity Channel Index indicator oscillates around the naught line tending to stay within the range from -100 to +100. The naught line represents the level of an average balanced price. The higher the indicator surges above the naught line the more overvalued the security is. The further the CCI indicator plunges into the negative area the more potential for growth the price may have. Still the unbalanced price alone may not serve as a clear indicator neither to the direction the price is following nor to its strength. There are critical values and the crossing directions which need to be looked at closely: Exceeding past the 100 level suggests a possible further upward movement Decreasing past the 100 level indicates a U-turn and serves as a signal to sell. Decreasing past the -100 level suggests a possible further downward movement Exceeding past the -100 level indicates a U-turn and serves as a signal to buy. Crossing the naught line upwards from below serves as a confirmation to buy Crossing the naught line downwards from above serves a confirmation to sell. Smaller CCI indicator period increases its sensitivity. Shifting critical levels to 200 allows to exclude insignificant price fluctuations. ```{image} ../images/CommodityChannelIndex.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 **CCI Trading Strategy** CCI trading strategy is used by most traders, investors and chartists as an overbought or oversold oscillator. The basic strategy of CCI is to watch the readings above +100 and below -100. The readings above +100 are considered overbought and generate buy signals. The readings below -100 are considered oversold and generate sell signals. Though the Commodity Channel Index was initially developed for commodities, it is also used for trading stock index futures and options. **Caculation** The example below is based on a 20-period Commodity Channel Index (CCI) calculation. The number of CCI periods is also used for the calculations of the simple moving average and Mean Deviation. ```{code} CCI = (Typical Price - 20-period SMA of TP) / (.015 x Mean Deviation) Typical Price (TP) = (High + Low + Close)/3 Constant = .015 There are four steps to calculating the Mean Deviation. First, subtract the most recent 20-period average of the typical price from each period's typical price. Second, take the absolute values of these numbers. Third, sum the absolute values. Fourth, divide by the total number of periods (20). Lambert set the constant at .015 to ensure that approximately 70 to 80 percent of CCI values would fall between -100 and +100. This percentage also depends on the look-back period. A shorter CCI (10 periods) will be more volatile with a smaller percentage of values between +100 and -100. Conversely, a longer CCI (40 periods) will have a higher percentage of values between +100 and -100. ```{image} ../images/cci-1-msftsheet.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 #### DeMarker(DeM) This indicator was introduced by Tom DeMark as a tool to identify emerging buying and selling opportunities. It demonstrates the price depletion phases which usually correspond with the price highs and bottoms. The DeMarker indicator proved to be efficient at identifying trend break-downs as well as spotting intra-day entry and exit points. **How to Use DeMarker Indicator** The indicator fluctuates with a range between 0 to 1 and is indicative of lower volatility and a possible price drop when reading 0.7 and higher, and signals a possible price increase when reading below 0.3. ```{image} ../images/DeMarker.jpg :align: center DeMarker Indicator Formula (Calculation) The DeMarker indicator is the sum of all price increment values recorded during the \"i\" period divided by the price minima: 1 2 3 4 5 6 The DeMax(i) is calculated: If high(i) > high(i-1) , then DeMax(i) = high(i)-high(i-1), otherwise DeMax(i) = 0 The DeMin(i) is calculated: If low(i) < low(i-1), then DeMin(i) = low(i-1)-low(i), otherwise DeMin(i) = 0 The value of the DeMarker is calculated as: DMark(i) = SMA(DeMax, N)/(SMA(DeMax, N)+SMA(DeMin, N)) Envelopes The Envelopes indicator reflects the price overbought and oversold conditions helping to identify the entry or exit points as well as possible trend break-downs. How to Use Envelopes Indicator The Envelopes indicator consists of two SMAs that together form a flexible channel in which the price evolves. The averages are plotted around a Moving Average in a constant percentage distance which may be adjusted according to the current market volatility. Each line serves as a margin of the price fluctuation range. In a trending market take only oversold signals in an uptrend conditions and overbought signals in a downtrend conditions. In a ranging market the price reaching the top line serves as a sell signal, while the price at the lower line generates a signal to buy. ```{image} ../images/Envelopes.jpg :align: center 1 2 3 4 5 6 7 8 9 10 **Envelopes Indicator Formula (Calculation)** ```{code} Upper Band = SMA(CLOSE, N)*[1+K/1000] Lower Band = SMA(CLOSE, N)*[1-K/1000] Where: SMA \u2014 Simple Moving Average; N \u2014 averaging period; K/1000 \u2014 the value of shifting from the average (measured in basis points). Force Index The Force Index indicator invented by Alexander Elder measures the power behind every price move based on their three essential elements, e.g., direction, extent and volume. The oscillator fluctuates around the zero, i.e., a point of a relative balance between power shifts. How to Use Force Index The Force Index allows to identify the reinforcement of different time scale trends: The indicator should be made more sensitive by decreasing its period for short trends. The indicator should be smoothed by increasing its period for longer trends. The Force Index may strongly imply a trend change: Break-down of an uptrend when the indicator's value is changing from positive to negative and price and indicator show divergence. Break-down of a downtrend when the indicator's value is changing from negative to positive and price and indicator show convergence. Together with a trend-following indicator the Force Index can help identify trend corrections: An uptrend correction when the indicator bounces off the low. A downtrend correction when the indicator slides from a pike. ```{image} ../images/ForceIndex.jpg :align: center 1 2 3 4 5 6 **Force Index Formula (Calculation)** ```{code} Force Index(1) = {Close (current period) - Close (prior period)} x Volume Force Index(13) = 13-period EMA of Force Index(1) Ichimoku The Ichimoku Kinko Hyo (Equilibrium chart at a glance) is a comprehensive technical analysis tool introduced in 1968 by Tokyo columnist Goichi Hosoda. The concept of the system was to provide an immediate vision of trend sentiment, momentum and strength at a glance perceiving all the Ichimoku's five components and a price in terms of interactions among them of a cyclical type related to that of human group dynamics. How to Use Ichimoku Indicator The Ichimoku indicator consists of five lines which may all serve as flexible support or resistance lines, whose crossovers may as well be assumed as additional signals: Tenkan-Sen (Conversion line, blue) Kijun-Sen (Base line, red) Senkou Span A (Leading span A, green boundary of the cloud) Senkou Span B (Leading span B, red boundary of the cloud) Chikou Span (Lagging span, green) Kumo (Cloud) is a central element of the Ichimoku system and represents support or resistance areas. It is formed by Leading Span A and Leading Span B. Determining the trend persistence and corrections: Price moving above the cloud indicates an uptrend Price moving below the cloud indicates a downtrend Price moving within the cloud indicates a sideways trend Cloud turning from green to red indicates a correction during an uptrend Cloud turning from red to green indicates a correction during a downtrend Determining support and resistance: Leading span A serves as a first support line for an uptrend Leading span B serves as a second support line for an uptrend Leading span A serves as a first resistance line for a downtrend Leading span B serves as a second resistance line for a downtrend Strong Buy/Sell signals occurring above the cloud: Conversion line crosses Base line up from below is a signal to buy Conversion line crosses Base line down from above is a signal to sell Less reliable Buy/Sell signals occurring within the cloud: Conversion line crosses Base line up from below is a signal to buy Conversion line crosses Base line down from above is a signal to sell ```{image} ../images/Ichimoku.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 **Ichimoku Trading Strategy** Traders use the Ichimoku strategy to identify the trend. For a bullish signal this trading strategy sets three criteria. First, the trend is bullish when prices reach above the lowest line of the cloud. Second, a bullish signal triggers when prices reverse and reach above the Conversion Line. And third, the trend is bullish when the price moves below the Base Line. **Ichimoku Formula (Ichimoku Kinko Hyo Calculation)** ```{code} Tenkan-Sen (Conversion line, blue) is (9-period high + 9-period low)/2 Kijun-Sen (Base line, red) is (26-period high + 26-period low)/2 Senkou Span A (Leading span A, green boundary of the cloud) is (Conversion Line + Base Line)/2 Senkou Span B (Leading span B, red boundary of the cloud) is (52-period high + 52-period low)/2 Chikou Span (Lagging span, green) is close price plotted 26 periods in the past MACD Moving-Average Convergence/Divergence Oscillator, commonly referred to as MACD indicator, is developed by Gerald Appel which is designed to reveal changes in the direction and strength of the trend by combining signals from three time series of moving average curves. How to Use MACD Indicator Three main signals generated by the MACD indicator (blue line) are crossovers with the signal line (red line), with the x-axis and divergence patterns. Crossovers with the signal line: If the MACD line is rising faster than the Signal line and crosses it from below, the signal is interpreted as bullish and suggests acceleration of price growth; If the MACD line is falling faster than the Signal line and crosses it from above, the signal is interpreted as bearish and suggests extension of price losses; Crossovers with the x-axis: A bullish signal appears if the MACD line climbs above zero; A bearish signal presents if the MACD line falls below zero. Convergence/Divergence: If the MACD line is trending in the same direction as the price, the pattern is known as convergence, which confirms the price move; If they move in opposite directions, the pattern is divergence. For example, if the price reaches a new high, but the indicator does not, this may be a sign of further weakness. ```{image} ../images/MACD.jpg :align: center 1 2 3 4 5 6 7 **MACD Indicator Formula (MACD Calculation)** ```{code} MACD line = 12-period EMA \u2013 26-period EMA Signal line = 9-period EMA Histogram = MACD line \u2013 Signal line Momentum Momentum Oscillator is an indicator that shows trend direction and measures how quickly the price is changing by comparing current and past prices. How to Use Momentum Indicator The indicator is represented by a line, which oscillates around 100. Being an oscillator, momentum should be used within price trend analysis. Crossing the x-axis: It is believed that if the indicator climbs above 100 during an uptrend, it is a bullish signal; Otherwise if the indicator falls below 100 during a downtrend, a bearish signal appears. Falling out of its normal range: Extreme points mean that the price has posted its strongest gain or loss for a particular number of moving periods, supporting trend strength; At the same time if the price movement was too rapid, they may indicate possible overbought and oversold areas. Divergence patterns: If the price hits a new high, but the indicator does not, that could mean that investor sentiment is actually lower; And on the contrary if the price falls to a new low, but the indicator does not support the drop, it is a signal that the trend may end soon. ```{image} ../images/Momentum.jpg :align: center 1 2 3 4 5 **Momentum Indicator Formula (Calculation)** ```{code} Momentum = (Current close price / Lagged close price) x 100 Relative Vigor Index(RVI) Relative Vigor Index, developed by John Ehlers, is a technical indicator designed to determine price trend direction. The underlying logic is based on the assumption that close prices tend to be higher than open prices in a bullish environment and lower in a bearish environment. How to Use RVI Indicator The Relative Vigor Index allows to identify the reinforcement of price changes (and therefore may be used within convergence/divergence patterns analysis): Generally the higher the indicator climbs, the stronger is the current relative price increase; Generally the lower the indicator falls, the stronger is the current relative price drop. Together with its signal line (Red), a 4-period moving average of RVI, the indicator (Green) may help to identify changes in prevailing price developments: Crossing the signal line from above, the RVI signals a possible sell opportunity; Crossing the signal line from below, the RVI signals a possible buy opportunity. ```{image} ../images/RVI.jpg :align: center 1 2 3 4 5 6 **Relative Vigor Index Formula (RVI Calculation)** ```{code} Relative Vigor Index (1) = (Close - Open) / (High - Low) Relative Vigor Index (10) = 10-period SMA of Relative Vigor Index (1) Relative Strenth Index(RSI) Relative Strength Index is an indicator developed by Welles Wilder to assess the strength or the weakness of the current price movements and to measure the velocity of price changes by comparing price increases with its losses over a certain period. How to Use RSI Indicator The Relative Strength Index allows to identify possible overbought and oversold areas, but should be considered within trend analysis: Generally if the RSI indicator climbs above 70, the asset may be overbought; If the RSI indicator drops below 30, the asset may be oversold. Leaving extreme areas the indicator may suggest possible corrections or even trend changes: Crossing the overbought boundary from above, the RSI signals a possible sell opportunity; Crossing the oversold boundary from below, the RSI signals a possible buy opportunity. Convergence/divergence patterns may indicate possible trend weakness: If the price climbs to a new high, but the indicator does not, that may be a sign of the uptrend weakness; If the price falls to a new low, but the indicator does not, that may be a sign of the downtrend weakness. ```{image} ../images/RSI.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 **RSI Trading Strategy** RSI trading strategy aims to generate buy and sell signals by the horizontal lines that appear on the chart at the 70 and 30 values. As we have already mentioned above, a move under 30 indicates an oversold condition and a move above 70 signals an overbought condition. Thus, if a trader is looking for a buying opportunity, he watches the indicator dip under 30. A crossing back above 30 is considered by many traders as a confirmation that the trend has turned up. Conversely, if a trader seeks for a selling opportunity, he watches the indicator cross above the 70 line. **Relative Strength Index Formula (RSI Calculation)** ```{code} RSI = 100 \u2013 100/(1 + RS) RS (14) = \u03a3(Upward movements)/\u03a3(|Downward movements|) Stochastic Stochastic indicator is introduced by George Lane to identify price trend direction and possible reversal points by determining the place of the current close price in the most recent price range, as in a sustainable uptrend close prices tend to the higher end of the range and to the lower end in a downtrend. How to Use Stochastic Oscillator The Stochastic oscillator allows to identify possible overbought and oversold areas, but should be considered within trend analysis: Generally if the indicator climbs above 75, the asset may be overbought; If the indicator drops below 25, the asset may be oversold. Leaving extreme areas the indicator may suggest possible turning points: Crossing the overbought boundary from above, the Stochastic signals a possible sell opportunity; Crossing the oversold boundary from below, the Stochastic signals a possible buy opportunity. Crossovers of the indicator with its smoothened signal line, usually a 3-period moving average, may also detect deal opportunities: The indicator suggests going long when crossing the signal line from below; The indicator suggests going short when crossing the signal line from above. Convergence/divergence patterns may indicate possible trend weakness: If the price climbs to a new high, but the indicator does not, that may be a sign of the uptrend weakness; If the price falls to a new low, but the indicator does not, that may be a sign of the downtrend weakness. ```{image} ../images/Stochastic.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 **Stochastic Oscillator Trading Strategy** Stochastic system is based on the observation that in an uptrend closing prices tend to be near the upper end of the price range, and in a downtrend the closing prices tend to be near the lower end of the price range. In the Stochastic strategy two lines - the %K line and the %D line \u2013 are used. The K line is faster and the D line is slower. These lines oscillate from 0 to 100 on the vertical scale. The major signal to consider is the divergence between the D line and the price of the underlying market. When the D line is over 80 and forms two declining peaks with prices moving higher, a bearish divergence occurs. When the D line is below 20 and forms two rising bottoms with prices moving lower, a bullish divergence takes place. Thus, the actual buy and sell signals are triggered when the K line crosses the D line. A sell signal is generated when the K line crosses below the D line from above the 80 level. Accordingly, a buy signal is generated when the K line crosses above the D line bellow the 20 level. **Stochastic Oscillator Formula (Calculation)** ```{code} Stochastic = 100 x ((C \u2013 L)/(H \u2013 L)); Signal = average of the last three Stochastic values; where: C \u2013 latest close price; L \u2013 the lowest price over a given period; H \u2013 the highest price over a given period. Williams Percent Range(WPR,%R) Williams Percent Range (%R) is a technical indicator developed by Larry Williams to identify whether an asset is overbought or oversold and therefore to determine possible turning points. Unlike the Stochastic oscillator Williams Percent Range is a single line fluctuating on a reverse scale. How to Use %R The main goal of Williams Percent Range is to identify possible overbought and oversold areas, however the indicator should be considered within trend analysis: Generally if the indicator climbs above -20, the asset may be overbought; If the indicator drops below -80, the asset may be oversold. Leaving extreme areas the indicator may suggest possible turning points: Crossing the overbought boundary from above, Williams Percent Range signals a possible sell opportunity; Crossing the oversold boundary from below, Williams Percent Range signals a possible buy opportunity. Divergence patterns are rare, but may indicate possible trend weakness: If the price climbs to a new high, but the indicator does not, that may be a sign of the uptrend weakness; If the price falls to a new low, but the indicator does not, that may be a sign of the downtrend weakness. ```{image} ../images/Rpercent.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 **Williams %R Trading Strategy** Williams %r indicator, as already mentioned, helps to determine the points when the market is oversold or overbought. The trading rules of %R strategy are simple: buying when the market is oversold (%R reaches -80% or lower) and selling when the market is overbought (%R reaches -20% or higher). **Williams %R Formula (Calculation)** ```{code} R% = - ((H - C)/(H \u2013 L)) x 100; where: C \u2013 latest close price; L \u2013 the lowest price over a given period; H \u2013 the highest price over a given period. Trend Indicators Average Directional Index(ADI) Average Directional Index (ADX) is a technical indicator developed by Welles Wilder to estimate trend strength and determine probable further price movements by comparing the difference between two consecutive lows with the difference between the highs. How to Use ADX Indicator ADX is a complex indicator, which results from calculation of the Plus Directional Indicator (+DI \u2013 green line) and the Minus Directional Indicator (-DI \u2013 red line), but all of them may be used for trend analysis. In general the indicator (bold line) move is believed to reflect current trend strength: Rising ADX (usually climbing above 25) suggests strengthening market trend \u2013 trend following indicators are becoming more useful; Falling ADX suggests the trend development is doubtful. ADX values below 20 may indicate neutral trend is present \u2013 oscillators are becoming more useful. Use of complex ADX trading system may require additional confirmation signals: Normally if +DI (green line) climbs above -DI (red line), a buy signal is generated; Normally if -DI climbs above +DI, a sell signal is generated. ```{image} ../images/ADX.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 **ADX Trading Strategy** ADX trading strategy aims to identify the strongest trends and distinguish between trending and non-trending conditions. ADX reading above 25 indicates trend strength, while when ADX is below 25, this shows trend weakness. Breakouts, which are not difficult to spot, also help to identify whether ADX is strong enough for the price to trend or not. Thus, when ADX rises from below 25 to above 25, trend is considered strong enough to continue in the direction of the breakout. It\u2019s a common misperception that when ADX line starts falling this is a sign of trend reversal. Whereas, it only means that the trend strength is weakening. As long as ADX is above 25, it should be considered that a falling ADX line is simply less strong. **ADX Formula (Calculation)** ```{code} ADX = MA [((+DI) \u2013 (-DI)) / ((+DI) + (-DI))] x 100; where: +DI \u2013 Plus Directional Indicator; -DI \u2013 Minus Directional Indicator. Moving Average(MA) Moving Average is a technical analysis tool that shows average price over a given period of time, which is used to smoothen price fluctuations and therefore to determine trend direction and strength. Depending of the method of averaging, distinguish between simple moving average (SMA), smoothed moving average (SMMA) and exponential moving average (EMA). How to Use Moving Average Generally moving average curves analysis includes the following principles: Direction of moving average curve reflects prevailing trend over a period; Low-period averaging may give more false signals, while large-period averaging tend to be lagging; To increase (decrease) sensitivity of the curve one should decrease (increase) the period of averaging; Average curves are more useful in trending environment. Comparing moving average with price movements: A strong buy (sell) signal arise if price crosses from below (from above) its rising (falling) moving average curve; A weak buy (sell) signal arise if price crosses from below (from above) its falling (rising) moving average curve. Comparing moving average curves of different periods: A rising (falling) lower-period curve crossing from below (above) another rising (falling) longer-period curve gives a strong buy (sell) signal; A rising (falling) lower-period curve crossing from below (above) another falling (rising) longer-period curve gives a weak buy (sell) signal. ```{image} ../images/MA.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 **Moving Average Trading Strategy** Moving average strategy is essentially a trend following means. Its objective is to signal the beginning of a new trend or a trend reversal. Herein, its main purpose is to track the progress of the trend and not to predict market action in the same sense that technical analysis attempts to do. By its nature, Moving Average is a follower; it follows the market telling that a new trend has begun or reversed only after the fact. **Moving Average Formula (Calculation)** ```{code} SMA = Sum (Close (i), N) / N, where: Close (i) \u2013 current close price; N \u2013 period of averaging. EMA(t) = EMA(t-1) + (K x [Close(t) \u2013 EMA(t-1)]), where: t \u2013 current period; K = 2 / (N + 1), N \u2013 period of averaging. SMA Generally, the term ''Moving Average'' refers to Simple Moving Average. The latter does not predict price direction; it is a lagging indicator and rather defines the current direction. It is an indicator that shows the average value of the instrument's price over a specified period of time. Simple Moving Average Example An SMA is calculated by adding the closing price of the instrument to the number of time periods and then dividing the total number by the number of time periods. The result will be the average price of the instrument over a certain time period. Thus, in order to calculate a 10-day SMA, it's necessary to add closing prices over a 10-day period and divide the total number by 10. As the term ''moving'' implies, prices move according to the point on the chart. This means that always a new calculation is needed that can correspond to the time period of the average used. Thus, you can recalculate a 10-day average by adding the new day and missing out the 10th day and so on. Though simple moving average is used by most traders and analysts, it is criticized by two reasons. The first criticism is that only the time period covered by the average is taken into consideration. And secondly, the SMA gives equal weight to each day's price. Nevertheless, Simple Moving Average has become a preferred method for tracking prices due to its simplicity and quick calculation. By the same simplicity early market analysts performed the market analysis without using complicated chart metrics that are widely applied today. They mainly relied on market prices as the main means of tracking trends and market direction. This process was boring but was confirmed to be profitable and reliable, and up till now it continues to be a popular technical analysis tool extensively used by most traders. Moving Average of Oscillator(OsMA) Moving Average of Oscillator (OsMA) is a technical analysis tool that reflects the difference between an oscillator (MACD) and its moving average (signal line). How to Use OsMa Indicator Extremum points: OsMA switching from falling to rising in extreme areas may be a sign of bullish reversal; OsMA switching from rising to falling may be a sign of bearish reversal. Crossing zero axis: OsMA rising above zero (corresponds to MACD crossing from below its signal line) generates a buy signal; OsMA falling below zero (corresponds to MACD crossing from above its signal line) generates a sell signal. ```{image} ../images/OsMA.jpg :align: center 1 2 3 4 5 **Moving Average of Oscillator Formula (Calculation)** ```{code} OsMA = MACD \u2013 Signal Parabolic(SAR) Parabolic is a trend following indicator developed by Welles Wilder and designed to confirm or reject trend direction, to determine trend end, correction or flat stages as well as to indicate possible exit points. The underlying principle of the indicator can be described as \u201cstop and reverse\u201d (SAR). How to Use Parabolic SAR When using the indicator we should take into consideration its positioning against the price chart as well as its acceleration factor which increases together with the trend. Despite being a popular tool of analysis, it has limitations and may give false signals in frequently changing market conditions. The indicator may signal the following: Trend confirmation If the indicator is plotted below the price graph, it stands for an uptrend; If the indicator is plotted above the price graph, it confirms a downtrend. Exit points determination If the price drops below Parabolic line during an uptrend, there may be sense in closing long positions; If the price rises above Parabolic curve during a downtrend, there may be sense in closing short positions. Signal significance is determined with the use of the acceleration factor. The acceleration factor increases each time the close price is higher than its previous value in an uptrend and lower in a downtrend. It is believed that the indicator is more reliable when the price\u2019s and the indicator\u2019s moves are parallel and less reliable when they converge. ```{image} ../images/Parabolic.jpg :align: center 1 2 3 4 5 6 7 8 9 10 **Parabolic SAR Formula (Calculation)** ```{code} P(t) = P(t-1) + AF x (EP(t-1) \u2013 P(t-1)), where: P(t) \u2013 current value of the indicator; P(t-1) \u2013 value in the previous period; AF \u2013 acceleration factor, generally rising from 0.02 to 0.2 with a step of 0.02; EP(t-1) \u2013 extreme price in the previous period. ZigZag The ZigZag feature on SharpCharts is not an indicator per se, but rather a means to filter out smaller price movements. A ZigZag set at 10% would ignore all price movements less than 10%. Only price movements greater than 10% would be shown. Filtering out smaller movements gives chartists the ability to see the forest instead of just trees. It is important to remember that the ZigZag feature has no predictive power because it draws lines base on hindsight. Any predictive power will come from applications such as Elliott Wave, price pattern analysis or indicators. Chartists can also use the ZigZag with retracements feature to identify Fibonacci retracements and projections. Calculation The ZigZag is based on the chart \u201ctype.\u201d Line and dot charts, which are based on the close, will show the ZigZag based on closing prices. High-Low-Close bars (HLC), Open-High-Low-Close (OHLC) bars and candlesticks, which show the period's high-low range, will show the ZigZag based on this high-low range. A ZigZag based on the high-low range is more likely to change course than a ZigZag based on the close because the high-low range will be much larger and produce bigger swings. The parameters box allows chartists to set the sensitivity of the ZigZag feature. A ZigZag with 5 in the parameter box will filter out all movements less than 5%. A ZigZag(10) will filter out movements less than 10%. If a stock traded from a reaction low of 100 to a high of 109 (+9%), there would not be a line because the move was less than 10%. If the stock advanced from a low of 100 to a high of 110 (+10%), there would be a line from 100 to 110. If the stock continued on to 112, this line would extend to 112 (100 to 112). The ZigZag would not reverse until the stock declined 10% or more from its high. From a high of 112, a stock would have to decline 11.2 points (or to a low of 100.8) to warrant another line. The chart below shows a QQQQ line chart with a 7% ZigZag. The early June bounce was ignored because it was less than 7% (black arrow). The two pullbacks in July were ignored because they were much less than 7% (red arrows). ```{image} ../images/zigz-1-qqqqexam.png :align: center 1 2 3 4 Be careful with the last ZigZag line. Astute chartists will notice that the last ZigZag line is up even though QQQQ advanced just 4.13% (43.36 to 45.15). This is just a temporary line because QQQQ has yet to reach the 7% change threshold. A move to 46.40 is needed for a gain of 7%, which would then warrant a permanent ZigZag line. Should QQQQ fail to reach the 7% threshold on this bounce and then decline below 43, this temporary line would disappear and the prior ZigZag line would continue from the early August high. ```{image} ../images/zigz-2-qqqqexam.png :align: center Elliott Wave Counts The ZigZag feature can be used to filter out small moves and make Elliott Wave counts more straight-forward. The chart below shows the S&P 500 ETF with a 6% ZigZag to filter moves less than 6%. After a little trial and error, 6% was deemed the threshold of importance. An advance or decline greater than 6% was deemed significant enough to warrant a wave for an Elliott count. Keep in mind that this is just an example. The threshold and the wave count are subjective and dependent on individual preferences. Based on the 6% ZigZag, a complete cycle was identified from March 2009 until July 2010. A complete cycle consists of 8 waves, 5 up and 3 down. ```{image} ../images/zigz-4-spyelliott.png :align: center 1 2 3 4 5 6 **Retracements and Projections** Sharpcharts users can choose between the normal \u201cZigZag\u201d and \u201cZigZag (Retrace.).\u201d As shown in the examples above, the normal ZigZag shows lines that move at least a specific percentage. The ZigZag (Retrace.) connects the reaction highs and lows with labels that measure the prior move. The numbers on the dotted lines reflect the difference between the current Zigzag line and the ZigZag line immediately before it. For example, the chart below shows Altera (ALTR) with the 15% ZigZag (Retrace.) feature. Three ZigZag lines have been labeled (1, 2 and 3). The dotted line connecting the low of Line 1 with the low of Line 2 shows a box with 0.638. This means Line 2 is .638 (63.8%) of Line 1. A number below 1 means the line is shorter than the prior line. The dotted line connecting the high of Line 2 with the high of Line 3 shows a box with 1.646. This means Line 3 is 1.646 (164.6%) of Line 2. A number above 1 means the line is longer than the prior line. ```{image} ../images/zigz-3-altrrretrace.png :align: center As you may have guessed, seeing these lines as a percentage of the prior lines makes it possible to assess Fibonacci retracements Fibonacci projections. The August decline (Line 2) retraced around 61.8% of the June-July advance (Line 1). This is a classic Fibonacci retracement. The advance from early September to early November was 1.646 times the August decline. In this sense, the ZigZag (Retrace.) can be used to project the length of an advance. Again, 1.646 is close to the Fibonacci 1.618, which is the Golden Ratio used in many projection estimates. See our ChartSchool article for more on Fibonacci retracements. Conclusions The ZigZag and ZigZag (Retrace.) filter price action and do not have any predictive power. The ZigZag lines simply react when prices move a certain percentage. Chartists can apply an array of technical analysis tools to the ZigZag. Chartists can perform basic trend analysis by comparing reaction highs and lows. Chartists can also overlay the ZigZag feature to look for price patterns that might not be as visible on a normal bar or line chart. The ZigZag has a way of highlighting the important movements and ignoring the noise. When using the ZigZag feature, don't forget to measure the last line to determine if it is temporary or permanent. The last ZigZag line is temporary if the current price change is less than the ZigZag parameter. The last line is permanent when the price change is greater than or equal to the ZigZag parameter. Volume Indicators Accumulation/Distribution(AD) Accumulation/Distribution is a volume-based technical analysis indicator designed to reflect cumulative inflows and outflows of money for an asset by comparing close prices with highs and lows and weighting the relation by trading volumes. How to Use Accumulation/Distribution The Accumulation/Distribution line is used for trend confirmation or possible turning points identification purposes. Trend confirmation: An uptrend in prices is confirmed if A/D line is rising; A downtrend in prices is confirmed if A/D line is falling. Divergence pattern analysis: Rising A/D line along with decreasing prices indicates the downtrend may be weakening to a bullish reversal; Falling A/D along with rising prices indicates the uptrend may be weakening to a bearish reversal. ```{image} ../images/AD.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 **Accumulation/Distribution Indicator Formula (Calculation)** ```{code} A/D(t) = [((C \u2013 L) \u2013 (H \u2013 C)) / (H \u2013 L)] x Vol + A/D(t-1), where: A/D(t) \u2013 current Accumulation/Distribution value; A/D(t-1) \u2013 previous Accumulation/Distribution value; H \u2013 current high; L \u2013 current low; C \u2013 close price; Vol \u2013 volume. Money Flow Index(MFI) Money Flow Index (MFI) is a technical indicator developed to estimate money inflow intensity into a certain asset by comparing price increases and decreases over a given period, but also taking into consideration trading volumes. How to Use Money Flow Index The indicator can be used to identify whether an asset is overbought or oversold, as well as to determine possible turning points. Analyzing extreme (overbought/oversold) areas: If MFI climbs above 80, the asset is generally considered to be overbought. A sell signal appears if MFI crosses the overbought area boundary from above; If MFI drops below 20, the asset is generally considered to be oversold. A buy signal appears if MFI crosses the oversold area boundary from below. Divergence patterns analysis: Rising MFI along with decreasing prices indicates the downtrend may be weakening; Falling MFI along with rising prices indicates the uptrend may be weakening. ```{image} ../images/MFI.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 **Money Flow Index Formula (Calculation)** ```{code} The following steps are required to calculate the index: 1. TP = (H + L + C) / 3; 2. MF = TP*Vol; 3. MR = Sum(MF+) / Sum(MF-); 4. MFI = 100 \u2013 (100 / (1 + MR)), where: TP \u2013 typical price; H \u2013 current high; L \u2013 current low; C \u2013 close price; MF \u2013 money flow (positive (MF+) if current TP > previous TP, negative (MF-) otherwise); Vol \u2013 volume; MR \u2013 money ratio. On-Balance Volume(OBV) On-Balance Volume (OBV) is a cumulative volume-based tool intended to show the relation between the amount of deals and asset\u2019s price movements. How to Use On Balance Volume The On-Balance Volume line is used for trend confirmation or possible turning points identification purposes. Trend confirmation: An uptrend in prices is confirmed if the line is rising; A downtrend in prices is confirmed if the line is falling. Divergence pattern analysis: Rising OBV line along with decreasing prices indicates the downtrend may be weakening to a bullish reversal; Falling OBV along with rising prices indicates the uptrend may be weakening to a bearish reversal. ```{image} ../images/OBV.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 **On-Balance Volume Formula (Calculation)** ```{code} OBV(t) = OBV(t-1) + Vol, if C(t) > C(t-1); OBV(t) = OBV(t-1) \u2013 Vol, if C(t) < C(t-1); OBV(t) = OBV(t-1), if C(t) = C(t-1), where: t \u2013 current period; t-1 \u2013 previous period; C \u2013 close price; Vol \u2013 volume. Volumes Volume indicator is a technical analysis tool, which reflects trading activity of investors for a given time period. How to Use Volume Indicator Volume indicator is generally used together with price analysis to confirm trend strength or highlight its weakness and therefore identify possible upcoming reversals. Trend confirmation: Rising trading volumes during an uptrend confirms bullish mood; Rising trading volumes during a downtrend confirms bearish mood. Trend weakness: If volumes are falling while prices are increasing, that may be a sign of uptrend weakness, as demand for the asset may cease at higher prices. ```{image} ../images/Volumes.jpg :align: center 1 2 3 4 5 **Forex Volumes Calculation** ```{code} Volume = total value/number of transactions during a given period. 5.2 \u81ea\u52a8\u4ea4\u6613\u57fa\u7840 \u7b14\u8005\u7f16\u5199\u4e86\u4e00\u4e9b\u4ea4\u6613\u811a\u672c\uff0c\u5305\u62ecEA\u548cscript\uff0c\u53ef\u8bbf\u95eehttps://github.com/lofyer/mt4-scripts\u8fdb\u884c\u4e0b\u8f7d\u3002 5.3 \u57fa\u672c\u5206\u6790\u57fa\u7840 \u592e\u884c\u6d4b\u91cf\u5566\u3001\u793e\u4f1a\u6307\u6807\u5566\u3001\u7b49\u7b49\u5566\u5566\u5566 5.4 \u8d27\u5e01\u9009\u62e9 5.4.1. \u5386\u53f2\u6570\u636e 5.4.2. \u65b0\u95fb\u4e0e\u62a5\u544a","title":"\u7b2c\u4e94\u7ae0 \u5916\u6c47\u4ea4\u6613\u57fa\u7840"},{"location":"datanote/ch05/#_1","text":"\u5bf9\u7684\uff0c\u4e0a\u6765\u5c31\u7ed9\u4f60\u770b\u6280\u672f\u6307\u6807\uff0c\u7edd\u5bf9\u6ca1\u9519\uff01","title":"\u7b2c\u4e94\u7ae0 \u5916\u6c47\u4ea4\u6613\u57fa\u7840"},{"location":"datanote/ch05/#51","text":"","title":"5.1 \u6280\u672f\u6307\u6807"},{"location":"datanote/ch05/#bill-williams-indicators","text":"","title":"Bill Williams Indicators"},{"location":"datanote/ch05/#accelerationdeceleration-oscillatorac","text":"Acceleration/Deceleration (AC) technical indicator signals the acceleration or deceleration of the current market driving force. How to Use Acceleration/Deceleration The indicator is fluctuating around a median 0.00 (zero) level which corresponds to a relative balance of the market driving force with the acceleration. Positive values signal a growing bullish trend, while negative values may be qualified as a bearish trend development. The indicator changes its direction before any actual trend reversals take place in the market therefore it serves as an early warning sign of probable trend direction changes. The indicator color changes alone are very important as the current green line (irrespectively of the value) warns against long positions the same way as the red one would against selling. To enter the market along with its driving force one needs to watch for both value and color. Two consecutive green columns above the zero level would suggest you to enter the market with a long position while at least two red columns below the zero level might be taken for a command to go short. Fake signals prevail in timeframes smaller than 4 hours. ```{image} ../images/AcceleratorDecelerator.jpg :align: center 1 2 3 4 5 6 7 8 **Acceleration/Deceleration Oscillator Formula (Calculation)** AC bar chart is the difference between the value of 5/34 of the driving force bar chart and 5-period simple moving average, taken from that bar chart. ```{code} AO = SMA(median price, 5)-SMA(median price, 34) AC = AO-SMA(AO, 5)","title":"Acceleration/Deceleration Oscillator(AC)"},{"location":"datanote/ch05/#alligator","text":"Alligator is an indicator designed to signal a trend absence, formation and direction. Bill Williams saw the alligator's behavior as an allegory of the market's one: the resting phase is turning into the price-hunting as the alligator awakes so that to come back to sleep after the feeding is over. The longer the alligator is sleeping the hungrier it gets and the stronger the market move will be. How to Use Alligator Indicator The Alligator indicator consists of 13-, 8- and 5-period smoothed moving averages shifted into the future by 8, 5 and 3 bars respectively which are colored blue, red and green representing the alligator\u2019s jaw, teeth and lips. The Alligator is resting when the three averages are twisted together progressing in a narrow range. The more distant the averages become, the sooner the price move will happen. The averages continuing in an upward direction (green followed by red and blue) suggest an emerging uptrend which we interpret as a signal to buy. The averages following each other in the reversed order down the slope are a strong signal of an unfolding downtrend so selling at this point would be more than appropriate. ```{image} ../images/Alligator.jpg :align: center 1 2 3 4 5 6 7 8 **Alligator Indicator Formula (Calculation)** ```{code} MEDIAN PRICE = (HIGH + LOW) / 2 ALLIGATORS JAW = SMMA (MEDEAN PRICE, 13, 8) ALLIGATORS TEETH = SMMA (MEDEAN PRICE, 8, 5) ALLIGATORS LIPS = SMMA (MEDEAN PRICE, 5, 3)","title":"Alligator"},{"location":"datanote/ch05/#awesome-oscillatorao","text":"Awesome Oscillator (AO) is a momentum indicator reflecting the precise changes in the market driving force which helps to identify the trend\u2019s strength up to the points of formation and reversal. How to Use Awesome Oscillator There are three main signals which may be seen: Saucer - three consecutive columns above the nought line the first two of which must be colored red (the second one is lower than the first one) while the third one is colored green and higher than the previous (second) one. Such a formation would be a clear Buy signal whilst inverted and vertically flipped formation would serve as a Sell signal. Nought line crossing - the histogram crosses the naught line in an upward direction changing its values from negative to that of positive ones. In this situation we have a Buy signal. The Sell signal would be a reversed pattern. Two pikes - the indicator displays a Buy signal when the figure is formed by two consecutive pikes both of which are below the naught line and the later-formed pike is closer to the zero level than the earlier-formed one. The Sell signal would be given by the reverse formation. ```{image} ../images/AwesomeOscillator.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 **Awesome Oscillator Trading Strategy** Awesome Oscillator Strategy includes 3 ways of trading. The first way is to open a sell position when the oscillator is below the zero line forming a peak, and open a buy position when the oscillator is above the zero line forming a gap. Another way is to open a sell position when the oscillator forms two peaks above the zero line, where the second high is lower than the previous one. And, conversely, traders watch to open a buy position when the oscillator forms to lows below the zero line with the last one not as low as the previous one. The third way is to account crossing the zero line. When the oscillator crosses it from up to down, it is time to open a sell position and when it crosses from down to up, it is time to open a buy position. **Awesome Oscillator Formula (Calculation)** Awesome Oscillator is a 34-period simple moving average, plotted through the central points of the bars (H+L)/2, and subtracted from the 5-period simple moving average, graphed across the central points of the bars (H+L)/2. ```{code} MEDIAN PRICE = (HIGH+LOW)/2 AO = SMA(MEDIAN PRICE, 5)-SMA(MEDIAN PRICE, 34) where SMA \u2014 Simple Moving Average.","title":"Awesome Oscillator(AO)"},{"location":"datanote/ch05/#fractals","text":"Fractals is an indicator highlighting the chart\u2019s local heights and lows where the price movement had stopped and reversed. These reversal points are called respectively Highs and Lows. How to Use Fractal Indicator Bill Williams' Fractals are formed around a group of five consecutive bars the first two of which are successively reaching higher (or diving deeper) and the last two descending lower (or growing higher) with the middle one being the highest (or the lowest) result in the group accordingly. Buy fractal is an arrow pointing to the top Sell fractal is an arrow pointing to the bottom ```{image} ../images/Fractals.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #### Gator Oscillator(GO) The Gator Oscillator (GO) is a supplement to the Alligator indicator and is used alongside with it showing the absolute degree of convergence/divergence of the Alligator's three SMAs pointing at the Alligator's periods of slumber and awakeness (i.e. trending and non-trending market phases). **How to Use Gator Oscillator** Being an oscillator in the form of two histograms built on either side of the naught line, the Gator Oscillator plots the absolute difference between the Alligator\u2019s Jaw and Teeth (blue and red lines) in the positive area and the absolute difference between the Alligator\u2019s Teeth and Lips (red and green lines) in the negative area. The histogram\u2019s bars are colored green if exceeding the previous bar\u2019s volume or red if falling short. The bars of the extreme values are in tune with the strong trend forces. The Alligator's activity periods are divided into the following four: 1. Gator awakes - the bars on different sides of the naught line are colored differently. 2. Gator eats - green bars on both sides of the naught line. 3. Gator fills out - single red bar during the \"eating\" phase. 4. Gator sleeps - the bars on both sides are red ```{image} ../images/GatorOscillator(GO).jpg :align: center","title":"Fractals"},{"location":"datanote/ch05/#market-facilitation-index","text":"The Market Facilitation Index is designed for evaluation the willingness of the market to move the price. The indicator's absolute values alone cannot provide any trading signals unlike it's dynamics in relation to the dynamics of the volume. How to Use Market Facilitation Index The absolute values of the index are represented by the histogram's bars while the comparison of the index and volume dynamics are given in colors which are vital in terms of reading the indicator signs. Green bar - both MFI and volume are up. Increasing trading activity means market movement acceleration. We may join the trend. Blue bar - MFI indicator is up, volume is down. The movement is continuing although the volume has dropped. The trend will soon be reversing. Pink bar - MFI indicator is down, volume is up. The slowing down movement while volume is raising may indicate a possible break through, often a U-turn. Brown bar - both MFI and volume are down. The market is no longer interested in the current direction and is looking for signs of a future development. ```{image} ../images/MarketFacilitationIndex.jpg :align: center 1 2 3 4 5 **Market Facilitation Index Formula (Calculation)** ```{code} BW MFI = (HIGH-LOW)/VOLUME","title":"Market Facilitation Index"},{"location":"datanote/ch05/#oscillator","text":"","title":"Oscillator"},{"location":"datanote/ch05/#aroon","text":"Developed by Tushar Chande in 1995, Aroon is an indicator system that determines whether a stock is trending or not and how strong the trend is. \u201cAroon\u201d means \u201cDawn's Early Light\u201d in Sanskrit. Chande chose this name because the indicators are designed to reveal the beginning of a new trend. The Aroon indicators measure the number of periods since price recorded an x-day high or low. There are two separate indicators: Aroon-Up and Aroon-Down. A 25-day Aroon-Up measures the number of days since a 25-day high. A 25-day Aroon-Down measures the number of days since a 25-day low. In this sense, the Aroon indicators are quite different from typical momentum oscillators, which focus on price relative to time. Aroon is unique because it focuses on time relative to price. Chartists can use the Aroon indicators to spot emerging trends, identify consolidations, define correction periods and anticipate reversals. Calculation The Aroon indicators are shown in percentage terms and fluctuate between 0 and 100. Aroon-Up is based on price highs, while Aroon-Down is based on price lows. These two indicators are plotted side-by-side for easy comparison. The default parameter setting in SharpCharts is 25 and the example below is based on 25 days. 1 2 Aroon-Up = ((25 - Days Since 25-day High)/25) x 100 Aroon-Down = ((25 - Days Since 25-day Low)/25) x 100 ```{image} ../images/aron-1-spyexam.png :align: center 1 2 3 4 Aroon declines as the elapsed time between a new high or low increases. 50 is the cut off point. Because 12.5 days marks the exact middle, a reading of exactly 50 is impossible on a daily chart. It is possible with other timeframes. On daily charts, Aroon is either below 50 (48) or above 50 (52). A reading above 50 means a new high or low was recorded within the last 12 days or less. This is the most recent half of the look-back period. A reading below 50 means a new high or low was recorded within the last 13 days or more {(25-13)/25 x 100 = 48). This is the latter half of the look-back period. The table below shows the range of values for 25-day Aroon-Up and 25-day Aroon-Down ```{image} ../images/aron-6-xlsheet.png :align: center Interpretation The Aroon indicators fluctuate above/below a centerline (50) and are bound between 0 and 100. These three levels are important for interpretation. At its most basic, the bulls have the edge when Aroon-Up is above 50 and Aroon-Down is below 50. This indicates a greater propensity for new x-day highs than lows. The converse is true for a downtrend. The bears have the edge when Aroon-Up is below 50 and Aroon-Down is above 50. A surge to 100 indicates that a trend may be emerging. This can be confirmed with a decline in the other Aroon indicator. For example, a move to 100 in Aroon-Up combined with a decline below 30 in Aroon-Down shows upside strength. Consistently high readings mean prices are regularly hitting new highs or new lows for the specified period. Prices are moving consistently higher when Aroon-Up remains in the 70-100 range for an extended period. Conversely, consistently low readings indicate that prices are seldom hitting new highs or lows. Prices are NOT moving lower when Aroon-Down remains in the 0-30 range for an extended period. This does not mean prices are moving higher though. For that we need to check Aroon-Up. New Trend Emerging There are three stages to an emerging trend signal. First, the Aroon lines will cross. Second, the Aroon lines will cross above/below 50. Third, one of the Aroon lines will reach 100. For example, the first stage of an uptrend signal is when Aroon-Up moves above Aroon-Down. This shows new highs becoming more recent than new lows. Keep in mind that Aroon measures the time elapsed, not the price. The second stage is when Aroon-Up moves above 50 and Aroon-Down moves below 50. The third stage is when Aroon-Up reaches 100 and Aroon-Down remains at relatively low levels. The first and second stages do not always occur in that order. Sometimes Aroon-Up will break above 50 and then above Aroon-Down. Reverse engineering the uptrend stages will give you the emerging downtrend signal. Aroon-Down breaks above Aroon-Up, breaks above 50 and reaches 100. ```{image} ../images/aron-2-csxtrend.png :align: center 1 2 3 4 5 6 7 8 The chart above shows CSX Corp (CSX) with weekly bars and 25-week Aroon. First, notice that the downtrend began weakening as Aroon-Down declined below 50 at the end of 2007 (far left). The first stage of an uptrend was signaled when Aroon-Up moved above Aroon-Down in early 2008 (first orange circle). Aroon-Up continued above 50 and hit 100 as Aroon-Down remained at relatively low levels. Notice how Aroon-Up remained near 100 as the advance continued. This emerging uptrend signal lasted until September 2008 when Aroon-Down broke above Aroon-Up, exceeded 50 and surged to 100 (second orange circle). Notice how Aroon-Down remained near 100 as the downtrend extended. The third trend on this chart was signaled when Aroon-Up surged to 100 in June 2009 and remained above 50 for over a year (third orange circle). Also notice that Aroon-Down remained below 50 for over a year. **Consolidation Period** The Aroon indicators signal a consolidation when both are below 50 and/or both are moving lower with parallel lines. It makes sense that consistent readings below 50 are indicative of flat trading. For 25-day Aroon, readings below 50 mean a 25-day high or low has not been recorded in 13 or more days. Prices are clearly flat when not recording new highs or new lows. Similarly, a consolidation is usually forming when both Aroon-Up and Aroon-Down move lower in parallel fashion and the distance between the two lines is quite small. This narrow parallel decline indicates that some sort of trading range is forming. The first Aroon indicator to break above 50 and hit 100 will trigger the next signal. ```{image} ../images/aron-3-omcflat.png :align: center The chart above shows Omnicom (OMC) with the Aroon indicators moving below 50 in a parallel decline. The width of the channel could be narrower, but we can see the consolidation taking shape on the price chart for confirmation. Both Aroon-Up and Aroon-Down were below 50 in the yellow area. Aroon-Up then broke out and surged to 100, which was before the breakout. Further confirmation came with another Aroon-Up surge at the breakout point. This surge/breakout signaled the end of the consolidation and the beginning of the advance. ```{image} ../images/aron-4-lpntflat.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 The next chart shows Lifepoint Hospitals (LPNT) with 25-day Aroon. Both lines moved lower in May with a parallel decline. The distance between the lines was around 25 points throughout the decline. Aroon-Up and Aroon-Down flattened in June and both remained below 50 for around two weeks as the triangle consolidation extended. Aroon-Down (red) was the first to make its move with a break above 50 just before the triangle break on the price chart. Aroon-Down hit 100 as prices broke triangle support to signal a continuation lower. **Conclusions** Aroon-Up and Aroon-Down are complementary indicators that measure the elapsed time between new x-day highs and lows, respectively. They are shown together so chartists can easily identify the stronger of the two and determine the trend bias. A surge in Aroon-Up combined with a decline in Aroon-Down signals the emergence of an uptrend. Conversely, a surge in Aroon-Down combined with a decline in Aroon-Up signals the start of a downtrend. A consolidation is present when both move lower in parallel fashion or when both remain at low levels (below 30). Chartists can use the Aroon indicators to determine if a security is trending or trading flat and then use other indicators to generate appropriate signals. For example, chartists might use a momentum oscillator to identify oversold levels when 25-week Aroon indicates that the long-term trend is up. #### RSI Bar RSI-Bars is an oscillator, developed by IFC Markets in 2014 as the modification of Relative Strength Index (RSI). RSI-Bars characterizes a stability of a price momentum and allows a definition of a trend potential. A distinctive feature of RSI-Bars is that this indicator takes into account the volatility of a considered instrument within the selected timeframe - values of RSI-Bars are defined with account of price OPEN/HIGH/LOW/CLOSE (OHLC) values and are displayed in the form of chart bars. This allows avoiding of false breakdowns of oscillator trend lines and that\u2019s why traders may use methods of a chart analysis more efficiently in this case. [Download RSI-Bars for Metatrader 4](<http://www.ifcmarkets.com/uploads/RSI-B.zip>) Installation guide: ```{code} Download and extract the zip archive with indicator file .ex4; Open the data directory from the main menu of Metatrader 4 terminal:File =>Open Data Folder; Put an indicator file into the folder MQL4/Indicators of Data Folder; Restart the Metatrader 4 terminal; In order to insert an indicator, open the group of custom indicators in the main menu: Insert=>Indicators=>Custom indicator. Advantages of RSI-Bars oscillator In contrast to the classical Relative Strength Index, developed by J.Wilder, RSI-Bars evaluates an internal volatility. Minimal and maximum limits of bars are constructed on the basis of 4 prices (OHLC). A calculated set is used for the selection of a minimum and maximum value of RSI-Bars. Then a bar structure is formed. ```{image} ../images/rsiformula.jpg :align: center 1 2 3 4 5 6 7 8 An analysis of a candlestick price chart in some cases allows avoiding of a trend false breakdowns. It happens due to the account of additional price information and it internal volatility. At the same way RSI-Bars takes into account a true range of price oscillations, not only a characteristic value of a given timeframe. Due to this property, RSI-Bars allows a correct and convenient use of a chart technical analysis. A comparative analysis of RSI and RSI-Bars is represented on the figure below \u2013 we used H4 candlesticks of a most volatile pair, GBP/USD. As it can be seen, RSI(14) has shown and additional breakdown in contrast with RSI-Bars (14). Moreover, RSI-Bars has detected later and therefore more correct finishing of a downtrend. The use of RSI-Bars is demonstrated in trade examples of everyday analytics releases of IFC Markets. ```{image} ../images/RSI-Bars.png :align: center Application The oscillator works most efficiently in a flat motion. A lower and higher bounds of oscillator values are introduced subjectively (for example 30% and 70%) and correspond to overbought and oversold levels; RSI-Bars can take extreme values during a trend motion. That\u2019s why in this case a use of overbought and oversold levels is incorrect; RSI-Bars allows a definition of standard chart analysis instruments - figures, lines of support and resistance, etc. In this case the indicator should be used for a confirmation of technical analysis. We should take into account that RSI-Bars can give preliminary signals of a trend change; Divergence is the strongest signal of RSI-Bars \u2013 opposite directions of price and oscillator movements are detected in this case. This signal is a harbinger of a possible trend weakening; Values of RSI-Bars lie between 0% and 100%.","title":"Aroon"},{"location":"datanote/ch05/#average-true-rangeatr","text":"The Average True Range (ATR) indicator was introduced by Welles Wilder as a tool to measure the market volatility and volatility alone leaving aside attempts to indicate the direction. Unlike the True Range, the ATR also includes volatility of gaps and limit moves. ATR indicator is good at valuating the market's interest in the price moves for strong moves and break-outs are normally accompanied by large ranges. How to Use ATR Indicator The ATR is used with 14 periods with daily and longer timeframes and reflects the volatility values that are in relation to the trading instrument's price. Low ATR values would normally correspond to a range trading while high values may indicate a trend breakout or breakdown. Average True Range Indicator ```{image} ../images/AverageTrueRange.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 **Average True Range Formula (ATR Calculation)** Average True Range is a moving average of the True Range which is the greatest of the following three values: - The distance from today's high to today's low. - The distance from yesterday's close to today's high. - The distance from yesterday's close to today's low. #### Bollinger Bands The Bollinger Bands indicator (named after its inventor) displays the current market volatility changes, confirms the direction, warns of a possible continuation or break-out of the trend, periods of consolidation, increasing volatility for break-outs as well as pinpoints local highs and lows. **How to Use Bollinger Bands** The indicator consists of the three moving averages: - Upper band - 20-day simple moving average (SMA) plus double standard price deviation. - Middle band - 20-day SMA. - Lower band - 20-day SMA minus double standard price deviation. The increasing distance between the upper and the lower bands while volatility is growing, suggests of a price developing in a trend which direction correlates with the direction of the Middle line. In contrast to the above, at times of decreasing volatility when the bands are closing in, we should be expecting the price to move sidewards in a range. The price moving outside the Bands may indicate either the trend\u2019s continuation (when the bands are floating apart as the volatility increases) or the U-turn of the trend if the initial movement is exhausted. Either way each of the scenarios must be confirmed by other indicators such as RSI, ADX or MACD. Anyhow the price crossing of the Middle line from below or above may be interpreted as a signal to buy or to sell respectively. ```{image} ../images/BollingerBands.jpg :align: center Bollinger Bands Trading Strategy Bollinger Bands trading strategy aims to profit from oversold or overbought conditions on the market. Prices are considered overextended on the upside when they touch the upper band (overbought). They are overextended on the downside, when they touch the lower band (oversold). This strategy is used as an immediate signal to buy or sell the security. The usage of upper and lower bands as price targets is referred to as the simplest way of using Bollinger Bands strategy. If prices cross below the average, the lower band becomes the lower price target. If the prices cross above the same average, the upper band identifies the upper price target. In a Bollinger Band trading system an uptrend is shown by prices fluctuating between upper and middle bands. In such cases if prices cross below the middle band, this warns of a trend reversal to the downside indicating a sell signal. In a downtrend, prices fluctuate between middle and lower bands, and the price crossing above the middle band warns of a trend reversal to the upside, indicating a buy signal. Bollinger Bands Formula (Calculation) 1 2 3 4 5 6 7 8 9 10 The middle line (ML) is a regular Moving Average: ML = SUM [CLOSE, N]/N The top line (TL) is ML a deviation (D) higher: TL = ML + (D*StdDev) The bottom line (BL) is ML a deviation (D) lower. BL = ML \u2014 (D*StdDev) Where: N \u2014 number of periods used in calculation; SMA \u2014 Simple Moving Average; StdDev \u2014 Standard Deviation.","title":"Average True Range(ATR)"},{"location":"datanote/ch05/#commodity-channel-indexcci","text":"The Commodity Channel Index is an indicator by Donald Lambert. Despite the original purpose to identify new trends, it\u2019s nowadays widely used to measure the current price levels in relation to the average one. How to Use CCI Indicator Commodity Channel Index indicator oscillates around the naught line tending to stay within the range from -100 to +100. The naught line represents the level of an average balanced price. The higher the indicator surges above the naught line the more overvalued the security is. The further the CCI indicator plunges into the negative area the more potential for growth the price may have. Still the unbalanced price alone may not serve as a clear indicator neither to the direction the price is following nor to its strength. There are critical values and the crossing directions which need to be looked at closely: Exceeding past the 100 level suggests a possible further upward movement Decreasing past the 100 level indicates a U-turn and serves as a signal to sell. Decreasing past the -100 level suggests a possible further downward movement Exceeding past the -100 level indicates a U-turn and serves as a signal to buy. Crossing the naught line upwards from below serves as a confirmation to buy Crossing the naught line downwards from above serves a confirmation to sell. Smaller CCI indicator period increases its sensitivity. Shifting critical levels to 200 allows to exclude insignificant price fluctuations. ```{image} ../images/CommodityChannelIndex.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 **CCI Trading Strategy** CCI trading strategy is used by most traders, investors and chartists as an overbought or oversold oscillator. The basic strategy of CCI is to watch the readings above +100 and below -100. The readings above +100 are considered overbought and generate buy signals. The readings below -100 are considered oversold and generate sell signals. Though the Commodity Channel Index was initially developed for commodities, it is also used for trading stock index futures and options. **Caculation** The example below is based on a 20-period Commodity Channel Index (CCI) calculation. The number of CCI periods is also used for the calculations of the simple moving average and Mean Deviation. ```{code} CCI = (Typical Price - 20-period SMA of TP) / (.015 x Mean Deviation) Typical Price (TP) = (High + Low + Close)/3 Constant = .015 There are four steps to calculating the Mean Deviation. First, subtract the most recent 20-period average of the typical price from each period's typical price. Second, take the absolute values of these numbers. Third, sum the absolute values. Fourth, divide by the total number of periods (20). Lambert set the constant at .015 to ensure that approximately 70 to 80 percent of CCI values would fall between -100 and +100. This percentage also depends on the look-back period. A shorter CCI (10 periods) will be more volatile with a smaller percentage of values between +100 and -100. Conversely, a longer CCI (40 periods) will have a higher percentage of values between +100 and -100. ```{image} ../images/cci-1-msftsheet.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 #### DeMarker(DeM) This indicator was introduced by Tom DeMark as a tool to identify emerging buying and selling opportunities. It demonstrates the price depletion phases which usually correspond with the price highs and bottoms. The DeMarker indicator proved to be efficient at identifying trend break-downs as well as spotting intra-day entry and exit points. **How to Use DeMarker Indicator** The indicator fluctuates with a range between 0 to 1 and is indicative of lower volatility and a possible price drop when reading 0.7 and higher, and signals a possible price increase when reading below 0.3. ```{image} ../images/DeMarker.jpg :align: center DeMarker Indicator Formula (Calculation) The DeMarker indicator is the sum of all price increment values recorded during the \"i\" period divided by the price minima: 1 2 3 4 5 6 The DeMax(i) is calculated: If high(i) > high(i-1) , then DeMax(i) = high(i)-high(i-1), otherwise DeMax(i) = 0 The DeMin(i) is calculated: If low(i) < low(i-1), then DeMin(i) = low(i-1)-low(i), otherwise DeMin(i) = 0 The value of the DeMarker is calculated as: DMark(i) = SMA(DeMax, N)/(SMA(DeMax, N)+SMA(DeMin, N))","title":"Commodity Channel Index(CCI)"},{"location":"datanote/ch05/#envelopes","text":"The Envelopes indicator reflects the price overbought and oversold conditions helping to identify the entry or exit points as well as possible trend break-downs. How to Use Envelopes Indicator The Envelopes indicator consists of two SMAs that together form a flexible channel in which the price evolves. The averages are plotted around a Moving Average in a constant percentage distance which may be adjusted according to the current market volatility. Each line serves as a margin of the price fluctuation range. In a trending market take only oversold signals in an uptrend conditions and overbought signals in a downtrend conditions. In a ranging market the price reaching the top line serves as a sell signal, while the price at the lower line generates a signal to buy. ```{image} ../images/Envelopes.jpg :align: center 1 2 3 4 5 6 7 8 9 10 **Envelopes Indicator Formula (Calculation)** ```{code} Upper Band = SMA(CLOSE, N)*[1+K/1000] Lower Band = SMA(CLOSE, N)*[1-K/1000] Where: SMA \u2014 Simple Moving Average; N \u2014 averaging period; K/1000 \u2014 the value of shifting from the average (measured in basis points).","title":"Envelopes"},{"location":"datanote/ch05/#force-index","text":"The Force Index indicator invented by Alexander Elder measures the power behind every price move based on their three essential elements, e.g., direction, extent and volume. The oscillator fluctuates around the zero, i.e., a point of a relative balance between power shifts. How to Use Force Index The Force Index allows to identify the reinforcement of different time scale trends: The indicator should be made more sensitive by decreasing its period for short trends. The indicator should be smoothed by increasing its period for longer trends. The Force Index may strongly imply a trend change: Break-down of an uptrend when the indicator's value is changing from positive to negative and price and indicator show divergence. Break-down of a downtrend when the indicator's value is changing from negative to positive and price and indicator show convergence. Together with a trend-following indicator the Force Index can help identify trend corrections: An uptrend correction when the indicator bounces off the low. A downtrend correction when the indicator slides from a pike. ```{image} ../images/ForceIndex.jpg :align: center 1 2 3 4 5 6 **Force Index Formula (Calculation)** ```{code} Force Index(1) = {Close (current period) - Close (prior period)} x Volume Force Index(13) = 13-period EMA of Force Index(1)","title":"Force Index"},{"location":"datanote/ch05/#ichimoku","text":"The Ichimoku Kinko Hyo (Equilibrium chart at a glance) is a comprehensive technical analysis tool introduced in 1968 by Tokyo columnist Goichi Hosoda. The concept of the system was to provide an immediate vision of trend sentiment, momentum and strength at a glance perceiving all the Ichimoku's five components and a price in terms of interactions among them of a cyclical type related to that of human group dynamics. How to Use Ichimoku Indicator The Ichimoku indicator consists of five lines which may all serve as flexible support or resistance lines, whose crossovers may as well be assumed as additional signals: Tenkan-Sen (Conversion line, blue) Kijun-Sen (Base line, red) Senkou Span A (Leading span A, green boundary of the cloud) Senkou Span B (Leading span B, red boundary of the cloud) Chikou Span (Lagging span, green) Kumo (Cloud) is a central element of the Ichimoku system and represents support or resistance areas. It is formed by Leading Span A and Leading Span B. Determining the trend persistence and corrections: Price moving above the cloud indicates an uptrend Price moving below the cloud indicates a downtrend Price moving within the cloud indicates a sideways trend Cloud turning from green to red indicates a correction during an uptrend Cloud turning from red to green indicates a correction during a downtrend Determining support and resistance: Leading span A serves as a first support line for an uptrend Leading span B serves as a second support line for an uptrend Leading span A serves as a first resistance line for a downtrend Leading span B serves as a second resistance line for a downtrend Strong Buy/Sell signals occurring above the cloud: Conversion line crosses Base line up from below is a signal to buy Conversion line crosses Base line down from above is a signal to sell Less reliable Buy/Sell signals occurring within the cloud: Conversion line crosses Base line up from below is a signal to buy Conversion line crosses Base line down from above is a signal to sell ```{image} ../images/Ichimoku.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 **Ichimoku Trading Strategy** Traders use the Ichimoku strategy to identify the trend. For a bullish signal this trading strategy sets three criteria. First, the trend is bullish when prices reach above the lowest line of the cloud. Second, a bullish signal triggers when prices reverse and reach above the Conversion Line. And third, the trend is bullish when the price moves below the Base Line. **Ichimoku Formula (Ichimoku Kinko Hyo Calculation)** ```{code} Tenkan-Sen (Conversion line, blue) is (9-period high + 9-period low)/2 Kijun-Sen (Base line, red) is (26-period high + 26-period low)/2 Senkou Span A (Leading span A, green boundary of the cloud) is (Conversion Line + Base Line)/2 Senkou Span B (Leading span B, red boundary of the cloud) is (52-period high + 52-period low)/2 Chikou Span (Lagging span, green) is close price plotted 26 periods in the past","title":"Ichimoku"},{"location":"datanote/ch05/#macd","text":"Moving-Average Convergence/Divergence Oscillator, commonly referred to as MACD indicator, is developed by Gerald Appel which is designed to reveal changes in the direction and strength of the trend by combining signals from three time series of moving average curves. How to Use MACD Indicator Three main signals generated by the MACD indicator (blue line) are crossovers with the signal line (red line), with the x-axis and divergence patterns. Crossovers with the signal line: If the MACD line is rising faster than the Signal line and crosses it from below, the signal is interpreted as bullish and suggests acceleration of price growth; If the MACD line is falling faster than the Signal line and crosses it from above, the signal is interpreted as bearish and suggests extension of price losses; Crossovers with the x-axis: A bullish signal appears if the MACD line climbs above zero; A bearish signal presents if the MACD line falls below zero. Convergence/Divergence: If the MACD line is trending in the same direction as the price, the pattern is known as convergence, which confirms the price move; If they move in opposite directions, the pattern is divergence. For example, if the price reaches a new high, but the indicator does not, this may be a sign of further weakness. ```{image} ../images/MACD.jpg :align: center 1 2 3 4 5 6 7 **MACD Indicator Formula (MACD Calculation)** ```{code} MACD line = 12-period EMA \u2013 26-period EMA Signal line = 9-period EMA Histogram = MACD line \u2013 Signal line","title":"MACD"},{"location":"datanote/ch05/#momentum","text":"Momentum Oscillator is an indicator that shows trend direction and measures how quickly the price is changing by comparing current and past prices. How to Use Momentum Indicator The indicator is represented by a line, which oscillates around 100. Being an oscillator, momentum should be used within price trend analysis. Crossing the x-axis: It is believed that if the indicator climbs above 100 during an uptrend, it is a bullish signal; Otherwise if the indicator falls below 100 during a downtrend, a bearish signal appears. Falling out of its normal range: Extreme points mean that the price has posted its strongest gain or loss for a particular number of moving periods, supporting trend strength; At the same time if the price movement was too rapid, they may indicate possible overbought and oversold areas. Divergence patterns: If the price hits a new high, but the indicator does not, that could mean that investor sentiment is actually lower; And on the contrary if the price falls to a new low, but the indicator does not support the drop, it is a signal that the trend may end soon. ```{image} ../images/Momentum.jpg :align: center 1 2 3 4 5 **Momentum Indicator Formula (Calculation)** ```{code} Momentum = (Current close price / Lagged close price) x 100","title":"Momentum"},{"location":"datanote/ch05/#relative-vigor-indexrvi","text":"Relative Vigor Index, developed by John Ehlers, is a technical indicator designed to determine price trend direction. The underlying logic is based on the assumption that close prices tend to be higher than open prices in a bullish environment and lower in a bearish environment. How to Use RVI Indicator The Relative Vigor Index allows to identify the reinforcement of price changes (and therefore may be used within convergence/divergence patterns analysis): Generally the higher the indicator climbs, the stronger is the current relative price increase; Generally the lower the indicator falls, the stronger is the current relative price drop. Together with its signal line (Red), a 4-period moving average of RVI, the indicator (Green) may help to identify changes in prevailing price developments: Crossing the signal line from above, the RVI signals a possible sell opportunity; Crossing the signal line from below, the RVI signals a possible buy opportunity. ```{image} ../images/RVI.jpg :align: center 1 2 3 4 5 6 **Relative Vigor Index Formula (RVI Calculation)** ```{code} Relative Vigor Index (1) = (Close - Open) / (High - Low) Relative Vigor Index (10) = 10-period SMA of Relative Vigor Index (1)","title":"Relative Vigor Index(RVI)"},{"location":"datanote/ch05/#relative-strenth-indexrsi","text":"Relative Strength Index is an indicator developed by Welles Wilder to assess the strength or the weakness of the current price movements and to measure the velocity of price changes by comparing price increases with its losses over a certain period. How to Use RSI Indicator The Relative Strength Index allows to identify possible overbought and oversold areas, but should be considered within trend analysis: Generally if the RSI indicator climbs above 70, the asset may be overbought; If the RSI indicator drops below 30, the asset may be oversold. Leaving extreme areas the indicator may suggest possible corrections or even trend changes: Crossing the overbought boundary from above, the RSI signals a possible sell opportunity; Crossing the oversold boundary from below, the RSI signals a possible buy opportunity. Convergence/divergence patterns may indicate possible trend weakness: If the price climbs to a new high, but the indicator does not, that may be a sign of the uptrend weakness; If the price falls to a new low, but the indicator does not, that may be a sign of the downtrend weakness. ```{image} ../images/RSI.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 **RSI Trading Strategy** RSI trading strategy aims to generate buy and sell signals by the horizontal lines that appear on the chart at the 70 and 30 values. As we have already mentioned above, a move under 30 indicates an oversold condition and a move above 70 signals an overbought condition. Thus, if a trader is looking for a buying opportunity, he watches the indicator dip under 30. A crossing back above 30 is considered by many traders as a confirmation that the trend has turned up. Conversely, if a trader seeks for a selling opportunity, he watches the indicator cross above the 70 line. **Relative Strength Index Formula (RSI Calculation)** ```{code} RSI = 100 \u2013 100/(1 + RS) RS (14) = \u03a3(Upward movements)/\u03a3(|Downward movements|)","title":"Relative Strenth Index(RSI)"},{"location":"datanote/ch05/#stochastic","text":"Stochastic indicator is introduced by George Lane to identify price trend direction and possible reversal points by determining the place of the current close price in the most recent price range, as in a sustainable uptrend close prices tend to the higher end of the range and to the lower end in a downtrend. How to Use Stochastic Oscillator The Stochastic oscillator allows to identify possible overbought and oversold areas, but should be considered within trend analysis: Generally if the indicator climbs above 75, the asset may be overbought; If the indicator drops below 25, the asset may be oversold. Leaving extreme areas the indicator may suggest possible turning points: Crossing the overbought boundary from above, the Stochastic signals a possible sell opportunity; Crossing the oversold boundary from below, the Stochastic signals a possible buy opportunity. Crossovers of the indicator with its smoothened signal line, usually a 3-period moving average, may also detect deal opportunities: The indicator suggests going long when crossing the signal line from below; The indicator suggests going short when crossing the signal line from above. Convergence/divergence patterns may indicate possible trend weakness: If the price climbs to a new high, but the indicator does not, that may be a sign of the uptrend weakness; If the price falls to a new low, but the indicator does not, that may be a sign of the downtrend weakness. ```{image} ../images/Stochastic.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 **Stochastic Oscillator Trading Strategy** Stochastic system is based on the observation that in an uptrend closing prices tend to be near the upper end of the price range, and in a downtrend the closing prices tend to be near the lower end of the price range. In the Stochastic strategy two lines - the %K line and the %D line \u2013 are used. The K line is faster and the D line is slower. These lines oscillate from 0 to 100 on the vertical scale. The major signal to consider is the divergence between the D line and the price of the underlying market. When the D line is over 80 and forms two declining peaks with prices moving higher, a bearish divergence occurs. When the D line is below 20 and forms two rising bottoms with prices moving lower, a bullish divergence takes place. Thus, the actual buy and sell signals are triggered when the K line crosses the D line. A sell signal is generated when the K line crosses below the D line from above the 80 level. Accordingly, a buy signal is generated when the K line crosses above the D line bellow the 20 level. **Stochastic Oscillator Formula (Calculation)** ```{code} Stochastic = 100 x ((C \u2013 L)/(H \u2013 L)); Signal = average of the last three Stochastic values; where: C \u2013 latest close price; L \u2013 the lowest price over a given period; H \u2013 the highest price over a given period.","title":"Stochastic"},{"location":"datanote/ch05/#williams-percent-rangewprr","text":"Williams Percent Range (%R) is a technical indicator developed by Larry Williams to identify whether an asset is overbought or oversold and therefore to determine possible turning points. Unlike the Stochastic oscillator Williams Percent Range is a single line fluctuating on a reverse scale. How to Use %R The main goal of Williams Percent Range is to identify possible overbought and oversold areas, however the indicator should be considered within trend analysis: Generally if the indicator climbs above -20, the asset may be overbought; If the indicator drops below -80, the asset may be oversold. Leaving extreme areas the indicator may suggest possible turning points: Crossing the overbought boundary from above, Williams Percent Range signals a possible sell opportunity; Crossing the oversold boundary from below, Williams Percent Range signals a possible buy opportunity. Divergence patterns are rare, but may indicate possible trend weakness: If the price climbs to a new high, but the indicator does not, that may be a sign of the uptrend weakness; If the price falls to a new low, but the indicator does not, that may be a sign of the downtrend weakness. ```{image} ../images/Rpercent.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 **Williams %R Trading Strategy** Williams %r indicator, as already mentioned, helps to determine the points when the market is oversold or overbought. The trading rules of %R strategy are simple: buying when the market is oversold (%R reaches -80% or lower) and selling when the market is overbought (%R reaches -20% or higher). **Williams %R Formula (Calculation)** ```{code} R% = - ((H - C)/(H \u2013 L)) x 100; where: C \u2013 latest close price; L \u2013 the lowest price over a given period; H \u2013 the highest price over a given period.","title":"Williams Percent Range(WPR,%R)"},{"location":"datanote/ch05/#trend-indicators","text":"","title":"Trend Indicators"},{"location":"datanote/ch05/#average-directional-indexadi","text":"Average Directional Index (ADX) is a technical indicator developed by Welles Wilder to estimate trend strength and determine probable further price movements by comparing the difference between two consecutive lows with the difference between the highs. How to Use ADX Indicator ADX is a complex indicator, which results from calculation of the Plus Directional Indicator (+DI \u2013 green line) and the Minus Directional Indicator (-DI \u2013 red line), but all of them may be used for trend analysis. In general the indicator (bold line) move is believed to reflect current trend strength: Rising ADX (usually climbing above 25) suggests strengthening market trend \u2013 trend following indicators are becoming more useful; Falling ADX suggests the trend development is doubtful. ADX values below 20 may indicate neutral trend is present \u2013 oscillators are becoming more useful. Use of complex ADX trading system may require additional confirmation signals: Normally if +DI (green line) climbs above -DI (red line), a buy signal is generated; Normally if -DI climbs above +DI, a sell signal is generated. ```{image} ../images/ADX.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 **ADX Trading Strategy** ADX trading strategy aims to identify the strongest trends and distinguish between trending and non-trending conditions. ADX reading above 25 indicates trend strength, while when ADX is below 25, this shows trend weakness. Breakouts, which are not difficult to spot, also help to identify whether ADX is strong enough for the price to trend or not. Thus, when ADX rises from below 25 to above 25, trend is considered strong enough to continue in the direction of the breakout. It\u2019s a common misperception that when ADX line starts falling this is a sign of trend reversal. Whereas, it only means that the trend strength is weakening. As long as ADX is above 25, it should be considered that a falling ADX line is simply less strong. **ADX Formula (Calculation)** ```{code} ADX = MA [((+DI) \u2013 (-DI)) / ((+DI) + (-DI))] x 100; where: +DI \u2013 Plus Directional Indicator; -DI \u2013 Minus Directional Indicator.","title":"Average Directional Index(ADI)"},{"location":"datanote/ch05/#moving-averagema","text":"Moving Average is a technical analysis tool that shows average price over a given period of time, which is used to smoothen price fluctuations and therefore to determine trend direction and strength. Depending of the method of averaging, distinguish between simple moving average (SMA), smoothed moving average (SMMA) and exponential moving average (EMA). How to Use Moving Average Generally moving average curves analysis includes the following principles: Direction of moving average curve reflects prevailing trend over a period; Low-period averaging may give more false signals, while large-period averaging tend to be lagging; To increase (decrease) sensitivity of the curve one should decrease (increase) the period of averaging; Average curves are more useful in trending environment. Comparing moving average with price movements: A strong buy (sell) signal arise if price crosses from below (from above) its rising (falling) moving average curve; A weak buy (sell) signal arise if price crosses from below (from above) its falling (rising) moving average curve. Comparing moving average curves of different periods: A rising (falling) lower-period curve crossing from below (above) another rising (falling) longer-period curve gives a strong buy (sell) signal; A rising (falling) lower-period curve crossing from below (above) another falling (rising) longer-period curve gives a weak buy (sell) signal. ```{image} ../images/MA.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 **Moving Average Trading Strategy** Moving average strategy is essentially a trend following means. Its objective is to signal the beginning of a new trend or a trend reversal. Herein, its main purpose is to track the progress of the trend and not to predict market action in the same sense that technical analysis attempts to do. By its nature, Moving Average is a follower; it follows the market telling that a new trend has begun or reversed only after the fact. **Moving Average Formula (Calculation)** ```{code} SMA = Sum (Close (i), N) / N, where: Close (i) \u2013 current close price; N \u2013 period of averaging. EMA(t) = EMA(t-1) + (K x [Close(t) \u2013 EMA(t-1)]), where: t \u2013 current period; K = 2 / (N + 1), N \u2013 period of averaging.","title":"Moving Average(MA)"},{"location":"datanote/ch05/#sma","text":"Generally, the term ''Moving Average'' refers to Simple Moving Average. The latter does not predict price direction; it is a lagging indicator and rather defines the current direction. It is an indicator that shows the average value of the instrument's price over a specified period of time. Simple Moving Average Example An SMA is calculated by adding the closing price of the instrument to the number of time periods and then dividing the total number by the number of time periods. The result will be the average price of the instrument over a certain time period. Thus, in order to calculate a 10-day SMA, it's necessary to add closing prices over a 10-day period and divide the total number by 10. As the term ''moving'' implies, prices move according to the point on the chart. This means that always a new calculation is needed that can correspond to the time period of the average used. Thus, you can recalculate a 10-day average by adding the new day and missing out the 10th day and so on. Though simple moving average is used by most traders and analysts, it is criticized by two reasons. The first criticism is that only the time period covered by the average is taken into consideration. And secondly, the SMA gives equal weight to each day's price. Nevertheless, Simple Moving Average has become a preferred method for tracking prices due to its simplicity and quick calculation. By the same simplicity early market analysts performed the market analysis without using complicated chart metrics that are widely applied today. They mainly relied on market prices as the main means of tracking trends and market direction. This process was boring but was confirmed to be profitable and reliable, and up till now it continues to be a popular technical analysis tool extensively used by most traders.","title":"SMA"},{"location":"datanote/ch05/#moving-average-of-oscillatorosma","text":"Moving Average of Oscillator (OsMA) is a technical analysis tool that reflects the difference between an oscillator (MACD) and its moving average (signal line). How to Use OsMa Indicator Extremum points: OsMA switching from falling to rising in extreme areas may be a sign of bullish reversal; OsMA switching from rising to falling may be a sign of bearish reversal. Crossing zero axis: OsMA rising above zero (corresponds to MACD crossing from below its signal line) generates a buy signal; OsMA falling below zero (corresponds to MACD crossing from above its signal line) generates a sell signal. ```{image} ../images/OsMA.jpg :align: center 1 2 3 4 5 **Moving Average of Oscillator Formula (Calculation)** ```{code} OsMA = MACD \u2013 Signal","title":"Moving Average of Oscillator(OsMA)"},{"location":"datanote/ch05/#parabolicsar","text":"Parabolic is a trend following indicator developed by Welles Wilder and designed to confirm or reject trend direction, to determine trend end, correction or flat stages as well as to indicate possible exit points. The underlying principle of the indicator can be described as \u201cstop and reverse\u201d (SAR). How to Use Parabolic SAR When using the indicator we should take into consideration its positioning against the price chart as well as its acceleration factor which increases together with the trend. Despite being a popular tool of analysis, it has limitations and may give false signals in frequently changing market conditions. The indicator may signal the following: Trend confirmation If the indicator is plotted below the price graph, it stands for an uptrend; If the indicator is plotted above the price graph, it confirms a downtrend. Exit points determination If the price drops below Parabolic line during an uptrend, there may be sense in closing long positions; If the price rises above Parabolic curve during a downtrend, there may be sense in closing short positions. Signal significance is determined with the use of the acceleration factor. The acceleration factor increases each time the close price is higher than its previous value in an uptrend and lower in a downtrend. It is believed that the indicator is more reliable when the price\u2019s and the indicator\u2019s moves are parallel and less reliable when they converge. ```{image} ../images/Parabolic.jpg :align: center 1 2 3 4 5 6 7 8 9 10 **Parabolic SAR Formula (Calculation)** ```{code} P(t) = P(t-1) + AF x (EP(t-1) \u2013 P(t-1)), where: P(t) \u2013 current value of the indicator; P(t-1) \u2013 value in the previous period; AF \u2013 acceleration factor, generally rising from 0.02 to 0.2 with a step of 0.02; EP(t-1) \u2013 extreme price in the previous period.","title":"Parabolic(SAR)"},{"location":"datanote/ch05/#zigzag","text":"The ZigZag feature on SharpCharts is not an indicator per se, but rather a means to filter out smaller price movements. A ZigZag set at 10% would ignore all price movements less than 10%. Only price movements greater than 10% would be shown. Filtering out smaller movements gives chartists the ability to see the forest instead of just trees. It is important to remember that the ZigZag feature has no predictive power because it draws lines base on hindsight. Any predictive power will come from applications such as Elliott Wave, price pattern analysis or indicators. Chartists can also use the ZigZag with retracements feature to identify Fibonacci retracements and projections. Calculation The ZigZag is based on the chart \u201ctype.\u201d Line and dot charts, which are based on the close, will show the ZigZag based on closing prices. High-Low-Close bars (HLC), Open-High-Low-Close (OHLC) bars and candlesticks, which show the period's high-low range, will show the ZigZag based on this high-low range. A ZigZag based on the high-low range is more likely to change course than a ZigZag based on the close because the high-low range will be much larger and produce bigger swings. The parameters box allows chartists to set the sensitivity of the ZigZag feature. A ZigZag with 5 in the parameter box will filter out all movements less than 5%. A ZigZag(10) will filter out movements less than 10%. If a stock traded from a reaction low of 100 to a high of 109 (+9%), there would not be a line because the move was less than 10%. If the stock advanced from a low of 100 to a high of 110 (+10%), there would be a line from 100 to 110. If the stock continued on to 112, this line would extend to 112 (100 to 112). The ZigZag would not reverse until the stock declined 10% or more from its high. From a high of 112, a stock would have to decline 11.2 points (or to a low of 100.8) to warrant another line. The chart below shows a QQQQ line chart with a 7% ZigZag. The early June bounce was ignored because it was less than 7% (black arrow). The two pullbacks in July were ignored because they were much less than 7% (red arrows). ```{image} ../images/zigz-1-qqqqexam.png :align: center 1 2 3 4 Be careful with the last ZigZag line. Astute chartists will notice that the last ZigZag line is up even though QQQQ advanced just 4.13% (43.36 to 45.15). This is just a temporary line because QQQQ has yet to reach the 7% change threshold. A move to 46.40 is needed for a gain of 7%, which would then warrant a permanent ZigZag line. Should QQQQ fail to reach the 7% threshold on this bounce and then decline below 43, this temporary line would disappear and the prior ZigZag line would continue from the early August high. ```{image} ../images/zigz-2-qqqqexam.png :align: center Elliott Wave Counts The ZigZag feature can be used to filter out small moves and make Elliott Wave counts more straight-forward. The chart below shows the S&P 500 ETF with a 6% ZigZag to filter moves less than 6%. After a little trial and error, 6% was deemed the threshold of importance. An advance or decline greater than 6% was deemed significant enough to warrant a wave for an Elliott count. Keep in mind that this is just an example. The threshold and the wave count are subjective and dependent on individual preferences. Based on the 6% ZigZag, a complete cycle was identified from March 2009 until July 2010. A complete cycle consists of 8 waves, 5 up and 3 down. ```{image} ../images/zigz-4-spyelliott.png :align: center 1 2 3 4 5 6 **Retracements and Projections** Sharpcharts users can choose between the normal \u201cZigZag\u201d and \u201cZigZag (Retrace.).\u201d As shown in the examples above, the normal ZigZag shows lines that move at least a specific percentage. The ZigZag (Retrace.) connects the reaction highs and lows with labels that measure the prior move. The numbers on the dotted lines reflect the difference between the current Zigzag line and the ZigZag line immediately before it. For example, the chart below shows Altera (ALTR) with the 15% ZigZag (Retrace.) feature. Three ZigZag lines have been labeled (1, 2 and 3). The dotted line connecting the low of Line 1 with the low of Line 2 shows a box with 0.638. This means Line 2 is .638 (63.8%) of Line 1. A number below 1 means the line is shorter than the prior line. The dotted line connecting the high of Line 2 with the high of Line 3 shows a box with 1.646. This means Line 3 is 1.646 (164.6%) of Line 2. A number above 1 means the line is longer than the prior line. ```{image} ../images/zigz-3-altrrretrace.png :align: center As you may have guessed, seeing these lines as a percentage of the prior lines makes it possible to assess Fibonacci retracements Fibonacci projections. The August decline (Line 2) retraced around 61.8% of the June-July advance (Line 1). This is a classic Fibonacci retracement. The advance from early September to early November was 1.646 times the August decline. In this sense, the ZigZag (Retrace.) can be used to project the length of an advance. Again, 1.646 is close to the Fibonacci 1.618, which is the Golden Ratio used in many projection estimates. See our ChartSchool article for more on Fibonacci retracements. Conclusions The ZigZag and ZigZag (Retrace.) filter price action and do not have any predictive power. The ZigZag lines simply react when prices move a certain percentage. Chartists can apply an array of technical analysis tools to the ZigZag. Chartists can perform basic trend analysis by comparing reaction highs and lows. Chartists can also overlay the ZigZag feature to look for price patterns that might not be as visible on a normal bar or line chart. The ZigZag has a way of highlighting the important movements and ignoring the noise. When using the ZigZag feature, don't forget to measure the last line to determine if it is temporary or permanent. The last ZigZag line is temporary if the current price change is less than the ZigZag parameter. The last line is permanent when the price change is greater than or equal to the ZigZag parameter.","title":"ZigZag"},{"location":"datanote/ch05/#volume-indicators","text":"","title":"Volume Indicators"},{"location":"datanote/ch05/#accumulationdistributionad","text":"Accumulation/Distribution is a volume-based technical analysis indicator designed to reflect cumulative inflows and outflows of money for an asset by comparing close prices with highs and lows and weighting the relation by trading volumes. How to Use Accumulation/Distribution The Accumulation/Distribution line is used for trend confirmation or possible turning points identification purposes. Trend confirmation: An uptrend in prices is confirmed if A/D line is rising; A downtrend in prices is confirmed if A/D line is falling. Divergence pattern analysis: Rising A/D line along with decreasing prices indicates the downtrend may be weakening to a bullish reversal; Falling A/D along with rising prices indicates the uptrend may be weakening to a bearish reversal. ```{image} ../images/AD.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 **Accumulation/Distribution Indicator Formula (Calculation)** ```{code} A/D(t) = [((C \u2013 L) \u2013 (H \u2013 C)) / (H \u2013 L)] x Vol + A/D(t-1), where: A/D(t) \u2013 current Accumulation/Distribution value; A/D(t-1) \u2013 previous Accumulation/Distribution value; H \u2013 current high; L \u2013 current low; C \u2013 close price; Vol \u2013 volume.","title":"Accumulation/Distribution(AD)"},{"location":"datanote/ch05/#money-flow-indexmfi","text":"Money Flow Index (MFI) is a technical indicator developed to estimate money inflow intensity into a certain asset by comparing price increases and decreases over a given period, but also taking into consideration trading volumes. How to Use Money Flow Index The indicator can be used to identify whether an asset is overbought or oversold, as well as to determine possible turning points. Analyzing extreme (overbought/oversold) areas: If MFI climbs above 80, the asset is generally considered to be overbought. A sell signal appears if MFI crosses the overbought area boundary from above; If MFI drops below 20, the asset is generally considered to be oversold. A buy signal appears if MFI crosses the oversold area boundary from below. Divergence patterns analysis: Rising MFI along with decreasing prices indicates the downtrend may be weakening; Falling MFI along with rising prices indicates the uptrend may be weakening. ```{image} ../images/MFI.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 **Money Flow Index Formula (Calculation)** ```{code} The following steps are required to calculate the index: 1. TP = (H + L + C) / 3; 2. MF = TP*Vol; 3. MR = Sum(MF+) / Sum(MF-); 4. MFI = 100 \u2013 (100 / (1 + MR)), where: TP \u2013 typical price; H \u2013 current high; L \u2013 current low; C \u2013 close price; MF \u2013 money flow (positive (MF+) if current TP > previous TP, negative (MF-) otherwise); Vol \u2013 volume; MR \u2013 money ratio.","title":"Money Flow Index(MFI)"},{"location":"datanote/ch05/#on-balance-volumeobv","text":"On-Balance Volume (OBV) is a cumulative volume-based tool intended to show the relation between the amount of deals and asset\u2019s price movements. How to Use On Balance Volume The On-Balance Volume line is used for trend confirmation or possible turning points identification purposes. Trend confirmation: An uptrend in prices is confirmed if the line is rising; A downtrend in prices is confirmed if the line is falling. Divergence pattern analysis: Rising OBV line along with decreasing prices indicates the downtrend may be weakening to a bullish reversal; Falling OBV along with rising prices indicates the uptrend may be weakening to a bearish reversal. ```{image} ../images/OBV.jpg :align: center 1 2 3 4 5 6 7 8 9 10 11 12 **On-Balance Volume Formula (Calculation)** ```{code} OBV(t) = OBV(t-1) + Vol, if C(t) > C(t-1); OBV(t) = OBV(t-1) \u2013 Vol, if C(t) < C(t-1); OBV(t) = OBV(t-1), if C(t) = C(t-1), where: t \u2013 current period; t-1 \u2013 previous period; C \u2013 close price; Vol \u2013 volume.","title":"On-Balance Volume(OBV)"},{"location":"datanote/ch05/#volumes","text":"Volume indicator is a technical analysis tool, which reflects trading activity of investors for a given time period. How to Use Volume Indicator Volume indicator is generally used together with price analysis to confirm trend strength or highlight its weakness and therefore identify possible upcoming reversals. Trend confirmation: Rising trading volumes during an uptrend confirms bullish mood; Rising trading volumes during a downtrend confirms bearish mood. Trend weakness: If volumes are falling while prices are increasing, that may be a sign of uptrend weakness, as demand for the asset may cease at higher prices. ```{image} ../images/Volumes.jpg :align: center 1 2 3 4 5 **Forex Volumes Calculation** ```{code} Volume = total value/number of transactions during a given period.","title":"Volumes"},{"location":"datanote/ch05/#52","text":"\u7b14\u8005\u7f16\u5199\u4e86\u4e00\u4e9b\u4ea4\u6613\u811a\u672c\uff0c\u5305\u62ecEA\u548cscript\uff0c\u53ef\u8bbf\u95eehttps://github.com/lofyer/mt4-scripts\u8fdb\u884c\u4e0b\u8f7d\u3002","title":"5.2 \u81ea\u52a8\u4ea4\u6613\u57fa\u7840"},{"location":"datanote/ch05/#53","text":"\u592e\u884c\u6d4b\u91cf\u5566\u3001\u793e\u4f1a\u6307\u6807\u5566\u3001\u7b49\u7b49\u5566\u5566\u5566","title":"5.3 \u57fa\u672c\u5206\u6790\u57fa\u7840"},{"location":"datanote/ch05/#54","text":"","title":"5.4 \u8d27\u5e01\u9009\u62e9"},{"location":"datanote/ch05/#541","text":"","title":"5.4.1. \u5386\u53f2\u6570\u636e"},{"location":"datanote/ch05/#542","text":"","title":"5.4.2. \u65b0\u95fb\u4e0e\u62a5\u544a"},{"location":"datanote/ch06/","text":"\u7b2c\u516d\u7ae0 \u4fe1\u53f7\u4ea4\u6613\u7cfb\u7edf\uff08\u5916\u6c47\u3001\u80a1\u5e02\u4e0e\u533a\u5757\u94fe\uff09 \u5148\u5f53\u4f5c\u666e\u901a\u7684\u63a7\u5236\u7cfb\u7edf\u5904\u7406\uff0c\u7136\u540e\u52a0\u5165\u66f4\u591a\u8f93\u5165\u4fe1\u53f7\u4e4b\u540e\u5f53\u4f5c\u590d\u6742\u7cfb\u7edf\u5904\u7406\uff0c\u91c7\u7528ABM\u5efa\u6a21\u3002 \u7cfb\u7edf\u8f93\u5165\u4fe1\u53f7\uff1a 1 2 \u6280\u672f\u5206\u6790\u3001\u8206\u8bba\u5206\u6790\u3001\u65b0\u95fb\u5206\u6790\uff08\u542b\u7a81\u53d1\u65b0\u95fb\u4e0e\u6570\u636e\u65b0\u95fb\uff09\u3001\u62a5\u544a\u5206\u6790\uff0c \u4ee5\u53ca\u5b83\u4eec\u7684\u5386\u53f2\u6570\u636e\u3001\u673a\u5668\u5b66\u4e60\u540ebacktesting\u7684\u6570\u636e\u3002 \u7cfb\u7edf\u63a7\u5236\u5668\uff1a 1 2 3 \u4e3a\u4e86\u4fdd\u6301\u76c8\u5229\u6c34\u5e73\uff0c\u53ef\u80fd\u9700\u8981\u6269\u5927\u6b63\u53cd\u9988\uff0c\u51cf\u5f31\u8d1f\u53cd\u9988\uff0c\u5373\u6b62\u76c8\u5927\u3001\u6b62\u635f\u5c0f\u3002 \u63a7\u5236\u5668\u8bbe\u8ba1\u5728\u8f93\u5165\u4fe1\u53f7\u4f5c\u4e3a\u53cd\u9988\u7684\u57fa\u7840\u4e0a\uff0c\u5c06\u5386\u53f2\u8ba2\u5355\u7684\u76c8\u5229\u6c34\u5e73\u4f5c\u4e3a\u4e3b\u8981\u53c2\u8003\uff0c \u5373\u5c06\u6574\u4e2a\u63a7\u5236\u5668\u7f6e\u4e8e\u8f93\u5165\u73af\u8282\uff0c\u4ece\u800c\u5f62\u6210\u5b8c\u6574\u7684\u95ed\u73af\u7cfb\u7edf\u3002 \u8f6f\u4ef6\u67b6\u6784\uff1a 1 \u4e3a\u4e86\u4fdd\u6301\u9ad8\u5e76\u53d1\uff0c\u54c8\u5e0c\u73af\u5206\u53d1\u4efb\u52a1\uff0c\u6d88\u606f\u961f\u5217mq\uff0c\u4f7f\u7528\u5de5\u4f5c\u6d41\u63a7\u5236\u4efb\u52a1\uff0c\u6570\u636e\u5e93\u4f7f\u7528\u5c11\u5b57\u6bb5\u591aKV\uff0c\u65b0\u589e\u529f\u80fd\u52a0\u5230KeyVaule\u5217\u8868\u4e2d\uff0c\u65e0\u9700\u589e\u52a0\u6570\u636e\u5e93\u5b57\u6bb5\u3002 \u7cfb\u7edf\u5e73\u53f0\u6d41\u7a0b\u6982\u8ff0\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u4ea4\u6613\uff1a \u6ce8\u518c -> \u5206\u914dMT4\u865a\u62df\u673a\uff08\u5bb9\u5668\uff09-> \u4ea4\u6613\u5f00\u59cb -> \u5468\u671f\u7ed3\u7b97 \u6ce8\u518c -> \u72ec\u7acbMT4\u5ba2\u6237\u7aef -> \u4ea4\u6613\u5f00\u59cb -> \u5468\u671f\u7ed3\u7b97 \u65b0\u95fb\uff1a \u65b0\u95fb\u63d0\u4f9bGIS\u4e0e\u65b0\u95fb\u6e90\u4e24\u79cd\u67e5\u770b\u65b9\u6cd5 \u514d\u6ce8\u518c -> \u65b0\u95fb\u67e5\u770b\u3001\u641c\u7d22 \u6ce8\u518c -> \u65b0\u95fb\u67e5\u770b\u3001\u641c\u7d22\u3001\u63a8\u9001 \u7b97\u6cd5\uff1a \u4e00\uff1a\u4e13\u5bb6\u4eba\u5de5\u590d\u5236 \u4e8c\uff1a\u6307\u6570\u6307\u6807\u673a\u5668\u5b66\u4e60\u4ea4\u6613 \u4e09\uff1a\u57fa\u672c\u5206\u6790\u4e0e\u8206\u60c5\u5206\u6790\uff0c\u5e76\u7ed3\u5408\uff08\u4e8c\uff09\u8fdb\u884c\u4ea4\u6613 graph LR A[Start] --> B{Error?}; B -->|Yes| C[Hmm...]; C --> D[Debug]; D --> B; B ---->|No| E[Yay!]; \u5916\u6c47\u4fe1\u53f7\u7cfb\u7edf\u5373\u662f\u9762\u5411\u5916\u6c47\u65b0\u624b\u7684\u5e73\u53f0\uff0c\u666e\u904d\u5177\u5907\u6700\u57fa\u672c\u7684\uff08\u6587\u5b57\uff09\u65b0\u95fb\u53d1\u5e03\u529f\u80fd\uff0c\u518d\u8005\u5373\u662f\u5408\u9002\u4e70\u5165\u6216\u5356\u51fa\u7684\u4fe1\u606f\uff0c\u5982\u679c\u5408\u9002\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u63d0\u4f9b\u4ea4\u6613\u62f7\u8d1d\uff08trade copier\uff09\u8ba9\u5176\u4ed6\u4eba\u81ea\u52a8\u8ddf\u968f\u4e13\u5bb6\u7684\u4ea4\u6613\u65b9\u5f0f\u8fdb\u884c\u4ea4\u6613\u3002 \u5f53\u524d\u6574\u4e2a\u7cfb\u7edf\u7684\u67b6\u6784\u6bd4\u8f83\u7b80\u5355\uff0c\u603b\u4f53\u53ef\u770b\u4f5c\u4e00\u4e2a\u975e\u7ebf\u6027\u56de\u9988\u63a7\u5236\u7cfb\u7edf\uff0c\u8f93\u5165\u4fe1\u53f7\u5305\u62ec\u65b0\u95fb\u3001\u65b0\u95fb\u5bf9\u5916\u6c47\u7684\u8bc4\u7ea7\uff08\u4ee5\u4e0b\u7b80\u79f0\u8bc4\u7ea7\uff09\u3001\u6280\u672f\u6307\u6807\u3001\u5386\u53f2\u8ba2\u5355\u3001\u5176\u4ed6\u7f51\u7edc\u4fe1\u53f7\uff0c\u8f93\u51fa\u5219\u7b80\u5316\u4e3a\u8ba2\u5355\u5904\u7406\uff08\u4e0b\u5355\u3001\u5e73\u4ed3\u3001\u4fee\u6539\uff09\u4e0e\u4e8b\u4ef6\uff08\u7528\u4e8e\u63a8\u9001\u5230\u5ba2\u6237\u4e0e\u7f51\u7ad9\uff09\uff0c\u5176\u4e2d\u8ba2\u5355\u7684\u76c8\u5229\u60c5\u51b5\u4f1a\u4f5c\u4e3a\u56de\u9988\u4fe1\u53f7\u3002 \u753b\u4e2a\u56fe\u53ef\u80fd\u66f4\u6e05\u6670\uff1a ```{image} ../images/arch.png :align: center 1 2 3 4 \u8fd9\u662f\u76ee\u524d\u7684\u670d\u52a1\u5668\u67b6\u6784\u56fe\uff1a ```{image} ../images/forex_infra_1.png :align: center \u76ee\u524d\u4e0e\u672c\u7ae0\u76f8\u5173\u7684\u9879\u76ee\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u4e3b\u7ad9\u70b9 https://forex.fusionworks.cn \u65b0\u95fbGIS\u7cfb\u7edf https://github.com/lofyer/forex-gis-news.git MT4\u670d\u52a1\u7aef https://github.com/lofyer/mt4-server.git MT4\u4ea4\u6613\u811a\u672c https://github.com/lofyer/mt4-scripts.git TUI\u6c47\u7387\u5c55\u793a https://github.com/lofyer/forex-rate-board.git OANDA API\u8c03\u7528\u811a\u672c https://github.com/lofyer/oanda-scripts.git \u4ea4\u6613\u6a21\u578b https://github.com/lofyer/quantum-trade-model.git \u539f\u59cb\u4ea4\u6613\u6a21\u578b https://github.com/lofyer/trade-model-01.git \u5728\u5b66\u4e60\u5206\u7c7b\u6307\u6807\u4e0e\u8bc4\u7ea7\u6307\u6807\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u505a\u6279\u91cf\u7684backtesting\u3002 6.1. \u65b0\u95fb\u3001\u62a5\u544a\u4e0e\u5927\u76d8\u4fe1\u606f 6.1.1. \u65b0\u95fb\u6536\u96c6 \u65b0\u95fb\u6536\u96c6\u4f7f\u7528\u4e86SimplePie\uff0c\u5bf9\u5404\u5927\u4e3b\u6d41\u5a92\u4f53\u7684RSS\u8fdb\u884c\u6bcf\u5c0f\u65f6\u4e00\u6b21\u7684\u6536\u96c6\u6d3b\u52a8\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u81f3MySQL/Oracle\u6570\u636e\u5e93\u3002 6.1.2. \u65b0\u95fb\u5206\u7c7b\u4e0e\u8bc4\u7ea7 \u65b0\u95fb\u5206\u7c7b\u6211\u4eec\u53ef\u4ee5\u53c2\u8003 Google\u7684\u4e13\u5229 \uff0c\u5373\u9009\u62e9\u67d0\u7c7b\u65b0\u95fb\u7684\u9891\u7387\u8f83\u9ad8\u7684\u8bcd\uff0c\u7136\u540e\u518d\u5c06\u5176\u5e94\u7528\u5230\u65b0\u7684\u65b0\u95fb\u4e2d\u3002\u7b14\u8005\u89c9\u5f97\u6b64\u65f6\u76d1\u7763\u5b66\u4e60\u7684\u6548\u7387\u66f4\u9ad8\u3002 1 2 3 4 5 StoryId Class word1 word2 gram1 gram2 ... 1 sports 0 0.2 0.01 0 2 tech 0.5 0.01 0 0.3 3 sports 0 0.1 0.3 0.01 \u5206\u8bcd\u3001NLTK\u5de5\u5177\u3001\u5206\u7c7b https://github.com/yassersouri/classify-text https://github.com/kareemf/news-article-classification http://www.nltk.org/ scipy scikit_learn pybrain jieba tensorflow \u53ef\u76f4\u63a5\u4f7f\u7528python-geograpy\u8fdb\u884c\u65b0\u95fb\u5730\u70b9\u7b5b\u9009\uff0c\u4ee5\u53capycountry\u67e5\u8be2\u5730\u70b9\u4fe1\u606f\u3002 \u8bc4\u7ea7\u9700\u8981\u5b66\u4e60 \uff0c\u5373\u6839\u636e\u65b0\u95fb\u53d1\u751f\u65f6\u95f4\u3001\u5730\u70b9\u3001\u4e8b\u4ef6\uff0c\u7136\u540e\u7ed3\u5408\u5927\u76d8\u72b6\u51b5\u8fdb\u884c\u8bc4\u7ea7\u3002 6.1.3. \u62a5\u544a\u8bc4\u7ea7 \u62a5\u544a\u4e0d\u540c\u4e8e\u65b0\u95fb\uff0c\u5b83\u7684\u6743\u5a01\u6027\u4e0e\u6982\u62ec\u6027\u66f4\u5f3a\uff0c\u65f6\u6548\u8de8\u5ea6\u6216\u957f\u6216\u77ed\u3002\u76ee\u524d\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u673a\u6765\u8bf4\uff0c\u62a5\u544a\u7684\u5904\u7406\u96be\u4ee5\u8fbe\u5230\u4eba\u5de5\u7406\u89e3\u7684\u6c34\u5e73\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u7ed3\u5408\u5c3d\u53ef\u80fd\u591a\u7684\u4fe1\u606f\u53bb\u5904\u7406\uff0c\u800c\u5bf9\u4e8e\u4e00\u822c\u4ea4\u6613\u8005\u6765\u8bf4\uff0c\u8fd9\u9700\u8981\u76f8\u5f53\u9ad8\u7684\u6280\u672f\u8981\u6c42\u3002 \u62a5\u544a\u8bc4\u7ea7\u7684\u6743\u91cd\u9ad8\u4e8e\u65b0\u95fb\u8bc4\u7ea7\u3002\u4ee5\u7b14\u8005\u7ecf\u9a8c\u6765\u770b\u6709\u4ee5\u4e0b\u62a5\u544a\u4f1a\u5bf9\u6c47\u7387\u4ea7\u751f\u91cd\u5927\u6ce2\u52a8\uff1a \u56fd\u9645\u6536\u652f\uff08\u8d38\u6613\u4f59\u989d\uff09 \u5229\u7387\u4e0e\u8d27\u5e01\u4f9b\u7ed9\u653f\u7b56 \u901a\u80c0\u4e0e\u901a\u7f29 \u8d44\u4ea7\u4ef7\u683c\uff08\u503a\u5238\u3001\u80a1\u7968\u3001\u623f\u5730\u4ea7\uff09 \u5546\u54c1\u4ef7\u683c\uff08CRB\u73b0\u8d27\u6307\u6570\uff09 \u653f\u5e9c\u9884\u7b97\u4e0e\u8d22\u653f\u653f\u7b56 \u56fd\u5bb6\u4fe1\u7528\u8bc4\u7ea7 \u653f\u6cbb\u4e0e\u6218\u4e89 \u81ea\u7136\u56e0\u7d20 \u6570\u636e\u516c\u5e03\uff08\u6d88\u8d39\u8005\u7269\u4ef7\u6307\u6570CPI\u3001\u96f6\u552e\u9500\u552e\u3001\u751f\u4ea7\u8005\u7269\u4ef7\u6307\u6570PPI\u3001\u5de5\u4e1a\u751f\u4ea7IP\u3001\u91c7\u8d2d\u7ecf\u7406\u4eba\u6307\u6570PMI\u3001\u5c31\u4e1a\u6570\u636e\uff09 6.1.4. GIS\u5c55\u793a \u53ef\u53c2\u8003\u7f51\u7ad9\u5185\u5bb9 6.1.5. \u5927\u76d8\u5386\u53f2\u6570\u636e \u83b7\u53d6\u5386\u53f2\u6570\u636e\u7684\u9014\u5f84\u6bd4\u8f83\u591a\uff0cPython/R\u8bed\u8a00\u4e2d\u6709\u975e\u5e38\u65b9\u4fbf\u7684\u5e93\u53ef\u4f9b\u76f4\u63a5\u8c03\u7528\uff0c\u6bd4\u5982pandas\u3001quantmod\u7b49\u3002\u4f46\u662f\uff0c\u4ed6\u4eec\u7684\u6570\u636e\u6e90\u3001\u6570\u636e\u5468\u671f\u3001\u6570\u636e\u7cbe\u5ea6\u7b49\u4e0d\u592a\u6ee1\u8db3\u6211\u4eec\u7684\u56de\u6d4b\u9700\u6c42\uff0c\u6240\u4ee5\u5728\u7ecf\u8fc7\u5927\u91cf\u6d4b\u8bd5\u540e\uff0c\u7b14\u8005\u63a8\u8350\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u8fdb\u884c\u83b7\u53d6\u3002 QCollector Expert for eSignal MT4\u5ba2\u6237\u7aef\u6570\u636e\u4e0b\u8f7d 6.2. \u6570\u636e\u6e90\u5904\u7406 \u6280\u672f\u6307\u6807\u5904\u7406\u7684\u624b\u6bb5\u975e\u5e38\u591a\uff0c\u6211\u4eec\u53ea\u8981\u8bad\u7ec3\u51fa\u5411\u524d\u5e73\u79fb\u4e00\u6bb5\u65f6\u95f4\u5185\u76f8\u5173\u6027\u6700\u9ad8\u7684\u51e0\u4e2a\u6307\u6807\u5373\u53ef\u3002 \u65b0\u95fb\u88ab\u5206\u7c7b\u540e\uff0c\u4f1a\u88ab\u624b\u52a8/\u81ea\u52a8\u8d4b\u4e88\u5bf9\u5e94\u6743\u503c\u3002 6.3. \u76f8\u5173\u6027\u5904\u7406 \u673a\u5668\u5b66\u4e60\u90e8\u5206\u5c06\u6280\u672f\u6307\u6807\u3001\u65b0\u95fb\u4e0e\u5927\u76d8\u6570\u636e\u8fdb\u884c\u76f8\u5173\u6027\u5b66\u4e60\uff0c\u5176\u5904\u7406\u8fc7\u7a0b\u53ef\u88ab\u968f\u65f6\u67e5\u770b\u4e0e\u4eba\u5de5\u5e72\u9884\u3002 6.4. \u4ea4\u6613\u7b56\u7565 6.4.1. \u7b56\u75651 - \u6279\u91cf 6.4.2. \u7b56\u75652 - \u6b62\u635f\u6279\u91cf 6.4.3. \u7b56\u75653 - \u6280\u672f\u6307\u6807\u81ea\u52a8\u4ea4\u6613 \u7b56\u75653\u5b9e\u9a8c\u8bb0\u5f55\uff1a 1\u5206\u949f\u89c2\u5bdf\u7a97\u53e3 index\u5e73\u65f6\u4ea4\u6613\uff1a index\u4e0a\u5347\u65f6\u4ea4\u6613\uff1a 15\u5206\u949f\u4ea4\u6613 5\u5206\u949f\u89c2\u5bdf\uff0c30\u5206\u949f\u4ea4\u6613 ```{image} ../images/strategy3.png :align: center ``` 6.4.4. \u7b56\u75654 - \u6280\u672f\u6307\u6807\u4e0e\u65b0\u95fb\u81ea\u52a8\u4ea4\u6613 6.4.5. \u7b56\u75655 - \u57fa\u4e8e\u5386\u53f2\u6570\u636e\u673a\u5668\u5b66\u4e60\u7684\u6280\u672f\u6307\u6807\u4e0e\u65b0\u95fb\u81ea\u52a8\u4ea4\u6613 6.4.5. \u7b56\u75656 - \u4ee3\u7406\u4eba\u6a21\u578b\u4e0e\u590d\u6742\u6027\u7b56\u7565\u5e94\u7528 6.5. \u56de\u9988\u4fe1\u53f7\u7684\u5904\u7406 6.6. \u8f93\u51fa\u5904\u7406 \u5ba2\u6237\u4ea4\u6613\u7aef\u4e0e\u65b0\u95fb\u7aef 6.7. \u5ba2\u6237\u6a21\u62df\u5e73\u53f0 \u5e73\u53f0API\u6d4b\u8bd5\uff08Swagger UI\uff09 StockSharp\uff08\u5f00\u6e90\uff09 my_library/source/forex/ Altreva Adapative Model OpenTrade \u5e73\u53f0\u4e0e\u5de5\u5177\u6536\u96c6 \u6a21\u62df\u5668 QuantConnect Lean \u514d\u8d39\u4ea4\u6613\u5386\u53f2\u6570\u636e AkShare\u80a1\u5e02\u6570\u636e 6.8. \u4ea4\u6613\u7bb4\u8a00 \u7f51\u7edc\u4ee3\u7406 FPGA\u4ea4\u6613\u673a\u5668\u4eba \u7f51\u7edc\u4ee3\u7406 Dow Jones Theory \u4ea4\u6613\u5fc3\u7406 In the contemporary exchange market exchange rates are defined through decisions of thousands of traders and investors. The psychology of human behavior is considered to be the clue of understanding what happens in financial markets. What are the motivations for trading? How our emotions affect our decicion making process? How to avoid the failure and become a successful trader? Have you ever wondered about these questions? Keep reading to find out the answers. Avoiding Failure In stock trading decisive influence on the behavior of the trader is made by common to all feelings such as fear, greed, hope, etc. Weak and self confident, greedy and slow; all these people are doomed to become the victims of the market. The recognition of your own abilities, positive or negative qualities will help you as a trader to avoid failure. If we also add to this the ability of adequate evaluation of the psychological state and the behavior of the market, the success is guaranteed. The Motivations One of the driving forces, making you to take part in the work of speculative financial markets, is the possibility of earning \"easy money\" or, saying directly, greed. The result of greedy action is the motivation for making deals. One can distinguish between two kinds of motivations: Rational motivation is expressed through cold prudence when taking decisions about making a deal. Irrational motivation is expressed through passion of the player; the others are the slaves of their emotions and are practically doomed to lose. If the trader does not have a working plan formed before making deals, it speaks about the fact that the person is likely to work under the influence of greed but not reason. Understanding Hope The following factor motivating the trader to make deals is the hope to get profit. If the hope prevails over the profit calculation, the trader undertakes the risk of overestimating his abilities when analyzing the situation. Hope must be placed in subordinate relations both with calculation and greed. It is the great hope that brings beginners to failure. The trader, living with hope, is doomed to failure. It is a hope that pushes traders towards making one of the most cruel mistakes- shift of the stop-loss orders level. From outside, trading seems to be an utterly simple matter. But in reality for the majority of people it later on appears to be the most difficult of all the issues. Accepting Losses You will not be able to become a successful trader until you are ready both for victories and losses. Both of them are important and inseparable parts of the trading process. On the way of mastering the art of trade very often barriers are met. When the trader focuses on the problems (there can be numerous problems, for instance, lack of means, resources and knowledge), he feels anger, guilt, disappointment and dissatisfaction. But such an emotional state will not let him move forward. If the loss is unacceptable for the trader, he will not be able to close the losing position. When the trader is not ready to face losses, they usually become more. Trading Psychology and Self-Discipline In trading, there is a tiny minority of winners and overwhelming majority of losers and the latter wish to know the secrets of success of the winners. But is there a difference between them? Yes, there is; the one who makes money week by week, month by month and year by year, trades keeping self-discipline. To the question of the secrets of his stable market triumph, such a winner answers without hesitating, that he was able to reach such heights by learning how to control his emotions and change his decisions to match the market. Note, self discipline, control of emotions and the ability to reconsider are all psychological moments which are not related to information services, consultation firms, new exchanges, technical or fundamental trade systems (with computer programs or without them). Do not confuse confidence with extreme self-confidence Interviews with traders confirm that extreme self-confidence plays an important role in making trading decisions. If the trader receives good profit, he becomes more prone to risk which is followed by negative consequences. This is a tendency of becoming extremely self-confident after success, which mostly happens with the less experienced market participants. Extreme confidence easily transforms into a dangerous quality, as people who are too much confident in their beliefs will not pay attention to important information which is valuable for their trading decisions. Confidence and negative emotions are directly related to each other in strength. In general, confidence and fear are similar senses by nature; only the one is with a \"plus\" sign and the other with - \"minus\" sign. If the person feels more confident, there is a little room left for confusion, alarm and fear. How does the sense of self confidence develop? In a natural way, the person gets used to relying on himself in everything that he has to do without any hesitation. With such trust in himself he does not have to fear the market with its seemingly unpredictable and chaotic behavior. The matter here is not with him at all, as the market did not change but the inner world and psychological warehouse of the trader have. How to become a successful trader? There are two important terms in relation to a good trader. To set a principle of trading exclusively on the basis of self discipline. To learn how to remove the negative emotional energy of the last trade experience. Due to the principle to self discipline, self trust is being formed, which is necessary for successful trading actions. Almost in the majority of cases each trader starts his way on the primary level without understanding trading psychology and without the principle of self discipline. And it is likely to get psychological trauma (a psychological state which is capable of making people feel fear) of this or that severity. It is necessary to learn how to get rid of worries. When there is little fear as a consequence, you absorb new knowledge about the nature of the market. Do not forget that each moment is an excellent indicator of your development level. But if you consider each failure (if it did not happen as you have expected or wanted) to be a mistake, you very often deprive yourself of understanding yourself. While people become shy of learning something new about them. Why? Because mistakes mean an emotional pain for them. Avoiding pain instinctively, the person unconsciously refuses to recognize himself, when it is necessary to manage better a similar situation in future. The bottom line To reach a success in trading, you need to take the whole responsibility of your decisions and actions on yourself. 6.9 \u5168\u94fe\u8def\u6d4b\u8bd5\u4ee3\u7406","title":"\u7b2c\u516d\u7ae0 \u4fe1\u53f7\u4ea4\u6613\u7cfb\u7edf"},{"location":"datanote/ch06/#_1","text":"\u5148\u5f53\u4f5c\u666e\u901a\u7684\u63a7\u5236\u7cfb\u7edf\u5904\u7406\uff0c\u7136\u540e\u52a0\u5165\u66f4\u591a\u8f93\u5165\u4fe1\u53f7\u4e4b\u540e\u5f53\u4f5c\u590d\u6742\u7cfb\u7edf\u5904\u7406\uff0c\u91c7\u7528ABM\u5efa\u6a21\u3002 \u7cfb\u7edf\u8f93\u5165\u4fe1\u53f7\uff1a 1 2 \u6280\u672f\u5206\u6790\u3001\u8206\u8bba\u5206\u6790\u3001\u65b0\u95fb\u5206\u6790\uff08\u542b\u7a81\u53d1\u65b0\u95fb\u4e0e\u6570\u636e\u65b0\u95fb\uff09\u3001\u62a5\u544a\u5206\u6790\uff0c \u4ee5\u53ca\u5b83\u4eec\u7684\u5386\u53f2\u6570\u636e\u3001\u673a\u5668\u5b66\u4e60\u540ebacktesting\u7684\u6570\u636e\u3002 \u7cfb\u7edf\u63a7\u5236\u5668\uff1a 1 2 3 \u4e3a\u4e86\u4fdd\u6301\u76c8\u5229\u6c34\u5e73\uff0c\u53ef\u80fd\u9700\u8981\u6269\u5927\u6b63\u53cd\u9988\uff0c\u51cf\u5f31\u8d1f\u53cd\u9988\uff0c\u5373\u6b62\u76c8\u5927\u3001\u6b62\u635f\u5c0f\u3002 \u63a7\u5236\u5668\u8bbe\u8ba1\u5728\u8f93\u5165\u4fe1\u53f7\u4f5c\u4e3a\u53cd\u9988\u7684\u57fa\u7840\u4e0a\uff0c\u5c06\u5386\u53f2\u8ba2\u5355\u7684\u76c8\u5229\u6c34\u5e73\u4f5c\u4e3a\u4e3b\u8981\u53c2\u8003\uff0c \u5373\u5c06\u6574\u4e2a\u63a7\u5236\u5668\u7f6e\u4e8e\u8f93\u5165\u73af\u8282\uff0c\u4ece\u800c\u5f62\u6210\u5b8c\u6574\u7684\u95ed\u73af\u7cfb\u7edf\u3002 \u8f6f\u4ef6\u67b6\u6784\uff1a 1 \u4e3a\u4e86\u4fdd\u6301\u9ad8\u5e76\u53d1\uff0c\u54c8\u5e0c\u73af\u5206\u53d1\u4efb\u52a1\uff0c\u6d88\u606f\u961f\u5217mq\uff0c\u4f7f\u7528\u5de5\u4f5c\u6d41\u63a7\u5236\u4efb\u52a1\uff0c\u6570\u636e\u5e93\u4f7f\u7528\u5c11\u5b57\u6bb5\u591aKV\uff0c\u65b0\u589e\u529f\u80fd\u52a0\u5230KeyVaule\u5217\u8868\u4e2d\uff0c\u65e0\u9700\u589e\u52a0\u6570\u636e\u5e93\u5b57\u6bb5\u3002 \u7cfb\u7edf\u5e73\u53f0\u6d41\u7a0b\u6982\u8ff0\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u4ea4\u6613\uff1a \u6ce8\u518c -> \u5206\u914dMT4\u865a\u62df\u673a\uff08\u5bb9\u5668\uff09-> \u4ea4\u6613\u5f00\u59cb -> \u5468\u671f\u7ed3\u7b97 \u6ce8\u518c -> \u72ec\u7acbMT4\u5ba2\u6237\u7aef -> \u4ea4\u6613\u5f00\u59cb -> \u5468\u671f\u7ed3\u7b97 \u65b0\u95fb\uff1a \u65b0\u95fb\u63d0\u4f9bGIS\u4e0e\u65b0\u95fb\u6e90\u4e24\u79cd\u67e5\u770b\u65b9\u6cd5 \u514d\u6ce8\u518c -> \u65b0\u95fb\u67e5\u770b\u3001\u641c\u7d22 \u6ce8\u518c -> \u65b0\u95fb\u67e5\u770b\u3001\u641c\u7d22\u3001\u63a8\u9001 \u7b97\u6cd5\uff1a \u4e00\uff1a\u4e13\u5bb6\u4eba\u5de5\u590d\u5236 \u4e8c\uff1a\u6307\u6570\u6307\u6807\u673a\u5668\u5b66\u4e60\u4ea4\u6613 \u4e09\uff1a\u57fa\u672c\u5206\u6790\u4e0e\u8206\u60c5\u5206\u6790\uff0c\u5e76\u7ed3\u5408\uff08\u4e8c\uff09\u8fdb\u884c\u4ea4\u6613 graph LR A[Start] --> B{Error?}; B -->|Yes| C[Hmm...]; C --> D[Debug]; D --> B; B ---->|No| E[Yay!]; \u5916\u6c47\u4fe1\u53f7\u7cfb\u7edf\u5373\u662f\u9762\u5411\u5916\u6c47\u65b0\u624b\u7684\u5e73\u53f0\uff0c\u666e\u904d\u5177\u5907\u6700\u57fa\u672c\u7684\uff08\u6587\u5b57\uff09\u65b0\u95fb\u53d1\u5e03\u529f\u80fd\uff0c\u518d\u8005\u5373\u662f\u5408\u9002\u4e70\u5165\u6216\u5356\u51fa\u7684\u4fe1\u606f\uff0c\u5982\u679c\u5408\u9002\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u63d0\u4f9b\u4ea4\u6613\u62f7\u8d1d\uff08trade copier\uff09\u8ba9\u5176\u4ed6\u4eba\u81ea\u52a8\u8ddf\u968f\u4e13\u5bb6\u7684\u4ea4\u6613\u65b9\u5f0f\u8fdb\u884c\u4ea4\u6613\u3002 \u5f53\u524d\u6574\u4e2a\u7cfb\u7edf\u7684\u67b6\u6784\u6bd4\u8f83\u7b80\u5355\uff0c\u603b\u4f53\u53ef\u770b\u4f5c\u4e00\u4e2a\u975e\u7ebf\u6027\u56de\u9988\u63a7\u5236\u7cfb\u7edf\uff0c\u8f93\u5165\u4fe1\u53f7\u5305\u62ec\u65b0\u95fb\u3001\u65b0\u95fb\u5bf9\u5916\u6c47\u7684\u8bc4\u7ea7\uff08\u4ee5\u4e0b\u7b80\u79f0\u8bc4\u7ea7\uff09\u3001\u6280\u672f\u6307\u6807\u3001\u5386\u53f2\u8ba2\u5355\u3001\u5176\u4ed6\u7f51\u7edc\u4fe1\u53f7\uff0c\u8f93\u51fa\u5219\u7b80\u5316\u4e3a\u8ba2\u5355\u5904\u7406\uff08\u4e0b\u5355\u3001\u5e73\u4ed3\u3001\u4fee\u6539\uff09\u4e0e\u4e8b\u4ef6\uff08\u7528\u4e8e\u63a8\u9001\u5230\u5ba2\u6237\u4e0e\u7f51\u7ad9\uff09\uff0c\u5176\u4e2d\u8ba2\u5355\u7684\u76c8\u5229\u60c5\u51b5\u4f1a\u4f5c\u4e3a\u56de\u9988\u4fe1\u53f7\u3002 \u753b\u4e2a\u56fe\u53ef\u80fd\u66f4\u6e05\u6670\uff1a ```{image} ../images/arch.png :align: center 1 2 3 4 \u8fd9\u662f\u76ee\u524d\u7684\u670d\u52a1\u5668\u67b6\u6784\u56fe\uff1a ```{image} ../images/forex_infra_1.png :align: center \u76ee\u524d\u4e0e\u672c\u7ae0\u76f8\u5173\u7684\u9879\u76ee\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 \u4e3b\u7ad9\u70b9 https://forex.fusionworks.cn \u65b0\u95fbGIS\u7cfb\u7edf https://github.com/lofyer/forex-gis-news.git MT4\u670d\u52a1\u7aef https://github.com/lofyer/mt4-server.git MT4\u4ea4\u6613\u811a\u672c https://github.com/lofyer/mt4-scripts.git TUI\u6c47\u7387\u5c55\u793a https://github.com/lofyer/forex-rate-board.git OANDA API\u8c03\u7528\u811a\u672c https://github.com/lofyer/oanda-scripts.git \u4ea4\u6613\u6a21\u578b https://github.com/lofyer/quantum-trade-model.git \u539f\u59cb\u4ea4\u6613\u6a21\u578b https://github.com/lofyer/trade-model-01.git \u5728\u5b66\u4e60\u5206\u7c7b\u6307\u6807\u4e0e\u8bc4\u7ea7\u6307\u6807\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u505a\u6279\u91cf\u7684backtesting\u3002","title":"\u7b2c\u516d\u7ae0 \u4fe1\u53f7\u4ea4\u6613\u7cfb\u7edf\uff08\u5916\u6c47\u3001\u80a1\u5e02\u4e0e\u533a\u5757\u94fe\uff09"},{"location":"datanote/ch06/#61","text":"","title":"6.1. \u65b0\u95fb\u3001\u62a5\u544a\u4e0e\u5927\u76d8\u4fe1\u606f"},{"location":"datanote/ch06/#611","text":"\u65b0\u95fb\u6536\u96c6\u4f7f\u7528\u4e86SimplePie\uff0c\u5bf9\u5404\u5927\u4e3b\u6d41\u5a92\u4f53\u7684RSS\u8fdb\u884c\u6bcf\u5c0f\u65f6\u4e00\u6b21\u7684\u6536\u96c6\u6d3b\u52a8\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u81f3MySQL/Oracle\u6570\u636e\u5e93\u3002","title":"6.1.1. \u65b0\u95fb\u6536\u96c6"},{"location":"datanote/ch06/#612","text":"\u65b0\u95fb\u5206\u7c7b\u6211\u4eec\u53ef\u4ee5\u53c2\u8003 Google\u7684\u4e13\u5229 \uff0c\u5373\u9009\u62e9\u67d0\u7c7b\u65b0\u95fb\u7684\u9891\u7387\u8f83\u9ad8\u7684\u8bcd\uff0c\u7136\u540e\u518d\u5c06\u5176\u5e94\u7528\u5230\u65b0\u7684\u65b0\u95fb\u4e2d\u3002\u7b14\u8005\u89c9\u5f97\u6b64\u65f6\u76d1\u7763\u5b66\u4e60\u7684\u6548\u7387\u66f4\u9ad8\u3002 1 2 3 4 5 StoryId Class word1 word2 gram1 gram2 ... 1 sports 0 0.2 0.01 0 2 tech 0.5 0.01 0 0.3 3 sports 0 0.1 0.3 0.01 \u5206\u8bcd\u3001NLTK\u5de5\u5177\u3001\u5206\u7c7b https://github.com/yassersouri/classify-text https://github.com/kareemf/news-article-classification http://www.nltk.org/ scipy scikit_learn pybrain jieba tensorflow \u53ef\u76f4\u63a5\u4f7f\u7528python-geograpy\u8fdb\u884c\u65b0\u95fb\u5730\u70b9\u7b5b\u9009\uff0c\u4ee5\u53capycountry\u67e5\u8be2\u5730\u70b9\u4fe1\u606f\u3002 \u8bc4\u7ea7\u9700\u8981\u5b66\u4e60 \uff0c\u5373\u6839\u636e\u65b0\u95fb\u53d1\u751f\u65f6\u95f4\u3001\u5730\u70b9\u3001\u4e8b\u4ef6\uff0c\u7136\u540e\u7ed3\u5408\u5927\u76d8\u72b6\u51b5\u8fdb\u884c\u8bc4\u7ea7\u3002","title":"6.1.2. \u65b0\u95fb\u5206\u7c7b\u4e0e\u8bc4\u7ea7"},{"location":"datanote/ch06/#613","text":"\u62a5\u544a\u4e0d\u540c\u4e8e\u65b0\u95fb\uff0c\u5b83\u7684\u6743\u5a01\u6027\u4e0e\u6982\u62ec\u6027\u66f4\u5f3a\uff0c\u65f6\u6548\u8de8\u5ea6\u6216\u957f\u6216\u77ed\u3002\u76ee\u524d\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u673a\u6765\u8bf4\uff0c\u62a5\u544a\u7684\u5904\u7406\u96be\u4ee5\u8fbe\u5230\u4eba\u5de5\u7406\u89e3\u7684\u6c34\u5e73\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u7ed3\u5408\u5c3d\u53ef\u80fd\u591a\u7684\u4fe1\u606f\u53bb\u5904\u7406\uff0c\u800c\u5bf9\u4e8e\u4e00\u822c\u4ea4\u6613\u8005\u6765\u8bf4\uff0c\u8fd9\u9700\u8981\u76f8\u5f53\u9ad8\u7684\u6280\u672f\u8981\u6c42\u3002 \u62a5\u544a\u8bc4\u7ea7\u7684\u6743\u91cd\u9ad8\u4e8e\u65b0\u95fb\u8bc4\u7ea7\u3002\u4ee5\u7b14\u8005\u7ecf\u9a8c\u6765\u770b\u6709\u4ee5\u4e0b\u62a5\u544a\u4f1a\u5bf9\u6c47\u7387\u4ea7\u751f\u91cd\u5927\u6ce2\u52a8\uff1a \u56fd\u9645\u6536\u652f\uff08\u8d38\u6613\u4f59\u989d\uff09 \u5229\u7387\u4e0e\u8d27\u5e01\u4f9b\u7ed9\u653f\u7b56 \u901a\u80c0\u4e0e\u901a\u7f29 \u8d44\u4ea7\u4ef7\u683c\uff08\u503a\u5238\u3001\u80a1\u7968\u3001\u623f\u5730\u4ea7\uff09 \u5546\u54c1\u4ef7\u683c\uff08CRB\u73b0\u8d27\u6307\u6570\uff09 \u653f\u5e9c\u9884\u7b97\u4e0e\u8d22\u653f\u653f\u7b56 \u56fd\u5bb6\u4fe1\u7528\u8bc4\u7ea7 \u653f\u6cbb\u4e0e\u6218\u4e89 \u81ea\u7136\u56e0\u7d20 \u6570\u636e\u516c\u5e03\uff08\u6d88\u8d39\u8005\u7269\u4ef7\u6307\u6570CPI\u3001\u96f6\u552e\u9500\u552e\u3001\u751f\u4ea7\u8005\u7269\u4ef7\u6307\u6570PPI\u3001\u5de5\u4e1a\u751f\u4ea7IP\u3001\u91c7\u8d2d\u7ecf\u7406\u4eba\u6307\u6570PMI\u3001\u5c31\u4e1a\u6570\u636e\uff09","title":"6.1.3. \u62a5\u544a\u8bc4\u7ea7"},{"location":"datanote/ch06/#614-gis","text":"\u53ef\u53c2\u8003\u7f51\u7ad9\u5185\u5bb9","title":"6.1.4. GIS\u5c55\u793a"},{"location":"datanote/ch06/#615","text":"\u83b7\u53d6\u5386\u53f2\u6570\u636e\u7684\u9014\u5f84\u6bd4\u8f83\u591a\uff0cPython/R\u8bed\u8a00\u4e2d\u6709\u975e\u5e38\u65b9\u4fbf\u7684\u5e93\u53ef\u4f9b\u76f4\u63a5\u8c03\u7528\uff0c\u6bd4\u5982pandas\u3001quantmod\u7b49\u3002\u4f46\u662f\uff0c\u4ed6\u4eec\u7684\u6570\u636e\u6e90\u3001\u6570\u636e\u5468\u671f\u3001\u6570\u636e\u7cbe\u5ea6\u7b49\u4e0d\u592a\u6ee1\u8db3\u6211\u4eec\u7684\u56de\u6d4b\u9700\u6c42\uff0c\u6240\u4ee5\u5728\u7ecf\u8fc7\u5927\u91cf\u6d4b\u8bd5\u540e\uff0c\u7b14\u8005\u63a8\u8350\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u8fdb\u884c\u83b7\u53d6\u3002 QCollector Expert for eSignal MT4\u5ba2\u6237\u7aef\u6570\u636e\u4e0b\u8f7d","title":"6.1.5. \u5927\u76d8\u5386\u53f2\u6570\u636e"},{"location":"datanote/ch06/#62","text":"\u6280\u672f\u6307\u6807\u5904\u7406\u7684\u624b\u6bb5\u975e\u5e38\u591a\uff0c\u6211\u4eec\u53ea\u8981\u8bad\u7ec3\u51fa\u5411\u524d\u5e73\u79fb\u4e00\u6bb5\u65f6\u95f4\u5185\u76f8\u5173\u6027\u6700\u9ad8\u7684\u51e0\u4e2a\u6307\u6807\u5373\u53ef\u3002 \u65b0\u95fb\u88ab\u5206\u7c7b\u540e\uff0c\u4f1a\u88ab\u624b\u52a8/\u81ea\u52a8\u8d4b\u4e88\u5bf9\u5e94\u6743\u503c\u3002","title":"6.2. \u6570\u636e\u6e90\u5904\u7406"},{"location":"datanote/ch06/#63","text":"\u673a\u5668\u5b66\u4e60\u90e8\u5206\u5c06\u6280\u672f\u6307\u6807\u3001\u65b0\u95fb\u4e0e\u5927\u76d8\u6570\u636e\u8fdb\u884c\u76f8\u5173\u6027\u5b66\u4e60\uff0c\u5176\u5904\u7406\u8fc7\u7a0b\u53ef\u88ab\u968f\u65f6\u67e5\u770b\u4e0e\u4eba\u5de5\u5e72\u9884\u3002","title":"6.3. \u76f8\u5173\u6027\u5904\u7406"},{"location":"datanote/ch06/#64","text":"","title":"6.4. \u4ea4\u6613\u7b56\u7565"},{"location":"datanote/ch06/#641-1-","text":"","title":"6.4.1. \u7b56\u75651 - \u6279\u91cf"},{"location":"datanote/ch06/#642-2-","text":"","title":"6.4.2. \u7b56\u75652 - \u6b62\u635f\u6279\u91cf"},{"location":"datanote/ch06/#643-3-","text":"\u7b56\u75653\u5b9e\u9a8c\u8bb0\u5f55\uff1a 1\u5206\u949f\u89c2\u5bdf\u7a97\u53e3 index\u5e73\u65f6\u4ea4\u6613\uff1a index\u4e0a\u5347\u65f6\u4ea4\u6613\uff1a 15\u5206\u949f\u4ea4\u6613 5\u5206\u949f\u89c2\u5bdf\uff0c30\u5206\u949f\u4ea4\u6613 ```{image} ../images/strategy3.png :align: center ```","title":"6.4.3. \u7b56\u75653 - \u6280\u672f\u6307\u6807\u81ea\u52a8\u4ea4\u6613"},{"location":"datanote/ch06/#644-4-","text":"","title":"6.4.4. \u7b56\u75654 - \u6280\u672f\u6307\u6807\u4e0e\u65b0\u95fb\u81ea\u52a8\u4ea4\u6613"},{"location":"datanote/ch06/#645-5-","text":"","title":"6.4.5. \u7b56\u75655 - \u57fa\u4e8e\u5386\u53f2\u6570\u636e\u673a\u5668\u5b66\u4e60\u7684\u6280\u672f\u6307\u6807\u4e0e\u65b0\u95fb\u81ea\u52a8\u4ea4\u6613"},{"location":"datanote/ch06/#645-6-","text":"","title":"6.4.5. \u7b56\u75656 - \u4ee3\u7406\u4eba\u6a21\u578b\u4e0e\u590d\u6742\u6027\u7b56\u7565\u5e94\u7528"},{"location":"datanote/ch06/#65","text":"","title":"6.5. \u56de\u9988\u4fe1\u53f7\u7684\u5904\u7406"},{"location":"datanote/ch06/#66","text":"\u5ba2\u6237\u4ea4\u6613\u7aef\u4e0e\u65b0\u95fb\u7aef","title":"6.6. \u8f93\u51fa\u5904\u7406"},{"location":"datanote/ch06/#67","text":"\u5e73\u53f0API\u6d4b\u8bd5\uff08Swagger UI\uff09 StockSharp\uff08\u5f00\u6e90\uff09 my_library/source/forex/ Altreva Adapative Model OpenTrade \u5e73\u53f0\u4e0e\u5de5\u5177\u6536\u96c6 \u6a21\u62df\u5668 QuantConnect Lean \u514d\u8d39\u4ea4\u6613\u5386\u53f2\u6570\u636e AkShare\u80a1\u5e02\u6570\u636e","title":"6.7. \u5ba2\u6237\u6a21\u62df\u5e73\u53f0"},{"location":"datanote/ch06/#68","text":"\u7f51\u7edc\u4ee3\u7406 FPGA\u4ea4\u6613\u673a\u5668\u4eba \u7f51\u7edc\u4ee3\u7406","title":"6.8. \u4ea4\u6613\u7bb4\u8a00"},{"location":"datanote/ch06/#dow-jones-theory","text":"","title":"Dow Jones Theory"},{"location":"datanote/ch06/#_2","text":"In the contemporary exchange market exchange rates are defined through decisions of thousands of traders and investors. The psychology of human behavior is considered to be the clue of understanding what happens in financial markets. What are the motivations for trading? How our emotions affect our decicion making process? How to avoid the failure and become a successful trader? Have you ever wondered about these questions? Keep reading to find out the answers. Avoiding Failure In stock trading decisive influence on the behavior of the trader is made by common to all feelings such as fear, greed, hope, etc. Weak and self confident, greedy and slow; all these people are doomed to become the victims of the market. The recognition of your own abilities, positive or negative qualities will help you as a trader to avoid failure. If we also add to this the ability of adequate evaluation of the psychological state and the behavior of the market, the success is guaranteed. The Motivations One of the driving forces, making you to take part in the work of speculative financial markets, is the possibility of earning \"easy money\" or, saying directly, greed. The result of greedy action is the motivation for making deals. One can distinguish between two kinds of motivations: Rational motivation is expressed through cold prudence when taking decisions about making a deal. Irrational motivation is expressed through passion of the player; the others are the slaves of their emotions and are practically doomed to lose. If the trader does not have a working plan formed before making deals, it speaks about the fact that the person is likely to work under the influence of greed but not reason. Understanding Hope The following factor motivating the trader to make deals is the hope to get profit. If the hope prevails over the profit calculation, the trader undertakes the risk of overestimating his abilities when analyzing the situation. Hope must be placed in subordinate relations both with calculation and greed. It is the great hope that brings beginners to failure. The trader, living with hope, is doomed to failure. It is a hope that pushes traders towards making one of the most cruel mistakes- shift of the stop-loss orders level. From outside, trading seems to be an utterly simple matter. But in reality for the majority of people it later on appears to be the most difficult of all the issues. Accepting Losses You will not be able to become a successful trader until you are ready both for victories and losses. Both of them are important and inseparable parts of the trading process. On the way of mastering the art of trade very often barriers are met. When the trader focuses on the problems (there can be numerous problems, for instance, lack of means, resources and knowledge), he feels anger, guilt, disappointment and dissatisfaction. But such an emotional state will not let him move forward. If the loss is unacceptable for the trader, he will not be able to close the losing position. When the trader is not ready to face losses, they usually become more. Trading Psychology and Self-Discipline In trading, there is a tiny minority of winners and overwhelming majority of losers and the latter wish to know the secrets of success of the winners. But is there a difference between them? Yes, there is; the one who makes money week by week, month by month and year by year, trades keeping self-discipline. To the question of the secrets of his stable market triumph, such a winner answers without hesitating, that he was able to reach such heights by learning how to control his emotions and change his decisions to match the market. Note, self discipline, control of emotions and the ability to reconsider are all psychological moments which are not related to information services, consultation firms, new exchanges, technical or fundamental trade systems (with computer programs or without them). Do not confuse confidence with extreme self-confidence Interviews with traders confirm that extreme self-confidence plays an important role in making trading decisions. If the trader receives good profit, he becomes more prone to risk which is followed by negative consequences. This is a tendency of becoming extremely self-confident after success, which mostly happens with the less experienced market participants. Extreme confidence easily transforms into a dangerous quality, as people who are too much confident in their beliefs will not pay attention to important information which is valuable for their trading decisions. Confidence and negative emotions are directly related to each other in strength. In general, confidence and fear are similar senses by nature; only the one is with a \"plus\" sign and the other with - \"minus\" sign. If the person feels more confident, there is a little room left for confusion, alarm and fear. How does the sense of self confidence develop? In a natural way, the person gets used to relying on himself in everything that he has to do without any hesitation. With such trust in himself he does not have to fear the market with its seemingly unpredictable and chaotic behavior. The matter here is not with him at all, as the market did not change but the inner world and psychological warehouse of the trader have. How to become a successful trader? There are two important terms in relation to a good trader. To set a principle of trading exclusively on the basis of self discipline. To learn how to remove the negative emotional energy of the last trade experience. Due to the principle to self discipline, self trust is being formed, which is necessary for successful trading actions. Almost in the majority of cases each trader starts his way on the primary level without understanding trading psychology and without the principle of self discipline. And it is likely to get psychological trauma (a psychological state which is capable of making people feel fear) of this or that severity. It is necessary to learn how to get rid of worries. When there is little fear as a consequence, you absorb new knowledge about the nature of the market. Do not forget that each moment is an excellent indicator of your development level. But if you consider each failure (if it did not happen as you have expected or wanted) to be a mistake, you very often deprive yourself of understanding yourself. While people become shy of learning something new about them. Why? Because mistakes mean an emotional pain for them. Avoiding pain instinctively, the person unconsciously refuses to recognize himself, when it is necessary to manage better a similar situation in future. The bottom line To reach a success in trading, you need to take the whole responsibility of your decisions and actions on yourself.","title":"\u4ea4\u6613\u5fc3\u7406"},{"location":"datanote/ch06/#69","text":"","title":"6.9 \u5168\u94fe\u8def\u6d4b\u8bd5\u4ee3\u7406"},{"location":"datanote/ch07/","text":"\u7b2c\u4e03\u7ae0 \u6307\u5bfc\u767d\u76ae\u4e66 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 +----------+ |Memory | | +==> |Structure | +----+-----+ |CPU -------------------+--------------- Memory-CODE-->|HOST-XXX||VM-XX|--- ------------------+---------------- |CPU + Stroage-->|---Controller----|---DATA-----|--- |CPU + Network-->|---Controller----|---DATA-----|--- 1. \u8f6f\u786c\u4ef6\u914d\u7f6e \u7b97\u6cd5\u8bbe\u8ba1\u5b8c\u6210\u540e\u5982\u679c\u6709\u9ad8\u9891\u9700\u6c42\uff0c\u53ef\u80fd\u9700\u8981\u8bbe\u8ba1FPGA\u3002 \u76ee\u524d\u91c7\u7528Xilinx\u7684Zynq MPSoC\u4ee5\u53caKintex-7\u4e24\u6b3eFPGA\uff0c\u57fa\u7840\u8bbe\u65bd\u4ee5\u53ca\u4e1a\u52a1\u5c42\u9762\uff0c\u53ef\u52a0\u901f\u7684\u5185\u5bb9\u90fd\u975e\u5e38\u591a\uff0c\u5305\u62ec\u8d1f\u8f7d\u5747\u8861\u3001\u7b97\u6cd5\u56fa\u5316\u3001\u52a0\u89e3\u5bc6\u3001\u7f51\u7edc\u5378\u8f7d\u7b49\u3002 HPC\u96c6\u7fa4\u6682\u65f6\u4f7f\u7528ARM+NVIDIA\u67b6\u6784\uff0c\u65e0\u5b9e\u65f6\u5904\u7406\u90e8\u5206\uff0c\u4ec5\u8bad\u7ec3\u4ee5\u53ca\u51fd\u6570\u8ba1\u7b97\u670d\u52a1\u3002 \u8003\u8651\u5230\u90e8\u5206\u6570\u636e\u4f20\u8f93\u5ef6\u8fdf\u95ee\u9898\uff0c\u4f1a\u91c7\u7528CPLD/FPGA\u6216\u4e13\u7528\u65e0\u7ebf\u7535\u5fae\u6ce2\u4f20\u8f93\uff0c\u9891\u7387\u57286GHz\u4ee5\u4e0a\uff08\u4f4e\u4e8e\u6b64\u7684\u610f\u4e49\u4e0d\u5927\uff09\uff0c\u76ee\u524d\u6210\u719f\u4ea7\u54c1\u4e3a80Ghz\uff0c\u901f\u7387\u4e3a3Gbps\u3002\u5982\u6b64\u4ee5\u6765\uff0c\u4f26\u6566\u5230\u6cd5\u5170\u514b\u798f\uff08396\u82f1\u91cc\uff0c673\u516c\u91cc\uff09\u7684\u5ef6\u8fdf\u53ef\u4ece\u4f20\u7edf\u5149\u4f20\u8f93\u6240\u82b1\u8d39\u768417ms\u964d\u81f34.2\u6beb\u79d2\u3002 \u4e00\u76f4\u60f3\u641e\u53f0\u5927\u578b\u673a\uff0c\u54ea\u6015\u662f\u73a9\u73a9\u626b\u96f7\u4e5f\u6210\uff0c\u6240\u4ee5\u57fa\u7840\u8bbe\u65bd\u4e2d\u5148\u52a0\u4e2a\u73a9\u5177\u5927\u578b\u673a\u3002 1.1. FPGA\u5904\u7406\u6280\u672f\u6307\u6807 1.2. \u57fa\u4e8eARM\u4e0eNVIDIA GPU\u6216FPGA TPU\u7684HPC\u96c6\u7fa4 https://github.com/Xilinx/ml-suite 1.3. FPGA\u52a0\u901f\u673a\u5668\u5b66\u4e60\u6846\u67b6 1.4. \u65e0\u7ebf\u7535\u5fae\u6ce2\u4f20\u8f93\u964d\u4f4e\u5ef6\u8fdf 1.5. IBM\u5927\u578b\u673a\u6a21\u62df\u5668Hercules\uff08\u8fc1\u79fb\uff09 1.6. \u9ad8\u6027\u80fd\u865a\u62df\u5316 2. \u4ea4\u6613\u5907\u6ce8 \u6765\u6e90\u51fd\u6570\u3001\u5373\u65f6\u6307\u6807 3. \u5e73\u53f0\u5efa\u8bbe \u7ad9\u70b9\u6682\u5b9a\u65e5\u672c\u8282\u70b9\u4e0e\u56fd\u5185\u8282\u70b9\uff0c\u7f8e\u56fd\u8282\u70b9\u5148\u4e0d\u5f00\u901a\u3002\u8282\u70b9\u95f4\u4fe1\u606f\u540c\u6b65\u5ef6\u8fdf\u53ca\u5e26\u5bbd\u53ef\u4f7f\u7528\u540c\u4e00\u5bb6IDC\u65b9\u5f0f\u89e3\u51b3\uff0c\u641c\u7d22\u5f15\u64ce\u53ef\u91c7\u7528\u5206\u5e03\u5f0f\uff0c\u6570\u636e\u5e93\u53ef\u7528\u5206\u5e03\u5f0f\uff0c\u5b58\u50a8\u53ef\u8de8\u56fd\u540c\u6b65\u3002 \u529f\u80fd\u83dc\u5355 \u65b0\u95fb\u67e5\u770b \u65b0\u95fb\u641c\u7d22 \u6c47\u5e02\u67e5\u770b","title":"\u7b2c\u4e03\u7ae0 \u6307\u5bfc\u767d\u76ae\u4e66"},{"location":"datanote/ch07/#_1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 +----------+ |Memory | | +==> |Structure | +----+-----+ |CPU -------------------+--------------- Memory-CODE-->|HOST-XXX||VM-XX|--- ------------------+---------------- |CPU + Stroage-->|---Controller----|---DATA-----|--- |CPU + Network-->|---Controller----|---DATA-----|---","title":"\u7b2c\u4e03\u7ae0 \u6307\u5bfc\u767d\u76ae\u4e66"},{"location":"datanote/ch07/#1","text":"\u7b97\u6cd5\u8bbe\u8ba1\u5b8c\u6210\u540e\u5982\u679c\u6709\u9ad8\u9891\u9700\u6c42\uff0c\u53ef\u80fd\u9700\u8981\u8bbe\u8ba1FPGA\u3002 \u76ee\u524d\u91c7\u7528Xilinx\u7684Zynq MPSoC\u4ee5\u53caKintex-7\u4e24\u6b3eFPGA\uff0c\u57fa\u7840\u8bbe\u65bd\u4ee5\u53ca\u4e1a\u52a1\u5c42\u9762\uff0c\u53ef\u52a0\u901f\u7684\u5185\u5bb9\u90fd\u975e\u5e38\u591a\uff0c\u5305\u62ec\u8d1f\u8f7d\u5747\u8861\u3001\u7b97\u6cd5\u56fa\u5316\u3001\u52a0\u89e3\u5bc6\u3001\u7f51\u7edc\u5378\u8f7d\u7b49\u3002 HPC\u96c6\u7fa4\u6682\u65f6\u4f7f\u7528ARM+NVIDIA\u67b6\u6784\uff0c\u65e0\u5b9e\u65f6\u5904\u7406\u90e8\u5206\uff0c\u4ec5\u8bad\u7ec3\u4ee5\u53ca\u51fd\u6570\u8ba1\u7b97\u670d\u52a1\u3002 \u8003\u8651\u5230\u90e8\u5206\u6570\u636e\u4f20\u8f93\u5ef6\u8fdf\u95ee\u9898\uff0c\u4f1a\u91c7\u7528CPLD/FPGA\u6216\u4e13\u7528\u65e0\u7ebf\u7535\u5fae\u6ce2\u4f20\u8f93\uff0c\u9891\u7387\u57286GHz\u4ee5\u4e0a\uff08\u4f4e\u4e8e\u6b64\u7684\u610f\u4e49\u4e0d\u5927\uff09\uff0c\u76ee\u524d\u6210\u719f\u4ea7\u54c1\u4e3a80Ghz\uff0c\u901f\u7387\u4e3a3Gbps\u3002\u5982\u6b64\u4ee5\u6765\uff0c\u4f26\u6566\u5230\u6cd5\u5170\u514b\u798f\uff08396\u82f1\u91cc\uff0c673\u516c\u91cc\uff09\u7684\u5ef6\u8fdf\u53ef\u4ece\u4f20\u7edf\u5149\u4f20\u8f93\u6240\u82b1\u8d39\u768417ms\u964d\u81f34.2\u6beb\u79d2\u3002 \u4e00\u76f4\u60f3\u641e\u53f0\u5927\u578b\u673a\uff0c\u54ea\u6015\u662f\u73a9\u73a9\u626b\u96f7\u4e5f\u6210\uff0c\u6240\u4ee5\u57fa\u7840\u8bbe\u65bd\u4e2d\u5148\u52a0\u4e2a\u73a9\u5177\u5927\u578b\u673a\u3002","title":"1. \u8f6f\u786c\u4ef6\u914d\u7f6e"},{"location":"datanote/ch07/#11-fpga","text":"","title":"1.1. FPGA\u5904\u7406\u6280\u672f\u6307\u6807"},{"location":"datanote/ch07/#12-armnvidia-gpufpga-tpuhpc","text":"https://github.com/Xilinx/ml-suite","title":"1.2. \u57fa\u4e8eARM\u4e0eNVIDIA GPU\u6216FPGA TPU\u7684HPC\u96c6\u7fa4"},{"location":"datanote/ch07/#13-fpga","text":"","title":"1.3. FPGA\u52a0\u901f\u673a\u5668\u5b66\u4e60\u6846\u67b6"},{"location":"datanote/ch07/#14","text":"","title":"1.4. \u65e0\u7ebf\u7535\u5fae\u6ce2\u4f20\u8f93\u964d\u4f4e\u5ef6\u8fdf"},{"location":"datanote/ch07/#15-ibmhercules","text":"","title":"1.5. IBM\u5927\u578b\u673a\u6a21\u62df\u5668Hercules\uff08\u8fc1\u79fb\uff09"},{"location":"datanote/ch07/#16","text":"","title":"1.6. \u9ad8\u6027\u80fd\u865a\u62df\u5316"},{"location":"datanote/ch07/#2","text":"\u6765\u6e90\u51fd\u6570\u3001\u5373\u65f6\u6307\u6807","title":"2. \u4ea4\u6613\u5907\u6ce8"},{"location":"datanote/ch07/#3","text":"\u7ad9\u70b9\u6682\u5b9a\u65e5\u672c\u8282\u70b9\u4e0e\u56fd\u5185\u8282\u70b9\uff0c\u7f8e\u56fd\u8282\u70b9\u5148\u4e0d\u5f00\u901a\u3002\u8282\u70b9\u95f4\u4fe1\u606f\u540c\u6b65\u5ef6\u8fdf\u53ca\u5e26\u5bbd\u53ef\u4f7f\u7528\u540c\u4e00\u5bb6IDC\u65b9\u5f0f\u89e3\u51b3\uff0c\u641c\u7d22\u5f15\u64ce\u53ef\u91c7\u7528\u5206\u5e03\u5f0f\uff0c\u6570\u636e\u5e93\u53ef\u7528\u5206\u5e03\u5f0f\uff0c\u5b58\u50a8\u53ef\u8de8\u56fd\u540c\u6b65\u3002","title":"3. \u5e73\u53f0\u5efa\u8bbe"},{"location":"datanote/ch07/#_2","text":"","title":"\u529f\u80fd\u83dc\u5355"},{"location":"datanote/ch07/#_3","text":"","title":"\u65b0\u95fb\u67e5\u770b"},{"location":"datanote/ch07/#_4","text":"","title":"\u65b0\u95fb\u641c\u7d22"},{"location":"datanote/ch07/#_5","text":"","title":"\u6c47\u5e02\u67e5\u770b"},{"location":"datanote/ch08/","text":"\u7b2c\u516b\u7ae0 \u4ee3\u7406\u4eba\u6a21\u578b \u4e2a\u6027","title":"\u7b2c\u516b\u7ae0 \u533a\u5757\u94fe\u8d27\u5e01\u5957\u5229\u6a21\u578b"},{"location":"datanote/ch08/#_1","text":"","title":"\u7b2c\u516b\u7ae0 \u4ee3\u7406\u4eba\u6a21\u578b"},{"location":"datanote/ch08/#_2","text":"","title":"\u4e2a\u6027"},{"location":"datanote/ch09/","text":"\u7b2c\u4e5d\u7ae0 \u533a\u5757\u94fe\u8d27\u5e01\u5957\u5229\u6a21\u578b \u4e2a\u6027","title":"\u7b2c\u4e5d\u7ae0 \u533a\u5757\u94fe\u8d27\u5e01\u5957\u5229\u6a21\u578b"},{"location":"datanote/ch09/#_1","text":"","title":"\u7b2c\u4e5d\u7ae0 \u533a\u5757\u94fe\u8d27\u5e01\u5957\u5229\u6a21\u578b"},{"location":"datanote/ch09/#_2","text":"","title":"\u4e2a\u6027"},{"location":"inthecloud/","text":"In the Cloud \u6587\u6863\u66f4\u65b0\u8bf4\u660e 2021-02-25 \u672c\u6587\u6863\u73b0\u5df2\u4e0d\u518d\u7ef4\u62a4\u3002 \u7531\u4e8e\u6210\u6587\u65f6\uff082014\u5e74\uff09\u5e02\u9762\u4e0a\u5e76\u6ca1\u6709\u7279\u522b\u51fa\u8272\u7684\u79c1\u6709\u4e91 \u4ea7\u54c1 \uff0c\u6240\u4ee5\u8fd9\u4e2a\u7b97\u662f\u63a2\u7d22\u548c\u5b66\u4e60\uff0c\u73b0\u5728\u56de\u5934\u770b\u672a\u514d\u7a1a\u5ae9\uff0c\u4f46\u7b14\u8005\u6700\u5927\u7684\u6536\u83b7\u5c31\u662f\u5165\u4e86\u4e2a\u95e8\uff0c\u5e76\u4e14\u53d1\u73b0 \u505a\u597d\u7528\u7684\u4ea7\u54c1\u6bd4\u62ff\u5f00\u6e90\u6539\u6539\u96be\u591a\u4e86\u54c7 \u3002 Github\u94fe\u63a5\u4e3a https://github.com/lofyer/inthecloud \uff0c\u6700\u65e9\u53d1\u5e03\u4e8e ReadTheDocs \u3002 \u672c\u6587\u6863\u5df2\u7ecf\u6df1\u5ea6\u63d0\u70bc\uff0c\u4f5c\u4e3a\u300aKVM\u79c1\u6709\u4e91\u67b6\u6784\u8bbe\u8ba1\u4e0e\u5b9e\u8df5\u300b\u4e00\u4e66\u7684\u53c2\u8003\u5185\u5bb9\u4e4b\u4e00\uff08\u65b0\u7248\u76ee\u5f55\u53ef\u81f3 lofyer.org \u67e5\u770b\uff09\uff0c\u5df2\u7531\u4e0a\u6d77\u4ea4\u901a\u5927\u5b66\u51fa\u7248\u793e\u51fa\u7248\u3002","title":"Index"},{"location":"inthecloud/#in-the-cloud","text":"\u6587\u6863\u66f4\u65b0\u8bf4\u660e 2021-02-25 \u672c\u6587\u6863\u73b0\u5df2\u4e0d\u518d\u7ef4\u62a4\u3002 \u7531\u4e8e\u6210\u6587\u65f6\uff082014\u5e74\uff09\u5e02\u9762\u4e0a\u5e76\u6ca1\u6709\u7279\u522b\u51fa\u8272\u7684\u79c1\u6709\u4e91 \u4ea7\u54c1 \uff0c\u6240\u4ee5\u8fd9\u4e2a\u7b97\u662f\u63a2\u7d22\u548c\u5b66\u4e60\uff0c\u73b0\u5728\u56de\u5934\u770b\u672a\u514d\u7a1a\u5ae9\uff0c\u4f46\u7b14\u8005\u6700\u5927\u7684\u6536\u83b7\u5c31\u662f\u5165\u4e86\u4e2a\u95e8\uff0c\u5e76\u4e14\u53d1\u73b0 \u505a\u597d\u7528\u7684\u4ea7\u54c1\u6bd4\u62ff\u5f00\u6e90\u6539\u6539\u96be\u591a\u4e86\u54c7 \u3002 Github\u94fe\u63a5\u4e3a https://github.com/lofyer/inthecloud \uff0c\u6700\u65e9\u53d1\u5e03\u4e8e ReadTheDocs \u3002 \u672c\u6587\u6863\u5df2\u7ecf\u6df1\u5ea6\u63d0\u70bc\uff0c\u4f5c\u4e3a\u300aKVM\u79c1\u6709\u4e91\u67b6\u6784\u8bbe\u8ba1\u4e0e\u5b9e\u8df5\u300b\u4e00\u4e66\u7684\u53c2\u8003\u5185\u5bb9\u4e4b\u4e00\uff08\u65b0\u7248\u76ee\u5f55\u53ef\u81f3 lofyer.org \u67e5\u770b\uff09\uff0c\u5df2\u7531\u4e0a\u6d77\u4ea4\u901a\u5927\u5b66\u51fa\u7248\u793e\u51fa\u7248\u3002","title":"In the Cloud"},{"location":"inthecloud/about/","text":"\u5173\u4e8e\u4f5c\u8005\u4e0e\u6587\u6863 \u6587\u6863\u57fa\u672c\u5df2\u6682\u505c\u66f4\u65b0\uff0c\u8ba1\u5212\u51fa\u4e66\u4e2d\uff0c\u8be6\u60c5\u89c1\u4f5c\u8005\u535a\u5ba2\u3002 Author: \u5341\u516d\uff08lofyer\uff09 Mail: lofyer@gmail.com \u65b0\u6d6a\u5fae\u535a: lofyer QQ: 578645806 \u5fae\u4fe1: 578645806 \u4e2a\u4eba\u535a\u5ba2: http://blog.lofyer.org \u5728\u7ebf\u9605\u8bfb ReadTheDocs: https://inthecloud.readthedocs.org ```{raw} html \u8fd9\u662f\u4e00\u672c\u4e91\u8ba1\u7b97\u5165\u95e8\u624b\u518c\uff0c\u5185\u5bb9\u6bd4\u8f83\u7b80\u5355\u4f46\u662f\u53c8\u590d\u6742\uff0c \u53ef\u5f53\u4f5c\u5b66\u4e60\u53c2\u8003map \u3002 \u5185\u5bb9\u4e3b\u8981\u6db5\u76d6\uff1a oVirt \uff0c Glusterfs \uff0c Hadoop \uff0c OpenStack \uff0c \u5bb6\u5c45\u4e91 \uff0c\u4ee5\u53ca\u5404\u79cd\u53ef\u4ee5 \u6298\u817e\u7684\u5c0f\u4e1c\u897f \u3002\u5f53\u7136\uff0c\u5982\u679c\u4f60\u6709\u4ec0\u4e48\u597d\u7684\u610f\u89c1\u6216\u8005\u5efa\u8bae\u53ef\u4ee5 \u65b0\u5efaissue \uff0c\u6216\u8005\u5728 v2ex \u4e0a\u7559\u8a00\uff0c\u518d\u6216\u8005\u53bb Lofyer's Archive \u7559\u8a00\uff0c\u6216\u8005\u5e72\u8106 \u53d1\u90ae\u4ef6 \u7ed9\u6211\u3002 InTheCloud is licensed under a Creative Commons Attribution 4.0 International License . ```","title":"\u5173\u4e8e\u4f5c\u8005\u4e0e\u6587\u6863"},{"location":"inthecloud/about/#_1","text":"\u6587\u6863\u57fa\u672c\u5df2\u6682\u505c\u66f4\u65b0\uff0c\u8ba1\u5212\u51fa\u4e66\u4e2d\uff0c\u8be6\u60c5\u89c1\u4f5c\u8005\u535a\u5ba2\u3002 Author: \u5341\u516d\uff08lofyer\uff09 Mail: lofyer@gmail.com \u65b0\u6d6a\u5fae\u535a: lofyer QQ: 578645806 \u5fae\u4fe1: 578645806 \u4e2a\u4eba\u535a\u5ba2: http://blog.lofyer.org \u5728\u7ebf\u9605\u8bfb ReadTheDocs: https://inthecloud.readthedocs.org ```{raw} html \u8fd9\u662f\u4e00\u672c\u4e91\u8ba1\u7b97\u5165\u95e8\u624b\u518c\uff0c\u5185\u5bb9\u6bd4\u8f83\u7b80\u5355\u4f46\u662f\u53c8\u590d\u6742\uff0c \u53ef\u5f53\u4f5c\u5b66\u4e60\u53c2\u8003map \u3002 \u5185\u5bb9\u4e3b\u8981\u6db5\u76d6\uff1a oVirt \uff0c Glusterfs \uff0c Hadoop \uff0c OpenStack \uff0c \u5bb6\u5c45\u4e91 \uff0c\u4ee5\u53ca\u5404\u79cd\u53ef\u4ee5 \u6298\u817e\u7684\u5c0f\u4e1c\u897f \u3002\u5f53\u7136\uff0c\u5982\u679c\u4f60\u6709\u4ec0\u4e48\u597d\u7684\u610f\u89c1\u6216\u8005\u5efa\u8bae\u53ef\u4ee5 \u65b0\u5efaissue \uff0c\u6216\u8005\u5728 v2ex \u4e0a\u7559\u8a00\uff0c\u518d\u6216\u8005\u53bb Lofyer's Archive \u7559\u8a00\uff0c\u6216\u8005\u5e72\u8106 \u53d1\u90ae\u4ef6 \u7ed9\u6211\u3002 InTheCloud is licensed under a Creative Commons Attribution 4.0 International License . ```","title":"\u5173\u4e8e\u4f5c\u8005\u4e0e\u6587\u6863"},{"location":"inthecloud/appendix01/","text":"\u9644\u5f55\u4e00 OpenStack\u6982\u5ff5\u3001\u90e8\u7f72\u3001\u4e0e\u9ad8\u7ea7\u7f51\u7edc\u5e94\u7528 \u9996\u5148\u5728\u8fd9\u91cc\u6211\u4f1a\u4f7f\u7528RDO\u5feb\u901f\u90e8\u7f72\u4e00\u4e2a\u5177\u6709\u57fa\u672c\u529f\u80fd\u7684OpenStack\u73af\u5883\uff0c\u5982\u679c\u4f60\u60f3\u8981\u66f4\u5b8c\u6574\u7684\u90e8\u7f72\uff08\u6bd4\u5982Heat\u3001Trove\u7ec4\u4ef6\uff09\uff0c\u53ef\u4ee5\u53c2\u8003 \u5b98\u65b9\u6587\u6863 \u3002 \u4e5f\u53ef\u4ee5\u4f7f\u7528Mirantis\u6765\u8fdb\u884c\u5feb\u901f\u90e8\u7f72\uff0c\u53c2\u8003 Mirantis \uff1bStackOps\u90e8\u7f72\uff0c\u53c2\u8003 StackOps \u3002 \u5982\u679c\u4e0d\u60f3\u5b89\u88c5\u4efb\u4f55\u4e1c\u897f\uff0c\u53ea\u662f\u5728\u7ebf\u4f7f\u7528\u7684\u8bdd\uff0c\u53ef\u4ee5\u8bbf\u95ee http://trystack.org/ \u3002 \u8981\u5b66\u4e60\u66f4\u591a\u5173\u4e8eOpenStack\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u53c2\u8003 \u9648\u6c99\u514b\u7684\u65e5\u5fd7 \u3002 API\u4f7f\u7528\u8bf7\u53c2\u8003http://developer.openstack.org/api-ref.html \u4ee5\u53ca http://docs.openstack.org/developer/openstack-projects.html \u3002 \u5173\u4e8e\u5728centos/ubuntu/debian\u4e0a\u90e8\u7f72OpenStack\u8bf7\u53c2\u8003 Server-World \uff0c\u8fd9\u4e2a\u66f4\u65b0\u8f83\u4e3a\u53ca\u65f6\u3002 \u7b14\u8005\u6700\u8fd1\u4eff\u7167Mirantis\u64b8\u4e86\u4e00\u4e2a\u811a\u672c\uff0c\u5168\u81ea\u52a8\u5b89\u88c5\u90e8\u7f72OpenStack\uff0c\u6253\u7b97\u518d\u5199\u4e2aDjango\u62d6\u62fd\u5b89\u88c5\u3002\u5f53\u7136\uff0c\u8981\u914d\u4e0akubernestes\u90e8\u7f72\u4e86\u3002\u8bf7\u53c2\u8003 https://github.com/lofyer/openstack-pxe-deployment \u3002 OpenStack \u90e8\u7f72 \u5728\u5f00\u59cb\u4e4b\u524d\u9700\u8981\u5c06\u8fd9\u4e9b\u5173\u952e\u7ec4\u4ef6\u5173\u7cfb\u7406\u6e05\u3002 nova\uff1a\u63d0\u4f9bcompute\u670d\u52a1\uff0c\u5373\u4fdd\u8bc1\u865a\u62df\u673a\u8fd0\u884c\u7684\u5fc5\u987b\u670d\u52a1\u4e4b\u4e00\uff0c\u865a\u62df\u673a\u8fd0\u884c\u4e8e\u6240\u6709\u63d0\u4f9bcompute\u670d\u52a1\u7684\u4e3b\u673a\u4e4b\u4e0a\u3002 neutron\uff1a\u63d0\u4f9bnetwork\u670d\u52a1\uff0c\u540c\u65f6\u63d0\u4f9bOpen vSwitch\u3001L3\u3001DHCP\u4ee3\u7406\u670d\u52a1\u3002 cinder\uff1a\u63d0\u4f9b\u5757\u5b58\u50a8\u670d\u52a1\uff0c\u53ef\u914d\u5408swift\u4f7f\u7528\u3002 swift\uff1a\u63d0\u4f9b\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\uff0c\u76ee\u5f55\u4e0e\u6587\u4ef6\u7686\u89c6\u4e3a\u5bf9\u8c61\uff0c\u5916\u90e8\u53ef\u4ee5\u65b9\u4fbf\u53d6\u7528\u3002 glance\uff1a\u63d0\u4f9b\u955c\u50cf\u7ba1\u7406\u670d\u52a1\u3002 ceilometer\uff1a\u4e3b\u8981\u529f\u80fd\u662f\u76d1\u6d4b\u3001\u6536\u96c6\u7528\u6237\u5bf9\u8d44\u6e90\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u4ee5\u65b9\u4fbf\u8ba1\u8d39\u3001\u62a5\u8b66\u7b49\u3002 heat\uff1aorchestration\u6a21\u5757\u9a71\u52a8\u670d\u52a1\uff0c\u5373\u4ece\u6a21\u677f\u6839\u636e\u9700\u6c42\u66f4\u6539\u914d\u7f6e\u521b\u5efa\u65b0\u865a\u62df\u673a\u3002 keystone\uff1a\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u3002 trove\uff1a\u6570\u636e\u5e93\u670d\u52a1\u3002 sahara\uff1aHadoop\u6a21\u5757\u3002 ironic\uff1a\u63d0\u4f9b\u4ece\u6a21\u677f\u521b\u5efa\u65b0\u5e94\u7528\u7a0b\u5e8f\u3002 Mirantis Fuel \u90e8\u7f72 \u73b0\u5728\u56fd\u5185\u4f7f\u7528Mirantis\u90e8\u7f72\u7684\u4eba\u5df2\u7ecf\u8d8a\u6765\u8d8a\u591a\u4e86\uff0c\u800c\u6211\u4eec\u540c\u6837\u4f7f\u7528\u5b83\u6765\u4e00\u6b21\u5feb\u901f\u90e8\u7f72\u3002\u7cbe\u901a\u4e86Mirantis\u5c31\u638c\u63e1\u4e86\u5927\u89c4\u6a21\u96c6\u7fa4\u7684\u90e8\u7f72\u65b9\u5f0f\uff0c\u4e0d\u53ea\u662fOpenStack\u3002 RDO \u5feb\u901f\u90e8\u7f72 \u4f7f\u7528 RDO \u6765\u90e8\u7f72OpenStack\u3002 :::{note} \u5b89\u88c5\u8bf4\u660e \u5728\u4e00\u53f0\u5b89\u88c5\u6709RedHat\u7cfb\u5217\uff08CentOS\uff09\u7cfb\u7edf\u4e0a\u90e8\u7f72\uff0c\u5c06selinux\u7f6e\u4e3apermissive\uff1b\u7981\u7528NetworkManager\uff0c\u542f\u7528network\u670d\u52a1\uff0c\u8be6\u7ec6\u914d\u7f6e\u8bf7\u53c2\u8003\u4ee5\u524d\u7ae0\u8282\u3002 \u5982\u679c\u5b89\u88c5\u5931\u8d25\uff0c\u8bf7\u67e5\u770b\u4f60\u7684CentOS\u6216\u8005Fedora\u662f\u5426\u4e3a\u6700\u65b0\u53d1\u884c\u7248\u3002\u7b14\u8005\u5728\u5199\u65f6\u4f7f\u7528\u7684\u662fCentOS6\uff0c\u76ee\u524d\u4e3aCentOS7\u3002 ::: 1 2 3 4 5 # yum install -y http://rdo.fedorapeople.org/rdo-release.rpm # yum install -y epel-release # yum update -y # yum install -y openstack-packstack # packstack --allinone \u8bf7\u8010\u5fc3\u7b49\u5f85\uff0c\u4ee5\u4e0a\u8fc7\u7a0b\u9884\u8ba1\u82b1\u8d39\u4e00\u5230\u4e24\u5c0f\u65f6\u3002\u6709\u5173\u6b64\u6b21\u90e8\u7f72\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5728\u5b89\u88c5\u5b8c\u6210\u540e\u53ef\u4ee5\u770b\u5230\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 **** Installation completed successfully ****** Additional information: * A new answerfile was created in: /root/packstack-answers-20140730-110621.txt * Time synchronization installation was skipped. Please note that unsynchronized time on server instances might be problem for some OpenStack components. * File /root/keystonerc_admin has been created on OpenStack client host 192.168.2.160. To use the command line tools you need to source the file. * To access the OpenStack Dashboard browse to http://192.168.2.160/dashboard . Please, find your login credentials stored in the keystonerc_admin in your home directory. * To use Nagios, browse to http://192.168.2.160/nagios username: nagiosadmin, password: ea65dc070f034776 * Because of the kernel update the host 192.168.2.160 requires reboot. * The installation log file is available at: /var/tmp/packstack/20140730-110621-upxlZJ/openstack-setup.log * The generated manifests are available at: /var/tmp/packstack/20140730-110621-upxlZJ/manifests \u53ef\u4fee\u6539 /root/packstack-answers-20140730-110621.txt \u5185\u5bb9\u4ee5 \u589e\u52a0\u8ba1\u7b97\u8282\u70b9 \uff1b\u540c\u7406\u53ef\u589e\u52a0\u7f51\u7edc\u8282\u70b9\uff08\u5f85\u5b9e\u9a8c\uff09\u3002 :::{note} \u5047\u5982\u66f4\u6362\u4e86admin/demo/services\u7684\u5bc6\u7801\uff0c\u4e0d\u8981\u5fd8\u8bb0\u5728\u6b64\u914d\u7f6e\u6587\u4ef6\u4e2d\u5c06\u5176\u4fee\u6539\u4e3a\u65b0\u5bc6\u7801\u3002 packstack --answer-file=/root/packstack-answers-20140730-110621.txt ::: \u6dfb\u52a0\u8ba1\u7b97\u8282\u70b9 \u4f7f\u7528Neutron\u7f51\u7edc \u5206\u6b65\u8be6\u7ec6\u90e8\u7f72 CentOS 7\u4ee5\u53caUbuntu\u7b49\u53d1\u884c\u7248\u90e8\u7f72OpenStack\u7684\u8fc7\u7a0b\u57fa\u672c\u4e00\u81f4\uff0c\u5728\u6b64\u4ee5CentOS 7\u793a\u4f8b\u3002 \u673a\u5668\u51c6\u5907 \u63a7\u5236\u8282\u70b9\uff1acontroller0(192.168.77.50) \u8ba1\u7b97\u8282\u70b9\uff1acontroller0(192.168.77.50)\uff0ccompute0(192.168.77.51) \u7f51\u7edc\u8282\u70b9\uff1aneutron0(192.168.77.30) \u5b58\u50a8\u8282\u70b9\uff1acinder0(192.168.77.60)\uff0cswift0(192.168.77.70)\uff0cswift-stor0(192.168.77.71)\uff0cswift-stor1(192.168.77.72)\uff0cswift-stor2(192.168.77.73) Heat\u8282\u70b9\uff1aheat0(192.168.77.80) \u6bcf\u53f0\u673a\u5668\u9996\u5148\u5c06selinux\u8bbe\u7f6e\u4e3apermissive\u6216\u8005disable\u3001\u6253\u5f00ssh\u670d\u52a1\u3001\u7981\u7528\u9632\u706b\u5899\uff08\u53ef\u5b89\u88c5iptables-services\u670d\u52a1\uff0c\u5173\u95edfirewalld\uff0ciptables -F\u540e\u518dservice iptables save\uff09\u3001\u5173\u95edNetworkManager\u670d\u52a1\u3001\u6253\u5f00network\u670d\u52a1\u5e76\u914d\u7f6eIP\u3002 :::{note} bash_rc\u6587\u4ef6\u7528\u4f8b bash_rc\u6587\u4ef6\u6bd4\u5982os_bootstrap\u3001admin_keystone\uff0c\u5176\u4e2dos_bootstrap\u7528\u4e8e\u521b\u5efa\u57fa\u672ckeystone\u670d\u52a1\u4f7f\u7528\uff0cadmin_keystone\u4e3a\u521b\u5efa\u7684admin\u7528\u6237\u3002 ::: :::{note} \u8ba4\u8bc1\u670d\u52a1 OpenStack\u4e2d\u7684keystone\u670d\u52a1\u8d1f\u8d23\u7edd\u5927\u90e8\u5206authentication\u7684\u5de5\u4f5c\uff0c\u5176\u4e2d\u5c5e\u4e8eservice\u7ec4\u7684\u7528\u6237\uff08nova\u3001glance\uff09\u4e5f\u662f\u57fa\u4e8ekeystone\u8ba4\u8bc1\u7684\uff0c\u6240\u4ee5\u4e0d\u8981\u8ba4\u4e3aservice\u4e2d\u7684\u670d\u52a1\u4ec5\u4ec5\u662f\u4e00\u4e2a\u670d\u52a1\u800c\u5df2\u3002 ::: 1 2 3 4 5 6 7 8 9 10 # cat os_bootstrap export SERVICE_TOKEN=admin export SERVICE_ENDPOINT=http://192.168.77.50:35357/v2.0/ # cat admin_keystone export OS_USERNAME=admin export OS_PASSWORD=admin export OS_TENANT_NAME=admin export OS_AUTH_URL=http://localhost:35357/v2.0/ export PS1='[\\u@\\h \\W(keystone)]\\$ ' \u521d\u59cb\u5316\u63a7\u5236\u8282\u70b9 \u5728\u63a7\u5236\u8282\u70b9controller0\uff0c\u914d\u7f6e\u6e90\u3001\u6570\u636e\u5e93\u3001RabbitMQ\u3001Memcached\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 [root@controller0 ~]# yum -y install http://repos.fedorapeople.org/repos/openstack/openstack-kilo/rdo-release-kilo.rpm epel-release [root@controller0 ~]# yum install -y galera mariadb-galera-server rabbitmq-server memcached [root@controller0 ~]# systemctl start mariadb [root@controller0 ~]# systemctl enable mariadb [root@controller0 ~]# systemctl start rabbitmq-server [root@controller0 ~]# systemctl enable rabbitmq-server [root@controller0 ~]# systemctl start memcached [root@controller0 ~]# systemctl enable memcached # \u521d\u59cb\u5316mysql [root@controller0 ~]# mysql_secure_installation /usr/bin/mysql_secure_installation: line 379: find_mysql_client: command not found NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY! In order to log into MariaDB to secure it, we'll need the current password for the root user. If you've just installed MariaDB, and you haven't set the root password yet, the password will be blank, so you should just press enter here. Enter current password for root (enter for none): OK, successfully used password, moving on... Setting the root password ensures that nobody can log into the MariaDB root user without the proper authorisation. # \u8bbe\u7f6emysql\u7684root\u5bc6\u7801 Set root password? [Y/n] y New password: Re-enter new password: Password updated successfully! Reloading privilege tables.. ... Success! By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment. # remove anonymous users Remove anonymous users? [Y/n] y ... Success! Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network. # disallow root login remotely Disallow root login remotely? [Y/n] y ... Success! By default, MariaDB comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment. # remove test database Remove test database and access to it? [Y/n] y - Dropping test database... ... Success! - Removing privileges on test database... ... Success! Reloading the privilege tables will ensure that all changes made so far will take effect immediately. # reload privilege tables Reload privilege tables now? [Y/n] y ... Success! Cleaning up... All done! If you've completed all of the above steps, your MariaDB installation should now be secure. Thanks for using MariaDB! # \u91cd\u7f6erabbitmq\u5bc6\u7801 [root@controller0 ~]# rabbitmqctl change_password guest password \u914d\u7f6eKeyStone \u521d\u59cb\u5316Keystone 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # \u5b89\u88c5keystone [root@controller0 ~]# yum install -y openstack-keystone openstack-utils # \u6dfb\u52a0\u6570\u636e\u5e93 [root@controller0 ~]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 10 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database keystone; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on keystone.* to keystone@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on keystone.* to keystone@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye \u914d\u7f6ekeystone 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 [root@controller0 ~]# vi /etc/keystone/keystone.conf # line 13: \u8d85\u7ea7\u7ba1\u7406\u5458\u5bc6\u7801\u4e3aadmin\uff0c\u6b64\u5bc6\u7801\u4ec5\u4f9b\u8bbe\u7f6ekeystone\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5e94\u8be5\u7981\u7528 admin_token=admin # line 418: database connection=mysql://keystone:password@localhost/keystone # line 1434: token\u683c\u5f0f # \u53ef\u80fd\u4e0d\u8981 token_format=PKI # line 1624: signing certfile=/etc/keystone/ssl/certs/signing_cert.pem keyfile=/etc/keystone/ssl/private/signing_key.pem ca_certs=/etc/keystone/ssl/certs/ca.pem ca_key=/etc/keystone/ssl/private/cakey.pem key_size=2048 valid_days=3650 cert_subject=/C=CN/ST=Di/L=Jiang/O=InTheCloud/CN=controller0.lofyer.org # \u8bbe\u7f6e\u8bc1\u4e66\uff0c\u540c\u6b65\u6570\u636e\u5e93 [root@controller0 ~]# keystone-manage pki_setup --keystone-user keystone --keystone-group keystone [root@controller0 ~]# keystone-manage db_sync # \u5220\u9664\u65e5\u5fd7\u6587\u4ef6\u5e76\u542f\u52a8\uff0c\u5426\u5219\u53ef\u80fd\u56e0\u4e3alog\u6587\u4ef6\u6743\u9650\u95ee\u9898\u800c\u62a5\u9519 [root@controller0 ~]# rm /var/log/keystone/keystone.log [root@controller0 ~]# systemctl start openstack-keystone [root@controller0 ~]# systemctl enable openstack-keystone \u6dfb\u52a0\u7528\u6237\u3001\u89d2\u8272\u3001\u670d\u52a1\u4e0eendpoint \u5c06\u8d85\u7ea7\u7ba1\u7406\u5458\u914d\u7f6e\u4fdd\u5b58\u5230\u6587\u4ef6\uff0c\u65b9\u4fbf\u4ee5\u540e\u7ba1\u7406\uff1a 1 2 3 4 [root@controller0 ~]# cat os_bootstrap export SERVICE_TOKEN=admin export SERVICE_ENDPOINT=http://192.168.77.50:35357/v2.0/ [root@controller0 ~]# source os_bootstrap \u6dfb\u52a0admin\u53caservice\u7684tenant\u7ec4\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 [root@controller0 ~]# keystone tenant-create --name admin --description \"Admin Tenant\" --enabled true +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Admin Tenant | | enabled | True | | id | c0c4e7b797bb41798202b55872fba074 | | name | admin | +-------------+----------------------------------+ [root@controller0 ~]# keystone tenant-create --name service --description \"Service Tenant\" --enabled true +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Service Tenant | | enabled | True | | id | 9acf83020ae34047b6f1e320c352ae44 | | name | service | +-------------+----------------------------------+ [root@controller0 ~]# keystone tenant-list +----------------------------------+---------+---------+ | id | name | enabled | +----------------------------------+---------+---------+ | c0c4e7b797bb41798202b55872fba074 | admin | True | | 9acf83020ae34047b6f1e320c352ae44 | service | True | +----------------------------------+---------+---------+ \u521b\u5efa\u89d2\u8272\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # \u521b\u5efaadmin\u89d2\u8272 [root@controller0 ~]# keystone role-create --name admin +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | id | 95c4b8fb8d97424eb52a4e8a00a357e7 | | name | admin | +----------+----------------------------------+ # \u521b\u5efaMember\u89d2\u8272 [root@controller0 ~]# keystone role-create --name Member +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | id | aa8c08c0ff63422881c7662472b173e6 | | name | Member | +----------+----------------------------------+ [root@controller0 ~]# keystone role-list +----------------------------------+----------+ | id | name | +----------------------------------+----------+ | aa8c08c0ff63422881c7662472b173e6 | Member | | 9fe2ff9ee4384b1894a90878d3e92bab | _member_ | | 95c4b8fb8d97424eb52a4e8a00a357e7 | admin | +----------------------------------+----------+ \u6dfb\u52a0\u7528\u6237\u5e76\u8d4b\u4e88\u89d2\u8272\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 # \u6dfb\u52a0admin\u7528\u6237\u81f3admin\u7ec4\uff0c\u6b64\u5904\u7684\u5bc6\u7801\u4ec5\u4ec5\u662fadmin\u7528\u6237\u5bc6\u7801\uff0c\u4e0e\u4e4b\u524d\u7684admin_token\u53ef\u4ee5\u4e0d\u540c [root@controller0 ~]# keystone user-create --tenant admin --name admin --pass admin --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | cf11b4425218431991f095c2f58578a0 | | name | admin | | tenantId | c0c4e7b797bb41798202b55872fba074 | | username | admin | +----------+----------------------------------+ # \u8d4b\u4e88admin\u7528\u6237\u4ee5admin\u89d2\u8272 [root@controller0 ~]# keystone user-role-add --user admin --tenant admin --role admin # \u6dfb\u52a0\u5373\u5c06\u7528\u5230\u7684glance\u3001nova\u7528\u6237\u4e0e\u670d\u52a1 [root@controller0 ~]# keystone user-create --tenant service --name glance --pass servicepassword --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | 2dcaa8929688442dbc1df30bee8921eb | | name | glance | | tenantId | 9acf83020ae34047b6f1e320c352ae44 | | username | glance | +----------+----------------------------------+ [root@controller0 ~]# keystone user-role-add --user glance --tenant service --role admin [root@controller0 ~]# keystone user-create --tenant service --name nova --pass servicepassword --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | 566fe34145af4390b0aadb906131a9e8 | | name | nova | | tenantId | 9acf83020ae34047b6f1e320c352ae44 | | username | nova | +----------+----------------------------------+ [root@controller0 ~]# keystone user-role-add --user nova --tenant service --role admin \u6dfb\u52a0\u670d\u52a1\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 [root@controller0 ~]# keystone service-create --name=keystone --type=identity --description=\"Keystone Identity Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Keystone Identity Service | | enabled | True | | id | b3ea5d31edce4c10b3b4c18359de0d09 | | name | keystone | | type | identity | +-------------+----------------------------------+ [root@controller0 ~]# keystone service-create --name=glance --type=image --description=\"Glance Image Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Glance Image Service | | enabled | True | | id | 6afe8a067e2945fca023f85c7760ae53 | | name | glance | | type | image | +-------------+----------------------------------+ [root@controller0 ~]# keystone service-create --name=nova --type=compute --description=\"Nova Compute Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Nova Compute Service | | enabled | True | | id | 80edb3d3914644c4b0570fd8d8dabdaa | | name | nova | | type | compute | +-------------+----------------------------------+ [root@controller0 ~]# keystone service-list +----------------------------------+----------+----------+---------------------------+ | id | name | type | description | +----------------------------------+----------+----------+---------------------------+ | 6afe8a067e2945fca023f85c7760ae53 | glance | image | Glance Image Service | | b3ea5d31edce4c10b3b4c18359de0d09 | keystone | identity | Keystone Identity Service | | 80edb3d3914644c4b0570fd8d8dabdaa | nova | compute | Nova Compute Service | +----------------------------------+----------+----------+---------------------------+ \u6dfb\u52a0endpoint\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 [root@controller0 ~]# export my_host=192.168.77.50 # \u6dfb\u52a0keystone\u7684endpoint [root@controller0 ~]# keystone endpoint-create --region RegionOne \\ --service keystone \\ --publicurl \"http://$my_host:\\$(public_port)s/v2.0\" \\ --internalurl \"http://$my_host:\\$(public_port)s/v2.0\" \\ --adminurl \"http://$my_host:\\$(admin_port)s/v2.0\" +-------------+-------------------------------------------+ | Property | Value | +-------------+-------------------------------------------+ | adminurl | http://192.168.77.50:$(admin_port)s/v2.0 | | id | 09c263fa9b3c4a58bcead0b2f5aba1a1 | | internalurl | http://192.168.77.50:$(public_port)s/v2.0 | | publicurl | http://192.168.77.50:$(public_port)s/v2.0 | | region | RegionOne | | service_id | b3ea5d31edce4c10b3b4c18359de0d09 | +-------------+-------------------------------------------+ # \u6dfb\u52a0glance\u7684endpoint [root@controller0 ~]# keystone endpoint-create --region RegionOne \\ --service glance \\ --publicurl \"http://$my_host:9292/v1\" \\ --internalurl \"http://$my_host:9292/v1\" \\ --adminurl \"http://$my_host:9292/v1\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | adminurl | http://192.168.77.50:9292/v1 | | id | 975ff2836b264e299c669372076666ee | | internalurl | http://192.168.77.50:9292/v1 | | publicurl | http://192.168.77.50:9292/v1 | | region | RegionOne | | service_id | 6afe8a067e2945fca023f85c7760ae53 | +-------------+----------------------------------+ # \u6dfb\u52a0nova\u7684endpoint keystone endpoint-create --region RegionOne \\ --service nova \\ --publicurl \"http://$my_host:\\$(compute_port)s/v2/\\$(tenant_id)s\" \\ --internalurl \"http://$my_host:\\$(compute_port)s/v2/\\$(tenant_id)s\" \\ --adminurl \"http://$my_host:\\$(compute_port)s/v2/\\$(tenant_id)s\" +-------------+--------------------------------------------------------+ | Property | Value | +-------------+--------------------------------------------------------+ | adminurl | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | | id | 194b7ddd24c94a0ebf79cd7275478dfc | | internalurl | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | | publicurl | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | | region | RegionOne | | service_id | 80edb3d3914644c4b0570fd8d8dabdaa | +-------------+--------------------------------------------------------+ [root@controller0 ~]# keystone endpoint-list +----------------------------------+-----------+--------------------------------------------------------+--------------------------------------------------------+--------------------------------------------------------+----------------------------------+ | id | region | publicurl | internalurl | adminurl | service_id | +----------------------------------+-----------+--------------------------------------------------------+--------------------------------------------------------+--------------------------------------------------------+----------------------------------+ | 09c263fa9b3c4a58bcead0b2f5aba1a1 | RegionOne | http://192.168.77.50:$(public_port)s/v2.0 | http://192.168.77.50:$(public_port)s/v2.0 | http://192.168.77.50:$(admin_port)s/v2.0 | b3ea5d31edce4c10b3b4c18359de0d09 | | 194b7ddd24c94a0ebf79cd7275478dfc | RegionOne | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | 80edb3d3914644c4b0570fd8d8dabdaa | | 975ff2836b264e299c669372076666ee | RegionOne | http://192.168.77.50:9292/v1 | http://192.168.77.50:9292/v1 | http://192.168.77.50:9292/v1 | 6afe8a067e2945fca023f85c7760ae53 | +----------------------------------+-----------+--------------------------------------------------------+--------------------------------------------------------+--------------------------------------------------------+----------------------------------+ \u914d\u7f6eGlance \u521d\u59cb\u5316glance 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # \u5b89\u88c5glance [root@controller0 ~]# yum install -y openstack-glance # \u521d\u59cb\u5316\u6570\u636e\u5e93 [root@controller0 ~]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 16 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database glance; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on glance.* to glance@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on glance.* to glance@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye \u914d\u7f6eglance 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 [root@controller0 ~]# vi /etc/glance/glance-registry.conf # line 165: database connection=mysql://glance:password@localhost/glance # line 245: \u6dfb\u52a0keystone\u8ba4\u8bc1\u4fe1\u606f [keystone_authtoken] identity_uri=http://192.168.77.50:35357 admin_tenant_name=service admin_user=glance admin_password=servicepassword # line 259: paste_deploy flavor=keystone [root@controller0 ~]# vi /etc/glance/glance-api.conf # line 240: \u4fee\u6539rabbit\u7528\u6237\u5bc6\u7801 rabbit_userid=guest rabbit_password=password # line 339: database connection=mysql://glance:password@localhost/glance # line 433: \u6dfb\u52a0keystone\u8ba4\u8bc1\u4fe1\u606f [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_tenant_name=service admin_user=glance admin_password=servicepassword revocation_cache_time=10 # line 448: paste_deploy flavor=keystone [root@controller0 ~]# glance-manage db_sync # \u5220\u9664\u65e5\u5fd7\u6587\u4ef6\u5e76\u542f\u52a8\uff0c\u5426\u5219\u53ef\u80fd\u56e0\u4e3alog\u6587\u4ef6\u6743\u9650\u95ee\u9898\u800c\u62a5\u9519 [root@controller0 ~]# rm /var/log/glance/api.log [root@controller0 ~]# for service in api registry; do systemctl start openstack-glance-$service systemctl enable openstack-glance-$service done \u914d\u7f6eNova \u521d\u59cb\u5316nova 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 [root@controller0 ~]# yum install -y openstack-nova [root@controller0 ~]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 18 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database nova; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on nova.* to nova@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on nova.* to nova@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye \u914d\u7f6enova \u57fa\u672c\u914d\u7f6e\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 [root@controller0 ~]# mv /etc/nova/nova.conf /etc/nova/nova.conf.org [root@controller0 ~]# vi /etc/nova/nova.conf # \u65b0\u5efa\u4ee5\u4e0b\u5185\u5bb9 [DEFAULT] # RabbitMQ\u670d\u52a1\u4fe1\u606f rabbit_host=192.168.77.50 rabbit_port=5672 rabbit_userid=guest rabbit_password=password notification_driver=nova.openstack.common.notifier.rpc_notifier rpc_backend=rabbit # \u672c\u8ba1\u7b97\u8282\u70b9IP my_ip=192.168.77.50 # \u662f\u5426\u652f\u6301ipv6 use_ipv6=false state_path=/var/lib/nova enabled_apis=ec2,osapi_compute,metadata osapi_compute_listen=0.0.0.0 osapi_compute_listen_port=8774 rootwrap_config=/etc/nova/rootwrap.conf api_paste_config=api-paste.ini auth_strategy=keystone lock_path=/var/lib/nova/tmp log_dir=/var/log/nova # Memcached\u670d\u52a1\u4fe1\u606f memcached_servers=192.168.77.50:11211 scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler [glance] # Glance\u670d\u52a1\u4fe1\u606f host=192.168.77.50 port=9292 protocol=http [database] # connection info for MariaDB connection=mysql://nova:password@localhost/nova [keystone_authtoken] # Keystone server's hostname or IP auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_user=nova # Nova user's password added in Keystone admin_password=servicepassword admin_tenant_name=service signing_dir=/var/lib/nova/keystone-signing [root@controller0 ~]# chmod 640 /etc/nova/nova.conf [root@controller0 ~]# chgrp nova /etc/nova/nova.conf \u63a5\u4e0b\u6765\u914d\u7f6enetwork\u670d\u52a1\uff0c\u867d\u7136nova-network\u5e76\u4e0d\u662f\u5b98\u65b9\u63a8\u8350\u7684\u914d\u7f6e\uff0c\u4f46\u662f\u5b83\u914d\u7f6e\u8f83\u4e3a\u7b80\u5355\uff0c\u6240\u4ee5\u5728\u6b64\u4ecd\u7136\u5199\u51fa\uff0c\u53ef\u5f85\u540e\u6765 {ref} neutron \u65f6\u518d\u4fee\u6539\u6216\u5219\u76f4\u63a5\u7565\u8fc7\uff08\u6ce8\u610f\u670d\u52a1\u4ee5\u53ca\u914d\u7f6e\u6587\u4ef6\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 [root@controller0 ~]# vi /etc/nova/nova.conf # \u5728DEFAULT\u6bb5\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9 # nova-network network_driver=nova.network.linux_net libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtGenericVIFDriver linuxnet_interface_driver=nova.network.linux_net.LinuxBridgeInterfaceDriver firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver network_api_class=nova.network.api.API security_group_api=nova network_manager=nova.network.manager.FlatDHCPManager network_size=254 allow_same_net_traffic=False multi_host=True send_arp_for_ha=True share_dhcp_address=True force_dhcp_release=True # \u6307\u5b9apublic\u7f51\u7edc\u63a5\u53e3 public_interface=eno16777736 # \u4efb\u610f\u6865\u63a5\u63a5\u53e3 flat_network_bridge=br100 # \u521b\u5efadummy\u63a5\u53e3 flat_interface=dummy0 # \u6dfb\u52a0\u7528\u4e8eflat-DHCP\u7684\u865a\u62df\u63a5\u53e3 [root@controller0 ~]# cat > /etc/sysconfig/network-scripts/ifcfg-dummy0 <<EOF DEVICE=dummy0 BOOTPROTO=none ONBOOT=yes TYPE=Ethernet NM_CONTROLLED=no EOF # \u52a0\u8f7ddummy\u6a21\u5757\uff0c\u7528\u4e8e\u865a\u62df\u673a\u5185\u7f51\u6d41\u91cf\u8def\u7531 [root@controller0 ~]# echo \"alias dummy0 dummy\" > /etc/modprobe.d/dummy.conf [root@controller0 ~]# ifconfig dummy0 up \u542f\u7528\u670d\u52a1\uff0c\u5982\u679c\u6ca1\u7528\u4f7f\u7528nova-network\uff0c\u8bf7\u5ffd\u7565\u6570\u7ec4\u4e2d\u7684network 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 [root@controller0 ~]# nova-manage db sync [root@controller0 ~]# for service in api objectstore conductor scheduler cert consoleauth compute network; do systemctl start openstack-nova-$service systemctl enable openstack-nova-$service done [root@controller0 ~]# nova service-list +----+------------------+-------------+----------+---------+-------+----------------------------+-----------------+ | Id | Binary | Host | Zone | Status | State | Updated_at | Disabled Reason | +----+------------------+-------------+----------+---------+-------+----------------------------+-----------------+ | 1 | nova-conductor | controller0 | internal | enabled | up | 2015-06-19T01:40:07.000000 | - | | 2 | nova-scheduler | controller0 | internal | enabled | up | 2015-06-19T01:40:08.000000 | - | | 3 | nova-cert | controller0 | internal | enabled | up | 2015-06-19T01:40:10.000000 | - | | 4 | nova-consoleauth | controller0 | internal | enabled | up | 2015-06-19T01:40:11.000000 | - | | 5 | nova-compute | controller0 | nova | enabled | up | 2015-06-19T01:40:14.000000 | - | | 6 | nova-network | controller0 | internal | enabled | up | 2015-06-19T01:40:15.000000 | - | +----+------------------+-------------+----------+---------+-------+----------------------------+-----------------+ \u6dfb\u52a0\u955c\u50cf 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # \u4ee5admin\u7528\u6237\u8ba4\u8bc1 [root@controller0 ~]# cat ~/admin_keystone export OS_USERNAME=admin export OS_PASSWORD=admin export OS_TENANT_NAME=admin export OS_AUTH_URL=http://192.168.77.50:35357/v2.0/ export PS1='[\\u@\\h \\W(keystone)]\\$ ' [root@controller0 ~]# source ~/admin_keystone # \u5982\u679c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8bf4\u660e\u8ba4\u8bc1\u6210\u529f\uff0c\u5426\u5219\u8bf7\u68c0\u67e5\u5176\u914d\u7f6e\u6587\u4ef6 [root@controller0 ~(keystone)]# glance image-list +----+------+-------------+------------------+------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +----+------+-------------+------------------+------+--------+ +----+------+-------------+------------------+------+--------+ \u5bfc\u5165\u4e4b\u524d\u5df2\u7ecf\u521b\u5efa\u597d\u7684\u955c\u50cf\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 [root@controller0 ~(keystone)]# glance image-create --name=\"centos7\" --is-public=true --disk-format=qcow2 --container-format=bare < rhel7.0.qcow2 +------------------+--------------------------------------+ | Property | Value | +------------------+--------------------------------------+ | checksum | 0ffb6f101c28af38804f79287f15e7e9 | | container_format | bare | | created_at | 2015-06-18T09:34:50.000000 | | deleted | False | | deleted_at | None | | disk_format | qcow2 | | id | 7f1f376c-0dff-44a3-87e8-d13883f795fc | | is_public | True | | min_disk | 0 | | min_ram | 0 | | name | centos7 | | owner | c0c4e7b797bb41798202b55872fba074 | | protected | False | | size | 21478375424 | | status | active | | updated_at | 2015-06-18T09:41:28.000000 | | virtual_size | None | +------------------+--------------------------------------+ [root@controller0 ~(keystone)]# glance image-list +--------------------------------------+---------+-------------+------------------+-------------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +--------------------------------------+---------+-------------+------------------+-------------+--------+ | 7f1f376c-0dff-44a3-87e8-d13883f795fc | centos7 | qcow2 | bare | 21478375424 | active | +--------------------------------------+---------+-------------+------------------+-------------+--------+ \u914d\u7f6eNova Network\uff08\u53ef\u9009\uff09 \u5982\u679c\u4f7f\u7528nova-network\u8bf7\u53c2\u8003\u6b64\u5904\uff0c\u5426\u5219\u8bf7\u5ffd\u7565\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 # \u4ee5admin\u7528\u6237\u8ba4\u8bc1 [root@controller0 ~]# cat ~/admin_keystone export OS_USERNAME=admin export OS_PASSWORD=admin export OS_TENANT_NAME=admin export OS_AUTH_URL=http://192.168.77.50:35357/v2.0/ export PS1='[\\u@\\h \\W(keystone)]\\$ ' [root@controller0 ~]# source ~/admin_keystone # \u521b\u5efa\u5b9e\u4f8b\u7684\u5185\u7f51 [root@controller0 ~(keystone)]# nova-manage network create --label neutron01 --dns1 10.0.0.1 --fixed_range_v4=10.1.0.0/24 [root@controller0 ~(keystone)]# nova-manage network list id IPv4 IPv6 start address DNS1 DNS2 VlanID project uuid 1 10.1.0.0/24 None 10.1.0.2 10.0.0.1 None None None d5bac5d4-7d1f-49ea-98d7-ea9039e75740 # \u5efa\u7acb\u5b89\u5168\u89c4\u5219 # \u5141\u8bb8ssh\u8bbf\u95ee [root@controller0 ~(keystone)]# nova secgroup-add-rule default tcp 22 22 0.0.0.0/0 +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | tcp | 22 | 22 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ # \u5141\u8bb8ping [root@controller0 ~(keystone)]# nova secgroup-add-rule default icmp -1 -1 0.0.0.0/0 +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | icmp | -1 | -1 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ [root@controller0 ~(keystone)]# nova secgroup-list-rules default +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | tcp | 22 | 22 | 0.0.0.0/0 | | | icmp | -1 | -1 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ # \u5141\u8bb8\u865a\u62df\u673a\u542f\u52a8\u65f6\u4f7f\u7528floating-ip [root@controller0 ~(keystone)]# vi /etc/nova/nova.conf # \u5728DEFAULT\u6bb5\u4e2d\u6dfb\u52a0 auto_assign_floating_ip=true # \u91cd\u542fnova-network [root@controller0 ~(keystone)]# systemctl restart openstack-nova-network # \u6307\u5b9a10.0.0.0/24\u4e2d\u76845\u4e2aIP\u7528\u4e8efloating-ip\u7ed9\u865a\u62df\u673a\u4f7f\u7528 [root@controller0 ~(keystone)]# nova-manage floating create --ip_range=10.0.0.248/29 [root@controller0 ~(keystone)]# nova-manage floating list None 10.0.0.249 None nova eno16777736 None 10.0.0.250 None nova eno16777736 None 10.0.0.251 None nova eno16777736 None 10.0.0.252 None nova eno16777736 None 10.0.0.253 None nova eno16777736 None 10.0.0.254 None nova eno16777736 # \u6d4b\u8bd5\u542f\u52a8 [root@controller0 ~(keystone)]# nova boot --flavor 2 --image centos7iso --security_group default centos7iso +--------------------------------------+---------------------------------------------------+ | Property | Value | +--------------------------------------+---------------------------------------------------+ | OS-DCF:diskConfig | MANUAL | | OS-EXT-AZ:availability_zone | nova | | OS-EXT-SRV-ATTR:host | - | | OS-EXT-SRV-ATTR:hypervisor_hostname | - | | OS-EXT-SRV-ATTR:instance_name | instance-00000003 | | OS-EXT-STS:power_state | 0 | | OS-EXT-STS:task_state | scheduling | | OS-EXT-STS:vm_state | building | | OS-SRV-USG:launched_at | - | | OS-SRV-USG:terminated_at | - | | accessIPv4 | | | accessIPv6 | | | adminPass | 3qF4JPhERims | | config_drive | | | created | 2015-06-19T03:47:15Z | | flavor | m1.small (2) | | hostId | | | id | a0cae25e-4629-48da-a054-99aed02baff9 | | image | centos7iso (d8d93d5f-56cf-4ce6-a2d1-f856fca529e2) | | key_name | - | | metadata | {} | | name | centos7iso | | os-extended-volumes:volumes_attached | [] | | progress | 0 | | security_groups | default | | status | BUILD | | tenant_id | c0c4e7b797bb41798202b55872fba074 | | updated | 2015-06-19T03:47:15Z | | user_id | cf11b4425218431991f095c2f58578a0 | +--------------------------------------+---------------------------------------------------+ [root@controller0 ~(keystone)]# nova list +--------------------------------------+------------+--------+------------+-------------+-------------------------------+ | ID | Name | Status | Task State | Power State | Networks | +--------------------------------------+------------+--------+------------+-------------+-------------------------------+ | a0cae25e-4629-48da-a054-99aed02baff9 | centos7iso | BUILD | spawning | NOSTATE | neutron01=10.1.0.2, 10.0.0.249| +--------------------------------------+------------+--------+------------+-------------+-------------------------------+ # \u6dfb\u52a0\u53e6\u4e00\u4e2afloating-ip [root@controller0 ~(keystone)]# nova add-floating-ip centos7iso 10.0.0.250 [root@controller0 ~(keystone)]# nova list +--------------------------------------+------------+--------+------------+-------------+--------------------------------------------+ | ID | Name | Status | Task State | Power State | Networks | +--------------------------------------+------------+--------+------------+-------------+--------------------------------------------+ | a0cae25e-4629-48da-a054-99aed02baff9 | centos7iso | BUILD | spawning | NOSTATE | neutron01=10.1.0.2, 10.0.0.249, 10.0.0.250 | +--------------------------------------+------------+--------+------------+-------------+--------------------------------------------+ \u914d\u7f6eHorizon \u6dfb\u52a0web\u754c\u9762\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # \u5b89\u88c5\u5fc5\u9700\u5305 [root@controller0 ~(keystone)]# yum --enablerepo=openstack-juno,epel -y install openstack-dashboard openstack-nova-novncproxy # \u914d\u7f6evnc [root@controller0 ~(keystone)]# vi /etc/nova/nova.conf # \u4e8eDEFAULT\u6bb5\u4e2d\u6dfb\u52a0 vnc_enabled=true novncproxy_host=0.0.0.0 novncproxy_port=6080 # replace the IP address to your own IP novncproxy_base_url=http://192.168.77.50:6080/vnc_auto.html vncserver_listen=192.168.77.50 vncserver_proxyclient_address=192.168.77.50 # \u4f7f\u80fddashboard [root@controller0 ~(keystone)]# vi /etc/openstack-dashboard/local_settings # line 15: \u5141\u8bb8\u6240\u6709\u4eba\u8bbf\u95ee ALLOWED_HOSTS = ['*'] # line 134: OPENSTACK_HOST = \"192.168.77.50\" # \u542f\u7528\u670d\u52a1 [root@controller0 ~(keystone)]# systemctl start openstack-nova-novncproxy [root@controller0 ~(keystone)]# systemctl restart openstack-nova-compute [root@controller0 ~(keystone)]# systemctl restart httpd [root@controller0 ~(keystone)]# systemctl enable openstack-nova-novncproxy [root@controller0 ~(keystone)]# systemctl enable httpd \u6dfb\u52a0\u8ba1\u7b97\u8282\u70b9 \u73b0\u5728\u5f00\u59cb\u52a0\u5165\u7b2c\u4e8c\u4e2a\u8ba1\u7b97\u8282\u70b9compute0\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 # \u5b89\u88c5\u5fc5\u9700\u5305 [root@compute0 ~]# yum install -y openstack-nova-compute openstack-nova-api openstack-nova-network # \u914d\u7f6enova [root@compute0 ~]# mv /etc/nova/nova.conf /etc/nova/nova.conf.org [root@compute0 ~]# vi /etc/nova/nova.conf [DEFAULT] rabbit_host=192.168.77.50 rabbit_port=5672 rabbit_userid=guest rabbit_password=password notification_driver=nova.openstack.common.notifier.rpc_notifier rpc_backend=rabbit my_ip=192.168.77.51 use_ipv6=false state_path=/var/lib/nova enabled_apis=ec2,osapi_compute,metadata osapi_compute_listen=0.0.0.0 osapi_compute_listen_port=8774 rootwrap_config=/etc/nova/rootwrap.conf api_paste_config=api-paste.ini auth_strategy=keystone lock_path=/var/lib/nova/tmp log_dir=/var/log/nova memcached_servers=192.168.77.50:11211 scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler [glance] host=192.168.77.50 port=9292 protocol=http [database] connection=mysql://nova:password@192.168.77.50/nova [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_user=nova # Nova user's password added in Keystone admin_password=servicepassword admin_tenant_name=service signing_dir=/var/lib/nova/keystone-signing [root@compute0 ~]# chmod 640 /etc/nova/nova.conf [root@compute0 ~]# chgrp nova /etc/nova/nova.conf \u914d\u7f6enova-network\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 [root@controller0 ~]# vi /etc/nova/nova.conf # \u5728DEFAULT\u6bb5\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9 # nova-network network_driver=nova.network.linux_net libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtGenericVIFDriver linuxnet_interface_driver=nova.network.linux_net.LinuxBridgeInterfaceDriver firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver network_api_class=nova.network.api.API security_group_api=nova network_manager=nova.network.manager.FlatDHCPManager network_size=254 allow_same_net_traffic=False multi_host=True send_arp_for_ha=True share_dhcp_address=True force_dhcp_release=True # \u6307\u5b9apublic\u7f51\u7edc\u63a5\u53e3 public_interface=eno16777736 # \u4efb\u610f\u6865\u63a5\u63a5\u53e3 flat_network_bridge=br100 # \u521b\u5efadummy\u63a5\u53e3 flat_interface=dummy0 # \u5982\u679c\u9700\u8981\u81ea\u52a8floating-ip auto_assign_floating_ip=true \u542f\u52a8\u670d\u52a1\uff0c\u5982\u679c\u4e0d\u9700\u8981nova-network\u8bf7\u540c\u6837\u7701\u7565\u6570\u7ec4\u4e2d\u7684network\uff1a 1 2 3 4 5 6 7 8 9 10 11 [root@compute0 ~]# for service in metadata-api compute network; do systemctl start openstack-nova-$service; systemctl enable openstack-nova-$service; done [root@compute0 ~]# nova-manage service list Binary Host Zone Status State Updated_At nova-conductor controller0 internal enabled :-) 2015-06-19 05:31:48 nova-scheduler controller0 internal enabled :-) 2015-06-19 05:31:48 nova-cert controller0 internal enabled :-) 2015-06-19 05:31:51 nova-consoleauth controller0 internal enabled :-) 2015-06-19 05:31:52 nova-compute controller0 nova enabled :-) 2015-06-19 05:31:45 nova-network controller0 internal enabled :-) 2015-06-19 05:31:44 nova-compute compute0 nova enabled :-) 2015-06-19 05:31:50 nova-network compute0 internal enabled :-) 2015-06-19 05:31:51 (id14)= \u914d\u7f6eNeutron\uff08\u63a8\u8350\uff09 \u5982\u679c\u5df2\u7ecf\u5b89\u88c5\u4e0a\u9762\u7684\u987a\u5e8f\uff08\u6392\u9664nova-networking\uff09\u914d\u7f6e\u4e0b\u6765\uff0c\u73b0\u5728\u5e94\u8be5\u6709\u4e24\u4e2a\u8ba1\u7b97\u8282\u70b9\u4e86\u3002 \u90a3\u4e48\u6211\u4eec\u7684\u914d\u7f6e\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 +------------------+ | +------------------------+ | [ contoller0 ] | | | [ neutron0 ] | | Keystone |192.168.77.50 | 192.168.77.30| DHCP Agent | | Glance |---------------+---------------| L3 Agent | | Nova API |eth0 | eth0| L2 Agent | | Neutron Server | | | Metadata Agent | | Nova Compute | | +------------------------+ +------------------+ | eth0|192.168.77.51 +--------------------+ | [ compute0 ] | | Nova Compute | | L2 Agent | +--------------------+ \u63a7\u5236\u8282\u70b9controller0\u914d\u7f6e \u5b89\u88c5neutron neutron\u4f9d\u8d56\u4e8e\u5404\u79cd\u63d2\u4ef6\uff08openvswitch\u3001linuxbridge\u7b49\uff09\uff0c\u6211\u4eec\u5728\u6b64\u4f7f\u7528openvswitch\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 # \u5b89\u88c5neutron [root@controller0 ~(keystone)]# yum install -y openstack-neutron openstack-neutron-ml2 # \u521d\u59cb\u5316\u6570\u636e\u5e93 [root@controller0 ~(keystone)]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 14 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database neutron_ml2; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on neutron_ml2.* to neutron@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on neutron_ml2.* to neutron@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye # \u521b\u5efaneutron\u670d\u52a1 [root@controller0 ~(keystone)]# keystone user-create --tenant service --name neutron --pass servicepassword --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | 6dafe1f763de44778fa9c4848da7d20f | | name | neutron | | tenantId | 9acf83020ae34047b6f1e320c352ae44 | | username | neutron | +----------+----------------------------------+ [root@controller0 ~(keystone)]# keystone user-role-add --user neutron --tenant service --role admin [root@controller0 ~(keystone)]# keystone service-create --name=neutron --type=network --description=\"Neutron Network Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Neutron Network Service | | enabled | True | | id | 534492ae3d48407bb3b2a90607f43461 | | name | neutron | | type | network | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# export neutron_server=192.168.77.50 [root@controller0 ~(keystone)]# keystone endpoint-create --region RegionOne --service neutron --publicurl \"http://$neutron_server:9696/\" --internalurl \"http://$neutron_server:9696/\" --adminurl \"http://$neutron_server:9696/\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | adminurl | http://192.168.77.50:9696/ | | id | 74fd6b095c16452d97ffcb2b1fd0dad3 | | internalurl | http://192.168.77.50:9696/ | | publicurl | http://192.168.77.50:9696/ | | region | RegionOne | | service_id | 534492ae3d48407bb3b2a90607f43461 | +-------------+----------------------------------+ # \u914d\u7f6eneutron [root@controller0 ~(keystone)]# vi /etc/neutron/neutron.conf # [DEFAULT] # line 62: \u540e\u7aef\u63d2\u4ef6 core_plugin=ml2 # line 69: \u670d\u52a1\u63d2\u4ef6 service_plugins=router # line 84: \u8ba4\u8bc1\u65b9\u5f0f auth_strategy=keystone # line 110: \u53d6\u6d88\u6ce8\u91ca dhcp_agent_notification=True # line 339: \u63a7\u5236\u8282\u70b9\u7684nova\u7aef nova_url=http://192.168.77.50:8774/v2 # line 345: nova\u7528\u6237\u540d nova_admin_username=nova # line 348: service\u7528\u6237\u7684tenant id(\u53ef\u4f7f\u7528keystone tenant-list\u67e5\u770b) nova_admin_tenant_id=9acf83020ae34047b6f1e320c352ae44 # line 357: nova\u7528\u6237\u7684service\u5bc6\u7801 nova_admin_password=servicepassword # line 360: keystone\u8ba4\u8bc1\u7aef nova_admin_auth_url=http://192.168.77.50:35357/v2.0 # [oslo_messaging_rabbit] # line 445: rabbitMQ\u670d\u52a1\u5668 rabbit_host=192.168.77.50 # line 449: rabbitMQ\u7aef\u53e3 rabbit_port=5672 # line 458: rabbitMQ\u7528\u6237\u4fe1\u606f rabbit_userid=guest rabbit_password=password # line 464: rpc\u540e\u7aef\uff0c\u53ef\u4eceAMQ\u6216\u8005RABBITMQ\u4e2d\u9009\u62e9 rpc_backend=rabbit # line 551: \u63a7\u5236\u4fe1\u606f\u4ea4\u6362\u683c\u5f0f control_exchange=neutron # line 688: keystone\u8ba4\u8bc1\u4fe1\u606f\uff0c\u7531\u4e8eauth_uri\u4ee5\u540e\u4f1a\u88abidentity_uri\u4ee3\u66ff\uff0c\u5e76\u4e14auth_host\u7b49\u4fe1\u606f\u4e5f\u4e0d\u5fc5\u8981\u4e86\uff0c\u4f46\u4e3a\u517c\u5bb9\u6027\u8d77\u89c1\uff0c\u6b64\u5904\u6211\u7ed9\u4e88\u4fdd\u7559 [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_tenant_name = service admin_user = neutron admin_password = servicepassword # line 708: \u6570\u636e\u5e93 connection = mysql://neutron:password@192.168.77.50/neutron_ml2 # \u914d\u7f6eml2\u63d2\u4ef6 [root@controller0 ~(keystone)]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 7: \u7f51\u7edc\u652f\u6301 type_drivers = flat,vlan,gre tenant_network_types = vlan,gre mechanism_drivers = openvswitch # line 93: \u542f\u7528\u5b89\u5168\u7ec4 enable_security_group = True firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver # \u914d\u7f6enova\u8282\u70b9\u4ee5\u652f\u6301neutron [root@controller0 ~(keystone)]# vi /etc/nova/nova.conf # add in the [DEFAULT] section # nova-network #network_driver=nova.network.linux_net #libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtGenericVIFDriver #linuxnet_interface_driver=nova.network.linux_net.LinuxBridgeInterfaceDriver #firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver #network_api_class=nova.network.api.API #security_group_api=nova #network_manager=nova.network.manager.FlatDHCPManager #network_size=254 #allow_same_net_traffic=False #multi_host=True #send_arp_for_ha=True #share_dhcp_address=True #force_dhcp_release=True ## specify nic for public #public_interface=eno16777736 ## specify any name you like for bridge #flat_network_bridge=br100 ## specify nic for flat DHCP bridge #flat_interface=dummy0 #auto_assign_floating_ip=true # neutron-network network_api_class=nova.network.neutronv2.api.API security_group_api=neutron # \u5728\u672b\u5c3e\u6dfb\u52a0neutron\u7528\u6237\u8ba4\u8bc1\u4fe1\u606f [neutron] url = http://192.168.77.50:9696 auth_strategy = keystone admin_auth_url = http://192.168.77.50:35357/v2.0 admin_tenant_name = service admin_username = neutron admin_password = servicepassword [root@controller0 ~(keystone)]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini [root@controller0 ~(keystone)]# neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugin.ini upgrade head # \u542f\u7528neutron-server\u670d\u52a1\uff0c\u5982\u679c\u4e4b\u524d\u6709\u914d\u7f6enova-network\uff0c\u5728\u6b64\u9700\u7981\u7528 [root@controller0 ~(keystone)]# systemctl stop openstack-nova-network [root@controller0 ~(keystone)]# systemctl disable openstack-nova-network [root@controller0 ~(keystone)]# systemctl start neutron-server [root@controller0 ~(keystone)]# systemctl enable neutron-server [root@controller0 ~(keystone)]# systemctl restart openstack-nova-api \u7f51\u7edc\u8282\u70b9neutron0\u914d\u7f6e \u5728\u8282\u70b9neutron0\u4e0a\uff0c\u6211\u4eec\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 # \u5b89\u88c5\u5fc5\u9700\u5305 [root@neutron0 ~]# yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch # \u6253\u5f00ip_forward [root@neutron0 ~]# echo 'net.ipv4.ip_forward=1' >> /etc/sysctl.conf [root@neutron0 ~]# echo 'net.ipv4.conf.default.rp_filter=0' >> /etc/sysctl.conf [root@neutron0 ~]# echo 'net.ipv4.conf.all.rp_filter=0' >> /etc/sysctl.conf [root@neutron0 ~]# sysctl -p # \u914d\u7f6eneutron [root@network ~]# vi /etc/neutron/neutron.conf # line 60 core_plugin=ml2 # line 69 service_plugins=router # line 84 auth_strategy=keystone # line 110 dhcp_agent_notification=True # line 444: rabbitMQ\u4fe1\u606f rabbit_host=192.168.77.50 # line 448 rabbit_port=5672 # line 457 rabbit_userid=guest # line 460 rabbit_password=password # line 545 rpc_backend=rabbit # line 550 control_exchange=neutron # line 687: keystone\u8ba4\u8bc1\u4fe1\u606f [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_tenant_name = service admin_user = neutron admin_password = servicepassword # \u914d\u7f6e\u4e09\u5c42\u4ea4\u6362\u4ee3\u7406 [root@neutron0 ~]# vi /etc/neutron/l3_agent.ini # line 19: uncomment interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver # line 25: uncomment use_namespaces = True # line 63: add (it's OK to keep value empty (set it if needed)) external_network_bridge = # \u914d\u7f6edhcp\u4ee3\u7406 [root@neutron0 ~]# vi /etc/neutron/dhcp_agent.ini # line 27: uncomment interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver # line 31: uncomment dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq # line 37: uncomment use_namespaces = True # \u914d\u7f6e\u5143\u6570\u636e\u4ee3\u7406 [root@neutron0 ~]# vi /etc/neutron/metadata_agent.ini # line 6: change (specify endpoint of keystone) auth_url = http://192.168.77.50:35357/v2.0 # line 12: change (auth info ofr keystone) admin_tenant_name = service admin_user = neutron admin_password = servicepassword # line 20: uncomment and specify Nova API server nova_metadata_ip = 10.0.0.30 # line 23: uncomment nova_metadata_port = 8775 # line 43: uncomment and specify any secret key you like metadata_proxy_shared_secret = metadata_secret # \u914d\u7f6eml2 [root@neutron0 ~]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 7: add type_drivers = flat,vlan,gre tenant_network_types = vlan,gre mechanism_drivers = openvswitch # line 92: uncomment and add enable_security_group = True firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver [root@neutron0 ~]# mv /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini.org [root@neutron0 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini [root@neutron0 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini [root@neutron0 ~]# systemctl start openvswitch [root@neutron0 ~]# systemctl enable openvswitch [root@neutron0 ~]# ovs-vsctl add-br br-int [root@neutron0 ~]# for service in dhcp-agent l3-agent metadata-agent openvswitch-agent; do systemctl start neutron-$service systemctl enable neutron-$service done \u8ba1\u7b97\u8282\u70b9compute0\u914d\u7f6e \u5728\u9664controller0\u7684\u53e6\u4e00\u4e2a\u8ba1\u7b97\u8282\u70b9compute0\u4e0a\uff0c\u6211\u4eec\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 # \u5b89\u88c5\u5fc5\u9700\u5305 [root@compute0 ~]# yum install -y openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch # \u8c03\u8282rp_filter [root@compute0 ~]# echo 'net.ipv4.conf.default.rp_filter=0' >> /etc/sysctl.conf [root@compute0 ~]# echo 'net.ipv4.conf.all.rp_filter=0' >> /etc/sysctl.conf [root@compute0 ~]# sysctl -p # \u914d\u7f6eneutron [root@compute0 ~]# vi /etc/neutron/neutron.conf # line 60 core_plugin=ml2 # line 69 service_plugins=router # line 84 auth_strategy=keystone # line 110 dhcp_agent_notification=True # line 444: rabbitMQ\u4fe1\u606f rabbit_host=192.168.77.50 # line 448 rabbit_port=5672 # line 457 rabbit_userid=guest # line 460 rabbit_password=password # line 545 rpc_backend=rabbit # line 550 control_exchange=neutron # line 687: keystone\u8ba4\u8bc1\u4fe1\u606f [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_tenant_name = service admin_user = neutron admin_password = servicepassword [root@compute0 ~]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 7: add type_drivers = flat,vlan,gre tenant_network_types = vlan,gre mechanism_drivers = openvswitch # line 69: uncomment and add enable_security_group = True firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver [root@compute0 ~]# mv /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini.org [root@compute0 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini [root@compute0 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini # \u914d\u7f6enova [root@compute0 ~]# vi /etc/nova/nova.conf # add in the [DEFAULT] section linuxnet_interface_driver=nova.network.linux_net.LinuxOVSInterfaceDriver firewall_driver=nova.virt.firewall.NoopFirewallDriver network_api_class=nova.network.neutronv2.api.API security_group_api=neutron # specify the Neutron endpoint neutron_url=http://192.168.77.50:9696 # specify the auth info for keystone neutron_auth_strategy=keystone neutron_admin_tenant_name=service neutron_admin_username=neutron neutron_admin_password=servicepassword neutron_admin_auth_url=http://192.168.77.50:35357/v2.0 metadata_listen=0.0.0.0 # specify the Control node metadata_host=192.168.77.50 service_neutron_metadata_proxy=True # specify the metadata secret key (it is just the value you set in the Network node) neutron_metadata_proxy_shared_secret=metadata_secret vif_plugging_is_fatal=false vif_plugging_timeout=0 # \u542f\u7528\u670d\u52a1\uff0c\u5982\u679c\u4e4b\u524d\u6709\u914d\u7f6enova-network\uff0c\u5728\u6b64\u9700\u7981\u7528 [root@compute0 ~]# systemctl stop openstack-nova-network [root@compute0 ~]# systemctl disable openstack-nova-network [root@compute0 ~]# systemctl start openvswitch [root@compute0 ~]# systemctl enable openvswitch [root@compute0 ~]# ovs-vsctl add-br br-int [root@compute0 ~]# systemctl restart openstack-nova-compute [root@compute0 ~]# systemctl restart openstack-nova-metadata-api [root@compute0 ~]# systemctl start neutron-openvswitch-agent [root@compute0 ~]# systemctl enable neutron-openvswitch-agent \u4f7f\u7528Neutron 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 +-------------+ +----+----+ | Name Server | | Gateway | +------+------+ +----+----+ |192.168.77.2 |192.168.77.2 | | +--------------+-----------------+------------------------+ | | | | | | | |192.168.77.200-192.168.77.254 eth0|192.168.77.50 | 192.168.77.30| eth0 +--------+-------+ +--------+---------+ | +-----------+----------+ | Virtual Router | | [ controller0 ] | | | [ neutron0 ] | +--------+-------+ | Keystone | | | DHCP Agent | 192.168.100.1 | Glance | | eth2| L3 Agent |eth1 | 192.168.100.0/24 | Nova API | | | L2 Agent | | +-----------------+ | Neutron Server | | | Metadata Agent | | +---| Virtual Machine | +------------------+ | +----------------------+ | | +-----------------+ | | | +-----------------+ | +----------------------+ +-------+---| Virtual Machine | | eth0| [ compute0 ] |eth1 | +-----------------+ +-----| Nova Compute | | +-----------------+ 192.168.77.51| L2 Agent | |---| Virtual Machine | +----------------------+ +-----------------+ \u5176\u4e2d\uff0ccontroller0\u3001compute0\u90fd\u6709\u4e24\u4e2a\u7269\u7406\u7f51\u53e3\uff0cneutron0\u6709\u4e09\u4e2a\u7269\u7406\u7f51\u53e3\u3002 \u4fee\u6539\u63a7\u5236\u8282\u70b9\u914d\u7f6e\uff1a 1 2 3 4 5 6 7 8 9 [root@controller0 ~(keystone)]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 64 [ml2_type_vlan] network_vlan_ranges = physnet1:1000:2999 # \u672b\u5c3e\u6dfb\u52a0 [ovs] tenant_network_type = vlan bridge_mappings = physnet1:br-eth1 [root@controller0 ~(keystone)]# systemctl restart neutron-server \u5728\u7f51\u7edc\u8282\u70b9\u548c\u8ba1\u7b97\u8282\u70b9\u540c\u65f6\u6dfb\u52a0eth1\u4f5c\u5185\u7f51\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 # \u6dfb\u52a0\u4e00\u4e2a\u6865 [root@neutron0 ~]# ovs-vsctl add-br br-eth1 # \u5c06eno33554984\u7f51\u53e3\u9644\u52a0\u5230\u6865\uff0c\u5373\u5bf9\u5e94eth1 [root@neutron0 ~]# ovs-vsctl add-port br-eth1 eno33554984 [root@neutron0 ~]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 64 [ml2_type_vlan] network_vlan_ranges = physnet1:1000:2999 # \u672b\u5c3e\u6dfb\u52a0 [ovs] tenant_network_type = vlan bridge_mappings = physnet1:br-eth1 [root@neutron0 ~]# systemctl restart neutron-openvswitch-agent \u5728\u7f51\u7edc\u8282\u70b9\u6dfb\u52a0eth2\u4f5c\u5916\u7f51\uff1a 1 2 3 4 5 6 7 [root@neutron0 ~]# ovs-vsctl add-br br-ext # eno50332208\u5bf9\u5e94eth2 [root@neutron0 ~]# ovs-vsctl add-port br-ext eno50332208 [root@neutron0 ~]# vi /etc/neutron/l3_agent.ini # line 63 external_network_bridge = br-ext [root@neutron0 ~]# systemctl restart neutron-l3-agent \u5728\u4efb\u610f\u8282\u70b9\u4fee\u6539\uff08neutron\u7684\u914d\u7f6e\u5c5e\u4e8e\u96c6\u7fa4\u5168\u5c40\u914d\u7f6e\uff0c\u6b64\u5904\u5728\u63a7\u5236\u8282\u70b9\u4fee\u6539\uff0c\u5176\u4ed6\u8282\u70b9\u4e5f\u53ef\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 # create a virtual router [root@controller0 ~(keystone)]# neutron router-create router01 Created a new router: +-----------------------+--------------------------------------+ | Field | Value | +-----------------------+--------------------------------------+ | admin_state_up | True | | distributed | False | | external_gateway_info | | | ha | False | | id | 8bf0184c-1cd8-4993-b3e0-7be94aaf2757 | | name | router01 | | routes | | | status | ACTIVE | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +-----------------------+--------------------------------------+ [root@controller0 ~(keystone)]# Router_ID=`neutron router-list | grep router01 | awk '{ print $2 }'` # \u521b\u5efa\u5185\u7f51 [root@controller0 ~(keystone)]# neutron net-create int_net Created a new network: +---------------------------+--------------------------------------+ | Field | Value | +---------------------------+--------------------------------------+ | admin_state_up | True | | id | 532e391d-562d-4499-8dee-48ca31345466 | | mtu | 0 | | name | int_net | | provider:network_type | vlan | | provider:physical_network | physnet1 | | provider:segmentation_id | 1000 | | router:external | False | | shared | False | | status | ACTIVE | | subnets | | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +---------------------------+--------------------------------------+ # \u521b\u5efa\u5185\u7f51\u5b50\u7f51 [root@controller0 ~(keystone)]# neutron subnet-create --gateway 192.168.100.1 --dns-nameserver 192.168.77.2 int_net 192.168.100.0/24 Created a new subnet: +-------------------+------------------------------------------------------+ | Field | Value | +-------------------+------------------------------------------------------+ | allocation_pools | {\"start\": \"192.168.100.2\", \"end\": \"192.168.100.254\"} | | cidr | 192.168.100.0/24 | | dns_nameservers | 192.168.77.2 | | enable_dhcp | True | | gateway_ip | 192.168.100.1 | | host_routes | | | id | c08dcadf-f632-44b7-9a10-8a3a89c86853 | | ip_version | 4 | | ipv6_address_mode | | | ipv6_ra_mode | | | name | | | network_id | 532e391d-562d-4499-8dee-48ca31345466 | | subnetpool_id | | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +-------------------+------------------------------------------------------+ [root@controller0 ~(keystone)]# Int_Subnet_ID=`neutron net-list | grep int_net | awk '{ print $6 }'` # \u5c06\u5185\u7f51\u5b9e\u4f8b\u9644\u52a0\u5230\u8def\u7531 [root@controller0 ~(keystone)]# neutron router-interface-add $Router_ID $Int_Subnet_ID Added interface a2e9bedc-0505-45da-8f87-4a82928a6206 to router 8bf0184c-1cd8-4993-b3e0-7be94aaf2757. # \u521b\u5efa\u5916\u7f51 [root@controller0 ~(keystone)]# neutron net-create ext_net --router:external Created a new network: +---------------------------+--------------------------------------+ | Field | Value | +---------------------------+--------------------------------------+ | admin_state_up | True | | id | e041481d-f8b8-42a7-b87b-3d346167ef21 | | mtu | 0 | | name | ext_net | | provider:network_type | vlan | | provider:physical_network | physnet1 | | provider:segmentation_id | 1001 | | router:external | True | | shared | False | | status | ACTIVE | | subnets | | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +---------------------------+--------------------------------------+ # \u521b\u5efa\u5916\u7f51\u5b50\u7f51 [root@controller0 ~(keystone)]# neutron subnet-create ext_net --allocation-pool start=192.168.77.200,end=192.168.77.254 --gateway 192.168.77.2 --dns-nameserver 192.168.77.2 192.168.77.0/24 --disable-dhcp Created a new subnet: +-------------------+------------------------------------------------------+ | Field | Value | +-------------------+------------------------------------------------------+ | allocation_pools | {\"start\": \"192.168.77.200\", \"end\": \"192.168.77.254\"} | | cidr | 192.168.77.0/24 | | dns_nameservers | 192.168.77.2 | | enable_dhcp | False | | gateway_ip | 192.168.77.2 | | host_routes | | | id | 98f97e64-94d8-4743-b8a1-a715f2c07e08 | | ip_version | 4 | | ipv6_address_mode | | | ipv6_ra_mode | | | name | | | network_id | e041481d-f8b8-42a7-b87b-3d346167ef21 | | subnetpool_id | | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +-------------------+------------------------------------------------------+ # \u5c06\u5916\u7f51\u5b9e\u4f8b\u9644\u52a0\u5230\u8def\u7531 [root@controller0 ~(keystone)]# Ext_Net_ID=`neutron net-list | grep ext_net | awk '{ print $2 }'` [root@controller0 ~(keystone)]# neutron router-gateway-set $Router_ID $Ext_Net_ID Set gateway for router 8bf0184c-1cd8-4993-b3e0-7be94aaf2757 # \u521b\u5efa\u5e76\u542f\u52a8\u865a\u62df\u673a [root@controller0 ~(keystone)]# Int_Net_ID=`neutron net-list | grep int_net | awk '{ print $2 }'` [root@controller0 ~(keystone)]# nova image-list +--------------------------------------+---------+--------+--------+ | ID | Name | Status | Server | +--------------------------------------+---------+--------+--------+ | 4a663fce-97eb-42d3-93d6-415e477bc0a4 | CentOS7 | ACTIVE | | +--------------------------------------+---------+--------+--------+ [root@controller0 ~(keystone)]# nova boot --flavor 2 --image CentOS7 --security_group default --nic net-id=$Int_Net_ID CentOS_70 [root@controller0 ~(keystone)]# nova list +-----------+-----------+--------+------------+-------------+-----------------------+ | ID | Name | Status | Task State | Power State | Networks | +-----------+-----------+--------+------------+-------------+-----------------------+ | 33bb9427- | CentOS_70 | ACTIVE | - | Running | int_net=192.168.100.2 | +-----------+-----------+--------+------------+-------------+-----------------------+ # \u6dfb\u52a0\u6d6e\u52a8IP [root@controller0 ~(keystone)]# neutron floatingip-create ext_net Created a new floatingip: +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | fixed_ip_address | | | floating_ip_address | 10.0.0.201 | | floating_network_id | bd216cab-c07b-4475-90ef-e9ad402bd57b | | id | da8eef0d-5bc8-488e-8fd4-0c6df1f5922a | | port_id | | | router_id | | | status | DOWN | | tenant_id | e8f6ac69de5f46afa189fcefd99c8a1a | +---------------------+--------------------------------------+ [root@controller0 ~(keystone)]# Device_ID=`nova list | grep CentOS_70 | awk '{ print $2 }'` [root@controller0 ~(keystone)]# Port_ID=`neutron port-list -- --device_id $Device_ID | grep 192.168.100.2 | awk '{ print $2 }'` [root@controller0 ~(keystone)]# Floating_ID=`neutron floatingip-list | grep 10.0.0.201 | awk '{ print $2 }'` [root@controller0 ~(keystone)]# neutron floatingip-associate $Floating_ID $Port_ID Associated floating IP da8eef0d-5bc8-488e-8fd4-0c6df1f5922a # confirm settings [root@controller0 ~(keystone)]# neutron floatingip-show $Floating_ID +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | fixed_ip_address | 192.168.100.2 | | floating_ip_address | 10.0.0.201 | | floating_network_id | bd216cab-c07b-4475-90ef-e9ad402bd57b | | id | da8eef0d-5bc8-488e-8fd4-0c6df1f5922a | | port_id | d4f17f91-c4e9-45ec-af2d-223907e891ea | | router_id | a0d08cb3-bf96-4872-ab95-b24a697b080a | | status | ACTIVE | | tenant_id | e8f6ac69de5f46afa189fcefd99c8a1a | +---------------------+--------------------------------------+ # \u6dfb\u52a0\u5b89\u5168\u7ec4 # permit SSH [root@controller0 ~(keystone)]# nova secgroup-add-rule default tcp 22 22 0.0.0.0/0 +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | tcp | 22 | 22 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ # permit ICMP [root@controller0 ~(keystone)]# nova secgroup-add-rule default icmp -1 -1 0.0.0.0/0 +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | icmp | -1 | -1 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ [root@controller0 ~(keystone)]# nova secgroup-list-rules default +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | tcp | 22 | 22 | 0.0.0.0/0 | | | icmp | -1 | -1 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ \u914d\u7f6eCinder \u7ed3\u6784\u56fe\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 +------------------+ 192.168.77.60| [ cinder0 ] | +------------------+ +-----+ Cinder-Volume | | [ controller0 ] | | eth0| | | Keystone |192.168.77.50 | +------------------+ | Glance |---------------+ | Nova API |eth0 | +------------------+ | Cinder API | | eth0| [ compute0 ] | +------------------+ +-----+ Nova Compute | 192.168.77.51| | +------------------+ \u63a7\u5236\u8282\u70b9\u521d\u59cb\u5316Cinder\u4fe1\u606f\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 # \u5b89\u88c5Cinder\u670d\u52a1 [root@controller0 ~(keystone)]# yum install -y openstack-cinder # \u914d\u7f6ekeystone\uff0c\u6dfb\u52a0endpoint [root@controller0 ~(keystone)]# keystone user-create --tenant service --name cinder --pass servicepassword --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | 6c6438aac109473d92ba22ed64ef7f4a | | name | cinder | | tenantId | 9acf83020ae34047b6f1e320c352ae44 | | username | cinder | +----------+----------------------------------+ [root@controller0 ~(keystone)]# keystone user-role-add --user cinder --tenant service --role admin [root@controller0 ~(keystone)]# keystone service-create --name=cinder --type=volume --description=\"Cinder Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Cinder Service | | enabled | True | | id | f9745ca8657f40d188a464c706d1d923 | | name | cinder | | type | volume | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# keystone service-create --name=cinderv2 --type=volumev2 --description=\"Cinder Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Cinder Service | | enabled | True | | id | b11416c99c274ed9872ed5eaffad83b7 | | name | cinderv2 | | type | volumev2 | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# export cinder_api=192.168.77.50 [root@controller0 ~(keystone)]# keystone endpoint-create --region RegionOne \\ --service cinder \\ --publicurl \"http://$cinder_api:8776/v1/\\$(tenant_id)s\" \\ --internalurl \"http://$cinder_api:8776/v1/\\$(tenant_id)s\" \\ --adminurl \"http://$cinder_api:8776/v1/\\$(tenant_id)s\" +-------------+--------------------------------------------+ | Property | Value | +-------------+--------------------------------------------+ | adminurl | http://192.168.77.50:8776/v1/$(tenant_id)s | | id | 073dafcb7ee049cb8bfd3ebbe149dbc0 | | internalurl | http://192.168.77.50:8776/v1/$(tenant_id)s | | publicurl | http://192.168.77.50:8776/v1/$(tenant_id)s | | region | RegionOne | | service_id | f9745ca8657f40d188a464c706d1d923 | +-------------+--------------------------------------------+ [root@controller0 ~(keystone)]# keystone endpoint-create --region RegionOne \\ --service cinderv2 \\ --publicurl \"http://$cinder_api:8776/v2/\\$(tenant_id)s\" \\ --internalurl \"http://$cinder_api:8776/v2/\\$(tenant_id)s\" \\ --adminurl \"http://$cinder_api:8776/v2/\\$(tenant_id)s\" +-------------+--------------------------------------------+ | Property | Value | +-------------+--------------------------------------------+ | adminurl | http://192.168.77.50:8776/v2/$(tenant_id)s | | id | 3f00de1ec9474183971ba3c1c0d35c7d | | internalurl | http://192.168.77.50:8776/v2/$(tenant_id)s | | publicurl | http://192.168.77.50:8776/v2/$(tenant_id)s | | region | RegionOne | | service_id | b11416c99c274ed9872ed5eaffad83b7 | +-------------+--------------------------------------------+ # \u6dfb\u52a0\u6570\u636e\u5e93 [root@controller0 ~(keystone)]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 16 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database cinder; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on cinder.* to cinder@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on cinder.* to cinder@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye # \u914d\u7f6ecinder\u53c2\u6570 [root@controller0 ~(keystone)]# mv /etc/cinder/cinder.conf /etc/cinder/cinder.conf.org [root@controller0 ~(keystone)]# vi /etc/cinder/cinder.conf [DEFAULT] state_path=/var/lib/cinder api_paste_config=api-paste.ini enable_v1_api=true rootwrap_config=/etc/cinder/rootwrap.conf auth_strategy=keystone # specify RabbitMQ server rabbit_host=192.168.77.50 rabbit_port=5672 # specify RabbitMQ user for auth rabbit_userid=guest # specify RabbitMQ user's password above rabbit_password=password rpc_backend=rabbit scheduler_driver=cinder.scheduler.filter_scheduler.FilterScheduler volume_manager=cinder.volume.manager.VolumeManager volume_api_class=cinder.volume.api.API volumes_dir=$state_path/volumes # auth info for MariaDB [database] connection=mysql://cinder:password@192.168.77.50/cinder # auth info for Keystone [keystone_authtoken] auth_host=192.168.77.50 auth_port=35357 auth_protocol=http admin_user=cinder admin_password=servicepassword admin_tenant_name=service # \u542f\u7528\u670d\u52a1 [root@controller0 ~(keystone)]# chmod 640 /etc/cinder/cinder.conf [root@controller0 ~(keystone)]# chgrp cinder /etc/cinder/cinder.conf [root@controller0 ~(keystone)]# cinder-manage db sync [root@controller0 ~(keystone)]# for service in api scheduler; do systemctl start openstack-cinder-$service systemctl enable openstack-cinder-$service done [root@controller0 ~(keystone)]# cinder-manage service list Binary Host Zone Status State Updated At cinder-scheduler controller0 nova enabled :-) None \u914d\u7f6eCinder\u8282\u70b9\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 # \u5b89\u88c5Cinder\u670d\u52a1 [root@cinder0 ~(keystone)]# yum install -y openstack-cinder [root@cinder0 ~]# mv /etc/cinder/cinder.conf /etc/cinder/cinder.conf.org [root@cinder0 ~]# vi /etc/cinder/cinder.conf [DEFAULT] state_path=/var/lib/cinder api_paste_config=api-paste.ini enable_v1_api=true osapi_volume_listen=0.0.0.0 osapi_volume_listen_port=8776 rootwrap_config=/etc/cinder/rootwrap.conf auth_strategy=keystone # specify Glance server glance_host=192.168.77.50 glance_port=9292 # specify RabbitMQ server rabbit_host=192.168.77.50 rabbit_port=5672 # RabbitMQ user for auth rabbit_userid=guest # RabbitMQ user's password for auth rabbit_password=password rpc_backend=rabbit # specify iSCSI target (it's just the own IP) iscsi_ip_address=192.168.77.60 iscsi_port=3260 iscsi_helper=tgtadm scheduler_driver=cinder.scheduler.filter_scheduler.FilterScheduler volume_manager=cinder.volume.manager.VolumeManager volume_api_class=cinder.volume.api.API volumes_dir=$state_path/volumes # auth info for MariaDB [database] connection=mysql://cinder:password@192.168.77.50/cinder # auth info for Keystone [keystone_authtoken] auth_host=192.168.77.50 auth_port=35357 auth_protocol=http admin_user=cinder admin_password=servicepassword admin_tenant_name=service # \u542f\u7528\u670d\u52a1 [root@cinder0 ~]# chmod 640 /etc/cinder/cinder.conf [root@cinder0 ~]# chgrp cinder /etc/cinder/cinder.conf [root@cinder0 ~]# systemctl start openstack-cinder-volume [root@cinder0 ~]# systemctl enable openstack-cinder-volume ln -s '/usr/lib/systemd/system/openstack-cinder-volume.service' '/etc/systemd/system/multi-user.target.wants/openstack-cinder-volume.service' [root@cinder0 ~]# cinder-manage service list Binary Host Zone Status State Updated At cinder-scheduler controller0 nova enabled :-) 2015-07-21 03:29:39 cinder-volume cinder0 nova enabled :-) None \u914d\u7f6eLVM\u540e\u7aef \u5b58\u50a8\u8282\u70b9\u914d\u7f6e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 # \u521b\u5efaPV [root@cinder0 ~]# pvcreate /dev/sdb Physical volume \"/dev/sdb\" successfully created [root@cinder0 ~]# pvcreate /dev/sdb1 Device /dev/sdb1 not found (or ignored by filtering). [root@cinder0 ~]# pvdisplay \"/dev/sdb\" is a new physical volume of \"20.00 GiB\" --- NEW Physical volume --- PV Name /dev/sdb VG Name PV Size 20.00 GiB Allocatable NO PE Size 0 Total PE 0 Free PE 0 Allocated PE 0 PV UUID lDpf6L-zPJT-6Uth-lcPA-KtAS-TYNS-B5LH4c [root@cinder0 ~]# vgcreate -s 32M vg_volume01 /dev/sdb Volume group \"vg_volume01\" successfully created [root@cinder0 ~]# vgdisplay --- Volume group --- VG Name vg_volume01 System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 1 VG Access read/write VG Status resizable MAX LV 0 Cur LV 0 Open LV 0 Max PV 0 Cur PV 1 Act PV 1 VG Size 19.97 GiB PE Size 32.00 MiB Total PE 639 Alloc PE / Size 0 / 0 Free PE / Size 639 / 19.97 GiB VG UUID IYI8rR-d0u4-p58f-h1Bp-afAW-EPRK-21qSdv # \u4fee\u6539cinder\u914d\u7f6e [root@cinder0 ~]# vi /etc/cinder/cinder.conf # \u5728DEFAULT\u6bb5\u4e2d\u6dfb\u52a0 enabled_backends = lvm # \u5728\u672b\u5c3e\u6dfb\u52a0 [lvm] iscsi_helper = lioadm # volume group name just created volume_group = vg_volume01 # IP address of Storage Node iscsi_ip_address = 192.168.77.60 volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver volumes_dir = $state_path/volumes iscsi_protocol = iscsi # \u91cd\u542f\u670d\u52a1 [root@cinder0 ~]# systemctl restart openstack-cinder-volume \u8ba1\u7b97\u8282\u70b9\u914d\u7f6e\uff0c\u5728\u6240\u6709\u8ba1\u7b97\u8282\u70b9\u4e2d\u90fd\u8981\u914d\u7f6e 1 2 3 4 5 [root@controller0 ~]# vi /etc/nova/nova.conf # add follows into [DEFAULT] section osapi_volume_listen=0.0.0.0 volume_api_class=nova.volume.cinder.API [root@controller0 ~]# systemctl restart openstack-nova-compute \u521b\u5efa\u6d4b\u8bd5\u78c1\u76d8 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # \u5728\u4efb\u610f\u8ba1\u7b97\u8282\u70b9\u4e2d\u90fd\u53ef\u6267\u884ccinder\u547d\u4ee4\u521b\u5efa\u78c1\u76d8 [root@controller0 ~]# echo \"export OS_VOLUME_API_VERSION=2\" >> ~/keystonerc [root@controller0 ~]# source admin_keystone [root@controller0 ~(keystone)]# cinder create --display_name disk01 10 +---------------------------------------+--------------------------------------+ | Property | Value | +---------------------------------------+--------------------------------------+ | attachments | [] | | availability_zone | nova | | bootable | false | | consistencygroup_id | None | | created_at | 2015-07-27T08:24:32.000000 | | description | None | | encrypted | False | | id | 7a974afe-a71a-479f-b63d-b208daae1707 | | metadata | {} | | multiattach | False | | name | disk01 | | os-vol-host-attr:host | None | | os-vol-mig-status-attr:migstat | None | | os-vol-mig-status-attr:name_id | None | | os-vol-tenant-attr:tenant_id | c0c4e7b797bb41798202b55872fba074 | | os-volume-replication:driver_data | None | | os-volume-replication:extended_status | None | | replication_status | disabled | | size | 10 | | snapshot_id | None | | source_volid | None | | status | creating | | user_id | cf11b4425218431991f095c2f58578a0 | | volume_type | None | +---------------------------------------+--------------------------------------+ [root@controller0 ~(keystone)]# cinder list +--------------------------------------+-----------+--------+------+-------------+----------+-------------+ | ID | Status | Name | Size | Volume Type | Bootable | Attached to | +--------------------------------------+-----------+--------+------+-------------+----------+-------------+ | 7a974afe-a71a-479f-b63d-b208daae1707 | available | disk01 | 10 | None | false | | +--------------------------------------+-----------+--------+------+-------------+----------+-------------+ \u5b58\u50a8\u8282\u70b9\u4e0a\u67e5\u770b 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 [root@cinder0 ~]# lvdisplay --- Logical volume --- LV Path /dev/vg_volume01/volume-7a974afe-a71a-479f-b63d-b208daae1707 LV Name volume-7a974afe-a71a-479f-b63d-b208daae1707 VG Name vg_volume01 LV UUID Pp91xd-Kj0M-J5eI-tUXY-0iMH-MdJ6-PryIq7 LV Write Access read/write LV Creation host, time cinder0, 2015-07-27 16:24:33 +0800 LV Status available # open 0 LV Size 10.00 GiB Current LE 320 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 8192 Block device 253:0 \u8ba1\u7b97\u8282\u70b9\u4e0a\u9644\u52a0\u78c1\u76d8\u5230\u865a\u62df\u673a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 [root@controller0 ~(keystone)]# nova list +----------------+----------+---------+------------+-------------+-----------------------+ | ID | Name | Status | Task State | Power State | Networks | +----------------+----------+---------+------------+-------------+-----------------------+ | 16971b4c-c901- | CentOS_7 | SHUTOFF | - | Shutdown | int_net=192.168.100.4 | +----------------+----------+---------+------------+-------------+-----------------------+ [root@controller0 ~(keystone)]# nova volume-attach CentOS_7 7a974afe-a71a-479f-b63d-b208daae1707 auto +----------+--------------------------------------+ | Property | Value | +----------+--------------------------------------+ | device | /dev/vdb | | id | 7a974afe-a71a-479f-b63d-b208daae1707 | | serverId | 16971b4c-c901-4e95-8334-b2ff36b99633 | | volumeId | 7a974afe-a71a-479f-b63d-b208daae1707 | +----------+--------------------------------------+ # the status of attached disk turns \"in-use\" like follows [root@controller0 ~(keystone)]# cinder list \u914d\u7f6eNFS\u3001Glusterfs\u6df7\u5408\u540e\u7aef \u6b64\u5904\u4f7f\u7528NFS\u3001Glusterfs\u6df7\u5408\u540e\u7aef\uff0c\u4e5f\u53ef\u6839\u636e\u5b9e\u9645\u9700\u6c42\u6dfb\u52a0LVM\u540e\u7aef\u6216\u8005\u4f7f\u7528\u4e09\u8005\u4e4b\u4e00\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 +------------------+ +------------------+ 192.168.77.60| [ cinder0 ] | 192.168.77.100| | +------------------+ +-----+ Cinder-Volume | +----------+ GlusterFS #1 | | [ controller0 ] | | eth0| | | eth0| gfs01.lofyer.org | | Keystone |192.168.77.50 | +------------------+ | +------------------+ | Glance |----------------+------------------------------+ | Nova API |eth0 | +------------------+ | +------------------+ | Cinder API | | eth0| [ compute0 ] | | eth0| | +------------------+ +-----+ Nova Compute | +----------------+ GlusterFS #2 | 192.168.77.51| | | 192.168.77.101| gfs02.lofyer.org | +------------------+ | +------------------+ | | +------------------+ | eth0| | +----------+ NFS | 192.168.77.110| nfs.lofyer.org | +------------------+ \u5b58\u50a8\u8282\u70b9\u914d\u7f6e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # \u5b89\u88c5\u8f6f\u4ef6\u5305 [root@cinder0 ~]# yum -y install nfs-utils glusterfs glusterfs # \u4fee\u6539cinder\u914d\u7f6e [root@cinder0 ~]# vi /etc/cinder/cinder.conf # \u4e8eDEFAULT\u6bb5\u4e2d\u6dfb\u52a0 enabled_backends=nfs,glusterfs # \u4e8e\u672b\u5c3e\u6dfb\u52a0 [nfs] volume_driver = cinder.volume.drivers.nfs.NfsDriver volume_backend_name = NFS nfs_shares_config = /etc/cinder/nfs_shares nfs_mount_point_base = $state_path/nfs [glusterfs] volume_driver = cinder.volume.drivers.glusterfs.GlusterfsDriver volume_backend_name = GlusterFS glusterfs_shares_config = /etc/cinder/glusterfs_shares glusterfs_mount_point_base = $state_path/glusterfs # \u4fee\u6539\u5b58\u50a8\u4fe1\u606f [root@cinder0 ~]# vi /etc/cinder/nfs_shares # \u6307\u5b9aNFS\u5b58\u50a8\u8def\u5f84 nfs.lofyer.org:/storage [root@cinder0 ~]# vi /etc/cinder/glusterfs_shares # \u6307\u5b9aGlusterfs\u5b58\u50a8\u8def\u5f84 gfs01.lofyer.org:/vol_replica [root@cinder0 ~]# chmod 640 /etc/cinder/nfs_shares [root@cinder0 ~]# chgrp cinder /etc/cinder/nfs_shares [root@cinder0 ~]# chmod 640 /etc/cinder/glusterfs_shares [root@cinder0 ~]# chgrp cinder /etc/cinder/glusterfs_shares [root@cinder0 ~]# systemctl restart openstack-cinder-volume \u8ba1\u7b97\u8282\u70b9\u914d\u7f6e\uff0c\u6240\u6709\u8ba1\u7b97\u8282\u70b9\u90fd\u8981\u914d\u7f6e 1 2 3 4 5 6 7 8 # \u5b89\u88c5\u8f6f\u4ef6\u5305 [root@controller0 ~]# yum --enablerepo=epel -y install nfs-utils glusterfs glusterfs-fuse [root@controller0 ~]# vi /etc/nova/nova.conf # \u4e8eDEFAULT\u6bb5\u4e2d\u6dfb\u52a0 osapi_volume_listen=0.0.0.0 volume_api_class=nova.volume.cinder.API # \u91cd\u542f\u8ba1\u7b97\u670d\u52a1 [root@controller0 ~]# systemctl restart openstack-nova-compute \u6dfb\u52a0\u5377\u79cd\u7c7b 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # \u5728\u4efb\u610f\u8ba1\u7b97\u8282\u70b9\u4e2d\u90fd\u53ef\u6267\u884ccinder\u547d\u4ee4\u521b\u5efa\u78c1\u76d8 [root@controller0 ~]# echo \"export OS_VOLUME_API_VERSION=2\" >> ~/keystonerc [root@controller0 ~]# source admin_keystone [root@controller0 ~(keystone)]# cinder type-create nfs +--------------------------------------+------+ | ID | Name | +--------------------------------------+------+ | 7ac3a255-cf70-498d-97d8-2a7fcdd84d2c | nfs | +--------------------------------------+------+ [root@controller0 ~(keystone)]# cinder type-create glusterfs +--------------------------------------+-----------+ | ID | Name | +--------------------------------------+-----------+ | e2608bee-cc52-48e8-ba72-b94124f36a57 | glusterfs | +--------------------------------------+-----------+ [root@controller0 ~(keystone)]# cinder type-list +--------------------------------------+-----------+ | ID | Name | +--------------------------------------+-----------+ | 7ac3a255-cf70-498d-97d8-2a7fcdd84d2c | nfs | | e2608bee-cc52-48e8-ba72-b94124f36a57 | glusterfs | +--------------------------------------+-----------+ \u6dfb\u52a0\u5b58\u50a8\u79cd\u7c7b\u522b\u540d 1 2 3 4 5 6 7 8 9 [root@controller0 ~(keystone)]# cinder type-key nfs set volume_backend_name=NFS [root@controller0 ~(keystone)]# cinder type-key glusterfs set volume_backend_name=GlusterFS [root@controller0 ~(keystone)]# cinder extra-specs-list +--------------------------------------+-----------+----------------------------------------+ | ID | Name | extra_specs | +--------------------------------------+-----------+----------------------------------------+ | 7ac3a255-cf70-498d-97d8-2a7fcdd84d2c | nfs | {u'volume_backend_name': u'NFS'} | | e2608bee-cc52-48e8-ba72-b94124f36a57 | glusterfs | {u'volume_backend_name': u'GlusterFS'} | +--------------------------------------+-----------+----------------------------------------+ \u6dfb\u52a0\u78c1\u76d8 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 [root@controller0 ~(keystone)]# cinder create --display_name disk_nfs --volume-type nfs 10 +---------------------------------------+--------------------------------------+ | Property | Value | +---------------------------------------+--------------------------------------+ | attachments | [] | | availability_zone | nova | | bootable | false | | consistencygroup_id | None | | created_at | 2015-06-20T18:23:23.000000 | | description | None | | encrypted | False | | id | 1e92b9ca-20d7-4f63-881e-dea3f8b6b523 | | metadata | {} | | multiattach | False | | name | disk_nfs | | os-vol-host-attr:host | None | | os-vol-mig-status-attr:migstat | None | | os-vol-mig-status-attr:name_id | None | | os-vol-tenant-attr:tenant_id | 98ea1b896d3a48438922c0dfa9f6bc52 | | os-volume-replication:driver_data | None | | os-volume-replication:extended_status | None | | replication_status | disabled | | size | 10 | | snapshot_id | None | | source_volid | None | | status | creating | | user_id | 704a7f5cf84a479796e10f47c30bb629 | | volume_type | nfs | +---------------------------------------+--------------------------------------+ [root@controller0 ~(keystone)]# cinder create --display_name disk_glusterfs --volume-type glusterfs 10 +---------------------------------------+--------------------------------------+ | Property | Value | +---------------------------------------+--------------------------------------+ | attachments | [] | | availability_zone | nova | | bootable | false | | consistencygroup_id | None | | created_at | 2015-06-20T18:23:49.000000 | | description | None | | encrypted | False | | id | d8dbaed2-e857-4162-baab-0178fbef4593 | | metadata | {} | | multiattach | False | | name | disk_glusterfs | | os-vol-host-attr:host | None | | os-vol-mig-status-attr:migstat | None | | os-vol-mig-status-attr:name_id | None | | os-vol-tenant-attr:tenant_id | 98ea1b896d3a48438922c0dfa9f6bc52 | | os-volume-replication:driver_data | None | | os-volume-replication:extended_status | None | | replication_status | disabled | | size | 10 | | snapshot_id | None | | source_volid | None | | status | creating | | user_id | 704a7f5cf84a479796e10f47c30bb629 | | volume_type | glusterfs | +---------------------------------------+--------------------------------------+ [root@controller0 ~(keystone)]# cinder list +--------------------------+-----------+----------------+------+-------------+----------+-------------+ | ID | Status | Name | Size | Volume Type | Bootable | Attached to | +--------------------------+-----------+----------------+------+-------------+----------+-------------+ | 1e92b9ca-20d7-4f63-881e- | available | disk_nfs | 10 | nfs | false | | | d8dbaed2-e857-4162-baab- | available | disk_glusterfs | 10 | glusterfs | false | | +--------------------------+-----------+----------------+------+-------------+----------+-------------+ \u9644\u52a0\u78c1\u76d8\u5230\u865a\u62df\u673a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 [root@controller0 ~(keystone)]# nova list +----------------+----------+---------+------------+-------------+-----------------------------------+ | ID | Name | Status | Task State | Power State | Networks | +----------------+----------+---------+------------+-------------+-----------------------------------+ | 2c7a1025-30d6- | CentOS_7 | SHUTOFF | - | Shutdown | int_net=192.168.100.3, 10.0.0.201 | +----------------+----------+---------+------------+-------------+-----------------------------------+ [root@controller0 ~(keystone)]# nova volume-attach CentOS_7 1e92b9ca-20d7-4f63-881e-dea3f8b6b523 auto +----------+--------------------------------------+ | Property | Value | +----------+--------------------------------------+ | device | /dev/vdc | | id | 1e92b9ca-20d7-4f63-881e-dea3f8b6b523 | | serverId | 2c7a1025-30d6-446a-a4ff-309347b64eca | | volumeId | 1e92b9ca-20d7-4f63-881e-dea3f8b6b523 | +----------+--------------------------------------+ [root@controller0 ~(keystone)]# nova volume-attach CentOS_7 d8dbaed2-e857-4162-baab-0178fbef4593 auto +----------+--------------------------------------+ | Property | Value | +----------+--------------------------------------+ | device | /dev/vdd | | id | d8dbaed2-e857-4162-baab-0178fbef4593 | | serverId | 2c7a1025-30d6-446a-a4ff-309347b64eca | | volumeId | d8dbaed2-e857-4162-baab-0178fbef4593 | +----------+--------------------------------------+ # the status of attached disk turns \"in-use\" like follows [root@controller0 ~(keystone)]# cinder list +--------------------------+--------+----------------+------+-------------+----------+-----------------------------+ | ID | Status | Name | Size | Volume Type | Bootable | Attached to | +--------------------------+--------+----------------+------+-------------+----------+-----------------------------+ | 1e92b9ca-20d7-4f63-881e- | in-use | disk_nfs | 10 | nfs | false | 2c7a1025-30d6-446a-a4ff-309 | | d8dbaed2-e857-4162-baab- | in-use | disk_glusterfs | 10 | glusterfs | false | 2c7a1025-30d6-446a-a4ff-309 | +--------------------------+--------+----------------+------+-------------+----------+-----------------------------+ \u914d\u7f6eSwift \u5728\u6b64\u6211\u4eec\u6709\u4e09\u4e2a\u5b58\u50a8\u8282\u70b9\u4f5c\u4e3aswift backend\uff0cswift0\u4f5c\u4e3aswift\u8bbf\u95ee\u5165\u53e3\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 | +------------------+ | +-----------------+ | [ controller0 ] |192.168.77.50 | 192.168.77.70| [ swift0 ] | | Keystone |---------------+---------------| Proxy | +------------------+ | +-----------------+ | +---------------------------+--------------------------+ | | | |192.168.77.71 |192.168.77.72 |192.168.77.73 +-------+----------+ +--------+---------+ +--------+---------+ | [ swift-stor0 ] | | [ swift-stor1 ] | | [ swift-stor2 ] | | |-------| |-------| | +------------------+ +------------------+ +------------------+ \u914d\u7f6e\u63a7\u5236\u8282\u70b9 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 # \u6dfb\u52a0swift\u7528\u6237 [root@controller0 ~(keystone)]# openstack user create --project service --password servicepassword swift +------------+----------------------------------+ | Field | Value | +------------+----------------------------------+ | email | None | | enabled | True | | id | 9e19bc053b0f44bdbabf751b279c9afd | | name | swift | | project_id | 9acf83020ae34047b6f1e320c352ae44 | | username | swift | +------------+----------------------------------+ # \u8d4b\u4e88swift\u7528\u6237admin\u89d2\u8272 [root@controller0 ~(keystone)]# openstack role add --project service --user swift admin +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 95c4b8fb8d97424eb52a4e8a00a357e7 | | name | admin | +-------+----------------------------------+ # \u521b\u5efaswift\u670d\u52a1 [root@controller0 ~(keystone)]# openstack service create --name swift --description \"OpenStack Object Storage\" object-store +-------------+----------------------------------+ | Field | Value | +-------------+----------------------------------+ | description | OpenStack Object Storage | | enabled | True | | id | c8d07b32376a4e2780d8ec9b2b836e41 | | name | swift | | type | object-store | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# export swift_proxy=192.168.77.70 # \u6dfb\u52a0endpoint root@controller0 ~(keystone)]# openstack endpoint create \\ --publicurl http://$swift_proxy:8080/v1/AUTH_%\\(tenant_id\\)s \\ --internalurl http://$swift_proxy:8080/v1/AUTH_%\\(tenant_id\\)s \\ --adminurl http://$swift_proxy:8080 \\ --region RegionOne \\ object-store +--------------+-------------------------------------------------+ | Field | Value | +--------------+-------------------------------------------------+ | adminurl | http://192.168.77.70:8080 | | id | d7e1f6a5f7064f3690181f7bd8922ac4 | | internalurl | http://192.168.77.70:8080/v1/AUTH_%(tenant_id)s | | publicurl | http://192.168.77.70:8080/v1/AUTH_%(tenant_id)s | | region | RegionOne | | service_id | c8d07b32376a4e2780d8ec9b2b836e41 | | service_name | swift | | service_type | object-store | +--------------+-------------------------------------------------+ \u914d\u7f6eswift\u4ee3\u7406\u8282\u70b9 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 [root@swift0 ~]# vi /etc/swift/proxy-server.conf # \u7b2c53\u884c [filter:authtoken] paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory # \u6ce8\u91ca\u5982\u4e0b\u90e8\u5206 #admin_tenant_name = %SERVICE_TENANT_NAME% #admin_user = %SERVICE_USER% #admin_password = %SERVICE_PASSWORD% # #identity_uri = http://localhost:35357/ #auth_uri = http://localhost:5000/ # signing_dir = /tmp/keystone-signing-swift # \u6dfb\u52a0\u8ba4\u8bc1 auth_uri = http://192.168.77.50:5000 auth_url = http://192.168.77.50:35357 auth_plugin = password project_domain_id = default user_domain_id = default project_name = service username = swift password = servicepassword delay_auth_decision = true [root@swift0 ~]# vi /etc/swift/swift.conf # \u66f4\u6539\u4e3a\u4efb\u610f [swift-hash] swift_hash_path_suffix = swift_shared_path # \u521b\u5efaswift\u54c8\u5e0c\u73af # swift-ring-builder builder-file create <part_power> <replicas> <min_part_hours> # Creates <builder_file> with 2^<part_power> partitions and <replicas>. # <min_part_hours> is number of hours to restrict moving a partition more # than once [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder create 12 3 1 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder create 12 3 1 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder create 12 3 1 [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder add r0z0-192.168.77.71:6002/device0 100 Device d0r0z0-192.168.77.71:6002R192.168.77.71:6002/device0_\"\" with 100.0 weight got id 0 [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder add r0z0-192.168.77.72:6002/device0 100 Device d1r0z0-192.168.77.72:6002R192.168.77.72:6002/device0_\"\" with 100.0 weight got id 1 [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder add r0z0-192.168.77.73:6002/device0 100 Device d2r0z0-192.168.77.73:6002R192.168.77.73:6002/device0_\"\" with 100.0 weight got id 2 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder add r0z0-192.168.77.71:6001/device0 100 Device d0r0z0-192.168.77.71:6001R192.168.77.71:6001/device0_\"\" with 100.0 weight got id 0 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder add r0z0-192.168.77.72:6001/device0 100 Device d1r0z0-192.168.77.72:6001R192.168.77.72:6001/device0_\"\" with 100.0 weight got id 1 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder add r0z0-192.168.77.73:6001/device0 100 Device d2r0z0-192.168.77.73:6001R192.168.77.73:6001/device0_\"\" with 100.0 weight got id 2 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder add r0z0-192.168.77.71:6000/device0 100 Device d0r0z0-192.168.77.71:6000R192.168.77.71:6000/device0_\"\" with 100.0 weight got id 0 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder add r0z0-192.168.77.72:6000/device0 100 Device d1r0z0-192.168.77.72:6000R192.168.77.72:6000/device0_\"\" with 100.0 weight got id 1 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder add r0z0-192.168.77.73:6000/device0 100 Device d2r0z0-192.168.77.73:6000R192.168.77.73:6000/device0_\"\" with 100.0 weight got id 2 [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder rebalance Reassigned 4096 (100.00%) partitions. Balance is now 0.00. Dispersion is now 0.00 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder rebalance Reassigned 4096 (100.00%) partitions. Balance is now 0.00. Dispersion is now 0.00 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder rebalance Reassigned 4096 (100.00%) partitions. Balance is now 0.00. Dispersion is now 0.00 [root@swift0 ~]# chown swift. /etc/swift/*.gz [root@swift0 ~]# systemctl start memcached openstack-swift-proxy [root@swift0 ~]# systemctl enable memcached openstack-swift-proxy ln -s '/usr/lib/systemd/system/memcached.service' '/etc/systemd/system/multi-user.target.wants/memcached.service' ln -s '/usr/lib/systemd/system/openstack-swift-proxy.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-proxy.service' \u914d\u7f6e\u5b58\u50a8\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u8981\u914d\u7f6e\uff0c\u6ce8\u610fselinux\u7b56\u7565\uff0c\u5426\u5219\u4f1a\u64cd\u4f5c\u5931\u8d25\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 # \u7981\u7528selinux [root@swift-stor0 ~]# setenforce permissive [root@swift-stor0 ~]# vi /etc/selinux/config SELINUX=enforcing # \u5b89\u88c5\u6240\u9700\u5305 [root@swift-stor0 ~]# yum install -y openstack-swift-account openstack-swift-container openstack-swift-object xfsprogs rsync openssh-clients # \u683c\u5f0f\u5316\u5b58\u50a8\u78c1\u76d8\u4e3axfs [root@swift-stor0 ~]# mkfs.xfs -i size=1024 -s size=4096 /dev/sdb -f meta-data=/dev/sdb isize=1024 agcount=4, agsize=1310720 blks = sectsz=4096 attr=2, projid32bit=1 = crc=0 finobt=0 data = bsize=4096 blocks=5242880, imaxpct=25 = sunit=0 swidth=0 blks naming =version 2 bsize=4096 ascii-ci=0 ftype=0 log =internal log bsize=4096 blocks=2560, version=2 = sectsz=4096 sunit=1 blks, lazy-count=1 realtime =none extsz=4096 blocks=0, rtextents=0 # \u521b\u5efa\u76ee\u5f55\u5e76\u6dfb\u52a0fstab [root@swift-stor0 ~]# mkdir -p /srv/node/device0 [root@swift-stor0 ~]# mount -o noatime,nodiratime,nobarrier /dev/sdb /srv/node/device0 [root@swift-stor0 ~]# chown -R swift. /srv/node [root@swift-stor0 ~]# vi /etc/fstab # \u62f7\u8d1dhash\u73af\u6587\u4ef6 [root@swift-stor0 ~]# scp root@192.168.77.70:/etc/swift/*.gz /etc/swift/ root@192.168.77.70's password: account.ring.gz 100% 3862 3.8KB/s 00:00 container.ring.gz 100% 3861 3.8KB/s 00:00 object.ring.gz 100% 3887 3.8KB/s 00:00 [root@swift-stor0 ~]# chown swift. /etc/swift/*.gz # \u4fee\u6539\u540e\u7f00\u4e3aproxy\u8bbe\u7f6e\u503c [root@swift-stor0 ~]# vi /etc/swift/swift.conf [swift-hash] swift_hash_path_suffix = swift_shared_path # \u4fee\u6539account\u3001container\u3001object\u670d\u52a1\u7aef\u53e3 [root@swift-stor0 ~]# vi /etc/swift/account-server.conf bind_ip = 192.168.77.71 bind_port = 6002 [root@swift-stor0 ~]# vi /etc/swift/container-server.conf bind_ip = 192.168.77.71 bind_port = 6002 [root@swift-stor0 ~]# vi /etc/swift/object-server.conf bind_ip = 192.168.77.71 bind_port = 6000 # \u914d\u7f6ersync [root@swift-stor0 ~]# vi /etc/rsyncd.conf # \u5728\u672b\u5c3e\u6dfb\u52a0 # add to the end pid file = /var/run/rsyncd.pid log file = /var/log/rsyncd.log uid = swift gid = swift address = 192.168.77.71 [account] path = /srv/node read only = false write only = no list = yes incoming chmod = 0644 outgoing chmod = 0644 max connections = 25 lock file = /var/lock/account.lock [container] path = /srv/node read only = false write only = no list = yes incoming chmod = 0644 outgoing chmod = 0644 max connections = 25 lock file = /var/lock/container.lock [object] path = /srv/node read only = false write only = no list = yes incoming chmod = 0644 outgoing chmod = 0644 max connections = 25 lock file = /var/lock/object.lock [swift_server] path = /etc/swift read only = true write only = no list = yes incoming chmod = 0644 outgoing chmod = 0644 max connections = 5 lock file = /var/lock/swift_server.lock # \u5f00\u542f\u670d\u52a1 [root@swift-stor0 ~]# systemctl start rsyncd [root@swift-stor0 ~]# systemctl enable rsyncd ln -s '/usr/lib/systemd/system/rsyncd.service' '/etc/systemd/system/multi-user.target.wants/rsyncd.service' [root@swift-stor0 ~]# for ringtype in account container object; do systemctl start openstack-swift-$ringtype systemctl enable openstack-swift-$ringtype for service in replicator updater auditor; do if [ $ringtype != 'account' ] || [ $service != 'updater' ]; then systemctl start openstack-swift-$ringtype-$service systemctl enable openstack-swift-$ringtype-$service fi done done ln -s '/usr/lib/systemd/system/openstack-swift-account.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-account.service' ln -s '/usr/lib/systemd/system/openstack-swift-account-replicator.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-account-replicator.service' ln -s '/usr/lib/systemd/system/openstack-swift-account-auditor.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-account-auditor.service' ln -s '/usr/lib/systemd/system/openstack-swift-container.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-container.service' ln -s '/usr/lib/systemd/system/openstack-swift-container-replicator.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-container-replicator.service' ln -s '/usr/lib/systemd/system/openstack-swift-container-updater.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-container-updater.service' ln -s '/usr/lib/systemd/system/openstack-swift-container-auditor.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-container-auditor.service' ln -s '/usr/lib/systemd/system/openstack-swift-object.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-object.service' ln -s '/usr/lib/systemd/system/openstack-swift-object-replicator.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-object-replicator.service' ln -s '/usr/lib/systemd/system/openstack-swift-object-updater.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-object-updater.service' ln -s '/usr/lib/systemd/system/openstack-swift-object-auditor.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-object-auditor.service' \u6dfb\u52a0\u7528\u6237 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # \u6dfb\u52a0\u5de5\u7a0b [root@controller0 ~(keystone)]# openstack project create --description \"Swift Service Project\" swiftservice +-------------+----------------------------------+ | Field | Value | +-------------+----------------------------------+ | description | Swift Service Project | | enabled | True | | id | 65e95f038a654db3a2ee0ae93daaf2b3 | | name | swiftservice | +-------------+----------------------------------+ # \u521b\u5efa\u5ba2\u6237\u7aef\u89d2\u8272 [root@controller0 ~(keystone)]# openstack role create swiftoperator +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | dbcb21e865ae435da39507bea32fe312 | | name | swiftoperator | +-------+----------------------------------+ # \u6dfb\u52a0\u5de5\u7a0b\u7528\u6237 [root@controller0 ~(keystone)]# openstack user create --project swiftservice --password userpassword user01 +------------+----------------------------------+ | Field | Value | +------------+----------------------------------+ | email | None | | enabled | True | | id | c1d2e56e9d72447096221a4542e17e58 | | name | user01 | | project_id | 65e95f038a654db3a2ee0ae93daaf2b3 | | username | user01 | +------------+----------------------------------+ # \u8d4b\u4e88\u7528\u6237\u5ba2\u6237\u7aef\u89d2\u8272 [root@controller0 ~(keystone)]# openstack role add --project swiftservice --user user01 swiftoperator +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | dbcb21e865ae435da39507bea32fe312 | | name | swiftoperator | +-------+----------------------------------+ \u5ba2\u6237\u7aef\u64cd\u4f5c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # \u5b89\u88c5\u6240\u9700\u5305 [root@controller0 ~(keystone)]# yum install -y python-keystoneclient python-swiftclient # \u6dfb\u52a0keystone_rc\u6587\u4ef6 [root@controller0 ~(swift)]# cat swift_keystone export OS_PROJECT_DOMAIN_ID=default export OS_USER_DOMAIN_ID=default export OS_PROJECT_NAME=swiftservice export OS_TENANT_NAME=swiftservice export OS_USERNAME=user01 export OS_PASSWORD=userpassword export OS_AUTH_URL=http://192.168.77.50:35357/v2.0 export PS1='[\\u@\\h \\W(swift)]\\$ ' [root@controller0 ~(keystone)]# source swift_keystone [root@controller0 ~(swift)]# swift stat Account: AUTH_65e95f038a654db3a2ee0ae93daaf2b3 Containers: 0 Objects: 0 Bytes: 0 X-Put-Timestamp: 1438064191.81736 Connection: keep-alive X-Timestamp: 1438064191.81736 X-Trans-Id: txe9426af85d424b7185086-0055b71e3e Content-Type: text/plain; charset=utf-8 # \u521b\u5efa\u6d4b\u8bd5\u5bb9\u5668 [root@controller0 ~(swift)]# swift post test_container [root@controller0 ~(swift)]# swift list test_container # \u4e0a\u4f20\u6587\u4ef6 [root@controller0 ~(swift)]# swift upload test_container admin_keystone [root@controller0 ~(swift)]# swift list test_container admin_keystone # \u4e0b\u8f7d\u6587\u4ef6 [root@controller0 ~(swift)]# swift download test_container admin_keystone > admin_keystone.txt \u914d\u7f6eHeat\uff08\u53ef\u9009\uff09 Heat\u670d\u52a1\u5373\u7528\u4e8e\u63d0\u4f9borchestration\uff0c\u5728\u6b64\u6211\u4eec\u4f7f\u7528neutron0\u5f53\u4f5cheat\u8282\u70b9\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 | +------------------+ | +-----------------------+ | [ controller0 ] | | | [ neutron0 ] | | Keystone |192.168.77.50 | 192.168.77.30| DHCP,L3,L2 Agent | | Glance |--------------+--------------| Metadata Agent | | Nova API |eth0 | th0| Heat API,API-CFN | | Neutron Server | | | Heat Engine | +------------------+ | +-----------------------+ eth0|192.168.77.51 +--------------------+ | [ compute0 ] | | Nova Compute | | L2 Agent | +--------------------+ \u63a7\u5236\u8282\u70b9\u914d\u7f6e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 # \u5b89\u88c5\u6240\u9700\u5305 [root@controller0 ~]# yum install -y openstack-heat-common # \u6dfb\u52a0\u7528\u6237\uff0c\u521b\u5efaendpoint [root@controller0 ~(keystone)]# openstack user create --project service --password servicepassword heat +------------+----------------------------------+ | Field | Value | +------------+----------------------------------+ | email | None | | enabled | True | | id | d18e4d820a5d4384a676bb0064448c09 | | name | heat | | project_id | 9acf83020ae34047b6f1e320c352ae44 | | username | heat | +------------+----------------------------------+ [root@controller0 ~(keystone)]# openstack role add --project service --user heat admin +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 95c4b8fb8d97424eb52a4e8a00a357e7 | | name | admin | +-------+----------------------------------+ [root@controller0 ~(keystone)]# openstack role create heat_stack_owner +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 91ef76ae6d6c4fc0b908cf7416055da0 | | name | heat_stack_owner | +-------+----------------------------------+ [root@controller0 ~(keystone)]# openstack role create heat_stack_user +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 0bf5c075fcb7448d844699131c8008fb | | name | heat_stack_user | +-------+----------------------------------+ [root@controller0 ~(keystone)]# openstack role add --project admin --user admin heat_stack_owner +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 91ef76ae6d6c4fc0b908cf7416055da0 | | name | heat_stack_owner | +-------+----------------------------------+ [root@controller0 ~(keystone)]# openstack service create --name heat --description \"Openstack Orchestration\" orchestration +-------------+----------------------------------+ | Field | Value | +-------------+----------------------------------+ | description | Openstack Orchestration | | enabled | True | | id | fc32f278bf3243d9b6b6c7a5cbf13135 | | name | heat | | type | orchestration | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# openstack service create --name heat-cfn --description \"Openstack Orchestration\" cloudformation +-------------+----------------------------------+ | Field | Value | +-------------+----------------------------------+ | description | Openstack Orchestration | | enabled | True | | id | f3334830bc254e6491b5f7de8f7d9a58 | | name | heat-cfn | | type | cloudformation | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# heat_api=192.168.77.30 [root@controller0 ~(keystone)]# openstack endpoint create \\ --publicurl http://$heat_api:8004/v1/%\\(tenant_id\\)s \\ --internalurl http://$heat_api:8004/v1/%\\(tenant_id\\)s \\ --adminurl http://$heat_api:8004/v1/%\\(tenant_id\\)s \\ --region RegionOne \\ orchestration +--------------+--------------------------------------------+ | Field | Value | +--------------+--------------------------------------------+ | adminurl | http://192.168.77.30:8004/v1/%(tenant_id)s | | id | 1a91dbfe0913466db38595c1b4f0bd59 | | internalurl | http://192.168.77.30:8004/v1/%(tenant_id)s | | publicurl | http://192.168.77.30:8004/v1/%(tenant_id)s | | region | RegionOne | | service_id | fc32f278bf3243d9b6b6c7a5cbf13135 | | service_name | heat | | service_type | orchestration | +--------------+--------------------------------------------+ [root@controller0 ~(keystone)]# openstack endpoint create \\ --publicurl http://$heat_api:8000/v1 \\ --internalurl http://$heat_api:8000/v1 \\ --adminurl http://$heat_api:8000/v1 \\ --region RegionOne \\ cloudformation +--------------+----------------------------------+ | Field | Value | +--------------+----------------------------------+ | adminurl | http://192.168.77.30:8000/v1 | | id | e40570fd8201420fbea42abf3231d8eb | | internalurl | http://192.168.77.30:8000/v1 | | publicurl | http://192.168.77.30:8000/v1 | | region | RegionOne | | service_id | f3334830bc254e6491b5f7de8f7d9a58 | | service_name | heat-cfn | | service_type | cloudformation | +--------------+----------------------------------+ # \u6ce8\u610f\u672b\u5c3e\u7684\u4fe1\u606f\uff0c\u540c\u65f6\u624b\u52a8\u66f4\u65b0/etc/heat/heat.conf\u6587\u4ef6 [root@controller0 ~(keystone)]# heat-keystone-setup-domain \\ --stack-user-domain-name heat_user_domain \\ --stack-domain-admin heat_domain_admin \\ --stack-domain-admin-password domainpassword Please update your heat.conf with the following in [DEFAULT] stack_user_domain_id=55654da575f048869a9128db12d26f27 stack_domain_admin=heat_domain_admin stack_domain_admin_password=domainpassword [root@controller0 ~(keystone)]# vim /etc/heat/heat.conf # \u521b\u5efa\u6570\u636e\u5e93 [root@controller0 ~]# mysql -uroot -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 11 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database heat; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on heat.* to heat@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on heat.* to heat@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye heat\u8282\u70b9\u914d\u7f6e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 [root@neutron0 ~]# mv /etc/heat/heat.conf /etc/heat/heat.conf.org [root@neutron0 ~]# vi /etc/heat/heat.conf [DEFAULT] deferred_auth_method = trusts trusts_delegated_roles = heat_stack_owner # Heat installed server heat_metadata_server_url = http://192.168.77.30:8000 heat_waitcondition_server_url = http://192.168.77.30:8000/v1/waitcondition heat_watch_server_url = http://192.168.77.30:8003 heat_stack_user_role = heat_stack_user stack_user_domain_id=55654da575f048869a9128db12d26f27 stack_domain_admin=heat_domain_admin stack_domain_admin_password=domainpassword rpc_backend = rabbit [database] # MariaDB connection info connection = mysql://heat:password@192.168.77.50/heat # RabbitMQ connection info [oslo_messaging_rabbit] rabbit_host = 192.168.77.50 rabbit_port = 5672 rabbit_userid = guest rabbit_password = password [ec2authtoken] # Keystone server auth_uri = http://192.168.77.50:35357/v2.0 [heat_api] bind_host = 0.0.0.0 bind_port = 8004 [heat_api_cfn] bind_host = 0.0.0.0 bind_port = 8000 [keystone_authtoken] # Keystone auth info auth_host = 192.168.77.50 auth_port = 35357 auth_protocol = http auth_uri = http://192.168.77.50:35357/v2.0 # Heat admin user admin_user = heat # Heat admin user's password admin_password = servicepassword # Heat admin user's tenant admin_tenant_name = service [root@neutron0 ~]# chgrp heat /etc/heat/heat.conf [root@neutron0 ~]# chmod 640 /etc/heat/heat.conf [root@neutron0 ~]# chmod 640 /etc/heat/heat.conf [root@neutron0 ~]# heat-manage db_sync [root@neutron0 ~]# systemctl start openstack-heat-api openstack-heat-api-cfn openstack-heat-engine [root@neutron0 ~]# systemctl enable openstack-heat-api openstack-heat-api-cfn openstack-heat-engine ln -s '/usr/lib/systemd/system/openstack-heat-api.service' '/etc/systemd/system/multi-user.target.wants/openstack-heat-api.service' ln -s '/usr/lib/systemd/system/openstack-heat-api-cfn.service' '/etc/systemd/system/multi-user.target.wants/openstack-heat-api-cfn.service' ln -s '/usr/lib/systemd/system/openstack-heat-engine.service' '/etc/systemd/system/multi-user.target.wants/openstack-heat-engine.service' \u4f7f\u7528heat\u521b\u5efa\u865a\u62df\u673a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 [root@controller0 ~]# vi sample-stack.yml heat_template_version: 2014-10-16 description: Heat Sample Template parameters: ImageID: type: string description: Image used to boot a server NetID: type: string description: Network ID for the server resources: server1: type: OS::Nova::Server properties: name: \"Heat_Deployed_Server\" image: { get_param: ImageID } flavor: \"m1.small\" networks: - network: { get_param: NetID } outputs: server1_private_ip: description: IP address of the server in the private network value: { get_attr: [ server1, first_address ] } [root@controller0 ~]# source admin_keystone [root@controller0 ~(keystone)]# glance image-list +--------------------------------------+---------+-------------+------------------+-------------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +--------------------------------------+---------+-------------+------------------+-------------+--------+ | fc9da1a8-0418-4ae8-8e67-22a7975f7a0b | centos6 | qcow2 | bare | 10739318784 | active | +--------------------------------------+---------+-------------+------------------+-------------+--------+ [root@controller0 ~(keystone)]# Int_Net_ID=`neutron net-list | grep int_net | awk '{ print $2 }'` [root@controller0 ~(keystone)]# heat stack-create -f sample-stack.yml -P \"ImageID=centos6;NetID=$Int_Net_ID\" Sample-Stack +--------------------------------------+--------------+--------------------+----------------------+ | id | stack_name | stack_status | creation_time | +--------------------------------------+--------------+--------------------+----------------------+ | 35b5c1e6-ec84-4bf8-9e77-1946bcf8d09b | Sample-Stack | CREATE_IN_PROGRESS | 2015-07-31T03:06:27Z | +--------------------------------------+--------------+--------------------+----------------------+ \u914d\u7f6eCeilometer\uff08\u53ef\u9009\uff09 \u914d\u7f6eSahara\uff08\u53ef\u9009\uff09 \u914d\u7f6eIronic\uff08\u53ef\u9009\uff09 \u4f7f\u7528\u793a\u4f8b \u57fa\u672c\u64cd\u4f5c \u4e00\u4e9b\u5e38\u7528\u64cd\u4f5c\u3002 \u6dfb\u52a0\u955c\u50cf \u4ee5admin\u6216\u8005demo\u7528\u6237\u8eab\u4efd\u767b\u5f55dashboard\u540e\uff0c\u9009\u62e9\u201c\u955c\u50cf\u201d\uff0c\u4e0a\u4f20ISO\u3002 ```{image} ../images/apx01-01.png :align: center 1 2 3 4 5 6 #### \u4eceISO\u5b89\u88c5\u65b0\u5b9e\u4f8b \u5728\u201c\u5b9e\u4f8b\u201d\u9009\u9879\u5361\u4e2d\uff0c\u9009\u62e9\u201c\u6dfb\u52a0\u5b9e\u4f8b\u201d\uff0c\u5e76\u4ece\u73b0\u6709\u955c\u50cf\u542f\u52a8\u3002 ```{image} ../images/apx01-02.png :align: center \u4e0eowncloud\u96c6\u6210 \u521b\u5efa\u4e00\u4e2a\u6307\u5b9aregion\u7684endpoint\u4e8eswift\u670d\u52a1\u4e2d ```{code} source ./keystone_admin # keystone endpoint-create --service swift --region swift_region \\ --publicurl \"http://192.168.2.160:8080/v1/AUTH_7d11dd5a3f3544149e8b6a9799a2aa48/oc\" ``` \u5176\u4e2d\u7684publicurl\u53ef\u4ee5\u4ececontainer\u7684\u8be6\u7ec6\u4fe1\u606f\u4e2d\u67e5\u770b\u3002 \u4f7f\u7528owncloud\u7684\u7b2c\u4e09\u65b9app\u2014\u2014external storage\uff0c\u5982\u4e0b\u8fdb\u884c\u586b\u5199 \u76ee\u5f55\u540d\u79f0\uff1a\u663e\u793a\u5728owncloud\u4e2d\u7684\u76ee\u5f55\u540d\u79f0\u3002 user\uff1aproject\u7528\u6237\u540d\u3002 bucket\uff1a\u5bb9\u5668\u540d\u3002 region\uff1a\u4e0a\u4e00\u6b65\u6307\u5b9a\u7684region\u3002 key\uff1a\u7528\u6237\u5bc6\u7801\u3002 tenant\uff1aproject\u540d\u3002 password\uff1a\u7528\u6237\u5bc6\u7801\u3002 service_name\uff1a\u670d\u52a1\u540d\uff0c\u5373swift\u3002 url\uff1a\u4f7f\u7528keystone\u8ba4\u8bc1\u7684url\uff0c\u5373http://192.168.2.160:5000/v2.0 \u3002 timeout\uff1a\u8d85\u65f6\u65f6\u957f\uff0c\u53ef\u4e0d\u586b\u3002 oVirt\u4f7f\u7528Glance\u4e0eNeutron\u670d\u52a1 oVirt\u81ea3.3\u7248\u672c\u8d77\uff0c\u4fbf\u53ef\u4ee5\u6dfb\u52a0\u5916\u90e8\u7ec4\u4ef6\uff0c\u6bd4\u5982Foreman\u3001OpenStack\u7684\u7f51\u7edc\u6216\u955c\u50cf\u670d\u52a1\u3002 \u5728\u6dfb\u52a0OpenStack\u76f8\u5173\u7ec4\u4ef6\u4e4b\u524d\uff0coVirt\u7ba1\u7406\u7aef\u9700\u8981\u914d\u7f6eOpenStack\u7684KeyStone URL\uff1a 1 2 # engine-config --set KeystoneAuthUrl=http://192.168.2.160:35357/v2.0 # service ovirt-engine restart \u6dfb\u52a0OpenStack\u955c\u50cf\u670d\u52a1Glance\u81f3oVirt \u5728OpenStack\u7684\u63a7\u5236\u53f0\u4e2d\uff0c\u6dfb\u52a0\u4e00\u4e2a\u65b0\u955c\u50cf\uff0c\u6bd4\u5982my_test_image\uff0c\u683c\u5f0f\u4e3araw\u3002 ```{image} ../images/apx01-03.png :align: center 1 2 3 4 2. \u5728oVirt\u5de6\u8fb9\u680f\uff0c\u9009\u62e9External Provider\u6dfb\u52a0OpenStack Image\u670d\u52a1\u3002 ```{image} ../images/apx01-04.png :align: center :::{note} \u8ba4\u8bc1\u9009\u9879 \u7528\u6237\u540d\uff1aglance \u5bc6\u7801\uff1a\u5b58\u4e8eRDO\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5f62\u5982 CONFIG_GLANCE_KS_PW=bf83b75a635843b4 Tenant\uff1aservices ::: \u7136\u540e\u53ef\u4ee5\u5728oVirt\u7684\u5b58\u50a8\u57df\u4e2d\u770b\u5230\u521a\u521a\u6dfb\u52a0\u7684Glance\u670d\u52a1\u3002 ```{image} ../images/apx01-05.png :align: center 1 2 3 4 #### Neutron ```{image} ../images/apx01-06.jpeg :align: center \u53ef\u53c2\u8003 NeutronVirtualAppliance \u4ee5\u53ca Overlay_Networks_with_Neutron_Integration \uff0c\u53e6\u5916\u63d0\u4f9b \u64cd\u4f5c\u89c6\u9891 \u3002 \u914d\u7f6eoVirt\u3002 1 2 3 # engine-config --set OnlyRequiredNetworksMandatoryForVdsSelection=true # yum install vdsm-hook-openstacknet # service ovirt-engine restart \u5982\u56fe\u6dfb\u52a0Neutron\u7ec4\u4ef6\u3002 ```{image} ../images/apx01-07.png :align: center 1 2 ```{image} ../images/apx01-08.png :align: center :::{note} \u8ba4\u8bc1\u9009\u9879 \u7528\u6237\u540d\uff1aneutron \u5bc6\u7801\uff1a\u5b58\u4e8eRDO\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5f62\u5982 CONFIG_NEUTRON_KS_PW=a16c52e3ea634324 Tenant\uff1aservices agent \u914d\u7f6e\u76f8\u540c ::: OpenStack\u5e38\u89c1\u95ee\u9898 Q\uff1a\u5982\u4f55\u6821\u9a8c\u5bc6\u7801\u662f\u5426\u6b63\u786e\uff1f A\uff1akeystone --os-username=neutron --os-password=servicepassword --os-auth-url=http://localhost:35357/v2.0 token-get Q\uff1a\u7ba1\u7406\u754c\u9762Swift\u4e0d\u80fd\u5220\u9664\u76ee\u5f55\uff1f A\uff1a\u4f7f\u7528\u547d\u4ee4 swift delete public_container aaa/ \u8fdb\u884c\u5220\u9664\u3002 Q\uff1a Neutron \u7f51\u7edc\u5feb\u901f\u5f00\u59cb\uff1f A\uff1a\u53c2\u8003https://www.ustack.com/blog/neutron_intro/ Q\uff1aOpenStack\u7ec4\u4ef6\u95f4\u7684\u901a\u4fe1\u662f\u9760\u4ec0\u4e48\uff1f A\uff1aAMQP\uff0c\u6bd4\u5982RabbitMQ\u3001Apache\u7684ActiveMQ\uff0c\u90e8\u7f72\u65f6\u5019\u53ef\u4ee5\u9009\u62e9\uff0c\u5982\u679c\u5bf9\u8fd9\u79cd\u6d88\u606f\u4f20\u8f93\u5de5\u5177\u6709\u5174\u8da3\u53ef\u4ee5\u53c2\u8003 rabbitmq tutorial \u4ee5\u53ca \u5404\u79cd\u6709\u7528\u7684\u63d2\u4ef6\uff08web\u76d1\u89c6\u7b49\uff09 \u3002 Q\uff1aSwift\u6709\u4ec0\u4e48\u597d\u7528\u7684\u5ba2\u6237\u7aef\u4e48\uff1f A\uff1a python-swiftclient \u3001 Gladient Cloud Desktop \u3001 Cloudberry \u3001 Cyberduck \u3001 WebDrive \u3001 S3 Browser \u7b49\u3002","title":"\u9644\u5f55\u4e00 OpenStack\u6982\u5ff5\u3001\u90e8\u7f72\u3001\u4e0e\u9ad8\u7ea7\u7f51\u7edc\u5e94\u7528"},{"location":"inthecloud/appendix01/#openstack","text":"\u9996\u5148\u5728\u8fd9\u91cc\u6211\u4f1a\u4f7f\u7528RDO\u5feb\u901f\u90e8\u7f72\u4e00\u4e2a\u5177\u6709\u57fa\u672c\u529f\u80fd\u7684OpenStack\u73af\u5883\uff0c\u5982\u679c\u4f60\u60f3\u8981\u66f4\u5b8c\u6574\u7684\u90e8\u7f72\uff08\u6bd4\u5982Heat\u3001Trove\u7ec4\u4ef6\uff09\uff0c\u53ef\u4ee5\u53c2\u8003 \u5b98\u65b9\u6587\u6863 \u3002 \u4e5f\u53ef\u4ee5\u4f7f\u7528Mirantis\u6765\u8fdb\u884c\u5feb\u901f\u90e8\u7f72\uff0c\u53c2\u8003 Mirantis \uff1bStackOps\u90e8\u7f72\uff0c\u53c2\u8003 StackOps \u3002 \u5982\u679c\u4e0d\u60f3\u5b89\u88c5\u4efb\u4f55\u4e1c\u897f\uff0c\u53ea\u662f\u5728\u7ebf\u4f7f\u7528\u7684\u8bdd\uff0c\u53ef\u4ee5\u8bbf\u95ee http://trystack.org/ \u3002 \u8981\u5b66\u4e60\u66f4\u591a\u5173\u4e8eOpenStack\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u53c2\u8003 \u9648\u6c99\u514b\u7684\u65e5\u5fd7 \u3002 API\u4f7f\u7528\u8bf7\u53c2\u8003http://developer.openstack.org/api-ref.html \u4ee5\u53ca http://docs.openstack.org/developer/openstack-projects.html \u3002 \u5173\u4e8e\u5728centos/ubuntu/debian\u4e0a\u90e8\u7f72OpenStack\u8bf7\u53c2\u8003 Server-World \uff0c\u8fd9\u4e2a\u66f4\u65b0\u8f83\u4e3a\u53ca\u65f6\u3002 \u7b14\u8005\u6700\u8fd1\u4eff\u7167Mirantis\u64b8\u4e86\u4e00\u4e2a\u811a\u672c\uff0c\u5168\u81ea\u52a8\u5b89\u88c5\u90e8\u7f72OpenStack\uff0c\u6253\u7b97\u518d\u5199\u4e2aDjango\u62d6\u62fd\u5b89\u88c5\u3002\u5f53\u7136\uff0c\u8981\u914d\u4e0akubernestes\u90e8\u7f72\u4e86\u3002\u8bf7\u53c2\u8003 https://github.com/lofyer/openstack-pxe-deployment \u3002","title":"\u9644\u5f55\u4e00 OpenStack\u6982\u5ff5\u3001\u90e8\u7f72\u3001\u4e0e\u9ad8\u7ea7\u7f51\u7edc\u5e94\u7528"},{"location":"inthecloud/appendix01/#openstack_1","text":"\u5728\u5f00\u59cb\u4e4b\u524d\u9700\u8981\u5c06\u8fd9\u4e9b\u5173\u952e\u7ec4\u4ef6\u5173\u7cfb\u7406\u6e05\u3002 nova\uff1a\u63d0\u4f9bcompute\u670d\u52a1\uff0c\u5373\u4fdd\u8bc1\u865a\u62df\u673a\u8fd0\u884c\u7684\u5fc5\u987b\u670d\u52a1\u4e4b\u4e00\uff0c\u865a\u62df\u673a\u8fd0\u884c\u4e8e\u6240\u6709\u63d0\u4f9bcompute\u670d\u52a1\u7684\u4e3b\u673a\u4e4b\u4e0a\u3002 neutron\uff1a\u63d0\u4f9bnetwork\u670d\u52a1\uff0c\u540c\u65f6\u63d0\u4f9bOpen vSwitch\u3001L3\u3001DHCP\u4ee3\u7406\u670d\u52a1\u3002 cinder\uff1a\u63d0\u4f9b\u5757\u5b58\u50a8\u670d\u52a1\uff0c\u53ef\u914d\u5408swift\u4f7f\u7528\u3002 swift\uff1a\u63d0\u4f9b\u5bf9\u8c61\u5b58\u50a8\u670d\u52a1\uff0c\u76ee\u5f55\u4e0e\u6587\u4ef6\u7686\u89c6\u4e3a\u5bf9\u8c61\uff0c\u5916\u90e8\u53ef\u4ee5\u65b9\u4fbf\u53d6\u7528\u3002 glance\uff1a\u63d0\u4f9b\u955c\u50cf\u7ba1\u7406\u670d\u52a1\u3002 ceilometer\uff1a\u4e3b\u8981\u529f\u80fd\u662f\u76d1\u6d4b\u3001\u6536\u96c6\u7528\u6237\u5bf9\u8d44\u6e90\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u4ee5\u65b9\u4fbf\u8ba1\u8d39\u3001\u62a5\u8b66\u7b49\u3002 heat\uff1aorchestration\u6a21\u5757\u9a71\u52a8\u670d\u52a1\uff0c\u5373\u4ece\u6a21\u677f\u6839\u636e\u9700\u6c42\u66f4\u6539\u914d\u7f6e\u521b\u5efa\u65b0\u865a\u62df\u673a\u3002 keystone\uff1a\u8eab\u4efd\u8ba4\u8bc1\u670d\u52a1\u3002 trove\uff1a\u6570\u636e\u5e93\u670d\u52a1\u3002 sahara\uff1aHadoop\u6a21\u5757\u3002 ironic\uff1a\u63d0\u4f9b\u4ece\u6a21\u677f\u521b\u5efa\u65b0\u5e94\u7528\u7a0b\u5e8f\u3002","title":"OpenStack \u90e8\u7f72"},{"location":"inthecloud/appendix01/#mirantis-fuel","text":"\u73b0\u5728\u56fd\u5185\u4f7f\u7528Mirantis\u90e8\u7f72\u7684\u4eba\u5df2\u7ecf\u8d8a\u6765\u8d8a\u591a\u4e86\uff0c\u800c\u6211\u4eec\u540c\u6837\u4f7f\u7528\u5b83\u6765\u4e00\u6b21\u5feb\u901f\u90e8\u7f72\u3002\u7cbe\u901a\u4e86Mirantis\u5c31\u638c\u63e1\u4e86\u5927\u89c4\u6a21\u96c6\u7fa4\u7684\u90e8\u7f72\u65b9\u5f0f\uff0c\u4e0d\u53ea\u662fOpenStack\u3002","title":"Mirantis Fuel \u90e8\u7f72"},{"location":"inthecloud/appendix01/#rdo","text":"\u4f7f\u7528 RDO \u6765\u90e8\u7f72OpenStack\u3002 :::{note} \u5b89\u88c5\u8bf4\u660e \u5728\u4e00\u53f0\u5b89\u88c5\u6709RedHat\u7cfb\u5217\uff08CentOS\uff09\u7cfb\u7edf\u4e0a\u90e8\u7f72\uff0c\u5c06selinux\u7f6e\u4e3apermissive\uff1b\u7981\u7528NetworkManager\uff0c\u542f\u7528network\u670d\u52a1\uff0c\u8be6\u7ec6\u914d\u7f6e\u8bf7\u53c2\u8003\u4ee5\u524d\u7ae0\u8282\u3002 \u5982\u679c\u5b89\u88c5\u5931\u8d25\uff0c\u8bf7\u67e5\u770b\u4f60\u7684CentOS\u6216\u8005Fedora\u662f\u5426\u4e3a\u6700\u65b0\u53d1\u884c\u7248\u3002\u7b14\u8005\u5728\u5199\u65f6\u4f7f\u7528\u7684\u662fCentOS6\uff0c\u76ee\u524d\u4e3aCentOS7\u3002 ::: 1 2 3 4 5 # yum install -y http://rdo.fedorapeople.org/rdo-release.rpm # yum install -y epel-release # yum update -y # yum install -y openstack-packstack # packstack --allinone \u8bf7\u8010\u5fc3\u7b49\u5f85\uff0c\u4ee5\u4e0a\u8fc7\u7a0b\u9884\u8ba1\u82b1\u8d39\u4e00\u5230\u4e24\u5c0f\u65f6\u3002\u6709\u5173\u6b64\u6b21\u90e8\u7f72\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5728\u5b89\u88c5\u5b8c\u6210\u540e\u53ef\u4ee5\u770b\u5230\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 **** Installation completed successfully ****** Additional information: * A new answerfile was created in: /root/packstack-answers-20140730-110621.txt * Time synchronization installation was skipped. Please note that unsynchronized time on server instances might be problem for some OpenStack components. * File /root/keystonerc_admin has been created on OpenStack client host 192.168.2.160. To use the command line tools you need to source the file. * To access the OpenStack Dashboard browse to http://192.168.2.160/dashboard . Please, find your login credentials stored in the keystonerc_admin in your home directory. * To use Nagios, browse to http://192.168.2.160/nagios username: nagiosadmin, password: ea65dc070f034776 * Because of the kernel update the host 192.168.2.160 requires reboot. * The installation log file is available at: /var/tmp/packstack/20140730-110621-upxlZJ/openstack-setup.log * The generated manifests are available at: /var/tmp/packstack/20140730-110621-upxlZJ/manifests \u53ef\u4fee\u6539 /root/packstack-answers-20140730-110621.txt \u5185\u5bb9\u4ee5 \u589e\u52a0\u8ba1\u7b97\u8282\u70b9 \uff1b\u540c\u7406\u53ef\u589e\u52a0\u7f51\u7edc\u8282\u70b9\uff08\u5f85\u5b9e\u9a8c\uff09\u3002 :::{note} \u5047\u5982\u66f4\u6362\u4e86admin/demo/services\u7684\u5bc6\u7801\uff0c\u4e0d\u8981\u5fd8\u8bb0\u5728\u6b64\u914d\u7f6e\u6587\u4ef6\u4e2d\u5c06\u5176\u4fee\u6539\u4e3a\u65b0\u5bc6\u7801\u3002","title":"RDO \u5feb\u901f\u90e8\u7f72"},{"location":"inthecloud/appendix01/#packstack-answer-filerootpackstack-answers-20140730-110621txt","text":":::","title":"packstack --answer-file=/root/packstack-answers-20140730-110621.txt"},{"location":"inthecloud/appendix01/#_1","text":"","title":"\u6dfb\u52a0\u8ba1\u7b97\u8282\u70b9"},{"location":"inthecloud/appendix01/#neutron","text":"","title":"\u4f7f\u7528Neutron\u7f51\u7edc"},{"location":"inthecloud/appendix01/#_2","text":"CentOS 7\u4ee5\u53caUbuntu\u7b49\u53d1\u884c\u7248\u90e8\u7f72OpenStack\u7684\u8fc7\u7a0b\u57fa\u672c\u4e00\u81f4\uff0c\u5728\u6b64\u4ee5CentOS 7\u793a\u4f8b\u3002","title":"\u5206\u6b65\u8be6\u7ec6\u90e8\u7f72"},{"location":"inthecloud/appendix01/#_3","text":"\u63a7\u5236\u8282\u70b9\uff1acontroller0(192.168.77.50) \u8ba1\u7b97\u8282\u70b9\uff1acontroller0(192.168.77.50)\uff0ccompute0(192.168.77.51) \u7f51\u7edc\u8282\u70b9\uff1aneutron0(192.168.77.30) \u5b58\u50a8\u8282\u70b9\uff1acinder0(192.168.77.60)\uff0cswift0(192.168.77.70)\uff0cswift-stor0(192.168.77.71)\uff0cswift-stor1(192.168.77.72)\uff0cswift-stor2(192.168.77.73) Heat\u8282\u70b9\uff1aheat0(192.168.77.80) \u6bcf\u53f0\u673a\u5668\u9996\u5148\u5c06selinux\u8bbe\u7f6e\u4e3apermissive\u6216\u8005disable\u3001\u6253\u5f00ssh\u670d\u52a1\u3001\u7981\u7528\u9632\u706b\u5899\uff08\u53ef\u5b89\u88c5iptables-services\u670d\u52a1\uff0c\u5173\u95edfirewalld\uff0ciptables -F\u540e\u518dservice iptables save\uff09\u3001\u5173\u95edNetworkManager\u670d\u52a1\u3001\u6253\u5f00network\u670d\u52a1\u5e76\u914d\u7f6eIP\u3002 :::{note} bash_rc\u6587\u4ef6\u7528\u4f8b bash_rc\u6587\u4ef6\u6bd4\u5982os_bootstrap\u3001admin_keystone\uff0c\u5176\u4e2dos_bootstrap\u7528\u4e8e\u521b\u5efa\u57fa\u672ckeystone\u670d\u52a1\u4f7f\u7528\uff0cadmin_keystone\u4e3a\u521b\u5efa\u7684admin\u7528\u6237\u3002 ::: :::{note} \u8ba4\u8bc1\u670d\u52a1 OpenStack\u4e2d\u7684keystone\u670d\u52a1\u8d1f\u8d23\u7edd\u5927\u90e8\u5206authentication\u7684\u5de5\u4f5c\uff0c\u5176\u4e2d\u5c5e\u4e8eservice\u7ec4\u7684\u7528\u6237\uff08nova\u3001glance\uff09\u4e5f\u662f\u57fa\u4e8ekeystone\u8ba4\u8bc1\u7684\uff0c\u6240\u4ee5\u4e0d\u8981\u8ba4\u4e3aservice\u4e2d\u7684\u670d\u52a1\u4ec5\u4ec5\u662f\u4e00\u4e2a\u670d\u52a1\u800c\u5df2\u3002 ::: 1 2 3 4 5 6 7 8 9 10 # cat os_bootstrap export SERVICE_TOKEN=admin export SERVICE_ENDPOINT=http://192.168.77.50:35357/v2.0/ # cat admin_keystone export OS_USERNAME=admin export OS_PASSWORD=admin export OS_TENANT_NAME=admin export OS_AUTH_URL=http://localhost:35357/v2.0/ export PS1='[\\u@\\h \\W(keystone)]\\$ '","title":"\u673a\u5668\u51c6\u5907"},{"location":"inthecloud/appendix01/#_4","text":"\u5728\u63a7\u5236\u8282\u70b9controller0\uff0c\u914d\u7f6e\u6e90\u3001\u6570\u636e\u5e93\u3001RabbitMQ\u3001Memcached\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 [root@controller0 ~]# yum -y install http://repos.fedorapeople.org/repos/openstack/openstack-kilo/rdo-release-kilo.rpm epel-release [root@controller0 ~]# yum install -y galera mariadb-galera-server rabbitmq-server memcached [root@controller0 ~]# systemctl start mariadb [root@controller0 ~]# systemctl enable mariadb [root@controller0 ~]# systemctl start rabbitmq-server [root@controller0 ~]# systemctl enable rabbitmq-server [root@controller0 ~]# systemctl start memcached [root@controller0 ~]# systemctl enable memcached # \u521d\u59cb\u5316mysql [root@controller0 ~]# mysql_secure_installation /usr/bin/mysql_secure_installation: line 379: find_mysql_client: command not found NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY! In order to log into MariaDB to secure it, we'll need the current password for the root user. If you've just installed MariaDB, and you haven't set the root password yet, the password will be blank, so you should just press enter here. Enter current password for root (enter for none): OK, successfully used password, moving on... Setting the root password ensures that nobody can log into the MariaDB root user without the proper authorisation. # \u8bbe\u7f6emysql\u7684root\u5bc6\u7801 Set root password? [Y/n] y New password: Re-enter new password: Password updated successfully! Reloading privilege tables.. ... Success! By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment. # remove anonymous users Remove anonymous users? [Y/n] y ... Success! Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network. # disallow root login remotely Disallow root login remotely? [Y/n] y ... Success! By default, MariaDB comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment. # remove test database Remove test database and access to it? [Y/n] y - Dropping test database... ... Success! - Removing privileges on test database... ... Success! Reloading the privilege tables will ensure that all changes made so far will take effect immediately. # reload privilege tables Reload privilege tables now? [Y/n] y ... Success! Cleaning up... All done! If you've completed all of the above steps, your MariaDB installation should now be secure. Thanks for using MariaDB! # \u91cd\u7f6erabbitmq\u5bc6\u7801 [root@controller0 ~]# rabbitmqctl change_password guest password","title":"\u521d\u59cb\u5316\u63a7\u5236\u8282\u70b9"},{"location":"inthecloud/appendix01/#keystone","text":"","title":"\u914d\u7f6eKeyStone"},{"location":"inthecloud/appendix01/#keystone_1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # \u5b89\u88c5keystone [root@controller0 ~]# yum install -y openstack-keystone openstack-utils # \u6dfb\u52a0\u6570\u636e\u5e93 [root@controller0 ~]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 10 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database keystone; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on keystone.* to keystone@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on keystone.* to keystone@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye","title":"\u521d\u59cb\u5316Keystone"},{"location":"inthecloud/appendix01/#keystone_2","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 [root@controller0 ~]# vi /etc/keystone/keystone.conf # line 13: \u8d85\u7ea7\u7ba1\u7406\u5458\u5bc6\u7801\u4e3aadmin\uff0c\u6b64\u5bc6\u7801\u4ec5\u4f9b\u8bbe\u7f6ekeystone\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5e94\u8be5\u7981\u7528 admin_token=admin # line 418: database connection=mysql://keystone:password@localhost/keystone # line 1434: token\u683c\u5f0f # \u53ef\u80fd\u4e0d\u8981 token_format=PKI # line 1624: signing certfile=/etc/keystone/ssl/certs/signing_cert.pem keyfile=/etc/keystone/ssl/private/signing_key.pem ca_certs=/etc/keystone/ssl/certs/ca.pem ca_key=/etc/keystone/ssl/private/cakey.pem key_size=2048 valid_days=3650 cert_subject=/C=CN/ST=Di/L=Jiang/O=InTheCloud/CN=controller0.lofyer.org # \u8bbe\u7f6e\u8bc1\u4e66\uff0c\u540c\u6b65\u6570\u636e\u5e93 [root@controller0 ~]# keystone-manage pki_setup --keystone-user keystone --keystone-group keystone [root@controller0 ~]# keystone-manage db_sync # \u5220\u9664\u65e5\u5fd7\u6587\u4ef6\u5e76\u542f\u52a8\uff0c\u5426\u5219\u53ef\u80fd\u56e0\u4e3alog\u6587\u4ef6\u6743\u9650\u95ee\u9898\u800c\u62a5\u9519 [root@controller0 ~]# rm /var/log/keystone/keystone.log [root@controller0 ~]# systemctl start openstack-keystone [root@controller0 ~]# systemctl enable openstack-keystone","title":"\u914d\u7f6ekeystone"},{"location":"inthecloud/appendix01/#endpoint","text":"\u5c06\u8d85\u7ea7\u7ba1\u7406\u5458\u914d\u7f6e\u4fdd\u5b58\u5230\u6587\u4ef6\uff0c\u65b9\u4fbf\u4ee5\u540e\u7ba1\u7406\uff1a 1 2 3 4 [root@controller0 ~]# cat os_bootstrap export SERVICE_TOKEN=admin export SERVICE_ENDPOINT=http://192.168.77.50:35357/v2.0/ [root@controller0 ~]# source os_bootstrap \u6dfb\u52a0admin\u53caservice\u7684tenant\u7ec4\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 [root@controller0 ~]# keystone tenant-create --name admin --description \"Admin Tenant\" --enabled true +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Admin Tenant | | enabled | True | | id | c0c4e7b797bb41798202b55872fba074 | | name | admin | +-------------+----------------------------------+ [root@controller0 ~]# keystone tenant-create --name service --description \"Service Tenant\" --enabled true +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Service Tenant | | enabled | True | | id | 9acf83020ae34047b6f1e320c352ae44 | | name | service | +-------------+----------------------------------+ [root@controller0 ~]# keystone tenant-list +----------------------------------+---------+---------+ | id | name | enabled | +----------------------------------+---------+---------+ | c0c4e7b797bb41798202b55872fba074 | admin | True | | 9acf83020ae34047b6f1e320c352ae44 | service | True | +----------------------------------+---------+---------+ \u521b\u5efa\u89d2\u8272\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # \u521b\u5efaadmin\u89d2\u8272 [root@controller0 ~]# keystone role-create --name admin +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | id | 95c4b8fb8d97424eb52a4e8a00a357e7 | | name | admin | +----------+----------------------------------+ # \u521b\u5efaMember\u89d2\u8272 [root@controller0 ~]# keystone role-create --name Member +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | id | aa8c08c0ff63422881c7662472b173e6 | | name | Member | +----------+----------------------------------+ [root@controller0 ~]# keystone role-list +----------------------------------+----------+ | id | name | +----------------------------------+----------+ | aa8c08c0ff63422881c7662472b173e6 | Member | | 9fe2ff9ee4384b1894a90878d3e92bab | _member_ | | 95c4b8fb8d97424eb52a4e8a00a357e7 | admin | +----------------------------------+----------+ \u6dfb\u52a0\u7528\u6237\u5e76\u8d4b\u4e88\u89d2\u8272\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 # \u6dfb\u52a0admin\u7528\u6237\u81f3admin\u7ec4\uff0c\u6b64\u5904\u7684\u5bc6\u7801\u4ec5\u4ec5\u662fadmin\u7528\u6237\u5bc6\u7801\uff0c\u4e0e\u4e4b\u524d\u7684admin_token\u53ef\u4ee5\u4e0d\u540c [root@controller0 ~]# keystone user-create --tenant admin --name admin --pass admin --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | cf11b4425218431991f095c2f58578a0 | | name | admin | | tenantId | c0c4e7b797bb41798202b55872fba074 | | username | admin | +----------+----------------------------------+ # \u8d4b\u4e88admin\u7528\u6237\u4ee5admin\u89d2\u8272 [root@controller0 ~]# keystone user-role-add --user admin --tenant admin --role admin # \u6dfb\u52a0\u5373\u5c06\u7528\u5230\u7684glance\u3001nova\u7528\u6237\u4e0e\u670d\u52a1 [root@controller0 ~]# keystone user-create --tenant service --name glance --pass servicepassword --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | 2dcaa8929688442dbc1df30bee8921eb | | name | glance | | tenantId | 9acf83020ae34047b6f1e320c352ae44 | | username | glance | +----------+----------------------------------+ [root@controller0 ~]# keystone user-role-add --user glance --tenant service --role admin [root@controller0 ~]# keystone user-create --tenant service --name nova --pass servicepassword --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | 566fe34145af4390b0aadb906131a9e8 | | name | nova | | tenantId | 9acf83020ae34047b6f1e320c352ae44 | | username | nova | +----------+----------------------------------+ [root@controller0 ~]# keystone user-role-add --user nova --tenant service --role admin \u6dfb\u52a0\u670d\u52a1\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 [root@controller0 ~]# keystone service-create --name=keystone --type=identity --description=\"Keystone Identity Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Keystone Identity Service | | enabled | True | | id | b3ea5d31edce4c10b3b4c18359de0d09 | | name | keystone | | type | identity | +-------------+----------------------------------+ [root@controller0 ~]# keystone service-create --name=glance --type=image --description=\"Glance Image Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Glance Image Service | | enabled | True | | id | 6afe8a067e2945fca023f85c7760ae53 | | name | glance | | type | image | +-------------+----------------------------------+ [root@controller0 ~]# keystone service-create --name=nova --type=compute --description=\"Nova Compute Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Nova Compute Service | | enabled | True | | id | 80edb3d3914644c4b0570fd8d8dabdaa | | name | nova | | type | compute | +-------------+----------------------------------+ [root@controller0 ~]# keystone service-list +----------------------------------+----------+----------+---------------------------+ | id | name | type | description | +----------------------------------+----------+----------+---------------------------+ | 6afe8a067e2945fca023f85c7760ae53 | glance | image | Glance Image Service | | b3ea5d31edce4c10b3b4c18359de0d09 | keystone | identity | Keystone Identity Service | | 80edb3d3914644c4b0570fd8d8dabdaa | nova | compute | Nova Compute Service | +----------------------------------+----------+----------+---------------------------+ \u6dfb\u52a0endpoint\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 [root@controller0 ~]# export my_host=192.168.77.50 # \u6dfb\u52a0keystone\u7684endpoint [root@controller0 ~]# keystone endpoint-create --region RegionOne \\ --service keystone \\ --publicurl \"http://$my_host:\\$(public_port)s/v2.0\" \\ --internalurl \"http://$my_host:\\$(public_port)s/v2.0\" \\ --adminurl \"http://$my_host:\\$(admin_port)s/v2.0\" +-------------+-------------------------------------------+ | Property | Value | +-------------+-------------------------------------------+ | adminurl | http://192.168.77.50:$(admin_port)s/v2.0 | | id | 09c263fa9b3c4a58bcead0b2f5aba1a1 | | internalurl | http://192.168.77.50:$(public_port)s/v2.0 | | publicurl | http://192.168.77.50:$(public_port)s/v2.0 | | region | RegionOne | | service_id | b3ea5d31edce4c10b3b4c18359de0d09 | +-------------+-------------------------------------------+ # \u6dfb\u52a0glance\u7684endpoint [root@controller0 ~]# keystone endpoint-create --region RegionOne \\ --service glance \\ --publicurl \"http://$my_host:9292/v1\" \\ --internalurl \"http://$my_host:9292/v1\" \\ --adminurl \"http://$my_host:9292/v1\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | adminurl | http://192.168.77.50:9292/v1 | | id | 975ff2836b264e299c669372076666ee | | internalurl | http://192.168.77.50:9292/v1 | | publicurl | http://192.168.77.50:9292/v1 | | region | RegionOne | | service_id | 6afe8a067e2945fca023f85c7760ae53 | +-------------+----------------------------------+ # \u6dfb\u52a0nova\u7684endpoint keystone endpoint-create --region RegionOne \\ --service nova \\ --publicurl \"http://$my_host:\\$(compute_port)s/v2/\\$(tenant_id)s\" \\ --internalurl \"http://$my_host:\\$(compute_port)s/v2/\\$(tenant_id)s\" \\ --adminurl \"http://$my_host:\\$(compute_port)s/v2/\\$(tenant_id)s\" +-------------+--------------------------------------------------------+ | Property | Value | +-------------+--------------------------------------------------------+ | adminurl | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | | id | 194b7ddd24c94a0ebf79cd7275478dfc | | internalurl | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | | publicurl | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | | region | RegionOne | | service_id | 80edb3d3914644c4b0570fd8d8dabdaa | +-------------+--------------------------------------------------------+ [root@controller0 ~]# keystone endpoint-list +----------------------------------+-----------+--------------------------------------------------------+--------------------------------------------------------+--------------------------------------------------------+----------------------------------+ | id | region | publicurl | internalurl | adminurl | service_id | +----------------------------------+-----------+--------------------------------------------------------+--------------------------------------------------------+--------------------------------------------------------+----------------------------------+ | 09c263fa9b3c4a58bcead0b2f5aba1a1 | RegionOne | http://192.168.77.50:$(public_port)s/v2.0 | http://192.168.77.50:$(public_port)s/v2.0 | http://192.168.77.50:$(admin_port)s/v2.0 | b3ea5d31edce4c10b3b4c18359de0d09 | | 194b7ddd24c94a0ebf79cd7275478dfc | RegionOne | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | http://192.168.77.50:$(compute_port)s/v2/$(tenant_id)s | 80edb3d3914644c4b0570fd8d8dabdaa | | 975ff2836b264e299c669372076666ee | RegionOne | http://192.168.77.50:9292/v1 | http://192.168.77.50:9292/v1 | http://192.168.77.50:9292/v1 | 6afe8a067e2945fca023f85c7760ae53 | +----------------------------------+-----------+--------------------------------------------------------+--------------------------------------------------------+--------------------------------------------------------+----------------------------------+","title":"\u6dfb\u52a0\u7528\u6237\u3001\u89d2\u8272\u3001\u670d\u52a1\u4e0eendpoint"},{"location":"inthecloud/appendix01/#glance","text":"","title":"\u914d\u7f6eGlance"},{"location":"inthecloud/appendix01/#glance_1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # \u5b89\u88c5glance [root@controller0 ~]# yum install -y openstack-glance # \u521d\u59cb\u5316\u6570\u636e\u5e93 [root@controller0 ~]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 16 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database glance; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on glance.* to glance@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on glance.* to glance@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye","title":"\u521d\u59cb\u5316glance"},{"location":"inthecloud/appendix01/#glance_2","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 [root@controller0 ~]# vi /etc/glance/glance-registry.conf # line 165: database connection=mysql://glance:password@localhost/glance # line 245: \u6dfb\u52a0keystone\u8ba4\u8bc1\u4fe1\u606f [keystone_authtoken] identity_uri=http://192.168.77.50:35357 admin_tenant_name=service admin_user=glance admin_password=servicepassword # line 259: paste_deploy flavor=keystone [root@controller0 ~]# vi /etc/glance/glance-api.conf # line 240: \u4fee\u6539rabbit\u7528\u6237\u5bc6\u7801 rabbit_userid=guest rabbit_password=password # line 339: database connection=mysql://glance:password@localhost/glance # line 433: \u6dfb\u52a0keystone\u8ba4\u8bc1\u4fe1\u606f [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_tenant_name=service admin_user=glance admin_password=servicepassword revocation_cache_time=10 # line 448: paste_deploy flavor=keystone [root@controller0 ~]# glance-manage db_sync # \u5220\u9664\u65e5\u5fd7\u6587\u4ef6\u5e76\u542f\u52a8\uff0c\u5426\u5219\u53ef\u80fd\u56e0\u4e3alog\u6587\u4ef6\u6743\u9650\u95ee\u9898\u800c\u62a5\u9519 [root@controller0 ~]# rm /var/log/glance/api.log [root@controller0 ~]# for service in api registry; do systemctl start openstack-glance-$service systemctl enable openstack-glance-$service done","title":"\u914d\u7f6eglance"},{"location":"inthecloud/appendix01/#nova","text":"","title":"\u914d\u7f6eNova"},{"location":"inthecloud/appendix01/#nova_1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 [root@controller0 ~]# yum install -y openstack-nova [root@controller0 ~]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 18 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database nova; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on nova.* to nova@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on nova.* to nova@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye","title":"\u521d\u59cb\u5316nova"},{"location":"inthecloud/appendix01/#nova_2","text":"\u57fa\u672c\u914d\u7f6e\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 [root@controller0 ~]# mv /etc/nova/nova.conf /etc/nova/nova.conf.org [root@controller0 ~]# vi /etc/nova/nova.conf # \u65b0\u5efa\u4ee5\u4e0b\u5185\u5bb9 [DEFAULT] # RabbitMQ\u670d\u52a1\u4fe1\u606f rabbit_host=192.168.77.50 rabbit_port=5672 rabbit_userid=guest rabbit_password=password notification_driver=nova.openstack.common.notifier.rpc_notifier rpc_backend=rabbit # \u672c\u8ba1\u7b97\u8282\u70b9IP my_ip=192.168.77.50 # \u662f\u5426\u652f\u6301ipv6 use_ipv6=false state_path=/var/lib/nova enabled_apis=ec2,osapi_compute,metadata osapi_compute_listen=0.0.0.0 osapi_compute_listen_port=8774 rootwrap_config=/etc/nova/rootwrap.conf api_paste_config=api-paste.ini auth_strategy=keystone lock_path=/var/lib/nova/tmp log_dir=/var/log/nova # Memcached\u670d\u52a1\u4fe1\u606f memcached_servers=192.168.77.50:11211 scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler [glance] # Glance\u670d\u52a1\u4fe1\u606f host=192.168.77.50 port=9292 protocol=http [database] # connection info for MariaDB connection=mysql://nova:password@localhost/nova [keystone_authtoken] # Keystone server's hostname or IP auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_user=nova # Nova user's password added in Keystone admin_password=servicepassword admin_tenant_name=service signing_dir=/var/lib/nova/keystone-signing [root@controller0 ~]# chmod 640 /etc/nova/nova.conf [root@controller0 ~]# chgrp nova /etc/nova/nova.conf \u63a5\u4e0b\u6765\u914d\u7f6enetwork\u670d\u52a1\uff0c\u867d\u7136nova-network\u5e76\u4e0d\u662f\u5b98\u65b9\u63a8\u8350\u7684\u914d\u7f6e\uff0c\u4f46\u662f\u5b83\u914d\u7f6e\u8f83\u4e3a\u7b80\u5355\uff0c\u6240\u4ee5\u5728\u6b64\u4ecd\u7136\u5199\u51fa\uff0c\u53ef\u5f85\u540e\u6765 {ref} neutron \u65f6\u518d\u4fee\u6539\u6216\u5219\u76f4\u63a5\u7565\u8fc7\uff08\u6ce8\u610f\u670d\u52a1\u4ee5\u53ca\u914d\u7f6e\u6587\u4ef6\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 [root@controller0 ~]# vi /etc/nova/nova.conf # \u5728DEFAULT\u6bb5\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9 # nova-network network_driver=nova.network.linux_net libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtGenericVIFDriver linuxnet_interface_driver=nova.network.linux_net.LinuxBridgeInterfaceDriver firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver network_api_class=nova.network.api.API security_group_api=nova network_manager=nova.network.manager.FlatDHCPManager network_size=254 allow_same_net_traffic=False multi_host=True send_arp_for_ha=True share_dhcp_address=True force_dhcp_release=True # \u6307\u5b9apublic\u7f51\u7edc\u63a5\u53e3 public_interface=eno16777736 # \u4efb\u610f\u6865\u63a5\u63a5\u53e3 flat_network_bridge=br100 # \u521b\u5efadummy\u63a5\u53e3 flat_interface=dummy0 # \u6dfb\u52a0\u7528\u4e8eflat-DHCP\u7684\u865a\u62df\u63a5\u53e3 [root@controller0 ~]# cat > /etc/sysconfig/network-scripts/ifcfg-dummy0 <<EOF DEVICE=dummy0 BOOTPROTO=none ONBOOT=yes TYPE=Ethernet NM_CONTROLLED=no EOF # \u52a0\u8f7ddummy\u6a21\u5757\uff0c\u7528\u4e8e\u865a\u62df\u673a\u5185\u7f51\u6d41\u91cf\u8def\u7531 [root@controller0 ~]# echo \"alias dummy0 dummy\" > /etc/modprobe.d/dummy.conf [root@controller0 ~]# ifconfig dummy0 up \u542f\u7528\u670d\u52a1\uff0c\u5982\u679c\u6ca1\u7528\u4f7f\u7528nova-network\uff0c\u8bf7\u5ffd\u7565\u6570\u7ec4\u4e2d\u7684network 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 [root@controller0 ~]# nova-manage db sync [root@controller0 ~]# for service in api objectstore conductor scheduler cert consoleauth compute network; do systemctl start openstack-nova-$service systemctl enable openstack-nova-$service done [root@controller0 ~]# nova service-list +----+------------------+-------------+----------+---------+-------+----------------------------+-----------------+ | Id | Binary | Host | Zone | Status | State | Updated_at | Disabled Reason | +----+------------------+-------------+----------+---------+-------+----------------------------+-----------------+ | 1 | nova-conductor | controller0 | internal | enabled | up | 2015-06-19T01:40:07.000000 | - | | 2 | nova-scheduler | controller0 | internal | enabled | up | 2015-06-19T01:40:08.000000 | - | | 3 | nova-cert | controller0 | internal | enabled | up | 2015-06-19T01:40:10.000000 | - | | 4 | nova-consoleauth | controller0 | internal | enabled | up | 2015-06-19T01:40:11.000000 | - | | 5 | nova-compute | controller0 | nova | enabled | up | 2015-06-19T01:40:14.000000 | - | | 6 | nova-network | controller0 | internal | enabled | up | 2015-06-19T01:40:15.000000 | - | +----+------------------+-------------+----------+---------+-------+----------------------------+-----------------+","title":"\u914d\u7f6enova"},{"location":"inthecloud/appendix01/#_5","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # \u4ee5admin\u7528\u6237\u8ba4\u8bc1 [root@controller0 ~]# cat ~/admin_keystone export OS_USERNAME=admin export OS_PASSWORD=admin export OS_TENANT_NAME=admin export OS_AUTH_URL=http://192.168.77.50:35357/v2.0/ export PS1='[\\u@\\h \\W(keystone)]\\$ ' [root@controller0 ~]# source ~/admin_keystone # \u5982\u679c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8bf4\u660e\u8ba4\u8bc1\u6210\u529f\uff0c\u5426\u5219\u8bf7\u68c0\u67e5\u5176\u914d\u7f6e\u6587\u4ef6 [root@controller0 ~(keystone)]# glance image-list +----+------+-------------+------------------+------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +----+------+-------------+------------------+------+--------+ +----+------+-------------+------------------+------+--------+ \u5bfc\u5165\u4e4b\u524d\u5df2\u7ecf\u521b\u5efa\u597d\u7684\u955c\u50cf\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 [root@controller0 ~(keystone)]# glance image-create --name=\"centos7\" --is-public=true --disk-format=qcow2 --container-format=bare < rhel7.0.qcow2 +------------------+--------------------------------------+ | Property | Value | +------------------+--------------------------------------+ | checksum | 0ffb6f101c28af38804f79287f15e7e9 | | container_format | bare | | created_at | 2015-06-18T09:34:50.000000 | | deleted | False | | deleted_at | None | | disk_format | qcow2 | | id | 7f1f376c-0dff-44a3-87e8-d13883f795fc | | is_public | True | | min_disk | 0 | | min_ram | 0 | | name | centos7 | | owner | c0c4e7b797bb41798202b55872fba074 | | protected | False | | size | 21478375424 | | status | active | | updated_at | 2015-06-18T09:41:28.000000 | | virtual_size | None | +------------------+--------------------------------------+ [root@controller0 ~(keystone)]# glance image-list +--------------------------------------+---------+-------------+------------------+-------------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +--------------------------------------+---------+-------------+------------------+-------------+--------+ | 7f1f376c-0dff-44a3-87e8-d13883f795fc | centos7 | qcow2 | bare | 21478375424 | active | +--------------------------------------+---------+-------------+------------------+-------------+--------+","title":"\u6dfb\u52a0\u955c\u50cf"},{"location":"inthecloud/appendix01/#nova-network","text":"\u5982\u679c\u4f7f\u7528nova-network\u8bf7\u53c2\u8003\u6b64\u5904\uff0c\u5426\u5219\u8bf7\u5ffd\u7565\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 # \u4ee5admin\u7528\u6237\u8ba4\u8bc1 [root@controller0 ~]# cat ~/admin_keystone export OS_USERNAME=admin export OS_PASSWORD=admin export OS_TENANT_NAME=admin export OS_AUTH_URL=http://192.168.77.50:35357/v2.0/ export PS1='[\\u@\\h \\W(keystone)]\\$ ' [root@controller0 ~]# source ~/admin_keystone # \u521b\u5efa\u5b9e\u4f8b\u7684\u5185\u7f51 [root@controller0 ~(keystone)]# nova-manage network create --label neutron01 --dns1 10.0.0.1 --fixed_range_v4=10.1.0.0/24 [root@controller0 ~(keystone)]# nova-manage network list id IPv4 IPv6 start address DNS1 DNS2 VlanID project uuid 1 10.1.0.0/24 None 10.1.0.2 10.0.0.1 None None None d5bac5d4-7d1f-49ea-98d7-ea9039e75740 # \u5efa\u7acb\u5b89\u5168\u89c4\u5219 # \u5141\u8bb8ssh\u8bbf\u95ee [root@controller0 ~(keystone)]# nova secgroup-add-rule default tcp 22 22 0.0.0.0/0 +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | tcp | 22 | 22 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ # \u5141\u8bb8ping [root@controller0 ~(keystone)]# nova secgroup-add-rule default icmp -1 -1 0.0.0.0/0 +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | icmp | -1 | -1 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ [root@controller0 ~(keystone)]# nova secgroup-list-rules default +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | tcp | 22 | 22 | 0.0.0.0/0 | | | icmp | -1 | -1 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ # \u5141\u8bb8\u865a\u62df\u673a\u542f\u52a8\u65f6\u4f7f\u7528floating-ip [root@controller0 ~(keystone)]# vi /etc/nova/nova.conf # \u5728DEFAULT\u6bb5\u4e2d\u6dfb\u52a0 auto_assign_floating_ip=true # \u91cd\u542fnova-network [root@controller0 ~(keystone)]# systemctl restart openstack-nova-network # \u6307\u5b9a10.0.0.0/24\u4e2d\u76845\u4e2aIP\u7528\u4e8efloating-ip\u7ed9\u865a\u62df\u673a\u4f7f\u7528 [root@controller0 ~(keystone)]# nova-manage floating create --ip_range=10.0.0.248/29 [root@controller0 ~(keystone)]# nova-manage floating list None 10.0.0.249 None nova eno16777736 None 10.0.0.250 None nova eno16777736 None 10.0.0.251 None nova eno16777736 None 10.0.0.252 None nova eno16777736 None 10.0.0.253 None nova eno16777736 None 10.0.0.254 None nova eno16777736 # \u6d4b\u8bd5\u542f\u52a8 [root@controller0 ~(keystone)]# nova boot --flavor 2 --image centos7iso --security_group default centos7iso +--------------------------------------+---------------------------------------------------+ | Property | Value | +--------------------------------------+---------------------------------------------------+ | OS-DCF:diskConfig | MANUAL | | OS-EXT-AZ:availability_zone | nova | | OS-EXT-SRV-ATTR:host | - | | OS-EXT-SRV-ATTR:hypervisor_hostname | - | | OS-EXT-SRV-ATTR:instance_name | instance-00000003 | | OS-EXT-STS:power_state | 0 | | OS-EXT-STS:task_state | scheduling | | OS-EXT-STS:vm_state | building | | OS-SRV-USG:launched_at | - | | OS-SRV-USG:terminated_at | - | | accessIPv4 | | | accessIPv6 | | | adminPass | 3qF4JPhERims | | config_drive | | | created | 2015-06-19T03:47:15Z | | flavor | m1.small (2) | | hostId | | | id | a0cae25e-4629-48da-a054-99aed02baff9 | | image | centos7iso (d8d93d5f-56cf-4ce6-a2d1-f856fca529e2) | | key_name | - | | metadata | {} | | name | centos7iso | | os-extended-volumes:volumes_attached | [] | | progress | 0 | | security_groups | default | | status | BUILD | | tenant_id | c0c4e7b797bb41798202b55872fba074 | | updated | 2015-06-19T03:47:15Z | | user_id | cf11b4425218431991f095c2f58578a0 | +--------------------------------------+---------------------------------------------------+ [root@controller0 ~(keystone)]# nova list +--------------------------------------+------------+--------+------------+-------------+-------------------------------+ | ID | Name | Status | Task State | Power State | Networks | +--------------------------------------+------------+--------+------------+-------------+-------------------------------+ | a0cae25e-4629-48da-a054-99aed02baff9 | centos7iso | BUILD | spawning | NOSTATE | neutron01=10.1.0.2, 10.0.0.249| +--------------------------------------+------------+--------+------------+-------------+-------------------------------+ # \u6dfb\u52a0\u53e6\u4e00\u4e2afloating-ip [root@controller0 ~(keystone)]# nova add-floating-ip centos7iso 10.0.0.250 [root@controller0 ~(keystone)]# nova list +--------------------------------------+------------+--------+------------+-------------+--------------------------------------------+ | ID | Name | Status | Task State | Power State | Networks | +--------------------------------------+------------+--------+------------+-------------+--------------------------------------------+ | a0cae25e-4629-48da-a054-99aed02baff9 | centos7iso | BUILD | spawning | NOSTATE | neutron01=10.1.0.2, 10.0.0.249, 10.0.0.250 | +--------------------------------------+------------+--------+------------+-------------+--------------------------------------------+","title":"\u914d\u7f6eNova Network\uff08\u53ef\u9009\uff09"},{"location":"inthecloud/appendix01/#horizon","text":"\u6dfb\u52a0web\u754c\u9762\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # \u5b89\u88c5\u5fc5\u9700\u5305 [root@controller0 ~(keystone)]# yum --enablerepo=openstack-juno,epel -y install openstack-dashboard openstack-nova-novncproxy # \u914d\u7f6evnc [root@controller0 ~(keystone)]# vi /etc/nova/nova.conf # \u4e8eDEFAULT\u6bb5\u4e2d\u6dfb\u52a0 vnc_enabled=true novncproxy_host=0.0.0.0 novncproxy_port=6080 # replace the IP address to your own IP novncproxy_base_url=http://192.168.77.50:6080/vnc_auto.html vncserver_listen=192.168.77.50 vncserver_proxyclient_address=192.168.77.50 # \u4f7f\u80fddashboard [root@controller0 ~(keystone)]# vi /etc/openstack-dashboard/local_settings # line 15: \u5141\u8bb8\u6240\u6709\u4eba\u8bbf\u95ee ALLOWED_HOSTS = ['*'] # line 134: OPENSTACK_HOST = \"192.168.77.50\" # \u542f\u7528\u670d\u52a1 [root@controller0 ~(keystone)]# systemctl start openstack-nova-novncproxy [root@controller0 ~(keystone)]# systemctl restart openstack-nova-compute [root@controller0 ~(keystone)]# systemctl restart httpd [root@controller0 ~(keystone)]# systemctl enable openstack-nova-novncproxy [root@controller0 ~(keystone)]# systemctl enable httpd","title":"\u914d\u7f6eHorizon"},{"location":"inthecloud/appendix01/#_6","text":"\u73b0\u5728\u5f00\u59cb\u52a0\u5165\u7b2c\u4e8c\u4e2a\u8ba1\u7b97\u8282\u70b9compute0\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 # \u5b89\u88c5\u5fc5\u9700\u5305 [root@compute0 ~]# yum install -y openstack-nova-compute openstack-nova-api openstack-nova-network # \u914d\u7f6enova [root@compute0 ~]# mv /etc/nova/nova.conf /etc/nova/nova.conf.org [root@compute0 ~]# vi /etc/nova/nova.conf [DEFAULT] rabbit_host=192.168.77.50 rabbit_port=5672 rabbit_userid=guest rabbit_password=password notification_driver=nova.openstack.common.notifier.rpc_notifier rpc_backend=rabbit my_ip=192.168.77.51 use_ipv6=false state_path=/var/lib/nova enabled_apis=ec2,osapi_compute,metadata osapi_compute_listen=0.0.0.0 osapi_compute_listen_port=8774 rootwrap_config=/etc/nova/rootwrap.conf api_paste_config=api-paste.ini auth_strategy=keystone lock_path=/var/lib/nova/tmp log_dir=/var/log/nova memcached_servers=192.168.77.50:11211 scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler [glance] host=192.168.77.50 port=9292 protocol=http [database] connection=mysql://nova:password@192.168.77.50/nova [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_user=nova # Nova user's password added in Keystone admin_password=servicepassword admin_tenant_name=service signing_dir=/var/lib/nova/keystone-signing [root@compute0 ~]# chmod 640 /etc/nova/nova.conf [root@compute0 ~]# chgrp nova /etc/nova/nova.conf \u914d\u7f6enova-network\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 [root@controller0 ~]# vi /etc/nova/nova.conf # \u5728DEFAULT\u6bb5\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9 # nova-network network_driver=nova.network.linux_net libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtGenericVIFDriver linuxnet_interface_driver=nova.network.linux_net.LinuxBridgeInterfaceDriver firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver network_api_class=nova.network.api.API security_group_api=nova network_manager=nova.network.manager.FlatDHCPManager network_size=254 allow_same_net_traffic=False multi_host=True send_arp_for_ha=True share_dhcp_address=True force_dhcp_release=True # \u6307\u5b9apublic\u7f51\u7edc\u63a5\u53e3 public_interface=eno16777736 # \u4efb\u610f\u6865\u63a5\u63a5\u53e3 flat_network_bridge=br100 # \u521b\u5efadummy\u63a5\u53e3 flat_interface=dummy0 # \u5982\u679c\u9700\u8981\u81ea\u52a8floating-ip auto_assign_floating_ip=true \u542f\u52a8\u670d\u52a1\uff0c\u5982\u679c\u4e0d\u9700\u8981nova-network\u8bf7\u540c\u6837\u7701\u7565\u6570\u7ec4\u4e2d\u7684network\uff1a 1 2 3 4 5 6 7 8 9 10 11 [root@compute0 ~]# for service in metadata-api compute network; do systemctl start openstack-nova-$service; systemctl enable openstack-nova-$service; done [root@compute0 ~]# nova-manage service list Binary Host Zone Status State Updated_At nova-conductor controller0 internal enabled :-) 2015-06-19 05:31:48 nova-scheduler controller0 internal enabled :-) 2015-06-19 05:31:48 nova-cert controller0 internal enabled :-) 2015-06-19 05:31:51 nova-consoleauth controller0 internal enabled :-) 2015-06-19 05:31:52 nova-compute controller0 nova enabled :-) 2015-06-19 05:31:45 nova-network controller0 internal enabled :-) 2015-06-19 05:31:44 nova-compute compute0 nova enabled :-) 2015-06-19 05:31:50 nova-network compute0 internal enabled :-) 2015-06-19 05:31:51 (id14)=","title":"\u6dfb\u52a0\u8ba1\u7b97\u8282\u70b9"},{"location":"inthecloud/appendix01/#neutron_1","text":"\u5982\u679c\u5df2\u7ecf\u5b89\u88c5\u4e0a\u9762\u7684\u987a\u5e8f\uff08\u6392\u9664nova-networking\uff09\u914d\u7f6e\u4e0b\u6765\uff0c\u73b0\u5728\u5e94\u8be5\u6709\u4e24\u4e2a\u8ba1\u7b97\u8282\u70b9\u4e86\u3002 \u90a3\u4e48\u6211\u4eec\u7684\u914d\u7f6e\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 +------------------+ | +------------------------+ | [ contoller0 ] | | | [ neutron0 ] | | Keystone |192.168.77.50 | 192.168.77.30| DHCP Agent | | Glance |---------------+---------------| L3 Agent | | Nova API |eth0 | eth0| L2 Agent | | Neutron Server | | | Metadata Agent | | Nova Compute | | +------------------------+ +------------------+ | eth0|192.168.77.51 +--------------------+ | [ compute0 ] | | Nova Compute | | L2 Agent | +--------------------+","title":"\u914d\u7f6eNeutron\uff08\u63a8\u8350\uff09"},{"location":"inthecloud/appendix01/#controller0","text":"\u5b89\u88c5neutron neutron\u4f9d\u8d56\u4e8e\u5404\u79cd\u63d2\u4ef6\uff08openvswitch\u3001linuxbridge\u7b49\uff09\uff0c\u6211\u4eec\u5728\u6b64\u4f7f\u7528openvswitch\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 # \u5b89\u88c5neutron [root@controller0 ~(keystone)]# yum install -y openstack-neutron openstack-neutron-ml2 # \u521d\u59cb\u5316\u6570\u636e\u5e93 [root@controller0 ~(keystone)]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 14 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database neutron_ml2; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on neutron_ml2.* to neutron@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on neutron_ml2.* to neutron@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye # \u521b\u5efaneutron\u670d\u52a1 [root@controller0 ~(keystone)]# keystone user-create --tenant service --name neutron --pass servicepassword --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | 6dafe1f763de44778fa9c4848da7d20f | | name | neutron | | tenantId | 9acf83020ae34047b6f1e320c352ae44 | | username | neutron | +----------+----------------------------------+ [root@controller0 ~(keystone)]# keystone user-role-add --user neutron --tenant service --role admin [root@controller0 ~(keystone)]# keystone service-create --name=neutron --type=network --description=\"Neutron Network Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Neutron Network Service | | enabled | True | | id | 534492ae3d48407bb3b2a90607f43461 | | name | neutron | | type | network | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# export neutron_server=192.168.77.50 [root@controller0 ~(keystone)]# keystone endpoint-create --region RegionOne --service neutron --publicurl \"http://$neutron_server:9696/\" --internalurl \"http://$neutron_server:9696/\" --adminurl \"http://$neutron_server:9696/\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | adminurl | http://192.168.77.50:9696/ | | id | 74fd6b095c16452d97ffcb2b1fd0dad3 | | internalurl | http://192.168.77.50:9696/ | | publicurl | http://192.168.77.50:9696/ | | region | RegionOne | | service_id | 534492ae3d48407bb3b2a90607f43461 | +-------------+----------------------------------+ # \u914d\u7f6eneutron [root@controller0 ~(keystone)]# vi /etc/neutron/neutron.conf # [DEFAULT] # line 62: \u540e\u7aef\u63d2\u4ef6 core_plugin=ml2 # line 69: \u670d\u52a1\u63d2\u4ef6 service_plugins=router # line 84: \u8ba4\u8bc1\u65b9\u5f0f auth_strategy=keystone # line 110: \u53d6\u6d88\u6ce8\u91ca dhcp_agent_notification=True # line 339: \u63a7\u5236\u8282\u70b9\u7684nova\u7aef nova_url=http://192.168.77.50:8774/v2 # line 345: nova\u7528\u6237\u540d nova_admin_username=nova # line 348: service\u7528\u6237\u7684tenant id(\u53ef\u4f7f\u7528keystone tenant-list\u67e5\u770b) nova_admin_tenant_id=9acf83020ae34047b6f1e320c352ae44 # line 357: nova\u7528\u6237\u7684service\u5bc6\u7801 nova_admin_password=servicepassword # line 360: keystone\u8ba4\u8bc1\u7aef nova_admin_auth_url=http://192.168.77.50:35357/v2.0 # [oslo_messaging_rabbit] # line 445: rabbitMQ\u670d\u52a1\u5668 rabbit_host=192.168.77.50 # line 449: rabbitMQ\u7aef\u53e3 rabbit_port=5672 # line 458: rabbitMQ\u7528\u6237\u4fe1\u606f rabbit_userid=guest rabbit_password=password # line 464: rpc\u540e\u7aef\uff0c\u53ef\u4eceAMQ\u6216\u8005RABBITMQ\u4e2d\u9009\u62e9 rpc_backend=rabbit # line 551: \u63a7\u5236\u4fe1\u606f\u4ea4\u6362\u683c\u5f0f control_exchange=neutron # line 688: keystone\u8ba4\u8bc1\u4fe1\u606f\uff0c\u7531\u4e8eauth_uri\u4ee5\u540e\u4f1a\u88abidentity_uri\u4ee3\u66ff\uff0c\u5e76\u4e14auth_host\u7b49\u4fe1\u606f\u4e5f\u4e0d\u5fc5\u8981\u4e86\uff0c\u4f46\u4e3a\u517c\u5bb9\u6027\u8d77\u89c1\uff0c\u6b64\u5904\u6211\u7ed9\u4e88\u4fdd\u7559 [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_tenant_name = service admin_user = neutron admin_password = servicepassword # line 708: \u6570\u636e\u5e93 connection = mysql://neutron:password@192.168.77.50/neutron_ml2 # \u914d\u7f6eml2\u63d2\u4ef6 [root@controller0 ~(keystone)]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 7: \u7f51\u7edc\u652f\u6301 type_drivers = flat,vlan,gre tenant_network_types = vlan,gre mechanism_drivers = openvswitch # line 93: \u542f\u7528\u5b89\u5168\u7ec4 enable_security_group = True firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver # \u914d\u7f6enova\u8282\u70b9\u4ee5\u652f\u6301neutron [root@controller0 ~(keystone)]# vi /etc/nova/nova.conf # add in the [DEFAULT] section # nova-network #network_driver=nova.network.linux_net #libvirt_vif_driver=nova.virt.libvirt.vif.LibvirtGenericVIFDriver #linuxnet_interface_driver=nova.network.linux_net.LinuxBridgeInterfaceDriver #firewall_driver=nova.virt.libvirt.firewall.IptablesFirewallDriver #network_api_class=nova.network.api.API #security_group_api=nova #network_manager=nova.network.manager.FlatDHCPManager #network_size=254 #allow_same_net_traffic=False #multi_host=True #send_arp_for_ha=True #share_dhcp_address=True #force_dhcp_release=True ## specify nic for public #public_interface=eno16777736 ## specify any name you like for bridge #flat_network_bridge=br100 ## specify nic for flat DHCP bridge #flat_interface=dummy0 #auto_assign_floating_ip=true # neutron-network network_api_class=nova.network.neutronv2.api.API security_group_api=neutron # \u5728\u672b\u5c3e\u6dfb\u52a0neutron\u7528\u6237\u8ba4\u8bc1\u4fe1\u606f [neutron] url = http://192.168.77.50:9696 auth_strategy = keystone admin_auth_url = http://192.168.77.50:35357/v2.0 admin_tenant_name = service admin_username = neutron admin_password = servicepassword [root@controller0 ~(keystone)]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini [root@controller0 ~(keystone)]# neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugin.ini upgrade head # \u542f\u7528neutron-server\u670d\u52a1\uff0c\u5982\u679c\u4e4b\u524d\u6709\u914d\u7f6enova-network\uff0c\u5728\u6b64\u9700\u7981\u7528 [root@controller0 ~(keystone)]# systemctl stop openstack-nova-network [root@controller0 ~(keystone)]# systemctl disable openstack-nova-network [root@controller0 ~(keystone)]# systemctl start neutron-server [root@controller0 ~(keystone)]# systemctl enable neutron-server [root@controller0 ~(keystone)]# systemctl restart openstack-nova-api","title":"\u63a7\u5236\u8282\u70b9controller0\u914d\u7f6e"},{"location":"inthecloud/appendix01/#neutron0","text":"\u5728\u8282\u70b9neutron0\u4e0a\uff0c\u6211\u4eec\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 # \u5b89\u88c5\u5fc5\u9700\u5305 [root@neutron0 ~]# yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch # \u6253\u5f00ip_forward [root@neutron0 ~]# echo 'net.ipv4.ip_forward=1' >> /etc/sysctl.conf [root@neutron0 ~]# echo 'net.ipv4.conf.default.rp_filter=0' >> /etc/sysctl.conf [root@neutron0 ~]# echo 'net.ipv4.conf.all.rp_filter=0' >> /etc/sysctl.conf [root@neutron0 ~]# sysctl -p # \u914d\u7f6eneutron [root@network ~]# vi /etc/neutron/neutron.conf # line 60 core_plugin=ml2 # line 69 service_plugins=router # line 84 auth_strategy=keystone # line 110 dhcp_agent_notification=True # line 444: rabbitMQ\u4fe1\u606f rabbit_host=192.168.77.50 # line 448 rabbit_port=5672 # line 457 rabbit_userid=guest # line 460 rabbit_password=password # line 545 rpc_backend=rabbit # line 550 control_exchange=neutron # line 687: keystone\u8ba4\u8bc1\u4fe1\u606f [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_tenant_name = service admin_user = neutron admin_password = servicepassword # \u914d\u7f6e\u4e09\u5c42\u4ea4\u6362\u4ee3\u7406 [root@neutron0 ~]# vi /etc/neutron/l3_agent.ini # line 19: uncomment interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver # line 25: uncomment use_namespaces = True # line 63: add (it's OK to keep value empty (set it if needed)) external_network_bridge = # \u914d\u7f6edhcp\u4ee3\u7406 [root@neutron0 ~]# vi /etc/neutron/dhcp_agent.ini # line 27: uncomment interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver # line 31: uncomment dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq # line 37: uncomment use_namespaces = True # \u914d\u7f6e\u5143\u6570\u636e\u4ee3\u7406 [root@neutron0 ~]# vi /etc/neutron/metadata_agent.ini # line 6: change (specify endpoint of keystone) auth_url = http://192.168.77.50:35357/v2.0 # line 12: change (auth info ofr keystone) admin_tenant_name = service admin_user = neutron admin_password = servicepassword # line 20: uncomment and specify Nova API server nova_metadata_ip = 10.0.0.30 # line 23: uncomment nova_metadata_port = 8775 # line 43: uncomment and specify any secret key you like metadata_proxy_shared_secret = metadata_secret # \u914d\u7f6eml2 [root@neutron0 ~]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 7: add type_drivers = flat,vlan,gre tenant_network_types = vlan,gre mechanism_drivers = openvswitch # line 92: uncomment and add enable_security_group = True firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver [root@neutron0 ~]# mv /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini.org [root@neutron0 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini [root@neutron0 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini [root@neutron0 ~]# systemctl start openvswitch [root@neutron0 ~]# systemctl enable openvswitch [root@neutron0 ~]# ovs-vsctl add-br br-int [root@neutron0 ~]# for service in dhcp-agent l3-agent metadata-agent openvswitch-agent; do systemctl start neutron-$service systemctl enable neutron-$service done","title":"\u7f51\u7edc\u8282\u70b9neutron0\u914d\u7f6e"},{"location":"inthecloud/appendix01/#compute0","text":"\u5728\u9664controller0\u7684\u53e6\u4e00\u4e2a\u8ba1\u7b97\u8282\u70b9compute0\u4e0a\uff0c\u6211\u4eec\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 # \u5b89\u88c5\u5fc5\u9700\u5305 [root@compute0 ~]# yum install -y openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch # \u8c03\u8282rp_filter [root@compute0 ~]# echo 'net.ipv4.conf.default.rp_filter=0' >> /etc/sysctl.conf [root@compute0 ~]# echo 'net.ipv4.conf.all.rp_filter=0' >> /etc/sysctl.conf [root@compute0 ~]# sysctl -p # \u914d\u7f6eneutron [root@compute0 ~]# vi /etc/neutron/neutron.conf # line 60 core_plugin=ml2 # line 69 service_plugins=router # line 84 auth_strategy=keystone # line 110 dhcp_agent_notification=True # line 444: rabbitMQ\u4fe1\u606f rabbit_host=192.168.77.50 # line 448 rabbit_port=5672 # line 457 rabbit_userid=guest # line 460 rabbit_password=password # line 545 rpc_backend=rabbit # line 550 control_exchange=neutron # line 687: keystone\u8ba4\u8bc1\u4fe1\u606f [keystone_authtoken] auth_uri = http://192.168.77.50:35357/v2.0 identity_uri=http://192.168.77.50:5000 admin_tenant_name = service admin_user = neutron admin_password = servicepassword [root@compute0 ~]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 7: add type_drivers = flat,vlan,gre tenant_network_types = vlan,gre mechanism_drivers = openvswitch # line 69: uncomment and add enable_security_group = True firewall_driver = neutron.agent.linux.iptables_firewall.OVSHybridIptablesFirewallDriver [root@compute0 ~]# mv /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini.org [root@compute0 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini [root@compute0 ~]# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugins/openvswitch/ovs_neutron_plugin.ini # \u914d\u7f6enova [root@compute0 ~]# vi /etc/nova/nova.conf # add in the [DEFAULT] section linuxnet_interface_driver=nova.network.linux_net.LinuxOVSInterfaceDriver firewall_driver=nova.virt.firewall.NoopFirewallDriver network_api_class=nova.network.neutronv2.api.API security_group_api=neutron # specify the Neutron endpoint neutron_url=http://192.168.77.50:9696 # specify the auth info for keystone neutron_auth_strategy=keystone neutron_admin_tenant_name=service neutron_admin_username=neutron neutron_admin_password=servicepassword neutron_admin_auth_url=http://192.168.77.50:35357/v2.0 metadata_listen=0.0.0.0 # specify the Control node metadata_host=192.168.77.50 service_neutron_metadata_proxy=True # specify the metadata secret key (it is just the value you set in the Network node) neutron_metadata_proxy_shared_secret=metadata_secret vif_plugging_is_fatal=false vif_plugging_timeout=0 # \u542f\u7528\u670d\u52a1\uff0c\u5982\u679c\u4e4b\u524d\u6709\u914d\u7f6enova-network\uff0c\u5728\u6b64\u9700\u7981\u7528 [root@compute0 ~]# systemctl stop openstack-nova-network [root@compute0 ~]# systemctl disable openstack-nova-network [root@compute0 ~]# systemctl start openvswitch [root@compute0 ~]# systemctl enable openvswitch [root@compute0 ~]# ovs-vsctl add-br br-int [root@compute0 ~]# systemctl restart openstack-nova-compute [root@compute0 ~]# systemctl restart openstack-nova-metadata-api [root@compute0 ~]# systemctl start neutron-openvswitch-agent [root@compute0 ~]# systemctl enable neutron-openvswitch-agent","title":"\u8ba1\u7b97\u8282\u70b9compute0\u914d\u7f6e"},{"location":"inthecloud/appendix01/#neutron_2","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 +-------------+ +----+----+ | Name Server | | Gateway | +------+------+ +----+----+ |192.168.77.2 |192.168.77.2 | | +--------------+-----------------+------------------------+ | | | | | | | |192.168.77.200-192.168.77.254 eth0|192.168.77.50 | 192.168.77.30| eth0 +--------+-------+ +--------+---------+ | +-----------+----------+ | Virtual Router | | [ controller0 ] | | | [ neutron0 ] | +--------+-------+ | Keystone | | | DHCP Agent | 192.168.100.1 | Glance | | eth2| L3 Agent |eth1 | 192.168.100.0/24 | Nova API | | | L2 Agent | | +-----------------+ | Neutron Server | | | Metadata Agent | | +---| Virtual Machine | +------------------+ | +----------------------+ | | +-----------------+ | | | +-----------------+ | +----------------------+ +-------+---| Virtual Machine | | eth0| [ compute0 ] |eth1 | +-----------------+ +-----| Nova Compute | | +-----------------+ 192.168.77.51| L2 Agent | |---| Virtual Machine | +----------------------+ +-----------------+ \u5176\u4e2d\uff0ccontroller0\u3001compute0\u90fd\u6709\u4e24\u4e2a\u7269\u7406\u7f51\u53e3\uff0cneutron0\u6709\u4e09\u4e2a\u7269\u7406\u7f51\u53e3\u3002 \u4fee\u6539\u63a7\u5236\u8282\u70b9\u914d\u7f6e\uff1a 1 2 3 4 5 6 7 8 9 [root@controller0 ~(keystone)]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 64 [ml2_type_vlan] network_vlan_ranges = physnet1:1000:2999 # \u672b\u5c3e\u6dfb\u52a0 [ovs] tenant_network_type = vlan bridge_mappings = physnet1:br-eth1 [root@controller0 ~(keystone)]# systemctl restart neutron-server \u5728\u7f51\u7edc\u8282\u70b9\u548c\u8ba1\u7b97\u8282\u70b9\u540c\u65f6\u6dfb\u52a0eth1\u4f5c\u5185\u7f51\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 # \u6dfb\u52a0\u4e00\u4e2a\u6865 [root@neutron0 ~]# ovs-vsctl add-br br-eth1 # \u5c06eno33554984\u7f51\u53e3\u9644\u52a0\u5230\u6865\uff0c\u5373\u5bf9\u5e94eth1 [root@neutron0 ~]# ovs-vsctl add-port br-eth1 eno33554984 [root@neutron0 ~]# vi /etc/neutron/plugins/ml2/ml2_conf.ini # line 64 [ml2_type_vlan] network_vlan_ranges = physnet1:1000:2999 # \u672b\u5c3e\u6dfb\u52a0 [ovs] tenant_network_type = vlan bridge_mappings = physnet1:br-eth1 [root@neutron0 ~]# systemctl restart neutron-openvswitch-agent \u5728\u7f51\u7edc\u8282\u70b9\u6dfb\u52a0eth2\u4f5c\u5916\u7f51\uff1a 1 2 3 4 5 6 7 [root@neutron0 ~]# ovs-vsctl add-br br-ext # eno50332208\u5bf9\u5e94eth2 [root@neutron0 ~]# ovs-vsctl add-port br-ext eno50332208 [root@neutron0 ~]# vi /etc/neutron/l3_agent.ini # line 63 external_network_bridge = br-ext [root@neutron0 ~]# systemctl restart neutron-l3-agent \u5728\u4efb\u610f\u8282\u70b9\u4fee\u6539\uff08neutron\u7684\u914d\u7f6e\u5c5e\u4e8e\u96c6\u7fa4\u5168\u5c40\u914d\u7f6e\uff0c\u6b64\u5904\u5728\u63a7\u5236\u8282\u70b9\u4fee\u6539\uff0c\u5176\u4ed6\u8282\u70b9\u4e5f\u53ef\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 # create a virtual router [root@controller0 ~(keystone)]# neutron router-create router01 Created a new router: +-----------------------+--------------------------------------+ | Field | Value | +-----------------------+--------------------------------------+ | admin_state_up | True | | distributed | False | | external_gateway_info | | | ha | False | | id | 8bf0184c-1cd8-4993-b3e0-7be94aaf2757 | | name | router01 | | routes | | | status | ACTIVE | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +-----------------------+--------------------------------------+ [root@controller0 ~(keystone)]# Router_ID=`neutron router-list | grep router01 | awk '{ print $2 }'` # \u521b\u5efa\u5185\u7f51 [root@controller0 ~(keystone)]# neutron net-create int_net Created a new network: +---------------------------+--------------------------------------+ | Field | Value | +---------------------------+--------------------------------------+ | admin_state_up | True | | id | 532e391d-562d-4499-8dee-48ca31345466 | | mtu | 0 | | name | int_net | | provider:network_type | vlan | | provider:physical_network | physnet1 | | provider:segmentation_id | 1000 | | router:external | False | | shared | False | | status | ACTIVE | | subnets | | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +---------------------------+--------------------------------------+ # \u521b\u5efa\u5185\u7f51\u5b50\u7f51 [root@controller0 ~(keystone)]# neutron subnet-create --gateway 192.168.100.1 --dns-nameserver 192.168.77.2 int_net 192.168.100.0/24 Created a new subnet: +-------------------+------------------------------------------------------+ | Field | Value | +-------------------+------------------------------------------------------+ | allocation_pools | {\"start\": \"192.168.100.2\", \"end\": \"192.168.100.254\"} | | cidr | 192.168.100.0/24 | | dns_nameservers | 192.168.77.2 | | enable_dhcp | True | | gateway_ip | 192.168.100.1 | | host_routes | | | id | c08dcadf-f632-44b7-9a10-8a3a89c86853 | | ip_version | 4 | | ipv6_address_mode | | | ipv6_ra_mode | | | name | | | network_id | 532e391d-562d-4499-8dee-48ca31345466 | | subnetpool_id | | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +-------------------+------------------------------------------------------+ [root@controller0 ~(keystone)]# Int_Subnet_ID=`neutron net-list | grep int_net | awk '{ print $6 }'` # \u5c06\u5185\u7f51\u5b9e\u4f8b\u9644\u52a0\u5230\u8def\u7531 [root@controller0 ~(keystone)]# neutron router-interface-add $Router_ID $Int_Subnet_ID Added interface a2e9bedc-0505-45da-8f87-4a82928a6206 to router 8bf0184c-1cd8-4993-b3e0-7be94aaf2757. # \u521b\u5efa\u5916\u7f51 [root@controller0 ~(keystone)]# neutron net-create ext_net --router:external Created a new network: +---------------------------+--------------------------------------+ | Field | Value | +---------------------------+--------------------------------------+ | admin_state_up | True | | id | e041481d-f8b8-42a7-b87b-3d346167ef21 | | mtu | 0 | | name | ext_net | | provider:network_type | vlan | | provider:physical_network | physnet1 | | provider:segmentation_id | 1001 | | router:external | True | | shared | False | | status | ACTIVE | | subnets | | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +---------------------------+--------------------------------------+ # \u521b\u5efa\u5916\u7f51\u5b50\u7f51 [root@controller0 ~(keystone)]# neutron subnet-create ext_net --allocation-pool start=192.168.77.200,end=192.168.77.254 --gateway 192.168.77.2 --dns-nameserver 192.168.77.2 192.168.77.0/24 --disable-dhcp Created a new subnet: +-------------------+------------------------------------------------------+ | Field | Value | +-------------------+------------------------------------------------------+ | allocation_pools | {\"start\": \"192.168.77.200\", \"end\": \"192.168.77.254\"} | | cidr | 192.168.77.0/24 | | dns_nameservers | 192.168.77.2 | | enable_dhcp | False | | gateway_ip | 192.168.77.2 | | host_routes | | | id | 98f97e64-94d8-4743-b8a1-a715f2c07e08 | | ip_version | 4 | | ipv6_address_mode | | | ipv6_ra_mode | | | name | | | network_id | e041481d-f8b8-42a7-b87b-3d346167ef21 | | subnetpool_id | | | tenant_id | c0c4e7b797bb41798202b55872fba074 | +-------------------+------------------------------------------------------+ # \u5c06\u5916\u7f51\u5b9e\u4f8b\u9644\u52a0\u5230\u8def\u7531 [root@controller0 ~(keystone)]# Ext_Net_ID=`neutron net-list | grep ext_net | awk '{ print $2 }'` [root@controller0 ~(keystone)]# neutron router-gateway-set $Router_ID $Ext_Net_ID Set gateway for router 8bf0184c-1cd8-4993-b3e0-7be94aaf2757 # \u521b\u5efa\u5e76\u542f\u52a8\u865a\u62df\u673a [root@controller0 ~(keystone)]# Int_Net_ID=`neutron net-list | grep int_net | awk '{ print $2 }'` [root@controller0 ~(keystone)]# nova image-list +--------------------------------------+---------+--------+--------+ | ID | Name | Status | Server | +--------------------------------------+---------+--------+--------+ | 4a663fce-97eb-42d3-93d6-415e477bc0a4 | CentOS7 | ACTIVE | | +--------------------------------------+---------+--------+--------+ [root@controller0 ~(keystone)]# nova boot --flavor 2 --image CentOS7 --security_group default --nic net-id=$Int_Net_ID CentOS_70 [root@controller0 ~(keystone)]# nova list +-----------+-----------+--------+------------+-------------+-----------------------+ | ID | Name | Status | Task State | Power State | Networks | +-----------+-----------+--------+------------+-------------+-----------------------+ | 33bb9427- | CentOS_70 | ACTIVE | - | Running | int_net=192.168.100.2 | +-----------+-----------+--------+------------+-------------+-----------------------+ # \u6dfb\u52a0\u6d6e\u52a8IP [root@controller0 ~(keystone)]# neutron floatingip-create ext_net Created a new floatingip: +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | fixed_ip_address | | | floating_ip_address | 10.0.0.201 | | floating_network_id | bd216cab-c07b-4475-90ef-e9ad402bd57b | | id | da8eef0d-5bc8-488e-8fd4-0c6df1f5922a | | port_id | | | router_id | | | status | DOWN | | tenant_id | e8f6ac69de5f46afa189fcefd99c8a1a | +---------------------+--------------------------------------+ [root@controller0 ~(keystone)]# Device_ID=`nova list | grep CentOS_70 | awk '{ print $2 }'` [root@controller0 ~(keystone)]# Port_ID=`neutron port-list -- --device_id $Device_ID | grep 192.168.100.2 | awk '{ print $2 }'` [root@controller0 ~(keystone)]# Floating_ID=`neutron floatingip-list | grep 10.0.0.201 | awk '{ print $2 }'` [root@controller0 ~(keystone)]# neutron floatingip-associate $Floating_ID $Port_ID Associated floating IP da8eef0d-5bc8-488e-8fd4-0c6df1f5922a # confirm settings [root@controller0 ~(keystone)]# neutron floatingip-show $Floating_ID +---------------------+--------------------------------------+ | Field | Value | +---------------------+--------------------------------------+ | fixed_ip_address | 192.168.100.2 | | floating_ip_address | 10.0.0.201 | | floating_network_id | bd216cab-c07b-4475-90ef-e9ad402bd57b | | id | da8eef0d-5bc8-488e-8fd4-0c6df1f5922a | | port_id | d4f17f91-c4e9-45ec-af2d-223907e891ea | | router_id | a0d08cb3-bf96-4872-ab95-b24a697b080a | | status | ACTIVE | | tenant_id | e8f6ac69de5f46afa189fcefd99c8a1a | +---------------------+--------------------------------------+ # \u6dfb\u52a0\u5b89\u5168\u7ec4 # permit SSH [root@controller0 ~(keystone)]# nova secgroup-add-rule default tcp 22 22 0.0.0.0/0 +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | tcp | 22 | 22 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ # permit ICMP [root@controller0 ~(keystone)]# nova secgroup-add-rule default icmp -1 -1 0.0.0.0/0 +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | icmp | -1 | -1 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+ [root@controller0 ~(keystone)]# nova secgroup-list-rules default +-------------+-----------+---------+-----------+--------------+ | IP Protocol | From Port | To Port | IP Range | Source Group | +-------------+-----------+---------+-----------+--------------+ | tcp | 22 | 22 | 0.0.0.0/0 | | | icmp | -1 | -1 | 0.0.0.0/0 | | +-------------+-----------+---------+-----------+--------------+","title":"\u4f7f\u7528Neutron"},{"location":"inthecloud/appendix01/#cinder","text":"\u7ed3\u6784\u56fe\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 +------------------+ 192.168.77.60| [ cinder0 ] | +------------------+ +-----+ Cinder-Volume | | [ controller0 ] | | eth0| | | Keystone |192.168.77.50 | +------------------+ | Glance |---------------+ | Nova API |eth0 | +------------------+ | Cinder API | | eth0| [ compute0 ] | +------------------+ +-----+ Nova Compute | 192.168.77.51| | +------------------+ \u63a7\u5236\u8282\u70b9\u521d\u59cb\u5316Cinder\u4fe1\u606f\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 # \u5b89\u88c5Cinder\u670d\u52a1 [root@controller0 ~(keystone)]# yum install -y openstack-cinder # \u914d\u7f6ekeystone\uff0c\u6dfb\u52a0endpoint [root@controller0 ~(keystone)]# keystone user-create --tenant service --name cinder --pass servicepassword --enabled true +----------+----------------------------------+ | Property | Value | +----------+----------------------------------+ | email | | | enabled | True | | id | 6c6438aac109473d92ba22ed64ef7f4a | | name | cinder | | tenantId | 9acf83020ae34047b6f1e320c352ae44 | | username | cinder | +----------+----------------------------------+ [root@controller0 ~(keystone)]# keystone user-role-add --user cinder --tenant service --role admin [root@controller0 ~(keystone)]# keystone service-create --name=cinder --type=volume --description=\"Cinder Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Cinder Service | | enabled | True | | id | f9745ca8657f40d188a464c706d1d923 | | name | cinder | | type | volume | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# keystone service-create --name=cinderv2 --type=volumev2 --description=\"Cinder Service\" +-------------+----------------------------------+ | Property | Value | +-------------+----------------------------------+ | description | Cinder Service | | enabled | True | | id | b11416c99c274ed9872ed5eaffad83b7 | | name | cinderv2 | | type | volumev2 | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# export cinder_api=192.168.77.50 [root@controller0 ~(keystone)]# keystone endpoint-create --region RegionOne \\ --service cinder \\ --publicurl \"http://$cinder_api:8776/v1/\\$(tenant_id)s\" \\ --internalurl \"http://$cinder_api:8776/v1/\\$(tenant_id)s\" \\ --adminurl \"http://$cinder_api:8776/v1/\\$(tenant_id)s\" +-------------+--------------------------------------------+ | Property | Value | +-------------+--------------------------------------------+ | adminurl | http://192.168.77.50:8776/v1/$(tenant_id)s | | id | 073dafcb7ee049cb8bfd3ebbe149dbc0 | | internalurl | http://192.168.77.50:8776/v1/$(tenant_id)s | | publicurl | http://192.168.77.50:8776/v1/$(tenant_id)s | | region | RegionOne | | service_id | f9745ca8657f40d188a464c706d1d923 | +-------------+--------------------------------------------+ [root@controller0 ~(keystone)]# keystone endpoint-create --region RegionOne \\ --service cinderv2 \\ --publicurl \"http://$cinder_api:8776/v2/\\$(tenant_id)s\" \\ --internalurl \"http://$cinder_api:8776/v2/\\$(tenant_id)s\" \\ --adminurl \"http://$cinder_api:8776/v2/\\$(tenant_id)s\" +-------------+--------------------------------------------+ | Property | Value | +-------------+--------------------------------------------+ | adminurl | http://192.168.77.50:8776/v2/$(tenant_id)s | | id | 3f00de1ec9474183971ba3c1c0d35c7d | | internalurl | http://192.168.77.50:8776/v2/$(tenant_id)s | | publicurl | http://192.168.77.50:8776/v2/$(tenant_id)s | | region | RegionOne | | service_id | b11416c99c274ed9872ed5eaffad83b7 | +-------------+--------------------------------------------+ # \u6dfb\u52a0\u6570\u636e\u5e93 [root@controller0 ~(keystone)]# mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 16 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, Monty Program Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database cinder; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on cinder.* to cinder@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on cinder.* to cinder@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye # \u914d\u7f6ecinder\u53c2\u6570 [root@controller0 ~(keystone)]# mv /etc/cinder/cinder.conf /etc/cinder/cinder.conf.org [root@controller0 ~(keystone)]# vi /etc/cinder/cinder.conf [DEFAULT] state_path=/var/lib/cinder api_paste_config=api-paste.ini enable_v1_api=true rootwrap_config=/etc/cinder/rootwrap.conf auth_strategy=keystone # specify RabbitMQ server rabbit_host=192.168.77.50 rabbit_port=5672 # specify RabbitMQ user for auth rabbit_userid=guest # specify RabbitMQ user's password above rabbit_password=password rpc_backend=rabbit scheduler_driver=cinder.scheduler.filter_scheduler.FilterScheduler volume_manager=cinder.volume.manager.VolumeManager volume_api_class=cinder.volume.api.API volumes_dir=$state_path/volumes # auth info for MariaDB [database] connection=mysql://cinder:password@192.168.77.50/cinder # auth info for Keystone [keystone_authtoken] auth_host=192.168.77.50 auth_port=35357 auth_protocol=http admin_user=cinder admin_password=servicepassword admin_tenant_name=service # \u542f\u7528\u670d\u52a1 [root@controller0 ~(keystone)]# chmod 640 /etc/cinder/cinder.conf [root@controller0 ~(keystone)]# chgrp cinder /etc/cinder/cinder.conf [root@controller0 ~(keystone)]# cinder-manage db sync [root@controller0 ~(keystone)]# for service in api scheduler; do systemctl start openstack-cinder-$service systemctl enable openstack-cinder-$service done [root@controller0 ~(keystone)]# cinder-manage service list Binary Host Zone Status State Updated At cinder-scheduler controller0 nova enabled :-) None \u914d\u7f6eCinder\u8282\u70b9\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 # \u5b89\u88c5Cinder\u670d\u52a1 [root@cinder0 ~(keystone)]# yum install -y openstack-cinder [root@cinder0 ~]# mv /etc/cinder/cinder.conf /etc/cinder/cinder.conf.org [root@cinder0 ~]# vi /etc/cinder/cinder.conf [DEFAULT] state_path=/var/lib/cinder api_paste_config=api-paste.ini enable_v1_api=true osapi_volume_listen=0.0.0.0 osapi_volume_listen_port=8776 rootwrap_config=/etc/cinder/rootwrap.conf auth_strategy=keystone # specify Glance server glance_host=192.168.77.50 glance_port=9292 # specify RabbitMQ server rabbit_host=192.168.77.50 rabbit_port=5672 # RabbitMQ user for auth rabbit_userid=guest # RabbitMQ user's password for auth rabbit_password=password rpc_backend=rabbit # specify iSCSI target (it's just the own IP) iscsi_ip_address=192.168.77.60 iscsi_port=3260 iscsi_helper=tgtadm scheduler_driver=cinder.scheduler.filter_scheduler.FilterScheduler volume_manager=cinder.volume.manager.VolumeManager volume_api_class=cinder.volume.api.API volumes_dir=$state_path/volumes # auth info for MariaDB [database] connection=mysql://cinder:password@192.168.77.50/cinder # auth info for Keystone [keystone_authtoken] auth_host=192.168.77.50 auth_port=35357 auth_protocol=http admin_user=cinder admin_password=servicepassword admin_tenant_name=service # \u542f\u7528\u670d\u52a1 [root@cinder0 ~]# chmod 640 /etc/cinder/cinder.conf [root@cinder0 ~]# chgrp cinder /etc/cinder/cinder.conf [root@cinder0 ~]# systemctl start openstack-cinder-volume [root@cinder0 ~]# systemctl enable openstack-cinder-volume ln -s '/usr/lib/systemd/system/openstack-cinder-volume.service' '/etc/systemd/system/multi-user.target.wants/openstack-cinder-volume.service' [root@cinder0 ~]# cinder-manage service list Binary Host Zone Status State Updated At cinder-scheduler controller0 nova enabled :-) 2015-07-21 03:29:39 cinder-volume cinder0 nova enabled :-) None","title":"\u914d\u7f6eCinder"},{"location":"inthecloud/appendix01/#lvm","text":"\u5b58\u50a8\u8282\u70b9\u914d\u7f6e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 # \u521b\u5efaPV [root@cinder0 ~]# pvcreate /dev/sdb Physical volume \"/dev/sdb\" successfully created [root@cinder0 ~]# pvcreate /dev/sdb1 Device /dev/sdb1 not found (or ignored by filtering). [root@cinder0 ~]# pvdisplay \"/dev/sdb\" is a new physical volume of \"20.00 GiB\" --- NEW Physical volume --- PV Name /dev/sdb VG Name PV Size 20.00 GiB Allocatable NO PE Size 0 Total PE 0 Free PE 0 Allocated PE 0 PV UUID lDpf6L-zPJT-6Uth-lcPA-KtAS-TYNS-B5LH4c [root@cinder0 ~]# vgcreate -s 32M vg_volume01 /dev/sdb Volume group \"vg_volume01\" successfully created [root@cinder0 ~]# vgdisplay --- Volume group --- VG Name vg_volume01 System ID Format lvm2 Metadata Areas 1 Metadata Sequence No 1 VG Access read/write VG Status resizable MAX LV 0 Cur LV 0 Open LV 0 Max PV 0 Cur PV 1 Act PV 1 VG Size 19.97 GiB PE Size 32.00 MiB Total PE 639 Alloc PE / Size 0 / 0 Free PE / Size 639 / 19.97 GiB VG UUID IYI8rR-d0u4-p58f-h1Bp-afAW-EPRK-21qSdv # \u4fee\u6539cinder\u914d\u7f6e [root@cinder0 ~]# vi /etc/cinder/cinder.conf # \u5728DEFAULT\u6bb5\u4e2d\u6dfb\u52a0 enabled_backends = lvm # \u5728\u672b\u5c3e\u6dfb\u52a0 [lvm] iscsi_helper = lioadm # volume group name just created volume_group = vg_volume01 # IP address of Storage Node iscsi_ip_address = 192.168.77.60 volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver volumes_dir = $state_path/volumes iscsi_protocol = iscsi # \u91cd\u542f\u670d\u52a1 [root@cinder0 ~]# systemctl restart openstack-cinder-volume \u8ba1\u7b97\u8282\u70b9\u914d\u7f6e\uff0c\u5728\u6240\u6709\u8ba1\u7b97\u8282\u70b9\u4e2d\u90fd\u8981\u914d\u7f6e 1 2 3 4 5 [root@controller0 ~]# vi /etc/nova/nova.conf # add follows into [DEFAULT] section osapi_volume_listen=0.0.0.0 volume_api_class=nova.volume.cinder.API [root@controller0 ~]# systemctl restart openstack-nova-compute \u521b\u5efa\u6d4b\u8bd5\u78c1\u76d8 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # \u5728\u4efb\u610f\u8ba1\u7b97\u8282\u70b9\u4e2d\u90fd\u53ef\u6267\u884ccinder\u547d\u4ee4\u521b\u5efa\u78c1\u76d8 [root@controller0 ~]# echo \"export OS_VOLUME_API_VERSION=2\" >> ~/keystonerc [root@controller0 ~]# source admin_keystone [root@controller0 ~(keystone)]# cinder create --display_name disk01 10 +---------------------------------------+--------------------------------------+ | Property | Value | +---------------------------------------+--------------------------------------+ | attachments | [] | | availability_zone | nova | | bootable | false | | consistencygroup_id | None | | created_at | 2015-07-27T08:24:32.000000 | | description | None | | encrypted | False | | id | 7a974afe-a71a-479f-b63d-b208daae1707 | | metadata | {} | | multiattach | False | | name | disk01 | | os-vol-host-attr:host | None | | os-vol-mig-status-attr:migstat | None | | os-vol-mig-status-attr:name_id | None | | os-vol-tenant-attr:tenant_id | c0c4e7b797bb41798202b55872fba074 | | os-volume-replication:driver_data | None | | os-volume-replication:extended_status | None | | replication_status | disabled | | size | 10 | | snapshot_id | None | | source_volid | None | | status | creating | | user_id | cf11b4425218431991f095c2f58578a0 | | volume_type | None | +---------------------------------------+--------------------------------------+ [root@controller0 ~(keystone)]# cinder list +--------------------------------------+-----------+--------+------+-------------+----------+-------------+ | ID | Status | Name | Size | Volume Type | Bootable | Attached to | +--------------------------------------+-----------+--------+------+-------------+----------+-------------+ | 7a974afe-a71a-479f-b63d-b208daae1707 | available | disk01 | 10 | None | false | | +--------------------------------------+-----------+--------+------+-------------+----------+-------------+ \u5b58\u50a8\u8282\u70b9\u4e0a\u67e5\u770b 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 [root@cinder0 ~]# lvdisplay --- Logical volume --- LV Path /dev/vg_volume01/volume-7a974afe-a71a-479f-b63d-b208daae1707 LV Name volume-7a974afe-a71a-479f-b63d-b208daae1707 VG Name vg_volume01 LV UUID Pp91xd-Kj0M-J5eI-tUXY-0iMH-MdJ6-PryIq7 LV Write Access read/write LV Creation host, time cinder0, 2015-07-27 16:24:33 +0800 LV Status available # open 0 LV Size 10.00 GiB Current LE 320 Segments 1 Allocation inherit Read ahead sectors auto - currently set to 8192 Block device 253:0 \u8ba1\u7b97\u8282\u70b9\u4e0a\u9644\u52a0\u78c1\u76d8\u5230\u865a\u62df\u673a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 [root@controller0 ~(keystone)]# nova list +----------------+----------+---------+------------+-------------+-----------------------+ | ID | Name | Status | Task State | Power State | Networks | +----------------+----------+---------+------------+-------------+-----------------------+ | 16971b4c-c901- | CentOS_7 | SHUTOFF | - | Shutdown | int_net=192.168.100.4 | +----------------+----------+---------+------------+-------------+-----------------------+ [root@controller0 ~(keystone)]# nova volume-attach CentOS_7 7a974afe-a71a-479f-b63d-b208daae1707 auto +----------+--------------------------------------+ | Property | Value | +----------+--------------------------------------+ | device | /dev/vdb | | id | 7a974afe-a71a-479f-b63d-b208daae1707 | | serverId | 16971b4c-c901-4e95-8334-b2ff36b99633 | | volumeId | 7a974afe-a71a-479f-b63d-b208daae1707 | +----------+--------------------------------------+ # the status of attached disk turns \"in-use\" like follows [root@controller0 ~(keystone)]# cinder list","title":"\u914d\u7f6eLVM\u540e\u7aef"},{"location":"inthecloud/appendix01/#nfsglusterfs","text":"\u6b64\u5904\u4f7f\u7528NFS\u3001Glusterfs\u6df7\u5408\u540e\u7aef\uff0c\u4e5f\u53ef\u6839\u636e\u5b9e\u9645\u9700\u6c42\u6dfb\u52a0LVM\u540e\u7aef\u6216\u8005\u4f7f\u7528\u4e09\u8005\u4e4b\u4e00\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 +------------------+ +------------------+ 192.168.77.60| [ cinder0 ] | 192.168.77.100| | +------------------+ +-----+ Cinder-Volume | +----------+ GlusterFS #1 | | [ controller0 ] | | eth0| | | eth0| gfs01.lofyer.org | | Keystone |192.168.77.50 | +------------------+ | +------------------+ | Glance |----------------+------------------------------+ | Nova API |eth0 | +------------------+ | +------------------+ | Cinder API | | eth0| [ compute0 ] | | eth0| | +------------------+ +-----+ Nova Compute | +----------------+ GlusterFS #2 | 192.168.77.51| | | 192.168.77.101| gfs02.lofyer.org | +------------------+ | +------------------+ | | +------------------+ | eth0| | +----------+ NFS | 192.168.77.110| nfs.lofyer.org | +------------------+ \u5b58\u50a8\u8282\u70b9\u914d\u7f6e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 # \u5b89\u88c5\u8f6f\u4ef6\u5305 [root@cinder0 ~]# yum -y install nfs-utils glusterfs glusterfs # \u4fee\u6539cinder\u914d\u7f6e [root@cinder0 ~]# vi /etc/cinder/cinder.conf # \u4e8eDEFAULT\u6bb5\u4e2d\u6dfb\u52a0 enabled_backends=nfs,glusterfs # \u4e8e\u672b\u5c3e\u6dfb\u52a0 [nfs] volume_driver = cinder.volume.drivers.nfs.NfsDriver volume_backend_name = NFS nfs_shares_config = /etc/cinder/nfs_shares nfs_mount_point_base = $state_path/nfs [glusterfs] volume_driver = cinder.volume.drivers.glusterfs.GlusterfsDriver volume_backend_name = GlusterFS glusterfs_shares_config = /etc/cinder/glusterfs_shares glusterfs_mount_point_base = $state_path/glusterfs # \u4fee\u6539\u5b58\u50a8\u4fe1\u606f [root@cinder0 ~]# vi /etc/cinder/nfs_shares # \u6307\u5b9aNFS\u5b58\u50a8\u8def\u5f84 nfs.lofyer.org:/storage [root@cinder0 ~]# vi /etc/cinder/glusterfs_shares # \u6307\u5b9aGlusterfs\u5b58\u50a8\u8def\u5f84 gfs01.lofyer.org:/vol_replica [root@cinder0 ~]# chmod 640 /etc/cinder/nfs_shares [root@cinder0 ~]# chgrp cinder /etc/cinder/nfs_shares [root@cinder0 ~]# chmod 640 /etc/cinder/glusterfs_shares [root@cinder0 ~]# chgrp cinder /etc/cinder/glusterfs_shares [root@cinder0 ~]# systemctl restart openstack-cinder-volume \u8ba1\u7b97\u8282\u70b9\u914d\u7f6e\uff0c\u6240\u6709\u8ba1\u7b97\u8282\u70b9\u90fd\u8981\u914d\u7f6e 1 2 3 4 5 6 7 8 # \u5b89\u88c5\u8f6f\u4ef6\u5305 [root@controller0 ~]# yum --enablerepo=epel -y install nfs-utils glusterfs glusterfs-fuse [root@controller0 ~]# vi /etc/nova/nova.conf # \u4e8eDEFAULT\u6bb5\u4e2d\u6dfb\u52a0 osapi_volume_listen=0.0.0.0 volume_api_class=nova.volume.cinder.API # \u91cd\u542f\u8ba1\u7b97\u670d\u52a1 [root@controller0 ~]# systemctl restart openstack-nova-compute \u6dfb\u52a0\u5377\u79cd\u7c7b 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # \u5728\u4efb\u610f\u8ba1\u7b97\u8282\u70b9\u4e2d\u90fd\u53ef\u6267\u884ccinder\u547d\u4ee4\u521b\u5efa\u78c1\u76d8 [root@controller0 ~]# echo \"export OS_VOLUME_API_VERSION=2\" >> ~/keystonerc [root@controller0 ~]# source admin_keystone [root@controller0 ~(keystone)]# cinder type-create nfs +--------------------------------------+------+ | ID | Name | +--------------------------------------+------+ | 7ac3a255-cf70-498d-97d8-2a7fcdd84d2c | nfs | +--------------------------------------+------+ [root@controller0 ~(keystone)]# cinder type-create glusterfs +--------------------------------------+-----------+ | ID | Name | +--------------------------------------+-----------+ | e2608bee-cc52-48e8-ba72-b94124f36a57 | glusterfs | +--------------------------------------+-----------+ [root@controller0 ~(keystone)]# cinder type-list +--------------------------------------+-----------+ | ID | Name | +--------------------------------------+-----------+ | 7ac3a255-cf70-498d-97d8-2a7fcdd84d2c | nfs | | e2608bee-cc52-48e8-ba72-b94124f36a57 | glusterfs | +--------------------------------------+-----------+ \u6dfb\u52a0\u5b58\u50a8\u79cd\u7c7b\u522b\u540d 1 2 3 4 5 6 7 8 9 [root@controller0 ~(keystone)]# cinder type-key nfs set volume_backend_name=NFS [root@controller0 ~(keystone)]# cinder type-key glusterfs set volume_backend_name=GlusterFS [root@controller0 ~(keystone)]# cinder extra-specs-list +--------------------------------------+-----------+----------------------------------------+ | ID | Name | extra_specs | +--------------------------------------+-----------+----------------------------------------+ | 7ac3a255-cf70-498d-97d8-2a7fcdd84d2c | nfs | {u'volume_backend_name': u'NFS'} | | e2608bee-cc52-48e8-ba72-b94124f36a57 | glusterfs | {u'volume_backend_name': u'GlusterFS'} | +--------------------------------------+-----------+----------------------------------------+ \u6dfb\u52a0\u78c1\u76d8 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 [root@controller0 ~(keystone)]# cinder create --display_name disk_nfs --volume-type nfs 10 +---------------------------------------+--------------------------------------+ | Property | Value | +---------------------------------------+--------------------------------------+ | attachments | [] | | availability_zone | nova | | bootable | false | | consistencygroup_id | None | | created_at | 2015-06-20T18:23:23.000000 | | description | None | | encrypted | False | | id | 1e92b9ca-20d7-4f63-881e-dea3f8b6b523 | | metadata | {} | | multiattach | False | | name | disk_nfs | | os-vol-host-attr:host | None | | os-vol-mig-status-attr:migstat | None | | os-vol-mig-status-attr:name_id | None | | os-vol-tenant-attr:tenant_id | 98ea1b896d3a48438922c0dfa9f6bc52 | | os-volume-replication:driver_data | None | | os-volume-replication:extended_status | None | | replication_status | disabled | | size | 10 | | snapshot_id | None | | source_volid | None | | status | creating | | user_id | 704a7f5cf84a479796e10f47c30bb629 | | volume_type | nfs | +---------------------------------------+--------------------------------------+ [root@controller0 ~(keystone)]# cinder create --display_name disk_glusterfs --volume-type glusterfs 10 +---------------------------------------+--------------------------------------+ | Property | Value | +---------------------------------------+--------------------------------------+ | attachments | [] | | availability_zone | nova | | bootable | false | | consistencygroup_id | None | | created_at | 2015-06-20T18:23:49.000000 | | description | None | | encrypted | False | | id | d8dbaed2-e857-4162-baab-0178fbef4593 | | metadata | {} | | multiattach | False | | name | disk_glusterfs | | os-vol-host-attr:host | None | | os-vol-mig-status-attr:migstat | None | | os-vol-mig-status-attr:name_id | None | | os-vol-tenant-attr:tenant_id | 98ea1b896d3a48438922c0dfa9f6bc52 | | os-volume-replication:driver_data | None | | os-volume-replication:extended_status | None | | replication_status | disabled | | size | 10 | | snapshot_id | None | | source_volid | None | | status | creating | | user_id | 704a7f5cf84a479796e10f47c30bb629 | | volume_type | glusterfs | +---------------------------------------+--------------------------------------+ [root@controller0 ~(keystone)]# cinder list +--------------------------+-----------+----------------+------+-------------+----------+-------------+ | ID | Status | Name | Size | Volume Type | Bootable | Attached to | +--------------------------+-----------+----------------+------+-------------+----------+-------------+ | 1e92b9ca-20d7-4f63-881e- | available | disk_nfs | 10 | nfs | false | | | d8dbaed2-e857-4162-baab- | available | disk_glusterfs | 10 | glusterfs | false | | +--------------------------+-----------+----------------+------+-------------+----------+-------------+ \u9644\u52a0\u78c1\u76d8\u5230\u865a\u62df\u673a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 [root@controller0 ~(keystone)]# nova list +----------------+----------+---------+------------+-------------+-----------------------------------+ | ID | Name | Status | Task State | Power State | Networks | +----------------+----------+---------+------------+-------------+-----------------------------------+ | 2c7a1025-30d6- | CentOS_7 | SHUTOFF | - | Shutdown | int_net=192.168.100.3, 10.0.0.201 | +----------------+----------+---------+------------+-------------+-----------------------------------+ [root@controller0 ~(keystone)]# nova volume-attach CentOS_7 1e92b9ca-20d7-4f63-881e-dea3f8b6b523 auto +----------+--------------------------------------+ | Property | Value | +----------+--------------------------------------+ | device | /dev/vdc | | id | 1e92b9ca-20d7-4f63-881e-dea3f8b6b523 | | serverId | 2c7a1025-30d6-446a-a4ff-309347b64eca | | volumeId | 1e92b9ca-20d7-4f63-881e-dea3f8b6b523 | +----------+--------------------------------------+ [root@controller0 ~(keystone)]# nova volume-attach CentOS_7 d8dbaed2-e857-4162-baab-0178fbef4593 auto +----------+--------------------------------------+ | Property | Value | +----------+--------------------------------------+ | device | /dev/vdd | | id | d8dbaed2-e857-4162-baab-0178fbef4593 | | serverId | 2c7a1025-30d6-446a-a4ff-309347b64eca | | volumeId | d8dbaed2-e857-4162-baab-0178fbef4593 | +----------+--------------------------------------+ # the status of attached disk turns \"in-use\" like follows [root@controller0 ~(keystone)]# cinder list +--------------------------+--------+----------------+------+-------------+----------+-----------------------------+ | ID | Status | Name | Size | Volume Type | Bootable | Attached to | +--------------------------+--------+----------------+------+-------------+----------+-----------------------------+ | 1e92b9ca-20d7-4f63-881e- | in-use | disk_nfs | 10 | nfs | false | 2c7a1025-30d6-446a-a4ff-309 | | d8dbaed2-e857-4162-baab- | in-use | disk_glusterfs | 10 | glusterfs | false | 2c7a1025-30d6-446a-a4ff-309 | +--------------------------+--------+----------------+------+-------------+----------+-----------------------------+","title":"\u914d\u7f6eNFS\u3001Glusterfs\u6df7\u5408\u540e\u7aef"},{"location":"inthecloud/appendix01/#swift","text":"\u5728\u6b64\u6211\u4eec\u6709\u4e09\u4e2a\u5b58\u50a8\u8282\u70b9\u4f5c\u4e3aswift backend\uff0cswift0\u4f5c\u4e3aswift\u8bbf\u95ee\u5165\u53e3\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 | +------------------+ | +-----------------+ | [ controller0 ] |192.168.77.50 | 192.168.77.70| [ swift0 ] | | Keystone |---------------+---------------| Proxy | +------------------+ | +-----------------+ | +---------------------------+--------------------------+ | | | |192.168.77.71 |192.168.77.72 |192.168.77.73 +-------+----------+ +--------+---------+ +--------+---------+ | [ swift-stor0 ] | | [ swift-stor1 ] | | [ swift-stor2 ] | | |-------| |-------| | +------------------+ +------------------+ +------------------+ \u914d\u7f6e\u63a7\u5236\u8282\u70b9 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 # \u6dfb\u52a0swift\u7528\u6237 [root@controller0 ~(keystone)]# openstack user create --project service --password servicepassword swift +------------+----------------------------------+ | Field | Value | +------------+----------------------------------+ | email | None | | enabled | True | | id | 9e19bc053b0f44bdbabf751b279c9afd | | name | swift | | project_id | 9acf83020ae34047b6f1e320c352ae44 | | username | swift | +------------+----------------------------------+ # \u8d4b\u4e88swift\u7528\u6237admin\u89d2\u8272 [root@controller0 ~(keystone)]# openstack role add --project service --user swift admin +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 95c4b8fb8d97424eb52a4e8a00a357e7 | | name | admin | +-------+----------------------------------+ # \u521b\u5efaswift\u670d\u52a1 [root@controller0 ~(keystone)]# openstack service create --name swift --description \"OpenStack Object Storage\" object-store +-------------+----------------------------------+ | Field | Value | +-------------+----------------------------------+ | description | OpenStack Object Storage | | enabled | True | | id | c8d07b32376a4e2780d8ec9b2b836e41 | | name | swift | | type | object-store | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# export swift_proxy=192.168.77.70 # \u6dfb\u52a0endpoint root@controller0 ~(keystone)]# openstack endpoint create \\ --publicurl http://$swift_proxy:8080/v1/AUTH_%\\(tenant_id\\)s \\ --internalurl http://$swift_proxy:8080/v1/AUTH_%\\(tenant_id\\)s \\ --adminurl http://$swift_proxy:8080 \\ --region RegionOne \\ object-store +--------------+-------------------------------------------------+ | Field | Value | +--------------+-------------------------------------------------+ | adminurl | http://192.168.77.70:8080 | | id | d7e1f6a5f7064f3690181f7bd8922ac4 | | internalurl | http://192.168.77.70:8080/v1/AUTH_%(tenant_id)s | | publicurl | http://192.168.77.70:8080/v1/AUTH_%(tenant_id)s | | region | RegionOne | | service_id | c8d07b32376a4e2780d8ec9b2b836e41 | | service_name | swift | | service_type | object-store | +--------------+-------------------------------------------------+ \u914d\u7f6eswift\u4ee3\u7406\u8282\u70b9 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 [root@swift0 ~]# vi /etc/swift/proxy-server.conf # \u7b2c53\u884c [filter:authtoken] paste.filter_factory = keystoneclient.middleware.auth_token:filter_factory # \u6ce8\u91ca\u5982\u4e0b\u90e8\u5206 #admin_tenant_name = %SERVICE_TENANT_NAME% #admin_user = %SERVICE_USER% #admin_password = %SERVICE_PASSWORD% # #identity_uri = http://localhost:35357/ #auth_uri = http://localhost:5000/ # signing_dir = /tmp/keystone-signing-swift # \u6dfb\u52a0\u8ba4\u8bc1 auth_uri = http://192.168.77.50:5000 auth_url = http://192.168.77.50:35357 auth_plugin = password project_domain_id = default user_domain_id = default project_name = service username = swift password = servicepassword delay_auth_decision = true [root@swift0 ~]# vi /etc/swift/swift.conf # \u66f4\u6539\u4e3a\u4efb\u610f [swift-hash] swift_hash_path_suffix = swift_shared_path # \u521b\u5efaswift\u54c8\u5e0c\u73af # swift-ring-builder builder-file create <part_power> <replicas> <min_part_hours> # Creates <builder_file> with 2^<part_power> partitions and <replicas>. # <min_part_hours> is number of hours to restrict moving a partition more # than once [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder create 12 3 1 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder create 12 3 1 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder create 12 3 1 [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder add r0z0-192.168.77.71:6002/device0 100 Device d0r0z0-192.168.77.71:6002R192.168.77.71:6002/device0_\"\" with 100.0 weight got id 0 [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder add r0z0-192.168.77.72:6002/device0 100 Device d1r0z0-192.168.77.72:6002R192.168.77.72:6002/device0_\"\" with 100.0 weight got id 1 [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder add r0z0-192.168.77.73:6002/device0 100 Device d2r0z0-192.168.77.73:6002R192.168.77.73:6002/device0_\"\" with 100.0 weight got id 2 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder add r0z0-192.168.77.71:6001/device0 100 Device d0r0z0-192.168.77.71:6001R192.168.77.71:6001/device0_\"\" with 100.0 weight got id 0 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder add r0z0-192.168.77.72:6001/device0 100 Device d1r0z0-192.168.77.72:6001R192.168.77.72:6001/device0_\"\" with 100.0 weight got id 1 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder add r0z0-192.168.77.73:6001/device0 100 Device d2r0z0-192.168.77.73:6001R192.168.77.73:6001/device0_\"\" with 100.0 weight got id 2 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder add r0z0-192.168.77.71:6000/device0 100 Device d0r0z0-192.168.77.71:6000R192.168.77.71:6000/device0_\"\" with 100.0 weight got id 0 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder add r0z0-192.168.77.72:6000/device0 100 Device d1r0z0-192.168.77.72:6000R192.168.77.72:6000/device0_\"\" with 100.0 weight got id 1 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder add r0z0-192.168.77.73:6000/device0 100 Device d2r0z0-192.168.77.73:6000R192.168.77.73:6000/device0_\"\" with 100.0 weight got id 2 [root@swift0 ~]# swift-ring-builder /etc/swift/account.builder rebalance Reassigned 4096 (100.00%) partitions. Balance is now 0.00. Dispersion is now 0.00 [root@swift0 ~]# swift-ring-builder /etc/swift/container.builder rebalance Reassigned 4096 (100.00%) partitions. Balance is now 0.00. Dispersion is now 0.00 [root@swift0 ~]# swift-ring-builder /etc/swift/object.builder rebalance Reassigned 4096 (100.00%) partitions. Balance is now 0.00. Dispersion is now 0.00 [root@swift0 ~]# chown swift. /etc/swift/*.gz [root@swift0 ~]# systemctl start memcached openstack-swift-proxy [root@swift0 ~]# systemctl enable memcached openstack-swift-proxy ln -s '/usr/lib/systemd/system/memcached.service' '/etc/systemd/system/multi-user.target.wants/memcached.service' ln -s '/usr/lib/systemd/system/openstack-swift-proxy.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-proxy.service' \u914d\u7f6e\u5b58\u50a8\u8282\u70b9\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u8981\u914d\u7f6e\uff0c\u6ce8\u610fselinux\u7b56\u7565\uff0c\u5426\u5219\u4f1a\u64cd\u4f5c\u5931\u8d25\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 # \u7981\u7528selinux [root@swift-stor0 ~]# setenforce permissive [root@swift-stor0 ~]# vi /etc/selinux/config SELINUX=enforcing # \u5b89\u88c5\u6240\u9700\u5305 [root@swift-stor0 ~]# yum install -y openstack-swift-account openstack-swift-container openstack-swift-object xfsprogs rsync openssh-clients # \u683c\u5f0f\u5316\u5b58\u50a8\u78c1\u76d8\u4e3axfs [root@swift-stor0 ~]# mkfs.xfs -i size=1024 -s size=4096 /dev/sdb -f meta-data=/dev/sdb isize=1024 agcount=4, agsize=1310720 blks = sectsz=4096 attr=2, projid32bit=1 = crc=0 finobt=0 data = bsize=4096 blocks=5242880, imaxpct=25 = sunit=0 swidth=0 blks naming =version 2 bsize=4096 ascii-ci=0 ftype=0 log =internal log bsize=4096 blocks=2560, version=2 = sectsz=4096 sunit=1 blks, lazy-count=1 realtime =none extsz=4096 blocks=0, rtextents=0 # \u521b\u5efa\u76ee\u5f55\u5e76\u6dfb\u52a0fstab [root@swift-stor0 ~]# mkdir -p /srv/node/device0 [root@swift-stor0 ~]# mount -o noatime,nodiratime,nobarrier /dev/sdb /srv/node/device0 [root@swift-stor0 ~]# chown -R swift. /srv/node [root@swift-stor0 ~]# vi /etc/fstab # \u62f7\u8d1dhash\u73af\u6587\u4ef6 [root@swift-stor0 ~]# scp root@192.168.77.70:/etc/swift/*.gz /etc/swift/ root@192.168.77.70's password: account.ring.gz 100% 3862 3.8KB/s 00:00 container.ring.gz 100% 3861 3.8KB/s 00:00 object.ring.gz 100% 3887 3.8KB/s 00:00 [root@swift-stor0 ~]# chown swift. /etc/swift/*.gz # \u4fee\u6539\u540e\u7f00\u4e3aproxy\u8bbe\u7f6e\u503c [root@swift-stor0 ~]# vi /etc/swift/swift.conf [swift-hash] swift_hash_path_suffix = swift_shared_path # \u4fee\u6539account\u3001container\u3001object\u670d\u52a1\u7aef\u53e3 [root@swift-stor0 ~]# vi /etc/swift/account-server.conf bind_ip = 192.168.77.71 bind_port = 6002 [root@swift-stor0 ~]# vi /etc/swift/container-server.conf bind_ip = 192.168.77.71 bind_port = 6002 [root@swift-stor0 ~]# vi /etc/swift/object-server.conf bind_ip = 192.168.77.71 bind_port = 6000 # \u914d\u7f6ersync [root@swift-stor0 ~]# vi /etc/rsyncd.conf # \u5728\u672b\u5c3e\u6dfb\u52a0 # add to the end pid file = /var/run/rsyncd.pid log file = /var/log/rsyncd.log uid = swift gid = swift address = 192.168.77.71 [account] path = /srv/node read only = false write only = no list = yes incoming chmod = 0644 outgoing chmod = 0644 max connections = 25 lock file = /var/lock/account.lock [container] path = /srv/node read only = false write only = no list = yes incoming chmod = 0644 outgoing chmod = 0644 max connections = 25 lock file = /var/lock/container.lock [object] path = /srv/node read only = false write only = no list = yes incoming chmod = 0644 outgoing chmod = 0644 max connections = 25 lock file = /var/lock/object.lock [swift_server] path = /etc/swift read only = true write only = no list = yes incoming chmod = 0644 outgoing chmod = 0644 max connections = 5 lock file = /var/lock/swift_server.lock # \u5f00\u542f\u670d\u52a1 [root@swift-stor0 ~]# systemctl start rsyncd [root@swift-stor0 ~]# systemctl enable rsyncd ln -s '/usr/lib/systemd/system/rsyncd.service' '/etc/systemd/system/multi-user.target.wants/rsyncd.service' [root@swift-stor0 ~]# for ringtype in account container object; do systemctl start openstack-swift-$ringtype systemctl enable openstack-swift-$ringtype for service in replicator updater auditor; do if [ $ringtype != 'account' ] || [ $service != 'updater' ]; then systemctl start openstack-swift-$ringtype-$service systemctl enable openstack-swift-$ringtype-$service fi done done ln -s '/usr/lib/systemd/system/openstack-swift-account.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-account.service' ln -s '/usr/lib/systemd/system/openstack-swift-account-replicator.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-account-replicator.service' ln -s '/usr/lib/systemd/system/openstack-swift-account-auditor.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-account-auditor.service' ln -s '/usr/lib/systemd/system/openstack-swift-container.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-container.service' ln -s '/usr/lib/systemd/system/openstack-swift-container-replicator.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-container-replicator.service' ln -s '/usr/lib/systemd/system/openstack-swift-container-updater.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-container-updater.service' ln -s '/usr/lib/systemd/system/openstack-swift-container-auditor.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-container-auditor.service' ln -s '/usr/lib/systemd/system/openstack-swift-object.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-object.service' ln -s '/usr/lib/systemd/system/openstack-swift-object-replicator.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-object-replicator.service' ln -s '/usr/lib/systemd/system/openstack-swift-object-updater.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-object-updater.service' ln -s '/usr/lib/systemd/system/openstack-swift-object-auditor.service' '/etc/systemd/system/multi-user.target.wants/openstack-swift-object-auditor.service' \u6dfb\u52a0\u7528\u6237 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # \u6dfb\u52a0\u5de5\u7a0b [root@controller0 ~(keystone)]# openstack project create --description \"Swift Service Project\" swiftservice +-------------+----------------------------------+ | Field | Value | +-------------+----------------------------------+ | description | Swift Service Project | | enabled | True | | id | 65e95f038a654db3a2ee0ae93daaf2b3 | | name | swiftservice | +-------------+----------------------------------+ # \u521b\u5efa\u5ba2\u6237\u7aef\u89d2\u8272 [root@controller0 ~(keystone)]# openstack role create swiftoperator +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | dbcb21e865ae435da39507bea32fe312 | | name | swiftoperator | +-------+----------------------------------+ # \u6dfb\u52a0\u5de5\u7a0b\u7528\u6237 [root@controller0 ~(keystone)]# openstack user create --project swiftservice --password userpassword user01 +------------+----------------------------------+ | Field | Value | +------------+----------------------------------+ | email | None | | enabled | True | | id | c1d2e56e9d72447096221a4542e17e58 | | name | user01 | | project_id | 65e95f038a654db3a2ee0ae93daaf2b3 | | username | user01 | +------------+----------------------------------+ # \u8d4b\u4e88\u7528\u6237\u5ba2\u6237\u7aef\u89d2\u8272 [root@controller0 ~(keystone)]# openstack role add --project swiftservice --user user01 swiftoperator +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | dbcb21e865ae435da39507bea32fe312 | | name | swiftoperator | +-------+----------------------------------+ \u5ba2\u6237\u7aef\u64cd\u4f5c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # \u5b89\u88c5\u6240\u9700\u5305 [root@controller0 ~(keystone)]# yum install -y python-keystoneclient python-swiftclient # \u6dfb\u52a0keystone_rc\u6587\u4ef6 [root@controller0 ~(swift)]# cat swift_keystone export OS_PROJECT_DOMAIN_ID=default export OS_USER_DOMAIN_ID=default export OS_PROJECT_NAME=swiftservice export OS_TENANT_NAME=swiftservice export OS_USERNAME=user01 export OS_PASSWORD=userpassword export OS_AUTH_URL=http://192.168.77.50:35357/v2.0 export PS1='[\\u@\\h \\W(swift)]\\$ ' [root@controller0 ~(keystone)]# source swift_keystone [root@controller0 ~(swift)]# swift stat Account: AUTH_65e95f038a654db3a2ee0ae93daaf2b3 Containers: 0 Objects: 0 Bytes: 0 X-Put-Timestamp: 1438064191.81736 Connection: keep-alive X-Timestamp: 1438064191.81736 X-Trans-Id: txe9426af85d424b7185086-0055b71e3e Content-Type: text/plain; charset=utf-8 # \u521b\u5efa\u6d4b\u8bd5\u5bb9\u5668 [root@controller0 ~(swift)]# swift post test_container [root@controller0 ~(swift)]# swift list test_container # \u4e0a\u4f20\u6587\u4ef6 [root@controller0 ~(swift)]# swift upload test_container admin_keystone [root@controller0 ~(swift)]# swift list test_container admin_keystone # \u4e0b\u8f7d\u6587\u4ef6 [root@controller0 ~(swift)]# swift download test_container admin_keystone > admin_keystone.txt","title":"\u914d\u7f6eSwift"},{"location":"inthecloud/appendix01/#heat","text":"Heat\u670d\u52a1\u5373\u7528\u4e8e\u63d0\u4f9borchestration\uff0c\u5728\u6b64\u6211\u4eec\u4f7f\u7528neutron0\u5f53\u4f5cheat\u8282\u70b9\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 | +------------------+ | +-----------------------+ | [ controller0 ] | | | [ neutron0 ] | | Keystone |192.168.77.50 | 192.168.77.30| DHCP,L3,L2 Agent | | Glance |--------------+--------------| Metadata Agent | | Nova API |eth0 | th0| Heat API,API-CFN | | Neutron Server | | | Heat Engine | +------------------+ | +-----------------------+ eth0|192.168.77.51 +--------------------+ | [ compute0 ] | | Nova Compute | | L2 Agent | +--------------------+ \u63a7\u5236\u8282\u70b9\u914d\u7f6e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 # \u5b89\u88c5\u6240\u9700\u5305 [root@controller0 ~]# yum install -y openstack-heat-common # \u6dfb\u52a0\u7528\u6237\uff0c\u521b\u5efaendpoint [root@controller0 ~(keystone)]# openstack user create --project service --password servicepassword heat +------------+----------------------------------+ | Field | Value | +------------+----------------------------------+ | email | None | | enabled | True | | id | d18e4d820a5d4384a676bb0064448c09 | | name | heat | | project_id | 9acf83020ae34047b6f1e320c352ae44 | | username | heat | +------------+----------------------------------+ [root@controller0 ~(keystone)]# openstack role add --project service --user heat admin +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 95c4b8fb8d97424eb52a4e8a00a357e7 | | name | admin | +-------+----------------------------------+ [root@controller0 ~(keystone)]# openstack role create heat_stack_owner +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 91ef76ae6d6c4fc0b908cf7416055da0 | | name | heat_stack_owner | +-------+----------------------------------+ [root@controller0 ~(keystone)]# openstack role create heat_stack_user +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 0bf5c075fcb7448d844699131c8008fb | | name | heat_stack_user | +-------+----------------------------------+ [root@controller0 ~(keystone)]# openstack role add --project admin --user admin heat_stack_owner +-------+----------------------------------+ | Field | Value | +-------+----------------------------------+ | id | 91ef76ae6d6c4fc0b908cf7416055da0 | | name | heat_stack_owner | +-------+----------------------------------+ [root@controller0 ~(keystone)]# openstack service create --name heat --description \"Openstack Orchestration\" orchestration +-------------+----------------------------------+ | Field | Value | +-------------+----------------------------------+ | description | Openstack Orchestration | | enabled | True | | id | fc32f278bf3243d9b6b6c7a5cbf13135 | | name | heat | | type | orchestration | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# openstack service create --name heat-cfn --description \"Openstack Orchestration\" cloudformation +-------------+----------------------------------+ | Field | Value | +-------------+----------------------------------+ | description | Openstack Orchestration | | enabled | True | | id | f3334830bc254e6491b5f7de8f7d9a58 | | name | heat-cfn | | type | cloudformation | +-------------+----------------------------------+ [root@controller0 ~(keystone)]# heat_api=192.168.77.30 [root@controller0 ~(keystone)]# openstack endpoint create \\ --publicurl http://$heat_api:8004/v1/%\\(tenant_id\\)s \\ --internalurl http://$heat_api:8004/v1/%\\(tenant_id\\)s \\ --adminurl http://$heat_api:8004/v1/%\\(tenant_id\\)s \\ --region RegionOne \\ orchestration +--------------+--------------------------------------------+ | Field | Value | +--------------+--------------------------------------------+ | adminurl | http://192.168.77.30:8004/v1/%(tenant_id)s | | id | 1a91dbfe0913466db38595c1b4f0bd59 | | internalurl | http://192.168.77.30:8004/v1/%(tenant_id)s | | publicurl | http://192.168.77.30:8004/v1/%(tenant_id)s | | region | RegionOne | | service_id | fc32f278bf3243d9b6b6c7a5cbf13135 | | service_name | heat | | service_type | orchestration | +--------------+--------------------------------------------+ [root@controller0 ~(keystone)]# openstack endpoint create \\ --publicurl http://$heat_api:8000/v1 \\ --internalurl http://$heat_api:8000/v1 \\ --adminurl http://$heat_api:8000/v1 \\ --region RegionOne \\ cloudformation +--------------+----------------------------------+ | Field | Value | +--------------+----------------------------------+ | adminurl | http://192.168.77.30:8000/v1 | | id | e40570fd8201420fbea42abf3231d8eb | | internalurl | http://192.168.77.30:8000/v1 | | publicurl | http://192.168.77.30:8000/v1 | | region | RegionOne | | service_id | f3334830bc254e6491b5f7de8f7d9a58 | | service_name | heat-cfn | | service_type | cloudformation | +--------------+----------------------------------+ # \u6ce8\u610f\u672b\u5c3e\u7684\u4fe1\u606f\uff0c\u540c\u65f6\u624b\u52a8\u66f4\u65b0/etc/heat/heat.conf\u6587\u4ef6 [root@controller0 ~(keystone)]# heat-keystone-setup-domain \\ --stack-user-domain-name heat_user_domain \\ --stack-domain-admin heat_domain_admin \\ --stack-domain-admin-password domainpassword Please update your heat.conf with the following in [DEFAULT] stack_user_domain_id=55654da575f048869a9128db12d26f27 stack_domain_admin=heat_domain_admin stack_domain_admin_password=domainpassword [root@controller0 ~(keystone)]# vim /etc/heat/heat.conf # \u521b\u5efa\u6570\u636e\u5e93 [root@controller0 ~]# mysql -uroot -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 11 Server version: 5.5.40-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026 Copyright (c) 2000, 2014, Oracle, MariaDB Corporation Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]> create database heat; Query OK, 1 row affected (0.00 sec) MariaDB [(none)]> grant all privileges on heat.* to heat@'localhost' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> grant all privileges on heat.* to heat@'%' identified by 'password'; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> flush privileges; Query OK, 0 rows affected (0.00 sec) MariaDB [(none)]> exit Bye heat\u8282\u70b9\u914d\u7f6e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 [root@neutron0 ~]# mv /etc/heat/heat.conf /etc/heat/heat.conf.org [root@neutron0 ~]# vi /etc/heat/heat.conf [DEFAULT] deferred_auth_method = trusts trusts_delegated_roles = heat_stack_owner # Heat installed server heat_metadata_server_url = http://192.168.77.30:8000 heat_waitcondition_server_url = http://192.168.77.30:8000/v1/waitcondition heat_watch_server_url = http://192.168.77.30:8003 heat_stack_user_role = heat_stack_user stack_user_domain_id=55654da575f048869a9128db12d26f27 stack_domain_admin=heat_domain_admin stack_domain_admin_password=domainpassword rpc_backend = rabbit [database] # MariaDB connection info connection = mysql://heat:password@192.168.77.50/heat # RabbitMQ connection info [oslo_messaging_rabbit] rabbit_host = 192.168.77.50 rabbit_port = 5672 rabbit_userid = guest rabbit_password = password [ec2authtoken] # Keystone server auth_uri = http://192.168.77.50:35357/v2.0 [heat_api] bind_host = 0.0.0.0 bind_port = 8004 [heat_api_cfn] bind_host = 0.0.0.0 bind_port = 8000 [keystone_authtoken] # Keystone auth info auth_host = 192.168.77.50 auth_port = 35357 auth_protocol = http auth_uri = http://192.168.77.50:35357/v2.0 # Heat admin user admin_user = heat # Heat admin user's password admin_password = servicepassword # Heat admin user's tenant admin_tenant_name = service [root@neutron0 ~]# chgrp heat /etc/heat/heat.conf [root@neutron0 ~]# chmod 640 /etc/heat/heat.conf [root@neutron0 ~]# chmod 640 /etc/heat/heat.conf [root@neutron0 ~]# heat-manage db_sync [root@neutron0 ~]# systemctl start openstack-heat-api openstack-heat-api-cfn openstack-heat-engine [root@neutron0 ~]# systemctl enable openstack-heat-api openstack-heat-api-cfn openstack-heat-engine ln -s '/usr/lib/systemd/system/openstack-heat-api.service' '/etc/systemd/system/multi-user.target.wants/openstack-heat-api.service' ln -s '/usr/lib/systemd/system/openstack-heat-api-cfn.service' '/etc/systemd/system/multi-user.target.wants/openstack-heat-api-cfn.service' ln -s '/usr/lib/systemd/system/openstack-heat-engine.service' '/etc/systemd/system/multi-user.target.wants/openstack-heat-engine.service' \u4f7f\u7528heat\u521b\u5efa\u865a\u62df\u673a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 [root@controller0 ~]# vi sample-stack.yml heat_template_version: 2014-10-16 description: Heat Sample Template parameters: ImageID: type: string description: Image used to boot a server NetID: type: string description: Network ID for the server resources: server1: type: OS::Nova::Server properties: name: \"Heat_Deployed_Server\" image: { get_param: ImageID } flavor: \"m1.small\" networks: - network: { get_param: NetID } outputs: server1_private_ip: description: IP address of the server in the private network value: { get_attr: [ server1, first_address ] } [root@controller0 ~]# source admin_keystone [root@controller0 ~(keystone)]# glance image-list +--------------------------------------+---------+-------------+------------------+-------------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +--------------------------------------+---------+-------------+------------------+-------------+--------+ | fc9da1a8-0418-4ae8-8e67-22a7975f7a0b | centos6 | qcow2 | bare | 10739318784 | active | +--------------------------------------+---------+-------------+------------------+-------------+--------+ [root@controller0 ~(keystone)]# Int_Net_ID=`neutron net-list | grep int_net | awk '{ print $2 }'` [root@controller0 ~(keystone)]# heat stack-create -f sample-stack.yml -P \"ImageID=centos6;NetID=$Int_Net_ID\" Sample-Stack +--------------------------------------+--------------+--------------------+----------------------+ | id | stack_name | stack_status | creation_time | +--------------------------------------+--------------+--------------------+----------------------+ | 35b5c1e6-ec84-4bf8-9e77-1946bcf8d09b | Sample-Stack | CREATE_IN_PROGRESS | 2015-07-31T03:06:27Z | +--------------------------------------+--------------+--------------------+----------------------+","title":"\u914d\u7f6eHeat\uff08\u53ef\u9009\uff09"},{"location":"inthecloud/appendix01/#ceilometer","text":"","title":"\u914d\u7f6eCeilometer\uff08\u53ef\u9009\uff09"},{"location":"inthecloud/appendix01/#sahara","text":"","title":"\u914d\u7f6eSahara\uff08\u53ef\u9009\uff09"},{"location":"inthecloud/appendix01/#ironic","text":"","title":"\u914d\u7f6eIronic\uff08\u53ef\u9009\uff09"},{"location":"inthecloud/appendix01/#_7","text":"","title":"\u4f7f\u7528\u793a\u4f8b"},{"location":"inthecloud/appendix01/#_8","text":"\u4e00\u4e9b\u5e38\u7528\u64cd\u4f5c\u3002","title":"\u57fa\u672c\u64cd\u4f5c"},{"location":"inthecloud/appendix01/#_9","text":"\u4ee5admin\u6216\u8005demo\u7528\u6237\u8eab\u4efd\u767b\u5f55dashboard\u540e\uff0c\u9009\u62e9\u201c\u955c\u50cf\u201d\uff0c\u4e0a\u4f20ISO\u3002 ```{image} ../images/apx01-01.png :align: center 1 2 3 4 5 6 #### \u4eceISO\u5b89\u88c5\u65b0\u5b9e\u4f8b \u5728\u201c\u5b9e\u4f8b\u201d\u9009\u9879\u5361\u4e2d\uff0c\u9009\u62e9\u201c\u6dfb\u52a0\u5b9e\u4f8b\u201d\uff0c\u5e76\u4ece\u73b0\u6709\u955c\u50cf\u542f\u52a8\u3002 ```{image} ../images/apx01-02.png :align: center","title":"\u6dfb\u52a0\u955c\u50cf"},{"location":"inthecloud/appendix01/#owncloud","text":"\u521b\u5efa\u4e00\u4e2a\u6307\u5b9aregion\u7684endpoint\u4e8eswift\u670d\u52a1\u4e2d ```{code}","title":"\u4e0eowncloud\u96c6\u6210"},{"location":"inthecloud/appendix01/#source-keystone_admin","text":"# keystone endpoint-create --service swift --region swift_region \\ --publicurl \"http://192.168.2.160:8080/v1/AUTH_7d11dd5a3f3544149e8b6a9799a2aa48/oc\" ``` \u5176\u4e2d\u7684publicurl\u53ef\u4ee5\u4ececontainer\u7684\u8be6\u7ec6\u4fe1\u606f\u4e2d\u67e5\u770b\u3002 \u4f7f\u7528owncloud\u7684\u7b2c\u4e09\u65b9app\u2014\u2014external storage\uff0c\u5982\u4e0b\u8fdb\u884c\u586b\u5199 \u76ee\u5f55\u540d\u79f0\uff1a\u663e\u793a\u5728owncloud\u4e2d\u7684\u76ee\u5f55\u540d\u79f0\u3002 user\uff1aproject\u7528\u6237\u540d\u3002 bucket\uff1a\u5bb9\u5668\u540d\u3002 region\uff1a\u4e0a\u4e00\u6b65\u6307\u5b9a\u7684region\u3002 key\uff1a\u7528\u6237\u5bc6\u7801\u3002 tenant\uff1aproject\u540d\u3002 password\uff1a\u7528\u6237\u5bc6\u7801\u3002 service_name\uff1a\u670d\u52a1\u540d\uff0c\u5373swift\u3002 url\uff1a\u4f7f\u7528keystone\u8ba4\u8bc1\u7684url\uff0c\u5373http://192.168.2.160:5000/v2.0 \u3002 timeout\uff1a\u8d85\u65f6\u65f6\u957f\uff0c\u53ef\u4e0d\u586b\u3002","title":"source ./keystone_admin"},{"location":"inthecloud/appendix01/#ovirtglanceneutron","text":"oVirt\u81ea3.3\u7248\u672c\u8d77\uff0c\u4fbf\u53ef\u4ee5\u6dfb\u52a0\u5916\u90e8\u7ec4\u4ef6\uff0c\u6bd4\u5982Foreman\u3001OpenStack\u7684\u7f51\u7edc\u6216\u955c\u50cf\u670d\u52a1\u3002 \u5728\u6dfb\u52a0OpenStack\u76f8\u5173\u7ec4\u4ef6\u4e4b\u524d\uff0coVirt\u7ba1\u7406\u7aef\u9700\u8981\u914d\u7f6eOpenStack\u7684KeyStone URL\uff1a 1 2 # engine-config --set KeystoneAuthUrl=http://192.168.2.160:35357/v2.0 # service ovirt-engine restart","title":"oVirt\u4f7f\u7528Glance\u4e0eNeutron\u670d\u52a1"},{"location":"inthecloud/appendix01/#openstackglanceovirt","text":"\u5728OpenStack\u7684\u63a7\u5236\u53f0\u4e2d\uff0c\u6dfb\u52a0\u4e00\u4e2a\u65b0\u955c\u50cf\uff0c\u6bd4\u5982my_test_image\uff0c\u683c\u5f0f\u4e3araw\u3002 ```{image} ../images/apx01-03.png :align: center 1 2 3 4 2. \u5728oVirt\u5de6\u8fb9\u680f\uff0c\u9009\u62e9External Provider\u6dfb\u52a0OpenStack Image\u670d\u52a1\u3002 ```{image} ../images/apx01-04.png :align: center :::{note} \u8ba4\u8bc1\u9009\u9879 \u7528\u6237\u540d\uff1aglance \u5bc6\u7801\uff1a\u5b58\u4e8eRDO\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5f62\u5982 CONFIG_GLANCE_KS_PW=bf83b75a635843b4 Tenant\uff1aservices ::: \u7136\u540e\u53ef\u4ee5\u5728oVirt\u7684\u5b58\u50a8\u57df\u4e2d\u770b\u5230\u521a\u521a\u6dfb\u52a0\u7684Glance\u670d\u52a1\u3002 ```{image} ../images/apx01-05.png :align: center 1 2 3 4 #### Neutron ```{image} ../images/apx01-06.jpeg :align: center \u53ef\u53c2\u8003 NeutronVirtualAppliance \u4ee5\u53ca Overlay_Networks_with_Neutron_Integration \uff0c\u53e6\u5916\u63d0\u4f9b \u64cd\u4f5c\u89c6\u9891 \u3002 \u914d\u7f6eoVirt\u3002 1 2 3 # engine-config --set OnlyRequiredNetworksMandatoryForVdsSelection=true # yum install vdsm-hook-openstacknet # service ovirt-engine restart \u5982\u56fe\u6dfb\u52a0Neutron\u7ec4\u4ef6\u3002 ```{image} ../images/apx01-07.png :align: center 1 2 ```{image} ../images/apx01-08.png :align: center :::{note} \u8ba4\u8bc1\u9009\u9879 \u7528\u6237\u540d\uff1aneutron \u5bc6\u7801\uff1a\u5b58\u4e8eRDO\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u5f62\u5982 CONFIG_NEUTRON_KS_PW=a16c52e3ea634324 Tenant\uff1aservices agent \u914d\u7f6e\u76f8\u540c :::","title":"\u6dfb\u52a0OpenStack\u955c\u50cf\u670d\u52a1Glance\u81f3oVirt"},{"location":"inthecloud/appendix01/#openstack_2","text":"Q\uff1a\u5982\u4f55\u6821\u9a8c\u5bc6\u7801\u662f\u5426\u6b63\u786e\uff1f A\uff1akeystone --os-username=neutron --os-password=servicepassword --os-auth-url=http://localhost:35357/v2.0 token-get Q\uff1a\u7ba1\u7406\u754c\u9762Swift\u4e0d\u80fd\u5220\u9664\u76ee\u5f55\uff1f A\uff1a\u4f7f\u7528\u547d\u4ee4 swift delete public_container aaa/ \u8fdb\u884c\u5220\u9664\u3002 Q\uff1a Neutron \u7f51\u7edc\u5feb\u901f\u5f00\u59cb\uff1f A\uff1a\u53c2\u8003https://www.ustack.com/blog/neutron_intro/ Q\uff1aOpenStack\u7ec4\u4ef6\u95f4\u7684\u901a\u4fe1\u662f\u9760\u4ec0\u4e48\uff1f A\uff1aAMQP\uff0c\u6bd4\u5982RabbitMQ\u3001Apache\u7684ActiveMQ\uff0c\u90e8\u7f72\u65f6\u5019\u53ef\u4ee5\u9009\u62e9\uff0c\u5982\u679c\u5bf9\u8fd9\u79cd\u6d88\u606f\u4f20\u8f93\u5de5\u5177\u6709\u5174\u8da3\u53ef\u4ee5\u53c2\u8003 rabbitmq tutorial \u4ee5\u53ca \u5404\u79cd\u6709\u7528\u7684\u63d2\u4ef6\uff08web\u76d1\u89c6\u7b49\uff09 \u3002 Q\uff1aSwift\u6709\u4ec0\u4e48\u597d\u7528\u7684\u5ba2\u6237\u7aef\u4e48\uff1f A\uff1a python-swiftclient \u3001 Gladient Cloud Desktop \u3001 Cloudberry \u3001 Cyberduck \u3001 WebDrive \u3001 S3 Browser \u7b49\u3002","title":"OpenStack\u5e38\u89c1\u95ee\u9898"},{"location":"inthecloud/appendix02/","text":"\u9644\u5f55\u4e8c \u516c\u6709\u4e91\u53c2\u8003 \u865a\u62df\u673a\u5360\u7528\u4e3b\u673a\u8d44\u6e90\u9694\u79bb \u7f51\u7edc \u4f7f\u7528 VLAN \u3001 openvswitch \u8fdb\u884c\u9694\u79bb\u6216\u9650\u5236\u3002 \u4f7f\u7528tc\uff08Traffic Controller\uff09\u547d\u4ee4\u8fdb\u884c\u901f\u7387\u7684\u9650\u5236\uff0c\u8bb8\u591a\u865a\u62df\u5316\u5e73\u53f0\u4f7f\u7528\u7684\u90fd\u662f\u5b83\u3002 CPU \u4f7f\u7528CPU Pin\u53ef\u4ee5\u5c06\u7279\u5b9a\u865a\u62df\u6838\u56fa\u5b9a\u5728\u6307\u5b9a\u7269\u7406\u6838\u4e0a\u3002\u7ebf\u7a0b\u5f53\u4f5c\u6838\u6765\u4f7f\u7528\u7684\u8bdd\uff0c\u6bcf\u4e00\u4e2a\u865a\u62df\u673a\u4f7f\u7528\u4e00\u4e2a\u6838\uff0c\u4e4b\u95f4\u4e92\u4e0d\u5e72\u6d89\u3002 \u4f7f\u7528Linux\u7684 Control Group \u6765\u9650\u5236\u865a\u62df\u673a\u5bf9\u5bbf\u4e3b\u673aCPU\u7684\u7528\u5ea6\u3002 \u78c1\u76d8IO \u66f4\u6539\u5185\u6838\u78c1\u76d8IO\u8c03\u5ea6\u65b9\u5f0f\uff1anoop\uff0ccfq\uff0cdeadline\u76f4\u63a5\u9009\u62e9\uff0c\u53c2\u8003 Linux Doc. \u3002 \u4f7f\u7528Linux\u7684 Control Group \u6765\u9650\u5236\u865a\u62df\u673a\u5bf9\u5bbf\u4e3b\u673a\u8bbe\u5907\u7684\u8bbf\u95ee\u3002 \u4f7f\u80fdcgroup\uff0c\u5047\u5982\u6ca1\u6709\u542f\u52a8\u7684\u8bdd\u3002 1 2 3 # mount tmpfs cgroup_root /sys/fs/cgroup # mkdir /sys/fs/cgroup/blkio # mount -t cgroup -o blkio none /sys/fs/cgroup/blkio \u521b\u5efa\u4e00\u4e2a1 Mbps\u7684IO\u9650\u5236\u7ec4\uff0cX:Y \u4e3aMAJOR:MINOR\u3002 1 2 3 # lsblk # mkdir -p /sys/fs/cgroup/blkio/limit1M/ # echo \"8:0 1048576\" > /sys/fs/cgroup/blkio/limit1M/blkio.throttle.write_bps_device \u5c06\u865a\u62df\u673a\u8fdb\u7a0b\u9644\u52a0\u5230\u9650\u5236\u7ec4\u3002 1 # echo $VM_PID > /sys/fs/cgroup/blkio/limit1M/tasks \u76ee\u524d\u6ca1\u6709\u5220\u9664task\u529f\u80fd\uff0c\u53ea\u80fd\u5c06\u5b83\u79fb\u5230\u6839\u7ec4\uff0c\u6216\u8005\u662f\u5220\u9664\u6b64\u7ec4\u3002 1 # echo $VM_PID > /sys/fs/cgroup/blkio/tasks \u66f4\u6539qemu drive cache\u3002 \u8bbe\u5907 \u4f7f\u7528Linux\u7684 Control Group \u6765\u9650\u5236\u865a\u62df\u673a\u5bf9\u5bbf\u4e3b\u673a\u8bbe\u5907\u7684\u8bbf\u95ee\u3002 \u8d44\u6e90\u7528\u5ea6\u3001\u8ba1\u8d39 \u7cfb\u7edf\u62a5\u544a\u4e3b\u8981\u662f\u5728scaling\uff08\u6d4b\u91cf\uff09\u3001charging\uff08\u8ba1\u8d39\uff09\u65f6\u4f7f\u7528\u3002 \u5728\u6d4b\u91cf\u65f6\u53ef\u4ee5\u4f7f\u7528\u5e73\u53f0\u63d0\u4f9b\u7684API\u3001\u6d4b\u91cf\u7ec4\u4ef6\uff0c\u7efc\u5408\u5229\u7528nagios/Icinga\uff0c\u4f7f\u7528Django\u5feb\u901f\u5f00\u53d1\u3002 oVirt\u53ef\u4ee5\u53c2\u8003ovirt-reports\uff0cOpenStack\u53c2\u8003\u5176Ceilometer\u3002 \u8ba1\u8d39\u6a21\u5757OpenStack\u53ef\u53c2\u8003\u65b0\u6d6a\u4e91\u7684 dough\u9879\u76ee \u3002 DeltaCloud/Libcloud\u6df7\u5408\u4e91 DeltaCloud\u652f\u6301\uff1a arubacloud azure ec2 rackspace terremark openstack fgcp eucalyptus digitalocean sbc mock condor rhevm google opennebula vsphere gogrid rimuhosting Libcloud\u652f\u6301\uff1a biquo PCextreme Azure Virtual machines Bluebox Blocks Brightbox CloudFrames CloudSigma (API v2.0) CloudStack DigitalOcean Dreamhost Amazon EC2 Enomaly Elastic Computing Platform ElasticHosts Eucalyptus Exoscale Gandi Google Compute Engine GoGrid HostVirtual HP Public Cloud (Helion) IBM SmartCloud Enterprise Ikoula Joyent Kili Public Cloud KTUCloud Libvirt Linode NephoScale Nimbus Ninefold OpenNebula (v3.8) OpenStack Opsource Outscale INC Outscale SAS ProfitBricks Rackspace Cloud RimuHosting ServerLove skalicloud SoftLayer vCloud VCL vCloud Voxel VoxCLOUD vps.net VMware vSphere Vultr DeltaCloud\u793a\u4f8b Libcloud\u793a\u4f8b SDN\u5b66\u4e60/mininet SDN\u5e7f\u6cdb\u7528\u5728\u5185\u5bb9\u52a0\u901f\u3001\u865a\u62df\u7f51\u7edc\u3001\u76d1\u63a7\u7b49\u9886\u57df\u3002 \u5173\u4e8eSDN\u6709\u8bb8\u591a\u5b66\u4e60\u5de5\u5177\uff1a mininet \u3001 POX \u3001 Netwrok Heresy Blog \u3002 \u5b66\u4e60\u89c6\u9891\uff1a Coursera SDN \u3002","title":"\u9644\u5f55\u4e8c \u516c\u6709\u4e91\u53c2\u8003"},{"location":"inthecloud/appendix02/#_1","text":"","title":"\u9644\u5f55\u4e8c \u516c\u6709\u4e91\u53c2\u8003"},{"location":"inthecloud/appendix02/#_2","text":"","title":"\u865a\u62df\u673a\u5360\u7528\u4e3b\u673a\u8d44\u6e90\u9694\u79bb"},{"location":"inthecloud/appendix02/#_3","text":"\u4f7f\u7528 VLAN \u3001 openvswitch \u8fdb\u884c\u9694\u79bb\u6216\u9650\u5236\u3002 \u4f7f\u7528tc\uff08Traffic Controller\uff09\u547d\u4ee4\u8fdb\u884c\u901f\u7387\u7684\u9650\u5236\uff0c\u8bb8\u591a\u865a\u62df\u5316\u5e73\u53f0\u4f7f\u7528\u7684\u90fd\u662f\u5b83\u3002","title":"\u7f51\u7edc"},{"location":"inthecloud/appendix02/#cpu","text":"\u4f7f\u7528CPU Pin\u53ef\u4ee5\u5c06\u7279\u5b9a\u865a\u62df\u6838\u56fa\u5b9a\u5728\u6307\u5b9a\u7269\u7406\u6838\u4e0a\u3002\u7ebf\u7a0b\u5f53\u4f5c\u6838\u6765\u4f7f\u7528\u7684\u8bdd\uff0c\u6bcf\u4e00\u4e2a\u865a\u62df\u673a\u4f7f\u7528\u4e00\u4e2a\u6838\uff0c\u4e4b\u95f4\u4e92\u4e0d\u5e72\u6d89\u3002 \u4f7f\u7528Linux\u7684 Control Group \u6765\u9650\u5236\u865a\u62df\u673a\u5bf9\u5bbf\u4e3b\u673aCPU\u7684\u7528\u5ea6\u3002","title":"CPU"},{"location":"inthecloud/appendix02/#io","text":"\u66f4\u6539\u5185\u6838\u78c1\u76d8IO\u8c03\u5ea6\u65b9\u5f0f\uff1anoop\uff0ccfq\uff0cdeadline\u76f4\u63a5\u9009\u62e9\uff0c\u53c2\u8003 Linux Doc. \u3002 \u4f7f\u7528Linux\u7684 Control Group \u6765\u9650\u5236\u865a\u62df\u673a\u5bf9\u5bbf\u4e3b\u673a\u8bbe\u5907\u7684\u8bbf\u95ee\u3002 \u4f7f\u80fdcgroup\uff0c\u5047\u5982\u6ca1\u6709\u542f\u52a8\u7684\u8bdd\u3002 1 2 3 # mount tmpfs cgroup_root /sys/fs/cgroup # mkdir /sys/fs/cgroup/blkio # mount -t cgroup -o blkio none /sys/fs/cgroup/blkio \u521b\u5efa\u4e00\u4e2a1 Mbps\u7684IO\u9650\u5236\u7ec4\uff0cX:Y \u4e3aMAJOR:MINOR\u3002 1 2 3 # lsblk # mkdir -p /sys/fs/cgroup/blkio/limit1M/ # echo \"8:0 1048576\" > /sys/fs/cgroup/blkio/limit1M/blkio.throttle.write_bps_device \u5c06\u865a\u62df\u673a\u8fdb\u7a0b\u9644\u52a0\u5230\u9650\u5236\u7ec4\u3002 1 # echo $VM_PID > /sys/fs/cgroup/blkio/limit1M/tasks \u76ee\u524d\u6ca1\u6709\u5220\u9664task\u529f\u80fd\uff0c\u53ea\u80fd\u5c06\u5b83\u79fb\u5230\u6839\u7ec4\uff0c\u6216\u8005\u662f\u5220\u9664\u6b64\u7ec4\u3002 1 # echo $VM_PID > /sys/fs/cgroup/blkio/tasks \u66f4\u6539qemu drive cache\u3002","title":"\u78c1\u76d8IO"},{"location":"inthecloud/appendix02/#_4","text":"\u4f7f\u7528Linux\u7684 Control Group \u6765\u9650\u5236\u865a\u62df\u673a\u5bf9\u5bbf\u4e3b\u673a\u8bbe\u5907\u7684\u8bbf\u95ee\u3002","title":"\u8bbe\u5907"},{"location":"inthecloud/appendix02/#_5","text":"\u7cfb\u7edf\u62a5\u544a\u4e3b\u8981\u662f\u5728scaling\uff08\u6d4b\u91cf\uff09\u3001charging\uff08\u8ba1\u8d39\uff09\u65f6\u4f7f\u7528\u3002 \u5728\u6d4b\u91cf\u65f6\u53ef\u4ee5\u4f7f\u7528\u5e73\u53f0\u63d0\u4f9b\u7684API\u3001\u6d4b\u91cf\u7ec4\u4ef6\uff0c\u7efc\u5408\u5229\u7528nagios/Icinga\uff0c\u4f7f\u7528Django\u5feb\u901f\u5f00\u53d1\u3002 oVirt\u53ef\u4ee5\u53c2\u8003ovirt-reports\uff0cOpenStack\u53c2\u8003\u5176Ceilometer\u3002 \u8ba1\u8d39\u6a21\u5757OpenStack\u53ef\u53c2\u8003\u65b0\u6d6a\u4e91\u7684 dough\u9879\u76ee \u3002","title":"\u8d44\u6e90\u7528\u5ea6\u3001\u8ba1\u8d39"},{"location":"inthecloud/appendix02/#deltacloudlibcloud","text":"DeltaCloud\u652f\u6301\uff1a arubacloud azure ec2 rackspace terremark openstack fgcp eucalyptus digitalocean sbc mock condor rhevm google opennebula vsphere gogrid rimuhosting Libcloud\u652f\u6301\uff1a biquo PCextreme Azure Virtual machines Bluebox Blocks Brightbox CloudFrames CloudSigma (API v2.0) CloudStack DigitalOcean Dreamhost Amazon EC2 Enomaly Elastic Computing Platform ElasticHosts Eucalyptus Exoscale Gandi Google Compute Engine GoGrid HostVirtual HP Public Cloud (Helion) IBM SmartCloud Enterprise Ikoula Joyent Kili Public Cloud KTUCloud Libvirt Linode NephoScale Nimbus Ninefold OpenNebula (v3.8) OpenStack Opsource Outscale INC Outscale SAS ProfitBricks Rackspace Cloud RimuHosting ServerLove skalicloud SoftLayer vCloud VCL vCloud Voxel VoxCLOUD vps.net VMware vSphere Vultr","title":"DeltaCloud/Libcloud\u6df7\u5408\u4e91"},{"location":"inthecloud/appendix02/#deltacloud","text":"","title":"DeltaCloud\u793a\u4f8b"},{"location":"inthecloud/appendix02/#libcloud","text":"","title":"Libcloud\u793a\u4f8b"},{"location":"inthecloud/appendix02/#sdnmininet","text":"SDN\u5e7f\u6cdb\u7528\u5728\u5185\u5bb9\u52a0\u901f\u3001\u865a\u62df\u7f51\u7edc\u3001\u76d1\u63a7\u7b49\u9886\u57df\u3002 \u5173\u4e8eSDN\u6709\u8bb8\u591a\u5b66\u4e60\u5de5\u5177\uff1a mininet \u3001 POX \u3001 Netwrok Heresy Blog \u3002 \u5b66\u4e60\u89c6\u9891\uff1a Coursera SDN \u3002","title":"SDN\u5b66\u4e60/mininet"},{"location":"inthecloud/appendix03/","text":"\u9644\u5f55\u4e09 PaaS/OpenShift \u8fd9\u662f\u4ec0\u4e48 \u8bbe\u60f3\uff0c\u4f60\u6709\u4e00\u4e2a\u516c\u7f51\u4e3b\u673a\uff0c\u4e0a\u9762\u914d\u7f6e\u4e86Apache/Nginx\uff0c\u540c\u65f6\u4e0a\u9762\u4f60\u88c5\u7684\u6709Ruby\u3001JBoss\u3001Python\u7b49\u73af\u5883\uff0c\u5e73\u65f6\u4f60\u7528\u5b83\u4f5c\u4f60\u81ea\u5df1\u7684\u5e94\u7528\u53d1\u5e03\u3002\u67d0\u4e00\u5929\uff0c\u4f60\u7684\u670b\u53cb\u8bf4\u4ed6\u4e5f\u6709\u4e00\u4e2aDjango\u5e94\u7528\u8981\u53d1\u5e03\uff0c\u95ee\u4f60\u8981\u4e00\u4e2a\u73af\u5883\uff0c\u4f60\u5c31\u5728\u4f60\u7684\u4e3b\u673a\u4e0a\u914d\u7f6e\u4e86VirtualHost\u6765\u89e3\u6790xiaoli.myhost.com\u5230/var/www/django/xiaoli\u8fd9\u4e2a\u76ee\u5f55\u4e0b\uff0c\u7136\u540e\u4ed6\u5c31\u8bf7\u4f60\u53bb\u5403\u4e2a\u70e4\u7f8a\u817f\u4e86\u3002\u540e\u6765\uff0c\u53c8\u4e00\u4e2a\u670b\u53cb\u95ee\u4f60\u8981\u8fd9\u6837\u7684\u73af\u5883\uff0c\u4f46\u662f\u8fd9\u6b21\u662fphp\uff0c\u4f60\u5c31\u628a/var/www/html/php/zhangsan\u8fd9\u4e2a\u76ee\u5f55\u7ed9\u4ed6\u4e86\uff0c\u8fd9\u6b21\u8bf7\u4f60\u5403\u9ebb\u8fa3\u70eb\u3002\u518d\u540e\u6765\uff0c\u95ee\u4f60\u8981\u73af\u5883\u7684\u670b\u53cb\u8d8a\u6765\u8d8a\u591a\uff0c\u4f60\u5c31\u53c8\u641e\u4e86\u4e00\u4e2a\u4e3b\u673a\uff0c\u540c\u65f6\u914d\u7f6e\u4e86\u4e00\u4e2a\u4ee3\u7406\u670d\u52a1\u6765\u89e3\u6790\u4e0d\u540c\u7684\u57df\u540d\u5230\u67d0\u4e2a\u4e3b\u673a\u7684\u76ee\u5f55\u4e0b\u3002\u67d0\u5929\u4f60\u5728\u516c\u4ea4\u8f66\u4e0a\u7684\u65f6\u5019\u5c31\u60f3\u4e86\uff0c\u6211\u4e3a\u4ec0\u4e48\u4e0d\u5199\u4e00\u4e2a\u5e94\u7528\u8ba9\u4ed6\u4eec\u81ea\u5df1\u6ce8\u518c\u9009\u62e9\u8bed\u8a00\u73af\u5883\u548c\u57df\u540d\u5462\uff1f\u4e8e\u662f\uff0c\u4f60\u5c31\u5f00\u59cb\u4e86\uff0c\u82b1\u4e86\u4e24\u5929\u65f6\u95f4\u7ec8\u4e8e\u641e\u5b9a\u3002\u7528\u7684\u4eba\u8d8a\u6765\u8d8a\u591a\uff0c\u4f60\u5403\u5f97\u4e5f\u4e5f\u8d8a\u6765\u8d8a\u80d6\u3002\u3002 \u8fd9\u6837\u4e00\u4e2a\u5e94\u7528\uff0c\u5c31\u662fPaaS\u7684\u539f\u578b\u3002 \u5f53\u524d\u7684\u5f62\u52bf \u9762\u5bf9\u56fd\u5185\u793e\u4ea4APP\u5fae\u4fe1\u7684\u706b\u7206\uff0c\u5bf9Web\u670d\u52a1\u5668\u7684\u9700\u6c42\u65e5\u76ca\u589e\u957f\uff0c\u540c\u6837\uff0c\u5f00\u53d1\u8005\u7684\u9700\u6c42\u73af\u5883\u4e5f\u6709\u6240\u5dee\u5f02\uff0c\u800c\u9762\u5bf9\u8fd9\u79cd\u5dee\u5f02\uff0c\u4e00\u4e2a\u66f4\u52a0\u7075\u6d3b\u7684\u5e73\u53f0\u5c31\u51fa\u73b0\u4e86\uff0c\u56fd\u5185\u6bd4\u5982SinaAPP\uff0c\u56fd\u5916\u6bd4\u5982Google APPEngine\uff0cRedhat OpenShift\uff0cAmazon AWS\u3002 OK\uff0c\u4e0d\u591a\u8bf4\u4e86\uff0c\u4e0b\u9762\u5f00\u59cb\u8bd5\u9a8cOpenShift\u7684\u670d\u52a1\u5668\u642d\u5efa\u53ca\u4e0a\u7ebf\u3002","title":"\u9644\u5f55\u4e09 PaaS/OpenShif"},{"location":"inthecloud/appendix03/#paasopenshift","text":"","title":"\u9644\u5f55\u4e09 PaaS/OpenShift"},{"location":"inthecloud/appendix03/#_1","text":"\u8bbe\u60f3\uff0c\u4f60\u6709\u4e00\u4e2a\u516c\u7f51\u4e3b\u673a\uff0c\u4e0a\u9762\u914d\u7f6e\u4e86Apache/Nginx\uff0c\u540c\u65f6\u4e0a\u9762\u4f60\u88c5\u7684\u6709Ruby\u3001JBoss\u3001Python\u7b49\u73af\u5883\uff0c\u5e73\u65f6\u4f60\u7528\u5b83\u4f5c\u4f60\u81ea\u5df1\u7684\u5e94\u7528\u53d1\u5e03\u3002\u67d0\u4e00\u5929\uff0c\u4f60\u7684\u670b\u53cb\u8bf4\u4ed6\u4e5f\u6709\u4e00\u4e2aDjango\u5e94\u7528\u8981\u53d1\u5e03\uff0c\u95ee\u4f60\u8981\u4e00\u4e2a\u73af\u5883\uff0c\u4f60\u5c31\u5728\u4f60\u7684\u4e3b\u673a\u4e0a\u914d\u7f6e\u4e86VirtualHost\u6765\u89e3\u6790xiaoli.myhost.com\u5230/var/www/django/xiaoli\u8fd9\u4e2a\u76ee\u5f55\u4e0b\uff0c\u7136\u540e\u4ed6\u5c31\u8bf7\u4f60\u53bb\u5403\u4e2a\u70e4\u7f8a\u817f\u4e86\u3002\u540e\u6765\uff0c\u53c8\u4e00\u4e2a\u670b\u53cb\u95ee\u4f60\u8981\u8fd9\u6837\u7684\u73af\u5883\uff0c\u4f46\u662f\u8fd9\u6b21\u662fphp\uff0c\u4f60\u5c31\u628a/var/www/html/php/zhangsan\u8fd9\u4e2a\u76ee\u5f55\u7ed9\u4ed6\u4e86\uff0c\u8fd9\u6b21\u8bf7\u4f60\u5403\u9ebb\u8fa3\u70eb\u3002\u518d\u540e\u6765\uff0c\u95ee\u4f60\u8981\u73af\u5883\u7684\u670b\u53cb\u8d8a\u6765\u8d8a\u591a\uff0c\u4f60\u5c31\u53c8\u641e\u4e86\u4e00\u4e2a\u4e3b\u673a\uff0c\u540c\u65f6\u914d\u7f6e\u4e86\u4e00\u4e2a\u4ee3\u7406\u670d\u52a1\u6765\u89e3\u6790\u4e0d\u540c\u7684\u57df\u540d\u5230\u67d0\u4e2a\u4e3b\u673a\u7684\u76ee\u5f55\u4e0b\u3002\u67d0\u5929\u4f60\u5728\u516c\u4ea4\u8f66\u4e0a\u7684\u65f6\u5019\u5c31\u60f3\u4e86\uff0c\u6211\u4e3a\u4ec0\u4e48\u4e0d\u5199\u4e00\u4e2a\u5e94\u7528\u8ba9\u4ed6\u4eec\u81ea\u5df1\u6ce8\u518c\u9009\u62e9\u8bed\u8a00\u73af\u5883\u548c\u57df\u540d\u5462\uff1f\u4e8e\u662f\uff0c\u4f60\u5c31\u5f00\u59cb\u4e86\uff0c\u82b1\u4e86\u4e24\u5929\u65f6\u95f4\u7ec8\u4e8e\u641e\u5b9a\u3002\u7528\u7684\u4eba\u8d8a\u6765\u8d8a\u591a\uff0c\u4f60\u5403\u5f97\u4e5f\u4e5f\u8d8a\u6765\u8d8a\u80d6\u3002\u3002 \u8fd9\u6837\u4e00\u4e2a\u5e94\u7528\uff0c\u5c31\u662fPaaS\u7684\u539f\u578b\u3002","title":"\u8fd9\u662f\u4ec0\u4e48"},{"location":"inthecloud/appendix03/#_2","text":"\u9762\u5bf9\u56fd\u5185\u793e\u4ea4APP\u5fae\u4fe1\u7684\u706b\u7206\uff0c\u5bf9Web\u670d\u52a1\u5668\u7684\u9700\u6c42\u65e5\u76ca\u589e\u957f\uff0c\u540c\u6837\uff0c\u5f00\u53d1\u8005\u7684\u9700\u6c42\u73af\u5883\u4e5f\u6709\u6240\u5dee\u5f02\uff0c\u800c\u9762\u5bf9\u8fd9\u79cd\u5dee\u5f02\uff0c\u4e00\u4e2a\u66f4\u52a0\u7075\u6d3b\u7684\u5e73\u53f0\u5c31\u51fa\u73b0\u4e86\uff0c\u56fd\u5185\u6bd4\u5982SinaAPP\uff0c\u56fd\u5916\u6bd4\u5982Google APPEngine\uff0cRedhat OpenShift\uff0cAmazon AWS\u3002 OK\uff0c\u4e0d\u591a\u8bf4\u4e86\uff0c\u4e0b\u9762\u5f00\u59cb\u8bd5\u9a8cOpenShift\u7684\u670d\u52a1\u5668\u642d\u5efa\u53ca\u4e0a\u7ebf\u3002","title":"\u5f53\u524d\u7684\u5f62\u52bf"},{"location":"inthecloud/appendix04/","text":"\u9644\u5f55\u56db Docker \u4f7f\u7528\u53ca\u81ea\u5efarepo Docker\u5df2\u7ecf\u8d8a\u6765\u8d8a\u6d41\u884c\u4e86\uff08IaaS\u5e73\u53f0\u5f00\u59cb\u652f\u6301\u5b83\uff0cPaaS\u5e73\u53f0\u4e5f\u5f00\u59cb\u652f\u6301\u5b83\uff09\uff0c\u4e0d\u4ecb\u7ecd\u5b83\u603b\u611f\u89c9\u8fc7\u4e0d\u53bb\u3002 \u5b83\u662f\u57fa\u4e8eLXC\u7684\u5bb9\u5668\u7c7b\u578b\u865a\u62df\u5316\u6280\u672f\uff0c\u4ece\u5b9e\u73b0\u4e0a\u8bf4\u66f4\u7c7b\u4f3c\u4e8echroot\uff0c\u7528\u6237\u7a7a\u95f4\u7684\u4fe1\u606f\u88ab\u5f88\u597d\u9694\u79bb\u7684\u540c\u65f6\uff0c\u53c8\u5b9e\u73b0\u4e86\u7f51\u7edc\u76f8\u5173\u7684\u5206\u79bb\u3002\u5b83\u53d6\u4ee3LXC\u7684\u539f\u56e0\uff0c\u6211\u60f3\u662f\u56e0\u4e3a\u5176REPO\u975e\u5e38\u4e30\u5bcc\uff0c\u64cd\u4f5c\u4e0a\u7c7b\u4f3cgit\u3002 \u53e6\u5916\uff0c\u5b83\u6709\u63d0\u4f9bWindows/MacOSX\u7684\u5ba2\u6237\u7aef boot2docker\u3002 \u4e2d\u6587\u5165\u95e8\u624b\u518c\u8bf7\u53c2\u8003 Docker\u4e2d\u6587\u6307\u5357 \uff0c\u53e6\u5916\u5b83\u6709\u4e00\u4e2aWebUI shipyard \u3002 \u5b98\u65b9repo https://registry.hub.docker.com/ \u3002 \u955c\u50cf\u64cd\u4f5c \u8fd0\u884c\u7b80\u5355\u547d\u4ee4 1 docker run ubuntu /bin/echo \"Hello world!\" \u8fd0\u884c\u4ea4\u4e92shell 1 docker run -t -i ubuntu /bin/bash \u8fd0\u884cDjango\u7a0b\u5e8f 1 docker run -d -P training/webapp python app.py \u83b7\u53d6container\u4fe1\u606f 1 docker ps \u83b7\u53d6container\u5185\u90e8\u4fe1\u606f 1 docker inspect -f '{{ .NetworkSettings.IPAddress }}' my_container \u83b7\u53d6container\u5386\u53f2 1 docker log my_container commit/save/load :::{note} \u4fdd\u5b58 \u53ea\u6709commit\uff0c\u5bf9docker\u505a\u7684\u4fee\u6539\u624d\u4f1a\u4fdd\u5b58\uff0c\u5f62\u5982docker run centos yum install -y nmap\u4e0d\u4f1a\u4fdd\u5b58\u3002 ::: 1 2 3 4 docker images docker commit $image_id$ myimage docker save myimage > myimage.tar docker load < myimage.tar Registry\u64cd\u4f5c \u767b\u5f55\uff0c\u9ed8\u8ba4\u4e3aDockerHub 1 docker login \u521b\u5efaRegistry \u53c2\u8003 https://www.digitalocean.com/community/tutorials/how-to-set-up-a-private-docker-registry-on-ubuntu-14-04 \u4ee5\u53ca http://blog.docker.com/2013/07/how-to-use-your-own-registry/ \u3002 1 2 3 4 5 6 7 # \u83b7\u53d6docker-registry\uff0c\u4ecegithub\u6216\u8005\u76f4\u63a5 pip install docker-registry # git clone https://github.com/dotcloud/docker-registry.git # cd docker-registry # cp config_sample.yml config.yml # pip install -r requirements.txt # gunicorn --access-logfile - --log-level debug --debug -b 0.0.0.0:5000 -w 1 wsgi:application push/pull 1 2 3 # docker pull ubuntu # docker tag ubuntu localhost:5000/ubuntu # docker push localhost:5000/ubuntu","title":"\u9644\u5f55\u56db  Docker \u4f7f\u7528\u53ca\u81ea\u5efarepo"},{"location":"inthecloud/appendix04/#docker-repo","text":"Docker\u5df2\u7ecf\u8d8a\u6765\u8d8a\u6d41\u884c\u4e86\uff08IaaS\u5e73\u53f0\u5f00\u59cb\u652f\u6301\u5b83\uff0cPaaS\u5e73\u53f0\u4e5f\u5f00\u59cb\u652f\u6301\u5b83\uff09\uff0c\u4e0d\u4ecb\u7ecd\u5b83\u603b\u611f\u89c9\u8fc7\u4e0d\u53bb\u3002 \u5b83\u662f\u57fa\u4e8eLXC\u7684\u5bb9\u5668\u7c7b\u578b\u865a\u62df\u5316\u6280\u672f\uff0c\u4ece\u5b9e\u73b0\u4e0a\u8bf4\u66f4\u7c7b\u4f3c\u4e8echroot\uff0c\u7528\u6237\u7a7a\u95f4\u7684\u4fe1\u606f\u88ab\u5f88\u597d\u9694\u79bb\u7684\u540c\u65f6\uff0c\u53c8\u5b9e\u73b0\u4e86\u7f51\u7edc\u76f8\u5173\u7684\u5206\u79bb\u3002\u5b83\u53d6\u4ee3LXC\u7684\u539f\u56e0\uff0c\u6211\u60f3\u662f\u56e0\u4e3a\u5176REPO\u975e\u5e38\u4e30\u5bcc\uff0c\u64cd\u4f5c\u4e0a\u7c7b\u4f3cgit\u3002 \u53e6\u5916\uff0c\u5b83\u6709\u63d0\u4f9bWindows/MacOSX\u7684\u5ba2\u6237\u7aef boot2docker\u3002 \u4e2d\u6587\u5165\u95e8\u624b\u518c\u8bf7\u53c2\u8003 Docker\u4e2d\u6587\u6307\u5357 \uff0c\u53e6\u5916\u5b83\u6709\u4e00\u4e2aWebUI shipyard \u3002 \u5b98\u65b9repo https://registry.hub.docker.com/ \u3002","title":"\u9644\u5f55\u56db  Docker \u4f7f\u7528\u53ca\u81ea\u5efarepo"},{"location":"inthecloud/appendix04/#_1","text":"\u8fd0\u884c\u7b80\u5355\u547d\u4ee4 1 docker run ubuntu /bin/echo \"Hello world!\" \u8fd0\u884c\u4ea4\u4e92shell 1 docker run -t -i ubuntu /bin/bash \u8fd0\u884cDjango\u7a0b\u5e8f 1 docker run -d -P training/webapp python app.py \u83b7\u53d6container\u4fe1\u606f 1 docker ps \u83b7\u53d6container\u5185\u90e8\u4fe1\u606f 1 docker inspect -f '{{ .NetworkSettings.IPAddress }}' my_container \u83b7\u53d6container\u5386\u53f2 1 docker log my_container commit/save/load :::{note} \u4fdd\u5b58 \u53ea\u6709commit\uff0c\u5bf9docker\u505a\u7684\u4fee\u6539\u624d\u4f1a\u4fdd\u5b58\uff0c\u5f62\u5982docker run centos yum install -y nmap\u4e0d\u4f1a\u4fdd\u5b58\u3002 ::: 1 2 3 4 docker images docker commit $image_id$ myimage docker save myimage > myimage.tar docker load < myimage.tar","title":"\u955c\u50cf\u64cd\u4f5c"},{"location":"inthecloud/appendix04/#registry","text":"\u767b\u5f55\uff0c\u9ed8\u8ba4\u4e3aDockerHub 1 docker login \u521b\u5efaRegistry \u53c2\u8003 https://www.digitalocean.com/community/tutorials/how-to-set-up-a-private-docker-registry-on-ubuntu-14-04 \u4ee5\u53ca http://blog.docker.com/2013/07/how-to-use-your-own-registry/ \u3002 1 2 3 4 5 6 7 # \u83b7\u53d6docker-registry\uff0c\u4ecegithub\u6216\u8005\u76f4\u63a5 pip install docker-registry # git clone https://github.com/dotcloud/docker-registry.git # cd docker-registry # cp config_sample.yml config.yml # pip install -r requirements.txt # gunicorn --access-logfile - --log-level debug --debug -b 0.0.0.0:5000 -w 1 wsgi:application push/pull 1 2 3 # docker pull ubuntu # docker tag ubuntu localhost:5000/ubuntu # docker push localhost:5000/ubuntu","title":"Registry\u64cd\u4f5c"},{"location":"inthecloud/appendix05/","text":"\u9644\u5f55\u4e94 \u5e38\u7528\u529f\u80fd\u8fd0\u7ef4\u5de5\u5177 Foreman \u90e8\u7f72\u6307\u5bfc Katello \u90e8\u7f72\u6307\u5bfc \u6570\u636e\u6062\u590d\u5de5\u5177 extundelete \u5e38\u7528\u6027\u80fd\u6d4b\u91cf\u53ca\u4f18\u5316\u5de5\u5177 \u4f18\u5316 ```{image} ../images/apx01-09.jpg 1 2 3 - \u76d1\u89c6 ```{image} ../images/apx01-10.jpg \u6d4b\u8bd5 ```{image} ../images/apx01-11.jpg 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 all in one - pip install glances \u53e6\u5916\u9488\u5bf9qemu/libvirt\u76f8\u5173\u7684\u6d4b\u8bd5\u5de5\u5177\uff0c\u53ef\u4ee5\u53c2\u8003 [virt-test](<https://github.com/autotest/virt-test>) \uff0c\u5f53\u7136\uff0c\u4ec5\u4f5c\u53c2\u8003\u3002 ## HAProxy \u6ca1\u9519\uff0c\u6211\u5c31\u662f\u8981\u628a\u8fd9\u4e2a\u4e1c\u897f\u5355\u5217\u51fa\u6765\u8bb2\uff0c\u56e0\u4e3a\u4f60\u53ef\u4ee5\u7528\u8fd9\u4e2a\u4e1c\u897f\u6765\u505a\u51e0\u4e4e\u5168\u90e8\u5e94\u7528\u7684HA\u6216\u8005LoadBalancer\uff0c {}`\u8fd9\u91cc\u662f\u914d\u7f6e\u8bf4\u660e <http://www.haproxy.org/download/1.4/doc/configuration.txt>` \u3002 \u4ee3\u7406http: ```{code} ... backend webbackend balance roundrobin server web1 192.168.0.130:80 check frontend http bind *:80 mode http default_backend webbackend listen stats :8080 balance mode http stats enable stats auth me:password \u4ee3\u7406tcp: 1 2 3 4 5 6 listen *:3306 mode tcp option tcplog balance roundrobin server smtp 192.168.0.1:3306 check server smtp1 192.168.0.2:3306 check \u5e38\u7528\u8fd0\u7ef4\u5de5\u5177 Monit \u5c0f\u578b\u76d1\u63a7\u5de5\u5177\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002 Munin \u8f7b\u91cf\u7ea7\u7684\u76d1\u63a7\u5de5\u5177\u3002 Cacti \u4e0eZabbix\u5728\u67d0\u4e9b\u65b9\u9762\u5f88\u50cf\u3002 Ganglia \u6bd4\u8f83\u4e13\u4e1a\u7684\u76d1\u63a7\u5de5\u5177\uff0c\u5e76\u6709\u4e00\u6b3e\u4e13\u95e8\u9488\u5bf9\u865a\u62df\u673a\u7684\u5e94\u7528\u3002 http://blog.sflow.com/2012/01/using-ganglia-to-monitor-virtual.html zabbix \u7c7b\u4f3cNagios\uff0c\u4e0d\u8fc7\u56fe\u5f62\u7ed8\u5236\u5f88\u5f3a\uff0c\u5728\u4e00\u952e\u811a\u672c\u4e2d\u63d0\u4f9b\u5b89\u88c5\u3002 \u79fb\u52a8\u5ba2\u6237\u7aef\u4e0b\u8f7d \u3002 \u5173\u4e8ezabbix\u7684\u66f4\u591a\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 itnihao\u7684\u76f8\u5173\u8457\u4f5c \u3002 nagios \u4f7f\u7528UI Plugin\u53ef\u4ee5\u5c06\u5728oVirt\u7ba1\u7406\u754c\u9762\u4e2d\u67e5\u770bNagios\u76d1\u63a7\u72b6\u6001\uff0c\u53ef\u53c2\u8003 oVirt_Monitoring_UI_Plugin \u4ee5\u53ca Nagios_Intergration \u3002 foreman \u4f7f\u7528Foreman\u7684\u4e3b\u8981\u76ee\u7684\u662f\u66f4\u65b9\u4fbf\u5730\u90e8\u7f72\u5bbf\u4e3b\u673a\u4ee5\u53ca\u521b\u5efa\u865a\u62df\u673a\u3002 \u53c2\u8003 ForemanIntegration \u3001 foreman_ovirt \u4ee5\u53caUIPlugin\u76f8\u5173\u5185\u5bb9\u3002 chef \u7b80\u5355\u7406\u89e3\u4e3a\u4e00\u4e9b\u5217\u5b89\u88c5\u811a\u672c\uff08cookbook\uff09\u3002 \u8bbf\u95ee http://gettingstartedwithchef.com/ \u5f00\u59cb\u5feb\u901f\u4e0a\u624b\u5b66\u4e60\u3002 \u83b7\u53d6\u66f4\u591acookbook \u3002 puppet \u529f\u80fd\u4e0a\u4e0echef\u7c7b\u4f3c\uff0c\u4f46\u662f\u5f71\u54cd\u529b\u66f4\u5927\u3002 \u4e0b\u8f7d\u865a\u62df\u673a \u5e76\u6309\u7167\u91cc\u9762\u7684\u6559\u7a0b\u6765\u5feb\u901f\u4e0a\u624b\u3002","title":"\u9644\u5f55\u4e94 \u5e38\u7528\u529f\u80fd\u8fd0\u7ef4\u5de5\u5177"},{"location":"inthecloud/appendix05/#_1","text":"","title":"\u9644\u5f55\u4e94 \u5e38\u7528\u529f\u80fd\u8fd0\u7ef4\u5de5\u5177"},{"location":"inthecloud/appendix05/#foreman","text":"","title":"Foreman \u90e8\u7f72\u6307\u5bfc"},{"location":"inthecloud/appendix05/#katello","text":"","title":"Katello \u90e8\u7f72\u6307\u5bfc"},{"location":"inthecloud/appendix05/#_2","text":"extundelete","title":"\u6570\u636e\u6062\u590d\u5de5\u5177"},{"location":"inthecloud/appendix05/#_3","text":"\u4f18\u5316 ```{image} ../images/apx01-09.jpg 1 2 3 - \u76d1\u89c6 ```{image} ../images/apx01-10.jpg \u6d4b\u8bd5 ```{image} ../images/apx01-11.jpg 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 all in one - pip install glances \u53e6\u5916\u9488\u5bf9qemu/libvirt\u76f8\u5173\u7684\u6d4b\u8bd5\u5de5\u5177\uff0c\u53ef\u4ee5\u53c2\u8003 [virt-test](<https://github.com/autotest/virt-test>) \uff0c\u5f53\u7136\uff0c\u4ec5\u4f5c\u53c2\u8003\u3002 ## HAProxy \u6ca1\u9519\uff0c\u6211\u5c31\u662f\u8981\u628a\u8fd9\u4e2a\u4e1c\u897f\u5355\u5217\u51fa\u6765\u8bb2\uff0c\u56e0\u4e3a\u4f60\u53ef\u4ee5\u7528\u8fd9\u4e2a\u4e1c\u897f\u6765\u505a\u51e0\u4e4e\u5168\u90e8\u5e94\u7528\u7684HA\u6216\u8005LoadBalancer\uff0c {}`\u8fd9\u91cc\u662f\u914d\u7f6e\u8bf4\u660e <http://www.haproxy.org/download/1.4/doc/configuration.txt>` \u3002 \u4ee3\u7406http: ```{code} ... backend webbackend balance roundrobin server web1 192.168.0.130:80 check frontend http bind *:80 mode http default_backend webbackend listen stats :8080 balance mode http stats enable stats auth me:password \u4ee3\u7406tcp: 1 2 3 4 5 6 listen *:3306 mode tcp option tcplog balance roundrobin server smtp 192.168.0.1:3306 check server smtp1 192.168.0.2:3306 check","title":"\u5e38\u7528\u6027\u80fd\u6d4b\u91cf\u53ca\u4f18\u5316\u5de5\u5177"},{"location":"inthecloud/appendix05/#_4","text":"","title":"\u5e38\u7528\u8fd0\u7ef4\u5de5\u5177"},{"location":"inthecloud/appendix05/#monit","text":"\u5c0f\u578b\u76d1\u63a7\u5de5\u5177\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002","title":"Monit"},{"location":"inthecloud/appendix05/#munin","text":"\u8f7b\u91cf\u7ea7\u7684\u76d1\u63a7\u5de5\u5177\u3002","title":"Munin"},{"location":"inthecloud/appendix05/#cacti","text":"\u4e0eZabbix\u5728\u67d0\u4e9b\u65b9\u9762\u5f88\u50cf\u3002","title":"Cacti"},{"location":"inthecloud/appendix05/#ganglia","text":"\u6bd4\u8f83\u4e13\u4e1a\u7684\u76d1\u63a7\u5de5\u5177\uff0c\u5e76\u6709\u4e00\u6b3e\u4e13\u95e8\u9488\u5bf9\u865a\u62df\u673a\u7684\u5e94\u7528\u3002 http://blog.sflow.com/2012/01/using-ganglia-to-monitor-virtual.html","title":"Ganglia"},{"location":"inthecloud/appendix05/#zabbix","text":"\u7c7b\u4f3cNagios\uff0c\u4e0d\u8fc7\u56fe\u5f62\u7ed8\u5236\u5f88\u5f3a\uff0c\u5728\u4e00\u952e\u811a\u672c\u4e2d\u63d0\u4f9b\u5b89\u88c5\u3002 \u79fb\u52a8\u5ba2\u6237\u7aef\u4e0b\u8f7d \u3002 \u5173\u4e8ezabbix\u7684\u66f4\u591a\u4ecb\u7ecd\u53ef\u4ee5\u53c2\u8003 itnihao\u7684\u76f8\u5173\u8457\u4f5c \u3002","title":"zabbix"},{"location":"inthecloud/appendix05/#nagios","text":"\u4f7f\u7528UI Plugin\u53ef\u4ee5\u5c06\u5728oVirt\u7ba1\u7406\u754c\u9762\u4e2d\u67e5\u770bNagios\u76d1\u63a7\u72b6\u6001\uff0c\u53ef\u53c2\u8003 oVirt_Monitoring_UI_Plugin \u4ee5\u53ca Nagios_Intergration \u3002","title":"nagios"},{"location":"inthecloud/appendix05/#foreman_1","text":"\u4f7f\u7528Foreman\u7684\u4e3b\u8981\u76ee\u7684\u662f\u66f4\u65b9\u4fbf\u5730\u90e8\u7f72\u5bbf\u4e3b\u673a\u4ee5\u53ca\u521b\u5efa\u865a\u62df\u673a\u3002 \u53c2\u8003 ForemanIntegration \u3001 foreman_ovirt \u4ee5\u53caUIPlugin\u76f8\u5173\u5185\u5bb9\u3002","title":"foreman"},{"location":"inthecloud/appendix05/#chef","text":"\u7b80\u5355\u7406\u89e3\u4e3a\u4e00\u4e9b\u5217\u5b89\u88c5\u811a\u672c\uff08cookbook\uff09\u3002 \u8bbf\u95ee http://gettingstartedwithchef.com/ \u5f00\u59cb\u5feb\u901f\u4e0a\u624b\u5b66\u4e60\u3002 \u83b7\u53d6\u66f4\u591acookbook \u3002","title":"chef"},{"location":"inthecloud/appendix05/#puppet","text":"\u529f\u80fd\u4e0a\u4e0echef\u7c7b\u4f3c\uff0c\u4f46\u662f\u5f71\u54cd\u529b\u66f4\u5927\u3002 \u4e0b\u8f7d\u865a\u62df\u673a \u5e76\u6309\u7167\u91cc\u9762\u7684\u6559\u7a0b\u6765\u5feb\u901f\u4e0a\u624b\u3002","title":"puppet"},{"location":"inthecloud/appendix06/","text":"\u9644\u5f55\u516d \u6587\u6863\u53c2\u8003\u8d44\u6e90\u4ee5\u53ca\u5efa\u8bae\u4e66\u5355 Server World \u4e00\u4e2a\u975e\u5e38\u597d\u7684\u7f51\u7ad9\uff0c\u542b\u6709\u5f88\u591a\u670d\u52a1\u7684\u5f88\u5177\u4f53\u7684\u642d\u5efa\u8fc7\u7a0b\uff0c\u5728\u5de5\u7a0b\u5b9e\u65bd\u4e2d\u53c2\u8003\u610f\u4e49\u6bd4\u8f83\u5927\u3002 OVF \u6587\u4e2d\u7684\u5168\u90e8\u8d44\u6e90\uff0c\u53ef\u4ee5\u8bbf\u95ee\u901a\u8fc7\u767e\u5ea6\u7f51\u76d8\u8fdb\u884c\u4e0b\u8f7d\u3002 \u94fe\u63a5: http://pan.baidu.com/s/1he23k \u5bc6\u7801: bmfn Qemu Doc qemu\u662fKVM\u865a\u62df\u673a\u7684\u57fa\u7840\u5957\u4ef6\uff0c\u5efa\u8bae\u901a\u8bfb\u5176 \u624b\u518c \u4e2d\u6240\u6709\u5185\u5bb9\u4ee5\u4e86\u7ed3\u5176\u7279\u6027\u3002 \u5feb\u901f\u5b89\u88c5\u811a\u672c https://github.com/lofyer/onekey-deploy.git \u76ee\u524d\u5305\u542b\uff1a Gitlab Zabbix oVirt Jarvis \u5e38\u7528\u722c\u866b https://github.com/lofyer/myspiders.git Django based WebAdmin https://github.com/lofyer/webadmin.git \u4e66\u5355 \u867d\u7136\u73b0\u5728\u7684\u79fb\u52a8\u8bbe\u5907\u5f88\u9002\u5408\u9605\u8bfb\uff0c\u4f46\u6211\u8fd8\u662f\u63a8\u8350\u591a\u770b\u4e9b\u5b9e\u4f53\u4e66\uff0c\u5c24\u5176\u662f\u4e00\u4e9b\u5927\u90e8\u5934\u3002 \u5f53\u7136\uff0c\u4e0b\u9762\u7684\u4e66\u76ee\u6211\u4f1a\u5c3d\u91cf\u63d0\u4f9b\u9002\u5408\u79fb\u52a8\u8bbe\u5907\u9605\u8bfb\u7684\u7248\u672c\uff08PDF\u3001MOBI\u3001EPUB\u3001TXT\uff09\u3002 TCP/IP Vol. 1/2/3 Machine Learning in Action Elements of Information Theory The Design of UNIX Operating System Understanding the Linux Kernel The Art of Computer Programming Vol. 1/2/3/4 Linux\u5185\u6838\u5b8c\u5168\u6ce8\u91ca \u6d6a\u6f6e\u4e4b\u5dc5 \u6570\u5b66\u4e4b\u7f8e UNIX\u73af\u5883\u9ad8\u7ea7\u7f16\u7a0b \u5b58\u50a8\u6280\u672f\u539f\u7406\u5206\u6790 Hadoop\u6743\u5a01\u6307\u5357 Weka\u5e94\u7528\u6280\u672f\u4e0e\u5b9e\u8df5 Python\u673a\u5668\u5b66\u4e60\u5b9e\u8df5 Model Thinking Practice Lisp","title":"\u9644\u5f55\u516d \u6587\u6863\u53c2\u8003\u8d44\u6e90\u4ee5\u53ca\u5efa\u8bae\u4e66\u5355"},{"location":"inthecloud/appendix06/#_1","text":"","title":"\u9644\u5f55\u516d \u6587\u6863\u53c2\u8003\u8d44\u6e90\u4ee5\u53ca\u5efa\u8bae\u4e66\u5355"},{"location":"inthecloud/appendix06/#server-world","text":"\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u7f51\u7ad9\uff0c\u542b\u6709\u5f88\u591a\u670d\u52a1\u7684\u5f88\u5177\u4f53\u7684\u642d\u5efa\u8fc7\u7a0b\uff0c\u5728\u5de5\u7a0b\u5b9e\u65bd\u4e2d\u53c2\u8003\u610f\u4e49\u6bd4\u8f83\u5927\u3002","title":"Server World"},{"location":"inthecloud/appendix06/#ovf","text":"\u6587\u4e2d\u7684\u5168\u90e8\u8d44\u6e90\uff0c\u53ef\u4ee5\u8bbf\u95ee\u901a\u8fc7\u767e\u5ea6\u7f51\u76d8\u8fdb\u884c\u4e0b\u8f7d\u3002 \u94fe\u63a5: http://pan.baidu.com/s/1he23k \u5bc6\u7801: bmfn","title":"OVF"},{"location":"inthecloud/appendix06/#qemu-doc","text":"qemu\u662fKVM\u865a\u62df\u673a\u7684\u57fa\u7840\u5957\u4ef6\uff0c\u5efa\u8bae\u901a\u8bfb\u5176 \u624b\u518c \u4e2d\u6240\u6709\u5185\u5bb9\u4ee5\u4e86\u7ed3\u5176\u7279\u6027\u3002","title":"Qemu Doc"},{"location":"inthecloud/appendix06/#_2","text":"https://github.com/lofyer/onekey-deploy.git \u76ee\u524d\u5305\u542b\uff1a Gitlab Zabbix oVirt Jarvis","title":"\u5feb\u901f\u5b89\u88c5\u811a\u672c"},{"location":"inthecloud/appendix06/#_3","text":"https://github.com/lofyer/myspiders.git","title":"\u5e38\u7528\u722c\u866b"},{"location":"inthecloud/appendix06/#django-based-webadmin","text":"https://github.com/lofyer/webadmin.git","title":"Django based WebAdmin"},{"location":"inthecloud/appendix06/#_4","text":"\u867d\u7136\u73b0\u5728\u7684\u79fb\u52a8\u8bbe\u5907\u5f88\u9002\u5408\u9605\u8bfb\uff0c\u4f46\u6211\u8fd8\u662f\u63a8\u8350\u591a\u770b\u4e9b\u5b9e\u4f53\u4e66\uff0c\u5c24\u5176\u662f\u4e00\u4e9b\u5927\u90e8\u5934\u3002 \u5f53\u7136\uff0c\u4e0b\u9762\u7684\u4e66\u76ee\u6211\u4f1a\u5c3d\u91cf\u63d0\u4f9b\u9002\u5408\u79fb\u52a8\u8bbe\u5907\u9605\u8bfb\u7684\u7248\u672c\uff08PDF\u3001MOBI\u3001EPUB\u3001TXT\uff09\u3002 TCP/IP Vol. 1/2/3 Machine Learning in Action Elements of Information Theory The Design of UNIX Operating System Understanding the Linux Kernel The Art of Computer Programming Vol. 1/2/3/4 Linux\u5185\u6838\u5b8c\u5168\u6ce8\u91ca \u6d6a\u6f6e\u4e4b\u5dc5 \u6570\u5b66\u4e4b\u7f8e UNIX\u73af\u5883\u9ad8\u7ea7\u7f16\u7a0b \u5b58\u50a8\u6280\u672f\u539f\u7406\u5206\u6790 Hadoop\u6743\u5a01\u6307\u5357 Weka\u5e94\u7528\u6280\u672f\u4e0e\u5b9e\u8df5 Python\u673a\u5668\u5b66\u4e60\u5b9e\u8df5 Model Thinking Practice Lisp","title":"\u4e66\u5355"},{"location":"inthecloud/appendix07/","text":"\u5f85\u6574\u7406\u6269\u5c55\u5185\u5bb9 \u53ef\u4fe1\u8ba1\u7b97\u7ec4\uff08TCG\uff09 NUMA Qemu - QMP \u901a\u4fe1\uff0c\u4ea4\u6362\u673a\u4e8c\u5c42\u76f4\u8fde","title":"\u5f85\u6574\u7406\u6269\u5c55\u5185\u5bb9"},{"location":"inthecloud/appendix07/#_1","text":"\u53ef\u4fe1\u8ba1\u7b97\u7ec4\uff08TCG\uff09 NUMA Qemu - QMP \u901a\u4fe1\uff0c\u4ea4\u6362\u673a\u4e8c\u5c42\u76f4\u8fde","title":"\u5f85\u6574\u7406\u6269\u5c55\u5185\u5bb9"},{"location":"inthecloud/ch01/","text":"\u7b2c\u4e00\u7ae0 \u968f\u4fbf\u8bf4\u4e9b\u4ec0\u4e48 \u672c\u4eba\u4e66\u5199\u8fc7\u7a0b\u4e2d\u4e5f\u5728\u63a5\u53d7\u65b0\u7684\u601d\u8003\u65b9\u5f0f\u65b9\u9762\u7684\u8bad\u7ec3\uff0c\u6240\u4ee5\u4ece\u5f00\u59cb\u5230\u7ed3\u5c3e\u96be\u514d\u6709\u4e9b\u6613\u5bdf\u89c9\u5230\u7684\u5199\u4f5c\u65b9\u5f0f\u53d8\u5316\u3002 \u6211\u5199\u8fd9\u4e2a\u7684\u5c3d\u91cf\u591a\u89e3\u91ca\u6982\u5ff5\u3001\u53ef\u91cd\u73b0\u7684\u64cd\u4f5c\u4ee5\u53ca\u5b66\u4e60\u6307\u5bfc\uff0c\u4ee5\u53ca\u63d0\u4f9b\u53d1\u73b0\u89e3\u51b3\u95ee\u9898\u7684\u601d\u8def\u3002\u5176\u4e2d\u5927\u90e8\u5206\u64cd\u4f5c\u7ec6\u8282\u6211\u5c3d\u91cf\u4f7f\u7528\u73b0\u6709\u516c\u53f8\u7684\u4ea7\u54c1\uff08\u6bd4\u5982Mirantis\u3001Cloudera\uff09\uff0c\u800c\u4e0d\u662f\u4ece\u6e90\u7801\u90e8\u7f72\uff0c\u56e0\u4e3a\u7248\u672c\u5347\u7ea7\u5e26\u6765\u7684\u914d\u7f6e\u7ec6\u8282\u95ee\u9898\u4ea4\u7ed9\u4ed6\u4eec\u5904\u7406\u4f1a\u66f4\u901a\u7528\u4e9b\u3002\u540c\u65f6\u6211\u73b0\u5728\u66f4\u503e\u5411\u4e8e\u4f7f\u7528\u73b0\u5b9e\u7684\u6a21\u578b\u6765\u89e3\u91ca\u6216\u8005\u6784\u5efa\u4e00\u4e2a\u539f\u7406\u6216\u8005\u662f\u67b6\u6784\uff0c\u4ece\u800c\u65b9\u4fbf\u8bb0\u5fc6\u548c\u6269\u5c55\u3002 1.1 \u6211\u6240\u770b\u5230\u7684 \u4ece07\u5e74\u90a3\u4f1a\u513f\uff0c\u751a\u81f3\u66f4\u65e9\uff0c\u62e5\u6709\u5343\u4e07\u7528\u6237\uff08\u5305\u62ec\u76d7\u7248\u53d7\u5bb3\u8005\u5728\u5185\uff09\u7684\u884c\u4e1a\u5148\u950bVMware\uff0c\u53c8\u6709Google\u6570\u636e\u4e2d\u5fc3\u4ee5\u53caAmazon\u5404\u79cd\u5728\u7ebf\u670d\u52a1\uff0c\u8fd9\u4e9b\u5b9e\u6253\u5b9e\u7684\u4e1c\u897f\u9075\u5faa\u8ba1\u7b97\u80fd\u529b\u7684\u6469\u5c14\u5b9a\u5f8b\uff0c\u518d\u987a\u5e94\u65e5\u76ca\u589e\u957f\u7684\u5546\u4e1a\u9700\u6c42\uff0c\u5c31\u6709\u4e86\u201c\u4e91\u201d\u548c\u201c\u5927\u6570\u636e\u201d\u8fd9\u4e24\u4e2a\u8ba9\u8bb8\u591a\u4f01\u4e1a\u518d\u6b21\u8e81\u52a8\u7684\u6982\u5ff5\u3002 \u4e0d\u7ba1\u5927\u5bb6\u90fd\u600e\u4e48\u770b\uff0c\u5148\u5f15\u7528\u4e00\u53e5\u5173\u4e8e\u201c\u5927\u6570\u636e\u201d\u7684\u7ecf\u5178\uff0c\u867d\u7136\u4e0e\u4e91\u8ba1\u7b97\u4e0d\u592a\u76f8\u5e72\uff1a \u201cBig Data is like teenage sex: everyone talks about it, nobody really knows how to do it, everyone thinks everyone else is doing it, so everyone claims they are doing it.\u201d \u6211\u59cb\u7ec8\u8ba4\u4e3a\u8ba4\u77e5\u5f88\u5927\u4e00\u90e8\u5206\u90fd\u6765\u81ea\u4e8e\u5b9e\u8df5\uff0c\u5373\u5148\u6709\u5b9e\u8df5\uff0c\u624d\u6765\u7406\u8bba\uff0c\u540c\u65f6\u7406\u8bba\u53ef\u4ee5\u88ab\u63d0\u9ad8\u88ab\u6539\u53d8\uff0c\u7136\u540e\u518d\u7528\u4e8e\u5b9e\u8df5\u3002 \u90a3\u5c31\u8fd9\u6837\uff0c \u4f46\u884c\u597d\u4e8b\uff0c\u83ab\u95ee\u524d\u7a0b \u3002 \u4f5c\u4e3a\u516c\u53f8\u7684\u4e00\u540d\u5c0f\u6280\u672f\u4eba\u5458\uff0c\u4ece\u5ba2\u6237\u4ea4\u6d41\u5230\u73b0\u573a\u90e8\u7f72\u3001\u4eceSDN\u4ea4\u6362\u673a\u5230Neutron\u3001\u4eceQEMU\u5230IAAS\uff0c\u6211\u90fd\u6709\u8fc7\u4e86\u89e3\u6216\u63a5\u89e6\uff0c\u5e76\u5c06\u5176\u8bb0\u5f55\u6210\u6587\uff0c\u662f\u603b\u7ed3\uff0c\u4ea6\u662f\u63a2\u7d22\u3002\u671f\u95f4\u96be\u514d\u4f1a\u6709\u8fd9\u6837\u6216\u8005\u90a3\u6837\u7684\u60f3\u6cd5\uff0c\u800c\u5c06\u8fd9\u4e9b\u60f3\u6cd5\u5b9e\u8df5\u51fa\u6765\u7684\u8fc7\u7a0b\u662f\u4f1a\u8ba9\u4eba\u89c9\u5f97\u751f\u6d3b\u4f9d\u65e7\u662f\u7f8e\u597d\u7684\u3002 \u63a5\u4e0b\u6765\u662f\u4ee5\u6211\u76ee\u524d\u6c34\u5e73\u80fd\u770b\u5230\u7684\uff1a \u548c\u591a\u6570\u884c\u4e1a\u4e00\u6837\uff0c\u4e0d\u7ba1\u54ea\u4e2a\u516c\u53f8\uff0c\u4ed6\u4eec\u6280\u672f\u548c\u5173\u7cfb\uff0c\u5728\u4e0d\u540c\u5ba2\u6237\u90a3\u91cc\u90fd\u6709\u4e0d\u540c\u7684\u6743\u91cd\uff0c\u8fd9\u70b9\u7684\u5357\u5317\u5dee\u5f02\u5c24\u4e3a\u660e\u663e\uff1b \u4ee5\u6211\u6240\u9047\u5230\u7684\u5ba2\u6237\u6765\u770b\uff0c\u90e8\u5206\u5ba2\u6237\u4e0d\u4f1a\u660e\u786e\u7684\u8bf4\u4f7f\u7528\u201c\u4e91\u201d\uff0c\u4ed6\u4eec\u7684\u9700\u6c42\u5728\u591a\u6570\u60c5\u51b5\u4e0b\u53ef\u4ee5\u6709\u8fd9\u6837\u6216\u8005\u90a3\u6837\u7684\u4f20\u7edf\u65b9\u6848\u66ff\u4ee3\uff1b\u660e\u786e\u8981\u6c42\u4f7f\u7528\u201c\u4e91\u201d\u7684\u5ba2\u6237\uff0c\u603b\u4f1a\u8981\u6c42\u5468\u8fb9\u6307\u6807\uff08\u7528\u6237\u63a5\u5165\u3001\u7ec8\u7aef\u534f\u8bae\u3001USB\u91cd\u5b9a\u5411\u3001\u89c6\u9891\u6d41\u5360\u7528\u5e26\u5bbd\u3001UPS\u3001\u5b58\u50a8\u590d\u7528\u7b49\uff09\u4ee5\u53ca\u5404\u79cd\u5404\u6837\u7684\u5b9a\u5236\uff0c\u8fd9\u662f\u56fd\u5185\u8bb8\u591a\u516c\u6709\u79c1\u6709\u6df7\u5408\u4e91\u5382\u5546\u7684\u4e00\u4e2a\u75db\u5904\uff1b \u4e91\u8ba1\u7b97\u7684\u672c\u610f\u4e0d\u662f\u865a\u62df\u673a\uff0c\u4e5f\u4e0d\u662f\u7ba1\u7406\u65b9\u4fbf\u7684\u96c6\u7fa4\uff0c\u56fd\u5185\u597d\u591a\u516c\u53f8\u641e\u7684\u4e91\u8ba1\u7b97\u90fd\u662f\u5728\u5356\u4f20\u7edf\u8ba1\u7b97\u673a\u96c6\u7fa4\u6240\u80fd\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u8981\u6709\u516c\u53f8\u6765\u5efa\u5206\u6c34\u5cad\u3002 \u5c3d\u91cf\u4e0d\u8981\u4ece\u6280\u672f\u89d2\u5ea6\u51fa\u53d1\u53bb\u7ed9\u5ba2\u6237\u63d0\u4f9b\u6280\u672f\uff0c\u800c\u662f\u53bb\u5173\u5fc3\u5ba2\u6237\u73b0\u5728\u9762\u4e34\u7684\u95ee\u9898\uff0c\u6211\u4eec\u518d\u63d0\u4f9b\u6280\u672f\u3002\uff08\u8fd9\u53e5\u8bf4\u7684\u4e0d\u597d\uff0c\u610f\u601d\u8fd8\u5dee\u70b9\uff09 \u6240\u4ee5\uff0c\u5728\u9700\u6c42\u4e0a\u7684\u7075\u6d3b\u53d8\u901a\uff0c\u4e5f\u662f\u6709\u4e9b\u8bb8\u91cd\u8981\u6027\u7684\uff0c \u4e0d\u8981\u628a\u6280\u672f\u4eba\u5458\u7684\u56fa\u6267\u5e26\u5230\u5ba2\u6237\u90a3 \u3002 1.2 \u4eca\u5929\u5929\u6c14\u600e\u6837 7:50 \u624b\u673a\u95f9\u94c3\u54cd\u4e86\uff0c\u968f\u4e4b\u800c\u6765\u7684\u662f\u4f60\u8ba2\u9605\u7684RSS\u3001Flipboard\u63a8\u9001\u7684\u65b0\u95fb\u3002\u968f\u624b\u7ffb\u9605\u4e0b\uff0c\u5b8c\u540eSiri\u8bf4\u4eca\u5929\u5929\u6c14\u633a\u6696\u548c\u7684\uff0c\u53ef\u4ee5\u7a7f\u4f60\u6700\u559c\u6b22\u7684\u9ad8\u9886\u6bdb\u8863\uff0c\u8d77\u5e8a\u3002 8:30 \u9ad8\u901f\u516c\u8def\u4e0a\uff0c\u5730\u56fe\u544a\u8bc9\u4f60\u524d\u65b9\u62e5\u5835\uff0c\u6b63\u597d\u8fd9\u65f6\u9886\u5bfc\u6253\u6765\u7535\u8bdd\uff0c\u4f60\u544a\u8bc9Siri\u8bf4\u201c\u63a5\u542c\u201d\u3002\u6302\u4e86\u7535\u8bdd\u4ee5\u540e\uff0c\u7ea2\u706f\u4eae\u4e86\uff0c\u6c7d\u8f66\u8bb0\u5f55\u4e0b\u4f60\u8fd9\u6b21\u5835\u8f66\u7684\u65f6\u95f4\uff0c\u5e76\u9ed8\u9ed8\u518d\u6b21\u8ba1\u7b97\u9884\u8ba1\u5230\u65f6\u3002 9:20 \u5230\u8fbe\u516c\u53f8\u95e8\u53e3\uff0c\u6ca1\u6709\u4fdd\u5b89\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u8fde\u63a5\u516c\u53f8LDAP\u670d\u52a1\u5668\u7684\u77b3\u5b54\u8bc6\u522b\u3002 10:00 \u6536\u5230\u4fe1\u606f\uff0c\u6765\u81ea\u697c\u4e0b\u5feb\u4ef6\u6d3e\u53d1\u67dc\uff0c\u4f60\u8ba2\u8d2d\u7684\u7403\u978b\u5230\u4e86\u3002 10:30 \u5ba2\u6237\u9884\u7ea6\u7684\u62dc\u8bbf\uff0c\u4f60\u544a\u8bc9Siri\u8bf4\u628a\u516c\u53f8\u5730\u5740\u5bfc\u822a\u8def\u7ebf\u53d1\u9001\u7ed9\u5ba2\u6237\u5f20\u4e09\u3002 11:10 \u901a\u8fc7\u516c\u53f8IM\u544a\u8bc9\u524d\u53f0\u4e34\u65f6\u5141\u8bb8\u8f66\u724c\u53f7\u4e3aK9031\u7684\u8f66\u8f86\u8fdb\u6765\u5e76\u53d1\u9001\u8f66\u4f4d\u4fe1\u606f\u7ed9\u5ba2\u6237\u3002 11:20 \u548c\u5ba2\u6237\u5728\u4e34\u65f6\u4f1a\u5ba2\u5385\u8c08\u8bdd\uff0c\u671f\u95f4\u4f60\u628a\u6f14\u8bf4\u5185\u5bb9\u901a\u8fc7\u624b\u52bf\uff08\u98df\u6307\u4e00\u5212\uff09\u63a8\u9001\u5230\u5ba2\u6237\u90ae\u7bb1\uff0c\u4ed6\u4eec\u611f\u5230\u5f88\u610f\u5916\uff08\u52a0\u5206\u70b9\uff09\u3002 12:30 \u5348\u9910\u65f6\u95f4\uff0cSiri\u8fd8\u8bb0\u5f97\u4f60\u5728\u51b3\u5fc3\u51cf\u80a5\u671f\u95f4\uff0c\u63d0\u9192\u4f60\u4e0d\u8981\u5403\u6700\u559c\u6b22\u7684\u7ea2\u70e7\u8089\uff0c\u672b\u4e86\u6765\u4e00\u53e5\u201c\u4e24\u4e2a\u4eba\u88ab\u8001\u864e\u8ffd\uff0c\u8c01\u6700\u5371\u9669\uff1fBingo\uff0c\u80d6\u7684\u90a3\u4e2a\u201d\u3002 14:30 \u6709\u5ba2\u6237\u5982\u7ea6\u9001\u6765\u4e8610T\u7684\u8d22\u52a1\u6570\u636e\uff0c\u4f60\u901a\u77e5\u6280\u672f\u90e8\u5c0f\u674e\u5bf9\u8fd9\u4e9b\u6570\u636e\u8fdb\u884c\u65b9\u6848II\u5904\u7406\uff0c\u767e\u5206\u4e4b30\u7684\u5904\u7406\u4efb\u52a1\u4ea4\u7ed9\u6b66\u6c49\u673a\u623f\u7684\u673a\u5668\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u4ece\u673a\u67dc\u5230\u4e3b\u677f\u90fd\u662f\u4f60\u4f9d\u7167\u8282\u80fd\u73af\u4fdd\u7684\u539f\u5219\u4e3b\u6301\u8bbe\u8ba1\u7684\u3002 16:00 Siri\u544a\u8bc9\u4f60\uff0c\u62b1\u6b49\uff0c\u516d\u70b9\u949f\u6709\u5c40\u90e8\u964d\u96e8\u3002 17:00 \u4f60\u628a\u4eca\u5929\u7684\u5907\u5fd8\u5f55\u5b58\u8fdb\u516c\u53f8\u6d3e\u53d1\u7ed9\u4f60\u7684\u865a\u62df\u684c\u9762\uff0c\u4e0b\u73ed\u3002 19:00 \u8001\u5a46\u5927\u4eba\u7684\u665a\u996d\u505a\u597d\u4e86\uff0c\u4f60\u4e5f\u518d\u6b21\u8fde\u4e0a\u865a\u62df\u684c\u9762\u628a\u5907\u5fd8\u5f55\u6574\u7406\u5f52\u6863\u3002 20:30 \u8dd1\u6b65\u7ed3\u675f\uff0c\u5b83\u544a\u8bc9\u4f60\u8fd9\u51e0\u5468\u6362\u5b63\u671f\u95f4\uff0c\u8981\u589e\u52a0\u8fd0\u52a8\u91cf\uff0c\u4f60\u8bf4\u201c\u53ef\u4ee5\u201d\u3002 23:00 \u4f11\u606f\uff0cSiri\u901a\u8fc7\u6587\u5b57\u6084\u6084\u544a\u8bc9\u4f60\uff0c\u660e\u5929\u7ed3\u5a5a\u7eaa\u5ff5\u65e5\uff0c\u8bb0\u4f4f\u3002 \u6240\u6709\u5df2\u77e5\u672a\u77e5\u7684\u6697\u6d41\uff0c\u8ba9\u4eba\u6709\u4e86\u7ee7\u7eed\u6298\u817e\u4e0b\u53bb\u7684\u6b32\u671b\u3002 \u6211\u662f\u4e00\u4e2a\u7740\u91cd\u5b9e\u8df5\u7684\u4eba\uff0c\u662f\u7684\uff0c\u6bd4\u5982\u78c1\u76d8\u4e0d\u62c6\u5f00\u7684\u8bdd\u6211\u53ef\u80fd\u5c31\u5bf9\u6247\u533a\u3001\u78c1\u9053\u3001\u67f1\u9762\u6ca1\u4ec0\u4e48\u6df1\u523b\u6982\u5ff5\uff08\u5176\u5b9e\u62c6\u4e86\u4e5f\u6ca1\u591a\u6df1\u523b\uff09\u3002\u6240\u4ee5\uff0c\u8fd9\u4e00\u4e9b\u5217\u6587\u7ae0\u5c06\u5c3d\u91cf\u4ece\u64cd\u4f5c\u6216\u8005\u73b0\u8c61\u4e2d\u603b\u7ed3\u89c4\u5f8b\u3002\u4e00\u4e9b\u539f\u7406\u6027\u7684\u4e1c\u897f\u4f1a\u5c3d\u91cf\u7528\u6211\u89c9\u5f97\u5bb9\u6613\u7406\u89e3\u7684\u5f62\u5f0f\u8868\u73b0\u51fa\u6765\u3002 ```{image} ../images/01-01.jpg :height: 373 :width: 300 :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u6574\u672c\u201c\u4e66\u201d\u7684\u7ed3\u6784\u5c06\u4f1a\u662f\u8fd9\u4e2a\u6837\u5b50\uff1a \u4ecb\u7ecd\u4e0b\u4e3b\u6d41\u201c\u4e91\u201d\u7684\u73b0\u72b6\uff0c\u4f1a\u5f15\u7528\u8bb8\u591a\u73b0\u6210\uff08\u5c3d\u91cf\uff09\u5ba2\u89c2\u7684\u4fe1\u606f\u7247\u6bb5\uff1b\u7545\u60f3\u4e00\u4e0b\uff1b\u4ece\u4e2d\u9009\u62e9\u90e8\u5206\u7ec4\u6210\u4e00\u4e2a\u5b8c\u6574\u7cfb\u7edf\uff0c\u8fdb\u884c\u642d\u5efa\uff08\u6216\u6a21\u62df\uff09\u5e76\u672c\u5730\u8c03\u4f18\uff08\u907f\u514d\u8fc7\u65e9\u4f18\u5316\uff09\uff1b\u907f\u514d\u70c2\u5c3e\uff0c\u7ed3\u5c3e\u9001\u4e24\u9996\u77ed\u8bd7\u5427\u3002 ## 1.3 \u6839\u636e\u9700\u6c42\u6765\u67b6\u6784 \u6240\u6709\u6211\u4eec\u6240\u9700\u8981\u7684\u4e1c\u897f\uff0c\u81f3\u6b64\u6709\u4e86\u4e00\u4e2a\u6574\u4f53\u7684\u5370\u8c61\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u5217\u4e3e\u51e0\u4e2a\u5173\u952e\u8bcd\uff0c\u4ece\u4e2d\u6311\u51fa\u4e00\u90e8\u5206\u6765\u7ec4\u5efa\u6211\u4eec\u201c\u4e91\u201d\u3002 - \u5b58\u50a8\uff1a\u5c06\u8981\u6784\u5efa\u7684\u57fa\u7840\u8bbe\u65bd\u7684\u57fa\u7840\uff0c\u6240\u4ee5\u4e00\u5b9a\u8981\u5bf9\u5176\u53ef\u7528\u6027\u53ca\u901f\u5ea6\u6709\u6240\u4fdd\u8bc1\u3002 - \u865a\u62df\u5316\uff1a\u901a\u8fc7\u8f6f\u4ef6\u6a21\u62df\u82af\u7247\u4ee5\u53ca\u5904\u7406\u5668\u7684\u8fd0\u884c\u7ed3\u6784\uff0c\u4f5c\u4e3a\u516b\u4e5d\u5341\u5e74\u4ee3\u751f\u4eba\uff08\u5ffd\u7136\u89c9\u5f97\u65f6\u95f4\u597d\u5feb\uff09\uff0c\u591a\u6570\u4eba\u6700\u719f\u6089\u7684\u5e94\u8be5\u662f\u7ea2\u767d\u673a\u6a21\u62df\u5668\u4e86\u5427\u3002 - \u96c6\u7fa4\uff1a\u8fd9\u4e2a\u6982\u5ff5\u91cc\u6709\u5e76\u884c\u8fd8\u6709\u5206\u5e03\uff0c\u4e24\u8005\u6bd4\u8f83\u660e\u663e\u7684\u533a\u522b\u662f\u662f\u5426\u5728\u67d0\u4e00\u65f6\u95f4\u6bb5\u5185\u6709\u5171\u540c\u7684\u8ba1\u7b97\u76ee\u7684\u3002 - \u6388\u6743\u670d\u52a1\uff1a\u73b0\u4ee3\u6570\u636e\u4e2d\u5fc3\u7684\u591a\u6570\u5e94\u7528\uff0c\u90fd\u9700\u8981\u7edf\u4e00\u7684\u7528\u6237\u6570\u636e\uff0c\u5982\u4f55\u5b89\u5168\u5730\u4f7f\u7528\u7edf\u4e00\u7684\u7528\u6237\u6570\u636e\uff0c\u4e5f\u662f\u6211\u4eec\u9700\u8981\u8003\u8651\u7684\u3002 - \u5b89\u5168\u4e0e\u53ef\u4fe1\uff1a\u5b89\u5168\u7684\u95ee\u9898\uff0c**\u5f88\u91cd\u8981**\u3002\u4e0d\u8981\u7b49\u5230\u54ea\u5929\u4fe1\u7528\u5361\u8d26\u6237\u88ab\u76d7\u5237\u624d\u53d1\u73b0\u5b89\u5168\u7684\u91cd\u8981\u6027\uff1b\u53ef\u4fe1\uff0c\u5373\u662f\u670d\u52a1\u63d0\u4f9b\u8005\u4e0e\u63a5\u53d7\u8005\u5177\u6709\u53ef\u4fe1\u7684\u7b2c\u4e09\u65b9\u63d0\u4f9b\u652f\u6301\u3002 - \u53ef\u6269\u5c55\uff1a\u8fd9\u91cc\u6709\u4e24\u4e2a\u5c42\u9762\uff0c\u4e00\u4e2a\u57fa\u7840\u8bbe\u65bd\u81ea\u8eab\u8ba1\u7b97\u4e0e\u5b58\u50a8\u80fd\u529b\u6269\u589e\uff0c\u53e6\u4e00\u4e2a\u662f\u4e0e\u5176\u4ed6\u4e91\u8ba1\u7b97\u5e73\u53f0\u7684\u6a21\u5757\u7ea7\u522b\u517c\u5bb9\u3002 - \u5916\u56f4\u8bbe\u5907\uff1a\u5bf9\u4e8e\u7279\u6b8a\u7684\u5e94\u7528\uff08\u73af\u5883\u76d1\u89c6\u3001\u8ba4\u8bc1\u3001GPU\u4f9d\u8d56\u5e94\u7528\u7b49\uff09\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e9b\u5916\u56f4\u8bbe\u5907\u6765\u8f85\u52a9\u5b8c\u6210\uff08usb\u8bbe\u5907\u3001\u663e\u5361\u7b49\uff09\u3002\u5bf9\u4e8e\u91cd\u8981\u8bbe\u5907\u6216\u8005\u975e\u5e38\u4f9d\u8d56\u603b\u7ebf\u5e26\u5bbd\u7684\u8bbe\u5907\uff08\u4ee4\u724c\u3001\u663e\u5361\u7b49\uff09\u7684\u5b89\u88c5\uff0c\u63a8\u8350\u5c06\u5176\u4e0e\u5b9e\u65bd\u5e94\u7528\u7684\u7269\u7406\u673a\u76f4\u63a5\u7ed1\u5b9a\uff0c\u5bf9\u4e8e\u5176\u4ed6\u8bbe\u5907\uff08U\u76d8\u3001\u6444\u50cf\u5934\u7b49\uff09\u63a8\u8350\u4f7f\u7528\u67d0\u4e00\u65e2\u5b9a\u7269\u7406\u673a\u8fdb\u884c\u57fa\u4e8eTCP/IP\u7684\u900f\u4f20\u3002 - \u7535\u6e90\u7ba1\u7406\uff1a\u7531\u4e8e\u96c6\u7fa4\u4e2d\u5b58\u5728\u4e2d\u592e\u7ba1\u7406\uff0c\u6240\u4ee5\u6709\u5fc5\u8981\u4f7f\u7528\u6805\u680f\uff08fencing\uff09\u53bb\u5173\u95ed\u4e0e\u7ba1\u7406\u5931\u53bb\u8054\u7cfb\u7684\u673a\u5668\uff0c\u9632\u6b62\u5176\u81ea\u5efa\u4e2d\u592e\u7ba1\u7406\u3002 - orchestration\uff1a\u5373\u9884\u914d\u7f6e\uff0c\u4e0d\u7ba1\u662f\u865a\u62df\u673a\u8fd8\u662f\u5e94\u7528\u7a0b\u5e8f\uff0c\u6211\u4eec\u7684\u76ee\u7684\u4e4b\u4e00\u5c31\u662f\u8fbe\u5230\u670d\u52a1\u7684\u5feb\u901f\u54cd\u5e94\u3002 \u5982\u6b64\u5212\u5206\u7684\u610f\u56fe\u662f\u4ec0\u4e48\u5462\uff1f**\u57fa\u7840\u8bbe\u65bd\uff0c\u5728\u4fdd\u8bc1\u5b89\u5168\u53ef\u9760\u7684\u524d\u63d0\u4e0b\uff0c\u5bf9\u672c\u5730\u8d44\u6e90\u5b9e\u73b0\u6700\u5927\u5316\u5229\u7528\uff0c\u4e5f\u662f\u6211\u4eec\u8ffd\u6c42\u7684\u6307\u6807\u4e4b\u4e00\u3002\u8fd8\u8981\u6ce8\u610f\uff0c\u786e\u4fdd\u865a\u62df\u673a\u72b6\u6001\u76d1\u63a7\u65e0\u6709\u9057\u6f0f\uff0c\u5bbf\u4e3b\u673a\u90e8\u7f72\u4fdd\u8bc1\u5b89\u5168\uff0c\u5426\u5219\uff0c\u540e\u671f\u5f88\u75db\u82e6\uff0c\u56e0\u4e3a\u4f60\u6c38\u8fdc\u65e0\u6cd5\u63a7\u5236\u7528\u6237\u4f7f\u7528\u4f60\u7684\u73af\u5883\u505a\u4ec0\u4e48\u3002** \u63a5\u4e0b\u6765\uff0c\u770b\u770b\u5373\u5c06\u90e8\u7f72\u7684\u5404\u4e2a\u5c42\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a ```{image} ../images/01-02.png :align: center \u5982\u4f60\u6240\u89c1\uff0c\u5b58\u50a8\u4e0e\u8ba1\u7b97\u662f\u5728\u540c\u4e00\u8282\u70b9\u4e0a\uff0c\u6240\u6709\u7ba1\u7406\u670d\u52a1\u4ee5\u865a\u62df\u673a\u5f62\u6001\u8fd0\u884c\uff0c\u7edf\u7edf\u9ad8\u53ef\u7528\u3002\u4f46\u662f\uff0c\u8fd9\u4e2a\u67b6\u6784\u4e00\u5b9a\u5b58\u5728\u4e00\u4e2a\u5f0a\u7aef\u5427\uff1f\u6ca1\u9519\uff0c\u4ece\u6574\u4f53\u670d\u52a1\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u865a\u62df\u673a\u4f5c\u4e3b\u4f53\u7684\u67b6\u6784\u4e2d\u5b58\u5728\u4e00\u5b9a\u7a0b\u5ea6\u7684\u7ba1\u7406\u4e0a\u7684\u4e0d\u4fbf\u3002\u4f20\u7edf\u96c6\u7fa4\u53ea\u8981\u5173\u5fc3\u7269\u7406\u8bbe\u65bd\u53ca\u4e0e\u5176\u7ed1\u5b9a\u7684\u5e94\u7528\u5373\u53ef\uff0c\u5b83\u4eec\u5728\u67d0\u4e2a\u533a\u7684\u51e0\u53f7\u67dc\u7684\u90a3\u4e00\u5c42\uff1b\u800c\u865a\u62df\u673a\u4eec\u5219\u53ef\u80fd\u6709\u4e9b\u201c\u4efb\u6027\u201d\uff0c\u6ca1\u6709\u7ed1\u5b9a\u7684\u60c5\u51b5\u4e0b\u4f1a\u5728\u96c6\u7fa4\u4e2d\u7684\u67d0\u53f0\u5bbf\u4e3b\u673a\u4e2d\u8fdb\u884c\u8fc1\u79fb\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u5b8c\u5907\u7684\u96c6\u7fa4\u7ba1\u7406\u53ca\u62a5\u544a\u7cfb\u7edf\uff0c\u4e5f\u4f1a\u9700\u8981\u4e00\u4e2aDataWare House\u6765\u7edf\u8ba1\u7528\u6237\u884c\u4e3a\u3002","title":"\u7b2c\u4e00\u7ae0 \u968f\u4fbf\u8bf4\u4e9b\u4ec0\u4e48"},{"location":"inthecloud/ch01/#_1","text":"\u672c\u4eba\u4e66\u5199\u8fc7\u7a0b\u4e2d\u4e5f\u5728\u63a5\u53d7\u65b0\u7684\u601d\u8003\u65b9\u5f0f\u65b9\u9762\u7684\u8bad\u7ec3\uff0c\u6240\u4ee5\u4ece\u5f00\u59cb\u5230\u7ed3\u5c3e\u96be\u514d\u6709\u4e9b\u6613\u5bdf\u89c9\u5230\u7684\u5199\u4f5c\u65b9\u5f0f\u53d8\u5316\u3002 \u6211\u5199\u8fd9\u4e2a\u7684\u5c3d\u91cf\u591a\u89e3\u91ca\u6982\u5ff5\u3001\u53ef\u91cd\u73b0\u7684\u64cd\u4f5c\u4ee5\u53ca\u5b66\u4e60\u6307\u5bfc\uff0c\u4ee5\u53ca\u63d0\u4f9b\u53d1\u73b0\u89e3\u51b3\u95ee\u9898\u7684\u601d\u8def\u3002\u5176\u4e2d\u5927\u90e8\u5206\u64cd\u4f5c\u7ec6\u8282\u6211\u5c3d\u91cf\u4f7f\u7528\u73b0\u6709\u516c\u53f8\u7684\u4ea7\u54c1\uff08\u6bd4\u5982Mirantis\u3001Cloudera\uff09\uff0c\u800c\u4e0d\u662f\u4ece\u6e90\u7801\u90e8\u7f72\uff0c\u56e0\u4e3a\u7248\u672c\u5347\u7ea7\u5e26\u6765\u7684\u914d\u7f6e\u7ec6\u8282\u95ee\u9898\u4ea4\u7ed9\u4ed6\u4eec\u5904\u7406\u4f1a\u66f4\u901a\u7528\u4e9b\u3002\u540c\u65f6\u6211\u73b0\u5728\u66f4\u503e\u5411\u4e8e\u4f7f\u7528\u73b0\u5b9e\u7684\u6a21\u578b\u6765\u89e3\u91ca\u6216\u8005\u6784\u5efa\u4e00\u4e2a\u539f\u7406\u6216\u8005\u662f\u67b6\u6784\uff0c\u4ece\u800c\u65b9\u4fbf\u8bb0\u5fc6\u548c\u6269\u5c55\u3002","title":"\u7b2c\u4e00\u7ae0 \u968f\u4fbf\u8bf4\u4e9b\u4ec0\u4e48"},{"location":"inthecloud/ch01/#11","text":"\u4ece07\u5e74\u90a3\u4f1a\u513f\uff0c\u751a\u81f3\u66f4\u65e9\uff0c\u62e5\u6709\u5343\u4e07\u7528\u6237\uff08\u5305\u62ec\u76d7\u7248\u53d7\u5bb3\u8005\u5728\u5185\uff09\u7684\u884c\u4e1a\u5148\u950bVMware\uff0c\u53c8\u6709Google\u6570\u636e\u4e2d\u5fc3\u4ee5\u53caAmazon\u5404\u79cd\u5728\u7ebf\u670d\u52a1\uff0c\u8fd9\u4e9b\u5b9e\u6253\u5b9e\u7684\u4e1c\u897f\u9075\u5faa\u8ba1\u7b97\u80fd\u529b\u7684\u6469\u5c14\u5b9a\u5f8b\uff0c\u518d\u987a\u5e94\u65e5\u76ca\u589e\u957f\u7684\u5546\u4e1a\u9700\u6c42\uff0c\u5c31\u6709\u4e86\u201c\u4e91\u201d\u548c\u201c\u5927\u6570\u636e\u201d\u8fd9\u4e24\u4e2a\u8ba9\u8bb8\u591a\u4f01\u4e1a\u518d\u6b21\u8e81\u52a8\u7684\u6982\u5ff5\u3002 \u4e0d\u7ba1\u5927\u5bb6\u90fd\u600e\u4e48\u770b\uff0c\u5148\u5f15\u7528\u4e00\u53e5\u5173\u4e8e\u201c\u5927\u6570\u636e\u201d\u7684\u7ecf\u5178\uff0c\u867d\u7136\u4e0e\u4e91\u8ba1\u7b97\u4e0d\u592a\u76f8\u5e72\uff1a \u201cBig Data is like teenage sex: everyone talks about it, nobody really knows how to do it, everyone thinks everyone else is doing it, so everyone claims they are doing it.\u201d \u6211\u59cb\u7ec8\u8ba4\u4e3a\u8ba4\u77e5\u5f88\u5927\u4e00\u90e8\u5206\u90fd\u6765\u81ea\u4e8e\u5b9e\u8df5\uff0c\u5373\u5148\u6709\u5b9e\u8df5\uff0c\u624d\u6765\u7406\u8bba\uff0c\u540c\u65f6\u7406\u8bba\u53ef\u4ee5\u88ab\u63d0\u9ad8\u88ab\u6539\u53d8\uff0c\u7136\u540e\u518d\u7528\u4e8e\u5b9e\u8df5\u3002 \u90a3\u5c31\u8fd9\u6837\uff0c \u4f46\u884c\u597d\u4e8b\uff0c\u83ab\u95ee\u524d\u7a0b \u3002 \u4f5c\u4e3a\u516c\u53f8\u7684\u4e00\u540d\u5c0f\u6280\u672f\u4eba\u5458\uff0c\u4ece\u5ba2\u6237\u4ea4\u6d41\u5230\u73b0\u573a\u90e8\u7f72\u3001\u4eceSDN\u4ea4\u6362\u673a\u5230Neutron\u3001\u4eceQEMU\u5230IAAS\uff0c\u6211\u90fd\u6709\u8fc7\u4e86\u89e3\u6216\u63a5\u89e6\uff0c\u5e76\u5c06\u5176\u8bb0\u5f55\u6210\u6587\uff0c\u662f\u603b\u7ed3\uff0c\u4ea6\u662f\u63a2\u7d22\u3002\u671f\u95f4\u96be\u514d\u4f1a\u6709\u8fd9\u6837\u6216\u8005\u90a3\u6837\u7684\u60f3\u6cd5\uff0c\u800c\u5c06\u8fd9\u4e9b\u60f3\u6cd5\u5b9e\u8df5\u51fa\u6765\u7684\u8fc7\u7a0b\u662f\u4f1a\u8ba9\u4eba\u89c9\u5f97\u751f\u6d3b\u4f9d\u65e7\u662f\u7f8e\u597d\u7684\u3002 \u63a5\u4e0b\u6765\u662f\u4ee5\u6211\u76ee\u524d\u6c34\u5e73\u80fd\u770b\u5230\u7684\uff1a \u548c\u591a\u6570\u884c\u4e1a\u4e00\u6837\uff0c\u4e0d\u7ba1\u54ea\u4e2a\u516c\u53f8\uff0c\u4ed6\u4eec\u6280\u672f\u548c\u5173\u7cfb\uff0c\u5728\u4e0d\u540c\u5ba2\u6237\u90a3\u91cc\u90fd\u6709\u4e0d\u540c\u7684\u6743\u91cd\uff0c\u8fd9\u70b9\u7684\u5357\u5317\u5dee\u5f02\u5c24\u4e3a\u660e\u663e\uff1b \u4ee5\u6211\u6240\u9047\u5230\u7684\u5ba2\u6237\u6765\u770b\uff0c\u90e8\u5206\u5ba2\u6237\u4e0d\u4f1a\u660e\u786e\u7684\u8bf4\u4f7f\u7528\u201c\u4e91\u201d\uff0c\u4ed6\u4eec\u7684\u9700\u6c42\u5728\u591a\u6570\u60c5\u51b5\u4e0b\u53ef\u4ee5\u6709\u8fd9\u6837\u6216\u8005\u90a3\u6837\u7684\u4f20\u7edf\u65b9\u6848\u66ff\u4ee3\uff1b\u660e\u786e\u8981\u6c42\u4f7f\u7528\u201c\u4e91\u201d\u7684\u5ba2\u6237\uff0c\u603b\u4f1a\u8981\u6c42\u5468\u8fb9\u6307\u6807\uff08\u7528\u6237\u63a5\u5165\u3001\u7ec8\u7aef\u534f\u8bae\u3001USB\u91cd\u5b9a\u5411\u3001\u89c6\u9891\u6d41\u5360\u7528\u5e26\u5bbd\u3001UPS\u3001\u5b58\u50a8\u590d\u7528\u7b49\uff09\u4ee5\u53ca\u5404\u79cd\u5404\u6837\u7684\u5b9a\u5236\uff0c\u8fd9\u662f\u56fd\u5185\u8bb8\u591a\u516c\u6709\u79c1\u6709\u6df7\u5408\u4e91\u5382\u5546\u7684\u4e00\u4e2a\u75db\u5904\uff1b \u4e91\u8ba1\u7b97\u7684\u672c\u610f\u4e0d\u662f\u865a\u62df\u673a\uff0c\u4e5f\u4e0d\u662f\u7ba1\u7406\u65b9\u4fbf\u7684\u96c6\u7fa4\uff0c\u56fd\u5185\u597d\u591a\u516c\u53f8\u641e\u7684\u4e91\u8ba1\u7b97\u90fd\u662f\u5728\u5356\u4f20\u7edf\u8ba1\u7b97\u673a\u96c6\u7fa4\u6240\u80fd\u63d0\u4f9b\u7684\u670d\u52a1\uff0c\u8981\u6709\u516c\u53f8\u6765\u5efa\u5206\u6c34\u5cad\u3002 \u5c3d\u91cf\u4e0d\u8981\u4ece\u6280\u672f\u89d2\u5ea6\u51fa\u53d1\u53bb\u7ed9\u5ba2\u6237\u63d0\u4f9b\u6280\u672f\uff0c\u800c\u662f\u53bb\u5173\u5fc3\u5ba2\u6237\u73b0\u5728\u9762\u4e34\u7684\u95ee\u9898\uff0c\u6211\u4eec\u518d\u63d0\u4f9b\u6280\u672f\u3002\uff08\u8fd9\u53e5\u8bf4\u7684\u4e0d\u597d\uff0c\u610f\u601d\u8fd8\u5dee\u70b9\uff09 \u6240\u4ee5\uff0c\u5728\u9700\u6c42\u4e0a\u7684\u7075\u6d3b\u53d8\u901a\uff0c\u4e5f\u662f\u6709\u4e9b\u8bb8\u91cd\u8981\u6027\u7684\uff0c \u4e0d\u8981\u628a\u6280\u672f\u4eba\u5458\u7684\u56fa\u6267\u5e26\u5230\u5ba2\u6237\u90a3 \u3002","title":"1.1 \u6211\u6240\u770b\u5230\u7684"},{"location":"inthecloud/ch01/#12","text":"7:50 \u624b\u673a\u95f9\u94c3\u54cd\u4e86\uff0c\u968f\u4e4b\u800c\u6765\u7684\u662f\u4f60\u8ba2\u9605\u7684RSS\u3001Flipboard\u63a8\u9001\u7684\u65b0\u95fb\u3002\u968f\u624b\u7ffb\u9605\u4e0b\uff0c\u5b8c\u540eSiri\u8bf4\u4eca\u5929\u5929\u6c14\u633a\u6696\u548c\u7684\uff0c\u53ef\u4ee5\u7a7f\u4f60\u6700\u559c\u6b22\u7684\u9ad8\u9886\u6bdb\u8863\uff0c\u8d77\u5e8a\u3002 8:30 \u9ad8\u901f\u516c\u8def\u4e0a\uff0c\u5730\u56fe\u544a\u8bc9\u4f60\u524d\u65b9\u62e5\u5835\uff0c\u6b63\u597d\u8fd9\u65f6\u9886\u5bfc\u6253\u6765\u7535\u8bdd\uff0c\u4f60\u544a\u8bc9Siri\u8bf4\u201c\u63a5\u542c\u201d\u3002\u6302\u4e86\u7535\u8bdd\u4ee5\u540e\uff0c\u7ea2\u706f\u4eae\u4e86\uff0c\u6c7d\u8f66\u8bb0\u5f55\u4e0b\u4f60\u8fd9\u6b21\u5835\u8f66\u7684\u65f6\u95f4\uff0c\u5e76\u9ed8\u9ed8\u518d\u6b21\u8ba1\u7b97\u9884\u8ba1\u5230\u65f6\u3002 9:20 \u5230\u8fbe\u516c\u53f8\u95e8\u53e3\uff0c\u6ca1\u6709\u4fdd\u5b89\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u8fde\u63a5\u516c\u53f8LDAP\u670d\u52a1\u5668\u7684\u77b3\u5b54\u8bc6\u522b\u3002 10:00 \u6536\u5230\u4fe1\u606f\uff0c\u6765\u81ea\u697c\u4e0b\u5feb\u4ef6\u6d3e\u53d1\u67dc\uff0c\u4f60\u8ba2\u8d2d\u7684\u7403\u978b\u5230\u4e86\u3002 10:30 \u5ba2\u6237\u9884\u7ea6\u7684\u62dc\u8bbf\uff0c\u4f60\u544a\u8bc9Siri\u8bf4\u628a\u516c\u53f8\u5730\u5740\u5bfc\u822a\u8def\u7ebf\u53d1\u9001\u7ed9\u5ba2\u6237\u5f20\u4e09\u3002 11:10 \u901a\u8fc7\u516c\u53f8IM\u544a\u8bc9\u524d\u53f0\u4e34\u65f6\u5141\u8bb8\u8f66\u724c\u53f7\u4e3aK9031\u7684\u8f66\u8f86\u8fdb\u6765\u5e76\u53d1\u9001\u8f66\u4f4d\u4fe1\u606f\u7ed9\u5ba2\u6237\u3002 11:20 \u548c\u5ba2\u6237\u5728\u4e34\u65f6\u4f1a\u5ba2\u5385\u8c08\u8bdd\uff0c\u671f\u95f4\u4f60\u628a\u6f14\u8bf4\u5185\u5bb9\u901a\u8fc7\u624b\u52bf\uff08\u98df\u6307\u4e00\u5212\uff09\u63a8\u9001\u5230\u5ba2\u6237\u90ae\u7bb1\uff0c\u4ed6\u4eec\u611f\u5230\u5f88\u610f\u5916\uff08\u52a0\u5206\u70b9\uff09\u3002 12:30 \u5348\u9910\u65f6\u95f4\uff0cSiri\u8fd8\u8bb0\u5f97\u4f60\u5728\u51b3\u5fc3\u51cf\u80a5\u671f\u95f4\uff0c\u63d0\u9192\u4f60\u4e0d\u8981\u5403\u6700\u559c\u6b22\u7684\u7ea2\u70e7\u8089\uff0c\u672b\u4e86\u6765\u4e00\u53e5\u201c\u4e24\u4e2a\u4eba\u88ab\u8001\u864e\u8ffd\uff0c\u8c01\u6700\u5371\u9669\uff1fBingo\uff0c\u80d6\u7684\u90a3\u4e2a\u201d\u3002 14:30 \u6709\u5ba2\u6237\u5982\u7ea6\u9001\u6765\u4e8610T\u7684\u8d22\u52a1\u6570\u636e\uff0c\u4f60\u901a\u77e5\u6280\u672f\u90e8\u5c0f\u674e\u5bf9\u8fd9\u4e9b\u6570\u636e\u8fdb\u884c\u65b9\u6848II\u5904\u7406\uff0c\u767e\u5206\u4e4b30\u7684\u5904\u7406\u4efb\u52a1\u4ea4\u7ed9\u6b66\u6c49\u673a\u623f\u7684\u673a\u5668\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u4ece\u673a\u67dc\u5230\u4e3b\u677f\u90fd\u662f\u4f60\u4f9d\u7167\u8282\u80fd\u73af\u4fdd\u7684\u539f\u5219\u4e3b\u6301\u8bbe\u8ba1\u7684\u3002 16:00 Siri\u544a\u8bc9\u4f60\uff0c\u62b1\u6b49\uff0c\u516d\u70b9\u949f\u6709\u5c40\u90e8\u964d\u96e8\u3002 17:00 \u4f60\u628a\u4eca\u5929\u7684\u5907\u5fd8\u5f55\u5b58\u8fdb\u516c\u53f8\u6d3e\u53d1\u7ed9\u4f60\u7684\u865a\u62df\u684c\u9762\uff0c\u4e0b\u73ed\u3002 19:00 \u8001\u5a46\u5927\u4eba\u7684\u665a\u996d\u505a\u597d\u4e86\uff0c\u4f60\u4e5f\u518d\u6b21\u8fde\u4e0a\u865a\u62df\u684c\u9762\u628a\u5907\u5fd8\u5f55\u6574\u7406\u5f52\u6863\u3002 20:30 \u8dd1\u6b65\u7ed3\u675f\uff0c\u5b83\u544a\u8bc9\u4f60\u8fd9\u51e0\u5468\u6362\u5b63\u671f\u95f4\uff0c\u8981\u589e\u52a0\u8fd0\u52a8\u91cf\uff0c\u4f60\u8bf4\u201c\u53ef\u4ee5\u201d\u3002 23:00 \u4f11\u606f\uff0cSiri\u901a\u8fc7\u6587\u5b57\u6084\u6084\u544a\u8bc9\u4f60\uff0c\u660e\u5929\u7ed3\u5a5a\u7eaa\u5ff5\u65e5\uff0c\u8bb0\u4f4f\u3002 \u6240\u6709\u5df2\u77e5\u672a\u77e5\u7684\u6697\u6d41\uff0c\u8ba9\u4eba\u6709\u4e86\u7ee7\u7eed\u6298\u817e\u4e0b\u53bb\u7684\u6b32\u671b\u3002 \u6211\u662f\u4e00\u4e2a\u7740\u91cd\u5b9e\u8df5\u7684\u4eba\uff0c\u662f\u7684\uff0c\u6bd4\u5982\u78c1\u76d8\u4e0d\u62c6\u5f00\u7684\u8bdd\u6211\u53ef\u80fd\u5c31\u5bf9\u6247\u533a\u3001\u78c1\u9053\u3001\u67f1\u9762\u6ca1\u4ec0\u4e48\u6df1\u523b\u6982\u5ff5\uff08\u5176\u5b9e\u62c6\u4e86\u4e5f\u6ca1\u591a\u6df1\u523b\uff09\u3002\u6240\u4ee5\uff0c\u8fd9\u4e00\u4e9b\u5217\u6587\u7ae0\u5c06\u5c3d\u91cf\u4ece\u64cd\u4f5c\u6216\u8005\u73b0\u8c61\u4e2d\u603b\u7ed3\u89c4\u5f8b\u3002\u4e00\u4e9b\u539f\u7406\u6027\u7684\u4e1c\u897f\u4f1a\u5c3d\u91cf\u7528\u6211\u89c9\u5f97\u5bb9\u6613\u7406\u89e3\u7684\u5f62\u5f0f\u8868\u73b0\u51fa\u6765\u3002 ```{image} ../images/01-01.jpg :height: 373 :width: 300 :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 \u6574\u672c\u201c\u4e66\u201d\u7684\u7ed3\u6784\u5c06\u4f1a\u662f\u8fd9\u4e2a\u6837\u5b50\uff1a \u4ecb\u7ecd\u4e0b\u4e3b\u6d41\u201c\u4e91\u201d\u7684\u73b0\u72b6\uff0c\u4f1a\u5f15\u7528\u8bb8\u591a\u73b0\u6210\uff08\u5c3d\u91cf\uff09\u5ba2\u89c2\u7684\u4fe1\u606f\u7247\u6bb5\uff1b\u7545\u60f3\u4e00\u4e0b\uff1b\u4ece\u4e2d\u9009\u62e9\u90e8\u5206\u7ec4\u6210\u4e00\u4e2a\u5b8c\u6574\u7cfb\u7edf\uff0c\u8fdb\u884c\u642d\u5efa\uff08\u6216\u6a21\u62df\uff09\u5e76\u672c\u5730\u8c03\u4f18\uff08\u907f\u514d\u8fc7\u65e9\u4f18\u5316\uff09\uff1b\u907f\u514d\u70c2\u5c3e\uff0c\u7ed3\u5c3e\u9001\u4e24\u9996\u77ed\u8bd7\u5427\u3002 ## 1.3 \u6839\u636e\u9700\u6c42\u6765\u67b6\u6784 \u6240\u6709\u6211\u4eec\u6240\u9700\u8981\u7684\u4e1c\u897f\uff0c\u81f3\u6b64\u6709\u4e86\u4e00\u4e2a\u6574\u4f53\u7684\u5370\u8c61\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u5217\u4e3e\u51e0\u4e2a\u5173\u952e\u8bcd\uff0c\u4ece\u4e2d\u6311\u51fa\u4e00\u90e8\u5206\u6765\u7ec4\u5efa\u6211\u4eec\u201c\u4e91\u201d\u3002 - \u5b58\u50a8\uff1a\u5c06\u8981\u6784\u5efa\u7684\u57fa\u7840\u8bbe\u65bd\u7684\u57fa\u7840\uff0c\u6240\u4ee5\u4e00\u5b9a\u8981\u5bf9\u5176\u53ef\u7528\u6027\u53ca\u901f\u5ea6\u6709\u6240\u4fdd\u8bc1\u3002 - \u865a\u62df\u5316\uff1a\u901a\u8fc7\u8f6f\u4ef6\u6a21\u62df\u82af\u7247\u4ee5\u53ca\u5904\u7406\u5668\u7684\u8fd0\u884c\u7ed3\u6784\uff0c\u4f5c\u4e3a\u516b\u4e5d\u5341\u5e74\u4ee3\u751f\u4eba\uff08\u5ffd\u7136\u89c9\u5f97\u65f6\u95f4\u597d\u5feb\uff09\uff0c\u591a\u6570\u4eba\u6700\u719f\u6089\u7684\u5e94\u8be5\u662f\u7ea2\u767d\u673a\u6a21\u62df\u5668\u4e86\u5427\u3002 - \u96c6\u7fa4\uff1a\u8fd9\u4e2a\u6982\u5ff5\u91cc\u6709\u5e76\u884c\u8fd8\u6709\u5206\u5e03\uff0c\u4e24\u8005\u6bd4\u8f83\u660e\u663e\u7684\u533a\u522b\u662f\u662f\u5426\u5728\u67d0\u4e00\u65f6\u95f4\u6bb5\u5185\u6709\u5171\u540c\u7684\u8ba1\u7b97\u76ee\u7684\u3002 - \u6388\u6743\u670d\u52a1\uff1a\u73b0\u4ee3\u6570\u636e\u4e2d\u5fc3\u7684\u591a\u6570\u5e94\u7528\uff0c\u90fd\u9700\u8981\u7edf\u4e00\u7684\u7528\u6237\u6570\u636e\uff0c\u5982\u4f55\u5b89\u5168\u5730\u4f7f\u7528\u7edf\u4e00\u7684\u7528\u6237\u6570\u636e\uff0c\u4e5f\u662f\u6211\u4eec\u9700\u8981\u8003\u8651\u7684\u3002 - \u5b89\u5168\u4e0e\u53ef\u4fe1\uff1a\u5b89\u5168\u7684\u95ee\u9898\uff0c**\u5f88\u91cd\u8981**\u3002\u4e0d\u8981\u7b49\u5230\u54ea\u5929\u4fe1\u7528\u5361\u8d26\u6237\u88ab\u76d7\u5237\u624d\u53d1\u73b0\u5b89\u5168\u7684\u91cd\u8981\u6027\uff1b\u53ef\u4fe1\uff0c\u5373\u662f\u670d\u52a1\u63d0\u4f9b\u8005\u4e0e\u63a5\u53d7\u8005\u5177\u6709\u53ef\u4fe1\u7684\u7b2c\u4e09\u65b9\u63d0\u4f9b\u652f\u6301\u3002 - \u53ef\u6269\u5c55\uff1a\u8fd9\u91cc\u6709\u4e24\u4e2a\u5c42\u9762\uff0c\u4e00\u4e2a\u57fa\u7840\u8bbe\u65bd\u81ea\u8eab\u8ba1\u7b97\u4e0e\u5b58\u50a8\u80fd\u529b\u6269\u589e\uff0c\u53e6\u4e00\u4e2a\u662f\u4e0e\u5176\u4ed6\u4e91\u8ba1\u7b97\u5e73\u53f0\u7684\u6a21\u5757\u7ea7\u522b\u517c\u5bb9\u3002 - \u5916\u56f4\u8bbe\u5907\uff1a\u5bf9\u4e8e\u7279\u6b8a\u7684\u5e94\u7528\uff08\u73af\u5883\u76d1\u89c6\u3001\u8ba4\u8bc1\u3001GPU\u4f9d\u8d56\u5e94\u7528\u7b49\uff09\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e9b\u5916\u56f4\u8bbe\u5907\u6765\u8f85\u52a9\u5b8c\u6210\uff08usb\u8bbe\u5907\u3001\u663e\u5361\u7b49\uff09\u3002\u5bf9\u4e8e\u91cd\u8981\u8bbe\u5907\u6216\u8005\u975e\u5e38\u4f9d\u8d56\u603b\u7ebf\u5e26\u5bbd\u7684\u8bbe\u5907\uff08\u4ee4\u724c\u3001\u663e\u5361\u7b49\uff09\u7684\u5b89\u88c5\uff0c\u63a8\u8350\u5c06\u5176\u4e0e\u5b9e\u65bd\u5e94\u7528\u7684\u7269\u7406\u673a\u76f4\u63a5\u7ed1\u5b9a\uff0c\u5bf9\u4e8e\u5176\u4ed6\u8bbe\u5907\uff08U\u76d8\u3001\u6444\u50cf\u5934\u7b49\uff09\u63a8\u8350\u4f7f\u7528\u67d0\u4e00\u65e2\u5b9a\u7269\u7406\u673a\u8fdb\u884c\u57fa\u4e8eTCP/IP\u7684\u900f\u4f20\u3002 - \u7535\u6e90\u7ba1\u7406\uff1a\u7531\u4e8e\u96c6\u7fa4\u4e2d\u5b58\u5728\u4e2d\u592e\u7ba1\u7406\uff0c\u6240\u4ee5\u6709\u5fc5\u8981\u4f7f\u7528\u6805\u680f\uff08fencing\uff09\u53bb\u5173\u95ed\u4e0e\u7ba1\u7406\u5931\u53bb\u8054\u7cfb\u7684\u673a\u5668\uff0c\u9632\u6b62\u5176\u81ea\u5efa\u4e2d\u592e\u7ba1\u7406\u3002 - orchestration\uff1a\u5373\u9884\u914d\u7f6e\uff0c\u4e0d\u7ba1\u662f\u865a\u62df\u673a\u8fd8\u662f\u5e94\u7528\u7a0b\u5e8f\uff0c\u6211\u4eec\u7684\u76ee\u7684\u4e4b\u4e00\u5c31\u662f\u8fbe\u5230\u670d\u52a1\u7684\u5feb\u901f\u54cd\u5e94\u3002 \u5982\u6b64\u5212\u5206\u7684\u610f\u56fe\u662f\u4ec0\u4e48\u5462\uff1f**\u57fa\u7840\u8bbe\u65bd\uff0c\u5728\u4fdd\u8bc1\u5b89\u5168\u53ef\u9760\u7684\u524d\u63d0\u4e0b\uff0c\u5bf9\u672c\u5730\u8d44\u6e90\u5b9e\u73b0\u6700\u5927\u5316\u5229\u7528\uff0c\u4e5f\u662f\u6211\u4eec\u8ffd\u6c42\u7684\u6307\u6807\u4e4b\u4e00\u3002\u8fd8\u8981\u6ce8\u610f\uff0c\u786e\u4fdd\u865a\u62df\u673a\u72b6\u6001\u76d1\u63a7\u65e0\u6709\u9057\u6f0f\uff0c\u5bbf\u4e3b\u673a\u90e8\u7f72\u4fdd\u8bc1\u5b89\u5168\uff0c\u5426\u5219\uff0c\u540e\u671f\u5f88\u75db\u82e6\uff0c\u56e0\u4e3a\u4f60\u6c38\u8fdc\u65e0\u6cd5\u63a7\u5236\u7528\u6237\u4f7f\u7528\u4f60\u7684\u73af\u5883\u505a\u4ec0\u4e48\u3002** \u63a5\u4e0b\u6765\uff0c\u770b\u770b\u5373\u5c06\u90e8\u7f72\u7684\u5404\u4e2a\u5c42\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a ```{image} ../images/01-02.png :align: center \u5982\u4f60\u6240\u89c1\uff0c\u5b58\u50a8\u4e0e\u8ba1\u7b97\u662f\u5728\u540c\u4e00\u8282\u70b9\u4e0a\uff0c\u6240\u6709\u7ba1\u7406\u670d\u52a1\u4ee5\u865a\u62df\u673a\u5f62\u6001\u8fd0\u884c\uff0c\u7edf\u7edf\u9ad8\u53ef\u7528\u3002\u4f46\u662f\uff0c\u8fd9\u4e2a\u67b6\u6784\u4e00\u5b9a\u5b58\u5728\u4e00\u4e2a\u5f0a\u7aef\u5427\uff1f\u6ca1\u9519\uff0c\u4ece\u6574\u4f53\u670d\u52a1\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u865a\u62df\u673a\u4f5c\u4e3b\u4f53\u7684\u67b6\u6784\u4e2d\u5b58\u5728\u4e00\u5b9a\u7a0b\u5ea6\u7684\u7ba1\u7406\u4e0a\u7684\u4e0d\u4fbf\u3002\u4f20\u7edf\u96c6\u7fa4\u53ea\u8981\u5173\u5fc3\u7269\u7406\u8bbe\u65bd\u53ca\u4e0e\u5176\u7ed1\u5b9a\u7684\u5e94\u7528\u5373\u53ef\uff0c\u5b83\u4eec\u5728\u67d0\u4e2a\u533a\u7684\u51e0\u53f7\u67dc\u7684\u90a3\u4e00\u5c42\uff1b\u800c\u865a\u62df\u673a\u4eec\u5219\u53ef\u80fd\u6709\u4e9b\u201c\u4efb\u6027\u201d\uff0c\u6ca1\u6709\u7ed1\u5b9a\u7684\u60c5\u51b5\u4e0b\u4f1a\u5728\u96c6\u7fa4\u4e2d\u7684\u67d0\u53f0\u5bbf\u4e3b\u673a\u4e2d\u8fdb\u884c\u8fc1\u79fb\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u5b8c\u5907\u7684\u96c6\u7fa4\u7ba1\u7406\u53ca\u62a5\u544a\u7cfb\u7edf\uff0c\u4e5f\u4f1a\u9700\u8981\u4e00\u4e2aDataWare House\u6765\u7edf\u8ba1\u7528\u6237\u884c\u4e3a\u3002","title":"1.2 \u4eca\u5929\u5929\u6c14\u600e\u6837"},{"location":"inthecloud/ch02/","text":"\u7b2c\u4e8c\u7ae0 \u4e00\u4e2a\u53ef\u9760\u7684\u5b58\u50a8\u540e\u7aef 2.1 \u8c08\u8c08\u5206\u5e03\u5f0f\u5b58\u50a8 \u8ba1\u7b97\u673a\u9886\u57df\u4e2d\u6709\u8bf8\u591a\u6709\u610f\u601d\u7684\u4e1c\u897f\u53ef\u4ee5\u628a\u73a9\uff0c\u5728\u8fd9\u513f\u4e14\u770b\u770b\u5206\u5e03\u5f0f\u5b58\u50a8\u3002 \u96c6\u7fa4\u6587\u4ef6\u7cfb\u7edf \u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u53c8\u53ef\u4ee5\u79f0\u4f5c\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\u3001\u5e76\u884c\u6587\u4ef6\u7cfb\u7edf\uff0c\u572870\u5e74\u4ee3\u7531IBM\u63d0\u51fa\u5e76\u5b9e\u73b0\u539f\u578b\u3002 \u6709\u51e0\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5b9e\u73b0\u96c6\u7fa4\u5f62\u5f0f\uff0c\u4f46\u591a\u6570\u4ec5\u4ec5\u662f\u8282\u70b9\u76f4\u8fde\u5b58\u50a8\u800c\u4e0d\u662f\u5c06\u5b58\u50a8\u4e4b\u4e0a\u7684\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u5408\u7406\u201c\u5206\u5e03\u201d\u3002\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u540c\u65f6\u6302\u8f7d\u4e8e\u591a\u4e2a\u670d\u52a1\u5668\u4e0a\uff0c\u5e76\u5728\u5b83\u4eec\u4e4b\u95f4\u5171\u4eab\uff0c\u53ef\u4ee5\u63d0\u4f9b\u7c7b\u4f3c\u4e8e\u4f4d\u7f6e\u65e0\u5173\u7684\u6570\u636e\u5b9a\u4f4d\u6216\u5197\u4f59\u7b49\u7279\u70b9\u3002\u5e76\u884c\u6587\u4ef6\u7cfb\u7edf\u662f\u4e00\u79cd\u96c6\u7fa4\u5f0f\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u5c06\u6570\u636e\u5206\u5e03\u4e8e\u591a\u4e2a\u8282\u70b9\uff0c\u5176\u4e3b\u8981\u76ee\u7684\u662f\u63d0\u4f9b\u5197\u4f59\u548c\u63d0\u9ad8\u8bfb\u5199\u6027\u80fd\u3002 \u5171\u4eab\u78c1\u76d8\uff08Shared-disk\uff09/Storage-area network(SAN) \u4ece\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u7684\u6587\u4ef6\u7ea7\u522b\uff0c\u5230SAN\u4e4b\u95f4\u7684\u5757\u7ea7\u522b\u7684\u64cd\u4f5c\uff0c\u8bf8\u5982\u6743\u9650\u63a7\u5236\u548c\u4f20\u8f93\uff0c\u90fd\u662f\u53d1\u751f\u5728\u5ba2\u6237\u7aef\u8282\u70b9\u4e0a\u3002\u5171\u4eab\u78c1\u76d8\uff08Shared-disk\uff09\u6587\u4ef6\u7cfb\u7edf\uff0c\u5728\u5e76\u884c\u63a7\u5236\u4e0a\u505a\u4e86\u5f88\u591a\u5de5\u4f5c\uff0c\u4ee5\u81f3\u4e8e\u5176\u62e5\u6709\u6bd4\u8f83\u4e00\u81f4\u8fde\u8d2f\u7684\u6587\u4ef6\u7cfb\u7edf\u89c6\u56fe\uff0c\u4ece\u800c\u907f\u514d\u4e86\u591a\u4e2a\u5ba2\u6237\u7aef\u8bd5\u56fe\u540c\u65f6\u8bbf\u95ee\u540c\u4e00\u8bbe\u5907\u65f6\u6570\u636e\u65ad\u7247\u6216\u4e22\u5931\u7684\u60c5\u51b5\u53d1\u751f\u3002\u5176\u4e2d\u6709\u79cd\u6280\u672f\u53eb\u505a\u56f4\u680f\uff08Fencing\uff09\uff0c\u5c31\u662f\u5728\u67d0\u4e2a\u6216\u67d0\u4e9b\u8282\u70b9\u53d1\u751f\u65ad\u7247\u65f6\uff0c\u96c6\u7fa4\u81ea\u52a8\u5c06\u8fd9\u4e9b\u8282\u70b9\u9694\u79bb\uff08\u5173\u673a\u3001\u65ad\u7f51\u3001\u81ea\u6062\u590d\uff09\uff0c\u4fdd\u8bc1\u5176\u4ed6\u8282\u70b9\u6570\u636e\u8bbf\u95ee\u7684\u6b63\u786e\u6027\u3002\u5143\u6570\u636e\uff08Metadata\uff09\u7c7b\u4f3c\u76ee\u5f55\uff0c\u53ef\u4ee5\u8ba9\u6240\u6709\u7684\u673a\u5668\u90fd\u80fd\u67e5\u627e\u4f7f\u7528\u6240\u6709\u4fe1\u606f\uff0c\u5728\u4e0d\u540c\u7684\u67b6\u6784\u4e2d\u6709\u4e0d\u540c\u7684\u4fdd\u5b58\u65b9\u5f0f\uff0c\u6709\u7684\u5747\u5300\u5206\u5e03\u4e8e\u96c6\u7fa4\uff0c\u6709\u7684\u5b58\u50a8\u5728\u4e2d\u592e\u8282\u70b9\u3002 \u5b9e\u73b0\u7684\u65b9\u5f0f\u6709iSCSI\uff0cAoE\uff0cFC\uff0cInfiniband\u7b49\uff0c\u6bd4\u8f83\u8457\u540d\u7684\u4ea7\u54c1\u6709Redhat GFS\u3001Sun QFS\u3001Vmware VMFS\u7b49\u3002 \u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf \u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5219\u4e0d\u662f\u5757\u7ea7\u522b\u7684\u5171\u4eab\u7684\u5f62\u5f0f\u4e86\uff0c\u6240\u6709\u52a0\u8fdb\u6765\u7684\u5b58\u50a8\uff08\u6587\u4ef6\u7cfb\u7edf\uff09\u90fd\u662f\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\uff0c\u6240\u6709\u6570\u636e\u7684\u4f20\u8f93\u4e5f\u662f\u4f9d\u9760\u7f51\u7edc\u6765\u7684\u3002 \u5b83\u7684\u8bbe\u8ba1\u6709\u8fd9\u4e48\u51e0\u4e2a\u539f\u5219\uff1a \u8bbf\u95ee\u900f\u660e \u5ba2\u6237\u7aef\u5728\u5176\u4e0a\u7684\u6587\u4ef6\u64cd\u4f5c\u4e0e\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u65e0\u5f02 \u4f4d\u7f6e\u900f\u660e \u5176\u4e0a\u7684\u6587\u4ef6\u4e0d\u4ee3\u8868\u5176\u5b58\u50a8\u4f4d\u7f6e\uff0c\u53ea\u8981\u7ed9\u4e86\u5168\u540d\u5c31\u80fd\u8bbf\u95ee \u5e76\u53d1\u900f\u660e \u6240\u6709\u5ba2\u6237\u7aef\u6301\u6709\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\u72b6\u6001\u5728\u4efb\u4f55\u65f6\u5019\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u4e0d\u4f1a\u51fa\u73b0A\u4fee\u6539\u4e86F\u6587\u4ef6\uff0c\u4f46\u662fB\u6123\u4e86\u534a\u5929\u624d\u53d1\u73b0\u3002 \u5931\u8d25\u900f\u660e \u7406\u89e3\u4e3a\u963b\u585e\u64cd\u4f5c\uff0c\u4e0d\u6210\u529f\u4e0d\u56de\u5934\u3002 \u5f02\u6784\u6027 \u6587\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u5728\u591a\u79cd\u786c\u4ef6\u4ee5\u53ca\u64cd\u4f5c\u7cfb\u7edf\u4e0b\u90e8\u7f72\u4f7f\u7528\u3002 \u6269\u5c55\u6027 \u968f\u65f6\u6dfb\u52a0\u8fdb\u65b0\u7684\u8282\u70b9\uff0c\u65e0\u89c6\u5176\u8d44\u683c\u65b0\u65e7\u3002 \u5197\u4f59\u900f\u660e \u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u4e86\u89e3\u6587\u4ef6\u5b58\u5728\u4e8e\u591a\u4e2a\u8282\u70b9\u4e0a\u8fd9\u4e00\u4e8b\u5b9e\u3002 \u8fc1\u79fb\u900f\u660e \u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u4e86\u89e3\u6587\u4ef6\u6839\u636e\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u8fc1\u79fb\u7684\u72b6\u51b5\u3002 \u5b9e\u73b0\u7684\u65b9\u5f0f\u6709NFS\u3001CIFS\u3001SMB\u3001NCP\u7b49\uff0c\u6bd4\u8f83\u8457\u540d\u7684\u4ea7\u54c1\u6709Google GFS\u3001Hadoop HDFS\u3001GlusterFS\u3001Lustre\u7b49\u3002 1 2 3 4 5 6 7 8 9 .. epigraph:: FUSE\uff0cfilesystem in user space\u3002 FUSE\u5168\u540dFilesystem in Userspace\uff0c\u662f\u5728\u7c7bUNIX\u7cfb\u7edf\u4e0b\u7684\u4e00\u4e2a\u673a\u5236\uff0c\u53ef\u4ee5\u8ba9\u666e\u901a\u7528\u6237\u521b\u5efa\u4fee\u6539\u8bbf\u95ee\u6587\u4ef6\u7cfb\u7edf\u3002\u529f\u80fd\u5c31\u662f\u8fde\u63a5\u5185\u6838\u63a5\u53e3\u4e0e\u7528\u6237\u63a7\u4ef6\u7a0b\u5e8f\u7684\u4e00\u5ea7\u201c\u6865\u201d\uff0c\u76ee\u524d\u666e\u904d\u5b58\u5728\u4e8e\u591a\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u6bd4\u5982Linux\u3001BSD\u3001Solaris\u3001OSX\u3001Android\u7b49\u3002 FUSE\u6765\u6e90\u4e8eAVFS\uff0c\u4e0d\u540c\u4e8e\u4f20\u7edf\u6587\u4ef6\u7cfb\u7edf\u4ece\u78c1\u76d8\u8bfb\u5199\u6570\u636e\uff0cFUSE\u5728\u6587\u4ef6\u7cfb\u7edf\u6216\u78c1\u76d8\u4e2d\u6709\u201c\u8f6c\u6362\u201d\u7684\u89d2\u8272\uff0c\u672c\u8eab\u5e76\u4e0d\u4f1a\u5b58\u50a8\u6570\u636e\u3002 \u5728Linux\u7cfb\u7edf\u4e2d\u7684\u5b9e\u73b0\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u5404\u79cd\u8981\u6302\u8f7dntfs\u6587\u4ef6\u7cfb\u7edf\u4f7f\u7528\u5230\u7684ntfs-3g\uff0c\u4ee5\u53ca\u5373\u5c06\u8981\u7528\u5230\u7684glusterfs-fuse\u3002 ```{image} ../images/02-01.png :align: center 1 2 3 4 5 6 7 8 ## 2.2 Glusterfs\u7b80\u8ff0 \u63a5\u4e0b\u6765\uff0c\u8bf4\u4e00\u4e0b\u6211\u6240\u770b\u5230\u7684glusterfs\u3002 \u9996\u5148\u5b83\u53ef\u4ee5\u57fa\u4e8e\u4ee5\u592a\u7f51\u6216\u8005Infiniband\u6784\u5efa\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u5176\u8bbe\u8ba1\u539f\u5219\u7b26\u5408\u5965\u5361\u59c6\u5243\u5200\u539f\u5219\uff0c\u5373\u201c *\u82e5\u65e0\u5fc5\u8981\uff0c\u52ff\u589e\u5b9e\u4f53* \u201d\uff1b\u5b83\u7684\u6e90\u7801\u90e8\u5206\u9075\u5faaGPLv3\uff0c\u53e6\u4e00\u90e8\u5206\u9075\u5faaGPLv2/LGPLv3\uff1b\u7edf\u4e00\u5bf9\u8c61\u89c6\u56fe\uff0c\u4e0eUNIX\u8bbe\u8ba1\u54f2\u5b66\u7c7b\u4f3c\uff0c\u6240\u6709\u7686\u5bf9\u8c61\uff1b\u8de8\u5e73\u53f0\u517c\u5bb9\u6027\u9ad8\uff0c\u53ef\u4f5c\u4e3ahadoop\u3001openstack\u3001ovirt\u3001Amazon EC\u7684\u540e\u7aef\u3002 ```{image} ../images/02-02.png :align: center :::{note} \u7816\u5757\uff08brick\uff09 \uff1a\u5373\u670d\u52a1\u5668\u8282\u70b9\u4e0a\u5bfc\u51fa\u7684\u4e00\u4e2a\u76ee\u5f55\uff0c\u4f5c\u4e3aglusterfs\u7684\u6700\u57fa\u672c\u5355\u5143\u3002 \u5377\uff08volume\uff09 \uff1a\u7528\u6237\u6700\u7ec8\u4f7f\u7528\u7684\u3001\u7531\u7816\u5757\u7ec4\u6210\u7684\u903b\u8f91\u5377\u3002 GFID \uff1aglusterfs\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u90fd\u6709\u4e00\u4e2a\u72ec\u7acb\u7684128\u4f4dGFID\uff0c\u4e0e\u666e\u901a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684inode\u7c7b\u4f3c\u3002 \u8282\u70b9\uff08peer\uff09 \uff1a\u5373\u96c6\u7fa4\u4e2d\u542b\u6709\u7816\u5757\u5e76\u53c2\u4e0e\u6784\u5efa\u5377\u7684\u8ba1\u7b97\u673a\u3002 ::: \u529f\u80fd\u4ecb\u7ecd \u5177\u4f53\u529f\u80fd\u7279\u6027\u8bf7\u53c2\u8003 Glusterfs features \u3002 \u7ec4\u5408\u65b9\u5f0f gluster\u652f\u6301\u56db\u79cd\u5b58\u50a8\u903b\u8f91\u5377\u7ec4\u5408\uff1a\u666e\u901a\u5206\u5e03\u5f0f\uff08Distributed\uff09\u3001\u6761\u5e26\uff08Striped\uff09\u3001\u5197\u4f59\uff08Replicated\uff09\u3001\u6761\u5e26\u5197\u4f59\uff08Striped-Replicated\uff09 {eval_rst} +-----------+-------------------------------+ |\u666e\u0000\u901a\u0000\u5206\u0000\u5e03\u0000\u5f0f\u0000 |.. image:: ../images/02-04.png | | | :align: center | +-----------+-------------------------------+ |\u6761\u0000\u5e26\u0000 |.. image:: ../images/02-05.png | | | :align: center | +-----------+-------------------------------+ | \u5197\u0000\u4f59\u0000 |.. image:: ../images/02-06.png | | | :align: center | +-----------+-------------------------------+ |\u6761\u0000\u5e26\u0000\u5197\u0000\u4f59\u0000 |.. image:: ../images/02-07.png | | | :align: center | +-----------+-------------------------------+ Translator Translator\u662fglusterfs\u8bbe\u8ba1\u65f6\u7684\u6838\u5fc3\u4e4b\u4e00\uff0c\u5b83\u5177\u6709\u4ee5\u4e0b\u529f\u80fd\uff1a \u5c06\u7528\u6237\u53d1\u6765\u7684\u8bf7\u6c42\u8f6c\u5316\u4e3a\u5bf9\u5b58\u50a8\u7684\u8bf7\u6c42\uff0c\u53ef\u4ee5\u662f\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u6216\u8005\u4e00\u5bf9\u96f6\uff08cache\uff09\u3002 \u53ef\u7528\u4fee\u6539\u8bf7\u6c42\u7c7b\u578b\u3001\u8def\u5f84\u3001\u6807\u5fd7\uff0c\u751a\u81f3\u662f\u6570\u636e\uff08\u52a0\u5bc6\uff09\u3002 \u62e6\u622a\u8bf7\u6c42\uff08\u8bbf\u95ee\u63a7\u5236\uff09\u3002 \u751f\u6210\u65b0\u8bf7\u6c42\uff08\u9884\u53d6\uff09\u3002 \u7c7b\u578b \u6839\u636etranslator\u7684\u7c7b\u578b\uff0c\u53ef\u7528\u5c06\u5176\u5206\u4e3a\u5982\u4e0b\u7c7b\u578b\uff1a Translator \u7c7b\u578b \u529f\u80fd Storage \u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u3002 Debug \u63d0\u4f9b\u8c03\u8bd5\u4fe1\u606f\u3002 Cluster \u5904\u7406\u96c6\u7fa4\u73af\u5883\u4e0b\u8bfb\u5199\u8bf7\u6c42\u3002 Encryption \u52a0\u5bc6/\u89e3\u5bc6\u4f20\u9001\u4e2d\u7684\u6570\u636e\u3002 Protocol \u52a0\u5bc6/\u89e3\u5bc6\u4f20\u9001\u4e2d\u7684\u6570\u636e\u3002 Performance IO\u53c2\u6570\u8c03\u8282\u3002 Bindings \u589e\u52a0\u53ef\u6269\u5c55\u6027\uff0c\u6bd4\u5982python\u63a5\u53e3\u3002 System \u8d1f\u8d23\u7cfb\u7edf\u8bbf\u95ee\uff0c\u6bd4\u5982\u6587\u4ef6\u7cfb\u7edf\u63a7\u5236\u63a5\u53e3\u8bbf\u95ee\u3002 Scheduler \u8c03\u5ea6\u96c6\u7fa4\u73af\u5883\u4e0b\u6587\u4ef6\u8bbf\u95ee\u8bf7\u6c42\u3002 Features \u63d0\u4f9b\u989d\u5916\u6587\u4ef6\u7279\u6027\uff0c\u6bd4\u5982quota\uff0c\u9501\u673a\u5236\u7b49\u3002 AFR AFR\uff08Automatic File Replication\uff09\u662ftranslator\u7684\u4e00\u79cd\uff0c\u5b83\u4f7f\u7528\u989d\u5916\u673a\u5236\u53bb\u63a7\u5236\u8ddf\u8e2a\u6587\u4ef6\u64cd\u4f5c\uff0c\u7528\u4e8e\u8de8\u7816\u5757\u590d\u5236\u6570\u636e\u3002 \u652f\u6301\u8de8\u7f51\u5907\u4efd {eval_rst} +-----------+-------------------------------+ |\u5c40\u0000\u57df\u0000\u7f51\u0000\u5907\u0000\u4efd\u0000 |.. image:: ../images/02-08.png | | | :align: center | +-----------+-------------------------------+ |\u5185\u0000\u7f51\u0000\u5907\u0000\u4efd\u0000 |.. image:: ../images/02-09.png | | | :align: center | +-----------+-------------------------------+ |\u5e7f\u0000\u57df\u0000\u7f51\u0000\u5907\u0000\u4efd\u0000 |.. image:: ../images/02-10.png | | | :align: center | +-----------+-------------------------------+ \u5176\u4e2d\uff0c\u5b83\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a \u4fdd\u6301\u6570\u636e\u4e00\u81f4\u6027 \u53d1\u751f\u8111\u88c2\u65f6\u81ea\u52a8\u6062\u590d\uff0c\u5e94\u4fdd\u8bc1\u81f3\u5c11\u4e00\u4e2a\u8282\u70b9\u6709\u6b63\u786e\u6570\u636e \u4e3a\u8bfb\u7cfb\u5217\u64cd\u4f5c\u63d0\u4f9b\u6700\u65b0\u6570\u636e\u7ed3\u6784 DHT DHT\uff08Distributed Hash Table\uff09\u662fglusterfs\u7684\u771f\u6b63\u6838\u5fc3\u3002\u5b83\u51b3\u5b9a\u5c06\u6bcf\u4e2a\u6587\u4ef6\u653e\u7f6e\u81f3\u7816\u5757\u7684\u4f4d\u7f6e\u3002\u4e0d\u540c\u4e8e\u591a\u526f\u672c\u6216\u8005\u6761\u5e26\u6a21\u5f0f\uff0c\u5b83\u7684\u529f\u80fd\u662f\u8def\u7531\uff0c\u800c\u4e0d\u662f\u5206\u5272\u6216\u8005\u62f7\u8d1d\u3002 \u5de5\u4f5c\u65b9\u5f0f \u5206\u5e03\u5f0f\u54c8\u5e0c\u8868\u7684\u6838\u5fc3\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\uff0c\u53c8\u540d\u73af\u5f62\u54c8\u5e0c\u3002\u5b83\u5177\u6709\u7684\u4e00\u4e2a\u6027\u8d28\u662f\u5f53\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u88ab\u52a0\u5165\u6216\u8005\u5220\u9664\u65f6\uff0c\u73b0\u6709\u5f97\u6620\u5c04\u5173\u7cfb\u7684\u6539\u53d8\u5c3d\u53ef\u80fd\u5c0f\u3002 \u5047\u8bbe\u6211\u4eec\u7684\u54c8\u5e0c\u7b97\u51fa\u4e00\u4e2a32\u4f4d\u7684\u54c8\u5e0c\u503c\uff0c\u5373\u4e00\u4e2a[0,2^32-1]\u7684\u7a7a\u95f4\uff0c\u73b0\u5c06\u5b83\u9996\u5c3e\u76f8\u63a5\uff0c\u5373\u6784\u6210\u4e00\u4e2a\u73af\u5f62\u3002 \u5047\u5982\u6211\u4eec\u6709\u56db\u4e2a\u5b58\u50a8\u7816\u5757\uff0c\u6bcf\u4e00\u4e2a\u7816\u5757B\u90fd\u6709\u4e00\u4e2a\u54c8\u5e0c\u503cH\uff0c\u5047\u8bbe\u56db\u4e2a\u6587\u4ef6\u53ca\u5176\u54c8\u5e0c\u503c\u8868\u793a\u4e3a(k,v)\uff0c\u90a3\u4e48\u4ed6\u4eec\u5728\u54c8\u5e0c\u73af\u4e0a\u5373\u5982\u6b64\u8868\u793a\uff1a ```{image} ../images/02-14.png :align: center 1 2 3 4 \u6bcf\u4e00\u4e2a\u6587\u4ef6\u54c8\u5e0ck\u987a\u65f6\u9488\u79fb\u52a8\u9047\u5230\u4e00\u4e2aH\u540e\uff0c\u5c31\u5c06\u6587\u4ef6k\u4fdd\u5b58\u81f3B\u3002 ```{image} ../images/02-15.png :align: center \u4e0a\u56fe\u8868\u793a\u7684\u662f\u7406\u60f3\u73af\u5883\u4e0b\u6587\u4ef6\u4e0e\u7816\u5757\u7684\u5b58\u50a8\u6620\u5c04\uff0c\u5f53\u6709\u7816\u5757\u5931\u6548\u65f6\uff0c\u5b58\u50a8\u4f4d\u7f6e\u7684\u6620\u5c04\u4e5f\u5c31\u53d1\u751f\u4e86\u6539\u53d8\u3002\u6bd4\u5982\u7816\u5757B3\u5931\u6548\uff0c\u90a3\u4e48\u6587\u4ef6v3\u4f1a\u88ab\u7ee7\u7eed\u987a\u65f6\u9488\u6539\u53d8\u81f3B4\u4e0a\u3002 ```{image} ../images/02-16.png :align: center 1 2 3 4 \u5f53\u7816\u5757\u6570\u76ee\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u4e3a\u4e86\u670d\u52a1\u5668\u80fd\u5e73\u644a\u8d1f\u8f7d\uff0c\u6211\u4eec\u9700\u8981\u4e00\u6b21rebalance\u6765\u7a0d\u8bb8\u6539\u53d8\u6620\u5c04\u5173\u7cfb\u3002rebalance\u7684\u6280\u5de7\u5373\u662f\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7684\u5b58\u50a8\u4f4d\u7f6eB'\uff0c\u4f7f\u6240\u6709\u7816\u5757\u53ca\u5176\u865a\u62df\u7816\u5757\u5c3d\u91cf\u90fd\u5b58\u50a8\u6709\u6587\u4ef6\u3002 ```{image} ../images/02-17.png :align: center ```{image} ../images/02-18.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ## 2.3 \u642d\u5efaGlusterfs\u4f5c\u4e3a\u57fa\u7840\u5b58\u50a8 \u65e2\u7136\u8981\u642d\u5efa\u4e00\u4e2a\u7a33\u5065\u7684\u57fa\u7840\u5b58\u50a8\uff0c\u90a3\u4e48glusterfs\u63a8\u8350\u4f7f\u7528distributed striped replicated\u65b9\u5f0f\uff0c\u8fd9\u91cc\u4f7f\u75284\u53f0\u9884\u88c5CentOS 6(SELINUX\u8bbe\u7f6e\u4e3apermissive)\u7684\u673a\u5668\u8fdb\u884c\u6f14\u793a\u3002 ### \u6dfb\u52a0DNS\u6216\u8005\u4fee\u6539hosts\u6587\u4ef6 \u9274\u4e8e\u7b14\u8005\u6240\u5728\u73af\u5883\u4e2d\u6682\u65f6\u6ca1\u6709\u914d\u7f6e\u72ec\u7acb\u7684DNS\uff0c\u6b64\u5904\u5148\u4fee\u6539hosts\u6587\u4ef6\u4ee5\u5b8c\u6210\u914d\u7f6e\uff0c\u6ce8\u610f\u6bcf\u53f0\u673a\u5668\u90fd\u8981\u6dfb\u52a0\uff1a > */etc/hosts* > ```{code} 127.0.0.1 localhost.localdomain localhost ::1 localhost6.localdomain6 localhost6 192.168.10.101 gs1.example.com 192.168.10.102 tgs2.example.com 192.168.10.103 tgs3.example.com 192.168.10.104 gs4.example.com \u540c\u6837\u5730\u5728\u6240\u6709\u673a\u5668\u4e0a\u6dfb\u52a0repo\uff1a /etc/yum.repos.d/gluster_epel.repo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 [epel] name=Extra Packages for Enterprise Linux 6 - $basearch #baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&amp;arch=$basearch failovermethod=priority enabled=1 gpgcheck=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6 [glusterfs-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/$basearch/ enabled=1 skip_if_unavailable=1 gpgcheck=0 gpgkey=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/pub.key [glusterfs-noarch-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/noarch enabled=1 skip_if_unavailable=1 gpgcheck=0 gpgkey=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/pub.key [glusterfs-source-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. - Source baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/SRPMS enabled=0 skip_if_unavailable=1 gpgcheck=1 gpgkey=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/pub.key \u51c6\u5907\u78c1\u76d8\u4f5c\u4e3a\u7816\u5757 \u5728\u6240\u6709\u8282\u70b9\u4e0a\u5b89\u88c5xfs\u7528\u6237\u7a7a\u95f4\u5de5\u5177\uff1a 1 2 3 4 5 # yum install -y glusterfs glusterfs-fuse glusterfs-server xfsprogs # /etc/init.d/glusterd start # /etc/init.d/glusterfsd start # chkconfig glusterfsd on # chkconfig glusterd on \u5047\u8bbe\u6bcf\u53f0\u673a\u5668\u9664\u7cfb\u7edf\u76d8\u4e4b\u5916\u90fd\u67092\u57571T SATA\u786c\u76d8\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u5206\u533a\uff0c\u521b\u5efa\u903b\u8f91\u5377\uff0c\u683c\u5f0f\u5316\u5e76\u6302\u8f7d\uff1a 1 2 3 4 5 6 7 # fdisk /dev/sdX << EOF n p 1 w EOF \u683c\u5f0f\u5316\u5e76\u6302\u8f7d\uff1a 1 2 3 4 5 6 7 8 # mkfs.xfs -i size 512 /dev/sdb1 # mkfs.xfs -i size 512 /dev/sdc1 # mkdir /gluster_brick_root1 # mkdir /gluster_brick_root2 # echo -e \"/dev/sdb1\\t/gluster_brick_root1\\txfs\\tdefaults\\t0 0\\n/dev/sdc1\\t/gluster_brick_root2\\txfs\\tdefaults\\t0 0\" >> /etc/fstab # mount -a # mkdir /gluster_brick_root1/data # mkdir /gluster_brick_root2/data :::{note} \u4e3a\u4ec0\u4e48\u8981\u7528XFS\uff1f XFS\u5177\u6709\u5143\u6570\u636e\u65e5\u5fd7\u529f\u80fd\uff0c\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u6570\u636e\uff1b\u540c\u65f6\uff0c\u53ef\u4ee5\u5728\u7ebf\u6269\u5bb9\u53ca\u788e\u7247\u6574\u7406\u3002\u5176\u4ed6\u6587\u4ef6\u7cfb\u7edf\u6bd4\u5982EXT3\uff0cEXT4\u672a\u505a\u5145\u5206\u6d4b\u8bd5\u3002 ::: \u6dfb\u52a0\u5377 \u5728\u5176\u4e2d\u4efb\u610f\u53f0\u673a\u5668\u4e0a\uff0c\u6bd4\u5982gs2.example.com\uff0c\u6267\u884c 1 2 3 # gluster peer probe gs1.example.com # gluster peer probe gs3.example.com # gluster peer probe gs4.example.com \u4f7f\u7528\u7816\u5757\u8fdb\u884c\u5377\u7684\u6784\u5efa\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 # gluster > volume create gluster-vol1 stripe 2 replica 2 \\ gs1.example.com:/gluster_brick_root1/data gs2.example.com:/gluster_brick_root1/data \\ gs1.example.com:/gluster_brick_root2/data gs2.example.com:/gluster_brick_root2/data \\ gs3.example.com:/gluster_brick_root1/data gs4.example.com:/gluster_brick_root1/data \\ gs3.example.com:/gluster_brick_root2/data gs4.example.com:/gluster_brick_root2/data force > volume start gluster-vol1 # \u542f\u52a8\u5377 > volume status gluster-vol1 # \u67e5\u770b\u5377\u72b6\u6001 Status of volume: gluster-vol1 Gluster process Port Online Pid ------------------------------------------------------------------------------ Brick gs1.example.com:/gluster_brick_root1/data 49152 Y 1984 Brick gs2.example.com:/gluster_brick_root1/data 49152 Y 1972 Brick gs1.example.com:/gluster_brick_root2/data 49153 Y 1995 Brick gs2.example.com:/gluster_brick_root2/data 49153 Y 1983 Brick gs3.example.com:/gluster_brick_root1/data 49152 Y 1961 Brick gs4.example.com:/gluster_brick_root1/data 49152 Y 1975 Brick gs3.example.com:/gluster_brick_root2/data 49153 Y 1972 Brick gs4.example.com:/gluster_brick_root2/data 49153 Y 1986 NFS Server on localhost 2049 Y 1999 Self-heal Daemon on localhost N/A Y 2006 NFS Server on gs2.example.com 2049 Y 2007 Self-heal Daemon on gs2.example.com N/A Y 2014 NFS Server on gs2.example.com 2049 Y 1995 Self-heal Daemon on gs2.example.com N/A Y 2002 NFS Server on gs3.example.com 2049 Y 1986 Self-heal Daemon on gs3.example.com N/A Y 1993 Task Status of Volume gluster-vol1 ------------------------------------------------------------------------------ There are no active volume tasks > volume info all \u67e5\u770b\u6240\u6709\u5377\u4fe1\u606f gluster volume info all Volume Name: gluster-vol1 Type: Distributed-Striped-Replicate Volume ID: bc8e102c-2b35-4748-ab71-7cf96ce083f3 Status: Started Number of Bricks: 2 x 2 x 2 = 8 Transport-type: tcp Bricks: Brick1: gs1.example.com:/gluster_brick_root1/data Brick2: gs2.example.com:/gluster_brick_root1/data Brick3: gs1.example.com:/gluster_brick_root2/data Brick4: gs2.example.com:/gluster_brick_root2/data Brick5: gs3.example.com:/gluster_brick_root1/data Brick6: gs4.example.com:/gluster_brick_root1/data Brick7: gs3.example.com:/gluster_brick_root2/data Brick8: gs4.example.com:/gluster_brick_root2/data \u6302\u8f7d\u5377 \u5f53\u4ee5glusterfs\u6302\u8f7d\u65f6\uff0c\u5ba2\u6237\u7aef\u7684hosts\u6587\u4ef6\u91cc\u9700\u8981\u6709\u7684\u4efb\u4e00\u8282\u70b9\u505a\u89e3\u6790\uff1a \u6302\u8f7dglusterfs\u7684\u5ba2\u6237\u7aef/etc/hosts 1 2 3 4 127.0.0.1 localhost.localdomain localhost ::1 localhost6.localdomain6 localhost6 192.168.1.81 gs1.example.com \u5b89\u88c5gluster-fuse\uff0c\u5c06gluster\u5377\u4f5c\u4e3aglusterfs\u6302\u8f7d\uff0c\u5e76\u5199\u51651M\u6587\u4ef6\u67e5\u770b\u5176\u5728\u5404\u7816\u5757\u5206\u914d\uff1a 1 2 3 4 5 # yum install glusterfs glusterfs-fuse # mount.glusterfs 192.168.1.81:/gluster-vol1 /mnt # cd /mnt # dd if=/dev/zero of=a.img bs=1k count=1k # cp a.img b.img; cp a.img c.img; cp a.img d.img \u5728\u56db\u53f0\u670d\u52a1\u7aef\u5206\u522b\u67e5\u770b\uff1a 1 2 3 4 5 6 7 8 9 [root@gs1 ~]# ls -lh /gluster_brick_root* /gluster_brick_root1/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 a.img -rw-r--r--. 2 root root 512K Apr 22 17:13 d.img /gluster_brick_root2/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 a.img -rw-r--r--. 2 root root 512K Apr 22 17:13 d.img 1 2 3 4 5 6 7 8 9 [root@gs2 ~]# ls -lh /gluster_brick_root* /gluster_brick_root1/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 a.img -rw-r--r--. 2 root root 512K Apr 22 17:13 d.img /gluster_brick_root2/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 a.img -rw-r--r--. 2 root root 512K Apr 22 17:13 d.img 1 2 3 4 5 6 7 8 9 [root@gs3 ~]# ls -lh /gluster_brick_root* /gluster_brick_root1/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 b.img -rw-r--r--. 2 root root 512K Apr 22 17:13 c.img /gluster_brick_root2/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 b.img -rw-r--r--. 2 root root 512K Apr 22 17:13 c.img 1 2 3 4 5 6 7 8 9 [root@gs4 ~]# ls -lh /gluster_brick_root* /gluster_brick_root1/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 b.img -rw-r--r--. 2 root root 512K Apr 22 17:13 c.img /gluster_brick_root2/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 b.img -rw-r--r--. 2 root root 512K Apr 22 17:13 c.img \u81f3\u6b64\uff0c\u6240\u6709\u914d\u7f6e\u7ed3\u675f\u3002 2.4 Glusterfs\u5e94\u7528\u793a\u4f8b\u53ca\u6280\u5de7 \u53c2\u6570\u8c03\u6574 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | Option | Description | Default Value | Available Options | +======================================+===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+============================+=====================================================================================+ | auth.allow | IP addresses of the clients which should be allowed to access the volume. | * (allow all) | Valid IP address which includes wild card patterns including *, such as 192.168.1.* | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | auth.reject | IP addresses of the clients which should be denied to access the volume. | NONE (reject none) | Valid IP address which includes wild card patterns including *, such as 192.168.2.* | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | client.grace-timeout | Specifies the duration for the lock state to be maintained on the client after a network disconnection. | 10 | 10 - 1800 secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.self-heal-window-size | Specifies the maximum number of blocks per file on which self-heal would happen simultaneously. | 16 | 0 - 1025 blocks | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.data-self-heal-algorithm | Specifies the type of self-heal. If you set the option as \"full\", the entire file is copied from source to destinations. If the option is set to \"diff\" the file blocks that are not in sync are copied to destinations. Reset uses a heuristic model. If the file does not exist on one of the subvolumes, or a zero-byte file exists (created by entry self-heal) the entire content has to be copied anyway, so there is no benefit from using the \"diff\" algorithm. If the file size is about the same as page size, the entire file can be read and written with a few operations, which will be faster than \"diff\" which has to read checksums and then read and write. | reset | full/diff/reset | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.min-free-disk | Specifies the percentage of disk space that must be kept free. Might be useful for non-uniform bricks | 10% | Percentage of required minimum free disk space | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.stripe-block-size | Specifies the size of the stripe unit that will be read from or written to. | 128 KB (for all files) | size in bytes | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.self-heal-daemon | Allows you to turn-off proactive self-heal on replicated | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.ensure-durability | This option makes sure the data/metadata is durable across abrupt shutdown of the brick. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | diagnostics.brick-log-level | Changes the log-level of the bricks. | INFO | DEBUG/WARNING/ERROR/CRITICAL/NONE/TRACE | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | diagnostics.client-log-level | Changes the log-level of the clients. | INFO | DEBUG/WARNING/ERROR/CRITICAL/NONE/TRACE | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | diagnostics.latency-measurement | Statistics related to the latency of each operation would be tracked. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | diagnostics.dump-fd-stats | Statistics related to file-operations would be tracked. | Off | On | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | features.read-only | Enables you to mount the entire volume as read-only for all the clients (including NFS clients) accessing it. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | features.lock-heal | Enables self-healing of locks when the network disconnects. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | features.quota-timeout | For performance reasons, quota caches the directory sizes on client. You can set timeout indicating the maximum duration of directory sizes in cache, from the time they are populated, during which they are considered valid | 0 | 0 - 3600 secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | geo-replication.indexing | Use this option to automatically sync the changes in the filesystem from Master to Slave. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | network.frame-timeout | The time frame after which the operation has to be declared as dead, if the server does not respond for a particular operation. | 1800 (30 mins) | 1800 secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | network.ping-timeout | The time duration for which the client waits to check if the server is responsive. When a ping timeout happens, there is a network disconnect between the client and server. All resources held by server on behalf of the client get cleaned up. When a reconnection happens, all resources will need to be re-acquired before the client can resume its operations on the server. Additionally, the locks will be acquired and the lock tables updated. This reconnect is a very expensive operation and should be avoided. | 42 Secs | 42 Secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.enable-ino32 | For 32-bit nfs clients or applications that do not support 64-bit inode numbers or large files, use this option from the CLI to make Gluster NFS return 32-bit inode numbers instead of 64-bit inode numbers. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.volume-access | Set the access type for the specified sub-volume. | read-write | read-write/read-only | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.trusted-write | If there is an UNSTABLE write from the client, STABLE flag will be returned to force the client to not send a COMMIT request. In some environments, combined with a replicated GlusterFS setup, this option can improve write performance. This flag allows users to trust Gluster replication logic to sync data to the disks and recover when required. COMMIT requests if received will be handled in a default manner by fsyncing. STABLE writes are still handled in a sync manner. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.trusted-sync | All writes and COMMIT requests are treated as async. This implies that no write requests are guaranteed to be on server disks when the write reply is received at the NFS client. Trusted sync includes trusted-write behavior. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.export-dir | This option can be used to export specified comma separated subdirectories in the volume. The path must be an absolute path. Along with path allowed list of IPs/hostname can be associated with each subdirectory. If provided connection will allowed only from these IPs. Format: <dir>[(hostspec[hostspec...])][,...]. Where hostspec can be an IP address, hostname or an IP range in CIDR notation. Note: Care must be taken while configuring this option as invalid entries and/or unreachable DNS servers can introduce unwanted delay in all the mount calls. | No sub directory exported. | Absolute path with allowed list of IP/hostname | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.export-volumes | Enable/Disable exporting entire volumes, instead if used in conjunction with nfs3.export-dir, can allow setting up only subdirectories as exports. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.rpc-auth-unix | Enable/Disable the AUTH_UNIX authentication type. This option is enabled by default for better interoperability. However, you can disable it if required. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.rpc-auth-null | Enable/Disable the AUTH_NULL authentication type. It is not recommended to change the default value for this option. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.rpc-auth-allow<IP- Addresses> | Allow a comma separated list of addresses and/or hostnames to connect to the server. By default, all clients are disallowed. This allows you to define a general rule for all exported volumes. | Reject All | IP address or Host name | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.rpc-auth-reject<IP- Addresses> | Reject a comma separated list of addresses and/or hostnames from connecting to the server. By default, all connections are disallowed. This allows you to define a general rule for all exported volumes. | Reject All | IP address or Host name | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.ports-insecure | Allow client connections from unprivileged ports. By default only privileged ports are allowed. This is a global setting in case insecure ports are to be enabled for all exports using a single option. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.addr-namelookup | Turn-off name lookup for incoming client connections using this option. In some setups, the name server can take too long to reply to DNS queries resulting in timeouts of mount requests. Use this option to turn off name lookups during address authentication. Note, turning this off will prevent you from using hostnames in rpc-auth.addr.* filters. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.register-with-portmap | For systems that need to run multiple NFS servers, you need to prevent more than one from registering with portmap service. Use this option to turn off portmap registration for Gluster NFS. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.port <PORT- NUMBER> | Use this option on systems that need Gluster NFS to be associated with a non-default port number. | NA | 38465- 38467 | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.disable | Turn-off volume being exported by NFS | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.write-behind-window-size | Size of the per-file write-behind buffer. | 1MB | Write-behind cache size | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.io-thread-count | The number of threads in IO threads translator. | 16 | 0-65 | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.flush-behind | If this option is set ON, instructs write-behind translator to perform flush in background, by returning success (or any errors, if any of previous writes were failed) to application even before flush is sent to backend filesystem. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.cache-max-file-size | Sets the maximum file size cached by the io-cache translator. Can use the normal size descriptors of KB, MB, GB,TB or PB (for example, 6GB). Maximum size uint64. | 2 ^ 64 -1 bytes | size in bytes | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.cache-min-file-size | Sets the minimum file size cached by the io-cache translator. Values same as \"max\" above | 0B | size in bytes | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.cache-refresh-timeout | The cached data for a file will be retained till 'cache-refresh-timeout' seconds, after which data re-validation is performed. | 1s | 0-61 | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.cache-size | Size of the read cache. | 32 MB | size in bytes | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | server.allow-insecure | Allow client connections from unprivileged ports. By default only privileged ports are allowed. This is a global setting in case insecure ports are to be enabled for all exports using a single option. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | server.grace-timeout | Specifies the duration for the lock state to be maintained on the server after a network disconnection. | 10 | 10 - 1800 secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | server.statedump-path | Location of the state dump file. | tmp directory of the brick | New directory path | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | storage.health-check-interval | Number of seconds between health-checks done on the filesystem that is used for the brick(s). Defaults to 30 seconds, set to 0 to disable. | tmp directory of the brick | New directory path | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ \u5177\u4f53\u53c2\u6570\u53c2\u8003 gluster_doc \u3002 \u6587\u4ef6\u6743\u9650 glusterfs\u5728\u521b\u5efa\u5377\u65f6\u4f1a\u66f4\u6539\u7816\u5757\u6240\u6709\u8005\u4e3aroot.root\uff0c\u5bf9\u4e8e\u67d0\u4e9b\u5e94\u7528\u8bf7\u6ce8\u610f\u66f4\u6539\u7816\u5757\u76ee\u5f55\u6240\u6709\u8005\uff08\u6bd4\u5982\u5728/etc/rc.local\u4e2d\u6dfb\u52a0chown\uff0c\u4e0d\u8981\u66f4\u6539\u7816\u5757\u4e0b\u9690\u85cf\u76ee\u5f55.glusterfs\uff09\u3002 \u7816\u5757\u7ec4\u5408 \u7f51\u4e0a\u73b0\u6709\u7684\u90e8\u5206\u6587\u6863\u4e2d\u6240\u8ff0\u7684\u7816\u5757\u5212\u5206\u65b9\u5f0f\uff0c\u662f\u5c06\u6574\u4e2a\u78c1\u76d8\u5212\u5206\u4e3a\u7816\u5757\uff0c\u6b64\u79cd\u5212\u5206\u65b9\u5f0f\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u4e0d\u662f\u5f88\u597d\uff08\u6bd4\u5982\u5b58\u50a8\u590d\u7528\uff09\uff0c\u53ef\u4ee5\u5728/brickX\u4e0b\u521b\u5efa\u76ee\u5f55\uff0c\u6bd4\u5982data1\uff0c\u540c\u65f6\u5728\u521b\u5efaglusterfs\u5377\u7684\u65f6\u5019\u4f7f\u7528HOST:/brickX/data1\u4f5c\u4e3a\u7816\u5757\uff0c\u4ee5\u5408\u7406\u5229\u7528\u5b58\u50a8\u7a7a\u95f4\u3002 normal\u3001replica\u3001striped\u5377\u7ec4\u5408 \u7816\u5757\u7684\u5212\u5206\u6392\u5e8f\uff1astriped\uff08normal\uff09\u4f18\u5148\uff0creplica\u5728striped\uff08normal\uff09\u57fa\u7840\u4e0a\u505a\u5197\u4f59\uff1b\u8ba1\u7b97\u5927\u5c0f\u65f6\uff0c\u540c\u4e00replica\u7ec4\u4e2d\u7684brick\u5408\u5e76\u4e3a\u4e00\u4e2a\u7816\u5757\uff0c\u4e00\u4e2astriped\u7ec4\u53ef\u770b\u505a\u4e00\u4e2a\u6709\u6548\u5757\u3002 \u5047\u8bbe\u6211\u4eec\u67094\u4e2a\u4e3b\u673a\uff0c8\u4e2a\u7816\u5757\uff0c\u6bcf\u4e2a\u7816\u5757\u90fd\u662f5GB\uff0c\u5982\u4e0b\u56fe\uff1a ```{image} ../images/02-11.png :align: center ``` \u521b\u5efa\u5377\u65f6\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a 1 2 3 # gluster volume create gluster-vol1 stripe 2 replica 2 \\ host1:/brick1 host1:/brick2 host2:/brick1 host2:/brick2 \\ host3:/brick1 host3:/brick2 host4:/brick1 host4:/brick2 force \u7816\u5757\u5c06\u4f1a\u6309\u7167\u5982\u4e0b\u8fdb\u884c\u7ec4\u5408\uff1a ```{image} ../images/02-12.png :align: center ``` \u7136\u800c\uff0c\u521b\u5efa\u5377\u65f6\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a 1 2 3 # gluster volume create gluster-vol1 stripe 2 replica 2 \\ host1:/brick1 host2:/brick1 host3:/brick1 host4:/brick1 \\ host1:/brick2 host2:/brick2 host3:/brick2 host4:/brick2 force \u7816\u5757\u5c06\u4f1a\u6309\u7167\u5982\u4e0b\u8fdb\u884c\u7ec4\u5408\uff1a ```{image} ../images/02-13.png :align: center ``` \u4f5c\u4e3anfs\u6302\u8f7d \u7531\u4e8eglusterfs\u5360\u7528\u4e862049\u7aef\u53e3\uff0c\u6240\u4ee5\u5176\u4e0enfs server\u4e00\u822c\u4e0d\u80fd\u5171\u5b58\u4e8e\u540c\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u9664\u975e\u66f4\u6539nfs\u670d\u52a1\u7aef\u53e3\u3002 1 # mount -t nfs -o vers=3 server1:/volume1 /mnt \u4f5c\u4e3acifs\u6302\u8f7d \u5148\u5728\u67d0\u4e00\u670d\u52a1\u5668\u6216\u8005\u5ba2\u6237\u7aef\u5c06\u8d77\u6302\u8f7d\uff0c\u518d\u4ee5cifs\u65b9\u5f0f\u5bfc\u51fa\uff1a /etc/smb.conf 1 2 3 4 5 [glustertest] comment = For testing a Gluster volume exported through CIFS path = /mnt/glusterfs read only = no guest ok = yes \u4fee\u590d\u88c2\u8111\uff08split-brain\uff09 \u88c2\u8111\u53d1\u751f\u4ee5\u540e\uff0c\u5404\u8282\u70b9\u4fe1\u606f\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u67e5\u770b\u5e76\u4fee\u590d\u3002 \u5b9a\u4f4d\u88c2\u8111\u6587\u4ef6 \u901a\u8fc7\u547d\u4ee4 1 # gluster volume heal info split-brain \u6216\u8005\u67e5\u770b\u5728\u5ba2\u6237\u7aef\u4ecd\u7136\u662fInput/Output\u9519\u8bef\u7684\u6587\u4ef6\u3002 \u5173\u95ed\u5df2\u7ecf\u6253\u5f00\u7684\u6587\u4ef6\u6216\u8005\u865a\u673a \u786e\u5b9a\u6b63\u786e\u526f\u672c \u6062\u590d\u6269\u5c55\u5c5e\u6027 \u767b\u5f55\u5230\u540e\u53f0\uff0c\u67e5\u770b\u8111\u88c2\u6587\u4ef6\u7684MD5sum\u548c\u65f6\u95f4\uff0c\u5224\u65ad\u54ea\u4e2a\u526f\u672c\u662f\u9700\u8981\u4fdd\u7559\u7684\u3002 \u7136\u540e\u5220\u9664\u4e0d\u518d\u9700\u8981\u7684\u526f\u672c\u5373\u53ef\u3002\uff08glusterfs\u91c7\u7528\u786c\u94fe\u63a5\u65b9\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u540c\u65f6\u5220\u9664.gluster\u4e0b\u9762\u7684\u786c\u8fde\u63a5\u6587\u4ef6\uff09 \u9996\u5148\u68c0\u67e5\u6587\u4ef6\u7684md5\u503c\uff0c\u5e76\u4e14\u548c\u5176\u4ed6\u7684\u8282\u70b9\u6bd4\u8f83\uff0c\u786e\u8ba4\u662f\u5426\u9700\u8981\u5220\u9664\u6b64\u526f\u672c\u3002 1 2 [root@hostd data0]# md5sum 1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c 6c6b704ce1c0f6d22204449c085882e2 1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c \u901a\u8fc7ls -i \u548cfind -inum \u627e\u5230\u6b64\u6587\u4ef6\u53ca\u5176\u786c\u8fde\u63a5\u6587\u4ef6\u3002 1 2 3 4 5 [root@hostd data0]# ls -i 1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c 12976365 1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c [root@hostd data0]# find -inum 12976365 ./1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c ./.glusterfs/01/8d/018db725-c8b8-47ed-a6bb-f6ad4195134f \u5220\u9664\u4e24\u4e2a\u6587\u4ef6 1 [root@hostd data0]# find -inum 12976365 |xargs rm -rf \u6216\u8005 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 -bash-4.1# getfattr -d -e hex -m . ids # file: ids trusted.afr.data_double10t-client-0=0x000000010000000000000000 trusted.afr.data_double10t-client-1=0x000000000000000000000000 trusted.afr.dirty=0x000000010000000000000000 trusted.bit-rot.version=0x040000000000000056e52946000deaaa trusted.gfid=0x112060ecdd5c42f9baa3dd2d67fcf729 -bash-4.1# setfattr -x trusted.afr.data_double10t-client-0 ids -bash-4.1# setfattr -x trusted.afr.data_double10t-client-1 ids -bash-4.1# setfattr -x trusted.afr.dirty ids -bash-4.1# getfattr -d -e hex -m . ids # file: ids trusted.bit-rot.version=0x040000000000000056e52946000deaaa trusted.gfid=0x112060ecdd5c42f9baa3dd2d67fcf729 \u8111\u88c2\u6587\u4ef6\u6062\u590d\u5b8c\u6210\uff0c\u6b64\u6587\u4ef6\u53ef\u4ee5\u5728\u6302\u8f7d\u70b9\u4e0a\u8bfb\u5199\u3002 \u7816\u5757\u590d\u7528 \u5f53\u5377\u6b63\u5728\u88ab\u4f7f\u7528\uff0c\u5176\u4e2d\u4e00\u4e2a\u7816\u5757\u88ab\u5220\u9664\uff0c\u800c\u7528\u6237\u8bd5\u56fe\u518d\u6b21\u5c06\u5176\u7528\u4e8e\u5377\u65f6\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u201c/bricks/app or a prefix of it is already part of a volume\u201d\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a 1 2 3 # setfattr -x trusted.glusterfs.volume-id $brick_path # setfattr -x trusted.gfid $brick_path # rm -rf $brick_path/.glusterfs \u9ad8\u53ef\u7528\u4e1a\u52a1IP \u7531\u4e8e\u6302\u8f7d\u5b58\u50a8\u65f6\u9700\u8981\u6307\u5b9a\u96c6\u7fa4\u4e2d\u7684\u4efb\u610fIP\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528Heartbeat/CTDB/Pacemaker\u7b49\u96c6\u7fa4\u8f6f\u4ef6\u6765\u4fdd\u8bc1\u4e1a\u52a1IP\u7684\u9ad8\u53ef\u7528\u3002 \u53ef\u53c2\u8003 http://clusterlabs.org/wiki/Debian_Lenny_HowTo#Configure_an_IP_resource http://geekpeek.net/linux-cluster-corosync-pacemaker/","title":"\u7b2c\u4e8c\u7ae0 \u4e00\u4e2a\u53ef\u9760\u7684\u5b58\u50a8\u540e\u7aef"},{"location":"inthecloud/ch02/#_1","text":"","title":"\u7b2c\u4e8c\u7ae0 \u4e00\u4e2a\u53ef\u9760\u7684\u5b58\u50a8\u540e\u7aef"},{"location":"inthecloud/ch02/#21","text":"\u8ba1\u7b97\u673a\u9886\u57df\u4e2d\u6709\u8bf8\u591a\u6709\u610f\u601d\u7684\u4e1c\u897f\u53ef\u4ee5\u628a\u73a9\uff0c\u5728\u8fd9\u513f\u4e14\u770b\u770b\u5206\u5e03\u5f0f\u5b58\u50a8\u3002 \u96c6\u7fa4\u6587\u4ef6\u7cfb\u7edf \u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u53c8\u53ef\u4ee5\u79f0\u4f5c\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\u3001\u5e76\u884c\u6587\u4ef6\u7cfb\u7edf\uff0c\u572870\u5e74\u4ee3\u7531IBM\u63d0\u51fa\u5e76\u5b9e\u73b0\u539f\u578b\u3002 \u6709\u51e0\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5b9e\u73b0\u96c6\u7fa4\u5f62\u5f0f\uff0c\u4f46\u591a\u6570\u4ec5\u4ec5\u662f\u8282\u70b9\u76f4\u8fde\u5b58\u50a8\u800c\u4e0d\u662f\u5c06\u5b58\u50a8\u4e4b\u4e0a\u7684\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u5408\u7406\u201c\u5206\u5e03\u201d\u3002\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u540c\u65f6\u6302\u8f7d\u4e8e\u591a\u4e2a\u670d\u52a1\u5668\u4e0a\uff0c\u5e76\u5728\u5b83\u4eec\u4e4b\u95f4\u5171\u4eab\uff0c\u53ef\u4ee5\u63d0\u4f9b\u7c7b\u4f3c\u4e8e\u4f4d\u7f6e\u65e0\u5173\u7684\u6570\u636e\u5b9a\u4f4d\u6216\u5197\u4f59\u7b49\u7279\u70b9\u3002\u5e76\u884c\u6587\u4ef6\u7cfb\u7edf\u662f\u4e00\u79cd\u96c6\u7fa4\u5f0f\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u5c06\u6570\u636e\u5206\u5e03\u4e8e\u591a\u4e2a\u8282\u70b9\uff0c\u5176\u4e3b\u8981\u76ee\u7684\u662f\u63d0\u4f9b\u5197\u4f59\u548c\u63d0\u9ad8\u8bfb\u5199\u6027\u80fd\u3002 \u5171\u4eab\u78c1\u76d8\uff08Shared-disk\uff09/Storage-area network(SAN) \u4ece\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u7684\u6587\u4ef6\u7ea7\u522b\uff0c\u5230SAN\u4e4b\u95f4\u7684\u5757\u7ea7\u522b\u7684\u64cd\u4f5c\uff0c\u8bf8\u5982\u6743\u9650\u63a7\u5236\u548c\u4f20\u8f93\uff0c\u90fd\u662f\u53d1\u751f\u5728\u5ba2\u6237\u7aef\u8282\u70b9\u4e0a\u3002\u5171\u4eab\u78c1\u76d8\uff08Shared-disk\uff09\u6587\u4ef6\u7cfb\u7edf\uff0c\u5728\u5e76\u884c\u63a7\u5236\u4e0a\u505a\u4e86\u5f88\u591a\u5de5\u4f5c\uff0c\u4ee5\u81f3\u4e8e\u5176\u62e5\u6709\u6bd4\u8f83\u4e00\u81f4\u8fde\u8d2f\u7684\u6587\u4ef6\u7cfb\u7edf\u89c6\u56fe\uff0c\u4ece\u800c\u907f\u514d\u4e86\u591a\u4e2a\u5ba2\u6237\u7aef\u8bd5\u56fe\u540c\u65f6\u8bbf\u95ee\u540c\u4e00\u8bbe\u5907\u65f6\u6570\u636e\u65ad\u7247\u6216\u4e22\u5931\u7684\u60c5\u51b5\u53d1\u751f\u3002\u5176\u4e2d\u6709\u79cd\u6280\u672f\u53eb\u505a\u56f4\u680f\uff08Fencing\uff09\uff0c\u5c31\u662f\u5728\u67d0\u4e2a\u6216\u67d0\u4e9b\u8282\u70b9\u53d1\u751f\u65ad\u7247\u65f6\uff0c\u96c6\u7fa4\u81ea\u52a8\u5c06\u8fd9\u4e9b\u8282\u70b9\u9694\u79bb\uff08\u5173\u673a\u3001\u65ad\u7f51\u3001\u81ea\u6062\u590d\uff09\uff0c\u4fdd\u8bc1\u5176\u4ed6\u8282\u70b9\u6570\u636e\u8bbf\u95ee\u7684\u6b63\u786e\u6027\u3002\u5143\u6570\u636e\uff08Metadata\uff09\u7c7b\u4f3c\u76ee\u5f55\uff0c\u53ef\u4ee5\u8ba9\u6240\u6709\u7684\u673a\u5668\u90fd\u80fd\u67e5\u627e\u4f7f\u7528\u6240\u6709\u4fe1\u606f\uff0c\u5728\u4e0d\u540c\u7684\u67b6\u6784\u4e2d\u6709\u4e0d\u540c\u7684\u4fdd\u5b58\u65b9\u5f0f\uff0c\u6709\u7684\u5747\u5300\u5206\u5e03\u4e8e\u96c6\u7fa4\uff0c\u6709\u7684\u5b58\u50a8\u5728\u4e2d\u592e\u8282\u70b9\u3002 \u5b9e\u73b0\u7684\u65b9\u5f0f\u6709iSCSI\uff0cAoE\uff0cFC\uff0cInfiniband\u7b49\uff0c\u6bd4\u8f83\u8457\u540d\u7684\u4ea7\u54c1\u6709Redhat GFS\u3001Sun QFS\u3001Vmware VMFS\u7b49\u3002 \u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf \u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\u5219\u4e0d\u662f\u5757\u7ea7\u522b\u7684\u5171\u4eab\u7684\u5f62\u5f0f\u4e86\uff0c\u6240\u6709\u52a0\u8fdb\u6765\u7684\u5b58\u50a8\uff08\u6587\u4ef6\u7cfb\u7edf\uff09\u90fd\u662f\u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\uff0c\u6240\u6709\u6570\u636e\u7684\u4f20\u8f93\u4e5f\u662f\u4f9d\u9760\u7f51\u7edc\u6765\u7684\u3002 \u5b83\u7684\u8bbe\u8ba1\u6709\u8fd9\u4e48\u51e0\u4e2a\u539f\u5219\uff1a \u8bbf\u95ee\u900f\u660e \u5ba2\u6237\u7aef\u5728\u5176\u4e0a\u7684\u6587\u4ef6\u64cd\u4f5c\u4e0e\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u65e0\u5f02 \u4f4d\u7f6e\u900f\u660e \u5176\u4e0a\u7684\u6587\u4ef6\u4e0d\u4ee3\u8868\u5176\u5b58\u50a8\u4f4d\u7f6e\uff0c\u53ea\u8981\u7ed9\u4e86\u5168\u540d\u5c31\u80fd\u8bbf\u95ee \u5e76\u53d1\u900f\u660e \u6240\u6709\u5ba2\u6237\u7aef\u6301\u6709\u7684\u6587\u4ef6\u7cfb\u7edf\u7684\u72b6\u6001\u5728\u4efb\u4f55\u65f6\u5019\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u4e0d\u4f1a\u51fa\u73b0A\u4fee\u6539\u4e86F\u6587\u4ef6\uff0c\u4f46\u662fB\u6123\u4e86\u534a\u5929\u624d\u53d1\u73b0\u3002 \u5931\u8d25\u900f\u660e \u7406\u89e3\u4e3a\u963b\u585e\u64cd\u4f5c\uff0c\u4e0d\u6210\u529f\u4e0d\u56de\u5934\u3002 \u5f02\u6784\u6027 \u6587\u4ef6\u7cfb\u7edf\u53ef\u4ee5\u5728\u591a\u79cd\u786c\u4ef6\u4ee5\u53ca\u64cd\u4f5c\u7cfb\u7edf\u4e0b\u90e8\u7f72\u4f7f\u7528\u3002 \u6269\u5c55\u6027 \u968f\u65f6\u6dfb\u52a0\u8fdb\u65b0\u7684\u8282\u70b9\uff0c\u65e0\u89c6\u5176\u8d44\u683c\u65b0\u65e7\u3002 \u5197\u4f59\u900f\u660e \u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u4e86\u89e3\u6587\u4ef6\u5b58\u5728\u4e8e\u591a\u4e2a\u8282\u70b9\u4e0a\u8fd9\u4e00\u4e8b\u5b9e\u3002 \u8fc1\u79fb\u900f\u660e \u5ba2\u6237\u7aef\u4e0d\u9700\u8981\u4e86\u89e3\u6587\u4ef6\u6839\u636e\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u8fc1\u79fb\u7684\u72b6\u51b5\u3002 \u5b9e\u73b0\u7684\u65b9\u5f0f\u6709NFS\u3001CIFS\u3001SMB\u3001NCP\u7b49\uff0c\u6bd4\u8f83\u8457\u540d\u7684\u4ea7\u54c1\u6709Google GFS\u3001Hadoop HDFS\u3001GlusterFS\u3001Lustre\u7b49\u3002 1 2 3 4 5 6 7 8 9 .. epigraph:: FUSE\uff0cfilesystem in user space\u3002 FUSE\u5168\u540dFilesystem in Userspace\uff0c\u662f\u5728\u7c7bUNIX\u7cfb\u7edf\u4e0b\u7684\u4e00\u4e2a\u673a\u5236\uff0c\u53ef\u4ee5\u8ba9\u666e\u901a\u7528\u6237\u521b\u5efa\u4fee\u6539\u8bbf\u95ee\u6587\u4ef6\u7cfb\u7edf\u3002\u529f\u80fd\u5c31\u662f\u8fde\u63a5\u5185\u6838\u63a5\u53e3\u4e0e\u7528\u6237\u63a7\u4ef6\u7a0b\u5e8f\u7684\u4e00\u5ea7\u201c\u6865\u201d\uff0c\u76ee\u524d\u666e\u904d\u5b58\u5728\u4e8e\u591a\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u6bd4\u5982Linux\u3001BSD\u3001Solaris\u3001OSX\u3001Android\u7b49\u3002 FUSE\u6765\u6e90\u4e8eAVFS\uff0c\u4e0d\u540c\u4e8e\u4f20\u7edf\u6587\u4ef6\u7cfb\u7edf\u4ece\u78c1\u76d8\u8bfb\u5199\u6570\u636e\uff0cFUSE\u5728\u6587\u4ef6\u7cfb\u7edf\u6216\u78c1\u76d8\u4e2d\u6709\u201c\u8f6c\u6362\u201d\u7684\u89d2\u8272\uff0c\u672c\u8eab\u5e76\u4e0d\u4f1a\u5b58\u50a8\u6570\u636e\u3002 \u5728Linux\u7cfb\u7edf\u4e2d\u7684\u5b9e\u73b0\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u5404\u79cd\u8981\u6302\u8f7dntfs\u6587\u4ef6\u7cfb\u7edf\u4f7f\u7528\u5230\u7684ntfs-3g\uff0c\u4ee5\u53ca\u5373\u5c06\u8981\u7528\u5230\u7684glusterfs-fuse\u3002 ```{image} ../images/02-01.png :align: center 1 2 3 4 5 6 7 8 ## 2.2 Glusterfs\u7b80\u8ff0 \u63a5\u4e0b\u6765\uff0c\u8bf4\u4e00\u4e0b\u6211\u6240\u770b\u5230\u7684glusterfs\u3002 \u9996\u5148\u5b83\u53ef\u4ee5\u57fa\u4e8e\u4ee5\u592a\u7f51\u6216\u8005Infiniband\u6784\u5efa\u5927\u89c4\u6a21\u5206\u5e03\u5f0f\u6587\u4ef6\u7cfb\u7edf\uff0c\u5176\u8bbe\u8ba1\u539f\u5219\u7b26\u5408\u5965\u5361\u59c6\u5243\u5200\u539f\u5219\uff0c\u5373\u201c *\u82e5\u65e0\u5fc5\u8981\uff0c\u52ff\u589e\u5b9e\u4f53* \u201d\uff1b\u5b83\u7684\u6e90\u7801\u90e8\u5206\u9075\u5faaGPLv3\uff0c\u53e6\u4e00\u90e8\u5206\u9075\u5faaGPLv2/LGPLv3\uff1b\u7edf\u4e00\u5bf9\u8c61\u89c6\u56fe\uff0c\u4e0eUNIX\u8bbe\u8ba1\u54f2\u5b66\u7c7b\u4f3c\uff0c\u6240\u6709\u7686\u5bf9\u8c61\uff1b\u8de8\u5e73\u53f0\u517c\u5bb9\u6027\u9ad8\uff0c\u53ef\u4f5c\u4e3ahadoop\u3001openstack\u3001ovirt\u3001Amazon EC\u7684\u540e\u7aef\u3002 ```{image} ../images/02-02.png :align: center :::{note} \u7816\u5757\uff08brick\uff09 \uff1a\u5373\u670d\u52a1\u5668\u8282\u70b9\u4e0a\u5bfc\u51fa\u7684\u4e00\u4e2a\u76ee\u5f55\uff0c\u4f5c\u4e3aglusterfs\u7684\u6700\u57fa\u672c\u5355\u5143\u3002 \u5377\uff08volume\uff09 \uff1a\u7528\u6237\u6700\u7ec8\u4f7f\u7528\u7684\u3001\u7531\u7816\u5757\u7ec4\u6210\u7684\u903b\u8f91\u5377\u3002 GFID \uff1aglusterfs\u4e2d\u7684\u6bcf\u4e00\u4e2a\u6587\u4ef6\u6216\u8005\u76ee\u5f55\u90fd\u6709\u4e00\u4e2a\u72ec\u7acb\u7684128\u4f4dGFID\uff0c\u4e0e\u666e\u901a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684inode\u7c7b\u4f3c\u3002 \u8282\u70b9\uff08peer\uff09 \uff1a\u5373\u96c6\u7fa4\u4e2d\u542b\u6709\u7816\u5757\u5e76\u53c2\u4e0e\u6784\u5efa\u5377\u7684\u8ba1\u7b97\u673a\u3002 :::","title":"2.1 \u8c08\u8c08\u5206\u5e03\u5f0f\u5b58\u50a8"},{"location":"inthecloud/ch02/#_2","text":"\u5177\u4f53\u529f\u80fd\u7279\u6027\u8bf7\u53c2\u8003 Glusterfs features \u3002","title":"\u529f\u80fd\u4ecb\u7ecd"},{"location":"inthecloud/ch02/#_3","text":"gluster\u652f\u6301\u56db\u79cd\u5b58\u50a8\u903b\u8f91\u5377\u7ec4\u5408\uff1a\u666e\u901a\u5206\u5e03\u5f0f\uff08Distributed\uff09\u3001\u6761\u5e26\uff08Striped\uff09\u3001\u5197\u4f59\uff08Replicated\uff09\u3001\u6761\u5e26\u5197\u4f59\uff08Striped-Replicated\uff09 {eval_rst} +-----------+-------------------------------+ |\u666e\u0000\u901a\u0000\u5206\u0000\u5e03\u0000\u5f0f\u0000 |.. image:: ../images/02-04.png | | | :align: center | +-----------+-------------------------------+ |\u6761\u0000\u5e26\u0000 |.. image:: ../images/02-05.png | | | :align: center | +-----------+-------------------------------+ | \u5197\u0000\u4f59\u0000 |.. image:: ../images/02-06.png | | | :align: center | +-----------+-------------------------------+ |\u6761\u0000\u5e26\u0000\u5197\u0000\u4f59\u0000 |.. image:: ../images/02-07.png | | | :align: center | +-----------+-------------------------------+","title":"\u7ec4\u5408\u65b9\u5f0f"},{"location":"inthecloud/ch02/#translator","text":"Translator\u662fglusterfs\u8bbe\u8ba1\u65f6\u7684\u6838\u5fc3\u4e4b\u4e00\uff0c\u5b83\u5177\u6709\u4ee5\u4e0b\u529f\u80fd\uff1a \u5c06\u7528\u6237\u53d1\u6765\u7684\u8bf7\u6c42\u8f6c\u5316\u4e3a\u5bf9\u5b58\u50a8\u7684\u8bf7\u6c42\uff0c\u53ef\u4ee5\u662f\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u6216\u8005\u4e00\u5bf9\u96f6\uff08cache\uff09\u3002 \u53ef\u7528\u4fee\u6539\u8bf7\u6c42\u7c7b\u578b\u3001\u8def\u5f84\u3001\u6807\u5fd7\uff0c\u751a\u81f3\u662f\u6570\u636e\uff08\u52a0\u5bc6\uff09\u3002 \u62e6\u622a\u8bf7\u6c42\uff08\u8bbf\u95ee\u63a7\u5236\uff09\u3002 \u751f\u6210\u65b0\u8bf7\u6c42\uff08\u9884\u53d6\uff09\u3002 \u7c7b\u578b \u6839\u636etranslator\u7684\u7c7b\u578b\uff0c\u53ef\u7528\u5c06\u5176\u5206\u4e3a\u5982\u4e0b\u7c7b\u578b\uff1a Translator \u7c7b\u578b \u529f\u80fd Storage \u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u3002 Debug \u63d0\u4f9b\u8c03\u8bd5\u4fe1\u606f\u3002 Cluster \u5904\u7406\u96c6\u7fa4\u73af\u5883\u4e0b\u8bfb\u5199\u8bf7\u6c42\u3002 Encryption \u52a0\u5bc6/\u89e3\u5bc6\u4f20\u9001\u4e2d\u7684\u6570\u636e\u3002 Protocol \u52a0\u5bc6/\u89e3\u5bc6\u4f20\u9001\u4e2d\u7684\u6570\u636e\u3002 Performance IO\u53c2\u6570\u8c03\u8282\u3002 Bindings \u589e\u52a0\u53ef\u6269\u5c55\u6027\uff0c\u6bd4\u5982python\u63a5\u53e3\u3002 System \u8d1f\u8d23\u7cfb\u7edf\u8bbf\u95ee\uff0c\u6bd4\u5982\u6587\u4ef6\u7cfb\u7edf\u63a7\u5236\u63a5\u53e3\u8bbf\u95ee\u3002 Scheduler \u8c03\u5ea6\u96c6\u7fa4\u73af\u5883\u4e0b\u6587\u4ef6\u8bbf\u95ee\u8bf7\u6c42\u3002 Features \u63d0\u4f9b\u989d\u5916\u6587\u4ef6\u7279\u6027\uff0c\u6bd4\u5982quota\uff0c\u9501\u673a\u5236\u7b49\u3002","title":"Translator"},{"location":"inthecloud/ch02/#afr","text":"AFR\uff08Automatic File Replication\uff09\u662ftranslator\u7684\u4e00\u79cd\uff0c\u5b83\u4f7f\u7528\u989d\u5916\u673a\u5236\u53bb\u63a7\u5236\u8ddf\u8e2a\u6587\u4ef6\u64cd\u4f5c\uff0c\u7528\u4e8e\u8de8\u7816\u5757\u590d\u5236\u6570\u636e\u3002 \u652f\u6301\u8de8\u7f51\u5907\u4efd {eval_rst} +-----------+-------------------------------+ |\u5c40\u0000\u57df\u0000\u7f51\u0000\u5907\u0000\u4efd\u0000 |.. image:: ../images/02-08.png | | | :align: center | +-----------+-------------------------------+ |\u5185\u0000\u7f51\u0000\u5907\u0000\u4efd\u0000 |.. image:: ../images/02-09.png | | | :align: center | +-----------+-------------------------------+ |\u5e7f\u0000\u57df\u0000\u7f51\u0000\u5907\u0000\u4efd\u0000 |.. image:: ../images/02-10.png | | | :align: center | +-----------+-------------------------------+ \u5176\u4e2d\uff0c\u5b83\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a \u4fdd\u6301\u6570\u636e\u4e00\u81f4\u6027 \u53d1\u751f\u8111\u88c2\u65f6\u81ea\u52a8\u6062\u590d\uff0c\u5e94\u4fdd\u8bc1\u81f3\u5c11\u4e00\u4e2a\u8282\u70b9\u6709\u6b63\u786e\u6570\u636e \u4e3a\u8bfb\u7cfb\u5217\u64cd\u4f5c\u63d0\u4f9b\u6700\u65b0\u6570\u636e\u7ed3\u6784","title":"AFR"},{"location":"inthecloud/ch02/#dht","text":"DHT\uff08Distributed Hash Table\uff09\u662fglusterfs\u7684\u771f\u6b63\u6838\u5fc3\u3002\u5b83\u51b3\u5b9a\u5c06\u6bcf\u4e2a\u6587\u4ef6\u653e\u7f6e\u81f3\u7816\u5757\u7684\u4f4d\u7f6e\u3002\u4e0d\u540c\u4e8e\u591a\u526f\u672c\u6216\u8005\u6761\u5e26\u6a21\u5f0f\uff0c\u5b83\u7684\u529f\u80fd\u662f\u8def\u7531\uff0c\u800c\u4e0d\u662f\u5206\u5272\u6216\u8005\u62f7\u8d1d\u3002 \u5de5\u4f5c\u65b9\u5f0f \u5206\u5e03\u5f0f\u54c8\u5e0c\u8868\u7684\u6838\u5fc3\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\uff0c\u53c8\u540d\u73af\u5f62\u54c8\u5e0c\u3002\u5b83\u5177\u6709\u7684\u4e00\u4e2a\u6027\u8d28\u662f\u5f53\u4e00\u4e2a\u5b58\u50a8\u7a7a\u95f4\u88ab\u52a0\u5165\u6216\u8005\u5220\u9664\u65f6\uff0c\u73b0\u6709\u5f97\u6620\u5c04\u5173\u7cfb\u7684\u6539\u53d8\u5c3d\u53ef\u80fd\u5c0f\u3002 \u5047\u8bbe\u6211\u4eec\u7684\u54c8\u5e0c\u7b97\u51fa\u4e00\u4e2a32\u4f4d\u7684\u54c8\u5e0c\u503c\uff0c\u5373\u4e00\u4e2a[0,2^32-1]\u7684\u7a7a\u95f4\uff0c\u73b0\u5c06\u5b83\u9996\u5c3e\u76f8\u63a5\uff0c\u5373\u6784\u6210\u4e00\u4e2a\u73af\u5f62\u3002 \u5047\u5982\u6211\u4eec\u6709\u56db\u4e2a\u5b58\u50a8\u7816\u5757\uff0c\u6bcf\u4e00\u4e2a\u7816\u5757B\u90fd\u6709\u4e00\u4e2a\u54c8\u5e0c\u503cH\uff0c\u5047\u8bbe\u56db\u4e2a\u6587\u4ef6\u53ca\u5176\u54c8\u5e0c\u503c\u8868\u793a\u4e3a(k,v)\uff0c\u90a3\u4e48\u4ed6\u4eec\u5728\u54c8\u5e0c\u73af\u4e0a\u5373\u5982\u6b64\u8868\u793a\uff1a ```{image} ../images/02-14.png :align: center 1 2 3 4 \u6bcf\u4e00\u4e2a\u6587\u4ef6\u54c8\u5e0ck\u987a\u65f6\u9488\u79fb\u52a8\u9047\u5230\u4e00\u4e2aH\u540e\uff0c\u5c31\u5c06\u6587\u4ef6k\u4fdd\u5b58\u81f3B\u3002 ```{image} ../images/02-15.png :align: center \u4e0a\u56fe\u8868\u793a\u7684\u662f\u7406\u60f3\u73af\u5883\u4e0b\u6587\u4ef6\u4e0e\u7816\u5757\u7684\u5b58\u50a8\u6620\u5c04\uff0c\u5f53\u6709\u7816\u5757\u5931\u6548\u65f6\uff0c\u5b58\u50a8\u4f4d\u7f6e\u7684\u6620\u5c04\u4e5f\u5c31\u53d1\u751f\u4e86\u6539\u53d8\u3002\u6bd4\u5982\u7816\u5757B3\u5931\u6548\uff0c\u90a3\u4e48\u6587\u4ef6v3\u4f1a\u88ab\u7ee7\u7eed\u987a\u65f6\u9488\u6539\u53d8\u81f3B4\u4e0a\u3002 ```{image} ../images/02-16.png :align: center 1 2 3 4 \u5f53\u7816\u5757\u6570\u76ee\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u4e3a\u4e86\u670d\u52a1\u5668\u80fd\u5e73\u644a\u8d1f\u8f7d\uff0c\u6211\u4eec\u9700\u8981\u4e00\u6b21rebalance\u6765\u7a0d\u8bb8\u6539\u53d8\u6620\u5c04\u5173\u7cfb\u3002rebalance\u7684\u6280\u5de7\u5373\u662f\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7684\u5b58\u50a8\u4f4d\u7f6eB'\uff0c\u4f7f\u6240\u6709\u7816\u5757\u53ca\u5176\u865a\u62df\u7816\u5757\u5c3d\u91cf\u90fd\u5b58\u50a8\u6709\u6587\u4ef6\u3002 ```{image} ../images/02-17.png :align: center ```{image} ../images/02-18.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ## 2.3 \u642d\u5efaGlusterfs\u4f5c\u4e3a\u57fa\u7840\u5b58\u50a8 \u65e2\u7136\u8981\u642d\u5efa\u4e00\u4e2a\u7a33\u5065\u7684\u57fa\u7840\u5b58\u50a8\uff0c\u90a3\u4e48glusterfs\u63a8\u8350\u4f7f\u7528distributed striped replicated\u65b9\u5f0f\uff0c\u8fd9\u91cc\u4f7f\u75284\u53f0\u9884\u88c5CentOS 6(SELINUX\u8bbe\u7f6e\u4e3apermissive)\u7684\u673a\u5668\u8fdb\u884c\u6f14\u793a\u3002 ### \u6dfb\u52a0DNS\u6216\u8005\u4fee\u6539hosts\u6587\u4ef6 \u9274\u4e8e\u7b14\u8005\u6240\u5728\u73af\u5883\u4e2d\u6682\u65f6\u6ca1\u6709\u914d\u7f6e\u72ec\u7acb\u7684DNS\uff0c\u6b64\u5904\u5148\u4fee\u6539hosts\u6587\u4ef6\u4ee5\u5b8c\u6210\u914d\u7f6e\uff0c\u6ce8\u610f\u6bcf\u53f0\u673a\u5668\u90fd\u8981\u6dfb\u52a0\uff1a > */etc/hosts* > ```{code} 127.0.0.1 localhost.localdomain localhost ::1 localhost6.localdomain6 localhost6 192.168.10.101 gs1.example.com 192.168.10.102 tgs2.example.com 192.168.10.103 tgs3.example.com 192.168.10.104 gs4.example.com \u540c\u6837\u5730\u5728\u6240\u6709\u673a\u5668\u4e0a\u6dfb\u52a0repo\uff1a /etc/yum.repos.d/gluster_epel.repo 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 [epel] name=Extra Packages for Enterprise Linux 6 - $basearch #baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&amp;arch=$basearch failovermethod=priority enabled=1 gpgcheck=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6 [glusterfs-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/$basearch/ enabled=1 skip_if_unavailable=1 gpgcheck=0 gpgkey=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/pub.key [glusterfs-noarch-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/noarch enabled=1 skip_if_unavailable=1 gpgcheck=0 gpgkey=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/pub.key [glusterfs-source-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. - Source baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/SRPMS enabled=0 skip_if_unavailable=1 gpgcheck=1 gpgkey=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/pub.key","title":"DHT"},{"location":"inthecloud/ch02/#_4","text":"\u5728\u6240\u6709\u8282\u70b9\u4e0a\u5b89\u88c5xfs\u7528\u6237\u7a7a\u95f4\u5de5\u5177\uff1a 1 2 3 4 5 # yum install -y glusterfs glusterfs-fuse glusterfs-server xfsprogs # /etc/init.d/glusterd start # /etc/init.d/glusterfsd start # chkconfig glusterfsd on # chkconfig glusterd on \u5047\u8bbe\u6bcf\u53f0\u673a\u5668\u9664\u7cfb\u7edf\u76d8\u4e4b\u5916\u90fd\u67092\u57571T SATA\u786c\u76d8\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5176\u8fdb\u884c\u5206\u533a\uff0c\u521b\u5efa\u903b\u8f91\u5377\uff0c\u683c\u5f0f\u5316\u5e76\u6302\u8f7d\uff1a 1 2 3 4 5 6 7 # fdisk /dev/sdX << EOF n p 1 w EOF \u683c\u5f0f\u5316\u5e76\u6302\u8f7d\uff1a 1 2 3 4 5 6 7 8 # mkfs.xfs -i size 512 /dev/sdb1 # mkfs.xfs -i size 512 /dev/sdc1 # mkdir /gluster_brick_root1 # mkdir /gluster_brick_root2 # echo -e \"/dev/sdb1\\t/gluster_brick_root1\\txfs\\tdefaults\\t0 0\\n/dev/sdc1\\t/gluster_brick_root2\\txfs\\tdefaults\\t0 0\" >> /etc/fstab # mount -a # mkdir /gluster_brick_root1/data # mkdir /gluster_brick_root2/data :::{note} \u4e3a\u4ec0\u4e48\u8981\u7528XFS\uff1f XFS\u5177\u6709\u5143\u6570\u636e\u65e5\u5fd7\u529f\u80fd\uff0c\u53ef\u4ee5\u5feb\u901f\u6062\u590d\u6570\u636e\uff1b\u540c\u65f6\uff0c\u53ef\u4ee5\u5728\u7ebf\u6269\u5bb9\u53ca\u788e\u7247\u6574\u7406\u3002\u5176\u4ed6\u6587\u4ef6\u7cfb\u7edf\u6bd4\u5982EXT3\uff0cEXT4\u672a\u505a\u5145\u5206\u6d4b\u8bd5\u3002 :::","title":"\u51c6\u5907\u78c1\u76d8\u4f5c\u4e3a\u7816\u5757"},{"location":"inthecloud/ch02/#_5","text":"\u5728\u5176\u4e2d\u4efb\u610f\u53f0\u673a\u5668\u4e0a\uff0c\u6bd4\u5982gs2.example.com\uff0c\u6267\u884c 1 2 3 # gluster peer probe gs1.example.com # gluster peer probe gs3.example.com # gluster peer probe gs4.example.com \u4f7f\u7528\u7816\u5757\u8fdb\u884c\u5377\u7684\u6784\u5efa\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 # gluster > volume create gluster-vol1 stripe 2 replica 2 \\ gs1.example.com:/gluster_brick_root1/data gs2.example.com:/gluster_brick_root1/data \\ gs1.example.com:/gluster_brick_root2/data gs2.example.com:/gluster_brick_root2/data \\ gs3.example.com:/gluster_brick_root1/data gs4.example.com:/gluster_brick_root1/data \\ gs3.example.com:/gluster_brick_root2/data gs4.example.com:/gluster_brick_root2/data force > volume start gluster-vol1 # \u542f\u52a8\u5377 > volume status gluster-vol1 # \u67e5\u770b\u5377\u72b6\u6001 Status of volume: gluster-vol1 Gluster process Port Online Pid ------------------------------------------------------------------------------ Brick gs1.example.com:/gluster_brick_root1/data 49152 Y 1984 Brick gs2.example.com:/gluster_brick_root1/data 49152 Y 1972 Brick gs1.example.com:/gluster_brick_root2/data 49153 Y 1995 Brick gs2.example.com:/gluster_brick_root2/data 49153 Y 1983 Brick gs3.example.com:/gluster_brick_root1/data 49152 Y 1961 Brick gs4.example.com:/gluster_brick_root1/data 49152 Y 1975 Brick gs3.example.com:/gluster_brick_root2/data 49153 Y 1972 Brick gs4.example.com:/gluster_brick_root2/data 49153 Y 1986 NFS Server on localhost 2049 Y 1999 Self-heal Daemon on localhost N/A Y 2006 NFS Server on gs2.example.com 2049 Y 2007 Self-heal Daemon on gs2.example.com N/A Y 2014 NFS Server on gs2.example.com 2049 Y 1995 Self-heal Daemon on gs2.example.com N/A Y 2002 NFS Server on gs3.example.com 2049 Y 1986 Self-heal Daemon on gs3.example.com N/A Y 1993 Task Status of Volume gluster-vol1 ------------------------------------------------------------------------------ There are no active volume tasks > volume info all \u67e5\u770b\u6240\u6709\u5377\u4fe1\u606f gluster volume info all Volume Name: gluster-vol1 Type: Distributed-Striped-Replicate Volume ID: bc8e102c-2b35-4748-ab71-7cf96ce083f3 Status: Started Number of Bricks: 2 x 2 x 2 = 8 Transport-type: tcp Bricks: Brick1: gs1.example.com:/gluster_brick_root1/data Brick2: gs2.example.com:/gluster_brick_root1/data Brick3: gs1.example.com:/gluster_brick_root2/data Brick4: gs2.example.com:/gluster_brick_root2/data Brick5: gs3.example.com:/gluster_brick_root1/data Brick6: gs4.example.com:/gluster_brick_root1/data Brick7: gs3.example.com:/gluster_brick_root2/data Brick8: gs4.example.com:/gluster_brick_root2/data","title":"\u6dfb\u52a0\u5377"},{"location":"inthecloud/ch02/#_6","text":"\u5f53\u4ee5glusterfs\u6302\u8f7d\u65f6\uff0c\u5ba2\u6237\u7aef\u7684hosts\u6587\u4ef6\u91cc\u9700\u8981\u6709\u7684\u4efb\u4e00\u8282\u70b9\u505a\u89e3\u6790\uff1a \u6302\u8f7dglusterfs\u7684\u5ba2\u6237\u7aef/etc/hosts 1 2 3 4 127.0.0.1 localhost.localdomain localhost ::1 localhost6.localdomain6 localhost6 192.168.1.81 gs1.example.com \u5b89\u88c5gluster-fuse\uff0c\u5c06gluster\u5377\u4f5c\u4e3aglusterfs\u6302\u8f7d\uff0c\u5e76\u5199\u51651M\u6587\u4ef6\u67e5\u770b\u5176\u5728\u5404\u7816\u5757\u5206\u914d\uff1a 1 2 3 4 5 # yum install glusterfs glusterfs-fuse # mount.glusterfs 192.168.1.81:/gluster-vol1 /mnt # cd /mnt # dd if=/dev/zero of=a.img bs=1k count=1k # cp a.img b.img; cp a.img c.img; cp a.img d.img \u5728\u56db\u53f0\u670d\u52a1\u7aef\u5206\u522b\u67e5\u770b\uff1a 1 2 3 4 5 6 7 8 9 [root@gs1 ~]# ls -lh /gluster_brick_root* /gluster_brick_root1/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 a.img -rw-r--r--. 2 root root 512K Apr 22 17:13 d.img /gluster_brick_root2/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 a.img -rw-r--r--. 2 root root 512K Apr 22 17:13 d.img 1 2 3 4 5 6 7 8 9 [root@gs2 ~]# ls -lh /gluster_brick_root* /gluster_brick_root1/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 a.img -rw-r--r--. 2 root root 512K Apr 22 17:13 d.img /gluster_brick_root2/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 a.img -rw-r--r--. 2 root root 512K Apr 22 17:13 d.img 1 2 3 4 5 6 7 8 9 [root@gs3 ~]# ls -lh /gluster_brick_root* /gluster_brick_root1/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 b.img -rw-r--r--. 2 root root 512K Apr 22 17:13 c.img /gluster_brick_root2/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 b.img -rw-r--r--. 2 root root 512K Apr 22 17:13 c.img 1 2 3 4 5 6 7 8 9 [root@gs4 ~]# ls -lh /gluster_brick_root* /gluster_brick_root1/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 b.img -rw-r--r--. 2 root root 512K Apr 22 17:13 c.img /gluster_brick_root2/data/: total 1.0M -rw-r--r--. 2 root root 512K Apr 22 17:13 b.img -rw-r--r--. 2 root root 512K Apr 22 17:13 c.img \u81f3\u6b64\uff0c\u6240\u6709\u914d\u7f6e\u7ed3\u675f\u3002","title":"\u6302\u8f7d\u5377"},{"location":"inthecloud/ch02/#24-glusterfs","text":"","title":"2.4 Glusterfs\u5e94\u7528\u793a\u4f8b\u53ca\u6280\u5de7"},{"location":"inthecloud/ch02/#_7","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | Option | Description | Default Value | Available Options | +======================================+===============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+============================+=====================================================================================+ | auth.allow | IP addresses of the clients which should be allowed to access the volume. | * (allow all) | Valid IP address which includes wild card patterns including *, such as 192.168.1.* | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | auth.reject | IP addresses of the clients which should be denied to access the volume. | NONE (reject none) | Valid IP address which includes wild card patterns including *, such as 192.168.2.* | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | client.grace-timeout | Specifies the duration for the lock state to be maintained on the client after a network disconnection. | 10 | 10 - 1800 secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.self-heal-window-size | Specifies the maximum number of blocks per file on which self-heal would happen simultaneously. | 16 | 0 - 1025 blocks | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.data-self-heal-algorithm | Specifies the type of self-heal. If you set the option as \"full\", the entire file is copied from source to destinations. If the option is set to \"diff\" the file blocks that are not in sync are copied to destinations. Reset uses a heuristic model. If the file does not exist on one of the subvolumes, or a zero-byte file exists (created by entry self-heal) the entire content has to be copied anyway, so there is no benefit from using the \"diff\" algorithm. If the file size is about the same as page size, the entire file can be read and written with a few operations, which will be faster than \"diff\" which has to read checksums and then read and write. | reset | full/diff/reset | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.min-free-disk | Specifies the percentage of disk space that must be kept free. Might be useful for non-uniform bricks | 10% | Percentage of required minimum free disk space | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.stripe-block-size | Specifies the size of the stripe unit that will be read from or written to. | 128 KB (for all files) | size in bytes | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.self-heal-daemon | Allows you to turn-off proactive self-heal on replicated | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | cluster.ensure-durability | This option makes sure the data/metadata is durable across abrupt shutdown of the brick. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | diagnostics.brick-log-level | Changes the log-level of the bricks. | INFO | DEBUG/WARNING/ERROR/CRITICAL/NONE/TRACE | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | diagnostics.client-log-level | Changes the log-level of the clients. | INFO | DEBUG/WARNING/ERROR/CRITICAL/NONE/TRACE | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | diagnostics.latency-measurement | Statistics related to the latency of each operation would be tracked. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | diagnostics.dump-fd-stats | Statistics related to file-operations would be tracked. | Off | On | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | features.read-only | Enables you to mount the entire volume as read-only for all the clients (including NFS clients) accessing it. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | features.lock-heal | Enables self-healing of locks when the network disconnects. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | features.quota-timeout | For performance reasons, quota caches the directory sizes on client. You can set timeout indicating the maximum duration of directory sizes in cache, from the time they are populated, during which they are considered valid | 0 | 0 - 3600 secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | geo-replication.indexing | Use this option to automatically sync the changes in the filesystem from Master to Slave. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | network.frame-timeout | The time frame after which the operation has to be declared as dead, if the server does not respond for a particular operation. | 1800 (30 mins) | 1800 secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | network.ping-timeout | The time duration for which the client waits to check if the server is responsive. When a ping timeout happens, there is a network disconnect between the client and server. All resources held by server on behalf of the client get cleaned up. When a reconnection happens, all resources will need to be re-acquired before the client can resume its operations on the server. Additionally, the locks will be acquired and the lock tables updated. This reconnect is a very expensive operation and should be avoided. | 42 Secs | 42 Secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.enable-ino32 | For 32-bit nfs clients or applications that do not support 64-bit inode numbers or large files, use this option from the CLI to make Gluster NFS return 32-bit inode numbers instead of 64-bit inode numbers. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.volume-access | Set the access type for the specified sub-volume. | read-write | read-write/read-only | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.trusted-write | If there is an UNSTABLE write from the client, STABLE flag will be returned to force the client to not send a COMMIT request. In some environments, combined with a replicated GlusterFS setup, this option can improve write performance. This flag allows users to trust Gluster replication logic to sync data to the disks and recover when required. COMMIT requests if received will be handled in a default manner by fsyncing. STABLE writes are still handled in a sync manner. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.trusted-sync | All writes and COMMIT requests are treated as async. This implies that no write requests are guaranteed to be on server disks when the write reply is received at the NFS client. Trusted sync includes trusted-write behavior. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.export-dir | This option can be used to export specified comma separated subdirectories in the volume. The path must be an absolute path. Along with path allowed list of IPs/hostname can be associated with each subdirectory. If provided connection will allowed only from these IPs. Format: <dir>[(hostspec[hostspec...])][,...]. Where hostspec can be an IP address, hostname or an IP range in CIDR notation. Note: Care must be taken while configuring this option as invalid entries and/or unreachable DNS servers can introduce unwanted delay in all the mount calls. | No sub directory exported. | Absolute path with allowed list of IP/hostname | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.export-volumes | Enable/Disable exporting entire volumes, instead if used in conjunction with nfs3.export-dir, can allow setting up only subdirectories as exports. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.rpc-auth-unix | Enable/Disable the AUTH_UNIX authentication type. This option is enabled by default for better interoperability. However, you can disable it if required. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.rpc-auth-null | Enable/Disable the AUTH_NULL authentication type. It is not recommended to change the default value for this option. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.rpc-auth-allow<IP- Addresses> | Allow a comma separated list of addresses and/or hostnames to connect to the server. By default, all clients are disallowed. This allows you to define a general rule for all exported volumes. | Reject All | IP address or Host name | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.rpc-auth-reject<IP- Addresses> | Reject a comma separated list of addresses and/or hostnames from connecting to the server. By default, all connections are disallowed. This allows you to define a general rule for all exported volumes. | Reject All | IP address or Host name | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.ports-insecure | Allow client connections from unprivileged ports. By default only privileged ports are allowed. This is a global setting in case insecure ports are to be enabled for all exports using a single option. | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.addr-namelookup | Turn-off name lookup for incoming client connections using this option. In some setups, the name server can take too long to reply to DNS queries resulting in timeouts of mount requests. Use this option to turn off name lookups during address authentication. Note, turning this off will prevent you from using hostnames in rpc-auth.addr.* filters. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.register-with-portmap | For systems that need to run multiple NFS servers, you need to prevent more than one from registering with portmap service. Use this option to turn off portmap registration for Gluster NFS. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.port <PORT- NUMBER> | Use this option on systems that need Gluster NFS to be associated with a non-default port number. | NA | 38465- 38467 | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | nfs.disable | Turn-off volume being exported by NFS | Off | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.write-behind-window-size | Size of the per-file write-behind buffer. | 1MB | Write-behind cache size | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.io-thread-count | The number of threads in IO threads translator. | 16 | 0-65 | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.flush-behind | If this option is set ON, instructs write-behind translator to perform flush in background, by returning success (or any errors, if any of previous writes were failed) to application even before flush is sent to backend filesystem. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.cache-max-file-size | Sets the maximum file size cached by the io-cache translator. Can use the normal size descriptors of KB, MB, GB,TB or PB (for example, 6GB). Maximum size uint64. | 2 ^ 64 -1 bytes | size in bytes | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.cache-min-file-size | Sets the minimum file size cached by the io-cache translator. Values same as \"max\" above | 0B | size in bytes | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.cache-refresh-timeout | The cached data for a file will be retained till 'cache-refresh-timeout' seconds, after which data re-validation is performed. | 1s | 0-61 | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | performance.cache-size | Size of the read cache. | 32 MB | size in bytes | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | server.allow-insecure | Allow client connections from unprivileged ports. By default only privileged ports are allowed. This is a global setting in case insecure ports are to be enabled for all exports using a single option. | On | On/Off | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | server.grace-timeout | Specifies the duration for the lock state to be maintained on the server after a network disconnection. | 10 | 10 - 1800 secs | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | server.statedump-path | Location of the state dump file. | tmp directory of the brick | New directory path | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ | storage.health-check-interval | Number of seconds between health-checks done on the filesystem that is used for the brick(s). Defaults to 30 seconds, set to 0 to disable. | tmp directory of the brick | New directory path | +--------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------+-------------------------------------------------------------------------------------+ \u5177\u4f53\u53c2\u6570\u53c2\u8003 gluster_doc \u3002","title":"\u53c2\u6570\u8c03\u6574"},{"location":"inthecloud/ch02/#_8","text":"glusterfs\u5728\u521b\u5efa\u5377\u65f6\u4f1a\u66f4\u6539\u7816\u5757\u6240\u6709\u8005\u4e3aroot.root\uff0c\u5bf9\u4e8e\u67d0\u4e9b\u5e94\u7528\u8bf7\u6ce8\u610f\u66f4\u6539\u7816\u5757\u76ee\u5f55\u6240\u6709\u8005\uff08\u6bd4\u5982\u5728/etc/rc.local\u4e2d\u6dfb\u52a0chown\uff0c\u4e0d\u8981\u66f4\u6539\u7816\u5757\u4e0b\u9690\u85cf\u76ee\u5f55.glusterfs\uff09\u3002","title":"\u6587\u4ef6\u6743\u9650"},{"location":"inthecloud/ch02/#_9","text":"\u7f51\u4e0a\u73b0\u6709\u7684\u90e8\u5206\u6587\u6863\u4e2d\u6240\u8ff0\u7684\u7816\u5757\u5212\u5206\u65b9\u5f0f\uff0c\u662f\u5c06\u6574\u4e2a\u78c1\u76d8\u5212\u5206\u4e3a\u7816\u5757\uff0c\u6b64\u79cd\u5212\u5206\u65b9\u5f0f\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u4e0d\u662f\u5f88\u597d\uff08\u6bd4\u5982\u5b58\u50a8\u590d\u7528\uff09\uff0c\u53ef\u4ee5\u5728/brickX\u4e0b\u521b\u5efa\u76ee\u5f55\uff0c\u6bd4\u5982data1\uff0c\u540c\u65f6\u5728\u521b\u5efaglusterfs\u5377\u7684\u65f6\u5019\u4f7f\u7528HOST:/brickX/data1\u4f5c\u4e3a\u7816\u5757\uff0c\u4ee5\u5408\u7406\u5229\u7528\u5b58\u50a8\u7a7a\u95f4\u3002","title":"\u7816\u5757\u7ec4\u5408"},{"location":"inthecloud/ch02/#normalreplicastriped","text":"\u7816\u5757\u7684\u5212\u5206\u6392\u5e8f\uff1astriped\uff08normal\uff09\u4f18\u5148\uff0creplica\u5728striped\uff08normal\uff09\u57fa\u7840\u4e0a\u505a\u5197\u4f59\uff1b\u8ba1\u7b97\u5927\u5c0f\u65f6\uff0c\u540c\u4e00replica\u7ec4\u4e2d\u7684brick\u5408\u5e76\u4e3a\u4e00\u4e2a\u7816\u5757\uff0c\u4e00\u4e2astriped\u7ec4\u53ef\u770b\u505a\u4e00\u4e2a\u6709\u6548\u5757\u3002 \u5047\u8bbe\u6211\u4eec\u67094\u4e2a\u4e3b\u673a\uff0c8\u4e2a\u7816\u5757\uff0c\u6bcf\u4e2a\u7816\u5757\u90fd\u662f5GB\uff0c\u5982\u4e0b\u56fe\uff1a ```{image} ../images/02-11.png :align: center ``` \u521b\u5efa\u5377\u65f6\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a 1 2 3 # gluster volume create gluster-vol1 stripe 2 replica 2 \\ host1:/brick1 host1:/brick2 host2:/brick1 host2:/brick2 \\ host3:/brick1 host3:/brick2 host4:/brick1 host4:/brick2 force \u7816\u5757\u5c06\u4f1a\u6309\u7167\u5982\u4e0b\u8fdb\u884c\u7ec4\u5408\uff1a ```{image} ../images/02-12.png :align: center ``` \u7136\u800c\uff0c\u521b\u5efa\u5377\u65f6\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a 1 2 3 # gluster volume create gluster-vol1 stripe 2 replica 2 \\ host1:/brick1 host2:/brick1 host3:/brick1 host4:/brick1 \\ host1:/brick2 host2:/brick2 host3:/brick2 host4:/brick2 force \u7816\u5757\u5c06\u4f1a\u6309\u7167\u5982\u4e0b\u8fdb\u884c\u7ec4\u5408\uff1a ```{image} ../images/02-13.png :align: center ```","title":"normal\u3001replica\u3001striped\u5377\u7ec4\u5408"},{"location":"inthecloud/ch02/#nfs","text":"\u7531\u4e8eglusterfs\u5360\u7528\u4e862049\u7aef\u53e3\uff0c\u6240\u4ee5\u5176\u4e0enfs server\u4e00\u822c\u4e0d\u80fd\u5171\u5b58\u4e8e\u540c\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u9664\u975e\u66f4\u6539nfs\u670d\u52a1\u7aef\u53e3\u3002 1 # mount -t nfs -o vers=3 server1:/volume1 /mnt","title":"\u4f5c\u4e3anfs\u6302\u8f7d"},{"location":"inthecloud/ch02/#cifs","text":"\u5148\u5728\u67d0\u4e00\u670d\u52a1\u5668\u6216\u8005\u5ba2\u6237\u7aef\u5c06\u8d77\u6302\u8f7d\uff0c\u518d\u4ee5cifs\u65b9\u5f0f\u5bfc\u51fa\uff1a /etc/smb.conf 1 2 3 4 5 [glustertest] comment = For testing a Gluster volume exported through CIFS path = /mnt/glusterfs read only = no guest ok = yes","title":"\u4f5c\u4e3acifs\u6302\u8f7d"},{"location":"inthecloud/ch02/#split-brain","text":"\u88c2\u8111\u53d1\u751f\u4ee5\u540e\uff0c\u5404\u8282\u70b9\u4fe1\u606f\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\u3002\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u67e5\u770b\u5e76\u4fee\u590d\u3002 \u5b9a\u4f4d\u88c2\u8111\u6587\u4ef6 \u901a\u8fc7\u547d\u4ee4 1 # gluster volume heal info split-brain \u6216\u8005\u67e5\u770b\u5728\u5ba2\u6237\u7aef\u4ecd\u7136\u662fInput/Output\u9519\u8bef\u7684\u6587\u4ef6\u3002 \u5173\u95ed\u5df2\u7ecf\u6253\u5f00\u7684\u6587\u4ef6\u6216\u8005\u865a\u673a \u786e\u5b9a\u6b63\u786e\u526f\u672c \u6062\u590d\u6269\u5c55\u5c5e\u6027 \u767b\u5f55\u5230\u540e\u53f0\uff0c\u67e5\u770b\u8111\u88c2\u6587\u4ef6\u7684MD5sum\u548c\u65f6\u95f4\uff0c\u5224\u65ad\u54ea\u4e2a\u526f\u672c\u662f\u9700\u8981\u4fdd\u7559\u7684\u3002 \u7136\u540e\u5220\u9664\u4e0d\u518d\u9700\u8981\u7684\u526f\u672c\u5373\u53ef\u3002\uff08glusterfs\u91c7\u7528\u786c\u94fe\u63a5\u65b9\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u540c\u65f6\u5220\u9664.gluster\u4e0b\u9762\u7684\u786c\u8fde\u63a5\u6587\u4ef6\uff09 \u9996\u5148\u68c0\u67e5\u6587\u4ef6\u7684md5\u503c\uff0c\u5e76\u4e14\u548c\u5176\u4ed6\u7684\u8282\u70b9\u6bd4\u8f83\uff0c\u786e\u8ba4\u662f\u5426\u9700\u8981\u5220\u9664\u6b64\u526f\u672c\u3002 1 2 [root@hostd data0]# md5sum 1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c 6c6b704ce1c0f6d22204449c085882e2 1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c \u901a\u8fc7ls -i \u548cfind -inum \u627e\u5230\u6b64\u6587\u4ef6\u53ca\u5176\u786c\u8fde\u63a5\u6587\u4ef6\u3002 1 2 3 4 5 [root@hostd data0]# ls -i 1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c 12976365 1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c [root@hostd data0]# find -inum 12976365 ./1443f429-7076-4792-9cb7-06b1ee38d828/images/5c881816-6cdc-4d8a-a8c8-4b068a917c2f/80f33212-7adb-4e24-9f01-336898ae1a2c ./.glusterfs/01/8d/018db725-c8b8-47ed-a6bb-f6ad4195134f \u5220\u9664\u4e24\u4e2a\u6587\u4ef6 1 [root@hostd data0]# find -inum 12976365 |xargs rm -rf \u6216\u8005 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 -bash-4.1# getfattr -d -e hex -m . ids # file: ids trusted.afr.data_double10t-client-0=0x000000010000000000000000 trusted.afr.data_double10t-client-1=0x000000000000000000000000 trusted.afr.dirty=0x000000010000000000000000 trusted.bit-rot.version=0x040000000000000056e52946000deaaa trusted.gfid=0x112060ecdd5c42f9baa3dd2d67fcf729 -bash-4.1# setfattr -x trusted.afr.data_double10t-client-0 ids -bash-4.1# setfattr -x trusted.afr.data_double10t-client-1 ids -bash-4.1# setfattr -x trusted.afr.dirty ids -bash-4.1# getfattr -d -e hex -m . ids # file: ids trusted.bit-rot.version=0x040000000000000056e52946000deaaa trusted.gfid=0x112060ecdd5c42f9baa3dd2d67fcf729 \u8111\u88c2\u6587\u4ef6\u6062\u590d\u5b8c\u6210\uff0c\u6b64\u6587\u4ef6\u53ef\u4ee5\u5728\u6302\u8f7d\u70b9\u4e0a\u8bfb\u5199\u3002","title":"\u4fee\u590d\u88c2\u8111\uff08split-brain\uff09"},{"location":"inthecloud/ch02/#_10","text":"\u5f53\u5377\u6b63\u5728\u88ab\u4f7f\u7528\uff0c\u5176\u4e2d\u4e00\u4e2a\u7816\u5757\u88ab\u5220\u9664\uff0c\u800c\u7528\u6237\u8bd5\u56fe\u518d\u6b21\u5c06\u5176\u7528\u4e8e\u5377\u65f6\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u201c/bricks/app or a prefix of it is already part of a volume\u201d\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a 1 2 3 # setfattr -x trusted.glusterfs.volume-id $brick_path # setfattr -x trusted.gfid $brick_path # rm -rf $brick_path/.glusterfs","title":"\u7816\u5757\u590d\u7528"},{"location":"inthecloud/ch02/#ip","text":"\u7531\u4e8e\u6302\u8f7d\u5b58\u50a8\u65f6\u9700\u8981\u6307\u5b9a\u96c6\u7fa4\u4e2d\u7684\u4efb\u610fIP\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528Heartbeat/CTDB/Pacemaker\u7b49\u96c6\u7fa4\u8f6f\u4ef6\u6765\u4fdd\u8bc1\u4e1a\u52a1IP\u7684\u9ad8\u53ef\u7528\u3002 \u53ef\u53c2\u8003 http://clusterlabs.org/wiki/Debian_Lenny_HowTo#Configure_an_IP_resource http://geekpeek.net/linux-cluster-corosync-pacemaker/","title":"\u9ad8\u53ef\u7528\u4e1a\u52a1IP"},{"location":"inthecloud/ch03/","text":"\u7b2c\u4e09\u7ae0 \u5408\u9002\u7684\u865a\u62df\u5316\u5e73\u53f0 3.1 \u865a\u62df\u5316\u5e73\u53f0\u7b80\u4ecb Welcome to the core! \u55ef\uff0c\u7b14\u8005\u64b8\u4e86\u4e2a OpenStack \u548c k8s \u7684\u90e8\u7f72 \u811a\u672c \uff0cPXE \u54e6\u3002 \u4e91\u8ba1\u7b97\u76ee\u524d\u4e3b\u6d41\u5b9e\u73b0\u6709 SaaS\uff08Software-as-a-service\uff09\u3001PaaS\uff08Platform-as-a-service\uff09\u548c IaaS\uff08Infrastructure-as-a-service\uff09\u3002IaaS \u548c PaaS \u90fd\u7b97\u4f5c\u57fa\u7840\u4ef6\uff0cSaaS \u53ef\u4ee5\u4e0e\u57fa\u7840\u4ef6\u81ea\u7531\u7ec4\u5408\u6216\u8005\u5355\u72ec\u4f7f\u7528\u3002 \u865a\u62df\u5316\u6280\u672f\u5df2\u7ecf\u5f88\u53d7\u91cd\u89c6\u800c\u4e14\u88ab\u63a8\u5230\u4e86\u4e00\u4e2a\u6d6a\u5c16\u3002\u5982\u4eca\u8bf8\u591a\u5f00\u6e90\u865a\u62df\u5316\u5e73\u53f0\uff0c\u6bd4\u5982 XenServer\u3001CloudStack\u3001OpenStack\u3001Eucalyptus\u3001oVirt\u3001OpenVZ\u3001Docker\u3001LXC \u7b49\uff0c\u6211\u4eec\u90fd\u770b\u82b1\u4e86\u773c\uff0c\u4e9b\u8bb8\u614c\u4e71\u4e0d\u77e5\u54ea\u4e2a\u9002\u5408\u81ea\u5df1\u4e86\u3002 \u5404\u5e73\u53f0\u5b9e\u73b0\u65b9\u5f0f\uff1a\u5168\u865a\u62df\u5316\uff0c\u534a\u865a\u62df\u5316\uff0c\u5e94\u7528\u865a\u62df\u5316\u3002 IaaS \u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u7efc\u5408\u6765\u8bf4\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a \u865a\u62df\u5316\uff1a\u865a\u62df\u5316\u4f5c\u4e3a\u4e91\u8ba1\u7b97\u5e73\u53f0\u7684\u6838\u5fc3\uff0c\u662f\u8d44\u6e90\u5229\u7528\u7684\u4e3b\u8981\u5f62\u5f0f\u4e4b\u4e00\u3002\u7f51\u7edc\u3001\u5b58\u50a8\u3001CPU \u4e43\u81f3 GPU \u7b49\u4e3b\u8981\u901a\u8fc7\u865a\u62df\u4e3b\u673a\u8fdb\u884c\u5b9e\u4f53\u5316\u3002 \u5206\u5e03\u5f0f\uff1a\u5206\u5e03\u5f0f\u53ef\u5229\u7528\u5171\u4eab\u7684\u5b58\u50a8\uff0c\u901a\u8fc7\u7f51\u7edc\u5c06\u8d44\u6e90\u8fdb\u884c\u6574\u5408\uff0c\u662f\u5b9e\u73b0\u8d44\u6e90\u5316\u7684\u5fc5\u5907\u6761\u4ef6\u3002 \u9ad8\u53ef\u7528\uff1a\u4e8e\u89c4\u6a21\u5e9e\u5927\u7684\u4e91\u5e73\u53f0\uff0c\u63d0\u4f9b\u5b58\u50a8\u3001\u7ba1\u7406\u8282\u70b9\u3001\u91cd\u8981\u670d\u52a1\u7684\u9ad8\u5ea6\u53ef\u7528\u6027\u662f\u5341\u5206\u5fc5\u8981\u7684\u3002\u7b14\u8005\u5728\u5199\u8fd9\u7bc7\u6587\u7ae0\u65f6\uff0coVirt 3.4 \u5df2\u7ecf\u53ef\u4ee5\u505a\u5230\u7ba1\u7406\u8282\u70b9\u7684\u9ad8\u5ea6\u53ef\u7528\u3002 \u517c\u5bb9\u6027\uff1a\u4e91\u8ba1\u7b97\u5e73\u53f0\u4f17\u591a\uff0c\u5404\u5bb6\u6709\u5404\u5bb6\u7684\u7279\u70b9\uff0c\u540c\u4e00\u6570\u636e\u4e2d\u5fc3\u90e8\u7f72\u4e0d\u540c\u7684\u5e73\u53f0\u7684\u53ef\u80fd\u6027\u6781\u5927\uff0c\u56e0\u6b64\uff0c\u4e3b\u8981\u670d\u52a1\uff08\u6bd4\u5982\u865a\u62df\u7f51\u7edc\u3001\u5b58\u50a8\u3001\u865a\u673a\u7b49\uff09\u8981\u6709\u4e00\u5b9a\u517c\u5bb9\u6027\uff0c\u6bd4\u5982 oVirt \u53ef\u4ee5\u5229\u7528 OpenStack \u7684 Nouveau \u63d0\u4f9b\u7684\u865a\u62df\u7f51\u7edc\u3001Foreman \u53ef\u4ee5\u65b9\u4fbf\u5730\u5728 oVirt \u4e0a\u90e8\u7f72\u65b0\u673a\u5668\u7b49\u3002\u53e6\u5916\uff0c\u4e5f\u6709 DeltaCloud\u3001libvirt \u7b49 API\uff0c\u7528\u6237\u53ef\u4ee5\u5229\u7528\u5b83\u4eec\u81ea\u7531\u5730\u5b9e\u73b0\u81ea\u5df1\u7684\u4e91\u7efc\u5408\u7ba1\u7406\u5de5\u5177\u3002 \u8d44\u6e90\u6c60\u5316\uff1a\u7f51\u7edc\u3001\u5b58\u50a8\u3001CPU \u6216\u8005 GPU \u53ef\u4ee5\u7efc\u5408\u6216\u8005\u5355\u72ec\u5212\u5206\u8d44\u6e90\u6c60\uff0c\u901a\u8fc7\u914d\u989d\u8fdb\u884c\u5206\u914d\uff0c\u4ece\u800c\u4fdd\u8bc1\u5176\u5408\u7406\u5229\u7528\u3002 \u5b89\u5168\u6027\uff1a\u73b0\u4ee3\u4f01\u4e1a\u5bf9\u4e8e\u5b89\u5168\u6027\u7684\u8981\u6c42\u5df2\u7ecf\u5341\u5206\u82db\u523b\uff0c\u9664\u53bb\u4f20\u7edf\u6570\u636e\u52a0\u5bc6\u3001\u8bbf\u95ee\u63a7\u5236\uff0c\u751a\u81f3\u5bf9\u4e8e\u793e\u4f1a\u5de5\u7a0b\u4e5f\u8981\u6709\u4e00\u5b9a\u9632\u62a4\u80fd\u529b\uff1b\u7528\u6237\u6570\u636e\u5177\u6709\u5bf9\u975e\u4f01\u4e1a\u7ba1\u7406\u5458\u5177\u6709\u9632\u62a4\u6027\u80fd\uff0c\u5373\u4f7f\u5c06\u865a\u62df\u673a\u78c1\u76d8\u6587\u4ef6\u62f7\u8d1d\u51fa\u6765\u4e5f\u4e0d\u80fd\u76f4\u63a5\u83b7\u53d6\u5176\u5185\u5bb9\u3002 \u9700\u6c42\u5bfc\u5411\u6027\uff1a\u5728\u8ba1\u7b97\u6c34\u5e73\u4e0a\uff0c\u4f18\u8d28\u8d44\u6e90\u6700\u5148\u63d0\u4f9b\u7ed9\u91cd\u8981\u670d\u52a1\uff1b\u670d\u52a1\u6c34\u5e73\u4e0a\uff0c\u5e73\u53f0\u5177\u6709\u53ef\u5b9a\u5236\u80fd\u529b\u3002 oVirt oVirt \u76ee\u524d\u4e24\u79cd\u90e8\u7f72\u65b9\u5f0f\uff1a \u90e8\u7f72\u65b9\u5f0f \u793a\u4f8b \u7ba1\u7406\u72ec\u5360\u4e00\u53f0\u7269\u7406\u673a .. image:: ../images/03-01.png \u9ad8\u53ef\u7528\u7ba1\u7406\u5f15\u64ce .. image:: ../images/03-02.png \u5e38\u89c1\u540d\u6b21 \u7ba1\u7406\u5f15\u64ce\uff08engine\uff09 \uff1a\u63d0\u4f9b\u5e73\u53f0 web \u7ba1\u7406\u3001api\uff0c\u5404\u79cd\u6269\u5c55\u670d\u52a1\uff0cvdsm \u4ee5\u53ca libvirt \u670d\u52a1\u7684\u91cd\u8981\u8282\u70b9\u3002 \u5bbf\u4e3b\u673a\uff08node/host\uff09 \uff1a\u4e3a\u5e73\u53f0\u7684\u7684\u529f\u80fd\u63d0\u4f9b\u652f\u6301\uff0c\u4e3b\u8981\u662f\u865a\u62df\u5316\u80fd\u529b\u3002 \u6570\u636e\u4e2d\u5fc3\uff08data center\uff09 \uff1a\u4ee5\u6570\u636e\u5171\u4eab\u65b9\u5f0f\uff08Shared/Local\uff09\u5212\u5206\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u96c6\u7fa4\u3002 \u5b58\u50a8\u57df\uff08storage domain\uff09 \uff1a\u5e73\u53f0\u6240\u4f9d\u8d56\u7684\u5404\u79cd\u5b58\u50a8\u7a7a\u95f4\u3002 \u903b\u8f91\u7f51\u7edc\uff08logic network\uff09 \uff1a\u7269\u7406\u7f51\u7edc\u6216\u8005\u865a\u62df\u7f51\u7edc\u7684\u62bd\u8c61\u4ee3\u8868\u3002 \u6c60\uff08pool\uff09 \uff1a\u7528\u4e8e\u6279\u91cf\u521b\u5efa\u865a\u62df\u673a\u3002 \u96c6\u7fa4\u7b56\u7565\uff08cluster policy\uff09 \uff1a\u5bbf\u4e3b\u673a/\u865a\u62df\u673a\u8fd0\u884c\u6216\u8005\u8fc1\u79fb\u65f6\u6240\u9075\u5faa\u7684\u539f\u5219\u3002 DWH/Reports \uff1a\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u72b6\u6001\u62a5\u544a\uff08\u9700\u8981 ovirt-engine-reports\uff09\u3002 \u53ef\u4fe1\u670d\u52a1 \uff1a \u9700\u8981 OpenAttestation \u3002 \u7535\u6e90\u7ba1\u7406 \uff1a \u5982\u679c\u6ca1\u6709\u7269\u7406\u7535\u6e90\u63a7\u5236\u5668\uff0c\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a\u67d0\u4e00\u53f0\u4e3b\u673a\u4e3a\u4ee3\u7406\u673a\uff0c\u4ee5\u6784\u5efa\u66f4\u7a33\u5065\u7684\u96c6\u7fa4\u3002 OpenStack OpenStack \u4e91\u8ba1\u7b97\u4e2d\u5f15\u5165\u7684\u6982\u5ff5\u5df2\u7ecf\u5148\u5165\u4e3a\u4e3b\uff0c\u8ba9\u56fd\u5185\u8bb8\u591a\u8f83\u665a\u63a5\u89e6\u4e91\u8ba1\u7b97\u7684\u4eba\u8ba4\u4e3a\u8fd9\u5c31\u662f\u6807\u51c6\u6982\u5ff5\u3002 \u66f4\u591a\u5185\u5bb9\u8bf7\u53c2\u8003\u9644\u5f55\u4e00\u3002 CloudStack \u53ef\u80fd\u4e5f\u4e0d\u9519\uff0c\u6211\u6ca1\u7528\u8fc7\u3002 3.2 \u642d\u5efa oVirt \u7ba1\u7406\u5f15\u64ce \u642d\u5efa oVirt \u5e73\u53f0\u7684\u6b65\u9aa4\uff1a \u5b89\u88c5 Redhat \u7c7b\u64cd\u4f5c\u7cfb\u7edf\uff08Redhat\u3001CentOS\u3001Fedora\uff09 \u4ece yum \u5b89\u88c5 oVirt\uff0c\u5e76\u6267\u884c engine-setup\uff0c\u6216\u8005\u76f4\u63a5\u4ece oVirt \u63d0\u4f9b\u7684 iso \u8fdb\u884c\u5b89\u88c5 \u6dfb\u52a0\u5bbf\u4e3b\u673a \u6dfb\u52a0\u5b58\u50a8\u57df \u521b\u5efa\u865a\u62df\u673a \u7cfb\u7edf\u51c6\u5907 \u6240\u6709\u673a\u5668\u7684 SELINUX \u90fd\u8bbe\u7f6e\u4e3a permissive\u3002 /etc/selinux/config 1 SELINUX=permissive 1 # setenfoce permissive \u5982\u6709\u9700\u8981\uff0c\u6e05\u9664 iptables \u89c4\u5219\u3002 1 2 # iptables -F # service iptables save \u6bcf\u53f0\u673a\u5668\u4e0a\u90fd\u8981\u6dfb\u52a0\u4f5c\u4e3a\u865a\u62df\u673a\u8fd0\u884c\u7684 engine \u7684 FQDN\uff0c\u6b64\u5904\u4e3a ha.example.com\u3002 1 # echo -e '192.168.10.100\\tha.example.com' >> /etc/hosts \u5b58\u50a8\u53ef\u4ee5\u4f7f\u7528\u4e4b\u524d\u7684 glusterfs\uff0c\u65b9\u5f0f\u4e3a NFS_V3\uff0c\u6ce8\u610f\u5c06 brick \u7684\u6743\u9650\u8bbe\u7f6e\u4e3a vdsm.kvm \u6216\u8005 36:36\u3002 :::{note} \u666e\u901a NFS \u670d\u52a1\u5668\u8bbe\u7f6e \u56e0\u4e3a\u8003\u8651\u5230 NFS4 \u7684\u6743\u9650\u914d\u7f6e\u8f83\u4e3a\u590d\u6742\uff0c\u63a8\u8350 NFS \u4f7f\u7528 V3\uff0c\u4fee\u6539 nfsmount.conf \u4e2d\u7684 Version \u4e3a 3\u3002 ::: 1 2 3 4 5 # gluster volume create gluster-vol1 replica 2 \\ gs1.example.com:/gluster_brick0 gs2.example.com:/gluster_brick0 \\ gs3.example.com:/gluster_brick0 gs4.example.com:/gluster_brick0 \\ gs1.example.com:/gluster_brick1 gs2.example.com:/gluster_brick1 \\ gs3.example.com:/gluster_brick1 gs4.example.com:/gluster_brick1 force \u7531\u4e8e\u7ba1\u7406\u7aef\u4ee5\u53ca\u8282\u70b9\u7684\u7f51\u7edc\u670d\u52a1\u4f9d\u8d56\u4e8e network \u800c\u975e NetworkManager \uff0c\u6211\u4eec\u9700\u8981\u542f\u7528\u524d\u8005\u7981\u7528\u540e\u8005\uff0c\u5728\u6bcf\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u90fd\u8fdb\u884c\u5982\u4e0b\u7c7b\u4f3c\u914d\u7f6e\u4fee\u6539\u7f51\u7edc\u3002 /etc/sysconfig/network-scripts/ifcfg-eth0 1 2 3 4 5 6 7 8 9 NAME=eth0 DEVICE=eth0 ONBOOT=yes BOOTPROTO=static # \u6ce8\u610f\u4fee\u6539\u6b64\u5904\u7684IP IPADDR=192.168.10.101 NETMASK=255.255.255.0 GATEWAY=192.168.10.1 DNS1=192.168.10.1 1 2 3 # chkconfig NetworkManager off # chkconfig network on # service NetworkManager stop; service network restart \u6dfb\u52a0 repo :::{note} oVirt3.4.2 \u7279\u522b\u8bf4\u660e 2014 \u5e74\u516d\u4e03\u6708\u7684\u521d\u6b21\u5b89\u88c5 oVirt \u7684\u7528\u6237\u53ef\u80fd\u4f1a\u9047\u5230\u6dfb\u52a0\u5bbf\u4e3b\u673a\u5931\u8d25\u7684\u95ee\u9898\uff0c\u6682\u65f6\u89e3\u51b3\u529e\u6cd5\u4e3a\u5378\u8f7d python-pthreading-0.1.3-1 \u53ca\u4ee5\u540e\u7684\u7248\u672c\uff0c\u5b89\u88c5\u8001\u7248\u672c\uff0c\u6bd4\u5982 ftp://ftp.icm.edu.pl/vol/rzm2/linux-fedora/linux/epel/6/i386/python-pthreading-0.1.3-0.el6.noarch.rpm \uff0c\u518d\u5c1d\u8bd5\u5b89\u88c5 vdsm \u5e76\u6dfb\u52a0\u5bbf\u4e3b\u673a\u3002 ::: \u4f7f\u7528 rpm\uff1a 1 2 # yum localinstall http://plain.resources.ovirt.org/releases/ovirt-release/ovirt-release34.rpm # yum install ovirt-hosted-engine-setup \u6216\u8005\u624b\u52a8\u6dfb\u52a0\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 [ovirt-stable] name=Latest oVirt Releases baseurl=http://resources.ovirt.org/releases/stable/rpm/EL/$releasever/ enabled=1 skip_if_unavailable=1 gpgcheck=0 [ovirt-3.4-stable] name=Latest oVirt 3.4.z Releases baseurl=http://resources.ovirt.org/releases/3.4/rpm/EL/$releasever/ enabled=1 skip_if_unavailable=1 gpgcheck=0 [epel] name=Extra Packages for Enterprise Linux 6 - $basearch #baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&arch=$basearch failovermethod=priority enabled=1 gpgcheck=0 [ovirt-glusterfs-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/$basearch/ enabled=1 skip_if_unavailable=1 gpgcheck=0 [ovirt-glusterfs-noarch-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/noarch enabled=1 skip_if_unavailable=1 gpgcheck=0 \u4ece\u4e0b\u9762\u4e24\u79cd\u65b9\u5f0f\u4e2d\u9009\u62e9\u4e4b\u4e00\u8fdb\u884c\u642d\u5efa {ref} label2 {ref} label3 (label2)= \u642d\u5efa\u666e\u901a oVirt \u865a\u62df\u5316\u5e73\u53f0 \u7b14\u8005\u5199\u6b64\u6587\u65f6 oVirt \u5df2\u7ecf\u66f4\u65b0\u5230 3.4\u3002 \u5728\u6b64\uff0c\u6211\u4eec\u4f1a\u7528\u5230\u4e4b\u524d\u521b\u5efa\u7684 distributed-replicated \u5b58\u50a8\uff0c\u8fd9\u6837\u53ef\u7528\u4fdd\u8bc1\u7cfb\u7edf\u670d\u52a1\u7684\u9ad8\u5ea6\u53ef\u7528\u6027\u6709\u6240\u63d0\u9ad8\u3002 \u5bf9\u4e8e\u521d\u6b21\u4f7f\u7528 oVirt \u7684\u7528\u6237\uff0c\u5efa\u8bae\u4f7f\u7528\u6b64\u79cd\u642d\u5efa\u65b9\u5f0f\uff0c \u592a\u6298\u817e\u7684\u8bdd\u5c31\u5413\u8d70\u597d\u591a\u76ee\u6807\u8bfb\u8005\u4e86 \u3002 \u4f7f\u7528\u4e4b\u524d\u7684\u56db\u53f0\u673a\u5668\uff0c\u5206\u522b\u4e3a gs1.example.com\uff0cgs2.example.com\uff0cgs3.example.com \u548c gs4.example.com\uff0c\u5176\u4e2d\uff0c\u5c06 gs1 \u4f5c\u4e3a\u7ba1\u7406\u673a\u5b89\u88c5 ovirt-engine\uff0c\u5176\u4f59\u4e09\u53f0\u4f5c\u4e3a\u8282\u70b9\uff08node\uff09\uff0c\u5b58\u50a8\u4f7f\u7528\u5df2\u7ecf\u521b\u5efa\u597d\u7684 glusterfs\u3002 ```{image} ../images/03-03.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 \u5728 gs1 \u4e0a\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u3002 ```{code} # yum install ovirt-engine # engine-setup --offline [ INFO ] Stage: Initializing [ INFO ] Stage: Environment setup Configuration files: ['/etc/ovirt-engine-setup.conf.d/10-packaging.conf'] Log file: /var/log/ovirt-engine/setup/ovirt-engine-setup-20140508054649.log Version: otopi-1.2.0 (otopi-1.2.0-1.el6) [ INFO ] Stage: Environment packages setup [ INFO ] Stage: Programs detection [ INFO ] Stage: Environment setup [ INFO ] Stage: Environment customization --== PRODUCT OPTIONS ==-- --== PACKAGES ==-- --== NETWORK CONFIGURATION ==-- Host fully qualified DNS name of this server [gs1.example.com]: Setup can automatically configure the firewall on this system. Note: automatic configuration of the firewall may overwrite current settings. Do you want Setup to configure the firewall? (Yes, No) [Yes]: The following firewall managers were detected on this system: iptables Firewall manager to configure (iptables): iptables [ INFO ] iptables will be configured as firewall manager. --== DATABASE CONFIGURATION ==-- Where is the Engine database located? (Local, Remote) [Local]: Setup can configure the local postgresql server automatically for the engine to run. This may conflict with existing applications. Would you like Setup to automatically configure postgresql and create Engine database, or prefer to perform that manually? (Automatic, Manual) [Automatic]: --== OVIRT ENGINE CONFIGURATION ==-- Application mode (Both, Virt, Gluster) [Both]: Default storage type: (NFS, FC, ISCSI, POSIXFS) [NFS]: Engine admin password: Confirm engine admin password: --== PKI CONFIGURATION ==-- Organization name for certificate [example.com]: --== APACHE CONFIGURATION ==-- Setup can configure apache to use SSL using a certificate issued from the internal CA. Do you wish Setup to configure that, or prefer to perform that manually? (Automatic, Manual) [Automatic]: Setup can configure the default page of the web server to present the application home page. This may conflict with existing applications. Do you wish to set the application as the default page of the web server? (Yes, No) [Yes]: --== SYSTEM CONFIGURATION ==-- Configure WebSocket Proxy on this machine? (Yes, No) [Yes]: Configure an NFS share on this server to be used as an ISO Domain? (Yes, No) [Yes]: no --== MISC CONFIGURATION ==-- --== END OF CONFIGURATION ==-- [ INFO ] Stage: Setup validation --== CONFIGURATION PREVIEW ==-- Engine database name : engine Engine database secured connection : False Engine database host : localhost Engine database user name : engine Engine database host name validation : False Engine database port : 5432 PKI organization : example.com Application mode : both Firewall manager : iptables Update Firewall : True Configure WebSocket Proxy : True Host FQDN : gs1.example.com Datacenter storage type : nfs Configure local Engine database : True Set application as default page : True Configure Apache SSL : True Please confirm installation settings (OK, Cancel) [OK]: ok [ INFO ] Stage: Transaction setup [ INFO ] Stopping engine service [ INFO ] Stopping websocket-proxy service [ INFO ] Stage: Misc configuration [ INFO ] Stage: Package installation [ INFO ] Stage: Misc configuration [ INFO ] Initializing PostgreSQL [ INFO ] Creating PostgreSQL 'engine' database [ INFO ] Configuring PostgreSQL [ INFO ] Creating Engine database schema [ INFO ] Creating CA [ INFO ] Configuring WebSocket Proxy [ INFO ] Generating post install configuration file '/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf' [ INFO ] Stage: Transaction commit [ INFO ] Stage: Closing up --== SUMMARY ==-- SSH fingerprint: 1B:FD:08:A2:FD:83:20:8A:65:F5:0D:F6:CB:BF:46:C7 Internal CA 28:7E:D6:6B:F7:F2:6C:B5:60:27:44:C3:7F:3C:22:63:E5:68:DD:F4 Web access is enabled at: http://gs1.example.com:80/ovirt-engine https://gs1.example.com:443/ovirt-engine Please use the user \"admin\" and password specified in order to login into oVirt Engine --== END OF SUMMARY ==-- [ INFO ] Starting engine service [ INFO ] Restarting httpd [ INFO ] Generating answer file '/var/lib/ovirt-engine/setup/answers/20140508054842-setup.conf' [ INFO ] Stage: Clean up Log file is located at /var/log/ovirt-engine/setup/ovirt-engine-setup-20140508054649.log [ INFO ] Stage: Pre-termination [ INFO ] Stage: Termination [ INFO ] Execution of setup completed successfully \u81f3\u6b64\uff0c\u7ba1\u7406\u8282\u70b9\u5b89\u88c5\u7ed3\u675f\uff0c\u53c2\u8003 {ref} label1 \u52a0\u5165\u8282\u70b9\u4ee5\u53ca\u5b58\u50a8\u57df\u3002 (label3)= \u642d\u5efa\u7ba1\u7406\u7aef\u9ad8\u53ef\u7528 oVirt\uff08hosted engine\uff09 \u9ad8\u53ef\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5212\u5206\uff1a \u5b58\u50a8\u7684\u9ad8\u53ef\u7528\uff1a\u4f20\u7edf\u5b58\u50a8\u4f7f\u7528 DRBD/Heartbeat \u6216\u8005\u72ec\u7acb\u7684\u5b58\u50a8\u8bbe\u5907\u4fdd\u8bc1\u9ad8\u53ef\u7528\uff0c\u5728\u7075\u6d3b\u6027\u3001\u53ef\u6269\u5c55\u6027\u3001\u6210\u672c\u4e0a\u90fd\u6709\u4e00\u5b9a\u5c40\u9650\u3002\u5728\u4e0e\u4e3b\u673a\u540c\u53f0\u4f7f\u7528 Ceph \u6216\u8005 Glusterfs \u53ef\u4ee5\u8f83\u597d\u5730\u4fdd\u8bc1\u8d44\u6e90\u5145\u5206\u5229\u7528\u5730\u540c\u65f6\uff0c\u53c8\u6ee1\u8db3\u4e86\u9ad8\u5ea6\u53ef\u7528\u7684\u8981\u6c42\u3002 \u7ba1\u7406\u9ad8\u53ef\u7528\uff1a\u56e0\u4e3a\u6bd4\u5982 oVirt\u3001OpenStack \u8fd9\u79cd\u62e5\u6709\u5927\u578b\u6570\u636e\u5e93\u7684\u8bbe\u65bd\u4e0d\u50cf\u5b58\u50a8\u8bbe\u65bd\u90a3\u6837\u9ad8\u6548\u7684\u540c\u6b65\uff0c\u9700\u8981\u72ec\u7acb\u7684\u7ba1\u7406\u8fd0\u884c\u5728\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e00\u53f0\u673a\u5668\u4e0a\u6765\u540c\u6b65\u96c6\u7fa4\u6d88\u606f\uff0c\u6240\u4ee5\uff0c\u7ba1\u7406\u7aef\u7684\u9ad8\u53ef\u7528\u4e5f\u662f\u5341\u5206\u5fc5\u8981\u7684\u3002 \u865a\u62df\u673a/\u670d\u52a1\u9ad8\u53ef\u7528\uff1a\u865a\u62df\u673a\u5728\u5b95\u673a\u65f6\u53ef\u81ea\u52a8\u91cd\u542f\uff0c\u5728\u4e3b\u673a\u8d44\u6e90\u7d27\u5f20\u65f6\u53ef\u7528\u8fc1\u79fb\u5230\u5176\u4ed6\u8d1f\u8f7d\u8f83\u4f4e\u7684\u4e3b\u673a\u4e0a\uff0c\u4ece\u800c\u4fdd\u8bc1\u670d\u52a1\u7684\u8d28\u91cf\u4ee5\u53ca\u8fde\u7eed\u6027\u3002 ```{image} ../images/03-03.png :align: center 1 2 3 4 5 6 7 8 9 ```{eval-rst} .. epigraph:: 1. \u5bbf\u4e3b\u673a\u7684CPU\u67b6\u6784\u5efa\u8bae\u9009\u62e9Westmere\uff08Westmere E56xx/L56xx/X56xx\uff09\u3001Nehalem\uff08Intel Core i7 9xx\uff09\u3001Penryn\uff08Intel Core 2 Duo P9xxx\uff09\u6216\u8005Conroe\uff08Intel Celeron_4x0\uff09\u4e2d\u7684\u4e4b\u4e00\u3002 CPU Family table \u53c2\u9605 `Intel Architecture and Processor Identification With CPUID Model and Family Numbers <https://software.intel.com/en-us/articles/intel-architecture-and-processor-identification-with-cpuid-model-and-family-numbers>`_ 2. \u5efa\u8bae\u53c2\u8003\u7b2c11\u8282\u63d0\u524d\u5b89\u88c5\u542b\u6709oVirt\u7ba1\u7406\u7684\u865a\u62df\u673a\uff0c\u786c\u76d8\u683c\u5f0f\u4e3aRAW\uff0c\u4ece\u800c\u5728\u5b89\u88c5\u7ba1\u7406\u673a\u65f6\u4f5c\u4e3aOVF\u5bfc\u5165\u6216\u8005\u8986\u76d6\u865a\u62df\u78c1\u76d8\uff0c\u51cf\u5c11\u5931\u8d25\u98ce\u9669\u65f6\u95f4\u3002 \u5b89\u88c5 ovirt-hosted-engine-setup\uff0c\u5e76\u56de\u7b54\u4e00\u4e9b\u95ee\u9898\uff0c\u6ce8\u610f\u9ad8\u4eae\u90e8\u5206\uff1a ```{code-block} bash :emphasize-lines: 21,36,123,138-144,150,166,173 hosted-engine --deploy [ INFO ] Stage: Initializing Continuing will configure this host for serving as hypervisor and create a VM where you have to install oVirt Engine afterwards. Are you sure you want to continue? (Yes, No)[Yes]: yes [ INFO ] Generating a temporary VNC password. [ INFO ] Stage: Environment setup Configuration files: [] Log file: /var/log/ovirt-hosted-engine-setup/ovirt-hosted-engine-setup-20140508182241.log Version: otopi-1.2.0 (otopi-1.2.0-1.el6) [ INFO ] Hardware supports virtualization [ INFO ] Bridge ovirtmgmt already created [ INFO ] Stage: Environment packages setup [ INFO ] Stage: Programs detection [ INFO ] Stage: Environment setup [ INFO ] Stage: Environment customization 1 2 3 4 --== STORAGE CONFIGURATION ==-- During customization use CTRL-D to abort. Please specify the storage you would like to use (nfs3, nfs4)[nfs3]: \u6b64\u5904\u7684\u5b58\u50a8\u57df\u53ea\u5b58\u50a8hosted-engine\u7684\u76f8\u5173\u6587\u4ef6\uff0c\u4e0d\u4f5c\u4e3a\u4e3b\u6570\u636e\u57df \u5efa\u8bae\u6302\u8f7dgluster\u7684nfs\u65f6\u4f7f\u7528localhost:data\u5f62\u5f0f 1 Please specify the full shared storage connection path to use (example: host:/path): 192.168.10.101:/gluster-vol1/ovirt_data/hosted_engine [ INFO ] Installing on first host Please provide storage domain name. [hosted_storage]: Local storage datacenter name is an internal name and currently will not be shown in engine's admin UI.Please enter local datacenter name [hosted_datacenter]: 1 2 3 4 5 6 7 8 9 --== SYSTEM CONFIGURATION ==-- --== NETWORK CONFIGURATION ==-- iptables was detected on your computer, do you wish setup to configure it? (Yes, No)[Yes]: no Please indicate a pingable gateway IP address [192.168.10.1]: --== VM CONFIGURATION ==-- \u865a\u62dfengine\u7684\u5b89\u88c5\u65b9\u5f0f 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 Please specify the device to boot the VM from (cdrom, disk, pxe) [cdrom]: The following CPU types are supported by this host: - model_Conroe: Intel Conroe Family Please specify the CPU type to be used by the VM [model_Conroe]: Please specify path to installation media you would like to use [None]: /tmp/centos.iso Please specify the number of virtual CPUs for the VM [Defaults to minimum requirement: 2]: Please specify the disk size of the VM in GB [Defaults to minimum requirement: 25]: You may specify a MAC address for the VM or accept a randomly generated default [00:16:3e:59:9b:e2]: Please specify the memory size of the VM in MB [Defaults to minimum requirement: 4096]: 4096 Please specify the console type you would like to use to connect to the VM (vnc, spice) [vnc]: --== HOSTED ENGINE CONFIGURATION ==-- Enter the name which will be used to identify this host inside the Administrator Portal [hosted_engine_1]: Enter 'admin@internal' user password that will be used for accessing the Administrator Portal: Confirm 'admin@internal' user password: Please provide the FQDN for the engine you would like to use. This needs to match the FQDN that you will use for the engine installation within the VM. Note: This will be the FQDN of the VM you are now going to create, it should not point to the base host or to any other existing machine. Engine FQDN: ha.example.com [WARNING] Failed to resolve ha.example.com using DNS, it can be resolved only locally Please provide the name of the SMTP server through which we will send notifications [localhost]: Please provide the TCP port number of the SMTP server [25]: Please provide the email address from which notifications will be sent [root@localhost]: Please provide a comma-separated list of email addresses which will get notifications [root@localhost]: [ INFO ] Stage: Setup validation 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --== CONFIGURATION PREVIEW ==-- Engine FQDN : ha.example.com Bridge name : ovirtmgmt SSH daemon port : 22 Gateway address : 192.168.10.1 Host name for web application : hosted_engine_1 Host ID : 1 Image size GB : 25 Storage connection : 192.168.10.101:/gluster-vol1/ovirt_data/hosted_data/ Console type : vnc Memory size MB : 4096 MAC address : 00:16:3e:59:9b:e2 Boot type : cdrom Number of CPUs : 2 ISO image (for cdrom boot) : /tmp/centos.iso CPU Type : model_Conroe Please confirm installation settings (Yes, No)[No]: yes [ INFO ] Generating answer file '/etc/ovirt-hosted-engine/answers.conf' [ INFO ] Stage: Transaction setup [ INFO ] Stage: Misc configuration [ INFO ] Stage: Package installation [ INFO ] Stage: Misc configuration [ INFO ] Configuring libvirt [ INFO ] Configuring VDSM [ INFO ] Starting vdsmd [ INFO ] Waiting for VDSM hardware info [ INFO ] Waiting for VDSM hardware info [ INFO ] Waiting for VDSM hardware info [ INFO ] Waiting for VDSM hardware info [ INFO ] Creating Storage Domain [ INFO ] Creating Storage Pool [ INFO ] Connecting Storage Pool [ INFO ] Verifying sanlock lockspace initialization [ INFO ] Initializing sanlock lockspace [ INFO ] Initializing sanlock metadata [ INFO ] Creating VM Image [ INFO ] Disconnecting Storage Pool [ INFO ] Start monitoring domain [ INFO ] Configuring VM [ INFO ] Updating hosted-engine configuration [ INFO ] Stage: Transaction commit [ INFO ] Stage: Closing up The following network ports should be opened: tcp:5900 tcp:5901 udp:5900 udp:5901 An example of the required configuration for iptables can be found at: /etc/ovirt-hosted-engine/iptables.example In order to configure firewalld, copy the files from /etc/ovirt-hosted-engine/firewalld to /etc/firewalld/services and execute the following commands: firewall-cmd -service hosted-console [ INFO ] Creating VM You can now connect to the VM with the following command: /usr/bin/remote-viewer vnc://localhost:5900 Use temporary password \"2067OGHU\" to connect to vnc console. Please note that in order to use remote-viewer you need to be able to run graphical applications. This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding). Otherwise you can run the command from a terminal in your preferred desktop environment. If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command: virsh -c qemu+tls://192.168.1.150/system console HostedEngine If you need to reboot the VM you will need to start it manually using the command: hosted-engine --vm-start You can then set a temporary password using the command: hosted-engine --add-console-password The VM has been started. Install the OS and shut down or reboot it. To continue please make a selection: 1 2 3 (1) Continue setup - VM installation is complete (2) Reboot the VM and restart installation (3) Abort setup \u9700\u8981\u5728\u53e6\u5916\u4e00\u4e2a\u6709\u56fe\u5f62\u80fd\u529b\u7684terminal\u4e2d\u8fd0\u884c \"remote-viewer vnc://192.168.10.101:5900\"\u8fde\u63a5\u865a\u62df\u673a\u3002 \u5b8c\u6210engine-setup\u540e\u5173\u95ed\u865a\u62df\u673a\uff1b\u53ef\u4ee5\u5728\u865a\u62df\u673a\u8fd0\u884c\u72b6\u6001\u4e0b\u6267\u884c \"hosted-engine --add-console-password\"\u66f4\u6362\u63a7\u5236\u53f0\u5bc6\u7801\u3002 \u5982\u679c\u4e4b\u524d\u9009\u62e9cdrom\u8fdb\u884c\u5b89\u88c5\u7684\u8bdd\uff0c\u6b64\u5904\u53ef\u4ee5\u5728gs1\u4e0a\u7528\u5df2\u7ecf\u5b89\u88c5\u597dengine\u7684 \u865a\u62df\u78c1\u76d8\u8fdb\u884c\u8986\u76d6\uff0c\u7c7b\u4f3c \"mount -t nfs 192.168.10.101:192.168.10.101:/gluster-vol1/ovirt_data/hosted_data/ /mnt; mv engine-disk.raw /mnt/ovirt_data/hosted_data/.../vm_UUID\" 1 2 (1, 2, 3)[1]: 1 Waiting for VM to shut down... [ INFO ] Creating VM You can now connect to the VM with the following command: /usr/bin/remote-viewer vnc://localhost:5900 Use temporary password \"2067OGHU\" to connect to vnc console. Please note that in order to use remote-viewer you need to be able to run graphical applications. This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding). Otherwise you can run the command from a terminal in your preferred desktop environment. If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command: virsh -c qemu+tls://192.168.1.150/system console HostedEngine If you need to reboot the VM you will need to start it manually using the command: hosted-engine --vm-start You can then set a temporary password using the command: hosted-engine --add-console-password Please install and setup the engine in the VM. You may also be interested in installing ovirt-guest-agent-common package in the VM. To continue make a selection from the options below: (1) Continue setup - engine installation is complete (2) Power off and restart the VM (3) Abort setup \u6b64\u5904\u53c2\u8003\u7b2c\u4e00\u6b21\u64cd\u4f5c\uff0c\u8fde\u63a5\u865a\u62df\u673a\u63a7\u5236\u53f0\u540e\u8fdb\u884c\"engine-setup --offline\"\u4ee5\u5b89\u88c5engine 1 (1, 2, 3)[1]: 1 [ INFO ] Engine replied: DB Up!Welcome to Health Status! [ INFO ] Waiting for the host to become operational in the engine. This may take several minutes... [ INFO ] Still waiting for VDSM host to become operational... [ INFO ] The VDSM Host is now operational Please shutdown the VM allowing the system to launch it as a monitored service. \u5230\u6b64\uff0c\u9700\u8981\u8fde\u63a5\u865a\u62df\u673a\u63a7\u5236\u53f0\u5173\u95ed\u865a\u62df\u673a 1 The system will wait until the VM is down. [ INFO ] Enabling and starting HA services Hosted Engine successfully set up [ INFO ] Stage: Clean up [ INFO ] Stage: Pre-termination [ INFO ] Stage: Termination 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 \u6b64\u65f6\uff0c\u8fd0\u884c\u201dhosted-engine \u2013vm-start\u201d\u4ee5\u542f\u52a8\u865a\u62df\u7ba1\u7406\u673a\u3002 :::{note} 1. \u82e5\u8981\u91cd\u65b0\u90e8\u7f72 # vdsClient -s 0 list # vdsClient -s 0 destroy <ID of the vm you get from the first command> 2. \u82e5\u8981\u6dfb\u52a0\u7b2c\u4e8c\u53f0\u673a\u5668 # yum install ovirt-hosted-engine-setup # hosted-engine --deploy \u7136\u540e\u6307\u5b9a\u5b58\u50a8\u8def\u5f84\u5373\u53ef\u81ea\u52a8\u5224\u65ad\u6b64\u4e3a\u7b2c 2+\u53f0\u673a\u5668\u3002 ::: (label1)= ## 3.3 \u6dfb\u52a0\u8282\u70b9\u4ee5\u53ca\u5b58\u50a8\u57df \u4f60\u770b\u5230\u8fd9\u7684\u8bdd\u5e94\u8be5\u5df2\u7ecf\u6709\u4e86\u4e00\u4e2a\u6570\u636e\u4e2d\u5fc3\u3001\u51e0\u4e2a\u5bbf\u4e3b\u673a\uff0c\u4e5f\u53ef\u80fd\u6709\u4e00\u4e2a\u865a\u62df\u673a\uff08engine\uff09\uff0c\u8fd8\u5dee\u4e00\u4e2a\u5b58\u50a8\u865a\u62df\u673a\u955c\u50cf\u7684\u5730\u65b9\u5c31\u53ef\u4ee5\u62e5\u6709\u57fa\u672c\u7684 oVirt \u5e73\u53f0\u4e86\u3002 ### \u6dfb\u52a0\u8282\u70b9\uff08\u5bbf\u4e3b\u673a\uff09 \u5bf9\u4e8e\u7b2c 11 \u8282\u7684\u666e\u901a oVirt\u3001\u7b2c 12 \u8282\u7684 ha \u5e73\u53f0\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u6dfb\u52a0\u66f4\u591a\u8282\u70b9\u4ee5\u652f\u6301\u66f4\u597d\u7684 SLA\uff08service level agreement\uff09\u3002 \u6dfb\u52a0\u8282\u70b9\u76ee\u524d\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a - \u901a\u8fc7 oVirt \u7684\u8282\u70b9 ISO \u5b89\u88c5\u7cfb\u7edf\u540e\u52a0\u5165\u3002 - \u76f4\u63a5\u5c06\u73b0\u6709 CentOS \u6216\u8005 Fedora \u8f6c\u5316\u4e3a\u8282\u70b9\uff08\u53ef\u4ee5\u4e3a\u5f53\u524d\u7ba1\u7406\u673a\uff09\u3002 - \u6307\u5b9a\u4f7f\u7528\u5916\u90e8\u63d0\u4f9b\u8005\uff08Foreman\uff09\u3002 \u5728\u6b64\u6211\u4eec\u4f7f\u7528\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u3002 ```{image} ../images/03-05.png :align: center \u6dfb\u52a0\u5b58\u50a8\u57df \u5b58\u50a8\u57df\u6709 3 \u79cd\uff0cData\uff08\u6570\u636e\u57df\uff09\u3001ISO\uff08ISO \u57df\uff09\u3001Export\uff08\u5bfc\u51fa\u57df\uff09\u3002 \u5176\u4e2d\uff0c\u6570\u636e\u57df\u662f\u4e3a\u5fc5\u9700\uff0c\u5728\u521b\u5efa\u4efb\u4f55\u865a\u62df\u673a\u4e4b\u524d\u9700\u8981\u6709\u4e00\u4e2a\u53ef\u7528\u7684\u6570\u636e\u57df\u7528\u4e8e\u5b58\u50a8\u865a\u62df\u78c1\u76d8\u4ee5\u53ca\u5feb\u7167\u6587\u4ef6\uff1bISO \u57df\u4e2d\u53ef\u4ee5\u5b58\u653e ISO \u548c VFD \u683c\u5f0f\u7684\u7cfb\u7edf\u955c\u50cf\u6216\u8005\u9a71\u52a8\u6587\u4ef6\uff0c\u53ef\u5728\u591a\u4e2a\u6570\u636e\u4e2d\u5fc3\u95f4\u5171\u4eab\uff1b\u5bfc\u51fa\u57df\u7528\u4e8e\u5bfc\u51fa\u6216\u5bfc\u5165 OVF \u683c\u5f0f\u7684\u865a\u673a\u3002 \u800c\u6839\u636e\u6570\u636e\u57df\u7684\u5b58\u50a8\u7c7b\u578b\uff0c\u6211\u4eec\u6709 5 \u79cd\uff08NFS\u3001POSIX \u517c\u5bb9\u3001Glusterfs\u3001iSCSI\u3001\u5149\u7ea4\uff09\u53ef\u9009\uff0c\u5728\u6b64\uff0c\u9009\u62e9 glusterfs \u5bfc\u51fa\u7684 NFS\u3002 ```{image} ../images/03-06.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 :::{note} \u786e\u4fdd\u5b58\u50a8\u57df\u76ee\u5f55\u88ab vdsm.kvm \u53ef\u8bfb\uff0c\u5373\u6240\u6709\u8005\u4e3a 36:36\uff0c\u6216\u8005 vdsm.kvm\u3002 \u5bfc\u51fa\u57df\u5728\u5df2\u52a0\u5165\u6570\u636e\u4e2d\u5fc3\u540e\u4e0d\u53ef\u5171\u4eab\uff0c\u5982\u679c\u5b83\u610f\u5916\u635f\u574f\uff0c\u8bf7\u53c2\u8003 <http://blog.lofyer.org/blog/2014/05/11/cloud-6-5-advanced-ovirt/> \u624b\u52a8\u4fee\u590d\uff0c\u6216\u8005\u5220\u9664 dom_md/metadata \u4e2d\u7684 POOL_UUID \u7684\u503c\u4ee5\u53ca\\_SHA_CKSUM \u884c\u3002 \u82e5\u8981\u4f7f\u7528 oVirt \u7684 gluster \u652f\u6301\uff0c\u8bf7\u5b89\u88c5 vdsm-gluster \u5305\u3002 ::: ## 3.4 \u8fde\u63a5\u865a\u62df\u673a \u865a\u62df\u673a\u8fd0\u884c\u540e\uff0c\u901a\u8fc7 web \u754c\u9762\uff0c\u4f60\u53ef\u7528\u4f7f\u7528\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u8fde\u63a5\u865a\u62df\u673a\uff08\u53ef\u901a\u8fc7\u63a7\u5236\u53f0\u9009\u9879\u8fdb\u884c\u4fee\u6539\uff09\uff1a ```{image} ../images/03-08.png :align: center Spice-Html5 \u9996\u5148\u5728\u670d\u52a1\u5668\u7aef\u6253\u5f00 spice \u4ee3\u7406\uff1a 1 2 3 4 5 # engine-setup --otopi-environment=\"OVESETUP_CONFIG/websocketProxyConfig=bool:True\" # \u5982\u679c\u672asetup\u6216\u8005\u8981\u5728\u5176\u4ed6\u673a\u5668setup\uff0c\u53ef\u505a\u6b64\u6b65 # yum install -y numpy # \u5b89\u88c5numpy\u4ee5\u52a0\u901f\u8f6c\u6362\u3002 # engine-config -s WebSocketProxy=\"192.168.10.100:6100\" # service ovirt-websocket-proxy restart # service ovirt-engine restart \u8fde\u63a5\u4e4b\u524d\uff0c\u8981\u4fe1\u4efb\u4ee5\u4e0b\u4e24\u5904 https \u8bc1\u4e66\uff1a https://192.168.10.100 https://192.168.10.100:6100 \u7136\u540e\u70b9\u51fb\u63a7\u5236\u53f0\u6309\u94ae\u5373\u53ef\u5728\u6d4f\u89c8\u5668\u7684\u65b0\u6807\u7b7e\u4e2d\u6253\u5f00 spice-html5 \u684c\u9762\u3002 \u6d4f\u89c8\u5668\u63d2\u4ef6 \u5bf9\u4e8e Redhat \u7cfb\u5217\u7cfb\u7edf\uff0c\u53ef\u5b89\u88c5 spice-xpi \u63d2\u4ef6\uff1bWindows \u7cfb\u7edf\u53ef\u4ee5\u5b89\u88c5 SpiceX \u7684\u63a7\u4ef6\u3002 \u672c\u5730\u5ba2\u6237\u7aef \u8bbf\u95ee virt-manager \u5b98\u7f51 \u4e0b\u8f7d virt-viewer \u5ba2\u6237\u7aef\uff0c\u4f7f\u7528\u5b83\u6253\u5f00\u4e0b\u8f7d\u5230\u672c\u5730\u7684 console.vv \u6587\u4ef6\u3002 spice proxy/gateway - squid \u4ee3\u7406 \u8bbe\u7f6e squid \u4ee3\u7406\uff0c\u5c06\u6240\u6709 spice \u7aef\u53e3\u4ee3\u7406\u81f3 3128 \u7aef\u53e3\u3002 1 yum install squid 1 \u4fee\u6539/etc/squid/squid.conf\u3002 1 \u7b2c 5 \u884c acl localhost src 192.168.0.150 \u7b2c 41 \u884c\u4fee\u6539\u4e3a http_access allow CONNECT Safe_ports acl spice_servers dst 192.168.10.0/24 http_access allow spice_servers 1 \u542f\u7528squid\u670d\u52a1\u3002 1 chkconfig squid on service squid restart 1 \u8bbe\u7f6eengine\u7684SpiceProxy 1 engine-config -s SpiceProxyDefault=\"http://FQDN or \u5916\u7f51 IP:3128\" service ovirt-engine restart 1 \u53ef\u901a\u8fc7\u96c6\u7fa4\u8bbe\u7f6e\u4e2d\u8bbe\u7f6e\u6240\u6709\u5bbf\u4e3b\u673a\u7684Spice\u4ee3\u7406\uff0c\u6216\u8005\u5728\u865a\u62df\u673a\u8bbe\u7f6e\u4e2d\u5355\u4e00\u8bbe\u7f6e\u67d0\u53f0\u865a\u62df\u673a\u901a\u8fc7\u4ee3\u7406\u8bbf\u95ee\u3002 RDP \u63d2\u4ef6\uff08\u4ec5\u9002\u7528\u4e8e Windows \u865a\u673a\u53ca IE \u6d4f\u89c8\u5668\uff09 \u5982\u679c\u865a\u62df\u673a\u7684\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9\u4e3a Windows\uff0c\u5e76\u4e14\u5185\u90e8\u542f\u52a8\u4e86\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\uff0c\u4f7f\u7528 IE \u6d4f\u89c8\u5668\u8bbf\u95ee\u7528\u6237\u6216\u8005\u7ba1\u7406\u5458\u5165\u53e3\u65f6\uff0c\u53ef\u4ee5\u542f\u7528 RDP \u63a7\u4ef6\u3002 3.5 oVirt \u4f7f\u7528\u8fdb\u9636 \u6570\u636e\u5e93\u4fee\u6539\u975e\u540c\u6b65\u6570\u636e \u5982\u679c\u51fa\u73b0\u7f51\u7edc\u9519\u8bef\uff0c\u5f88\u6709\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e0d\u540c\u6b65\uff0c\u4ece\u800c\u5bfc\u81f4\u754c\u9762\u4e0a\u865a\u62df\u673a\u72b6\u6001\u4e00\u76f4\u5904\u4e8e\u5f02\u5e38\u72b6\u6001\uff0c\u8fd9\u70b9 OpenStack \u4e5f\u6709\u4e00\u6837\u7684\u7f3a\u70b9\u3002\u8fde\u63a5\u5f15\u64ce\u6570\u636e\u5e93\uff0c\u4fee\u6539\u5176\u4e2d\u7684 vm_dynamic, image, vm_static \u7b49\u6570\u636e\u8868\u5373\u53ef\u3002 engine-config \u53c2\u6570\u914d\u7f6e \u5e73\u53f0\u5b89\u88c5\u5b8c\u4ee5\u540e\uff0c\u53ef\u7528\u901a\u8fc7 engine-config \u547d\u4ee4\u8fdb\u884c\u8be6\u7ec6\u53c2\u6570\u914d\u7f6e\u3002 1 2 3 4 # \u67e5\u770b\u8bbe\u7f6e\u8bf4\u660e # engine-config -l # \u67e5\u770b\u5f53\u524d\u8bbe\u7f6e # engine-config -a \u793a\u4f8b\uff1a\u91cd\u8bbe\u7ba1\u7406\u5458\u5bc6\u7801 1 engine-config -s AdminPassword=interactive Please enter a password: # \u5bc6\u7801 Please reenter password: # \u5bc6\u7801 1 ovirt-shell \u4e0e API Restful API\uff08Application User Interface\uff09\u662f oVirt \u7684\u4e00\u5927\u7279\u70b9\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5b83\u5c06\u5176\u4e0e\u7b2c\u4e09\u65b9\u7684\u754c\u9762\u6216\u8005\u5e94\u7528\u8fdb\u884c\u96c6\u6210\u3002\u8bbf\u95ee http://192.168.10.100/api?rsdl \u4ee5\u83b7\u53d6\u5176\u7528\u6cd5\u3002 :::{note} \u8bbf\u95ee API \u4f7f\u7528 GET\u3001POST\u3001PUT\u3001DELETE \u65b9\u6cd5 \u83b7\u53d6\u5185\u5bb9\u65f6\u4f7f\u7528 GET\uff1b \u6dfb\u52a0\u65b0\u5185\u5bb9\u6216\u8005\u6267\u884c\u52a8\u4f5c\u4f7f\u7528 POST\uff1b \u66f4\u65b0\u5185\u5bb9\u4f7f\u7528 PUT\uff1b \u5220\u9664\u5185\u5bb9\u4f7f\u7528 DELETE\uff1b \u8be6\u7ec6\u7528\u6cd5\u53c2\u8003 http://www.ovirt.org/Api \uff0cSDK \u793a\u4f8b\u53c2\u8003 http://www.ovirt.org/Testing/PythonApi ::: ovirt-shell \u5219\u662f\u5168\u90e8\u4f7f\u7528 Restful API \u5199\u6210\u7684 shell\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u5b8c\u6210\u56fe\u5f62\u754c\u9762\u6240\u4e0d\u80fd\u63d0\u4f9b\u7684\u529f\u80fd\u3002 1 2 3 4 5 6 7 8 9 # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api ============================================================================ >>> connected to oVirt manager 3.4.0.0 <<< ============================================================================ ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ Welcome to oVirt shell ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ [oVirt shell (connected)]# \u793a\u4f8b\uff1a\u4f7f\u7528 ovirt-shell \u6216\u8005 API \u6765\u8fde\u63a5\u865a\u62df\u673a\u3002 \u83b7\u53d6\u865a\u62df\u673a\u5217\u8868\u53ca\u5176\u6240\u5728\u5bbf\u4e3b\u673a ovirtshell 1 2 3 4 5 6 7 8 9 10 11 12 # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api -E \"list vms\" id : 124e8020-c9d7-4e86-81e1-0d4e28ff1cd4 name : aaa # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api -E \"show vm aaa\" id : 124e8020-c9d7-4e86-81e1-0d4e28ff1cd4 name : aaa ... display-address : 192.168.10.100 ... display-port : 5912 display-secure_port : 5913 ... restapi 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # curl -u admin@internal:admin https://192.168.10.100/api/vms | less <name>aaa</name> <description></description> ... <display> <type>spice</type> <address>192.168.10.100</address> <port>5912</port> <secure_port>5913</secure_port> <monitors>1</monitors> <single_qxl_pci>false</single_qxl_pci> <allow_override>false</allow_override> <smartcard_enabled>false</smartcard_enabled> </display> ... \u83b7\u53d6/\u8bbe\u7f6e\u63a7\u5236\u53f0\u5bc6\u7801 ovirtshell 1 2 3 4 5 6 7 # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api -E \"action vm aaa ticket\" # [oVirt shell (connected)]# action vm aaa ticket status-state : complete ticket-expiry: 7200 ticket-value : MfY9P5kpmNpw vm-id : 124e8020-c9d7-4e86-81e1-0d4e28ff1cd4 restapi 1 2 3 4 5 6 7 8 9 10 11 12 # curl -k -u admin@internal:admin https://192.168.10.100/api/vms/124e8020-c9d7-4e86-81e1-0d4e28ff1cd4/ticket -X POST -H \"Content-type: application/xml\" -d '<action><ticket><expiry>120</expiry></ticket></action>' <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?> <action> <ticket> <value>jRUqhrks6JiT</value> <expiry>120</expiry> </ticket> ... <status> <state>complete</state> </status> </action> \u8fde\u63a5\u865a\u62df\u673a \u9664\u4e86\u4ee5\u4e0a\u83b7\u53d6\u7684\u663e\u793a\u7aef\u53e3\u3001\u5bbf\u4e3b\u673a IP\uff0c\u6211\u4eec\u9700\u8981\u989d\u5916\u83b7\u53d6\u4e00\u4e2a\u6839\u8bc1\u4e66\u3002 1 # wget http://192.168.10.100/ca.crt ovirt-shell 1 2 # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api \\ -E \"console aaa\" virt-viewer 1 # remote-viewer --spice-ca-file=ca.crt spice://192.168.10.100?port=5912&tls-port=5913&password=jRUqhrks6JiT \u4e3b\u673a hooks \u4e3b\u673a hooks \u4f4d\u4e8e\u5404\u4e2a\u5bbf\u4e3b\u673a\u4e0a\uff0c\u7528\u4e8e\u6269\u5c55 oVirt \u7684\u5e73\u53f0\u529f\u80fd\uff0c\u6bd4\u5982\u7f51\u7edc\u3001USB \u8bbe\u5907\u3001SRIOV \u7b49\u3002\u539f\u7406\u662f\u5728\u67d0\u4e00\u4e8b\u4ef6\u89e6\u53d1\u65f6\uff08\u6bd4\u5982\u865a\u62df\u673a\u542f\u52a8\u4e4b\u524d\uff09\uff0c\u4fee\u6539 libvirt \u542f\u52a8 XML \u6587\u4ef6\u3001\u73af\u5883\u53d8\u91cf\u6216\u8005\u4e3b\u673a\u914d\u7f6e\uff0c\u4ece\u800c\u6539\u53d8 qemu \u7684\u542f\u52a8\u53c2\u6570\u3002 \u66f4\u591a hooks \u5185\u5bb9\u8bf7\u53c2\u8003 vdsm-hooks \u3002 \u793a\u4f8b\uff1a\u4f7f\u7528 libvirt \u5185\u90e8\u7f51\u7edc \u51c6\u5907\u6240\u9700\u6587\u4ef6\u3002 \u62f7\u8d1d extnet_vnic.py \u81f3/usr/libexec/vdsm/hooks/before_vm_start/\uff0c\u4e0d\u8981\u5fd8\u8bb0\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\u3002 \u67e5\u770b\uff0c\u6dfb\u52a0 libvirt \u7f51\u7edc\u3002 1 # virsh net-list \u5728 extnet_vnic.py \u6587\u4ef6\u4e2d newnet = os.environ.get('extnet') \u524d\u4e00\u884c\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801\uff0c\u66ff\u6362\u5176\u4e2d\u7684 default \u4e3a\u8981\u4f7f\u7528\u7684 libvirt \u7f51\u7edc\uff0c \u5176\u4ed6\u7684 hooks \u811a\u672c\u591a\u6570\u53ef\u4ee5\u8fd9\u6837\u4fee\u6539\uff0c\u4e5f\u53ef\u4ee5\u5728 engine-config \u7684 CustomProperty \u4e2d\u6307\u5b9a \uff1a 1 2 3 4 # \u6ce8\u610f\u6b64\u5904\u4f7f\u7528\u53cc\u5f15\u53f7 params = \"default\" # \u540c\u4e0a\u90e8\u5206\u7c97\u4f53\u5b57\uff0c\u56e0\u4e3a\u5927\u90e8\u5206hooks\u68c0\u67e5engine-config\u4e2d\u7684\u73af\u5883\u53d8\u91cf\uff0c\u7b80\u4fbf\u8d77\u89c1\uff0c\u6211\u76f4\u63a5\u5728hooks\u811a\u672c\u4e2d\u8bbe\u7f6e\u4e86\u73af\u5883\u53d8\u91cf os.environ.__setitem__(\"extnet\",params) \u865a\u62df\u673a\u4e00\u5b9a\u8981\u6dfb\u52a0\u7f51\u7edc\u914d\u7f6e\uff0c\u5426\u5219\u4f1a\u542f\u52a8\u5931\u8d25\uff0c\u5728\u865a\u62df\u673a\u542f\u52a8\u65f6\uff0c\u7b2c\u4e00\u4e2a\u7f51\u7edc\u914d\u7f6e\u6587\u4ef6\u4f1a\u88ab\u66ff\u6362\u4e3a default \u7f51\u7edc\u3002 ::::{note} \u5982\u679c\u5fd8\u8bb0\u4e86 libvirt \u5bc6\u7801\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u547d\u4ee4\u91cd\u7f6e\u3002 1 # saslpasswd2 -a libvirt root :::: \u7b2c\u4e09\u65b9\u754c\u9762 oVirt \u73b0\u5728\u81ea\u5e26\u7684 gwt \u754c\u9762\u5bf9\u6d4f\u89c8\u5668\u548c\u5ba2\u6237\u7684\u8981\u6c42\u8f83\u9ad8\uff0c\u6709\u4e00\u4e9b\u4eba\u7531\u4e8e\u8fd9\u4e2a\u539f\u56e0\u629b\u5f03\u5b83\u4f7f\u7528\u7b2c\u4e09\u65b9\u7684 web \u754c\u9762\uff0c\u53c2\u8003 oVirt Dash \u3001 ovirt sample-portals \u3002 \u4e3b\u673a\u7b56\u7565 \u53c2\u8003\u8fd9\u4e2a PDF \u3002\uff08\u6ca1\u8bb0\u9519\u7684\u8bdd\uff0c\u91cc\u9762\u90a3\u4e2a\u663e\u5361\u900f\u7a7f\u7684\u95ee\u9898\uff0c\u662f\u5f53\u521d\u6211\u95ee\u7684\u3002\u3002\uff09 \u793a\u4f8b\uff1a \u4f7f\u7528 virt-install \u5b89\u88c5\u7cfb\u7edf \u793a\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 # virt-install \\ --name centos7 \\ --ram 2048 \\ --disk path=/var/kvm/images/centos7.img,format=qcow2 \\ --vcpus 2 \\ --os-type linux \\ --os-variant rhel7 \\ --graphics none \\ --console pty,target_type=serial \\ --location 'http://mirrors.aliyun.com/centos/7/os/x86_64/' \\ --extra-args 'console=ttyS0,115200n8 serial' \u865a\u62df\u673a\u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9 oVirt 3.4 \u78c1\u76d8\u53ef\u4ee5\u8fdb\u884c\u5728\u7ebf\u6269\u5bb9\uff0c\u4f46\u662f\u5bf9\u4e8e\u78c1\u76d8\u5185\u7684\u6587\u4ef6\u7cfb\u7edf\u9700\u8981\u5355\u72ec\u652f\u6301\uff0c\u5728\u6b64\u5217\u51fa\u5e38\u7528 Linux \u4ee5\u53ca Windows \u6269\u5bb9\u65b9\u6cd5\u3002 Linux \u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9\uff08\u955c\u50cf\u6269\u5bb9\u540e\u64cd\u4f5c\uff09 \u5728\u955c\u50cf\u6269\u5bb9\u540e\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c\u3002 \u91cd\u5199\u5206\u533a\u8868 1 2 3 4 5 6 7 8 9 10 # fdisk /dev/sda > d > 3 > n > 3 > w \u7136\u540e # kpartprobe \u6216\u8005 # reboot \u5728\u7ebf\u6269\u5bb9\u6587\u4ef6\u7cfb\u7edf 1 # resize2fs /dev/sda3 Linux \u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9\uff08lvm\uff09 \u5728\u521b\u5efa\u597d\u4e00\u4e2a\u65b0\u7684\u5206\u533a\u6216\u8005\u4e00\u4e2a\u65b0\u7684\u78c1\u76d8\u540e\uff0c\u5c06\u65b0\u7a7a\u95f4(\u6bd4\u5982 10G)\u6dfb\u52a0\u5230 PV\uff0cVG\uff0c\u6269\u5bb9 LV\uff0c\u7136\u540e\u6269\u5bb9\u6587\u4ef6\u7cfb\u7edf\u3002 1 2 3 # vgextend vg_livecd /dev/sdb # lvextend /dev/vg_livecd/lv_root -L +10G # resize2fs /dev/vg_livecd/lv_root Linux \u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9\uff08libguestfs\uff09 \u5177\u4f53\u5185\u5bb9\u8bf7\u53c2\u8003 libguestfs site \u3002 \u68c0\u89c6\u78c1\u76d8 1 # virt-filesystem --all --long -h -a hda.img \u521b\u5efa\u5f85\u6269\u5bb9\u78c1\u76d8\u526f\u672c\uff0c\u540c\u65f6\u6269\u5bb9 10G\uff08\u5047\u8bbe\u539f\u78c1\u76d8\u5927\u5c0f\u4e3a 10G\uff09 \u5bf9\u4e8e RAW \u683c\u5f0f\uff1a 1 2 # truncate -r hda.img hda-new.img # truncate -s +10G hda-new.img \u5bf9\u4e8e QCOW2 \u7b49\u6709\u538b\u7f29\u683c\u5f0f\uff1a 1 # qemu-img create -f qcow2 -o preallocation=metadata hda-new.img 20G \u6269\u5c55\u5206\u533a\u5c3a\u5bf8 \u666e\u901a\u5206\u533a\u6269\u5c55\uff0c/boot \u5206\u533a\u6269\u5bb9 200M\uff0c\u5176\u4f59\u5168\u90e8\u7ed9/\u5206\u533a\uff1a 1 # virt-resize --resize /dev/sda1=+200M --expand /dev/sda2 hda.img hda-new.img LVM \u5206\u533a\u6269\u5c55\uff0c\u6269\u5bb9 lv_root \u903b\u8f91\u5377\uff1a 1 # virt-resize --expand /dev/sda2 --LV-expand /dev/vg_livecd/lv_root hda.qcow2 hda-new.qcow2 FAT/NTFS \u6269\u5bb9 XP \u4f7f\u7528 Paragon Partion Manager\uff1bWindows 7 \u5728\u78c1\u76d8\u7ba1\u7406\u4e2d\u5373\u53ef\u6269\u5bb9\u3002 P2V/V2P V2V \u5728\u6b64\u4ee5 ESXi \u8fc1\u79fb\u81f3 oVirt \u4e3a\u4f8b\u3002 \u5728 oVirt \u4e0a\u521b\u5efa\u4e00\u4e2a NFS \u5bfc\u51fa\u57df \u5b89\u88c5 libguestfs\uff0c\u5e76\u521b\u5efa.netrc \u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u4e3a ESXi \u7684\u767b\u9646\u4fe1\u606f\uff1a ~/.netrc 1 machine 192.168.1.135 login root password 1234567 \u5f00\u59cb\u8fc1\u79fb\uff0c\u786e\u4fdd ESXi \u7684\u865a\u62df\u673a\u5df2\u6b63\u5e38\u5173\u95ed\uff1a 1 2 3 # virt-v2v -ic esx://192.168.1.135/?no_verify=1 -o rhev -os 192.168.1.111:/export --network mgmtnet myvm myvm_myvm: 100% [====================================================]D 0h04m48s virt-v2v: myvm configured with virtio drivers. \u4ece\u5bfc\u51fa\u57df\u5bfc\u5165\u865a\u62df\u673a\u5e76\u8fd0\u884c\uff1a \u5bfc\u5165\u865a\u62df\u673a\uff1a ```{image} ../images/03-11.png :align: center 1 2 3 4 \u8fd0\u884c\u865a\u62df\u673a\uff1a ```{image} ../images/03-12.png :align: center P2V oVirt \u7684 P2V \u65b9\u5f0f\u6211\u6240\u77e5\u7684\u6709\u4e09\u79cd\uff0c\u4e00\u662f\u4f7f\u7528 VMWare \u7684 P2V \u5de5\u5177\u8f6c\u5316\u4e3a VM \u4ee5\u540e\uff0c\u518d\u901a\u8fc7 virt-v2v \u8f6c\u5316\u4e3a oVirt \u7684 VM\uff0c\u4e8c\u662f\u4f7f\u7528 clonezilla \u6216\u8005 ghost \u5236\u4f5c\u7cfb\u7edf\u540e\uff0c\u518d\u5c06\u5176\u5b89\u88c5\u5230 oVirt \u4e2d\uff0c\u4e09\u5219\u662f\u4f7f\u7528 virt-p2v \u5de5\u5177\u3002\u7b14\u8005\u5728\u6b64\u4f7f\u7528 virt-p2v \u5de5\u5177\u793a\u4f8b\uff0c\u6210\u6587\u65f6\u53ea\u5728 CentOS 6.5 \u4ee5\u4e0a\u7248\u672c\u6d4b\u8bd5\uff0cCentOS 7 \u672a\u6d4b\u8bd5\uff0cRHEL 7.1 \u4ee5\u4e0a\u6709\u6b64\u5de5\u5177\u3002 \u5728\u670d\u52a1\u5668\u7aef\u5b89\u88c5\u6240\u9700\u5305\uff1a 1 yum install -y virt-p2v virt-v2v \u5c06/usr/share/virt-v2v/\u4e2d\u7684 ISO \u6587\u4ef6 dd \u5230 U \u76d8\u6216\u8005\u70e7\u5f55\u5230\u5149\u76d8\uff0c\u7136\u540e\u5728\u8981\u8f6c\u5316\u7684\u673a\u5668\u4e0a\u542f\u52a8\u3002 \u4fee\u6539\u670d\u52a1\u5668\u7aef/etc/virt-v2v.conf\uff0c\u4fee\u6539 rhevm \u7684\u914d\u7f6e\uff0c\u5f62\u5982\uff1a 1 2 3 4 5 6 7 8 9 10 11 <virt-v2v> <profile name=\"rhev-sparse\"> <method>rhev</method> <storage format='qcow2' allocation='sparse'> nfs.example.com:/ovirt-export </storage> <network type=\"default\"> <network type=\"network\" name=\"ovirtmgmt\"/> </network> </profile> </virt-v2v> \u5f00\u59cb\u8f6c\u6362\uff08\u6211\u662f\u4f7f\u7528 libvirt \u7684 profile \u793a\u4f8b\uff09 ```{image} ../images/03-13.png :align: center ``` \u8f6c\u6362\u5b8c\u6210\u540e\u5173\u95ed\u8ba1\u7b97\u673a\uff0c\u5e76\u4fee\u6539\u865a\u62df\u673a\u7684\u914d\u7f6e\u4ee5\u5b8c\u5168\u9002\u5e94 OS\u3002 UI \u63d2\u4ef6 \u8be6\u7ec6\u5185\u5bb9\u8bf7\u53c2\u8003 oVirt \u5b98\u7f51\u5173\u4e8e UI \u63d2\u4ef6\u7684\u4ecb\u7ecd \u4ee5\u53ca\u9644\u5f55\u90e8\u5206\u5185\u5bb9\uff0c\u5728\u6b64\u6211\u4ec5\u4f7f\u7528 ShellInABox \u4e3e\u4f8b\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u5c06\u4e0a\u9762\u7684 libguestfs \u6269\u5bb9\u52a0\u8fdb\u6765\uff0c\u66f4\u591a UI Plugin \u8bf7 git clone git://gerrit.ovirt.org/samples-uiplugins.git \u3002 ShellInABox oVirt UI plugin \u5728\u5bbf\u4e3b\u673a\u4e0a\u5b89\u88c5 ShellInABox\u3002 1 2 # yum install shellinabox # chkconfig shellinaboxd on \u4fee\u6539 shellinabox \u914d\u7f6e OPTS \uff1a /etc/sysconfig/shellinaboxd 1 OPTS=\"--disable-ssl --service /:SSH\" \u62f7\u8d1d uiplugin \u6587\u4ef6\u5e76\u542f\u52a8\u670d\u52a1\u3002 1 2 3 4 # git clone git://gerrit.ovirt.org/samples-uiplugins.git # cp -r samples-uiplugins/shellinabox-plugin/* /usr/share/ovirt-engine/ui-plugins/ # service shellinaboxd start # service ovirt-engine restart ```{image} ../images/03-09.png :align: center ``` :::{note} shellinabox \u63d2\u4ef6\u94fe\u63a5\u95ee\u9898 \u7531\u4e8e 3.3 \u5230 3.4 \u4e4b\u540e\u94fe\u63a5\u7684\u53d8\u5316\uff0cshellinabox.json \u4e2d\u7684 /webadmin/webadmin/plugin/ShellBoxPlugin/start.html \u9700\u8981\u66ff\u6362\u4e3a plugin/ShellBoxPlugin/start.html \u3002 ::: :::{note} shellinabox \u7684 root \u767b\u9646\u95ee\u9898 echo -e \"pts0npts1npts2\" >> /etc/securetty ::: \u4f7f\u7528 SysPrep/Cloud-Init \u91cd\u7f6e\u865a\u62df\u673a\u4fe1\u606f \u53c2\u8003 https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Virtualization/3.4/html/Administration_Guide/sect-Sealing_Templates_in_Preparation_for_Deployment.html . \u521d\u59cb\u5316 Redhat \u7cfb\u5217 Linux 1 touch /.unconfigured rm -i /etc/ssh/ssh host * echo \"HOSTNAME=localhost.localdomain\" >> /etc/sysconfig/network rm -i /etc/udev/rules.d/70-persistent* 1 2 3 4 5 6 7 \u5220\u9664 */etc/sysconfig/network-scripts/ifcfg-** \u6587\u4ef6\u4e2d\u7684 **HWADDR=** \u5b57\u6bb5\uff0c\u5220\u9664 */var/log/** \u3001 */root/*.log* \uff0c\u7136\u540e\u5173\u673a\u5373\u53ef\u3002 \u4fee\u6539\u5bc6\u7801 ```{code} # virt-sysprep --root-password password:123456 -a os.img \u521d\u59cb\u5316 Windows 7 \u4f7f\u7528http://www.drbl-winroll.org\u5de5\u5177\u6279\u91cf\u4fee\u6539\u3002 \u4f7f\u7528\u4f4d\u4e8e C:\\Windows\\system32\\sysprep \u76ee\u5f55\u4e0b\u7684\u5de5\u5177\u3002 ```{image} ../images/03-10.jpg :align: center ``` \u4e0e\u5176\u4ed6\u5e73\u53f0\u96c6\u6210\u3001\u4e0e\u8ba4\u8bc1\u670d\u52a1\u5668\u96c6\u6210 oVirt \u5e73\u53f0\u76ee\u524d\u53ef\u4ee5\u4f7f\u7528 Foreman\uff0cOpenStack Network\uff0cOpenStack Image \u7684\u90e8\u5206\u529f\u80fd\uff0c\u5177\u4f53\u5b9e\u65bd\u8bf7\u53c2\u9605\u9644\u5f55\u4e00\u5185\u5bb9\u3002 \u4e0e\u8ba4\u8bc1\u670d\u52a1\u5668\u96c6\u6210\u65f6\u5f88\u6709\u53ef\u80fd\u9047\u5230\u5404\u79cd\u95ee\u9898\uff0c\u6bd4\u5982\u4e0e AD \u96c6\u6210\u65f6\u4e0d\u80fd\u4f7f\u7528 Administrator \u7528\u6237\u8fdb\u884c engine-manage-domains\uff0c\u4e0e IPA \u96c6\u6210\u65f6\u9700\u8981\u4fee\u6539 minss \u4e4b\u7c7b\u7684\u53c2\u6570\uff0c\u4e0e LDAP \u96c6\u6210\u65f6\u9700\u8981 Kerberos \u6216\u8005\u4f7f\u7528 3.5 \u7248\u672c\u4e2d\u7684 aaa \u8ba4\u8bc1\u63d2\u4ef6\u3002 \u540e\u7aef\uff08libvirt/qemu/kernel\uff09\u4f18\u5316 \u5982\u679c\u4f60\u89c9\u5f97\u73b0\u6709\u5e73\u53f0\u7684\u6027\u80fd\u8fbe\u4e0d\u5230\u9884\u671f\uff0c\u6216\u8005\u6709\u5176\u4ed6\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u65b9\u9762\u8fdb\u884c\u8c03\u8282\u6216\u4f18\u5316\u3002 qemu \uff1a \u6211\u5199\u4e86 \u4e00\u7cfb\u5217 qemu \u7684\u811a\u672c \uff0c\u4f60\u53ef\u4ee5\u8c03\u8282\u91cc\u9762\u7684\u53c2\u6570\u76f4\u63a5\u542f\u52a8\u865a\u62df\u673a\u8fdb\u884c\u8c03\u8bd5\u6216\u8005\u4f18\u5316\u3002 libvirt \uff1a libvirt \u7684\u76ee\u7684\u662f\u7edf\u4e00\u5404\u79cd\u865a\u62df\u5316\u540e\u7aef\u7684\u8c03\u7528\u65b9\u5f0f\uff08kvm/xen/lxc/OpenVZ//VirtualBox/VMWare/Hyper-V \u7b49\u7b49\uff09\uff0c\u4e3b\u8981\u4e00\u4e2a\u7279\u6027\u662f\u7528\u7edf\u4e00\u7684\u63cf\u8ff0\u6587\u4ef6\u6765\u5b9a\u4e49\u865a\u62df\u673a\u914d\u7f6e\uff08xml \u6587\u4ef6\uff09\uff0c\u5728 Linux \u4e0b\u4f60\u53ef\u4ee5\u4f7f\u7528 Virt Manager \u8fdb\u884c\u8c03\u8bd5\uff0c\u76f8\u5173\u6587\u6863\u53c2\u8003 libvirt ref \u3002 kernel \uff1a \u57fa\u672c\u4e0a\u5927\u90e8\u5206\u7684\u5185\u6838\u76f8\u5173\u914d\u7f6e\u90fd\u53ef\u4ee5\u901a\u8fc7 /sys \u6216\u8005 /proc \u8fdb\u884c\u8c03\u8282\uff0c\u800c\u9488\u5bf9\u5185\u6838\u6240\u8c13\u7684\u201c\u4f18\u5316\u201d\uff0c\u5728\u975e\u5927\u89c4\u6a21\u90e8\u7f72\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u4f18\u52bf\u5f88\u96be\u4f53\u73b0\u51fa\u6765\uff0c\u8fd8\u6709\u4e00\u65b9\u9762\uff0c\u76ee\u524d\u7684 KVM \u6548\u7387\uff0cCPU\u3001\u5185\u5b58\u7ba1\u7406\u3001\u7f51\u7edc\u7b49\u65b9\u9762\u90fd\u6bd4\u8f83\u4f18\u79c0\uff0c\u5728 I/O \u65b9\u9762\u8fd8\u6709\u90e8\u5206\u4e0d\u8db3\uff0c\u53ef\u4ee5\u5728 VIRTIO \u4e0a\u8fdb\u884c\u76f8\u5173\u7684\u4f18\u5316\uff0c\u8fd8\u6709\u5f00\u542f HugePage \u7b49\u64cd\u4f5c\u3002","title":"\u7b2c\u4e09\u7ae0 \u5408\u9002\u7684\u865a\u62df\u5316\u5e73\u53f0"},{"location":"inthecloud/ch03/#_1","text":"","title":"\u7b2c\u4e09\u7ae0 \u5408\u9002\u7684\u865a\u62df\u5316\u5e73\u53f0"},{"location":"inthecloud/ch03/#31","text":"Welcome to the core! \u55ef\uff0c\u7b14\u8005\u64b8\u4e86\u4e2a OpenStack \u548c k8s \u7684\u90e8\u7f72 \u811a\u672c \uff0cPXE \u54e6\u3002 \u4e91\u8ba1\u7b97\u76ee\u524d\u4e3b\u6d41\u5b9e\u73b0\u6709 SaaS\uff08Software-as-a-service\uff09\u3001PaaS\uff08Platform-as-a-service\uff09\u548c IaaS\uff08Infrastructure-as-a-service\uff09\u3002IaaS \u548c PaaS \u90fd\u7b97\u4f5c\u57fa\u7840\u4ef6\uff0cSaaS \u53ef\u4ee5\u4e0e\u57fa\u7840\u4ef6\u81ea\u7531\u7ec4\u5408\u6216\u8005\u5355\u72ec\u4f7f\u7528\u3002 \u865a\u62df\u5316\u6280\u672f\u5df2\u7ecf\u5f88\u53d7\u91cd\u89c6\u800c\u4e14\u88ab\u63a8\u5230\u4e86\u4e00\u4e2a\u6d6a\u5c16\u3002\u5982\u4eca\u8bf8\u591a\u5f00\u6e90\u865a\u62df\u5316\u5e73\u53f0\uff0c\u6bd4\u5982 XenServer\u3001CloudStack\u3001OpenStack\u3001Eucalyptus\u3001oVirt\u3001OpenVZ\u3001Docker\u3001LXC \u7b49\uff0c\u6211\u4eec\u90fd\u770b\u82b1\u4e86\u773c\uff0c\u4e9b\u8bb8\u614c\u4e71\u4e0d\u77e5\u54ea\u4e2a\u9002\u5408\u81ea\u5df1\u4e86\u3002 \u5404\u5e73\u53f0\u5b9e\u73b0\u65b9\u5f0f\uff1a\u5168\u865a\u62df\u5316\uff0c\u534a\u865a\u62df\u5316\uff0c\u5e94\u7528\u865a\u62df\u5316\u3002 IaaS \u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u7efc\u5408\u6765\u8bf4\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a \u865a\u62df\u5316\uff1a\u865a\u62df\u5316\u4f5c\u4e3a\u4e91\u8ba1\u7b97\u5e73\u53f0\u7684\u6838\u5fc3\uff0c\u662f\u8d44\u6e90\u5229\u7528\u7684\u4e3b\u8981\u5f62\u5f0f\u4e4b\u4e00\u3002\u7f51\u7edc\u3001\u5b58\u50a8\u3001CPU \u4e43\u81f3 GPU \u7b49\u4e3b\u8981\u901a\u8fc7\u865a\u62df\u4e3b\u673a\u8fdb\u884c\u5b9e\u4f53\u5316\u3002 \u5206\u5e03\u5f0f\uff1a\u5206\u5e03\u5f0f\u53ef\u5229\u7528\u5171\u4eab\u7684\u5b58\u50a8\uff0c\u901a\u8fc7\u7f51\u7edc\u5c06\u8d44\u6e90\u8fdb\u884c\u6574\u5408\uff0c\u662f\u5b9e\u73b0\u8d44\u6e90\u5316\u7684\u5fc5\u5907\u6761\u4ef6\u3002 \u9ad8\u53ef\u7528\uff1a\u4e8e\u89c4\u6a21\u5e9e\u5927\u7684\u4e91\u5e73\u53f0\uff0c\u63d0\u4f9b\u5b58\u50a8\u3001\u7ba1\u7406\u8282\u70b9\u3001\u91cd\u8981\u670d\u52a1\u7684\u9ad8\u5ea6\u53ef\u7528\u6027\u662f\u5341\u5206\u5fc5\u8981\u7684\u3002\u7b14\u8005\u5728\u5199\u8fd9\u7bc7\u6587\u7ae0\u65f6\uff0coVirt 3.4 \u5df2\u7ecf\u53ef\u4ee5\u505a\u5230\u7ba1\u7406\u8282\u70b9\u7684\u9ad8\u5ea6\u53ef\u7528\u3002 \u517c\u5bb9\u6027\uff1a\u4e91\u8ba1\u7b97\u5e73\u53f0\u4f17\u591a\uff0c\u5404\u5bb6\u6709\u5404\u5bb6\u7684\u7279\u70b9\uff0c\u540c\u4e00\u6570\u636e\u4e2d\u5fc3\u90e8\u7f72\u4e0d\u540c\u7684\u5e73\u53f0\u7684\u53ef\u80fd\u6027\u6781\u5927\uff0c\u56e0\u6b64\uff0c\u4e3b\u8981\u670d\u52a1\uff08\u6bd4\u5982\u865a\u62df\u7f51\u7edc\u3001\u5b58\u50a8\u3001\u865a\u673a\u7b49\uff09\u8981\u6709\u4e00\u5b9a\u517c\u5bb9\u6027\uff0c\u6bd4\u5982 oVirt \u53ef\u4ee5\u5229\u7528 OpenStack \u7684 Nouveau \u63d0\u4f9b\u7684\u865a\u62df\u7f51\u7edc\u3001Foreman \u53ef\u4ee5\u65b9\u4fbf\u5730\u5728 oVirt \u4e0a\u90e8\u7f72\u65b0\u673a\u5668\u7b49\u3002\u53e6\u5916\uff0c\u4e5f\u6709 DeltaCloud\u3001libvirt \u7b49 API\uff0c\u7528\u6237\u53ef\u4ee5\u5229\u7528\u5b83\u4eec\u81ea\u7531\u5730\u5b9e\u73b0\u81ea\u5df1\u7684\u4e91\u7efc\u5408\u7ba1\u7406\u5de5\u5177\u3002 \u8d44\u6e90\u6c60\u5316\uff1a\u7f51\u7edc\u3001\u5b58\u50a8\u3001CPU \u6216\u8005 GPU \u53ef\u4ee5\u7efc\u5408\u6216\u8005\u5355\u72ec\u5212\u5206\u8d44\u6e90\u6c60\uff0c\u901a\u8fc7\u914d\u989d\u8fdb\u884c\u5206\u914d\uff0c\u4ece\u800c\u4fdd\u8bc1\u5176\u5408\u7406\u5229\u7528\u3002 \u5b89\u5168\u6027\uff1a\u73b0\u4ee3\u4f01\u4e1a\u5bf9\u4e8e\u5b89\u5168\u6027\u7684\u8981\u6c42\u5df2\u7ecf\u5341\u5206\u82db\u523b\uff0c\u9664\u53bb\u4f20\u7edf\u6570\u636e\u52a0\u5bc6\u3001\u8bbf\u95ee\u63a7\u5236\uff0c\u751a\u81f3\u5bf9\u4e8e\u793e\u4f1a\u5de5\u7a0b\u4e5f\u8981\u6709\u4e00\u5b9a\u9632\u62a4\u80fd\u529b\uff1b\u7528\u6237\u6570\u636e\u5177\u6709\u5bf9\u975e\u4f01\u4e1a\u7ba1\u7406\u5458\u5177\u6709\u9632\u62a4\u6027\u80fd\uff0c\u5373\u4f7f\u5c06\u865a\u62df\u673a\u78c1\u76d8\u6587\u4ef6\u62f7\u8d1d\u51fa\u6765\u4e5f\u4e0d\u80fd\u76f4\u63a5\u83b7\u53d6\u5176\u5185\u5bb9\u3002 \u9700\u6c42\u5bfc\u5411\u6027\uff1a\u5728\u8ba1\u7b97\u6c34\u5e73\u4e0a\uff0c\u4f18\u8d28\u8d44\u6e90\u6700\u5148\u63d0\u4f9b\u7ed9\u91cd\u8981\u670d\u52a1\uff1b\u670d\u52a1\u6c34\u5e73\u4e0a\uff0c\u5e73\u53f0\u5177\u6709\u53ef\u5b9a\u5236\u80fd\u529b\u3002","title":"3.1 \u865a\u62df\u5316\u5e73\u53f0\u7b80\u4ecb"},{"location":"inthecloud/ch03/#ovirt","text":"oVirt \u76ee\u524d\u4e24\u79cd\u90e8\u7f72\u65b9\u5f0f\uff1a \u90e8\u7f72\u65b9\u5f0f \u793a\u4f8b \u7ba1\u7406\u72ec\u5360\u4e00\u53f0\u7269\u7406\u673a .. image:: ../images/03-01.png \u9ad8\u53ef\u7528\u7ba1\u7406\u5f15\u64ce .. image:: ../images/03-02.png \u5e38\u89c1\u540d\u6b21 \u7ba1\u7406\u5f15\u64ce\uff08engine\uff09 \uff1a\u63d0\u4f9b\u5e73\u53f0 web \u7ba1\u7406\u3001api\uff0c\u5404\u79cd\u6269\u5c55\u670d\u52a1\uff0cvdsm \u4ee5\u53ca libvirt \u670d\u52a1\u7684\u91cd\u8981\u8282\u70b9\u3002 \u5bbf\u4e3b\u673a\uff08node/host\uff09 \uff1a\u4e3a\u5e73\u53f0\u7684\u7684\u529f\u80fd\u63d0\u4f9b\u652f\u6301\uff0c\u4e3b\u8981\u662f\u865a\u62df\u5316\u80fd\u529b\u3002 \u6570\u636e\u4e2d\u5fc3\uff08data center\uff09 \uff1a\u4ee5\u6570\u636e\u5171\u4eab\u65b9\u5f0f\uff08Shared/Local\uff09\u5212\u5206\u7684\u5bb9\u5668\uff0c\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u96c6\u7fa4\u3002 \u5b58\u50a8\u57df\uff08storage domain\uff09 \uff1a\u5e73\u53f0\u6240\u4f9d\u8d56\u7684\u5404\u79cd\u5b58\u50a8\u7a7a\u95f4\u3002 \u903b\u8f91\u7f51\u7edc\uff08logic network\uff09 \uff1a\u7269\u7406\u7f51\u7edc\u6216\u8005\u865a\u62df\u7f51\u7edc\u7684\u62bd\u8c61\u4ee3\u8868\u3002 \u6c60\uff08pool\uff09 \uff1a\u7528\u4e8e\u6279\u91cf\u521b\u5efa\u865a\u62df\u673a\u3002 \u96c6\u7fa4\u7b56\u7565\uff08cluster policy\uff09 \uff1a\u5bbf\u4e3b\u673a/\u865a\u62df\u673a\u8fd0\u884c\u6216\u8005\u8fc1\u79fb\u65f6\u6240\u9075\u5faa\u7684\u539f\u5219\u3002 DWH/Reports \uff1a\u53ef\u4ee5\u67e5\u770b\u5f53\u524d\u72b6\u6001\u62a5\u544a\uff08\u9700\u8981 ovirt-engine-reports\uff09\u3002 \u53ef\u4fe1\u670d\u52a1 \uff1a \u9700\u8981 OpenAttestation \u3002 \u7535\u6e90\u7ba1\u7406 \uff1a \u5982\u679c\u6ca1\u6709\u7269\u7406\u7535\u6e90\u63a7\u5236\u5668\uff0c\u53ef\u4ee5\u76f4\u63a5\u6307\u5b9a\u67d0\u4e00\u53f0\u4e3b\u673a\u4e3a\u4ee3\u7406\u673a\uff0c\u4ee5\u6784\u5efa\u66f4\u7a33\u5065\u7684\u96c6\u7fa4\u3002","title":"oVirt"},{"location":"inthecloud/ch03/#openstack","text":"OpenStack \u4e91\u8ba1\u7b97\u4e2d\u5f15\u5165\u7684\u6982\u5ff5\u5df2\u7ecf\u5148\u5165\u4e3a\u4e3b\uff0c\u8ba9\u56fd\u5185\u8bb8\u591a\u8f83\u665a\u63a5\u89e6\u4e91\u8ba1\u7b97\u7684\u4eba\u8ba4\u4e3a\u8fd9\u5c31\u662f\u6807\u51c6\u6982\u5ff5\u3002 \u66f4\u591a\u5185\u5bb9\u8bf7\u53c2\u8003\u9644\u5f55\u4e00\u3002","title":"OpenStack"},{"location":"inthecloud/ch03/#cloudstack","text":"\u53ef\u80fd\u4e5f\u4e0d\u9519\uff0c\u6211\u6ca1\u7528\u8fc7\u3002","title":"CloudStack"},{"location":"inthecloud/ch03/#32-ovirt","text":"\u642d\u5efa oVirt \u5e73\u53f0\u7684\u6b65\u9aa4\uff1a \u5b89\u88c5 Redhat \u7c7b\u64cd\u4f5c\u7cfb\u7edf\uff08Redhat\u3001CentOS\u3001Fedora\uff09 \u4ece yum \u5b89\u88c5 oVirt\uff0c\u5e76\u6267\u884c engine-setup\uff0c\u6216\u8005\u76f4\u63a5\u4ece oVirt \u63d0\u4f9b\u7684 iso \u8fdb\u884c\u5b89\u88c5 \u6dfb\u52a0\u5bbf\u4e3b\u673a \u6dfb\u52a0\u5b58\u50a8\u57df \u521b\u5efa\u865a\u62df\u673a","title":"3.2 \u642d\u5efa oVirt \u7ba1\u7406\u5f15\u64ce"},{"location":"inthecloud/ch03/#_2","text":"\u6240\u6709\u673a\u5668\u7684 SELINUX \u90fd\u8bbe\u7f6e\u4e3a permissive\u3002 /etc/selinux/config 1 SELINUX=permissive 1 # setenfoce permissive \u5982\u6709\u9700\u8981\uff0c\u6e05\u9664 iptables \u89c4\u5219\u3002 1 2 # iptables -F # service iptables save \u6bcf\u53f0\u673a\u5668\u4e0a\u90fd\u8981\u6dfb\u52a0\u4f5c\u4e3a\u865a\u62df\u673a\u8fd0\u884c\u7684 engine \u7684 FQDN\uff0c\u6b64\u5904\u4e3a ha.example.com\u3002 1 # echo -e '192.168.10.100\\tha.example.com' >> /etc/hosts \u5b58\u50a8\u53ef\u4ee5\u4f7f\u7528\u4e4b\u524d\u7684 glusterfs\uff0c\u65b9\u5f0f\u4e3a NFS_V3\uff0c\u6ce8\u610f\u5c06 brick \u7684\u6743\u9650\u8bbe\u7f6e\u4e3a vdsm.kvm \u6216\u8005 36:36\u3002 :::{note} \u666e\u901a NFS \u670d\u52a1\u5668\u8bbe\u7f6e \u56e0\u4e3a\u8003\u8651\u5230 NFS4 \u7684\u6743\u9650\u914d\u7f6e\u8f83\u4e3a\u590d\u6742\uff0c\u63a8\u8350 NFS \u4f7f\u7528 V3\uff0c\u4fee\u6539 nfsmount.conf \u4e2d\u7684 Version \u4e3a 3\u3002 ::: 1 2 3 4 5 # gluster volume create gluster-vol1 replica 2 \\ gs1.example.com:/gluster_brick0 gs2.example.com:/gluster_brick0 \\ gs3.example.com:/gluster_brick0 gs4.example.com:/gluster_brick0 \\ gs1.example.com:/gluster_brick1 gs2.example.com:/gluster_brick1 \\ gs3.example.com:/gluster_brick1 gs4.example.com:/gluster_brick1 force \u7531\u4e8e\u7ba1\u7406\u7aef\u4ee5\u53ca\u8282\u70b9\u7684\u7f51\u7edc\u670d\u52a1\u4f9d\u8d56\u4e8e network \u800c\u975e NetworkManager \uff0c\u6211\u4eec\u9700\u8981\u542f\u7528\u524d\u8005\u7981\u7528\u540e\u8005\uff0c\u5728\u6bcf\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u90fd\u8fdb\u884c\u5982\u4e0b\u7c7b\u4f3c\u914d\u7f6e\u4fee\u6539\u7f51\u7edc\u3002 /etc/sysconfig/network-scripts/ifcfg-eth0 1 2 3 4 5 6 7 8 9 NAME=eth0 DEVICE=eth0 ONBOOT=yes BOOTPROTO=static # \u6ce8\u610f\u4fee\u6539\u6b64\u5904\u7684IP IPADDR=192.168.10.101 NETMASK=255.255.255.0 GATEWAY=192.168.10.1 DNS1=192.168.10.1 1 2 3 # chkconfig NetworkManager off # chkconfig network on # service NetworkManager stop; service network restart","title":"\u7cfb\u7edf\u51c6\u5907"},{"location":"inthecloud/ch03/#repo","text":":::{note} oVirt3.4.2 \u7279\u522b\u8bf4\u660e 2014 \u5e74\u516d\u4e03\u6708\u7684\u521d\u6b21\u5b89\u88c5 oVirt \u7684\u7528\u6237\u53ef\u80fd\u4f1a\u9047\u5230\u6dfb\u52a0\u5bbf\u4e3b\u673a\u5931\u8d25\u7684\u95ee\u9898\uff0c\u6682\u65f6\u89e3\u51b3\u529e\u6cd5\u4e3a\u5378\u8f7d python-pthreading-0.1.3-1 \u53ca\u4ee5\u540e\u7684\u7248\u672c\uff0c\u5b89\u88c5\u8001\u7248\u672c\uff0c\u6bd4\u5982 ftp://ftp.icm.edu.pl/vol/rzm2/linux-fedora/linux/epel/6/i386/python-pthreading-0.1.3-0.el6.noarch.rpm \uff0c\u518d\u5c1d\u8bd5\u5b89\u88c5 vdsm \u5e76\u6dfb\u52a0\u5bbf\u4e3b\u673a\u3002 ::: \u4f7f\u7528 rpm\uff1a 1 2 # yum localinstall http://plain.resources.ovirt.org/releases/ovirt-release/ovirt-release34.rpm # yum install ovirt-hosted-engine-setup \u6216\u8005\u624b\u52a8\u6dfb\u52a0\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 [ovirt-stable] name=Latest oVirt Releases baseurl=http://resources.ovirt.org/releases/stable/rpm/EL/$releasever/ enabled=1 skip_if_unavailable=1 gpgcheck=0 [ovirt-3.4-stable] name=Latest oVirt 3.4.z Releases baseurl=http://resources.ovirt.org/releases/3.4/rpm/EL/$releasever/ enabled=1 skip_if_unavailable=1 gpgcheck=0 [epel] name=Extra Packages for Enterprise Linux 6 - $basearch #baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&arch=$basearch failovermethod=priority enabled=1 gpgcheck=0 [ovirt-glusterfs-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/$basearch/ enabled=1 skip_if_unavailable=1 gpgcheck=0 [ovirt-glusterfs-noarch-epel] name=GlusterFS is a clustered file-system capable of scaling to several petabytes. baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/noarch enabled=1 skip_if_unavailable=1 gpgcheck=0 \u4ece\u4e0b\u9762\u4e24\u79cd\u65b9\u5f0f\u4e2d\u9009\u62e9\u4e4b\u4e00\u8fdb\u884c\u642d\u5efa {ref} label2 {ref} label3 (label2)=","title":"\u6dfb\u52a0 repo"},{"location":"inthecloud/ch03/#ovirt_1","text":"\u7b14\u8005\u5199\u6b64\u6587\u65f6 oVirt \u5df2\u7ecf\u66f4\u65b0\u5230 3.4\u3002 \u5728\u6b64\uff0c\u6211\u4eec\u4f1a\u7528\u5230\u4e4b\u524d\u521b\u5efa\u7684 distributed-replicated \u5b58\u50a8\uff0c\u8fd9\u6837\u53ef\u7528\u4fdd\u8bc1\u7cfb\u7edf\u670d\u52a1\u7684\u9ad8\u5ea6\u53ef\u7528\u6027\u6709\u6240\u63d0\u9ad8\u3002 \u5bf9\u4e8e\u521d\u6b21\u4f7f\u7528 oVirt \u7684\u7528\u6237\uff0c\u5efa\u8bae\u4f7f\u7528\u6b64\u79cd\u642d\u5efa\u65b9\u5f0f\uff0c \u592a\u6298\u817e\u7684\u8bdd\u5c31\u5413\u8d70\u597d\u591a\u76ee\u6807\u8bfb\u8005\u4e86 \u3002 \u4f7f\u7528\u4e4b\u524d\u7684\u56db\u53f0\u673a\u5668\uff0c\u5206\u522b\u4e3a gs1.example.com\uff0cgs2.example.com\uff0cgs3.example.com \u548c gs4.example.com\uff0c\u5176\u4e2d\uff0c\u5c06 gs1 \u4f5c\u4e3a\u7ba1\u7406\u673a\u5b89\u88c5 ovirt-engine\uff0c\u5176\u4f59\u4e09\u53f0\u4f5c\u4e3a\u8282\u70b9\uff08node\uff09\uff0c\u5b58\u50a8\u4f7f\u7528\u5df2\u7ecf\u521b\u5efa\u597d\u7684 glusterfs\u3002 ```{image} ../images/03-03.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 \u5728 gs1 \u4e0a\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u3002 ```{code} # yum install ovirt-engine # engine-setup --offline [ INFO ] Stage: Initializing [ INFO ] Stage: Environment setup Configuration files: ['/etc/ovirt-engine-setup.conf.d/10-packaging.conf'] Log file: /var/log/ovirt-engine/setup/ovirt-engine-setup-20140508054649.log Version: otopi-1.2.0 (otopi-1.2.0-1.el6) [ INFO ] Stage: Environment packages setup [ INFO ] Stage: Programs detection [ INFO ] Stage: Environment setup [ INFO ] Stage: Environment customization --== PRODUCT OPTIONS ==-- --== PACKAGES ==-- --== NETWORK CONFIGURATION ==-- Host fully qualified DNS name of this server [gs1.example.com]: Setup can automatically configure the firewall on this system. Note: automatic configuration of the firewall may overwrite current settings. Do you want Setup to configure the firewall? (Yes, No) [Yes]: The following firewall managers were detected on this system: iptables Firewall manager to configure (iptables): iptables [ INFO ] iptables will be configured as firewall manager. --== DATABASE CONFIGURATION ==-- Where is the Engine database located? (Local, Remote) [Local]: Setup can configure the local postgresql server automatically for the engine to run. This may conflict with existing applications. Would you like Setup to automatically configure postgresql and create Engine database, or prefer to perform that manually? (Automatic, Manual) [Automatic]: --== OVIRT ENGINE CONFIGURATION ==-- Application mode (Both, Virt, Gluster) [Both]: Default storage type: (NFS, FC, ISCSI, POSIXFS) [NFS]: Engine admin password: Confirm engine admin password: --== PKI CONFIGURATION ==-- Organization name for certificate [example.com]: --== APACHE CONFIGURATION ==-- Setup can configure apache to use SSL using a certificate issued from the internal CA. Do you wish Setup to configure that, or prefer to perform that manually? (Automatic, Manual) [Automatic]: Setup can configure the default page of the web server to present the application home page. This may conflict with existing applications. Do you wish to set the application as the default page of the web server? (Yes, No) [Yes]: --== SYSTEM CONFIGURATION ==-- Configure WebSocket Proxy on this machine? (Yes, No) [Yes]: Configure an NFS share on this server to be used as an ISO Domain? (Yes, No) [Yes]: no --== MISC CONFIGURATION ==-- --== END OF CONFIGURATION ==-- [ INFO ] Stage: Setup validation --== CONFIGURATION PREVIEW ==-- Engine database name : engine Engine database secured connection : False Engine database host : localhost Engine database user name : engine Engine database host name validation : False Engine database port : 5432 PKI organization : example.com Application mode : both Firewall manager : iptables Update Firewall : True Configure WebSocket Proxy : True Host FQDN : gs1.example.com Datacenter storage type : nfs Configure local Engine database : True Set application as default page : True Configure Apache SSL : True Please confirm installation settings (OK, Cancel) [OK]: ok [ INFO ] Stage: Transaction setup [ INFO ] Stopping engine service [ INFO ] Stopping websocket-proxy service [ INFO ] Stage: Misc configuration [ INFO ] Stage: Package installation [ INFO ] Stage: Misc configuration [ INFO ] Initializing PostgreSQL [ INFO ] Creating PostgreSQL 'engine' database [ INFO ] Configuring PostgreSQL [ INFO ] Creating Engine database schema [ INFO ] Creating CA [ INFO ] Configuring WebSocket Proxy [ INFO ] Generating post install configuration file '/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf' [ INFO ] Stage: Transaction commit [ INFO ] Stage: Closing up --== SUMMARY ==-- SSH fingerprint: 1B:FD:08:A2:FD:83:20:8A:65:F5:0D:F6:CB:BF:46:C7 Internal CA 28:7E:D6:6B:F7:F2:6C:B5:60:27:44:C3:7F:3C:22:63:E5:68:DD:F4 Web access is enabled at: http://gs1.example.com:80/ovirt-engine https://gs1.example.com:443/ovirt-engine Please use the user \"admin\" and password specified in order to login into oVirt Engine --== END OF SUMMARY ==-- [ INFO ] Starting engine service [ INFO ] Restarting httpd [ INFO ] Generating answer file '/var/lib/ovirt-engine/setup/answers/20140508054842-setup.conf' [ INFO ] Stage: Clean up Log file is located at /var/log/ovirt-engine/setup/ovirt-engine-setup-20140508054649.log [ INFO ] Stage: Pre-termination [ INFO ] Stage: Termination [ INFO ] Execution of setup completed successfully \u81f3\u6b64\uff0c\u7ba1\u7406\u8282\u70b9\u5b89\u88c5\u7ed3\u675f\uff0c\u53c2\u8003 {ref} label1 \u52a0\u5165\u8282\u70b9\u4ee5\u53ca\u5b58\u50a8\u57df\u3002 (label3)=","title":"\u642d\u5efa\u666e\u901a oVirt \u865a\u62df\u5316\u5e73\u53f0"},{"location":"inthecloud/ch03/#ovirthosted-engine","text":"\u9ad8\u53ef\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u5212\u5206\uff1a \u5b58\u50a8\u7684\u9ad8\u53ef\u7528\uff1a\u4f20\u7edf\u5b58\u50a8\u4f7f\u7528 DRBD/Heartbeat \u6216\u8005\u72ec\u7acb\u7684\u5b58\u50a8\u8bbe\u5907\u4fdd\u8bc1\u9ad8\u53ef\u7528\uff0c\u5728\u7075\u6d3b\u6027\u3001\u53ef\u6269\u5c55\u6027\u3001\u6210\u672c\u4e0a\u90fd\u6709\u4e00\u5b9a\u5c40\u9650\u3002\u5728\u4e0e\u4e3b\u673a\u540c\u53f0\u4f7f\u7528 Ceph \u6216\u8005 Glusterfs \u53ef\u4ee5\u8f83\u597d\u5730\u4fdd\u8bc1\u8d44\u6e90\u5145\u5206\u5229\u7528\u5730\u540c\u65f6\uff0c\u53c8\u6ee1\u8db3\u4e86\u9ad8\u5ea6\u53ef\u7528\u7684\u8981\u6c42\u3002 \u7ba1\u7406\u9ad8\u53ef\u7528\uff1a\u56e0\u4e3a\u6bd4\u5982 oVirt\u3001OpenStack \u8fd9\u79cd\u62e5\u6709\u5927\u578b\u6570\u636e\u5e93\u7684\u8bbe\u65bd\u4e0d\u50cf\u5b58\u50a8\u8bbe\u65bd\u90a3\u6837\u9ad8\u6548\u7684\u540c\u6b65\uff0c\u9700\u8981\u72ec\u7acb\u7684\u7ba1\u7406\u8fd0\u884c\u5728\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e00\u53f0\u673a\u5668\u4e0a\u6765\u540c\u6b65\u96c6\u7fa4\u6d88\u606f\uff0c\u6240\u4ee5\uff0c\u7ba1\u7406\u7aef\u7684\u9ad8\u53ef\u7528\u4e5f\u662f\u5341\u5206\u5fc5\u8981\u7684\u3002 \u865a\u62df\u673a/\u670d\u52a1\u9ad8\u53ef\u7528\uff1a\u865a\u62df\u673a\u5728\u5b95\u673a\u65f6\u53ef\u81ea\u52a8\u91cd\u542f\uff0c\u5728\u4e3b\u673a\u8d44\u6e90\u7d27\u5f20\u65f6\u53ef\u7528\u8fc1\u79fb\u5230\u5176\u4ed6\u8d1f\u8f7d\u8f83\u4f4e\u7684\u4e3b\u673a\u4e0a\uff0c\u4ece\u800c\u4fdd\u8bc1\u670d\u52a1\u7684\u8d28\u91cf\u4ee5\u53ca\u8fde\u7eed\u6027\u3002 ```{image} ../images/03-03.png :align: center 1 2 3 4 5 6 7 8 9 ```{eval-rst} .. epigraph:: 1. \u5bbf\u4e3b\u673a\u7684CPU\u67b6\u6784\u5efa\u8bae\u9009\u62e9Westmere\uff08Westmere E56xx/L56xx/X56xx\uff09\u3001Nehalem\uff08Intel Core i7 9xx\uff09\u3001Penryn\uff08Intel Core 2 Duo P9xxx\uff09\u6216\u8005Conroe\uff08Intel Celeron_4x0\uff09\u4e2d\u7684\u4e4b\u4e00\u3002 CPU Family table \u53c2\u9605 `Intel Architecture and Processor Identification With CPUID Model and Family Numbers <https://software.intel.com/en-us/articles/intel-architecture-and-processor-identification-with-cpuid-model-and-family-numbers>`_ 2. \u5efa\u8bae\u53c2\u8003\u7b2c11\u8282\u63d0\u524d\u5b89\u88c5\u542b\u6709oVirt\u7ba1\u7406\u7684\u865a\u62df\u673a\uff0c\u786c\u76d8\u683c\u5f0f\u4e3aRAW\uff0c\u4ece\u800c\u5728\u5b89\u88c5\u7ba1\u7406\u673a\u65f6\u4f5c\u4e3aOVF\u5bfc\u5165\u6216\u8005\u8986\u76d6\u865a\u62df\u78c1\u76d8\uff0c\u51cf\u5c11\u5931\u8d25\u98ce\u9669\u65f6\u95f4\u3002 \u5b89\u88c5 ovirt-hosted-engine-setup\uff0c\u5e76\u56de\u7b54\u4e00\u4e9b\u95ee\u9898\uff0c\u6ce8\u610f\u9ad8\u4eae\u90e8\u5206\uff1a ```{code-block} bash :emphasize-lines: 21,36,123,138-144,150,166,173","title":"\u642d\u5efa\u7ba1\u7406\u7aef\u9ad8\u53ef\u7528 oVirt\uff08hosted engine\uff09"},{"location":"inthecloud/ch03/#hosted-engine-deploy","text":"[ INFO ] Stage: Initializing Continuing will configure this host for serving as hypervisor and create a VM where you have to install oVirt Engine afterwards. Are you sure you want to continue? (Yes, No)[Yes]: yes [ INFO ] Generating a temporary VNC password. [ INFO ] Stage: Environment setup Configuration files: [] Log file: /var/log/ovirt-hosted-engine-setup/ovirt-hosted-engine-setup-20140508182241.log Version: otopi-1.2.0 (otopi-1.2.0-1.el6) [ INFO ] Hardware supports virtualization [ INFO ] Bridge ovirtmgmt already created [ INFO ] Stage: Environment packages setup [ INFO ] Stage: Programs detection [ INFO ] Stage: Environment setup [ INFO ] Stage: Environment customization 1 2 3 4 --== STORAGE CONFIGURATION ==-- During customization use CTRL-D to abort. Please specify the storage you would like to use (nfs3, nfs4)[nfs3]:","title":"hosted-engine --deploy"},{"location":"inthecloud/ch03/#hosted-engine","text":"","title":"\u6b64\u5904\u7684\u5b58\u50a8\u57df\u53ea\u5b58\u50a8hosted-engine\u7684\u76f8\u5173\u6587\u4ef6\uff0c\u4e0d\u4f5c\u4e3a\u4e3b\u6570\u636e\u57df"},{"location":"inthecloud/ch03/#glusternfslocalhostdata","text":"1 Please specify the full shared storage connection path to use (example: host:/path): 192.168.10.101:/gluster-vol1/ovirt_data/hosted_engine [ INFO ] Installing on first host Please provide storage domain name. [hosted_storage]: Local storage datacenter name is an internal name and currently will not be shown in engine's admin UI.Please enter local datacenter name [hosted_datacenter]: 1 2 3 4 5 6 7 8 9 --== SYSTEM CONFIGURATION ==-- --== NETWORK CONFIGURATION ==-- iptables was detected on your computer, do you wish setup to configure it? (Yes, No)[Yes]: no Please indicate a pingable gateway IP address [192.168.10.1]: --== VM CONFIGURATION ==--","title":"\u5efa\u8bae\u6302\u8f7dgluster\u7684nfs\u65f6\u4f7f\u7528localhost:data\u5f62\u5f0f"},{"location":"inthecloud/ch03/#engine","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 Please specify the device to boot the VM from (cdrom, disk, pxe) [cdrom]: The following CPU types are supported by this host: - model_Conroe: Intel Conroe Family Please specify the CPU type to be used by the VM [model_Conroe]: Please specify path to installation media you would like to use [None]: /tmp/centos.iso Please specify the number of virtual CPUs for the VM [Defaults to minimum requirement: 2]: Please specify the disk size of the VM in GB [Defaults to minimum requirement: 25]: You may specify a MAC address for the VM or accept a randomly generated default [00:16:3e:59:9b:e2]: Please specify the memory size of the VM in MB [Defaults to minimum requirement: 4096]: 4096 Please specify the console type you would like to use to connect to the VM (vnc, spice) [vnc]: --== HOSTED ENGINE CONFIGURATION ==-- Enter the name which will be used to identify this host inside the Administrator Portal [hosted_engine_1]: Enter 'admin@internal' user password that will be used for accessing the Administrator Portal: Confirm 'admin@internal' user password: Please provide the FQDN for the engine you would like to use. This needs to match the FQDN that you will use for the engine installation within the VM. Note: This will be the FQDN of the VM you are now going to create, it should not point to the base host or to any other existing machine. Engine FQDN: ha.example.com [WARNING] Failed to resolve ha.example.com using DNS, it can be resolved only locally Please provide the name of the SMTP server through which we will send notifications [localhost]: Please provide the TCP port number of the SMTP server [25]: Please provide the email address from which notifications will be sent [root@localhost]: Please provide a comma-separated list of email addresses which will get notifications [root@localhost]: [ INFO ] Stage: Setup validation 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 --== CONFIGURATION PREVIEW ==-- Engine FQDN : ha.example.com Bridge name : ovirtmgmt SSH daemon port : 22 Gateway address : 192.168.10.1 Host name for web application : hosted_engine_1 Host ID : 1 Image size GB : 25 Storage connection : 192.168.10.101:/gluster-vol1/ovirt_data/hosted_data/ Console type : vnc Memory size MB : 4096 MAC address : 00:16:3e:59:9b:e2 Boot type : cdrom Number of CPUs : 2 ISO image (for cdrom boot) : /tmp/centos.iso CPU Type : model_Conroe Please confirm installation settings (Yes, No)[No]: yes [ INFO ] Generating answer file '/etc/ovirt-hosted-engine/answers.conf' [ INFO ] Stage: Transaction setup [ INFO ] Stage: Misc configuration [ INFO ] Stage: Package installation [ INFO ] Stage: Misc configuration [ INFO ] Configuring libvirt [ INFO ] Configuring VDSM [ INFO ] Starting vdsmd [ INFO ] Waiting for VDSM hardware info [ INFO ] Waiting for VDSM hardware info [ INFO ] Waiting for VDSM hardware info [ INFO ] Waiting for VDSM hardware info [ INFO ] Creating Storage Domain [ INFO ] Creating Storage Pool [ INFO ] Connecting Storage Pool [ INFO ] Verifying sanlock lockspace initialization [ INFO ] Initializing sanlock lockspace [ INFO ] Initializing sanlock metadata [ INFO ] Creating VM Image [ INFO ] Disconnecting Storage Pool [ INFO ] Start monitoring domain [ INFO ] Configuring VM [ INFO ] Updating hosted-engine configuration [ INFO ] Stage: Transaction commit [ INFO ] Stage: Closing up The following network ports should be opened: tcp:5900 tcp:5901 udp:5900 udp:5901 An example of the required configuration for iptables can be found at: /etc/ovirt-hosted-engine/iptables.example In order to configure firewalld, copy the files from /etc/ovirt-hosted-engine/firewalld to /etc/firewalld/services and execute the following commands: firewall-cmd -service hosted-console [ INFO ] Creating VM You can now connect to the VM with the following command: /usr/bin/remote-viewer vnc://localhost:5900 Use temporary password \"2067OGHU\" to connect to vnc console. Please note that in order to use remote-viewer you need to be able to run graphical applications. This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding). Otherwise you can run the command from a terminal in your preferred desktop environment. If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command: virsh -c qemu+tls://192.168.1.150/system console HostedEngine If you need to reboot the VM you will need to start it manually using the command: hosted-engine --vm-start You can then set a temporary password using the command: hosted-engine --add-console-password The VM has been started. Install the OS and shut down or reboot it. To continue please make a selection: 1 2 3 (1) Continue setup - VM installation is complete (2) Reboot the VM and restart installation (3) Abort setup","title":"\u865a\u62dfengine\u7684\u5b89\u88c5\u65b9\u5f0f"},{"location":"inthecloud/ch03/#terminal","text":"","title":"\u9700\u8981\u5728\u53e6\u5916\u4e00\u4e2a\u6709\u56fe\u5f62\u80fd\u529b\u7684terminal\u4e2d\u8fd0\u884c"},{"location":"inthecloud/ch03/#remote-viewer-vnc192168101015900","text":"","title":"\"remote-viewer vnc://192.168.10.101:5900\"\u8fde\u63a5\u865a\u62df\u673a\u3002"},{"location":"inthecloud/ch03/#engine-setup","text":"","title":"\u5b8c\u6210engine-setup\u540e\u5173\u95ed\u865a\u62df\u673a\uff1b\u53ef\u4ee5\u5728\u865a\u62df\u673a\u8fd0\u884c\u72b6\u6001\u4e0b\u6267\u884c"},{"location":"inthecloud/ch03/#hosted-engine-add-console-password","text":"","title":"\"hosted-engine --add-console-password\"\u66f4\u6362\u63a7\u5236\u53f0\u5bc6\u7801\u3002"},{"location":"inthecloud/ch03/#cdromgs1engine","text":"","title":"\u5982\u679c\u4e4b\u524d\u9009\u62e9cdrom\u8fdb\u884c\u5b89\u88c5\u7684\u8bdd\uff0c\u6b64\u5904\u53ef\u4ee5\u5728gs1\u4e0a\u7528\u5df2\u7ecf\u5b89\u88c5\u597dengine\u7684"},{"location":"inthecloud/ch03/#_3","text":"","title":"\u865a\u62df\u78c1\u76d8\u8fdb\u884c\u8986\u76d6\uff0c\u7c7b\u4f3c"},{"location":"inthecloud/ch03/#mount-t-nfs-1921681010119216810101gluster-vol1ovirt_datahosted_data-mnt-mv-engine-diskraw-mntovirt_datahosted_datavm_uuid","text":"1 2 (1, 2, 3)[1]: 1 Waiting for VM to shut down... [ INFO ] Creating VM You can now connect to the VM with the following command: /usr/bin/remote-viewer vnc://localhost:5900 Use temporary password \"2067OGHU\" to connect to vnc console. Please note that in order to use remote-viewer you need to be able to run graphical applications. This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding). Otherwise you can run the command from a terminal in your preferred desktop environment. If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command: virsh -c qemu+tls://192.168.1.150/system console HostedEngine If you need to reboot the VM you will need to start it manually using the command: hosted-engine --vm-start You can then set a temporary password using the command: hosted-engine --add-console-password Please install and setup the engine in the VM. You may also be interested in installing ovirt-guest-agent-common package in the VM. To continue make a selection from the options below: (1) Continue setup - engine installation is complete (2) Power off and restart the VM (3) Abort setup","title":"\"mount -t nfs 192.168.10.101:192.168.10.101:/gluster-vol1/ovirt_data/hosted_data/ /mnt; mv engine-disk.raw /mnt/ovirt_data/hosted_data/.../vm_UUID\""},{"location":"inthecloud/ch03/#engine-setup-offlineengine","text":"1 (1, 2, 3)[1]: 1 [ INFO ] Engine replied: DB Up!Welcome to Health Status! [ INFO ] Waiting for the host to become operational in the engine. This may take several minutes... [ INFO ] Still waiting for VDSM host to become operational... [ INFO ] The VDSM Host is now operational Please shutdown the VM allowing the system to launch it as a monitored service.","title":"\u6b64\u5904\u53c2\u8003\u7b2c\u4e00\u6b21\u64cd\u4f5c\uff0c\u8fde\u63a5\u865a\u62df\u673a\u63a7\u5236\u53f0\u540e\u8fdb\u884c\"engine-setup --offline\"\u4ee5\u5b89\u88c5engine"},{"location":"inthecloud/ch03/#_4","text":"1 The system will wait until the VM is down. [ INFO ] Enabling and starting HA services Hosted Engine successfully set up [ INFO ] Stage: Clean up [ INFO ] Stage: Pre-termination [ INFO ] Stage: Termination 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 \u6b64\u65f6\uff0c\u8fd0\u884c\u201dhosted-engine \u2013vm-start\u201d\u4ee5\u542f\u52a8\u865a\u62df\u7ba1\u7406\u673a\u3002 :::{note} 1. \u82e5\u8981\u91cd\u65b0\u90e8\u7f72 # vdsClient -s 0 list # vdsClient -s 0 destroy <ID of the vm you get from the first command> 2. \u82e5\u8981\u6dfb\u52a0\u7b2c\u4e8c\u53f0\u673a\u5668 # yum install ovirt-hosted-engine-setup # hosted-engine --deploy \u7136\u540e\u6307\u5b9a\u5b58\u50a8\u8def\u5f84\u5373\u53ef\u81ea\u52a8\u5224\u65ad\u6b64\u4e3a\u7b2c 2+\u53f0\u673a\u5668\u3002 ::: (label1)= ## 3.3 \u6dfb\u52a0\u8282\u70b9\u4ee5\u53ca\u5b58\u50a8\u57df \u4f60\u770b\u5230\u8fd9\u7684\u8bdd\u5e94\u8be5\u5df2\u7ecf\u6709\u4e86\u4e00\u4e2a\u6570\u636e\u4e2d\u5fc3\u3001\u51e0\u4e2a\u5bbf\u4e3b\u673a\uff0c\u4e5f\u53ef\u80fd\u6709\u4e00\u4e2a\u865a\u62df\u673a\uff08engine\uff09\uff0c\u8fd8\u5dee\u4e00\u4e2a\u5b58\u50a8\u865a\u62df\u673a\u955c\u50cf\u7684\u5730\u65b9\u5c31\u53ef\u4ee5\u62e5\u6709\u57fa\u672c\u7684 oVirt \u5e73\u53f0\u4e86\u3002 ### \u6dfb\u52a0\u8282\u70b9\uff08\u5bbf\u4e3b\u673a\uff09 \u5bf9\u4e8e\u7b2c 11 \u8282\u7684\u666e\u901a oVirt\u3001\u7b2c 12 \u8282\u7684 ha \u5e73\u53f0\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u6dfb\u52a0\u66f4\u591a\u8282\u70b9\u4ee5\u652f\u6301\u66f4\u597d\u7684 SLA\uff08service level agreement\uff09\u3002 \u6dfb\u52a0\u8282\u70b9\u76ee\u524d\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a - \u901a\u8fc7 oVirt \u7684\u8282\u70b9 ISO \u5b89\u88c5\u7cfb\u7edf\u540e\u52a0\u5165\u3002 - \u76f4\u63a5\u5c06\u73b0\u6709 CentOS \u6216\u8005 Fedora \u8f6c\u5316\u4e3a\u8282\u70b9\uff08\u53ef\u4ee5\u4e3a\u5f53\u524d\u7ba1\u7406\u673a\uff09\u3002 - \u6307\u5b9a\u4f7f\u7528\u5916\u90e8\u63d0\u4f9b\u8005\uff08Foreman\uff09\u3002 \u5728\u6b64\u6211\u4eec\u4f7f\u7528\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u3002 ```{image} ../images/03-05.png :align: center","title":"\u5230\u6b64\uff0c\u9700\u8981\u8fde\u63a5\u865a\u62df\u673a\u63a7\u5236\u53f0\u5173\u95ed\u865a\u62df\u673a"},{"location":"inthecloud/ch03/#_5","text":"\u5b58\u50a8\u57df\u6709 3 \u79cd\uff0cData\uff08\u6570\u636e\u57df\uff09\u3001ISO\uff08ISO \u57df\uff09\u3001Export\uff08\u5bfc\u51fa\u57df\uff09\u3002 \u5176\u4e2d\uff0c\u6570\u636e\u57df\u662f\u4e3a\u5fc5\u9700\uff0c\u5728\u521b\u5efa\u4efb\u4f55\u865a\u62df\u673a\u4e4b\u524d\u9700\u8981\u6709\u4e00\u4e2a\u53ef\u7528\u7684\u6570\u636e\u57df\u7528\u4e8e\u5b58\u50a8\u865a\u62df\u78c1\u76d8\u4ee5\u53ca\u5feb\u7167\u6587\u4ef6\uff1bISO \u57df\u4e2d\u53ef\u4ee5\u5b58\u653e ISO \u548c VFD \u683c\u5f0f\u7684\u7cfb\u7edf\u955c\u50cf\u6216\u8005\u9a71\u52a8\u6587\u4ef6\uff0c\u53ef\u5728\u591a\u4e2a\u6570\u636e\u4e2d\u5fc3\u95f4\u5171\u4eab\uff1b\u5bfc\u51fa\u57df\u7528\u4e8e\u5bfc\u51fa\u6216\u5bfc\u5165 OVF \u683c\u5f0f\u7684\u865a\u673a\u3002 \u800c\u6839\u636e\u6570\u636e\u57df\u7684\u5b58\u50a8\u7c7b\u578b\uff0c\u6211\u4eec\u6709 5 \u79cd\uff08NFS\u3001POSIX \u517c\u5bb9\u3001Glusterfs\u3001iSCSI\u3001\u5149\u7ea4\uff09\u53ef\u9009\uff0c\u5728\u6b64\uff0c\u9009\u62e9 glusterfs \u5bfc\u51fa\u7684 NFS\u3002 ```{image} ../images/03-06.png :align: center 1 2 3 4 5 6 7 8 9 10 11 12 13 14 :::{note} \u786e\u4fdd\u5b58\u50a8\u57df\u76ee\u5f55\u88ab vdsm.kvm \u53ef\u8bfb\uff0c\u5373\u6240\u6709\u8005\u4e3a 36:36\uff0c\u6216\u8005 vdsm.kvm\u3002 \u5bfc\u51fa\u57df\u5728\u5df2\u52a0\u5165\u6570\u636e\u4e2d\u5fc3\u540e\u4e0d\u53ef\u5171\u4eab\uff0c\u5982\u679c\u5b83\u610f\u5916\u635f\u574f\uff0c\u8bf7\u53c2\u8003 <http://blog.lofyer.org/blog/2014/05/11/cloud-6-5-advanced-ovirt/> \u624b\u52a8\u4fee\u590d\uff0c\u6216\u8005\u5220\u9664 dom_md/metadata \u4e2d\u7684 POOL_UUID \u7684\u503c\u4ee5\u53ca\\_SHA_CKSUM \u884c\u3002 \u82e5\u8981\u4f7f\u7528 oVirt \u7684 gluster \u652f\u6301\uff0c\u8bf7\u5b89\u88c5 vdsm-gluster \u5305\u3002 ::: ## 3.4 \u8fde\u63a5\u865a\u62df\u673a \u865a\u62df\u673a\u8fd0\u884c\u540e\uff0c\u901a\u8fc7 web \u754c\u9762\uff0c\u4f60\u53ef\u7528\u4f7f\u7528\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\u8fde\u63a5\u865a\u62df\u673a\uff08\u53ef\u901a\u8fc7\u63a7\u5236\u53f0\u9009\u9879\u8fdb\u884c\u4fee\u6539\uff09\uff1a ```{image} ../images/03-08.png :align: center","title":"\u6dfb\u52a0\u5b58\u50a8\u57df"},{"location":"inthecloud/ch03/#spice-html5","text":"\u9996\u5148\u5728\u670d\u52a1\u5668\u7aef\u6253\u5f00 spice \u4ee3\u7406\uff1a 1 2 3 4 5 # engine-setup --otopi-environment=\"OVESETUP_CONFIG/websocketProxyConfig=bool:True\" # \u5982\u679c\u672asetup\u6216\u8005\u8981\u5728\u5176\u4ed6\u673a\u5668setup\uff0c\u53ef\u505a\u6b64\u6b65 # yum install -y numpy # \u5b89\u88c5numpy\u4ee5\u52a0\u901f\u8f6c\u6362\u3002 # engine-config -s WebSocketProxy=\"192.168.10.100:6100\" # service ovirt-websocket-proxy restart # service ovirt-engine restart \u8fde\u63a5\u4e4b\u524d\uff0c\u8981\u4fe1\u4efb\u4ee5\u4e0b\u4e24\u5904 https \u8bc1\u4e66\uff1a https://192.168.10.100 https://192.168.10.100:6100 \u7136\u540e\u70b9\u51fb\u63a7\u5236\u53f0\u6309\u94ae\u5373\u53ef\u5728\u6d4f\u89c8\u5668\u7684\u65b0\u6807\u7b7e\u4e2d\u6253\u5f00 spice-html5 \u684c\u9762\u3002","title":"Spice-Html5"},{"location":"inthecloud/ch03/#_6","text":"\u5bf9\u4e8e Redhat \u7cfb\u5217\u7cfb\u7edf\uff0c\u53ef\u5b89\u88c5 spice-xpi \u63d2\u4ef6\uff1bWindows \u7cfb\u7edf\u53ef\u4ee5\u5b89\u88c5 SpiceX \u7684\u63a7\u4ef6\u3002","title":"\u6d4f\u89c8\u5668\u63d2\u4ef6"},{"location":"inthecloud/ch03/#_7","text":"\u8bbf\u95ee virt-manager \u5b98\u7f51 \u4e0b\u8f7d virt-viewer \u5ba2\u6237\u7aef\uff0c\u4f7f\u7528\u5b83\u6253\u5f00\u4e0b\u8f7d\u5230\u672c\u5730\u7684 console.vv \u6587\u4ef6\u3002","title":"\u672c\u5730\u5ba2\u6237\u7aef"},{"location":"inthecloud/ch03/#spice-proxygateway-squid","text":"\u8bbe\u7f6e squid \u4ee3\u7406\uff0c\u5c06\u6240\u6709 spice \u7aef\u53e3\u4ee3\u7406\u81f3 3128 \u7aef\u53e3\u3002 1","title":"spice proxy/gateway - squid \u4ee3\u7406"},{"location":"inthecloud/ch03/#yum-install-squid","text":"1 \u4fee\u6539/etc/squid/squid.conf\u3002 1","title":"yum install squid"},{"location":"inthecloud/ch03/#5","text":"acl localhost src 192.168.0.150","title":"\u7b2c 5 \u884c"},{"location":"inthecloud/ch03/#41","text":"http_access allow CONNECT Safe_ports","title":"\u7b2c 41 \u884c\u4fee\u6539\u4e3a"},{"location":"inthecloud/ch03/#acl-spice_servers-dst-19216810024","text":"","title":"acl spice_servers dst 192.168.10.0/24"},{"location":"inthecloud/ch03/#http_access-allow-spice_servers","text":"1 \u542f\u7528squid\u670d\u52a1\u3002 1","title":"http_access allow spice_servers"},{"location":"inthecloud/ch03/#chkconfig-squid-on","text":"","title":"chkconfig squid on"},{"location":"inthecloud/ch03/#service-squid-restart","text":"1 \u8bbe\u7f6eengine\u7684SpiceProxy 1","title":"service squid restart"},{"location":"inthecloud/ch03/#engine-config-s-spiceproxydefaulthttpfqdnor-ip3128","text":"","title":"engine-config -s SpiceProxyDefault=\"http://FQDNor\u5916\u7f51 IP:3128\""},{"location":"inthecloud/ch03/#service-ovirt-engine-restart","text":"1 \u53ef\u901a\u8fc7\u96c6\u7fa4\u8bbe\u7f6e\u4e2d\u8bbe\u7f6e\u6240\u6709\u5bbf\u4e3b\u673a\u7684Spice\u4ee3\u7406\uff0c\u6216\u8005\u5728\u865a\u62df\u673a\u8bbe\u7f6e\u4e2d\u5355\u4e00\u8bbe\u7f6e\u67d0\u53f0\u865a\u62df\u673a\u901a\u8fc7\u4ee3\u7406\u8bbf\u95ee\u3002","title":"service ovirt-engine restart"},{"location":"inthecloud/ch03/#rdp-windows-ie","text":"\u5982\u679c\u865a\u62df\u673a\u7684\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9\u4e3a Windows\uff0c\u5e76\u4e14\u5185\u90e8\u542f\u52a8\u4e86\u8fdc\u7a0b\u684c\u9762\u670d\u52a1\uff0c\u4f7f\u7528 IE \u6d4f\u89c8\u5668\u8bbf\u95ee\u7528\u6237\u6216\u8005\u7ba1\u7406\u5458\u5165\u53e3\u65f6\uff0c\u53ef\u4ee5\u542f\u7528 RDP \u63a7\u4ef6\u3002","title":"RDP \u63d2\u4ef6\uff08\u4ec5\u9002\u7528\u4e8e Windows \u865a\u673a\u53ca IE \u6d4f\u89c8\u5668\uff09"},{"location":"inthecloud/ch03/#35-ovirt","text":"","title":"3.5 oVirt \u4f7f\u7528\u8fdb\u9636"},{"location":"inthecloud/ch03/#_8","text":"\u5982\u679c\u51fa\u73b0\u7f51\u7edc\u9519\u8bef\uff0c\u5f88\u6709\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e0d\u540c\u6b65\uff0c\u4ece\u800c\u5bfc\u81f4\u754c\u9762\u4e0a\u865a\u62df\u673a\u72b6\u6001\u4e00\u76f4\u5904\u4e8e\u5f02\u5e38\u72b6\u6001\uff0c\u8fd9\u70b9 OpenStack \u4e5f\u6709\u4e00\u6837\u7684\u7f3a\u70b9\u3002\u8fde\u63a5\u5f15\u64ce\u6570\u636e\u5e93\uff0c\u4fee\u6539\u5176\u4e2d\u7684 vm_dynamic, image, vm_static \u7b49\u6570\u636e\u8868\u5373\u53ef\u3002","title":"\u6570\u636e\u5e93\u4fee\u6539\u975e\u540c\u6b65\u6570\u636e"},{"location":"inthecloud/ch03/#engine-config","text":"\u5e73\u53f0\u5b89\u88c5\u5b8c\u4ee5\u540e\uff0c\u53ef\u7528\u901a\u8fc7 engine-config \u547d\u4ee4\u8fdb\u884c\u8be6\u7ec6\u53c2\u6570\u914d\u7f6e\u3002 1 2 3 4 # \u67e5\u770b\u8bbe\u7f6e\u8bf4\u660e # engine-config -l # \u67e5\u770b\u5f53\u524d\u8bbe\u7f6e # engine-config -a \u793a\u4f8b\uff1a\u91cd\u8bbe\u7ba1\u7406\u5458\u5bc6\u7801 1","title":"engine-config \u53c2\u6570\u914d\u7f6e"},{"location":"inthecloud/ch03/#engine-config-s-adminpasswordinteractive","text":"Please enter a password: # \u5bc6\u7801 Please reenter password: # \u5bc6\u7801 1","title":"engine-config -s AdminPassword=interactive"},{"location":"inthecloud/ch03/#ovirt-shell-api","text":"Restful API\uff08Application User Interface\uff09\u662f oVirt \u7684\u4e00\u5927\u7279\u70b9\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5b83\u5c06\u5176\u4e0e\u7b2c\u4e09\u65b9\u7684\u754c\u9762\u6216\u8005\u5e94\u7528\u8fdb\u884c\u96c6\u6210\u3002\u8bbf\u95ee http://192.168.10.100/api?rsdl \u4ee5\u83b7\u53d6\u5176\u7528\u6cd5\u3002 :::{note} \u8bbf\u95ee API \u4f7f\u7528 GET\u3001POST\u3001PUT\u3001DELETE \u65b9\u6cd5 \u83b7\u53d6\u5185\u5bb9\u65f6\u4f7f\u7528 GET\uff1b \u6dfb\u52a0\u65b0\u5185\u5bb9\u6216\u8005\u6267\u884c\u52a8\u4f5c\u4f7f\u7528 POST\uff1b \u66f4\u65b0\u5185\u5bb9\u4f7f\u7528 PUT\uff1b \u5220\u9664\u5185\u5bb9\u4f7f\u7528 DELETE\uff1b \u8be6\u7ec6\u7528\u6cd5\u53c2\u8003 http://www.ovirt.org/Api \uff0cSDK \u793a\u4f8b\u53c2\u8003 http://www.ovirt.org/Testing/PythonApi ::: ovirt-shell \u5219\u662f\u5168\u90e8\u4f7f\u7528 Restful API \u5199\u6210\u7684 shell\uff0c\u901a\u8fc7\u5b83\u53ef\u4ee5\u5b8c\u6210\u56fe\u5f62\u754c\u9762\u6240\u4e0d\u80fd\u63d0\u4f9b\u7684\u529f\u80fd\u3002 1 2 3 4 5 6 7 8 9 # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api ============================================================================ >>> connected to oVirt manager 3.4.0.0 <<< ============================================================================ ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ Welcome to oVirt shell ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ [oVirt shell (connected)]# \u793a\u4f8b\uff1a\u4f7f\u7528 ovirt-shell \u6216\u8005 API \u6765\u8fde\u63a5\u865a\u62df\u673a\u3002 \u83b7\u53d6\u865a\u62df\u673a\u5217\u8868\u53ca\u5176\u6240\u5728\u5bbf\u4e3b\u673a ovirtshell 1 2 3 4 5 6 7 8 9 10 11 12 # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api -E \"list vms\" id : 124e8020-c9d7-4e86-81e1-0d4e28ff1cd4 name : aaa # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api -E \"show vm aaa\" id : 124e8020-c9d7-4e86-81e1-0d4e28ff1cd4 name : aaa ... display-address : 192.168.10.100 ... display-port : 5912 display-secure_port : 5913 ... restapi 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # curl -u admin@internal:admin https://192.168.10.100/api/vms | less <name>aaa</name> <description></description> ... <display> <type>spice</type> <address>192.168.10.100</address> <port>5912</port> <secure_port>5913</secure_port> <monitors>1</monitors> <single_qxl_pci>false</single_qxl_pci> <allow_override>false</allow_override> <smartcard_enabled>false</smartcard_enabled> </display> ... \u83b7\u53d6/\u8bbe\u7f6e\u63a7\u5236\u53f0\u5bc6\u7801 ovirtshell 1 2 3 4 5 6 7 # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api -E \"action vm aaa ticket\" # [oVirt shell (connected)]# action vm aaa ticket status-state : complete ticket-expiry: 7200 ticket-value : MfY9P5kpmNpw vm-id : 124e8020-c9d7-4e86-81e1-0d4e28ff1cd4 restapi 1 2 3 4 5 6 7 8 9 10 11 12 # curl -k -u admin@internal:admin https://192.168.10.100/api/vms/124e8020-c9d7-4e86-81e1-0d4e28ff1cd4/ticket -X POST -H \"Content-type: application/xml\" -d '<action><ticket><expiry>120</expiry></ticket></action>' <?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?> <action> <ticket> <value>jRUqhrks6JiT</value> <expiry>120</expiry> </ticket> ... <status> <state>complete</state> </status> </action> \u8fde\u63a5\u865a\u62df\u673a \u9664\u4e86\u4ee5\u4e0a\u83b7\u53d6\u7684\u663e\u793a\u7aef\u53e3\u3001\u5bbf\u4e3b\u673a IP\uff0c\u6211\u4eec\u9700\u8981\u989d\u5916\u83b7\u53d6\u4e00\u4e2a\u6839\u8bc1\u4e66\u3002 1 # wget http://192.168.10.100/ca.crt ovirt-shell 1 2 # ovirt-shell -I -u admin@internal -l https://192.168.10.100/api \\ -E \"console aaa\" virt-viewer 1 # remote-viewer --spice-ca-file=ca.crt spice://192.168.10.100?port=5912&tls-port=5913&password=jRUqhrks6JiT","title":"ovirt-shell \u4e0e API"},{"location":"inthecloud/ch03/#hooks","text":"\u4e3b\u673a hooks \u4f4d\u4e8e\u5404\u4e2a\u5bbf\u4e3b\u673a\u4e0a\uff0c\u7528\u4e8e\u6269\u5c55 oVirt \u7684\u5e73\u53f0\u529f\u80fd\uff0c\u6bd4\u5982\u7f51\u7edc\u3001USB \u8bbe\u5907\u3001SRIOV \u7b49\u3002\u539f\u7406\u662f\u5728\u67d0\u4e00\u4e8b\u4ef6\u89e6\u53d1\u65f6\uff08\u6bd4\u5982\u865a\u62df\u673a\u542f\u52a8\u4e4b\u524d\uff09\uff0c\u4fee\u6539 libvirt \u542f\u52a8 XML \u6587\u4ef6\u3001\u73af\u5883\u53d8\u91cf\u6216\u8005\u4e3b\u673a\u914d\u7f6e\uff0c\u4ece\u800c\u6539\u53d8 qemu \u7684\u542f\u52a8\u53c2\u6570\u3002 \u66f4\u591a hooks \u5185\u5bb9\u8bf7\u53c2\u8003 vdsm-hooks \u3002 \u793a\u4f8b\uff1a\u4f7f\u7528 libvirt \u5185\u90e8\u7f51\u7edc \u51c6\u5907\u6240\u9700\u6587\u4ef6\u3002 \u62f7\u8d1d extnet_vnic.py \u81f3/usr/libexec/vdsm/hooks/before_vm_start/\uff0c\u4e0d\u8981\u5fd8\u8bb0\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\u3002 \u67e5\u770b\uff0c\u6dfb\u52a0 libvirt \u7f51\u7edc\u3002 1 # virsh net-list \u5728 extnet_vnic.py \u6587\u4ef6\u4e2d newnet = os.environ.get('extnet') \u524d\u4e00\u884c\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801\uff0c\u66ff\u6362\u5176\u4e2d\u7684 default \u4e3a\u8981\u4f7f\u7528\u7684 libvirt \u7f51\u7edc\uff0c \u5176\u4ed6\u7684 hooks \u811a\u672c\u591a\u6570\u53ef\u4ee5\u8fd9\u6837\u4fee\u6539\uff0c\u4e5f\u53ef\u4ee5\u5728 engine-config \u7684 CustomProperty \u4e2d\u6307\u5b9a \uff1a 1 2 3 4 # \u6ce8\u610f\u6b64\u5904\u4f7f\u7528\u53cc\u5f15\u53f7 params = \"default\" # \u540c\u4e0a\u90e8\u5206\u7c97\u4f53\u5b57\uff0c\u56e0\u4e3a\u5927\u90e8\u5206hooks\u68c0\u67e5engine-config\u4e2d\u7684\u73af\u5883\u53d8\u91cf\uff0c\u7b80\u4fbf\u8d77\u89c1\uff0c\u6211\u76f4\u63a5\u5728hooks\u811a\u672c\u4e2d\u8bbe\u7f6e\u4e86\u73af\u5883\u53d8\u91cf os.environ.__setitem__(\"extnet\",params) \u865a\u62df\u673a\u4e00\u5b9a\u8981\u6dfb\u52a0\u7f51\u7edc\u914d\u7f6e\uff0c\u5426\u5219\u4f1a\u542f\u52a8\u5931\u8d25\uff0c\u5728\u865a\u62df\u673a\u542f\u52a8\u65f6\uff0c\u7b2c\u4e00\u4e2a\u7f51\u7edc\u914d\u7f6e\u6587\u4ef6\u4f1a\u88ab\u66ff\u6362\u4e3a default \u7f51\u7edc\u3002 ::::{note} \u5982\u679c\u5fd8\u8bb0\u4e86 libvirt \u5bc6\u7801\uff0c\u53ef\u4ee5\u7528\u4ee5\u4e0b\u547d\u4ee4\u91cd\u7f6e\u3002 1 # saslpasswd2 -a libvirt root ::::","title":"\u4e3b\u673a hooks"},{"location":"inthecloud/ch03/#_9","text":"oVirt \u73b0\u5728\u81ea\u5e26\u7684 gwt \u754c\u9762\u5bf9\u6d4f\u89c8\u5668\u548c\u5ba2\u6237\u7684\u8981\u6c42\u8f83\u9ad8\uff0c\u6709\u4e00\u4e9b\u4eba\u7531\u4e8e\u8fd9\u4e2a\u539f\u56e0\u629b\u5f03\u5b83\u4f7f\u7528\u7b2c\u4e09\u65b9\u7684 web \u754c\u9762\uff0c\u53c2\u8003 oVirt Dash \u3001 ovirt sample-portals \u3002","title":"\u7b2c\u4e09\u65b9\u754c\u9762"},{"location":"inthecloud/ch03/#_10","text":"\u53c2\u8003\u8fd9\u4e2a PDF \u3002\uff08\u6ca1\u8bb0\u9519\u7684\u8bdd\uff0c\u91cc\u9762\u90a3\u4e2a\u663e\u5361\u900f\u7a7f\u7684\u95ee\u9898\uff0c\u662f\u5f53\u521d\u6211\u95ee\u7684\u3002\u3002\uff09 \u793a\u4f8b\uff1a","title":"\u4e3b\u673a\u7b56\u7565"},{"location":"inthecloud/ch03/#virt-install","text":"\u793a\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 # virt-install \\ --name centos7 \\ --ram 2048 \\ --disk path=/var/kvm/images/centos7.img,format=qcow2 \\ --vcpus 2 \\ --os-type linux \\ --os-variant rhel7 \\ --graphics none \\ --console pty,target_type=serial \\ --location 'http://mirrors.aliyun.com/centos/7/os/x86_64/' \\ --extra-args 'console=ttyS0,115200n8 serial'","title":"\u4f7f\u7528 virt-install \u5b89\u88c5\u7cfb\u7edf"},{"location":"inthecloud/ch03/#_11","text":"oVirt 3.4 \u78c1\u76d8\u53ef\u4ee5\u8fdb\u884c\u5728\u7ebf\u6269\u5bb9\uff0c\u4f46\u662f\u5bf9\u4e8e\u78c1\u76d8\u5185\u7684\u6587\u4ef6\u7cfb\u7edf\u9700\u8981\u5355\u72ec\u652f\u6301\uff0c\u5728\u6b64\u5217\u51fa\u5e38\u7528 Linux \u4ee5\u53ca Windows \u6269\u5bb9\u65b9\u6cd5\u3002 Linux \u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9\uff08\u955c\u50cf\u6269\u5bb9\u540e\u64cd\u4f5c\uff09 \u5728\u955c\u50cf\u6269\u5bb9\u540e\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c\u3002 \u91cd\u5199\u5206\u533a\u8868 1 2 3 4 5 6 7 8 9 10 # fdisk /dev/sda > d > 3 > n > 3 > w \u7136\u540e # kpartprobe \u6216\u8005 # reboot \u5728\u7ebf\u6269\u5bb9\u6587\u4ef6\u7cfb\u7edf 1 # resize2fs /dev/sda3 Linux \u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9\uff08lvm\uff09 \u5728\u521b\u5efa\u597d\u4e00\u4e2a\u65b0\u7684\u5206\u533a\u6216\u8005\u4e00\u4e2a\u65b0\u7684\u78c1\u76d8\u540e\uff0c\u5c06\u65b0\u7a7a\u95f4(\u6bd4\u5982 10G)\u6dfb\u52a0\u5230 PV\uff0cVG\uff0c\u6269\u5bb9 LV\uff0c\u7136\u540e\u6269\u5bb9\u6587\u4ef6\u7cfb\u7edf\u3002 1 2 3 # vgextend vg_livecd /dev/sdb # lvextend /dev/vg_livecd/lv_root -L +10G # resize2fs /dev/vg_livecd/lv_root Linux \u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9\uff08libguestfs\uff09 \u5177\u4f53\u5185\u5bb9\u8bf7\u53c2\u8003 libguestfs site \u3002 \u68c0\u89c6\u78c1\u76d8 1 # virt-filesystem --all --long -h -a hda.img \u521b\u5efa\u5f85\u6269\u5bb9\u78c1\u76d8\u526f\u672c\uff0c\u540c\u65f6\u6269\u5bb9 10G\uff08\u5047\u8bbe\u539f\u78c1\u76d8\u5927\u5c0f\u4e3a 10G\uff09 \u5bf9\u4e8e RAW \u683c\u5f0f\uff1a 1 2 # truncate -r hda.img hda-new.img # truncate -s +10G hda-new.img \u5bf9\u4e8e QCOW2 \u7b49\u6709\u538b\u7f29\u683c\u5f0f\uff1a 1 # qemu-img create -f qcow2 -o preallocation=metadata hda-new.img 20G \u6269\u5c55\u5206\u533a\u5c3a\u5bf8 \u666e\u901a\u5206\u533a\u6269\u5c55\uff0c/boot \u5206\u533a\u6269\u5bb9 200M\uff0c\u5176\u4f59\u5168\u90e8\u7ed9/\u5206\u533a\uff1a 1 # virt-resize --resize /dev/sda1=+200M --expand /dev/sda2 hda.img hda-new.img LVM \u5206\u533a\u6269\u5c55\uff0c\u6269\u5bb9 lv_root \u903b\u8f91\u5377\uff1a 1 # virt-resize --expand /dev/sda2 --LV-expand /dev/vg_livecd/lv_root hda.qcow2 hda-new.qcow2 FAT/NTFS \u6269\u5bb9 XP \u4f7f\u7528 Paragon Partion Manager\uff1bWindows 7 \u5728\u78c1\u76d8\u7ba1\u7406\u4e2d\u5373\u53ef\u6269\u5bb9\u3002","title":"\u865a\u62df\u673a\u6587\u4ef6\u7cfb\u7edf\u6269\u5bb9"},{"location":"inthecloud/ch03/#p2vv2p","text":"V2V \u5728\u6b64\u4ee5 ESXi \u8fc1\u79fb\u81f3 oVirt \u4e3a\u4f8b\u3002 \u5728 oVirt \u4e0a\u521b\u5efa\u4e00\u4e2a NFS \u5bfc\u51fa\u57df \u5b89\u88c5 libguestfs\uff0c\u5e76\u521b\u5efa.netrc \u6587\u4ef6\uff0c\u6587\u4ef6\u5185\u5bb9\u4e3a ESXi \u7684\u767b\u9646\u4fe1\u606f\uff1a ~/.netrc 1 machine 192.168.1.135 login root password 1234567 \u5f00\u59cb\u8fc1\u79fb\uff0c\u786e\u4fdd ESXi \u7684\u865a\u62df\u673a\u5df2\u6b63\u5e38\u5173\u95ed\uff1a 1 2 3 # virt-v2v -ic esx://192.168.1.135/?no_verify=1 -o rhev -os 192.168.1.111:/export --network mgmtnet myvm myvm_myvm: 100% [====================================================]D 0h04m48s virt-v2v: myvm configured with virtio drivers. \u4ece\u5bfc\u51fa\u57df\u5bfc\u5165\u865a\u62df\u673a\u5e76\u8fd0\u884c\uff1a \u5bfc\u5165\u865a\u62df\u673a\uff1a ```{image} ../images/03-11.png :align: center 1 2 3 4 \u8fd0\u884c\u865a\u62df\u673a\uff1a ```{image} ../images/03-12.png :align: center P2V oVirt \u7684 P2V \u65b9\u5f0f\u6211\u6240\u77e5\u7684\u6709\u4e09\u79cd\uff0c\u4e00\u662f\u4f7f\u7528 VMWare \u7684 P2V \u5de5\u5177\u8f6c\u5316\u4e3a VM \u4ee5\u540e\uff0c\u518d\u901a\u8fc7 virt-v2v \u8f6c\u5316\u4e3a oVirt \u7684 VM\uff0c\u4e8c\u662f\u4f7f\u7528 clonezilla \u6216\u8005 ghost \u5236\u4f5c\u7cfb\u7edf\u540e\uff0c\u518d\u5c06\u5176\u5b89\u88c5\u5230 oVirt \u4e2d\uff0c\u4e09\u5219\u662f\u4f7f\u7528 virt-p2v \u5de5\u5177\u3002\u7b14\u8005\u5728\u6b64\u4f7f\u7528 virt-p2v \u5de5\u5177\u793a\u4f8b\uff0c\u6210\u6587\u65f6\u53ea\u5728 CentOS 6.5 \u4ee5\u4e0a\u7248\u672c\u6d4b\u8bd5\uff0cCentOS 7 \u672a\u6d4b\u8bd5\uff0cRHEL 7.1 \u4ee5\u4e0a\u6709\u6b64\u5de5\u5177\u3002 \u5728\u670d\u52a1\u5668\u7aef\u5b89\u88c5\u6240\u9700\u5305\uff1a 1 yum install -y virt-p2v virt-v2v \u5c06/usr/share/virt-v2v/\u4e2d\u7684 ISO \u6587\u4ef6 dd \u5230 U \u76d8\u6216\u8005\u70e7\u5f55\u5230\u5149\u76d8\uff0c\u7136\u540e\u5728\u8981\u8f6c\u5316\u7684\u673a\u5668\u4e0a\u542f\u52a8\u3002 \u4fee\u6539\u670d\u52a1\u5668\u7aef/etc/virt-v2v.conf\uff0c\u4fee\u6539 rhevm \u7684\u914d\u7f6e\uff0c\u5f62\u5982\uff1a 1 2 3 4 5 6 7 8 9 10 11 <virt-v2v> <profile name=\"rhev-sparse\"> <method>rhev</method> <storage format='qcow2' allocation='sparse'> nfs.example.com:/ovirt-export </storage> <network type=\"default\"> <network type=\"network\" name=\"ovirtmgmt\"/> </network> </profile> </virt-v2v> \u5f00\u59cb\u8f6c\u6362\uff08\u6211\u662f\u4f7f\u7528 libvirt \u7684 profile \u793a\u4f8b\uff09 ```{image} ../images/03-13.png :align: center ``` \u8f6c\u6362\u5b8c\u6210\u540e\u5173\u95ed\u8ba1\u7b97\u673a\uff0c\u5e76\u4fee\u6539\u865a\u62df\u673a\u7684\u914d\u7f6e\u4ee5\u5b8c\u5168\u9002\u5e94 OS\u3002","title":"P2V/V2P"},{"location":"inthecloud/ch03/#ui","text":"\u8be6\u7ec6\u5185\u5bb9\u8bf7\u53c2\u8003 oVirt \u5b98\u7f51\u5173\u4e8e UI \u63d2\u4ef6\u7684\u4ecb\u7ecd \u4ee5\u53ca\u9644\u5f55\u90e8\u5206\u5185\u5bb9\uff0c\u5728\u6b64\u6211\u4ec5\u4f7f\u7528 ShellInABox \u4e3e\u4f8b\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u5c06\u4e0a\u9762\u7684 libguestfs \u6269\u5bb9\u52a0\u8fdb\u6765\uff0c\u66f4\u591a UI Plugin \u8bf7 git clone git://gerrit.ovirt.org/samples-uiplugins.git \u3002 ShellInABox oVirt UI plugin \u5728\u5bbf\u4e3b\u673a\u4e0a\u5b89\u88c5 ShellInABox\u3002 1 2 # yum install shellinabox # chkconfig shellinaboxd on \u4fee\u6539 shellinabox \u914d\u7f6e OPTS \uff1a /etc/sysconfig/shellinaboxd 1 OPTS=\"--disable-ssl --service /:SSH\" \u62f7\u8d1d uiplugin \u6587\u4ef6\u5e76\u542f\u52a8\u670d\u52a1\u3002 1 2 3 4 # git clone git://gerrit.ovirt.org/samples-uiplugins.git # cp -r samples-uiplugins/shellinabox-plugin/* /usr/share/ovirt-engine/ui-plugins/ # service shellinaboxd start # service ovirt-engine restart ```{image} ../images/03-09.png :align: center ``` :::{note} shellinabox \u63d2\u4ef6\u94fe\u63a5\u95ee\u9898 \u7531\u4e8e 3.3 \u5230 3.4 \u4e4b\u540e\u94fe\u63a5\u7684\u53d8\u5316\uff0cshellinabox.json \u4e2d\u7684 /webadmin/webadmin/plugin/ShellBoxPlugin/start.html \u9700\u8981\u66ff\u6362\u4e3a plugin/ShellBoxPlugin/start.html \u3002 ::: :::{note} shellinabox \u7684 root \u767b\u9646\u95ee\u9898 echo -e \"pts0npts1npts2\" >> /etc/securetty :::","title":"UI \u63d2\u4ef6"},{"location":"inthecloud/ch03/#sysprepcloud-init","text":"\u53c2\u8003 https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Virtualization/3.4/html/Administration_Guide/sect-Sealing_Templates_in_Preparation_for_Deployment.html . \u521d\u59cb\u5316 Redhat \u7cfb\u5217 Linux 1","title":"\u4f7f\u7528 SysPrep/Cloud-Init \u91cd\u7f6e\u865a\u62df\u673a\u4fe1\u606f"},{"location":"inthecloud/ch03/#touch-unconfigured","text":"","title":"touch /.unconfigured"},{"location":"inthecloud/ch03/#rm-i-etcsshsshhost","text":"","title":"rm -i /etc/ssh/sshhost*"},{"location":"inthecloud/ch03/#echo-hostnamelocalhostlocaldomain-etcsysconfignetwork","text":"","title":"echo \"HOSTNAME=localhost.localdomain\" &gt;&gt; /etc/sysconfig/network"},{"location":"inthecloud/ch03/#rm-i-etcudevrulesd70-persistent","text":"1 2 3 4 5 6 7 \u5220\u9664 */etc/sysconfig/network-scripts/ifcfg-** \u6587\u4ef6\u4e2d\u7684 **HWADDR=** \u5b57\u6bb5\uff0c\u5220\u9664 */var/log/** \u3001 */root/*.log* \uff0c\u7136\u540e\u5173\u673a\u5373\u53ef\u3002 \u4fee\u6539\u5bc6\u7801 ```{code} # virt-sysprep --root-password password:123456 -a os.img \u521d\u59cb\u5316 Windows 7 \u4f7f\u7528http://www.drbl-winroll.org\u5de5\u5177\u6279\u91cf\u4fee\u6539\u3002 \u4f7f\u7528\u4f4d\u4e8e C:\\Windows\\system32\\sysprep \u76ee\u5f55\u4e0b\u7684\u5de5\u5177\u3002 ```{image} ../images/03-10.jpg :align: center ```","title":"rm -i /etc/udev/rules.d/70-persistent*"},{"location":"inthecloud/ch03/#_12","text":"oVirt \u5e73\u53f0\u76ee\u524d\u53ef\u4ee5\u4f7f\u7528 Foreman\uff0cOpenStack Network\uff0cOpenStack Image \u7684\u90e8\u5206\u529f\u80fd\uff0c\u5177\u4f53\u5b9e\u65bd\u8bf7\u53c2\u9605\u9644\u5f55\u4e00\u5185\u5bb9\u3002 \u4e0e\u8ba4\u8bc1\u670d\u52a1\u5668\u96c6\u6210\u65f6\u5f88\u6709\u53ef\u80fd\u9047\u5230\u5404\u79cd\u95ee\u9898\uff0c\u6bd4\u5982\u4e0e AD \u96c6\u6210\u65f6\u4e0d\u80fd\u4f7f\u7528 Administrator \u7528\u6237\u8fdb\u884c engine-manage-domains\uff0c\u4e0e IPA \u96c6\u6210\u65f6\u9700\u8981\u4fee\u6539 minss \u4e4b\u7c7b\u7684\u53c2\u6570\uff0c\u4e0e LDAP \u96c6\u6210\u65f6\u9700\u8981 Kerberos \u6216\u8005\u4f7f\u7528 3.5 \u7248\u672c\u4e2d\u7684 aaa \u8ba4\u8bc1\u63d2\u4ef6\u3002","title":"\u4e0e\u5176\u4ed6\u5e73\u53f0\u96c6\u6210\u3001\u4e0e\u8ba4\u8bc1\u670d\u52a1\u5668\u96c6\u6210"},{"location":"inthecloud/ch03/#libvirtqemukernel","text":"\u5982\u679c\u4f60\u89c9\u5f97\u73b0\u6709\u5e73\u53f0\u7684\u6027\u80fd\u8fbe\u4e0d\u5230\u9884\u671f\uff0c\u6216\u8005\u6709\u5176\u4ed6\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u65b9\u9762\u8fdb\u884c\u8c03\u8282\u6216\u4f18\u5316\u3002 qemu \uff1a \u6211\u5199\u4e86 \u4e00\u7cfb\u5217 qemu \u7684\u811a\u672c \uff0c\u4f60\u53ef\u4ee5\u8c03\u8282\u91cc\u9762\u7684\u53c2\u6570\u76f4\u63a5\u542f\u52a8\u865a\u62df\u673a\u8fdb\u884c\u8c03\u8bd5\u6216\u8005\u4f18\u5316\u3002 libvirt \uff1a libvirt \u7684\u76ee\u7684\u662f\u7edf\u4e00\u5404\u79cd\u865a\u62df\u5316\u540e\u7aef\u7684\u8c03\u7528\u65b9\u5f0f\uff08kvm/xen/lxc/OpenVZ//VirtualBox/VMWare/Hyper-V \u7b49\u7b49\uff09\uff0c\u4e3b\u8981\u4e00\u4e2a\u7279\u6027\u662f\u7528\u7edf\u4e00\u7684\u63cf\u8ff0\u6587\u4ef6\u6765\u5b9a\u4e49\u865a\u62df\u673a\u914d\u7f6e\uff08xml \u6587\u4ef6\uff09\uff0c\u5728 Linux \u4e0b\u4f60\u53ef\u4ee5\u4f7f\u7528 Virt Manager \u8fdb\u884c\u8c03\u8bd5\uff0c\u76f8\u5173\u6587\u6863\u53c2\u8003 libvirt ref \u3002 kernel \uff1a \u57fa\u672c\u4e0a\u5927\u90e8\u5206\u7684\u5185\u6838\u76f8\u5173\u914d\u7f6e\u90fd\u53ef\u4ee5\u901a\u8fc7 /sys \u6216\u8005 /proc \u8fdb\u884c\u8c03\u8282\uff0c\u800c\u9488\u5bf9\u5185\u6838\u6240\u8c13\u7684\u201c\u4f18\u5316\u201d\uff0c\u5728\u975e\u5927\u89c4\u6a21\u90e8\u7f72\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u4f18\u52bf\u5f88\u96be\u4f53\u73b0\u51fa\u6765\uff0c\u8fd8\u6709\u4e00\u65b9\u9762\uff0c\u76ee\u524d\u7684 KVM \u6548\u7387\uff0cCPU\u3001\u5185\u5b58\u7ba1\u7406\u3001\u7f51\u7edc\u7b49\u65b9\u9762\u90fd\u6bd4\u8f83\u4f18\u79c0\uff0c\u5728 I/O \u65b9\u9762\u8fd8\u6709\u90e8\u5206\u4e0d\u8db3\uff0c\u53ef\u4ee5\u5728 VIRTIO \u4e0a\u8fdb\u884c\u76f8\u5173\u7684\u4f18\u5316\uff0c\u8fd8\u6709\u5f00\u542f HugePage \u7b49\u64cd\u4f5c\u3002","title":"\u540e\u7aef\uff08libvirt/qemu/kernel\uff09\u4f18\u5316"},{"location":"inthecloud/ch04/","text":"\u7b2c\u56db\u7ae0 \u6570\u636e\u6293\u53d6\u4e0e\u673a\u5668\u5b66\u4e60\u7b97\u6cd5 \u5728\u5f00\u59cb\u8fd9\u4e00\u7ae0\u4e4b\u524d\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u8865\u4e60\u4e00\u4e0b\u6570\u5b66\u77e5\u8bc6\uff1b\u8fd8\u6709\u719f\u6089\u4e0b\u5e38\u89c1\u5de5\u5177\uff08\u8bed\u8a00\uff09\uff0c\u4e0d\u5fc5\u591a\u5e74\u5f00\u53d1\u7ecf\u9a8c\uff0c\u4f1a\u5904\u7406\u5e38\u89c1\u6570\u636e\u7ed3\u6784\u3001\u80fd\u683c\u5f0f\u5316\u6587\u4ef6\u5373\u53ef\u3002 \u5efa\u8bae\u5148\u901a\u8bfb\u4e00\u4e0b Scrapy \u4e2d\u6587\u6587\u6863 \uff0c\u8fd9\u6837\u4f60\u4f1a\u7701\u53bb\u597d\u591aGoogle\u7684\u65f6\u95f4\uff1b\u5728 \u77e5\u4e4e \u4e0a\u6709\u8bb8\u591a\u5173\u4e8e \u5927\u6570\u636e \u3001 \u6570\u636e\u6316\u6398 \u7684\u8ba8\u8bba\uff0c\u4f60\u53ef\u4ee5\u53bb\u770b\u770b\u4e86\u89e3\u4e00\u4e9b\u4e1a\u5185\u7684\u52a8\u6001\u3002 \u53e6\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528 Nutch \u6765\u722c\u53d6\uff0c\u5e76\u7528 Solr \u6765\u6784\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u641c\u7d22\u5f15\u64ce\uff0c\u5b83\u4eec\u53ef\u4ee5\u8ddf\u4e0b\u4e00\u7ae0\u8282\u7684Hadoop\u96c6\u6210\u3002 \u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u70b9-- Model Thinking \uff0c\u4f60\u9700\u8981\u7684\u4e0d\u53ea\u662f\u5efa\u6a21\u7684\u77e5\u8bc6\uff0c\u8fd8\u8981\u6709\u5efa\u6a21\u7684\u601d\u60f3\u3002\u6570\u636e\u548c\u7b97\u6cd5\u5e76\u4e0d\u662f\u6700\u91cd\u8981\u7684\uff0c\u91cd\u8981\u7684\u662f\u4f60\u5982\u4f55\u5229\u7528\u8fd9\u4e9b\u6570\u636e\u901a\u8fc7\u4f60\u8bbe\u8ba1\u7684\u6a21\u578b\u6765\u8f93\u51fa\u5bf9\u4f60\u6709\u7528\u7684\u7ed3\u679c\u3002 \u4e0d\u8981\u4ee5\u7f16\u7a0b\u5f00\u59cb\u4f60\u7684\u673a\u5668\u5b66\u4e60\u4e4b\u65c5\uff0c\u8fd9\u6837\u5bb9\u6613\u4f7f\u601d\u7ef4\u53d7\u9650\u4e8e\u8bed\u8a00\uff0c\u4ece\u6a21\u578b\u548c\u7ed3\u679c\u601d\u8003\u53bb\u8fbe\u5230\u4f60\u7684\u76ee\u7684\uff0c\u7f16\u7a0b\u53ea\u662f\u624b\u6bb5\u4e4b\u4e00\u3002 4.1 \u6570\u636e\u6536\u96c6 \u6570\u636e\u6536\u96c6\u662f\u5b66\u4e60\u6570\u636e\u5206\u6790\u7684\u5f00\u59cb\u3002\u6211\u4eec\u6bcf\u4e00\u5929 \u4e3a\u4e86\u7701\u53bb\u4e00\u4e9b\u5b66\u4e60\u7684\u9ebb\u70e6\uff0c\u6211\u627e\u4e86\u4e00\u4e9b \u201c\u5927\u201d\u6570\u636e \uff0c\u6709\u4e9b\u4e0a\u767eTB\u7684\u6570\u636e\u5bf9\u975e\u884c\u4e1a\u5185\u7684\u4eba\u6765\u8bf4\u53ef\u80fd\u6beb\u65e0\u610f\u4e49\uff0c\u4f46\u662f\uff0c\u5148\u6765\u4e9b\u6570\u636e\u5427\uff0c\u4f46\u662f\u5bf9\u5b66\u4e60\u8005\u6765\u8bf4\u8fd8\u662f\u6bd4\u8f83\u5b9e\u7528\u7684\u3002 \u7b80\u5355\u6293\u53d6 \u52a8\u624b\u5199\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u722c\u866b \u5b9e\u9645\u4f7f\u7528\u65f6\u9047\u5230\u7684\u95ee\u9898 \u5206\u5e03\u5f0f\u6293\u53d6 scrapyd scrapy-redis \u4f7f\u7528Nutch + Solr 4.2 \u722c\u866b\u793a\u4f8b 58\u540c\u57ce \u6211\u7b80\u5355\u5199\u4e86\u4e00\u4e2a \u6536\u96c658\u540c\u57ce\u4e2d\u4e0a\u6d77\u51fa\u79df\u623f\u4fe1\u606f\u7684\u722c\u866b \uff0c\u5305\u62ec\u7684\u6761\u76ee\u6709\uff1a \u63cf\u8ff0 \u3001 \u4f4d\u7f6e \u3001 \u4ef7\u683c \u3001 \u623f\u95f4\u6570 \u3001 URL \u3002 \u7531\u4e8e\u8fd9\u4e9b\u4fe1\u606f\u90fd\u53ef\u4ee5\u5728\u5730\u56fe\u4e0a\u8868\u793a\u51fa\u6765\uff0c\u90a3\u6211\u9664\u4e86\u753b\u7edf\u8ba1\u56fe\u4ee5\u5916\u8fd8\u4f1a\u753b\u5b83\u4eec\u5728\u5730\u56fe\u4e0a\u7684\u8868\u793a\u3002 \u77e5\u4e4e http://blog.javachen.com/2014/06/08/using-scrapy-to-cralw-zhihu/ http://segmentfault.com/blog/javachen/1190000000583419 https://github.com/KeithYue/Zhihu_Spider.git \u65b0\u6d6a\u5fae\u535a https://github.com/followyourheart/sina-weibo-crawler 4.3 numpy \u5feb\u67e5 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 import numpy as np a = np.arange(1,5) data_type = [('name','S10'), ('height', 'float'), ('age', int)] values = [('Arthur', 1.8, 41), ('Lancelot', 1.9, 38), ('Galahad', 1.7, 38)] b = np.array(values, dtype=data_type) c = np.arange(6,10) # \u7b26\u53f7 np.sign(a) # \u6570\u7ec4\u6700\u5927\u503c a.max() # \u6570\u7ec4\u6700\u5c0f\u503c a.max() # \u533a\u95f4\u5cf0\u5cf0\u503c a.ptp() # \u4e58\u79ef a.prod() # \u7d2f\u79ef a.cumprod() # \u5e73\u5747\u503c a.mean() # \u4e2d\u503c a.median() # \u5dee\u5206 np.diff(a) # \u65b9\u5dee np.var(a) # \u5143\u7d20\u6761\u4ef6\u67e5\u627e\uff0c\u8fd4\u56deindex\u7684array np.where(a>2) # \u8fd4\u56de\u7b2c2\uff0c3\uff0c5\u4e2a\u5143\u7d20\u7684array np.take(a, np.array(1,2,4)) # \u6392\u5e8f np.msort(a) np.sort(b, kind='mergesort', order='height') # \u5747\u5206\uff0c\u5947\u6570\u4e2a\u5143\u7d20\u7684array\u4e0d\u53ef\u5206\u5272\u4e3a\u5076\u6570\u3002 np.split(b,2) # \u521b\u5efa\u5355\u4f4d\u77e9\u9635 np.eye(3) # \u6700\u5c0f\u4e8c\u4e58\uff0c\u53c2\u6570\u4e3a[x,y,degree]\uff0cdegree\u4e3a\u591a\u9879\u5f0f\u7684\u6700\u9ad8\u6b21\u5e42\uff0c\u8fd4\u56de\u503c\u4e3a\u6240\u6709\u6b21\u5e42\u7684\u7cfb\u6570 np.polyfit(a,c,1) 4.4 \u76d1\u7763\u5b66\u4e60\u5e38\u7528\u7b97\u6cd5\u53caPython\u5b9e\u73b0 \u4fe1\u606f\u5206\u7c7b\u57fa\u7840 \u4fe1\u606f\u7684\u4e0d\u7a33\u5b9a\u6027\u4e3a\u71b5\uff08entropy\uff09\uff0c\u800c\u4fe1\u606f\u589e\u76ca\u4e3a\u6709\u65e0\u6837\u672c\u7279\u5f81\u5bf9\u5206\u7c7b\u95ee\u9898\u5f71\u54cd\u7684\u5927\u5c0f\u3002\u6bd4\u5982\uff0c\u629b\u786c\u5e01\u6b63\u53cd\u4e24\u9762\u5404\u670950%\u6982\u7387\uff0c\u6b64\u65f6\u4e0d\u7a33\u5b9a\u6027\u6700\u5927\uff0c\u71b5\u4e3a1\uff1b\u592a\u9633\u660e\u5929\u7167\u5e38\u5347\u8d77\uff0c\u5219\u662f\u5fc5\u7136\uff0c\u6b64\u4e8b\u4e0d\u7a33\u5b9a\u6027\u6700\u5c0f\uff0c\u71b5\u4e3a0\u3002 \u5047\u8bbe\u4e8b\u4ef6X\uff0c\u53d1\u751f\u6982\u7387\u4e3ax\uff0c\u5176\u4fe1\u606f\u671f\u671b\u503c\u5b9a\u4e49\u4e3a\uff1a 1 l(X) = -log_2 x \u6574\u4e2a\u4fe1\u606f\u7684\u71b5\u4e3a\uff1a 1 H = -\\sum^n_{i=1} log_2 x \u5982\u4f55\u627e\u5230\u6700\u597d\u7684\u5206\u7c7b\u7279\u5f81\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 def chooseBestFeatureToSplit(dataSet): numFeatures = len(dataSet[0]) - 1 #the last column is used for the labels baseEntropy = calcShannonEnt(dataSet) bestInfoGain = 0.0; bestFeature = -1 for i in range(numFeatures): #iterate over all the features featList = [example[i] for example in dataSet]#create a list of all the examples of this feature uniqueVals = set(featList) #get a set of unique values newEntropy = 0.0 for value in uniqueVals: subDataSet = splitDataSet(dataSet, i, value) prob = len(subDataSet)/float(len(dataSet)) newEntropy += prob * calcShannonEnt(subDataSet) infoGain = baseEntropy - newEntropy #calculate the info gain; ie reduction in entropy if (infoGain > bestInfoGain): #compare this to the best gain so far bestInfoGain = infoGain #if better than current best, set to best bestFeature = i return bestFeature #returns an integer \u5176\u4e2d\uff0cdataSet\u4e3a\u6240\u6709\u7279\u5f81\u5411\u91cf\uff0ccaclShannonEnt()\u8ba1\u7b97\u7279\u5f81\u5411\u91cf\u7684\u71b5\uff0csplitDataSet()\u5207\u9664\u5411\u91cf\u4e2d\u7684value\u5217\uff1binfoGain\u5373\u4e3a\u4fe1\u606f\u589e\u76ca\uff0cchooseBestFeatureToSplit\u8fd4\u56de\u6700\u597d\u7684\u7279\u5f81\u5411\u91cf\u7d22\u5f15\u503c\u3002 K\u90bb\u8fd1\u7b97\u6cd5 kNN\u7684\u7b97\u6cd5\u6a21\u578b\u5982\u4e0b\uff1a \u5bf9\u4e8e\u672a\u77e5\u7c7b\u522b\u5c5e\u6027\u7684\u6570\u636e\u4e14\u96c6\u4e2d\u7684\u6bcf\u4e2a\u70b9\u4f9d\u6b21\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u8ba1\u7b97\u5df2\u77e5\u7c7b\u522b\u6570\u636e\u96c6\u4e2d\u7684\u70b9\u4e0e\u5f53\u524d\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb \u6309\u7167\u8ddd\u79bb\u9012\u589e\u4f9d\u6b21\u6392\u5e8f \u9009\u53d6\u4e0e\u5f53\u524d\u70b9\u8ddd\u79bb\u6700\u5c0f\u7684k\u4e2a\u70b9 \u786e\u5b9a\u524dk\u4e2a\u70b9\u6240\u5728\u7c7b\u522b\u7684\u51fa\u73b0\u9891\u7387 \u8fd4\u56de\u524dk\u4e2a\u70b9\u51fa\u73b0\u9891\u7387\u6700\u9ad8\u7684\u7c7b\u522b\u4f5c\u4e3a\u5f53\u524d\u70b9\u7684\u9884\u6d4b\u5206\u7c7b \u4ee3\u7801\u53c2\u8003\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 def classify0(inX, dataSet, labels, k): dataSetSize = dataSet.shape[0] diffMat = tile(inX, (dataSetSize,1)) - dataSet sqDiffMat = diffMat**2 sqDistances = sqDiffMat.sum(axis=1) distances = sqDistances**0.5 sortedDistIndicies = distances.argsort() classCount={} for i in range(k): voteIlabel = labels[sortedDistIndicies[i]] classCount[voteIlabel] = classCount.get(voteIlabel,0) + 1 sortedClassCount = sorted(classCount.iteritems(), key=operator.itemgetter(1), reverse=True) return sortedClassCount[0][0] \u5176\u4e2d\uff0cinX\u4e3a\u8f93\u5165\u5411\u91cf\uff0cdataSet\u4e3a\u6570\u636e\u96c6\uff0clabels\u4e3a\u6570\u636e\u96c6\u7684\u5206\u7c7b\uff0c\u53ef\u8c03\u3002\u8ddd\u79bb\u8ba1\u7b97\u516c\u5f0f\u4e3ad0 = ((x-x0)**2 + (y-y0)**2)**0.5\u3002 \u6b64\u79cd\u7b97\u6cd5\u7684\u4f18\u70b9\u4e3a\u7cbe\u5ea6\u9ad8\u3001\u5bf9\u5f02\u5e38\u503c\u4e0d\u654f\u611f\u3001\u4f46\u7f3a\u70b9\u4e5f\u6bd4\u8f83\u660e\u663e\uff0c\u5373\u6570\u636e\u91cf\u5927\u65f6\u5f00\u652f\u76f8\u5bf9\u8f83\u5927\uff0c\u9002\u7528\u4e8e\u6570\u503c\uff0d\u6807\u79f0\u578b\u6570\u636e\u3002 \u51b3\u7b56\u6811 \u51b3\u7b56\u6811\u5373\u5217\u51fa\u4e00\u7cfb\u5217\u9009\u62e9\uff0c\u6839\u636e\u8bad\u7ec3\u96c6\u4e2d\u7684\u5927\u91cf\u5f62\u4f3c\uff08A\u3001B\u3001C\uff09\u4ee5\u53ca\u7ed3\u679cD\u7684\u5411\u91cf\u6765\u9884\u6d4b\u65b0\u8f93\u5165\uff08A'\u3001B'\u3001C'\uff09\u7684\u7ed3\u679cD'\u3002 \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u51b3\u7b56\u6811\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 def createTree(dataSet,labels): classList = [example[-1] for example in dataSet] if classList.count(classList[0]) == len(classList): return classList[0] #stop splitting when all of the classes are equal if len(dataSet[0]) == 1: #stop splitting when there are no more features in dataSet return majorityCnt(classList) bestFeat = chooseBestFeatureToSplit(dataSet) bestFeatLabel = labels[bestFeat] myTree = {bestFeatLabel:{}} del(labels[bestFeat]) featValues = [example[bestFeat] for example in dataSet] uniqueVals = set(featValues) for value in uniqueVals: subLabels = labels[:] #copy all of labels, so trees don't mess up existing labels myTree[bestFeatLabel][value] = createTree(splitDataSet(dataSet, bestFeat, value),subLabels) return myTree \u627e\u5230\u5f71\u54cd\u6700\u5927\u7684\u7279\u5f81bestFeat\u540e\uff0c\u518d\u521b\u5efa\u6b64\u7279\u5f81\u4e0b\u7684\u5206\u7c7b\u5411\u91cf\u521b\u5efa\u5b50\u6811\u5411\u91cf\uff0c\u7136\u540e\u5c06bestFeat\u5206\u79bb\u540e\u7ee7\u7eed\u8fed\u4ee3\uff0c\u76f4\u81f3\u6240\u6709\u7279\u5f81\u90fd\u8f6c\u6362\u6210\u51b3\u7b56\u8282\u70b9\u3002 \u539f\u59cb\u6570\u636e\u6bd4\u5982\uff1a no-surfacing flippers fish 1 yes yes yes 2 yes yes yes 3 yes no no 4 no yes no 5 no yes no \u4f1a\u751f\u6210\u5982\u4e0b\u51b3\u7b56\u6811\uff1a no-surfacing? / \\ no/ \\yes fish(no) flippers? / \\ no/ \\yes fish(no) fish(yes) \u8868\u793a\u6210JSON\u683c\u5f0f\uff0c\u5373python\u5b57\u5178\uff1a {'no surfacing':{0:'no',1:{'flippers':{0:'no',1:'yes'}}} \u6784\u5efa\u51b3\u7b56\u6811\u7684\u65b9\u6cd5\u6bd4\u8f83\u591a\uff0c\u4e5f\u53ef\u4f7f\u7528C4.5\u548cCART\u7b97\u6cd5\u3002 \u63a5\u4e0b\u6765\u4f7f\u7528\u51b3\u7b56\u6811\u8fdb\u884c\u5206\u7c7b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 def classify(inputTree,featLabels,testVec): firstStr = inputTree.keys()[0] secondDict = inputTree[firstStr] featIndex = featLabels.index(firstStr) key = testVec[featIndex] valueOfFeat = secondDict[key] if isinstance(valueOfFeat, dict): classLabel = classify(valueOfFeat, featLabels, testVec) else: classLabel = valueOfFeat return classLabel \u5176\u4e2d\uff0cfeatLabels\u4e3a\u6d4b\u8bd5\u7684\u5224\u65ad\u8282\u70b9\uff0c\u5373\u7279\u5f81\uff0ctestVec\u4e3a\u5176\u503c\uff0c\u6bd4\u5982classify[myTree,\"['no-surfacing','flippers']\",:[1,1]\"]\uff0c\u5982\u6b64\u7ed3\u679c\u4fbf\u4e3a'no'\u3002 \u4f7f\u7528pickle\u5bf9\u51b3\u7b56\u6811\u8fdb\u884c\u5e8f\u5217\u5316\u5b58\u50a8\uff1a 1 2 3 4 5 6 7 def storeTree(inputTree,filename): import pickle fw = open(filename,'w') pickle.dump(inputTree,fw) fw.close() \u5176\u4e2d\uff0cdump\u53ef\u9009\u534f\u8bae\u4e3a0\uff08ASCII\uff09\uff0c1\uff08BINARY\uff09\uff0c\u9ed8\u8ba4\u4e3a0\uff1b\u8bfb\u53d6\u65f6\u4f7f\u7528pickle.load\uff1b\u540c\u6837\u53ef\u4f7f\u7528dumps\uff0cloads\u76f4\u63a5\u5bf9\u5b57\u7b26\u53d8\u91cf\u8fdb\u884c\u64cd\u4f5c\u3002 \u6b64\u79cd\u7b97\u6cd5\u8ba1\u7b97\u590d\u6742\u5ea6\u4e0d\u9ad8\uff0c\u5bf9\u4e2d\u95f4\u503c\u7f3a\u5931\u4e0d\u654f\u611f\uff0c\u4f46\u53ef\u80fd\u4f1a\u4ea7\u751f\u8fc7\u62df\u5408\u7684\u95ee\u9898\u3002 \u6734\u7d20\u8d1d\u53f6\u65af \u8d1d\u53f6\u65af\u6a21\u578b\u662f\u57fa\u4e8e\u72ec\u7acb\u6982\u7387\u7edf\u8ba1\u7684\uff0c\u601d\u60f3\u5927\u6982\u53ef\u4ee5\u8fd9\u4e48\u8bf4\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 \u603b\u51717\u4e2a\u77f3\u5b50\u5728A\u3001B\u4e24\u4e2a\u6876\u4e2d\uff0cA\u6876\u4e2d\u67092\u9ed12\u767d\uff0cB\u6876\u4e2d\u67092\u9ed11\u767d\u3002\u5df2\u77e5\u6761\u4ef6\u4e3a\u77f3\u5b50\u6765\u81eaB\u6876\uff0c\u90a3\u4e48\u5b83\u662f\u767d\u8272\u77f3\u5b50\u7684\u6982\u7387\u53ef\u8868\u793a\u4e3a\uff1a P(white|B)=P(B|white)P(white)/P(B) \u63a5\u4e0b\u6765\uff0c\u5b9a\u4e49\u4e24\u4e2a\u4e8b\u4ef6A\u3001B\uff0cP(A|B)\u4e0eP(B|A)\u76f8\u4e92\u8f6c\u5316\u7684\u8fc7\u7a0b\u5373\u4e3a\uff1a P(B|A)=P(A|B)P(B)/P(A) \u800c\u6734\u7d20\u8d1d\u53f6\u65af\u53ef\u4ee5\u8fd9\u6837\u63cf\u8ff0\uff1a \u8bbex={a1,a2,...,am}\u4e3a\u5f85\u5206\u7c7b\u9879\uff0ca\u4e3ax\u7684\u7279\u5f81\u5c5e\u6027\uff0c\u7c7b\u522b\u96c6\u5408\u4e3aC={y1,y2,...,ym}\uff0c\u5982\u679cP(yk|x)=max(P(y1|x),P(y2|x),...,P(yn|x))\uff0c\u5219x\u5c5e\u4e8eyk\u3002 \u6574\u4e2a\u7b97\u6cd5\u6838\u5fc3\u5373\u662f\u7b49\u5f0fP(yi|x)=P(x|yi)P(yi)/P(x)\u3002 \u9996\u5148\u6784\u5efa\u4e00\u4e2a\u5206\u7c7b\u8bad\u7ec3\u51fd\u6570\uff08\u4e8c\u5143\u5206\u7c7b\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 def trainNB0(trainMatrix,trainCategory): numTrainDocs = len(trainMatrix) numWords = len(trainMatrix[0]) pBad = sum(trainCategory)/float(numTrainDocs) p0Num = ones(numWords); p1Num = ones(numWords) #change to ones() p0Denom = 2.0; p1Denom = 2.0 #change to 2.0 for i in range(numTrainDocs): if trainCategory[i] == 1: p1Num += trainMatrix[i] p1Denom += sum(trainMatrix[i]) else: p0Num += trainMatrix[i] p0Denom += sum(trainMatrix[i]) p1Vect = log(p1Num/p1Denom) #change to log() p0Vect = log(p0Num/p0Denom) #change to log() return p0Vect,p1Vect,pBad \u5176\u4e2d\uff0ctrainMatrix\u4e3a\u6240\u6709\u8bad\u7ec3\u96c6\u4e2d\u7684\u5e03\u5c14\u5411\u91cf\uff0c\u6bd4\u5982\u4e24\u672c\u4e66A\u3001B\uff0c\u5176\u4e2dA\u6709\u4e24\u4e2a\u5355\u8bcdx\u3001y\uff0cB\u6709\u4e24\u4e2a\u5355\u8bcdx\u3001z\uff0c\u5e76\u4e14A\u662f\u597d\u4e66\uff08\u503c\u8ba1\u4e3a0\uff09\uff0cB\u662f\u70c2\u4e66\uff08\u503c\u8ba1\u4e3a0\uff09\uff0c\u628a\u6240\u6709\u5355\u8bcd\u8fdb\u884c\u6392\u5e8f\u540e\u5f97\u5411\u91cf['x','y','z']\uff0c\u5219A\u7684Matrix\u53ef\u8868\u793a\u4e3a[1,1,0]\uff0cB\u7684\u4e3a[1,0,1]\uff0c\u6240\u4ee5\u6b64\u51fd\u6570\u4e2d\u7684trainMatrix\u5373[[1,1,0],[1,0,1]]\uff0ctrainCategory\u4e3a[0,1]\u3002 \u51fd\u6570\u8fd4\u56de\u7684\u4e3a\u6982\u7387\u96c6\u7684\u5411\u91cf\u3002 \u5206\u7c7b\u51fd\u6570\uff1a 1 2 3 4 5 6 7 8 9 def classifyNB(vec2Classify, p0Vec, p1Vec, pClass1): p1 = sum(vec2Classify * p1Vec) + log(pClass1) #element-wise mult p0 = sum(vec2Classify * p0Vec) + log(1.0 - pClass1) if p1 > p0: return 1 else: return 0 vec2Classify\u5373\u4e3a\u8981\u5206\u7c7b\u7684\u5411\u91cf\uff0c\u5f62\u5982trainMatrix\uff0c\u968f\u540e\u7684\u4e09\u4e2a\u53c2\u6570\u4e3atrainNB0\u6240\u8fd4\u56de\u3002p1\u3001p0\u53ef\u4ee5\u7406\u89e3\u4e3a\u671f\u671b\u6982\u7387\u503c\uff0c\u6bd4\u8f83\u4e24\u8005\u5927\u5c0f\u5373\u53ef\u5212\u5206\u3002 \u6d4b\u8bd5\u7528\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 def testingNB(): listOPosts,listClasses = loadDataSet() myVocabList = createVocabList(listOPosts) trainMat=[] for postinDoc in listOPosts: trainMat.append(setOfWords2Vec(myVocabList, postinDoc)) p0V,p1V,pAb = trainNB0(array(trainMat),array(listClasses)) testEntry = ['love', 'my', 'dalmation'] thisDoc = array(setOfWords2Vec(myVocabList, testEntry)) print testEntry,'classified as: ',classifyNB(thisDoc,p0V,p1V,pAb) testEntry = ['stupid', 'garbage'] thisDoc = array(setOfWords2Vec(myVocabList, testEntry)) print testEntry,'classified as: ',classifyNB(thisDoc,p0V,p1V,pAb) \u6574\u4f53\u6765\u8bf4\uff0c\u6734\u7d20\u8d1d\u53f6\u65af\u5206\u7c7b\u65b9\u6cd5\u5728\u6570\u636e\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\u4ecd\u7136\u6709\u6548\uff0c\u4f46\u662f\u5bf9\u6570\u636e\u8f93\u5165\u6bd4\u8f83\u654f\u611f\u3002 Logistic\u56de\u5f52 \u5728\u7edf\u8ba1\u5b66\u4e2d\uff0c\u7ebf\u6027\u56de\u5f52\u662f\u5229\u7528\u79f0\u4e3a\u7ebf\u6027\u56de\u5f52\u65b9\u7a0b\u7684\u6700\u5c0f\u4e8c\u4e58\u51fd\u6570\u5bf9\u4e00\u4e2a\u6216\u591a\u4e2a\u81ea\u53d8\u91cf\u548c\u56e0\u53d8\u91cf\u4e4b\u95f4\u5173\u7cfb\u8fdb\u884c\u5efa\u6a21\u7684\u4e00\u79cd\u56de\u5f52\u5206\u6790\u3002\u8fd9\u79cd\u51fd\u6570\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u79f0\u4e3a\u56de\u5f52\u7cfb\u6570\u7684\u6a21\u578b\u53c2\u6570\u7684\u7ebf\u6027\u7ec4\u5408\u3002\u53ea\u6709\u4e00\u4e2a\u81ea\u53d8\u91cf\u7684\u60c5\u51b5\u79f0\u4e3a\u7b80\u5355\u56de\u5f52\uff0c\u5927\u4e8e\u4e00\u4e2a\u81ea\u53d8\u91cf\u60c5\u51b5\u7684\u53eb\u505a\u591a\u5143\u56de\u5f52\u3002\uff08 \u7ef4\u57fa\u767e\u79d1 \uff09 \u5148\u4ecb\u7ecd\u4e24\u4e2a\u91cd\u8981\u7684\u6570\u5b66\u6982\u5ff5\u3002 \u6700\u5c0f\u4e8c\u4e58\u6cd5\u5219 \u6700\u5c0f\u4e8c\u4e58\u6cd5\uff08\u53c8\u79f0\u6700\u5c0f\u5e73\u65b9\u6cd5\uff09\u662f\u4e00\u79cd\u6570\u5b66\u4f18\u5316\u6280\u672f\u3002\u5b83\u901a\u8fc7\u6700\u5c0f\u5316\u8bef\u5dee\u7684\u5e73\u65b9\u548c\u5bfb\u627e\u6570\u636e\u7684\u6700\u4f73\u51fd\u6570\u5339\u914d\u3002 \u5229\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u53ef\u4ee5\u7b80\u4fbf\u5730\u6c42\u5f97\u672a\u77e5\u7684\u6570\u636e\uff0c\u5e76\u4f7f\u5f97\u8fd9\u4e9b\u6c42\u5f97\u7684\u6570\u636e\u4e0e\u5b9e\u9645\u6570\u636e\u4e4b\u95f4\u8bef\u5dee\u7684\u5e73\u65b9\u548c\u4e3a\u6700\u5c0f\u3002 \u793a\u4f8b1 \u6709\u56db\u4e2a\u6570\u636e\u70b9(1,6)\u3001(2,5)\u3001(3,7)\u3001(4,10)\uff0c\u6211\u4eec\u5e0c\u671b\u627e\u5230\u4e00\u6761\u76f4\u7ebfy=a+bx\u4e0e\u8fd9\u56db\u4e2a\u70b9\u6700\u5339\u914d\u3002 1 2 3 4 5 6 7 a+1b=6 a+2b=5 a+3b=7 a+4b=10 \u91c7\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u4f7f\u7b49\u53f7\u4e24\u8fb9\u7684\u65b9\u5dee\u5c3d\u53ef\u80fd\u5c0f\uff0c\u4e5f\u5c31\u662f\u627e\u51fa\u8fd9\u4e2a\u51fd\u6570\u7684\u6700\u5c0f\u503c\uff1a 1 S(a,b) = [6-(a+1b)]^2+[5-(a+2b)]^2+[7-(a+3b)]^2+[10-(a+4b)]^2 \u7136\u540e\u5bf9S(a,b)\u6c42a,b\u7684\u504f\u5bfc\u6570\uff0c\u4f7f\u5176\u4e3a0\u5f97\u5230\uff1a 1 2 3 \\cfrac{{\\partial}S}{{\\partial}a} = 0 = 8a+20b-56 \\cfrac{{\\partial}S}{{\\partial}b} = 0 = 20a+60b-154 \u8fd9\u6837\u5c31\u89e3\u51fa\uff1a 1 a=3.5,b=1.4 \u6240\u4ee5\u76f4\u7ebfy=3.5+1.4x\u662f\u6700\u4f73\u7684\u3002 \u51fd\u6570\u8868\u793a 1 \\min_{\\vec{b}}{\\sum^n_{i=1}}(y_m-y_i)^2 \u6b27\u51e0\u91cc\u5fb7\u8868\u793a 1 \\min_{ \\vec{b} } \\| \\vec{y}_{m} ( \\vec{b} ) - \\vec{y} \\|_{2} \u7ebf\u6027\u51fd\u6570\u6a21\u578b \u5178\u578b\u7684\u4e00\u7c7b\u51fd\u6570\u6a21\u578b\u662f\u7ebf\u6027\u51fd\u6570\u6a21\u578b\u3002\u6700\u7b80\u5355\u7684\u7ebf\u6027\u5f0f\u662f 1 y = b_0 + b_1 t \u5199\u6210\u77e9\u9635\u5f0f\uff0c\u4e3a 1 \\min_{b_0,b_1}\\left\\|\\begin{pmatrix}1 & t_1 \\\\ \\vdots & \\vdots \\\\ 1 & t_n \\end{pmatrix}\\begin{pmatrix} b_0\\\\ b_1\\end{pmatrix} - \\begin{pmatrix} y_1 \\\\ \\vdots \\\\ y_{n}\\end{pmatrix}\\right\\|_{2} = \\min_b\\|Ab-Y\\|_2 \u76f4\u63a5\u7ed9\u51fa\u8be5\u5f0f\u7684\u53c2\u6570\u89e3\uff1a 1 2 3 b_1 = \\frac{\\sum_{i=1}^n t_iy_i - n \\cdot \\bar t \\bar y}{\\sum_{i=1}^n t_i^2- n \\cdot (\\bar t)^2} b_0 = \\bar y - b_1 \\bar t \u5176\u4e2d 1 \\bar t = \\frac{1}{n} \\sum_{i=1}^n t_i \u4e3at\u503c\u7684\u7b97\u672f\u5e73\u5747\u503c\u3002\u4e5f\u53ef\u89e3\u5f97\u5982\u4e0b\u5f62\u5f0f\uff1a 1 b_1 = \\frac{\\sum_{i=1}^n (t_i - \\bar t)(y_i - \\bar y)}{\\sum_{i=1}^n (t_i - \\bar t)^2} \u793a\u4f8b2 \u968f\u673a\u9009\u5b9a10\u8258\u6218\u8230\uff0c\u5e76\u5206\u6790\u5b83\u4eec\u7684\u957f\u5ea6\u4e0e\u5bbd\u5ea6\uff0c\u5bfb\u627e\u5b83\u4eec\u957f\u5ea6\u4e0e\u5bbd\u5ea6\u4e4b\u95f4\u7684\u5173\u7cfb\u3002\u7531\u4e0b\u9762\u7684\u63cf\u70b9\u56fe\u53ef\u4ee5\u76f4\u89c2\u5730\u770b\u51fa\uff0c\u4e00\u8258\u6218\u8230\u7684\u957f\u5ea6\uff08t\uff09\u4e0e\u5bbd\u5ea6\uff08y\uff09\u57fa\u672c\u5448\u7ebf\u6027\u5173\u7cfb\u3002\u6563\u70b9\u56fe\u5982\u4e0b\uff1a ```{image} ../images/04-02.png :align: center 1 2 3 4 \u4ee5\u4e0b\u56fe\u8868\u5217\u51fa\u4e86\u5404\u6218\u8230\u7684\u6570\u636e\uff0c\u968f\u540e\u6b65\u9aa4\u662f\u91c7\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u786e\u5b9a\u4e24\u53d8\u91cf\u95f4\u7684\u7ebf\u6027\u5173\u7cfb\u3002 ```{image} ../images/04-03.png :align: center \u4eff\u7167\u4e0a\u9762\u7ed9\u51fa\u7684\u4f8b\u5b50 1 \\bar t = \\frac {\\sum_{i=1}^n t_i}{n} = \\frac {1678}{10} = 167{.}8 \u5e76\u5f97\u5230\u76f8\u5e94\u7684 1 \\bar y = 18{.}41 \u7136\u540e\u786e\u5b9ab1 1 2 3 b_1 = \\frac{\\sum_{i=1}^n (t_i- \\bar {t})(y_i - \\bar y)}{\\sum_{i=1}^n (t_i- \\bar t)^2} = \\frac{3287{.}820} {20391{.}60} = 0{.}1612 \\; \u53ef\u4ee5\u770b\u51fa\uff0c\u6218\u8230\u7684\u957f\u5ea6\u6bcf\u53d8\u53161m\uff0c\u76f8\u5bf9\u5e94\u7684\u5bbd\u5ea6\u4fbf\u8981\u53d8\u531616cm\u3002\u5e76\u7531\u4e0b\u5f0f\u5f97\u5230\u5e38\u6570\u9879b0\uff1a 1 b_0 = \\bar y - b_1 \\bar t = 18{.}41 - 0{.}1612 \\cdot 167{.}8 = -8{.}6394 \u53ef\u4ee5\u770b\u51fa\u70b9\u7684\u62df\u5408\u975e\u5e38\u597d\uff0c\u957f\u5ea6\u548c\u5bbd\u5ea6\u7684\u76f8\u5173\u6027\u5927\u7ea6\u4e3a96.03\uff05\u3002 \u5229\u7528Matlab\u5f97\u5230\u62df\u5408\u76f4\u7ebf\uff1a ```{image} ../images/04-04.png :align: center 1 2 3 4 5 6 7 **Sigmoid\u51fd\u6570** Sigmoid\u51fd\u6570\u5177\u6709\u5355\u4f4d\u9636\u8dc3\u51fd\u6570\u7684\u6027\u8d28\uff0c\u516c\u5f0f\u8868\u793a\u4e3a\uff1a ```{math} \\sigma (z)=\\cfrac{1}{1+e^{-z}} ```{image} ../images/04-01.png :align: center 1 2 3 4 5 \u6211\u4eec\u5c06\u8f93\u5165\u8bb0\u4e3az\uff0c\u6709\u4e0b\u9762\u7684\u516c\u5f0f\u5f97\u51fa\uff1a ```{math} z=w_0 x_0 + w_1 x_1 + w_2 x_2 + \\dots + w_n x_n \u4f7f\u7528\u5411\u91cf\u5199\u6cd5\uff1a 1 z=w^T x \u5176\u4e2d\u5411\u91cfx\u662f\u5206\u7c7b\u5668\u7684\u8f93\u5165\u6570\u636e\uff0c\u5411\u91cfw\u5c31\u662f\u6211\u4eec\u8981\u627e\u5230\u7684\u6700\u4f73\u7cfb\u6570\u3002 \u57fa\u4e8e\u4f18\u5316\u65b9\u6cd5\u786e\u5b9a\u56de\u5f52\u7cfb\u6570 \u68af\u5ea6\u4e0a\u5347/\u4e0b\u964d\u6cd5 \u68af\u5ea6\u4e0a\u5347\u6cd5/\u4e0b\u964d\u6cd5\u7684\u601d\u60f3\u662f\uff1a\u8981\u627e\u5230\u51fd\u6570\u7684\u6700\u5927\u503c\uff0c\u6700\u597d\u7684\u65b9\u6cd5\u662f\u6cbf\u7740\u8be5\u51fd\u6570\u7684\u68af\u5ea6\u65b9\u5411\u63a2\u5bfb\uff0c\u51fd\u6570f(x,y)\u7684\u68af\u5ea6\u5982\u4e0b\u8868\u793a\uff1a 1 {\\nabla}f(x,y)=\\begin{pmatrix} \\cfrac{{\\partial}f(x,y)}{{\\partial}x} \\\\ \\cfrac{{\\partial}f(x,y)}{{\\partial}y}\\end{pmatrix} \u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\u6b64\u7b97\u6cd5\uff1a \u4ece\u524d\u6709\u4e00\u5ea7\u5c71\uff0c\u4e00\u4e2a\u61d2\u4eba\u8981\u722c\u5c71\uff0c\u4ed6\u4ece\u5c71\u811a\u4e0b\u7684\u4efb\u610f\u4f4d\u7f6e\u5411\u5c71\u9876\u51fa\u53d1\uff0c\u5e76\u4e14\u77e5\u9053\u7b49\u9ad8\u7ebf\u56fe\u7684\u6bcf\u4e2a\u73af\u4e0a\u90fd\u6709\u4e00\u4e2a\u5bbf\u8425\u70b9\uff0c\u4ed6\u5e0c\u671b\u5728\u8fd9\u4e9b\u5bbf\u8425\u70b9\u4e4b\u95f4\u4fee\u5efa\u4e00\u6761\u7b14\u76f4\u7684\u8def\uff0c\u5e76\u4e14\u8def\u5230\u4e24\u65c1\u7684\u5bbf\u8425\u70b9\u7684\u5782\u76f4\u8ddd\u79bb\u5dee\u7684\u5e73\u65b9\u548c\u5c3d\u53ef\u80fd\u5c0f\u3002\u6bcf\u5230\u4e00\u4e2a\u7b49\u9ad8\u7ebf\u5708\uff0c\u4ed6\u90fd\u4f1a\u6839\u636e\u4ed6\u5728\u4e0a\u4e00\u4e2a\u7b49\u9ad8\u7ebf\u7684\u8ddd\u79bb\u7684\u53d8\u5316\u91cf\u6765\u8c03\u8282\u4ed6\u7684\u5728\u7b49\u9ad8\u7ebf\u4e0a\u7684\u4f4d\u7f6e\uff0c\u4ece\u800c\u4f7f\u516c\u8def\u6ee1\u8db3\u8981\u6c42\u3002 \u8fd4\u56de\u56de\u5f52\u7cfb\u6570\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 def gradAscent(dataMatIn, classLabels): dataMatrix = mat(dataMatIn) #convert to NumPy matrix labelMat = mat(classLabels).transpose() #convert to NumPy matrix m,n = shape(dataMatrix) alpha = 0.001 maxCycles = 500 weights = ones((n,1)) for k in range(maxCycles): #heavy on matrix operations h = sigmoid(dataMatrix*weights) #matrix mult error = (labelMat - h) #vector subtraction weights = weights + alpha * dataMatrix.transpose()* error #matrix mult return weights \u5176\u4e2d\uff0c\u8bef\u5dee\u503c\u4e58\u4ee5\u77e9\u9635\u7684\u8f6c\u79e9\u4ee3\u8868\u68af\u5ea6\u3002 \u5f85\u4fee\u6539\u3002 SVM SVM\uff08Supprot Vector Machines\uff09\u5373\u652f\u6301\u5411\u91cf\u673a\uff0c\u5b8c\u5168\u7406\u89e3\u5176\u7406\u8bba\u77e5\u8bc6\u5bf9\u6570\u5b66\u8981\u6c42\u8f83\u9ad8\u3002 AdaBoost 4.5 \u65e0\u76d1\u7763\u5b66\u4e60 4.6 \u6570\u636e\u53ef\u89c6\u5316 \u6570\u636e\u7edf\u8ba1 Gephi GraphViz python-matplotlib Microsoft Excel 2013 PowerView \u5730\u7406\u4f4d\u7f6e\u8868\u793a \u767e\u5ea6\u5730\u56feAPI MaxMind GeoIP Microsoft Excel 2013 PowerView\u4f7f\u7528\u793a\u4f8b 4.7 \u673a\u5668\u5b66\u4e60\u5de5\u5177 Weka Netlogo SciKit Pandas","title":"\u7b2c\u56db\u7ae0 \u6570\u636e\u6293\u53d6\u4e0e\u673a\u5668\u5b66\u4e60\u7b97\u6cd5"},{"location":"inthecloud/ch04/#_1","text":"\u5728\u5f00\u59cb\u8fd9\u4e00\u7ae0\u4e4b\u524d\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u8865\u4e60\u4e00\u4e0b\u6570\u5b66\u77e5\u8bc6\uff1b\u8fd8\u6709\u719f\u6089\u4e0b\u5e38\u89c1\u5de5\u5177\uff08\u8bed\u8a00\uff09\uff0c\u4e0d\u5fc5\u591a\u5e74\u5f00\u53d1\u7ecf\u9a8c\uff0c\u4f1a\u5904\u7406\u5e38\u89c1\u6570\u636e\u7ed3\u6784\u3001\u80fd\u683c\u5f0f\u5316\u6587\u4ef6\u5373\u53ef\u3002 \u5efa\u8bae\u5148\u901a\u8bfb\u4e00\u4e0b Scrapy \u4e2d\u6587\u6587\u6863 \uff0c\u8fd9\u6837\u4f60\u4f1a\u7701\u53bb\u597d\u591aGoogle\u7684\u65f6\u95f4\uff1b\u5728 \u77e5\u4e4e \u4e0a\u6709\u8bb8\u591a\u5173\u4e8e \u5927\u6570\u636e \u3001 \u6570\u636e\u6316\u6398 \u7684\u8ba8\u8bba\uff0c\u4f60\u53ef\u4ee5\u53bb\u770b\u770b\u4e86\u89e3\u4e00\u4e9b\u4e1a\u5185\u7684\u52a8\u6001\u3002 \u53e6\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528 Nutch \u6765\u722c\u53d6\uff0c\u5e76\u7528 Solr \u6765\u6784\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u641c\u7d22\u5f15\u64ce\uff0c\u5b83\u4eec\u53ef\u4ee5\u8ddf\u4e0b\u4e00\u7ae0\u8282\u7684Hadoop\u96c6\u6210\u3002 \u8fd8\u6709\u4e00\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\u70b9-- Model Thinking \uff0c\u4f60\u9700\u8981\u7684\u4e0d\u53ea\u662f\u5efa\u6a21\u7684\u77e5\u8bc6\uff0c\u8fd8\u8981\u6709\u5efa\u6a21\u7684\u601d\u60f3\u3002\u6570\u636e\u548c\u7b97\u6cd5\u5e76\u4e0d\u662f\u6700\u91cd\u8981\u7684\uff0c\u91cd\u8981\u7684\u662f\u4f60\u5982\u4f55\u5229\u7528\u8fd9\u4e9b\u6570\u636e\u901a\u8fc7\u4f60\u8bbe\u8ba1\u7684\u6a21\u578b\u6765\u8f93\u51fa\u5bf9\u4f60\u6709\u7528\u7684\u7ed3\u679c\u3002 \u4e0d\u8981\u4ee5\u7f16\u7a0b\u5f00\u59cb\u4f60\u7684\u673a\u5668\u5b66\u4e60\u4e4b\u65c5\uff0c\u8fd9\u6837\u5bb9\u6613\u4f7f\u601d\u7ef4\u53d7\u9650\u4e8e\u8bed\u8a00\uff0c\u4ece\u6a21\u578b\u548c\u7ed3\u679c\u601d\u8003\u53bb\u8fbe\u5230\u4f60\u7684\u76ee\u7684\uff0c\u7f16\u7a0b\u53ea\u662f\u624b\u6bb5\u4e4b\u4e00\u3002","title":"\u7b2c\u56db\u7ae0 \u6570\u636e\u6293\u53d6\u4e0e\u673a\u5668\u5b66\u4e60\u7b97\u6cd5"},{"location":"inthecloud/ch04/#41","text":"\u6570\u636e\u6536\u96c6\u662f\u5b66\u4e60\u6570\u636e\u5206\u6790\u7684\u5f00\u59cb\u3002\u6211\u4eec\u6bcf\u4e00\u5929 \u4e3a\u4e86\u7701\u53bb\u4e00\u4e9b\u5b66\u4e60\u7684\u9ebb\u70e6\uff0c\u6211\u627e\u4e86\u4e00\u4e9b \u201c\u5927\u201d\u6570\u636e \uff0c\u6709\u4e9b\u4e0a\u767eTB\u7684\u6570\u636e\u5bf9\u975e\u884c\u4e1a\u5185\u7684\u4eba\u6765\u8bf4\u53ef\u80fd\u6beb\u65e0\u610f\u4e49\uff0c\u4f46\u662f\uff0c\u5148\u6765\u4e9b\u6570\u636e\u5427\uff0c\u4f46\u662f\u5bf9\u5b66\u4e60\u8005\u6765\u8bf4\u8fd8\u662f\u6bd4\u8f83\u5b9e\u7528\u7684\u3002","title":"4.1 \u6570\u636e\u6536\u96c6"},{"location":"inthecloud/ch04/#_2","text":"","title":"\u7b80\u5355\u6293\u53d6"},{"location":"inthecloud/ch04/#_3","text":"","title":"\u52a8\u624b\u5199\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u722c\u866b"},{"location":"inthecloud/ch04/#_4","text":"","title":"\u5b9e\u9645\u4f7f\u7528\u65f6\u9047\u5230\u7684\u95ee\u9898"},{"location":"inthecloud/ch04/#_5","text":"","title":"\u5206\u5e03\u5f0f\u6293\u53d6"},{"location":"inthecloud/ch04/#scrapyd","text":"","title":"scrapyd"},{"location":"inthecloud/ch04/#scrapy-redis","text":"","title":"scrapy-redis"},{"location":"inthecloud/ch04/#nutch-solr","text":"","title":"\u4f7f\u7528Nutch + Solr"},{"location":"inthecloud/ch04/#42","text":"","title":"4.2 \u722c\u866b\u793a\u4f8b"},{"location":"inthecloud/ch04/#58","text":"\u6211\u7b80\u5355\u5199\u4e86\u4e00\u4e2a \u6536\u96c658\u540c\u57ce\u4e2d\u4e0a\u6d77\u51fa\u79df\u623f\u4fe1\u606f\u7684\u722c\u866b \uff0c\u5305\u62ec\u7684\u6761\u76ee\u6709\uff1a \u63cf\u8ff0 \u3001 \u4f4d\u7f6e \u3001 \u4ef7\u683c \u3001 \u623f\u95f4\u6570 \u3001 URL \u3002 \u7531\u4e8e\u8fd9\u4e9b\u4fe1\u606f\u90fd\u53ef\u4ee5\u5728\u5730\u56fe\u4e0a\u8868\u793a\u51fa\u6765\uff0c\u90a3\u6211\u9664\u4e86\u753b\u7edf\u8ba1\u56fe\u4ee5\u5916\u8fd8\u4f1a\u753b\u5b83\u4eec\u5728\u5730\u56fe\u4e0a\u7684\u8868\u793a\u3002","title":"58\u540c\u57ce"},{"location":"inthecloud/ch04/#_6","text":"http://blog.javachen.com/2014/06/08/using-scrapy-to-cralw-zhihu/ http://segmentfault.com/blog/javachen/1190000000583419 https://github.com/KeithYue/Zhihu_Spider.git","title":"\u77e5\u4e4e"},{"location":"inthecloud/ch04/#_7","text":"https://github.com/followyourheart/sina-weibo-crawler","title":"\u65b0\u6d6a\u5fae\u535a"},{"location":"inthecloud/ch04/#43-numpy","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 import numpy as np a = np.arange(1,5) data_type = [('name','S10'), ('height', 'float'), ('age', int)] values = [('Arthur', 1.8, 41), ('Lancelot', 1.9, 38), ('Galahad', 1.7, 38)] b = np.array(values, dtype=data_type) c = np.arange(6,10) # \u7b26\u53f7 np.sign(a) # \u6570\u7ec4\u6700\u5927\u503c a.max() # \u6570\u7ec4\u6700\u5c0f\u503c a.max() # \u533a\u95f4\u5cf0\u5cf0\u503c a.ptp() # \u4e58\u79ef a.prod() # \u7d2f\u79ef a.cumprod() # \u5e73\u5747\u503c a.mean() # \u4e2d\u503c a.median() # \u5dee\u5206 np.diff(a) # \u65b9\u5dee np.var(a) # \u5143\u7d20\u6761\u4ef6\u67e5\u627e\uff0c\u8fd4\u56deindex\u7684array np.where(a>2) # \u8fd4\u56de\u7b2c2\uff0c3\uff0c5\u4e2a\u5143\u7d20\u7684array np.take(a, np.array(1,2,4)) # \u6392\u5e8f np.msort(a) np.sort(b, kind='mergesort', order='height') # \u5747\u5206\uff0c\u5947\u6570\u4e2a\u5143\u7d20\u7684array\u4e0d\u53ef\u5206\u5272\u4e3a\u5076\u6570\u3002 np.split(b,2) # \u521b\u5efa\u5355\u4f4d\u77e9\u9635 np.eye(3) # \u6700\u5c0f\u4e8c\u4e58\uff0c\u53c2\u6570\u4e3a[x,y,degree]\uff0cdegree\u4e3a\u591a\u9879\u5f0f\u7684\u6700\u9ad8\u6b21\u5e42\uff0c\u8fd4\u56de\u503c\u4e3a\u6240\u6709\u6b21\u5e42\u7684\u7cfb\u6570 np.polyfit(a,c,1)","title":"4.3 numpy \u5feb\u67e5"},{"location":"inthecloud/ch04/#44-python","text":"","title":"4.4 \u76d1\u7763\u5b66\u4e60\u5e38\u7528\u7b97\u6cd5\u53caPython\u5b9e\u73b0"},{"location":"inthecloud/ch04/#_8","text":"\u4fe1\u606f\u7684\u4e0d\u7a33\u5b9a\u6027\u4e3a\u71b5\uff08entropy\uff09\uff0c\u800c\u4fe1\u606f\u589e\u76ca\u4e3a\u6709\u65e0\u6837\u672c\u7279\u5f81\u5bf9\u5206\u7c7b\u95ee\u9898\u5f71\u54cd\u7684\u5927\u5c0f\u3002\u6bd4\u5982\uff0c\u629b\u786c\u5e01\u6b63\u53cd\u4e24\u9762\u5404\u670950%\u6982\u7387\uff0c\u6b64\u65f6\u4e0d\u7a33\u5b9a\u6027\u6700\u5927\uff0c\u71b5\u4e3a1\uff1b\u592a\u9633\u660e\u5929\u7167\u5e38\u5347\u8d77\uff0c\u5219\u662f\u5fc5\u7136\uff0c\u6b64\u4e8b\u4e0d\u7a33\u5b9a\u6027\u6700\u5c0f\uff0c\u71b5\u4e3a0\u3002 \u5047\u8bbe\u4e8b\u4ef6X\uff0c\u53d1\u751f\u6982\u7387\u4e3ax\uff0c\u5176\u4fe1\u606f\u671f\u671b\u503c\u5b9a\u4e49\u4e3a\uff1a 1 l(X) = -log_2 x \u6574\u4e2a\u4fe1\u606f\u7684\u71b5\u4e3a\uff1a 1 H = -\\sum^n_{i=1} log_2 x \u5982\u4f55\u627e\u5230\u6700\u597d\u7684\u5206\u7c7b\u7279\u5f81\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 def chooseBestFeatureToSplit(dataSet): numFeatures = len(dataSet[0]) - 1 #the last column is used for the labels baseEntropy = calcShannonEnt(dataSet) bestInfoGain = 0.0; bestFeature = -1 for i in range(numFeatures): #iterate over all the features featList = [example[i] for example in dataSet]#create a list of all the examples of this feature uniqueVals = set(featList) #get a set of unique values newEntropy = 0.0 for value in uniqueVals: subDataSet = splitDataSet(dataSet, i, value) prob = len(subDataSet)/float(len(dataSet)) newEntropy += prob * calcShannonEnt(subDataSet) infoGain = baseEntropy - newEntropy #calculate the info gain; ie reduction in entropy if (infoGain > bestInfoGain): #compare this to the best gain so far bestInfoGain = infoGain #if better than current best, set to best bestFeature = i return bestFeature #returns an integer \u5176\u4e2d\uff0cdataSet\u4e3a\u6240\u6709\u7279\u5f81\u5411\u91cf\uff0ccaclShannonEnt()\u8ba1\u7b97\u7279\u5f81\u5411\u91cf\u7684\u71b5\uff0csplitDataSet()\u5207\u9664\u5411\u91cf\u4e2d\u7684value\u5217\uff1binfoGain\u5373\u4e3a\u4fe1\u606f\u589e\u76ca\uff0cchooseBestFeatureToSplit\u8fd4\u56de\u6700\u597d\u7684\u7279\u5f81\u5411\u91cf\u7d22\u5f15\u503c\u3002","title":"\u4fe1\u606f\u5206\u7c7b\u57fa\u7840"},{"location":"inthecloud/ch04/#k","text":"kNN\u7684\u7b97\u6cd5\u6a21\u578b\u5982\u4e0b\uff1a \u5bf9\u4e8e\u672a\u77e5\u7c7b\u522b\u5c5e\u6027\u7684\u6570\u636e\u4e14\u96c6\u4e2d\u7684\u6bcf\u4e2a\u70b9\u4f9d\u6b21\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a \u8ba1\u7b97\u5df2\u77e5\u7c7b\u522b\u6570\u636e\u96c6\u4e2d\u7684\u70b9\u4e0e\u5f53\u524d\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb \u6309\u7167\u8ddd\u79bb\u9012\u589e\u4f9d\u6b21\u6392\u5e8f \u9009\u53d6\u4e0e\u5f53\u524d\u70b9\u8ddd\u79bb\u6700\u5c0f\u7684k\u4e2a\u70b9 \u786e\u5b9a\u524dk\u4e2a\u70b9\u6240\u5728\u7c7b\u522b\u7684\u51fa\u73b0\u9891\u7387 \u8fd4\u56de\u524dk\u4e2a\u70b9\u51fa\u73b0\u9891\u7387\u6700\u9ad8\u7684\u7c7b\u522b\u4f5c\u4e3a\u5f53\u524d\u70b9\u7684\u9884\u6d4b\u5206\u7c7b \u4ee3\u7801\u53c2\u8003\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 def classify0(inX, dataSet, labels, k): dataSetSize = dataSet.shape[0] diffMat = tile(inX, (dataSetSize,1)) - dataSet sqDiffMat = diffMat**2 sqDistances = sqDiffMat.sum(axis=1) distances = sqDistances**0.5 sortedDistIndicies = distances.argsort() classCount={} for i in range(k): voteIlabel = labels[sortedDistIndicies[i]] classCount[voteIlabel] = classCount.get(voteIlabel,0) + 1 sortedClassCount = sorted(classCount.iteritems(), key=operator.itemgetter(1), reverse=True) return sortedClassCount[0][0] \u5176\u4e2d\uff0cinX\u4e3a\u8f93\u5165\u5411\u91cf\uff0cdataSet\u4e3a\u6570\u636e\u96c6\uff0clabels\u4e3a\u6570\u636e\u96c6\u7684\u5206\u7c7b\uff0c\u53ef\u8c03\u3002\u8ddd\u79bb\u8ba1\u7b97\u516c\u5f0f\u4e3ad0 = ((x-x0)**2 + (y-y0)**2)**0.5\u3002 \u6b64\u79cd\u7b97\u6cd5\u7684\u4f18\u70b9\u4e3a\u7cbe\u5ea6\u9ad8\u3001\u5bf9\u5f02\u5e38\u503c\u4e0d\u654f\u611f\u3001\u4f46\u7f3a\u70b9\u4e5f\u6bd4\u8f83\u660e\u663e\uff0c\u5373\u6570\u636e\u91cf\u5927\u65f6\u5f00\u652f\u76f8\u5bf9\u8f83\u5927\uff0c\u9002\u7528\u4e8e\u6570\u503c\uff0d\u6807\u79f0\u578b\u6570\u636e\u3002","title":"K\u90bb\u8fd1\u7b97\u6cd5"},{"location":"inthecloud/ch04/#_9","text":"\u51b3\u7b56\u6811\u5373\u5217\u51fa\u4e00\u7cfb\u5217\u9009\u62e9\uff0c\u6839\u636e\u8bad\u7ec3\u96c6\u4e2d\u7684\u5927\u91cf\u5f62\u4f3c\uff08A\u3001B\u3001C\uff09\u4ee5\u53ca\u7ed3\u679cD\u7684\u5411\u91cf\u6765\u9884\u6d4b\u65b0\u8f93\u5165\uff08A'\u3001B'\u3001C'\uff09\u7684\u7ed3\u679cD'\u3002 \u9996\u5148\u521b\u5efa\u4e00\u4e2a\u51b3\u7b56\u6811\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 def createTree(dataSet,labels): classList = [example[-1] for example in dataSet] if classList.count(classList[0]) == len(classList): return classList[0] #stop splitting when all of the classes are equal if len(dataSet[0]) == 1: #stop splitting when there are no more features in dataSet return majorityCnt(classList) bestFeat = chooseBestFeatureToSplit(dataSet) bestFeatLabel = labels[bestFeat] myTree = {bestFeatLabel:{}} del(labels[bestFeat]) featValues = [example[bestFeat] for example in dataSet] uniqueVals = set(featValues) for value in uniqueVals: subLabels = labels[:] #copy all of labels, so trees don't mess up existing labels myTree[bestFeatLabel][value] = createTree(splitDataSet(dataSet, bestFeat, value),subLabels) return myTree \u627e\u5230\u5f71\u54cd\u6700\u5927\u7684\u7279\u5f81bestFeat\u540e\uff0c\u518d\u521b\u5efa\u6b64\u7279\u5f81\u4e0b\u7684\u5206\u7c7b\u5411\u91cf\u521b\u5efa\u5b50\u6811\u5411\u91cf\uff0c\u7136\u540e\u5c06bestFeat\u5206\u79bb\u540e\u7ee7\u7eed\u8fed\u4ee3\uff0c\u76f4\u81f3\u6240\u6709\u7279\u5f81\u90fd\u8f6c\u6362\u6210\u51b3\u7b56\u8282\u70b9\u3002 \u539f\u59cb\u6570\u636e\u6bd4\u5982\uff1a no-surfacing flippers fish 1 yes yes yes 2 yes yes yes 3 yes no no 4 no yes no 5 no yes no \u4f1a\u751f\u6210\u5982\u4e0b\u51b3\u7b56\u6811\uff1a no-surfacing? / \\ no/ \\yes fish(no) flippers? / \\ no/ \\yes fish(no) fish(yes) \u8868\u793a\u6210JSON\u683c\u5f0f\uff0c\u5373python\u5b57\u5178\uff1a {'no surfacing':{0:'no',1:{'flippers':{0:'no',1:'yes'}}} \u6784\u5efa\u51b3\u7b56\u6811\u7684\u65b9\u6cd5\u6bd4\u8f83\u591a\uff0c\u4e5f\u53ef\u4f7f\u7528C4.5\u548cCART\u7b97\u6cd5\u3002 \u63a5\u4e0b\u6765\u4f7f\u7528\u51b3\u7b56\u6811\u8fdb\u884c\u5206\u7c7b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 def classify(inputTree,featLabels,testVec): firstStr = inputTree.keys()[0] secondDict = inputTree[firstStr] featIndex = featLabels.index(firstStr) key = testVec[featIndex] valueOfFeat = secondDict[key] if isinstance(valueOfFeat, dict): classLabel = classify(valueOfFeat, featLabels, testVec) else: classLabel = valueOfFeat return classLabel \u5176\u4e2d\uff0cfeatLabels\u4e3a\u6d4b\u8bd5\u7684\u5224\u65ad\u8282\u70b9\uff0c\u5373\u7279\u5f81\uff0ctestVec\u4e3a\u5176\u503c\uff0c\u6bd4\u5982classify[myTree,\"['no-surfacing','flippers']\",:[1,1]\"]\uff0c\u5982\u6b64\u7ed3\u679c\u4fbf\u4e3a'no'\u3002 \u4f7f\u7528pickle\u5bf9\u51b3\u7b56\u6811\u8fdb\u884c\u5e8f\u5217\u5316\u5b58\u50a8\uff1a 1 2 3 4 5 6 7 def storeTree(inputTree,filename): import pickle fw = open(filename,'w') pickle.dump(inputTree,fw) fw.close() \u5176\u4e2d\uff0cdump\u53ef\u9009\u534f\u8bae\u4e3a0\uff08ASCII\uff09\uff0c1\uff08BINARY\uff09\uff0c\u9ed8\u8ba4\u4e3a0\uff1b\u8bfb\u53d6\u65f6\u4f7f\u7528pickle.load\uff1b\u540c\u6837\u53ef\u4f7f\u7528dumps\uff0cloads\u76f4\u63a5\u5bf9\u5b57\u7b26\u53d8\u91cf\u8fdb\u884c\u64cd\u4f5c\u3002 \u6b64\u79cd\u7b97\u6cd5\u8ba1\u7b97\u590d\u6742\u5ea6\u4e0d\u9ad8\uff0c\u5bf9\u4e2d\u95f4\u503c\u7f3a\u5931\u4e0d\u654f\u611f\uff0c\u4f46\u53ef\u80fd\u4f1a\u4ea7\u751f\u8fc7\u62df\u5408\u7684\u95ee\u9898\u3002","title":"\u51b3\u7b56\u6811"},{"location":"inthecloud/ch04/#_10","text":"\u8d1d\u53f6\u65af\u6a21\u578b\u662f\u57fa\u4e8e\u72ec\u7acb\u6982\u7387\u7edf\u8ba1\u7684\uff0c\u601d\u60f3\u5927\u6982\u53ef\u4ee5\u8fd9\u4e48\u8bf4\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 \u603b\u51717\u4e2a\u77f3\u5b50\u5728A\u3001B\u4e24\u4e2a\u6876\u4e2d\uff0cA\u6876\u4e2d\u67092\u9ed12\u767d\uff0cB\u6876\u4e2d\u67092\u9ed11\u767d\u3002\u5df2\u77e5\u6761\u4ef6\u4e3a\u77f3\u5b50\u6765\u81eaB\u6876\uff0c\u90a3\u4e48\u5b83\u662f\u767d\u8272\u77f3\u5b50\u7684\u6982\u7387\u53ef\u8868\u793a\u4e3a\uff1a P(white|B)=P(B|white)P(white)/P(B) \u63a5\u4e0b\u6765\uff0c\u5b9a\u4e49\u4e24\u4e2a\u4e8b\u4ef6A\u3001B\uff0cP(A|B)\u4e0eP(B|A)\u76f8\u4e92\u8f6c\u5316\u7684\u8fc7\u7a0b\u5373\u4e3a\uff1a P(B|A)=P(A|B)P(B)/P(A) \u800c\u6734\u7d20\u8d1d\u53f6\u65af\u53ef\u4ee5\u8fd9\u6837\u63cf\u8ff0\uff1a \u8bbex={a1,a2,...,am}\u4e3a\u5f85\u5206\u7c7b\u9879\uff0ca\u4e3ax\u7684\u7279\u5f81\u5c5e\u6027\uff0c\u7c7b\u522b\u96c6\u5408\u4e3aC={y1,y2,...,ym}\uff0c\u5982\u679cP(yk|x)=max(P(y1|x),P(y2|x),...,P(yn|x))\uff0c\u5219x\u5c5e\u4e8eyk\u3002 \u6574\u4e2a\u7b97\u6cd5\u6838\u5fc3\u5373\u662f\u7b49\u5f0fP(yi|x)=P(x|yi)P(yi)/P(x)\u3002 \u9996\u5148\u6784\u5efa\u4e00\u4e2a\u5206\u7c7b\u8bad\u7ec3\u51fd\u6570\uff08\u4e8c\u5143\u5206\u7c7b\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 def trainNB0(trainMatrix,trainCategory): numTrainDocs = len(trainMatrix) numWords = len(trainMatrix[0]) pBad = sum(trainCategory)/float(numTrainDocs) p0Num = ones(numWords); p1Num = ones(numWords) #change to ones() p0Denom = 2.0; p1Denom = 2.0 #change to 2.0 for i in range(numTrainDocs): if trainCategory[i] == 1: p1Num += trainMatrix[i] p1Denom += sum(trainMatrix[i]) else: p0Num += trainMatrix[i] p0Denom += sum(trainMatrix[i]) p1Vect = log(p1Num/p1Denom) #change to log() p0Vect = log(p0Num/p0Denom) #change to log() return p0Vect,p1Vect,pBad \u5176\u4e2d\uff0ctrainMatrix\u4e3a\u6240\u6709\u8bad\u7ec3\u96c6\u4e2d\u7684\u5e03\u5c14\u5411\u91cf\uff0c\u6bd4\u5982\u4e24\u672c\u4e66A\u3001B\uff0c\u5176\u4e2dA\u6709\u4e24\u4e2a\u5355\u8bcdx\u3001y\uff0cB\u6709\u4e24\u4e2a\u5355\u8bcdx\u3001z\uff0c\u5e76\u4e14A\u662f\u597d\u4e66\uff08\u503c\u8ba1\u4e3a0\uff09\uff0cB\u662f\u70c2\u4e66\uff08\u503c\u8ba1\u4e3a0\uff09\uff0c\u628a\u6240\u6709\u5355\u8bcd\u8fdb\u884c\u6392\u5e8f\u540e\u5f97\u5411\u91cf['x','y','z']\uff0c\u5219A\u7684Matrix\u53ef\u8868\u793a\u4e3a[1,1,0]\uff0cB\u7684\u4e3a[1,0,1]\uff0c\u6240\u4ee5\u6b64\u51fd\u6570\u4e2d\u7684trainMatrix\u5373[[1,1,0],[1,0,1]]\uff0ctrainCategory\u4e3a[0,1]\u3002 \u51fd\u6570\u8fd4\u56de\u7684\u4e3a\u6982\u7387\u96c6\u7684\u5411\u91cf\u3002 \u5206\u7c7b\u51fd\u6570\uff1a 1 2 3 4 5 6 7 8 9 def classifyNB(vec2Classify, p0Vec, p1Vec, pClass1): p1 = sum(vec2Classify * p1Vec) + log(pClass1) #element-wise mult p0 = sum(vec2Classify * p0Vec) + log(1.0 - pClass1) if p1 > p0: return 1 else: return 0 vec2Classify\u5373\u4e3a\u8981\u5206\u7c7b\u7684\u5411\u91cf\uff0c\u5f62\u5982trainMatrix\uff0c\u968f\u540e\u7684\u4e09\u4e2a\u53c2\u6570\u4e3atrainNB0\u6240\u8fd4\u56de\u3002p1\u3001p0\u53ef\u4ee5\u7406\u89e3\u4e3a\u671f\u671b\u6982\u7387\u503c\uff0c\u6bd4\u8f83\u4e24\u8005\u5927\u5c0f\u5373\u53ef\u5212\u5206\u3002 \u6d4b\u8bd5\u7528\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 def testingNB(): listOPosts,listClasses = loadDataSet() myVocabList = createVocabList(listOPosts) trainMat=[] for postinDoc in listOPosts: trainMat.append(setOfWords2Vec(myVocabList, postinDoc)) p0V,p1V,pAb = trainNB0(array(trainMat),array(listClasses)) testEntry = ['love', 'my', 'dalmation'] thisDoc = array(setOfWords2Vec(myVocabList, testEntry)) print testEntry,'classified as: ',classifyNB(thisDoc,p0V,p1V,pAb) testEntry = ['stupid', 'garbage'] thisDoc = array(setOfWords2Vec(myVocabList, testEntry)) print testEntry,'classified as: ',classifyNB(thisDoc,p0V,p1V,pAb) \u6574\u4f53\u6765\u8bf4\uff0c\u6734\u7d20\u8d1d\u53f6\u65af\u5206\u7c7b\u65b9\u6cd5\u5728\u6570\u636e\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\u4ecd\u7136\u6709\u6548\uff0c\u4f46\u662f\u5bf9\u6570\u636e\u8f93\u5165\u6bd4\u8f83\u654f\u611f\u3002","title":"\u6734\u7d20\u8d1d\u53f6\u65af"},{"location":"inthecloud/ch04/#logistic","text":"\u5728\u7edf\u8ba1\u5b66\u4e2d\uff0c\u7ebf\u6027\u56de\u5f52\u662f\u5229\u7528\u79f0\u4e3a\u7ebf\u6027\u56de\u5f52\u65b9\u7a0b\u7684\u6700\u5c0f\u4e8c\u4e58\u51fd\u6570\u5bf9\u4e00\u4e2a\u6216\u591a\u4e2a\u81ea\u53d8\u91cf\u548c\u56e0\u53d8\u91cf\u4e4b\u95f4\u5173\u7cfb\u8fdb\u884c\u5efa\u6a21\u7684\u4e00\u79cd\u56de\u5f52\u5206\u6790\u3002\u8fd9\u79cd\u51fd\u6570\u662f\u4e00\u4e2a\u6216\u591a\u4e2a\u79f0\u4e3a\u56de\u5f52\u7cfb\u6570\u7684\u6a21\u578b\u53c2\u6570\u7684\u7ebf\u6027\u7ec4\u5408\u3002\u53ea\u6709\u4e00\u4e2a\u81ea\u53d8\u91cf\u7684\u60c5\u51b5\u79f0\u4e3a\u7b80\u5355\u56de\u5f52\uff0c\u5927\u4e8e\u4e00\u4e2a\u81ea\u53d8\u91cf\u60c5\u51b5\u7684\u53eb\u505a\u591a\u5143\u56de\u5f52\u3002\uff08 \u7ef4\u57fa\u767e\u79d1 \uff09 \u5148\u4ecb\u7ecd\u4e24\u4e2a\u91cd\u8981\u7684\u6570\u5b66\u6982\u5ff5\u3002 \u6700\u5c0f\u4e8c\u4e58\u6cd5\u5219 \u6700\u5c0f\u4e8c\u4e58\u6cd5\uff08\u53c8\u79f0\u6700\u5c0f\u5e73\u65b9\u6cd5\uff09\u662f\u4e00\u79cd\u6570\u5b66\u4f18\u5316\u6280\u672f\u3002\u5b83\u901a\u8fc7\u6700\u5c0f\u5316\u8bef\u5dee\u7684\u5e73\u65b9\u548c\u5bfb\u627e\u6570\u636e\u7684\u6700\u4f73\u51fd\u6570\u5339\u914d\u3002 \u5229\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u53ef\u4ee5\u7b80\u4fbf\u5730\u6c42\u5f97\u672a\u77e5\u7684\u6570\u636e\uff0c\u5e76\u4f7f\u5f97\u8fd9\u4e9b\u6c42\u5f97\u7684\u6570\u636e\u4e0e\u5b9e\u9645\u6570\u636e\u4e4b\u95f4\u8bef\u5dee\u7684\u5e73\u65b9\u548c\u4e3a\u6700\u5c0f\u3002 \u793a\u4f8b1 \u6709\u56db\u4e2a\u6570\u636e\u70b9(1,6)\u3001(2,5)\u3001(3,7)\u3001(4,10)\uff0c\u6211\u4eec\u5e0c\u671b\u627e\u5230\u4e00\u6761\u76f4\u7ebfy=a+bx\u4e0e\u8fd9\u56db\u4e2a\u70b9\u6700\u5339\u914d\u3002 1 2 3 4 5 6 7 a+1b=6 a+2b=5 a+3b=7 a+4b=10 \u91c7\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u4f7f\u7b49\u53f7\u4e24\u8fb9\u7684\u65b9\u5dee\u5c3d\u53ef\u80fd\u5c0f\uff0c\u4e5f\u5c31\u662f\u627e\u51fa\u8fd9\u4e2a\u51fd\u6570\u7684\u6700\u5c0f\u503c\uff1a 1 S(a,b) = [6-(a+1b)]^2+[5-(a+2b)]^2+[7-(a+3b)]^2+[10-(a+4b)]^2 \u7136\u540e\u5bf9S(a,b)\u6c42a,b\u7684\u504f\u5bfc\u6570\uff0c\u4f7f\u5176\u4e3a0\u5f97\u5230\uff1a 1 2 3 \\cfrac{{\\partial}S}{{\\partial}a} = 0 = 8a+20b-56 \\cfrac{{\\partial}S}{{\\partial}b} = 0 = 20a+60b-154 \u8fd9\u6837\u5c31\u89e3\u51fa\uff1a 1 a=3.5,b=1.4 \u6240\u4ee5\u76f4\u7ebfy=3.5+1.4x\u662f\u6700\u4f73\u7684\u3002 \u51fd\u6570\u8868\u793a 1 \\min_{\\vec{b}}{\\sum^n_{i=1}}(y_m-y_i)^2 \u6b27\u51e0\u91cc\u5fb7\u8868\u793a 1 \\min_{ \\vec{b} } \\| \\vec{y}_{m} ( \\vec{b} ) - \\vec{y} \\|_{2} \u7ebf\u6027\u51fd\u6570\u6a21\u578b \u5178\u578b\u7684\u4e00\u7c7b\u51fd\u6570\u6a21\u578b\u662f\u7ebf\u6027\u51fd\u6570\u6a21\u578b\u3002\u6700\u7b80\u5355\u7684\u7ebf\u6027\u5f0f\u662f 1 y = b_0 + b_1 t \u5199\u6210\u77e9\u9635\u5f0f\uff0c\u4e3a 1 \\min_{b_0,b_1}\\left\\|\\begin{pmatrix}1 & t_1 \\\\ \\vdots & \\vdots \\\\ 1 & t_n \\end{pmatrix}\\begin{pmatrix} b_0\\\\ b_1\\end{pmatrix} - \\begin{pmatrix} y_1 \\\\ \\vdots \\\\ y_{n}\\end{pmatrix}\\right\\|_{2} = \\min_b\\|Ab-Y\\|_2 \u76f4\u63a5\u7ed9\u51fa\u8be5\u5f0f\u7684\u53c2\u6570\u89e3\uff1a 1 2 3 b_1 = \\frac{\\sum_{i=1}^n t_iy_i - n \\cdot \\bar t \\bar y}{\\sum_{i=1}^n t_i^2- n \\cdot (\\bar t)^2} b_0 = \\bar y - b_1 \\bar t \u5176\u4e2d 1 \\bar t = \\frac{1}{n} \\sum_{i=1}^n t_i \u4e3at\u503c\u7684\u7b97\u672f\u5e73\u5747\u503c\u3002\u4e5f\u53ef\u89e3\u5f97\u5982\u4e0b\u5f62\u5f0f\uff1a 1 b_1 = \\frac{\\sum_{i=1}^n (t_i - \\bar t)(y_i - \\bar y)}{\\sum_{i=1}^n (t_i - \\bar t)^2} \u793a\u4f8b2 \u968f\u673a\u9009\u5b9a10\u8258\u6218\u8230\uff0c\u5e76\u5206\u6790\u5b83\u4eec\u7684\u957f\u5ea6\u4e0e\u5bbd\u5ea6\uff0c\u5bfb\u627e\u5b83\u4eec\u957f\u5ea6\u4e0e\u5bbd\u5ea6\u4e4b\u95f4\u7684\u5173\u7cfb\u3002\u7531\u4e0b\u9762\u7684\u63cf\u70b9\u56fe\u53ef\u4ee5\u76f4\u89c2\u5730\u770b\u51fa\uff0c\u4e00\u8258\u6218\u8230\u7684\u957f\u5ea6\uff08t\uff09\u4e0e\u5bbd\u5ea6\uff08y\uff09\u57fa\u672c\u5448\u7ebf\u6027\u5173\u7cfb\u3002\u6563\u70b9\u56fe\u5982\u4e0b\uff1a ```{image} ../images/04-02.png :align: center 1 2 3 4 \u4ee5\u4e0b\u56fe\u8868\u5217\u51fa\u4e86\u5404\u6218\u8230\u7684\u6570\u636e\uff0c\u968f\u540e\u6b65\u9aa4\u662f\u91c7\u7528\u6700\u5c0f\u4e8c\u4e58\u6cd5\u786e\u5b9a\u4e24\u53d8\u91cf\u95f4\u7684\u7ebf\u6027\u5173\u7cfb\u3002 ```{image} ../images/04-03.png :align: center \u4eff\u7167\u4e0a\u9762\u7ed9\u51fa\u7684\u4f8b\u5b50 1 \\bar t = \\frac {\\sum_{i=1}^n t_i}{n} = \\frac {1678}{10} = 167{.}8 \u5e76\u5f97\u5230\u76f8\u5e94\u7684 1 \\bar y = 18{.}41 \u7136\u540e\u786e\u5b9ab1 1 2 3 b_1 = \\frac{\\sum_{i=1}^n (t_i- \\bar {t})(y_i - \\bar y)}{\\sum_{i=1}^n (t_i- \\bar t)^2} = \\frac{3287{.}820} {20391{.}60} = 0{.}1612 \\; \u53ef\u4ee5\u770b\u51fa\uff0c\u6218\u8230\u7684\u957f\u5ea6\u6bcf\u53d8\u53161m\uff0c\u76f8\u5bf9\u5e94\u7684\u5bbd\u5ea6\u4fbf\u8981\u53d8\u531616cm\u3002\u5e76\u7531\u4e0b\u5f0f\u5f97\u5230\u5e38\u6570\u9879b0\uff1a 1 b_0 = \\bar y - b_1 \\bar t = 18{.}41 - 0{.}1612 \\cdot 167{.}8 = -8{.}6394 \u53ef\u4ee5\u770b\u51fa\u70b9\u7684\u62df\u5408\u975e\u5e38\u597d\uff0c\u957f\u5ea6\u548c\u5bbd\u5ea6\u7684\u76f8\u5173\u6027\u5927\u7ea6\u4e3a96.03\uff05\u3002 \u5229\u7528Matlab\u5f97\u5230\u62df\u5408\u76f4\u7ebf\uff1a ```{image} ../images/04-04.png :align: center 1 2 3 4 5 6 7 **Sigmoid\u51fd\u6570** Sigmoid\u51fd\u6570\u5177\u6709\u5355\u4f4d\u9636\u8dc3\u51fd\u6570\u7684\u6027\u8d28\uff0c\u516c\u5f0f\u8868\u793a\u4e3a\uff1a ```{math} \\sigma (z)=\\cfrac{1}{1+e^{-z}} ```{image} ../images/04-01.png :align: center 1 2 3 4 5 \u6211\u4eec\u5c06\u8f93\u5165\u8bb0\u4e3az\uff0c\u6709\u4e0b\u9762\u7684\u516c\u5f0f\u5f97\u51fa\uff1a ```{math} z=w_0 x_0 + w_1 x_1 + w_2 x_2 + \\dots + w_n x_n \u4f7f\u7528\u5411\u91cf\u5199\u6cd5\uff1a 1 z=w^T x \u5176\u4e2d\u5411\u91cfx\u662f\u5206\u7c7b\u5668\u7684\u8f93\u5165\u6570\u636e\uff0c\u5411\u91cfw\u5c31\u662f\u6211\u4eec\u8981\u627e\u5230\u7684\u6700\u4f73\u7cfb\u6570\u3002 \u57fa\u4e8e\u4f18\u5316\u65b9\u6cd5\u786e\u5b9a\u56de\u5f52\u7cfb\u6570 \u68af\u5ea6\u4e0a\u5347/\u4e0b\u964d\u6cd5 \u68af\u5ea6\u4e0a\u5347\u6cd5/\u4e0b\u964d\u6cd5\u7684\u601d\u60f3\u662f\uff1a\u8981\u627e\u5230\u51fd\u6570\u7684\u6700\u5927\u503c\uff0c\u6700\u597d\u7684\u65b9\u6cd5\u662f\u6cbf\u7740\u8be5\u51fd\u6570\u7684\u68af\u5ea6\u65b9\u5411\u63a2\u5bfb\uff0c\u51fd\u6570f(x,y)\u7684\u68af\u5ea6\u5982\u4e0b\u8868\u793a\uff1a 1 {\\nabla}f(x,y)=\\begin{pmatrix} \\cfrac{{\\partial}f(x,y)}{{\\partial}x} \\\\ \\cfrac{{\\partial}f(x,y)}{{\\partial}y}\\end{pmatrix} \u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\u6b64\u7b97\u6cd5\uff1a \u4ece\u524d\u6709\u4e00\u5ea7\u5c71\uff0c\u4e00\u4e2a\u61d2\u4eba\u8981\u722c\u5c71\uff0c\u4ed6\u4ece\u5c71\u811a\u4e0b\u7684\u4efb\u610f\u4f4d\u7f6e\u5411\u5c71\u9876\u51fa\u53d1\uff0c\u5e76\u4e14\u77e5\u9053\u7b49\u9ad8\u7ebf\u56fe\u7684\u6bcf\u4e2a\u73af\u4e0a\u90fd\u6709\u4e00\u4e2a\u5bbf\u8425\u70b9\uff0c\u4ed6\u5e0c\u671b\u5728\u8fd9\u4e9b\u5bbf\u8425\u70b9\u4e4b\u95f4\u4fee\u5efa\u4e00\u6761\u7b14\u76f4\u7684\u8def\uff0c\u5e76\u4e14\u8def\u5230\u4e24\u65c1\u7684\u5bbf\u8425\u70b9\u7684\u5782\u76f4\u8ddd\u79bb\u5dee\u7684\u5e73\u65b9\u548c\u5c3d\u53ef\u80fd\u5c0f\u3002\u6bcf\u5230\u4e00\u4e2a\u7b49\u9ad8\u7ebf\u5708\uff0c\u4ed6\u90fd\u4f1a\u6839\u636e\u4ed6\u5728\u4e0a\u4e00\u4e2a\u7b49\u9ad8\u7ebf\u7684\u8ddd\u79bb\u7684\u53d8\u5316\u91cf\u6765\u8c03\u8282\u4ed6\u7684\u5728\u7b49\u9ad8\u7ebf\u4e0a\u7684\u4f4d\u7f6e\uff0c\u4ece\u800c\u4f7f\u516c\u8def\u6ee1\u8db3\u8981\u6c42\u3002 \u8fd4\u56de\u56de\u5f52\u7cfb\u6570\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 def gradAscent(dataMatIn, classLabels): dataMatrix = mat(dataMatIn) #convert to NumPy matrix labelMat = mat(classLabels).transpose() #convert to NumPy matrix m,n = shape(dataMatrix) alpha = 0.001 maxCycles = 500 weights = ones((n,1)) for k in range(maxCycles): #heavy on matrix operations h = sigmoid(dataMatrix*weights) #matrix mult error = (labelMat - h) #vector subtraction weights = weights + alpha * dataMatrix.transpose()* error #matrix mult return weights \u5176\u4e2d\uff0c\u8bef\u5dee\u503c\u4e58\u4ee5\u77e9\u9635\u7684\u8f6c\u79e9\u4ee3\u8868\u68af\u5ea6\u3002 \u5f85\u4fee\u6539\u3002","title":"Logistic\u56de\u5f52"},{"location":"inthecloud/ch04/#svm","text":"SVM\uff08Supprot Vector Machines\uff09\u5373\u652f\u6301\u5411\u91cf\u673a\uff0c\u5b8c\u5168\u7406\u89e3\u5176\u7406\u8bba\u77e5\u8bc6\u5bf9\u6570\u5b66\u8981\u6c42\u8f83\u9ad8\u3002","title":"SVM"},{"location":"inthecloud/ch04/#adaboost","text":"","title":"AdaBoost"},{"location":"inthecloud/ch04/#45","text":"","title":"4.5 \u65e0\u76d1\u7763\u5b66\u4e60"},{"location":"inthecloud/ch04/#46","text":"","title":"4.6 \u6570\u636e\u53ef\u89c6\u5316"},{"location":"inthecloud/ch04/#_11","text":"Gephi GraphViz python-matplotlib Microsoft Excel 2013 PowerView","title":"\u6570\u636e\u7edf\u8ba1"},{"location":"inthecloud/ch04/#_12","text":"\u767e\u5ea6\u5730\u56feAPI MaxMind GeoIP Microsoft Excel 2013 PowerView\u4f7f\u7528\u793a\u4f8b","title":"\u5730\u7406\u4f4d\u7f6e\u8868\u793a"},{"location":"inthecloud/ch04/#47","text":"Weka Netlogo SciKit Pandas","title":"4.7 \u673a\u5668\u5b66\u4e60\u5de5\u5177"},{"location":"inthecloud/ch05/","text":"\u7b2c\u4e94\u7ae0 \u6570\u636e\u5904\u7406\u5e73\u53f0 5.1 Hadoop\u7b80\u4ecb Hadoop\u4e0e\u73b0\u5728\u66f4\u6d41\u884c\u7684Storm\u548cSpark\uff0c\u4ece\u521d\u5b66\u7684\u89d2\u5ea6\u6765\u8bf4\u66f4\u6709\u4ef7\u503c\u3002\u56e0\u4e3aHadoop\u5185\u5bb9\u4e0d\u6b62\u6709MapReduce\uff0c\u66f4\u6709SQL\u5f0f\u7684Yarn\u548cHDFS\u8fd9\u4e00\u4e13\u4e3aMR\u5f00\u53d1\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u6240\u4ee5\u6211\u8ba4\u4e3a\u5728\u57fa\u7840\u5b66\u4e60\u9636\u6bb5\u5b83\u66f4\u5177\u4ee3\u8868\u6027\u3002\u800cStorm\u548cSpark\uff0c\u5b83\u4eec\u7684\u4f18\u52a3\u6211\u73b0\u5728\u5e76\u4e0d\u6e05\u695a\uff0c\u53ea\u77e5\u9053\u524d\u8005\u9002\u7528\u4e8e\u5904\u7406\u8f93\u5165\u8fde\u7ef5\u6570\u636e\uff0c\u540e\u8005\u9002\u7528\u4e8e\u590d\u6742MR\u8fc7\u7a0b\u7684\u6a21\u578b\u3002 5.2 \u6a21\u5757\u90e8\u7f72\uff08\u5355\u673a/\u96c6\u7fa4\uff09 \u73b0\u5728\u90e8\u7f72Hadoop\u7684\u65b9\u5f0f\u6bd4\u8fc7\u53bb\u66f4\u52a0\u5bb9\u6613\uff0c\u5c31\u6211\u6240\u77e5\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Cloudera Manager \u6216\u8005 Puppet \u53bb\u5b8c\u6210\u4f01\u4e1a\u7ea7\u7684\u90e8\u7f72\uff1b\u5982\u679c\u4f60\u9700\u8981\u6982\u5ff5\u8bc1\u660e\u7c7b\u7684\u5de5\u4f5c\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Hortonworks \u7684\u865a\u62df\u673a\u955c\u50cf \u6216\u8005 Cloudera\u7684\u865a\u62df\u673a\u955c\u50cf \uff0c\u6216\u8005 MapR \uff0c\u5728\u63a5\u4e0b\u6765\u7684\u7ae0\u8282\u4e2d\u6211\u4f1a\u4f7f\u7528rpm\u5305\u8fdb\u884c\u5b89\u88c5\uff0c\u800c\u4e0d\u662f\u6309\u7167 \u5b98\u65b9\u6587\u6863 \u53bb\u90e8\u7f72\u3002 Hue\uff1a Hadoop User Experience \uff0c\u5373web UI \u5355\u8282\u70b9\u90e8\u7f72 \u96c6\u7fa4\u90e8\u7f72 5.3 \u672c\u5730\u6570\u636e\u5904\u7406 5.4 \u5b9e\u65f6\u6570\u636e\u5904\u7406 5.5 \u5b9e\u4f8b \u57fa\u4e8eSolr\u548cNutch\u7684\u641c\u7d22\u5f15\u64ce 5.6 \u4e0eStorm/Spark\u914d\u5408\u4f7f\u7528","title":"\u7b2c\u4e94\u7ae0 \u6570\u636e\u5904\u7406\u5e73\u53f0"},{"location":"inthecloud/ch05/#_1","text":"","title":"\u7b2c\u4e94\u7ae0 \u6570\u636e\u5904\u7406\u5e73\u53f0"},{"location":"inthecloud/ch05/#51-hadoop","text":"Hadoop\u4e0e\u73b0\u5728\u66f4\u6d41\u884c\u7684Storm\u548cSpark\uff0c\u4ece\u521d\u5b66\u7684\u89d2\u5ea6\u6765\u8bf4\u66f4\u6709\u4ef7\u503c\u3002\u56e0\u4e3aHadoop\u5185\u5bb9\u4e0d\u6b62\u6709MapReduce\uff0c\u66f4\u6709SQL\u5f0f\u7684Yarn\u548cHDFS\u8fd9\u4e00\u4e13\u4e3aMR\u5f00\u53d1\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u6240\u4ee5\u6211\u8ba4\u4e3a\u5728\u57fa\u7840\u5b66\u4e60\u9636\u6bb5\u5b83\u66f4\u5177\u4ee3\u8868\u6027\u3002\u800cStorm\u548cSpark\uff0c\u5b83\u4eec\u7684\u4f18\u52a3\u6211\u73b0\u5728\u5e76\u4e0d\u6e05\u695a\uff0c\u53ea\u77e5\u9053\u524d\u8005\u9002\u7528\u4e8e\u5904\u7406\u8f93\u5165\u8fde\u7ef5\u6570\u636e\uff0c\u540e\u8005\u9002\u7528\u4e8e\u590d\u6742MR\u8fc7\u7a0b\u7684\u6a21\u578b\u3002","title":"5.1 Hadoop\u7b80\u4ecb"},{"location":"inthecloud/ch05/#52","text":"\u73b0\u5728\u90e8\u7f72Hadoop\u7684\u65b9\u5f0f\u6bd4\u8fc7\u53bb\u66f4\u52a0\u5bb9\u6613\uff0c\u5c31\u6211\u6240\u77e5\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Cloudera Manager \u6216\u8005 Puppet \u53bb\u5b8c\u6210\u4f01\u4e1a\u7ea7\u7684\u90e8\u7f72\uff1b\u5982\u679c\u4f60\u9700\u8981\u6982\u5ff5\u8bc1\u660e\u7c7b\u7684\u5de5\u4f5c\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 Hortonworks \u7684\u865a\u62df\u673a\u955c\u50cf \u6216\u8005 Cloudera\u7684\u865a\u62df\u673a\u955c\u50cf \uff0c\u6216\u8005 MapR \uff0c\u5728\u63a5\u4e0b\u6765\u7684\u7ae0\u8282\u4e2d\u6211\u4f1a\u4f7f\u7528rpm\u5305\u8fdb\u884c\u5b89\u88c5\uff0c\u800c\u4e0d\u662f\u6309\u7167 \u5b98\u65b9\u6587\u6863 \u53bb\u90e8\u7f72\u3002 Hue\uff1a Hadoop User Experience \uff0c\u5373web UI","title":"5.2 \u6a21\u5757\u90e8\u7f72\uff08\u5355\u673a/\u96c6\u7fa4\uff09"},{"location":"inthecloud/ch05/#_2","text":"","title":"\u5355\u8282\u70b9\u90e8\u7f72"},{"location":"inthecloud/ch05/#_3","text":"","title":"\u96c6\u7fa4\u90e8\u7f72"},{"location":"inthecloud/ch05/#53","text":"","title":"5.3 \u672c\u5730\u6570\u636e\u5904\u7406"},{"location":"inthecloud/ch05/#54","text":"","title":"5.4 \u5b9e\u65f6\u6570\u636e\u5904\u7406"},{"location":"inthecloud/ch05/#55","text":"","title":"5.5 \u5b9e\u4f8b"},{"location":"inthecloud/ch05/#solrnutch","text":"","title":"\u57fa\u4e8eSolr\u548cNutch\u7684\u641c\u7d22\u5f15\u64ce"},{"location":"inthecloud/ch05/#56-stormspark","text":"","title":"5.6 \u4e0eStorm/Spark\u914d\u5408\u4f7f\u7528"},{"location":"inthecloud/frontline-network/","text":"\u79c1\u6709\u4e91\u684c\u9762\u7f51\u7edc\u7ec4\u5efa \u672c\u6587\u4ecb\u7ecd\u4e86\u79c1\u6709\u4e91\u684c\u9762\u4e2d\u7ec4\u7f51\u7684\u57fa\u7840\u6280\u672f\u53ca\u5176\u5b9e\u73b0\u65b9\u5f0f\uff0c\u7136\u540e\u53c8\u5217\u4e3e\u4e86oVirt/OpenStack\u4e2d\u5173\u4e8e\u865a\u62df\u684c\u9762\u7f51\u7edc\u7684\u7ec4\u5efa\u65b9\u5f0f\u3002\u6700\u540e\u7b14\u8005\u5c1d\u8bd5\u4ece\u591a\u4e2a\u65b9\u9762\u89e3\u6790\u5178\u578b\u79c1\u6709\u4e91\u684c\u9762\u4e2d\u7f51\u7edc\u914d\u7f6e\u7684\u9009\u62e9\uff0c\u4ee5\u53ca\u5b83\u4eec\u53ef\u80fd\u5e26\u6765\u7684\u98ce\u9669\u53ca\u5229\u5f0a\u3002 1. \u684c\u9762\u4e91\u4e2d\u5e38\u7528\u7f51\u7edc \u7b14\u8005\u6240\u63a5\u89e6\u7684\u865a\u62df\u5316\u684c\u9762\u4e91\u5e73\u53f0\u4e2d\uff0c\u666e\u904d\u4f7f\u7528libvirt\u7ec4\u7f51\uff0c\u5176\u5b9e\u73b0\u6280\u672f\u53ef\u4ee5\u662ftagged\u6216\u8005untagged vlan\uff0cNAT\uff0c\u6865\u63a5\uff0copenvswitch\u7b49\u3002\u63a5\u4e0b\u6765\u6211\u5c06\u5c31\u4f7f\u7528\u8f83\u591a\u7684NAT\u7f51\u7edc\u3001\u6865\u63a5\u7f51\u7edc\u548copenvswitch\u4f5c\u4e9b\u8be6\u7ec6\u4ecb\u7ecd\u3002 1.1. NAT\u7f51\u7edc \u5bf9\u4e8eNAT\uff08network address translation\uff09\u6280\u672f\uff0c\u6211\u4eec\u6216\u8bb8\u5e76\u4e0d\u964c\u751f\u3002\u6211\u4eec\u5bb6\u5ead\u8def\u7531\u5668\u63a5\u5165ISP\u63d0\u4f9b\u5546\u65f6\uff0c\u8def\u7531\u5668\u4f1a\u83b7\u5f97\u4e00\u4e2a\u5916\u7f51IP\uff08\u516c\u7f51IP\uff09\uff0c\u5c40\u57df\u7f51\u7535\u8111\u63a5\u5165\u8def\u7531\u5668\u540e\u83b7\u5f97\u4e00\u4e2a\u5185\u7f51IP\uff0c\u6211\u4eec\u5373\u662f\u4eceNAT\u540e\u7aef\u6765\u8bbf\u95ee\u5916\u7f51\u7684\u3002\u8fd9\u4e5f\u662fNAT\u6700\u5e7f\u7684\u7528\u9014\u4e4b\u4e00\uff0c\u968f\u7740\u73b0\u5728IPv6\u7684\u6d41\u884c\uff0c\u6709\u4eba\u751a\u81f3\u8ba4\u4e3aNAT\u6280\u672f\u4e0d\u5982\u5f80\u65e5\u91cd\u8981\u4e86\u3002\u6211\u4eec\u5728\u6b64\u4e0d\u8ba8\u8bba\u8fd9\u4e2a\u8bdd\u9898\uff0c\u53ea\u4ecb\u7ecd\u4e00\u4e0bNAT\u6280\u672f\u7684\u5728\u865a\u62df\u5316\u4e2d\u7684\u5e38\u89c1\u5e94\u7528\u573a\u666f\u3002 \u56fe1-1 NAT\u901a\u7528\u5b9e\u73b0 \u5185\u90e8\u5730\u5740 iAddr:port1 \u6620\u5c04\u5230\u5916\u90e8\u5730\u5740 eAddr:port2 \uff0c\u6240\u6709\u4ece iAddr:port1 \u7684\u5305\u90fd\u7ecf\u7531 eAddr:port2 \u5411\u5916\u53d1\u9001\u3002\u6240\u6709\u5916\u90e8\u4e3b\u673a\u90fd\u80fd\u901a\u8fc7 eAddr:port2 \u5411\u5185\u90e8\u4e3b\u673a\u7684 iAddr:port1 \u53d1\u9001\u6570\u636e\uff0c\u6709\u4e9b\u5b9e\u73b0\u4e2d\uff0c\u8981\u6c42\u5fc5\u987b\u5185\u90e8\u4e3b\u673a\u5148\u5411\u5916\u90e8\u4e3b\u673a\u53d1\u9001\u6570\u636e\u624d\u80fd\u5141\u8bb8\u5916\u90e8\u53d1\u9001\u81f3\u5185\u90e8\u3002 \u56fe1-2 libvirt NAT\u793a\u4f8b 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <network> <name> default </name> <bridge name= \"virbr0\" /> <forward mode= \"nat\" /> <domain name= \"example.com\" /> <dns> <txt name= \"example\" value= \"example value\" /> <forwarder addr= \"8.8.8.8\" /> <forwarder addr= \"8.8.4.4\" /> <srv service= 'name' protocol= 'tcp' domain= 'test-domain-name' target= '.' port= '1024' priority= '10' weight= '10' /> <host ip= '192.168.122.2' > <hostname> myhost </hostname> <hostname> myhostalias </hostname> </host> </dns> <ip address= \"192.168.122.1\" netmask= \"255.255.255.0\" > <dhcp> <range start= \"192.168.122.100\" end= \"192.168.122.254\" /> </dhcp> </ip> <ip family= \"ipv6\" address= \"2001:db8:ca2:2::1\" prefix= \"64\" /> </network> \u6240\u6709\u865a\u62df\u673a\u83b7\u5f97\u7684IP\u8303\u56f4\u4e3a 192.168.122.100-192.168.122.254 \uff0c\u7f51\u5173\u4e3a 192.168.122.1 \uff0cDNS\u4e3a 192.168.122.2 \uff0c\u8bf7\u6c42\u53ef\u8f6c\u53d1\u81f3 8.8.8.8 \u6216 8.8.4.4 \u3002 \u5728\u865a\u62df\u5316\u4e2d\u4f7f\u7528NAT\u7684\u597d\u5904\u4e0d\u8a00\u800c\u55bb\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a \u89e3\u51b3\u4e86\u5c40\u57df\u7f51\u4e2dIP\u53ef\u80fd\u4e0d\u8db3\u7684\u9690\u60a3\uff1b \u7f51\u7edc\u62d3\u6251\u66f4\u5177\u5f39\u6027\uff1b \u5ba2\u6237\u7aef\u7f51\u7edc\u884c\u4e3a\u66f4\u6613\u63a7\u5236\uff0c\u6bd4\u5982\u5c40\u57df\u7f51\u3001\u5916\u7f51\u8bbf\u95ee\u6743\u9650\uff1b 1.2. \u6865\u63a5\u7f51\u7edc \u6865\u63a5\u5373\u662f\u5c06\u4e24\u4e2a\u4ee5\u4e0a\u7684\u7f51\u7edc\u901a\u8fc7\u8bbe\u5907\u8fdb\u884c\u8fde\u63a5\u4ece\u800c\u8fbe\u5230\u7f51\u7edc\u6c47\u805a\u7684\u76ee\u7684\u3002\u6865\u63a5\u4f4d\u4e8eOSI\u6a21\u578b\u4e2d\u7684\u7269\u7406\u5c42\u548c\u94fe\u8def\u5c42\u6570\u636e\u94fe\u8def\u5c42\u3002\u6865\u63a5\u6280\u672f\u6709\u56db\u79cd\uff1a\u7b80\u5355\u6865\u63a5\u3001\u591a\u7aef\u53e3\u6865\u63a5\u3001\u900f\u660e\u6865\u63a5\u548c\u6e90\u8def\u7531\u5de7\u63a5\u3002\u5728\u865a\u62df\u5316\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u4f7f\u7528\u7684\u662f\u591a\u7aef\u53e3\u6865\u63a5\u3002 :::{figure} ../images/libvirt-route.png :align: center \u56fe1-3 libvirt\u4e2d\u7684\u6865\u63a5\u793a\u610f\u56fe \u4e3a\u4e86\u4f7f\u7528\u6865\u63a5\u7f51\u7edc\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u914d\u7f6e\u6865\u63a5\u53e3\uff0c\u6b64\u5904\u7b14\u8005\u4ee5RHEL\u64cd\u4f5c\u7cfb\u7edf\u793a\u4f8b\u3002\u914d\u7f6ebr0\u4e3a\u6865\u63a5\u53e3\uff0c\u5176\u4e2d\u4e00\u4e2aport\u4e3a\u7269\u7406\u63a5\u53e3eth0\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /etc/sysconfig/network-scripts/ifcfg-br0 DEVICE=br0 TYPE=Bridge BOOTPROTO=none ONBOOT=yes DEFROUTE=yes IPADDR=192.168.0.100 NETMASK=255.255.255.0 GATEWAY=192.168.0.254 DNS1=8.8.8.8 DNS2=8.8.4.4 /etc/sysconfig/network-scripts/ifcfg-eth0 DEVICE=eth0 ONBOOT=yes BRIDGE=br0 \u6211\u4eec\u901a\u8fc7VirtManager\u542f\u52a8\u865a\u62df\u673a\u540e\u53ef\u770b\u5230\u5982\u4e0b\u5185\u5bb9\u3002\u5176\u4e2dbr0\u662f\u521a\u521a\u521b\u5efa\u7684\u6865\uff0ceth0\u548cvnet0\u662f\u6865\u4e2d\u7684\u4e24\u4e2a\u63a5\u53e3\u3002 1 2 3 4 [ root@localhost ~ ] # brctl show bridge name bridge id STP enabled interfaces br0 8000 .000c2958db65 no eth0 vnet0 1.3. Open vSwitch Open vSwitch\uff08\u4e0b\u9762\u7b80\u79f0\u4e3a OVS\uff09\u662f\u7531 Nicira Networks \u4e3b\u5bfc\u7684\uff0c\u8fd0\u884c\u5728\u865a\u62df\u5316\u5e73\u53f0\uff08 KVM\uff0cXen\uff09\u4e0a\u7684\u865a\u62df\u4ea4\u6362\u673a\u3002\u5728\u865a\u62df\u5316\u5e73\u53f0\u4e0a\uff0cOVS\u53ef\u4ee5\u4e3a\u52a8\u6001\u53d8\u5316\u7684\u7aef\u70b9\u63d0\u4f9b2\u5c42\u4ea4\u6362\u529f\u80fd\uff0c\u4ece\u800c\u5f88\u597d\u5730\u63a7\u5236\u865a\u62df\u7f51\u7edc\u4e2d\u7684\u8bbf\u95ee\u7b56\u7565\u3001\u7f51\u7edc\u9694\u79bb\u3001\u6d41\u91cf\u76d1\u63a7\u7b49\u3002OVS \u9075\u5faaApache 2.0\u8bb8\u53ef\u8bc1, \u80fd\u540c\u65f6\u652f\u6301\u591a\u79cd\u6807\u51c6\u7684\u7ba1\u7406\u63a5\u53e3\u548c\u534f\u8bae\u3002OVS\u4e5f\u63d0\u4f9b\u4e86\u5bf9OpenFlow\u534f\u8bae\u7684\u652f\u6301\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u652f\u6301OpenFlow\u534f\u8bae\u7684\u63a7\u5236\u5668\u5bf9OVS\u8fdb\u884c\u8fdc\u7a0b\u7ba1\u7406\u63a7\u5236\u3002 \u5728OVS\u4e2d, \u6709\u51e0\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5\uff1a Bridge\uff1aBridge\u4ee3\u8868\u4e00\u4e2a\u865a\u62df\u4ea4\u6362\u673a\uff08Switch\uff09\uff0c\u4e00\u4e2a\u4e3b\u673a\u4e2d\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6216\u8005\u591a\u4e2aBridge\u8bbe\u5907\u3002 Port\uff1a\u7aef\u53e3\u4e0e\u7269\u7406\u4ea4\u6362\u673a\u7684\u7aef\u53e3\u6982\u5ff5\u7c7b\u4f3c\uff0c\u6bcf\u4e2aPort\u90fd\u96b6\u5c5e\u4e8e\u4e00\u4e2aBridge\u3002 Interface\uff1a\u8fde\u63a5\u5230Port\u7684\u7f51\u7edc\u63a5\u53e3\u8bbe\u5907\u3002\u5728\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cPort\u548cInterface\u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb, \u53ea\u6709\u5728\u914d\u7f6ePort\u4e3abond\u6a21\u5f0f\u540e\uff0cPort\u548cInterface\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\u3002 Controller\uff1aOpenFlow\u63a7\u5236\u5668\u3002OVS\u53ef\u4ee5\u540c\u65f6\u63a5\u53d7\u4e00\u4e2a\u6216\u8005\u591a\u4e2aOpenFlow\u63a7\u5236\u5668\u7684\u7ba1\u7406\u3002 Datapath\uff1a\u5728 OVS \u4e2d\uff0cdatapath\u8d1f\u8d23\u6267\u884c\u6570\u636e\u4ea4\u6362\uff0c\u4e5f\u5c31\u662f\u628a\u4ece\u63a5\u6536\u7aef\u53e3\u6536\u5230\u7684\u6570\u636e\u5305\u5728\u6d41\u8868\u4e2d\u8fdb\u884c\u5339\u914d\uff0c\u5e76\u6267\u884c\u5339\u914d\u5230\u7684\u52a8\u4f5c\u3002 Flow Table\uff1a\u6bcf\u4e2a datapath \u90fd\u548c\u4e00\u4e2aflow table\u5173\u8054\uff0c\u5f53datapath\u63a5\u6536\u5230\u6570\u636e\u4e4b\u540e\uff0cOVS\u4f1a\u5728flow table\u4e2d\u67e5\u627e\u53ef\u4ee5\u5339\u914d\u7684flow\uff0c\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c, \u4f8b\u5982\u8f6c\u53d1\u6570\u636e\u5230\u5176\u4ed6\u6307\u5b9a\u7aef\u53e3\u3002 \u4e00\u822c\u5728\u865a\u62df\u5316\u5e73\u53f0\u4e2d\uff0c\u4f7f\u7528OVS\u65f6\u591a\u6570\u4f1a\u914d\u5408\u5c40\u57df\u7f51\u7684VLAN\u4ee5\u4fbf\u4e8e\u7ba1\u7406\u3002\u5728\u6d41\u91cf\u8f83\u5c0f\u7684\u7f51\u7edc\u73af\u5883\u4e2d\uff0c\u4f7f\u7528\u5176GRE\u7f51\u7edc\u7528\u4e8e\u591a\u865a\u62df\u673a\u4e92\u8054\u7684\u573a\u666f\u4e5f\u5f88\u5e38\u89c1\u3002 :::{figure} ../images/ovs-gre.png :align: center \u56fe1-4 OVS\u4f7f\u7528GRE\u8054\u901a\u865a\u62df\u673a\u7f51\u7edc\u793a\u610f\u56fe ::: \u5728libvirt\u4e2d\u4f7f\u7528OVS\u7f51\u7edc\u65f6\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u5b9a\u4e49\u3002 1 2 3 4 5 6 7 8 9 10 # cat ovs-br0.xml <network> <name>ovs-net</name> <forward mode='bridge'/> <bridge name='ovs-br0' /> <virtualport type='openvswitch'/> </network> # virsh define ovs-br0.xml # virsh start ovs-br0 2. oVirt/OpenStack\u7684\u684c\u9762\u7f51\u7edc\u5e94\u7528 oVirt\u7684\u865a\u62df\u673a\u7f51\u7edc\u9ed8\u8ba4\u4f7f\u7528\u6865\u63a5\uff0c\u800cOpenStack\u53ef\u4ee5\u9009\u914d\u4f7f\u7528\u6865\u63a5\u3001OVS\u7b49\u4f5c\u4e3a\u540e\u7aef\u3002\u7b14\u8005\u5c06\u4ee5oVirt\u4e3a\u4e3b\uff0cOpenStack\u7f51\u7edc\u4e3a\u8f85\uff0c\u4ecb\u7ecd\u4e00\u4e9b\u5178\u578b\u7684\u684c\u9762\u4e91\u7f51\u7edc\u914d\u7f6e\u573a\u666f\u3002 2.1. oVirt/OpenStack\u7ec4\u7f51\u65b9\u5f0f oVirt/OpenStack\u4e2d\u7684\u7ec4\u7f51\u65b9\u5f0f\u90fd\u4ee5\u4e0a\u4e00\u7ae0\u8282\u4e2d\u7684\u4e09\u79cd\u7ec4\u7f51\u4e3a\u57fa\u7840\uff0c\u642d\u914dVLAN\uff08tagged\u3001untagged\uff09\u8fdb\u884c\u7ec4\u5408\u3002\u6211\u4eec\u5728\u6b64\u4e0d\u6d89\u53ca\u7f51\u7edc\u5e94\u7528\uff08CDN\u3001Load Balance\u3001Firewall\uff09\uff0c\u4ec5\u4ec5\u5c31\u865a\u62df\u684c\u9762\u4e2d\u7684\u7ec4\u7f51\u65b9\u5f0f\u9009\u62e9\u8fdb\u884c\u8ba8\u8bba\u3002 2.1.1. OpenStack\u5178\u578b\u7ec4\u7f51 OpenStack\u7684\u7ec4\u7f51\u540e\u7aef\u6709Linux Bridge\u548cOpenvSwitch\u4e24\u79cd\uff0c\u5728\u7edd\u5927\u591a\u6570\u7684\u5b9e\u65bd\u4e2d\u6211\u4eec\u4e00\u822c\u90fd\u4f1a\u4f7f\u7528VLAN\u914d\u5408\u7ec4\u7f51\u3002 Linux Bridge\u7ec4\u7f51 \u4f7f\u7528Linux Bridge\u4f5c\u4e3aNeutron\u540e\u7aef\u65f6\uff0c\u7f51\u7edc\u8282\u70b9\u4f1a\u4f7f\u7528\u8bf8\u5982ip\u3001dnsmasq\u3001iptables\u3001brctl\u7b49\u547d\u4ee4\u5b8c\u6210\u4e8c\u4e09\u5c42\u529f\u80fd\u3002\u6bcf\u4e00\u4e2a\u63a5\u53e3\u4e0e\u6865\u7684\u4fe1\u606f\u90fd\u4f1a\u4ee5\u5143\u6570\u636e\u5f62\u5f0f\u4fdd\u7559\u5728\u6570\u636e\u5e93\u4e2d\u3002 :::{figure} ../images/lb-network.png :align: center \u56fe2-1 Linux Bridge\u7f51\u7edc\u8282\u70b9\u6982\u56fe ::: \u7136\u540e\u5b9e\u4f8b\u4e0e\u5212\u5206\u51fa\u7684\u5404\u79cd\u63a5\u53e3\u63a5\u9a73\uff0c\u8fd9\u4e9b\u63a5\u53e3\u7ecf\u8fc7Linux Bridge Agent\u7684\u90e8\u7f72\u540e\uff0c\u518d\u4e0e\u7f51\u7edc\u8282\u70b9\u76f8\u8fde\u3002 :::{figure} ../images/lb-compute.png :align: center \u56fe2-2 Linux Bridge\u8ba1\u7b97\u8282\u70b9\u6982\u56fe ::: \u4e0b\u56fe\u662f\u5178\u578b\u7684\u5b9e\u4f8b\u8fd0\u884c\u65f6\u7f51\u7edc\u62d3\u6251\u3002 :::{figure} ../images/lb-flow.png :align: center \u56fe2-3 Linux Bridge\u7ec4\u7f51\u62d3\u6251 ::: OVS\u7ec4\u7f51 \u4f7f\u7528Linux Bridge\u4f5c\u4e3aNeutron\u540e\u7aef\u65f6\uff0c\u7f51\u7edc\u8282\u70b9\u4f1a\u4f7f\u7528OVS\u547d\u4ee4\u5b8c\u6210\u6240\u6709\u4e09\u5c42\u3001DHCP\u3001\u4ea4\u6362\u529f\u80fd\uff0c\u540c\u65f6\u8fd9\u4e9b\u4fe1\u606f\u4e5f\u4f1a\u4fdd\u7559\u5728\u5143\u6570\u636e\u4e2d\u3002 :::{figure} ../images/ovs-network.png :align: center \u56fe2-4 OVS\u7f51\u7edc\u8282\u70b9\u6982\u56fe ::: \u5b9e\u4f8b\u5728\u901a\u4fe1\u65f6\uff0c\u6570\u636e\u5305\u7ecf\u8fc7\u7ba1\u9053\u3001VLAN\u6807\u7b7e\u5904\u7406\uff0c\u7136\u540e\u7ecf\u7f51\u7edc\u8282\u70b9FlowTable\u63a7\u5236\uff0c\u6700\u7ec8\u6570\u636e\u5f97\u4ee5\u4f20\u8f93\u3002 :::{figure} ../images/ovs-compute.png :align: center \u56fe2-5 OVS\u8ba1\u7b97\u8282\u70b9\u6982\u56fe ::: \u4e0b\u56fe\u662f\u4f7f\u7528\u56fa\u5b9aIP\u7684\u5b9e\u4f8b\u7f51\u7edc\u62d3\u6251\u3002 :::{figure} ../images/ovs-flow.png :align: center \u56fe2-6 \u56fa\u5b9aIP\u5b9e\u4f8bOVS\u7f51\u7edc\u62d3\u6251 ::: 2.1.2. oVirt\u9ed8\u8ba4\u7ec4\u7f51\u65b9\u5f0f oVirt\u7684\u7ba1\u7406\u754c\u9762\u4e2d\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u62d6\u52a8\u7f51\u7edc\u6807\u7b7e\u5e76\u5c06\u4e4b\u4e0e\u7269\u7406\u7f51\u53e3\u7ed1\u5b9a\uff0c\u5e76\u4e14\u7269\u7406\u7f51\u53e3\u4e4b\u95f4\u53ef\u4ee5\u8fdb\u884c\u591a\u79cd\u6a21\u5f0f\u7684bonding\uff0c\u7136\u540e\u6bcf\u4e00\u4e2a\u7f51\u7edc\u6807\u7b7e\u90fd\u53ef\u4ee5\u914d\u7f6eIP\u4fe1\u606f\u3001VLAN\u4fe1\u606f\u3002\u5f53\u7f51\u7edc\u8bbe\u7f6e\u5b8c\u6210\u5e76\u9644\u52a0\u5230\u865a\u62df\u673a\u4ee5\u540e\uff0c\u6240\u6709\u865a\u62df\u673a\u7f51\u53e3\u90fd\u4f1a\u4e0e\u6807\u7b7e\u7684\u7f51\u7edc\u8fdb\u884c\u6865\u63a5\uff08\u53ef\u4ee5\u9009\u62e9\u4fdd\u7559\u6216\u8005\u5265\u79bbVLAN\u4fe1\u606f\uff09\u3002 :::{figure} ../images/set_if.png :align: center \u56fe2-7 oVirt\u7ba1\u7406\u754c\u9762\u8bbe\u7f6e\u7f51\u7edc ::: oVirt\u4e5f\u53ef\u4ee5\u4f7f\u7528OpenStack Neutron\u7684\u7f51\u7edc\uff0c\u4ece\u800c\u5f25\u8865\u4e86oVirt\u7f51\u7edc\u865a\u62df\u5316\u7684\u4e0d\u8db3\u3002 :::{figure} ../images/n1.png :align: center \u56fe2-8 oVirt\u7ba1\u7406\u754c\u9762\u6dfb\u52a0Neutron\u7f51\u7edc - \u914d\u7f6eTenant ::: :::{figure} ../images/n2.png :align: center \u56fe2-9 oVirt\u7ba1\u7406\u754c\u9762\u6dfb\u52a0Neutron\u7f51\u7edc - \u914d\u7f6eMQ ::: \u9664OpenStack Neutron\u5916\uff0coVirt\u53ef\u4ee5\u4f7f\u7528\u7684\u5916\u90e8\u670d\u52a1\u6709OpenStack Glance\u3001Foreman\u3001Docker\u7b49\u3002\u4ece\u5176\u9ed8\u8ba4\u7684ovirt-image-repository\u5916\u90e8Glance\u6e90\u4e2d\u6211\u4eec\u53ef\u4ee5\u5bfc\u5165Neutron\u5b9e\u4f8b\u5230\u672c\u5730\uff0c\u7136\u540e\u5f88\u65b9\u4fbf\u5730\u642d\u5efaOpenStack Neutron\u7f51\u7edc\u800c\u4e0d\u9700\u8981\u5b8c\u6574\u7684OpenStack\u73af\u5883\u3002 :::{figure} ../images/na.png :align: center \u56fe2-10 oVirt\u4e2d\u5bfc\u5165Neutron\u5b9e\u4f8b ::: 2.2. \u573a\u666f\u7ec6\u5206 2.2.1. \u6559\u5b66\u673a\u623f \u6559\u5b66\u673a\u623f\u5185\u7684\u4e0d\u7ba1\u662f\u8f6f\u4ef6\u8fd8\u662f\u786c\u4ef6\uff0c\u5411\u6765\u662f\u5404\u5382\u5546\u7684\u201c\u5175\u5bb6\u5fc5\u4e89\u4e4b\u6240\u201d\u3002\u9996\u5148\uff0c\u5b83\u5177\u6709\u4e00\u5b9a\u7684\u89c4\u6a21\uff0c\u80fd\u591f\u521b\u9020\u5f88\u597d\u7684\u5229\u6da6\uff1b\u5176\u6b21\uff0c\u5b83\u6240\u9762\u5411\u7684\u7fa4\u4f53\u4e3b\u8981\u662f\u5b66\u751f\uff0c\u4ed6\u4eec\u5728\u5de5\u4f5c\u540e\u5f88\u6709\u53ef\u80fd\u4f1a\u4e0d\u81ea\u89c9\u5730\u5e2e\u52a9\u63a8\u5e7f\u8fd9\u4e9b\u4ea7\u54c1\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u4ee5\u6559\u5b66\u673a\u623f\u684c\u9762\u4e3a\u4f8b\u5206\u6790\u4e00\u4e0b\u4f7f\u7528\u54ea\u79cd\u7f51\u7edc\u6700\u5177\u4f18\u52bf\u3002 \u4e00\u822c\u673a\u623f\u6559\u5b66\u684c\u9762\uff0c\u6709\u5b89\u88c5\u8f6f\u4ef6\u7e41\u591a\u3001\u4f7f\u7528\u65f6\u95f4\u56fa\u5b9a\u3001\u5e76\u53d1\u91cf\u5927\u7b49\u7279\u70b9\uff0c\u6bd4\u8f83\u8003\u9a8c\u865a\u62df\u5316\u4ea7\u54c1\u7684\u7efc\u5408\u7d20\u8d28\u3002\u684c\u9762\u5b89\u88c5\u8f6f\u4ef6\u9664\u65e5\u5e38\u529e\u516c\u8f6f\u4ef6\u5916\uff0c\u4e5f\u5305\u62ec\u5404\u79cd\u6587\u5b57\u3001\u56fe\u5f62\u5bc6\u96c6\u7c7b\u6559\u5b66\u8f6f\u4ef6\uff0c\u540c\u65f6\u4e5f\u53ef\u80fd\u4f1a\u5b89\u88c5\u5f71\u97f3\u5e7f\u64ad\u6559\u5b66\u7c7b\u8f6f\u4ef6\u3002\u65e0\u7279\u6b8a\u8981\u6c42\u5916\uff0c\u5f88\u5c11\u5b89\u88c5\u6740\u6bd2\u8f6f\u4ef6\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u4ece\u9700\u6c42\u51fa\u53d1\uff0c\u5bf9\u6240\u6709\u7ec4\u7f51\u65b9\u5f0f\u8fdb\u884c\u7b5b\u9009\uff1a \u5b66\u751f\u3001\u6559\u5e08\u7684\u684c\u9762\uff0c\u8981\u6c42\u53ef\u4ee5\u8fde\u63a5\u7f51\u7edc\uff0c\u53ef\u4ee5\u63a7\u5236\u5916\u7f51\u8bbf\u95ee\u3002\u4ee5\u4e0a\u51e0\u79cd\u7ec4\u7f51\u65b9\u5f0f\u90fd\u53ef\u4ee5\u505a\u5230\uff0c\u90a3\u4e48\u6211\u4eec\u6839\u636e\u6700\u5c0f\u73af\u5883IP\u8d44\u6e90\u5360\u7528\u539f\u5219\uff0c\u5c3d\u91cf\u51cf\u5c11\u6865\u63a5\u7f51\u7edc\u7684\u4f7f\u7528\uff1b \u6559\u5b66\u673a\u623f\u7f51\u7edc\u7ba1\u7406\u4eba\u5458\u5bf9\u865a\u62df\u5316\u5e73\u53f0\u8fdb\u884c\u7ba1\u7406\u65f6\uff0c\u4ed6\u4eec\u5728\u865a\u62df\u684c\u9762\u4e2d\u66f4\u503e\u5411\u4e8e\u5206\u914d\u7b80\u5355\u7684NAT\u7f51\u7edc\u7f51\u6bb5\uff0c\u4ece\u800c\u51cf\u5c11\u62d3\u6251\u7684\u6574\u4f53\u590d\u6742\u6027\u3002 \u5bf9\u4e8e\u7eaf\u8f6f\u4ef6\u65b9\u5f0f\u7684\u591a\u5a92\u4f53\u5e7f\u64ad\u6559\u5b66\u73af\u5883\uff0c\u5f53\u6559\u5e08\u8fdb\u884c\u5e7f\u64ad\u65f6\uff0c\u6559\u5e08\u7aef\u7f16\u7801\u5f80\u5f80\u5728\u5177\u6709\u786c\u4ef6\u663e\u5361\u7684\u7269\u7406\u673a\u4e0a\u624d\u9ad8\u6548\uff0c\u6b64\u65f6\u6559\u5e08\u7aef\u673a\u5668\u9700\u8981\u4e0e\u5b66\u751f\u673a\u5728\u540c\u4e00\u7f51\u6bb5\uff0c\u90a3\u4e48NAT\u6216\u8005OVS\u7ec4\u7f51\u8981\u6c42\u5c31\u5bf9\u73b0\u6709\u73af\u5883\u63d0\u51fa\u4e86\u66f4\u9ad8\u8981\u6c42\uff08\u6bd4\u5982\u53cc\u7f51\u5361\u3001\u670d\u52a1\u5668\u4ea4\u6362\u673a\u989d\u5916VLAN\uff09\u3002\u4e00\u822c\u8fd9\u79cd\u73af\u5883\u4e0b\uff0c\u4f7f\u7528\u6865\u63a5\u7f51\u7edc\u66f4\u5408\u9002\u3002 \u4ee5\u4e0a\u5373\u662f\u7b14\u8005\u5bf9\u6559\u5b66\u673a\u623f\u865a\u62df\u684c\u9762\u5185\u7ec4\u7f51\u65b9\u5f0f\u5bf9\u5efa\u8bae\uff0c\u8bfb\u7740\u5e94\u6839\u636e\u5b9e\u9645\u73af\u5883\u505a\u51fa\u5224\u65ad\uff0c\u5728\u5de5\u4f5c\u91cf\u4e0e\u6027\u80fd\u3001\u529f\u80fd\u95f4\u4f5c\u51fa\u53d6\u820d\u3002 2.2.2. \u529e\u516c\u684c\u9762 \u9762\u5411\u529e\u516c\u7684\u684c\u9762\uff0c\u4e00\u822c\u9700\u6c42\u4e3aMircosoft Office\u3001\u90ae\u4ef6\u5904\u7406\u7b49\u6587\u5b57\u5bc6\u96c6\u578b\u8f6f\u4ef6\uff1b\u901a\u4fe1\u7c7b\u8f6f\u4ef6\u4e00\u822c\u4e3a\u56fd\u5185\u5382\u5546\u5f00\u53d1\u7684\u975e\u5e7f\u57df\u7f51\u901a\u4fe1\u8f6f\u4ef6\u4ee5\u53caQQ\uff1b\u9632\u75c5\u6bd2\u8f6f\u4ef6\u79cd\u7c7b\u6bd4\u8f83\u591a\uff0c\u76ee\u524d\u5361\u5df4\u65af\u57fa\u3001\u8bfa\u987f\u7b49\u5360 \u591a\uff0c360\u4f7f\u7528\u8f83\u5c11\uff1b\u5f71\u97f3\u7c7b\u8f6f\u4ef6\u4f7f\u7528\u5c40\u9650\u4e8e\u7f51\u9875flash\uff0c\u6216\u8005\u56fd\u5185\u5382\u5546\u5b9a\u5236\u7684\u6d41\u5a92\u4f53\u5ba2\u6237\u7aef\u3002\u5bf9\u4e8e\u8d22\u52a1\u684c\u9762\uff0c\u9700\u6c42\u9664\u666e\u901a\u529e\u516c\u684c\u9762\u5916\u4e5f\u6709\u4e00\u4e9b\u8d22\u52a1\u7c7b\u8f6f\u4ef6\uff0c\u800c\u8fd9\u4e9b\u8f6f\u4ef6\u5bf9\u684c\u9762\u8d1f\u8377\u8f83\u666e\u901a\u529e\u516c\u684c\u9762\u4f1a\u9ad8\u51fa\u4e00\u5b9a\u91cf\u7684\u8d44\u6e90\u6d88\u8017\uff0c\u540c\u65f6\u4e5f\u4f1a\u6709U-Key\u3001\u6307\u7eb9 \u4eea\u7b49\u7ec8\u7aef\u8bbe\u5907\uff0c\u6240\u4ee5\u5bf9\u4e8e\u8fd9\u7c7b\u684c\u9762\uff0c\u6211\u4eec\u4e00\u822c\u8fdb\u884c\u7279\u6b8a\u8bbe\u7f6e\uff0c\u6bd4\u5982\u5c06\u5176\u56fa\u5b9a\u5230\u67d0\u53f0\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\uff0c\u5e76\u8d4b\u4e88\u4e00\u5b9a\u4f18\u5148\u7ea7\uff0c\u4fdd\u8bc1\u8d44\u6e90\u4f18\u5148\u5206\u914d\u3002\u5728\u666e\u901a\u684c\u9762\u4e0e\u8d22\u52a1\u684c\u9762\u4ee5\u5916\uff0c\u4e5f\u6709\u6d6e\u52a8\u684c\u9762\u53ef\u4f9b\u51fa\u5dee\u4eba\u5458\u6216\u8005\u6765\u8bbf\u4eba\u5458\u4e34\u65f6\u4f7f\u7528\uff0c\u6b64\u79cd\u684c\u9762\u4e0e\u4e00\u822c\u529e\u516c\u684c\u9762\u65e0\u5f02\uff0c\u4f46\u53ef\u80fd\u8981\u6c42\u6709\u4e25\u683c\u7684\u7528\u6237\u68c0\u67e5\u63a7\u5236\u4ee5\u53ca\u65e0\u72b6\u6001\u6a21\u5f0f\u8981\u6c42\uff0c\u9632\u6b62\u6076\u610f\u4f7f\u7528\u5bfc\u81f4\u635f\u5931\u3002 \u4ee5\u4e0a\u5373\u662f\u529e\u516c\u684c\u9762\u7684\u5178\u578b\u573a\u666f\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u7ec4\u7f51\u65b9\u5f0f\u4e5f\u57fa\u672c\u660e\u786e\u4e86\u3002\u4e00\u822c\u684c\u9762\u4f7f\u7528OVS\u6216\u8005NAT\u7686\uff0c\u4f18\u5148\u8003\u8651OVS\uff1b\u6d6e\u52a8\u684c\u9762\u5219\u4f7f\u7528NAT\uff1b\u5bf9\u4e8e\u8d22\u52a1\u8fd9\u7c7b\u6709\u7279\u6b8a\u9700\u6c42\u7684\u684c\u9762\u6211\u4eec\u4e5f\u53ef\u8003\u8651\u4f7f\u7528\u6865\u63a5\u7f51\u7edc\u3002\u53e6\u5916\u5f53\u529e\u516c\u5ba4\u4e2d\u6709\u7c7b\u4f3c\u6253\u5370\u673a\u3001\u626b\u63cf\u4eea\u3001\u6307\u7eb9\u4eea\u7b49\u5171\u4eab\u8bbe\u5907\u65f6\uff0c\u5b83\u4eec\u7684\u7ec4\u7f51\u4ee5\u6865\u63a5\u65b9\u5f0f\u4f18\u5148\uff0c\u8fd9\u6837\u4fbf\u4fdd\u8bc1\u4e86\u6240\u6709\u4eba\u5458\u90fd\u80fd\u5bf9\u5176\u8fdb\u884c\u8bbf\u95ee\u3002 3. \u603b\u7ed3 \u5728\u5e73\u65f6\u7684\u5b9e\u65bd\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u7ec4\u7f51\u6309\u7167\u8d44\u6e90\u7a00\u7f3a\u6027\u4f9d\u6b21\u6392\u5217\u51fa\u6865\u63a5>OVS>NAT\uff1b\u540c\u65f6\u6309\u7167\u4e00\u822c\u76f8\u5bf9\u8bbf\u95ee\u8303\u56f4\u6392\u5e8f\u6865\u63a5>=OVS>NAT\u3002\u5bf9\u4e8e\u4f7f\u7528\u9891\u7387\u8f83\u9ad8\u7684\u79c1\u6709\u4e91\u800c\u8a00\uff0c\u6211\u4eec\u6839\u636e\u5ba2\u6237\u8fd0\u7ef4\u6c34\u5e73\u3001\u5b9e\u65bd\u6539\u9020\u96be\u5ea6\uff0c\u5e76\u7ed3\u5408\u73b0\u573a\u73af\u5883\u548c\u7279\u6b8a\u9700\u6c42\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u65b9\u53ef\u5f97\u5230\u6bd4\u8f83\u6ee1\u610f\u7684\u7ec4\u7f51\u89c4\u5212\u3002","title":"\u300a\u8fd0\u7ef4\u524d\u7ebf\u300b\u79c1\u6709\u4e91\u684c\u9762\u7f51\u7edc\u7ec4\u5efa\u8349\u7a3f"},{"location":"inthecloud/frontline-network/#_1","text":"\u672c\u6587\u4ecb\u7ecd\u4e86\u79c1\u6709\u4e91\u684c\u9762\u4e2d\u7ec4\u7f51\u7684\u57fa\u7840\u6280\u672f\u53ca\u5176\u5b9e\u73b0\u65b9\u5f0f\uff0c\u7136\u540e\u53c8\u5217\u4e3e\u4e86oVirt/OpenStack\u4e2d\u5173\u4e8e\u865a\u62df\u684c\u9762\u7f51\u7edc\u7684\u7ec4\u5efa\u65b9\u5f0f\u3002\u6700\u540e\u7b14\u8005\u5c1d\u8bd5\u4ece\u591a\u4e2a\u65b9\u9762\u89e3\u6790\u5178\u578b\u79c1\u6709\u4e91\u684c\u9762\u4e2d\u7f51\u7edc\u914d\u7f6e\u7684\u9009\u62e9\uff0c\u4ee5\u53ca\u5b83\u4eec\u53ef\u80fd\u5e26\u6765\u7684\u98ce\u9669\u53ca\u5229\u5f0a\u3002","title":"\u79c1\u6709\u4e91\u684c\u9762\u7f51\u7edc\u7ec4\u5efa"},{"location":"inthecloud/frontline-network/#1","text":"\u7b14\u8005\u6240\u63a5\u89e6\u7684\u865a\u62df\u5316\u684c\u9762\u4e91\u5e73\u53f0\u4e2d\uff0c\u666e\u904d\u4f7f\u7528libvirt\u7ec4\u7f51\uff0c\u5176\u5b9e\u73b0\u6280\u672f\u53ef\u4ee5\u662ftagged\u6216\u8005untagged vlan\uff0cNAT\uff0c\u6865\u63a5\uff0copenvswitch\u7b49\u3002\u63a5\u4e0b\u6765\u6211\u5c06\u5c31\u4f7f\u7528\u8f83\u591a\u7684NAT\u7f51\u7edc\u3001\u6865\u63a5\u7f51\u7edc\u548copenvswitch\u4f5c\u4e9b\u8be6\u7ec6\u4ecb\u7ecd\u3002","title":"1. \u684c\u9762\u4e91\u4e2d\u5e38\u7528\u7f51\u7edc"},{"location":"inthecloud/frontline-network/#11-nat","text":"\u5bf9\u4e8eNAT\uff08network address translation\uff09\u6280\u672f\uff0c\u6211\u4eec\u6216\u8bb8\u5e76\u4e0d\u964c\u751f\u3002\u6211\u4eec\u5bb6\u5ead\u8def\u7531\u5668\u63a5\u5165ISP\u63d0\u4f9b\u5546\u65f6\uff0c\u8def\u7531\u5668\u4f1a\u83b7\u5f97\u4e00\u4e2a\u5916\u7f51IP\uff08\u516c\u7f51IP\uff09\uff0c\u5c40\u57df\u7f51\u7535\u8111\u63a5\u5165\u8def\u7531\u5668\u540e\u83b7\u5f97\u4e00\u4e2a\u5185\u7f51IP\uff0c\u6211\u4eec\u5373\u662f\u4eceNAT\u540e\u7aef\u6765\u8bbf\u95ee\u5916\u7f51\u7684\u3002\u8fd9\u4e5f\u662fNAT\u6700\u5e7f\u7684\u7528\u9014\u4e4b\u4e00\uff0c\u968f\u7740\u73b0\u5728IPv6\u7684\u6d41\u884c\uff0c\u6709\u4eba\u751a\u81f3\u8ba4\u4e3aNAT\u6280\u672f\u4e0d\u5982\u5f80\u65e5\u91cd\u8981\u4e86\u3002\u6211\u4eec\u5728\u6b64\u4e0d\u8ba8\u8bba\u8fd9\u4e2a\u8bdd\u9898\uff0c\u53ea\u4ecb\u7ecd\u4e00\u4e0bNAT\u6280\u672f\u7684\u5728\u865a\u62df\u5316\u4e2d\u7684\u5e38\u89c1\u5e94\u7528\u573a\u666f\u3002 \u56fe1-1 NAT\u901a\u7528\u5b9e\u73b0 \u5185\u90e8\u5730\u5740 iAddr:port1 \u6620\u5c04\u5230\u5916\u90e8\u5730\u5740 eAddr:port2 \uff0c\u6240\u6709\u4ece iAddr:port1 \u7684\u5305\u90fd\u7ecf\u7531 eAddr:port2 \u5411\u5916\u53d1\u9001\u3002\u6240\u6709\u5916\u90e8\u4e3b\u673a\u90fd\u80fd\u901a\u8fc7 eAddr:port2 \u5411\u5185\u90e8\u4e3b\u673a\u7684 iAddr:port1 \u53d1\u9001\u6570\u636e\uff0c\u6709\u4e9b\u5b9e\u73b0\u4e2d\uff0c\u8981\u6c42\u5fc5\u987b\u5185\u90e8\u4e3b\u673a\u5148\u5411\u5916\u90e8\u4e3b\u673a\u53d1\u9001\u6570\u636e\u624d\u80fd\u5141\u8bb8\u5916\u90e8\u53d1\u9001\u81f3\u5185\u90e8\u3002 \u56fe1-2 libvirt NAT\u793a\u4f8b 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <network> <name> default </name> <bridge name= \"virbr0\" /> <forward mode= \"nat\" /> <domain name= \"example.com\" /> <dns> <txt name= \"example\" value= \"example value\" /> <forwarder addr= \"8.8.8.8\" /> <forwarder addr= \"8.8.4.4\" /> <srv service= 'name' protocol= 'tcp' domain= 'test-domain-name' target= '.' port= '1024' priority= '10' weight= '10' /> <host ip= '192.168.122.2' > <hostname> myhost </hostname> <hostname> myhostalias </hostname> </host> </dns> <ip address= \"192.168.122.1\" netmask= \"255.255.255.0\" > <dhcp> <range start= \"192.168.122.100\" end= \"192.168.122.254\" /> </dhcp> </ip> <ip family= \"ipv6\" address= \"2001:db8:ca2:2::1\" prefix= \"64\" /> </network> \u6240\u6709\u865a\u62df\u673a\u83b7\u5f97\u7684IP\u8303\u56f4\u4e3a 192.168.122.100-192.168.122.254 \uff0c\u7f51\u5173\u4e3a 192.168.122.1 \uff0cDNS\u4e3a 192.168.122.2 \uff0c\u8bf7\u6c42\u53ef\u8f6c\u53d1\u81f3 8.8.8.8 \u6216 8.8.4.4 \u3002 \u5728\u865a\u62df\u5316\u4e2d\u4f7f\u7528NAT\u7684\u597d\u5904\u4e0d\u8a00\u800c\u55bb\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u70b9\uff1a \u89e3\u51b3\u4e86\u5c40\u57df\u7f51\u4e2dIP\u53ef\u80fd\u4e0d\u8db3\u7684\u9690\u60a3\uff1b \u7f51\u7edc\u62d3\u6251\u66f4\u5177\u5f39\u6027\uff1b \u5ba2\u6237\u7aef\u7f51\u7edc\u884c\u4e3a\u66f4\u6613\u63a7\u5236\uff0c\u6bd4\u5982\u5c40\u57df\u7f51\u3001\u5916\u7f51\u8bbf\u95ee\u6743\u9650\uff1b","title":"1.1. NAT\u7f51\u7edc"},{"location":"inthecloud/frontline-network/#12","text":"\u6865\u63a5\u5373\u662f\u5c06\u4e24\u4e2a\u4ee5\u4e0a\u7684\u7f51\u7edc\u901a\u8fc7\u8bbe\u5907\u8fdb\u884c\u8fde\u63a5\u4ece\u800c\u8fbe\u5230\u7f51\u7edc\u6c47\u805a\u7684\u76ee\u7684\u3002\u6865\u63a5\u4f4d\u4e8eOSI\u6a21\u578b\u4e2d\u7684\u7269\u7406\u5c42\u548c\u94fe\u8def\u5c42\u6570\u636e\u94fe\u8def\u5c42\u3002\u6865\u63a5\u6280\u672f\u6709\u56db\u79cd\uff1a\u7b80\u5355\u6865\u63a5\u3001\u591a\u7aef\u53e3\u6865\u63a5\u3001\u900f\u660e\u6865\u63a5\u548c\u6e90\u8def\u7531\u5de7\u63a5\u3002\u5728\u865a\u62df\u5316\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u4f7f\u7528\u7684\u662f\u591a\u7aef\u53e3\u6865\u63a5\u3002 :::{figure} ../images/libvirt-route.png :align: center \u56fe1-3 libvirt\u4e2d\u7684\u6865\u63a5\u793a\u610f\u56fe \u4e3a\u4e86\u4f7f\u7528\u6865\u63a5\u7f51\u7edc\uff0c\u6211\u4eec\u9996\u5148\u9700\u8981\u914d\u7f6e\u6865\u63a5\u53e3\uff0c\u6b64\u5904\u7b14\u8005\u4ee5RHEL\u64cd\u4f5c\u7cfb\u7edf\u793a\u4f8b\u3002\u914d\u7f6ebr0\u4e3a\u6865\u63a5\u53e3\uff0c\u5176\u4e2d\u4e00\u4e2aport\u4e3a\u7269\u7406\u63a5\u53e3eth0\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 /etc/sysconfig/network-scripts/ifcfg-br0 DEVICE=br0 TYPE=Bridge BOOTPROTO=none ONBOOT=yes DEFROUTE=yes IPADDR=192.168.0.100 NETMASK=255.255.255.0 GATEWAY=192.168.0.254 DNS1=8.8.8.8 DNS2=8.8.4.4 /etc/sysconfig/network-scripts/ifcfg-eth0 DEVICE=eth0 ONBOOT=yes BRIDGE=br0 \u6211\u4eec\u901a\u8fc7VirtManager\u542f\u52a8\u865a\u62df\u673a\u540e\u53ef\u770b\u5230\u5982\u4e0b\u5185\u5bb9\u3002\u5176\u4e2dbr0\u662f\u521a\u521a\u521b\u5efa\u7684\u6865\uff0ceth0\u548cvnet0\u662f\u6865\u4e2d\u7684\u4e24\u4e2a\u63a5\u53e3\u3002 1 2 3 4 [ root@localhost ~ ] # brctl show bridge name bridge id STP enabled interfaces br0 8000 .000c2958db65 no eth0 vnet0","title":"1.2. \u6865\u63a5\u7f51\u7edc"},{"location":"inthecloud/frontline-network/#13-open-vswitch","text":"Open vSwitch\uff08\u4e0b\u9762\u7b80\u79f0\u4e3a OVS\uff09\u662f\u7531 Nicira Networks \u4e3b\u5bfc\u7684\uff0c\u8fd0\u884c\u5728\u865a\u62df\u5316\u5e73\u53f0\uff08 KVM\uff0cXen\uff09\u4e0a\u7684\u865a\u62df\u4ea4\u6362\u673a\u3002\u5728\u865a\u62df\u5316\u5e73\u53f0\u4e0a\uff0cOVS\u53ef\u4ee5\u4e3a\u52a8\u6001\u53d8\u5316\u7684\u7aef\u70b9\u63d0\u4f9b2\u5c42\u4ea4\u6362\u529f\u80fd\uff0c\u4ece\u800c\u5f88\u597d\u5730\u63a7\u5236\u865a\u62df\u7f51\u7edc\u4e2d\u7684\u8bbf\u95ee\u7b56\u7565\u3001\u7f51\u7edc\u9694\u79bb\u3001\u6d41\u91cf\u76d1\u63a7\u7b49\u3002OVS \u9075\u5faaApache 2.0\u8bb8\u53ef\u8bc1, \u80fd\u540c\u65f6\u652f\u6301\u591a\u79cd\u6807\u51c6\u7684\u7ba1\u7406\u63a5\u53e3\u548c\u534f\u8bae\u3002OVS\u4e5f\u63d0\u4f9b\u4e86\u5bf9OpenFlow\u534f\u8bae\u7684\u652f\u6301\uff0c\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u652f\u6301OpenFlow\u534f\u8bae\u7684\u63a7\u5236\u5668\u5bf9OVS\u8fdb\u884c\u8fdc\u7a0b\u7ba1\u7406\u63a7\u5236\u3002 \u5728OVS\u4e2d, \u6709\u51e0\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u6982\u5ff5\uff1a Bridge\uff1aBridge\u4ee3\u8868\u4e00\u4e2a\u865a\u62df\u4ea4\u6362\u673a\uff08Switch\uff09\uff0c\u4e00\u4e2a\u4e3b\u673a\u4e2d\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6216\u8005\u591a\u4e2aBridge\u8bbe\u5907\u3002 Port\uff1a\u7aef\u53e3\u4e0e\u7269\u7406\u4ea4\u6362\u673a\u7684\u7aef\u53e3\u6982\u5ff5\u7c7b\u4f3c\uff0c\u6bcf\u4e2aPort\u90fd\u96b6\u5c5e\u4e8e\u4e00\u4e2aBridge\u3002 Interface\uff1a\u8fde\u63a5\u5230Port\u7684\u7f51\u7edc\u63a5\u53e3\u8bbe\u5907\u3002\u5728\u901a\u5e38\u60c5\u51b5\u4e0b\uff0cPort\u548cInterface\u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb, \u53ea\u6709\u5728\u914d\u7f6ePort\u4e3abond\u6a21\u5f0f\u540e\uff0cPort\u548cInterface\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\u3002 Controller\uff1aOpenFlow\u63a7\u5236\u5668\u3002OVS\u53ef\u4ee5\u540c\u65f6\u63a5\u53d7\u4e00\u4e2a\u6216\u8005\u591a\u4e2aOpenFlow\u63a7\u5236\u5668\u7684\u7ba1\u7406\u3002 Datapath\uff1a\u5728 OVS \u4e2d\uff0cdatapath\u8d1f\u8d23\u6267\u884c\u6570\u636e\u4ea4\u6362\uff0c\u4e5f\u5c31\u662f\u628a\u4ece\u63a5\u6536\u7aef\u53e3\u6536\u5230\u7684\u6570\u636e\u5305\u5728\u6d41\u8868\u4e2d\u8fdb\u884c\u5339\u914d\uff0c\u5e76\u6267\u884c\u5339\u914d\u5230\u7684\u52a8\u4f5c\u3002 Flow Table\uff1a\u6bcf\u4e2a datapath \u90fd\u548c\u4e00\u4e2aflow table\u5173\u8054\uff0c\u5f53datapath\u63a5\u6536\u5230\u6570\u636e\u4e4b\u540e\uff0cOVS\u4f1a\u5728flow table\u4e2d\u67e5\u627e\u53ef\u4ee5\u5339\u914d\u7684flow\uff0c\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c, \u4f8b\u5982\u8f6c\u53d1\u6570\u636e\u5230\u5176\u4ed6\u6307\u5b9a\u7aef\u53e3\u3002 \u4e00\u822c\u5728\u865a\u62df\u5316\u5e73\u53f0\u4e2d\uff0c\u4f7f\u7528OVS\u65f6\u591a\u6570\u4f1a\u914d\u5408\u5c40\u57df\u7f51\u7684VLAN\u4ee5\u4fbf\u4e8e\u7ba1\u7406\u3002\u5728\u6d41\u91cf\u8f83\u5c0f\u7684\u7f51\u7edc\u73af\u5883\u4e2d\uff0c\u4f7f\u7528\u5176GRE\u7f51\u7edc\u7528\u4e8e\u591a\u865a\u62df\u673a\u4e92\u8054\u7684\u573a\u666f\u4e5f\u5f88\u5e38\u89c1\u3002 :::{figure} ../images/ovs-gre.png :align: center \u56fe1-4 OVS\u4f7f\u7528GRE\u8054\u901a\u865a\u62df\u673a\u7f51\u7edc\u793a\u610f\u56fe ::: \u5728libvirt\u4e2d\u4f7f\u7528OVS\u7f51\u7edc\u65f6\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u5b9a\u4e49\u3002 1 2 3 4 5 6 7 8 9 10 # cat ovs-br0.xml <network> <name>ovs-net</name> <forward mode='bridge'/> <bridge name='ovs-br0' /> <virtualport type='openvswitch'/> </network> # virsh define ovs-br0.xml # virsh start ovs-br0","title":"1.3. Open vSwitch"},{"location":"inthecloud/frontline-network/#2-ovirtopenstack","text":"oVirt\u7684\u865a\u62df\u673a\u7f51\u7edc\u9ed8\u8ba4\u4f7f\u7528\u6865\u63a5\uff0c\u800cOpenStack\u53ef\u4ee5\u9009\u914d\u4f7f\u7528\u6865\u63a5\u3001OVS\u7b49\u4f5c\u4e3a\u540e\u7aef\u3002\u7b14\u8005\u5c06\u4ee5oVirt\u4e3a\u4e3b\uff0cOpenStack\u7f51\u7edc\u4e3a\u8f85\uff0c\u4ecb\u7ecd\u4e00\u4e9b\u5178\u578b\u7684\u684c\u9762\u4e91\u7f51\u7edc\u914d\u7f6e\u573a\u666f\u3002","title":"2. oVirt/OpenStack\u7684\u684c\u9762\u7f51\u7edc\u5e94\u7528"},{"location":"inthecloud/frontline-network/#21-ovirtopenstack","text":"oVirt/OpenStack\u4e2d\u7684\u7ec4\u7f51\u65b9\u5f0f\u90fd\u4ee5\u4e0a\u4e00\u7ae0\u8282\u4e2d\u7684\u4e09\u79cd\u7ec4\u7f51\u4e3a\u57fa\u7840\uff0c\u642d\u914dVLAN\uff08tagged\u3001untagged\uff09\u8fdb\u884c\u7ec4\u5408\u3002\u6211\u4eec\u5728\u6b64\u4e0d\u6d89\u53ca\u7f51\u7edc\u5e94\u7528\uff08CDN\u3001Load Balance\u3001Firewall\uff09\uff0c\u4ec5\u4ec5\u5c31\u865a\u62df\u684c\u9762\u4e2d\u7684\u7ec4\u7f51\u65b9\u5f0f\u9009\u62e9\u8fdb\u884c\u8ba8\u8bba\u3002","title":"2.1. oVirt/OpenStack\u7ec4\u7f51\u65b9\u5f0f"},{"location":"inthecloud/frontline-network/#211-openstack","text":"OpenStack\u7684\u7ec4\u7f51\u540e\u7aef\u6709Linux Bridge\u548cOpenvSwitch\u4e24\u79cd\uff0c\u5728\u7edd\u5927\u591a\u6570\u7684\u5b9e\u65bd\u4e2d\u6211\u4eec\u4e00\u822c\u90fd\u4f1a\u4f7f\u7528VLAN\u914d\u5408\u7ec4\u7f51\u3002 Linux Bridge\u7ec4\u7f51 \u4f7f\u7528Linux Bridge\u4f5c\u4e3aNeutron\u540e\u7aef\u65f6\uff0c\u7f51\u7edc\u8282\u70b9\u4f1a\u4f7f\u7528\u8bf8\u5982ip\u3001dnsmasq\u3001iptables\u3001brctl\u7b49\u547d\u4ee4\u5b8c\u6210\u4e8c\u4e09\u5c42\u529f\u80fd\u3002\u6bcf\u4e00\u4e2a\u63a5\u53e3\u4e0e\u6865\u7684\u4fe1\u606f\u90fd\u4f1a\u4ee5\u5143\u6570\u636e\u5f62\u5f0f\u4fdd\u7559\u5728\u6570\u636e\u5e93\u4e2d\u3002 :::{figure} ../images/lb-network.png :align: center \u56fe2-1 Linux Bridge\u7f51\u7edc\u8282\u70b9\u6982\u56fe ::: \u7136\u540e\u5b9e\u4f8b\u4e0e\u5212\u5206\u51fa\u7684\u5404\u79cd\u63a5\u53e3\u63a5\u9a73\uff0c\u8fd9\u4e9b\u63a5\u53e3\u7ecf\u8fc7Linux Bridge Agent\u7684\u90e8\u7f72\u540e\uff0c\u518d\u4e0e\u7f51\u7edc\u8282\u70b9\u76f8\u8fde\u3002 :::{figure} ../images/lb-compute.png :align: center \u56fe2-2 Linux Bridge\u8ba1\u7b97\u8282\u70b9\u6982\u56fe ::: \u4e0b\u56fe\u662f\u5178\u578b\u7684\u5b9e\u4f8b\u8fd0\u884c\u65f6\u7f51\u7edc\u62d3\u6251\u3002 :::{figure} ../images/lb-flow.png :align: center \u56fe2-3 Linux Bridge\u7ec4\u7f51\u62d3\u6251 ::: OVS\u7ec4\u7f51 \u4f7f\u7528Linux Bridge\u4f5c\u4e3aNeutron\u540e\u7aef\u65f6\uff0c\u7f51\u7edc\u8282\u70b9\u4f1a\u4f7f\u7528OVS\u547d\u4ee4\u5b8c\u6210\u6240\u6709\u4e09\u5c42\u3001DHCP\u3001\u4ea4\u6362\u529f\u80fd\uff0c\u540c\u65f6\u8fd9\u4e9b\u4fe1\u606f\u4e5f\u4f1a\u4fdd\u7559\u5728\u5143\u6570\u636e\u4e2d\u3002 :::{figure} ../images/ovs-network.png :align: center \u56fe2-4 OVS\u7f51\u7edc\u8282\u70b9\u6982\u56fe ::: \u5b9e\u4f8b\u5728\u901a\u4fe1\u65f6\uff0c\u6570\u636e\u5305\u7ecf\u8fc7\u7ba1\u9053\u3001VLAN\u6807\u7b7e\u5904\u7406\uff0c\u7136\u540e\u7ecf\u7f51\u7edc\u8282\u70b9FlowTable\u63a7\u5236\uff0c\u6700\u7ec8\u6570\u636e\u5f97\u4ee5\u4f20\u8f93\u3002 :::{figure} ../images/ovs-compute.png :align: center \u56fe2-5 OVS\u8ba1\u7b97\u8282\u70b9\u6982\u56fe ::: \u4e0b\u56fe\u662f\u4f7f\u7528\u56fa\u5b9aIP\u7684\u5b9e\u4f8b\u7f51\u7edc\u62d3\u6251\u3002 :::{figure} ../images/ovs-flow.png :align: center \u56fe2-6 \u56fa\u5b9aIP\u5b9e\u4f8bOVS\u7f51\u7edc\u62d3\u6251 :::","title":"2.1.1. OpenStack\u5178\u578b\u7ec4\u7f51"},{"location":"inthecloud/frontline-network/#212-ovirt","text":"oVirt\u7684\u7ba1\u7406\u754c\u9762\u4e2d\u6211\u4eec\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u62d6\u52a8\u7f51\u7edc\u6807\u7b7e\u5e76\u5c06\u4e4b\u4e0e\u7269\u7406\u7f51\u53e3\u7ed1\u5b9a\uff0c\u5e76\u4e14\u7269\u7406\u7f51\u53e3\u4e4b\u95f4\u53ef\u4ee5\u8fdb\u884c\u591a\u79cd\u6a21\u5f0f\u7684bonding\uff0c\u7136\u540e\u6bcf\u4e00\u4e2a\u7f51\u7edc\u6807\u7b7e\u90fd\u53ef\u4ee5\u914d\u7f6eIP\u4fe1\u606f\u3001VLAN\u4fe1\u606f\u3002\u5f53\u7f51\u7edc\u8bbe\u7f6e\u5b8c\u6210\u5e76\u9644\u52a0\u5230\u865a\u62df\u673a\u4ee5\u540e\uff0c\u6240\u6709\u865a\u62df\u673a\u7f51\u53e3\u90fd\u4f1a\u4e0e\u6807\u7b7e\u7684\u7f51\u7edc\u8fdb\u884c\u6865\u63a5\uff08\u53ef\u4ee5\u9009\u62e9\u4fdd\u7559\u6216\u8005\u5265\u79bbVLAN\u4fe1\u606f\uff09\u3002 :::{figure} ../images/set_if.png :align: center \u56fe2-7 oVirt\u7ba1\u7406\u754c\u9762\u8bbe\u7f6e\u7f51\u7edc ::: oVirt\u4e5f\u53ef\u4ee5\u4f7f\u7528OpenStack Neutron\u7684\u7f51\u7edc\uff0c\u4ece\u800c\u5f25\u8865\u4e86oVirt\u7f51\u7edc\u865a\u62df\u5316\u7684\u4e0d\u8db3\u3002 :::{figure} ../images/n1.png :align: center \u56fe2-8 oVirt\u7ba1\u7406\u754c\u9762\u6dfb\u52a0Neutron\u7f51\u7edc - \u914d\u7f6eTenant ::: :::{figure} ../images/n2.png :align: center \u56fe2-9 oVirt\u7ba1\u7406\u754c\u9762\u6dfb\u52a0Neutron\u7f51\u7edc - \u914d\u7f6eMQ ::: \u9664OpenStack Neutron\u5916\uff0coVirt\u53ef\u4ee5\u4f7f\u7528\u7684\u5916\u90e8\u670d\u52a1\u6709OpenStack Glance\u3001Foreman\u3001Docker\u7b49\u3002\u4ece\u5176\u9ed8\u8ba4\u7684ovirt-image-repository\u5916\u90e8Glance\u6e90\u4e2d\u6211\u4eec\u53ef\u4ee5\u5bfc\u5165Neutron\u5b9e\u4f8b\u5230\u672c\u5730\uff0c\u7136\u540e\u5f88\u65b9\u4fbf\u5730\u642d\u5efaOpenStack Neutron\u7f51\u7edc\u800c\u4e0d\u9700\u8981\u5b8c\u6574\u7684OpenStack\u73af\u5883\u3002 :::{figure} ../images/na.png :align: center \u56fe2-10 oVirt\u4e2d\u5bfc\u5165Neutron\u5b9e\u4f8b :::","title":"2.1.2. oVirt\u9ed8\u8ba4\u7ec4\u7f51\u65b9\u5f0f"},{"location":"inthecloud/frontline-network/#22","text":"","title":"2.2. \u573a\u666f\u7ec6\u5206"},{"location":"inthecloud/frontline-network/#221","text":"\u6559\u5b66\u673a\u623f\u5185\u7684\u4e0d\u7ba1\u662f\u8f6f\u4ef6\u8fd8\u662f\u786c\u4ef6\uff0c\u5411\u6765\u662f\u5404\u5382\u5546\u7684\u201c\u5175\u5bb6\u5fc5\u4e89\u4e4b\u6240\u201d\u3002\u9996\u5148\uff0c\u5b83\u5177\u6709\u4e00\u5b9a\u7684\u89c4\u6a21\uff0c\u80fd\u591f\u521b\u9020\u5f88\u597d\u7684\u5229\u6da6\uff1b\u5176\u6b21\uff0c\u5b83\u6240\u9762\u5411\u7684\u7fa4\u4f53\u4e3b\u8981\u662f\u5b66\u751f\uff0c\u4ed6\u4eec\u5728\u5de5\u4f5c\u540e\u5f88\u6709\u53ef\u80fd\u4f1a\u4e0d\u81ea\u89c9\u5730\u5e2e\u52a9\u63a8\u5e7f\u8fd9\u4e9b\u4ea7\u54c1\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u4ee5\u6559\u5b66\u673a\u623f\u684c\u9762\u4e3a\u4f8b\u5206\u6790\u4e00\u4e0b\u4f7f\u7528\u54ea\u79cd\u7f51\u7edc\u6700\u5177\u4f18\u52bf\u3002 \u4e00\u822c\u673a\u623f\u6559\u5b66\u684c\u9762\uff0c\u6709\u5b89\u88c5\u8f6f\u4ef6\u7e41\u591a\u3001\u4f7f\u7528\u65f6\u95f4\u56fa\u5b9a\u3001\u5e76\u53d1\u91cf\u5927\u7b49\u7279\u70b9\uff0c\u6bd4\u8f83\u8003\u9a8c\u865a\u62df\u5316\u4ea7\u54c1\u7684\u7efc\u5408\u7d20\u8d28\u3002\u684c\u9762\u5b89\u88c5\u8f6f\u4ef6\u9664\u65e5\u5e38\u529e\u516c\u8f6f\u4ef6\u5916\uff0c\u4e5f\u5305\u62ec\u5404\u79cd\u6587\u5b57\u3001\u56fe\u5f62\u5bc6\u96c6\u7c7b\u6559\u5b66\u8f6f\u4ef6\uff0c\u540c\u65f6\u4e5f\u53ef\u80fd\u4f1a\u5b89\u88c5\u5f71\u97f3\u5e7f\u64ad\u6559\u5b66\u7c7b\u8f6f\u4ef6\u3002\u65e0\u7279\u6b8a\u8981\u6c42\u5916\uff0c\u5f88\u5c11\u5b89\u88c5\u6740\u6bd2\u8f6f\u4ef6\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u4ece\u9700\u6c42\u51fa\u53d1\uff0c\u5bf9\u6240\u6709\u7ec4\u7f51\u65b9\u5f0f\u8fdb\u884c\u7b5b\u9009\uff1a \u5b66\u751f\u3001\u6559\u5e08\u7684\u684c\u9762\uff0c\u8981\u6c42\u53ef\u4ee5\u8fde\u63a5\u7f51\u7edc\uff0c\u53ef\u4ee5\u63a7\u5236\u5916\u7f51\u8bbf\u95ee\u3002\u4ee5\u4e0a\u51e0\u79cd\u7ec4\u7f51\u65b9\u5f0f\u90fd\u53ef\u4ee5\u505a\u5230\uff0c\u90a3\u4e48\u6211\u4eec\u6839\u636e\u6700\u5c0f\u73af\u5883IP\u8d44\u6e90\u5360\u7528\u539f\u5219\uff0c\u5c3d\u91cf\u51cf\u5c11\u6865\u63a5\u7f51\u7edc\u7684\u4f7f\u7528\uff1b \u6559\u5b66\u673a\u623f\u7f51\u7edc\u7ba1\u7406\u4eba\u5458\u5bf9\u865a\u62df\u5316\u5e73\u53f0\u8fdb\u884c\u7ba1\u7406\u65f6\uff0c\u4ed6\u4eec\u5728\u865a\u62df\u684c\u9762\u4e2d\u66f4\u503e\u5411\u4e8e\u5206\u914d\u7b80\u5355\u7684NAT\u7f51\u7edc\u7f51\u6bb5\uff0c\u4ece\u800c\u51cf\u5c11\u62d3\u6251\u7684\u6574\u4f53\u590d\u6742\u6027\u3002 \u5bf9\u4e8e\u7eaf\u8f6f\u4ef6\u65b9\u5f0f\u7684\u591a\u5a92\u4f53\u5e7f\u64ad\u6559\u5b66\u73af\u5883\uff0c\u5f53\u6559\u5e08\u8fdb\u884c\u5e7f\u64ad\u65f6\uff0c\u6559\u5e08\u7aef\u7f16\u7801\u5f80\u5f80\u5728\u5177\u6709\u786c\u4ef6\u663e\u5361\u7684\u7269\u7406\u673a\u4e0a\u624d\u9ad8\u6548\uff0c\u6b64\u65f6\u6559\u5e08\u7aef\u673a\u5668\u9700\u8981\u4e0e\u5b66\u751f\u673a\u5728\u540c\u4e00\u7f51\u6bb5\uff0c\u90a3\u4e48NAT\u6216\u8005OVS\u7ec4\u7f51\u8981\u6c42\u5c31\u5bf9\u73b0\u6709\u73af\u5883\u63d0\u51fa\u4e86\u66f4\u9ad8\u8981\u6c42\uff08\u6bd4\u5982\u53cc\u7f51\u5361\u3001\u670d\u52a1\u5668\u4ea4\u6362\u673a\u989d\u5916VLAN\uff09\u3002\u4e00\u822c\u8fd9\u79cd\u73af\u5883\u4e0b\uff0c\u4f7f\u7528\u6865\u63a5\u7f51\u7edc\u66f4\u5408\u9002\u3002 \u4ee5\u4e0a\u5373\u662f\u7b14\u8005\u5bf9\u6559\u5b66\u673a\u623f\u865a\u62df\u684c\u9762\u5185\u7ec4\u7f51\u65b9\u5f0f\u5bf9\u5efa\u8bae\uff0c\u8bfb\u7740\u5e94\u6839\u636e\u5b9e\u9645\u73af\u5883\u505a\u51fa\u5224\u65ad\uff0c\u5728\u5de5\u4f5c\u91cf\u4e0e\u6027\u80fd\u3001\u529f\u80fd\u95f4\u4f5c\u51fa\u53d6\u820d\u3002","title":"2.2.1. \u6559\u5b66\u673a\u623f"},{"location":"inthecloud/frontline-network/#222","text":"\u9762\u5411\u529e\u516c\u7684\u684c\u9762\uff0c\u4e00\u822c\u9700\u6c42\u4e3aMircosoft Office\u3001\u90ae\u4ef6\u5904\u7406\u7b49\u6587\u5b57\u5bc6\u96c6\u578b\u8f6f\u4ef6\uff1b\u901a\u4fe1\u7c7b\u8f6f\u4ef6\u4e00\u822c\u4e3a\u56fd\u5185\u5382\u5546\u5f00\u53d1\u7684\u975e\u5e7f\u57df\u7f51\u901a\u4fe1\u8f6f\u4ef6\u4ee5\u53caQQ\uff1b\u9632\u75c5\u6bd2\u8f6f\u4ef6\u79cd\u7c7b\u6bd4\u8f83\u591a\uff0c\u76ee\u524d\u5361\u5df4\u65af\u57fa\u3001\u8bfa\u987f\u7b49\u5360 \u591a\uff0c360\u4f7f\u7528\u8f83\u5c11\uff1b\u5f71\u97f3\u7c7b\u8f6f\u4ef6\u4f7f\u7528\u5c40\u9650\u4e8e\u7f51\u9875flash\uff0c\u6216\u8005\u56fd\u5185\u5382\u5546\u5b9a\u5236\u7684\u6d41\u5a92\u4f53\u5ba2\u6237\u7aef\u3002\u5bf9\u4e8e\u8d22\u52a1\u684c\u9762\uff0c\u9700\u6c42\u9664\u666e\u901a\u529e\u516c\u684c\u9762\u5916\u4e5f\u6709\u4e00\u4e9b\u8d22\u52a1\u7c7b\u8f6f\u4ef6\uff0c\u800c\u8fd9\u4e9b\u8f6f\u4ef6\u5bf9\u684c\u9762\u8d1f\u8377\u8f83\u666e\u901a\u529e\u516c\u684c\u9762\u4f1a\u9ad8\u51fa\u4e00\u5b9a\u91cf\u7684\u8d44\u6e90\u6d88\u8017\uff0c\u540c\u65f6\u4e5f\u4f1a\u6709U-Key\u3001\u6307\u7eb9 \u4eea\u7b49\u7ec8\u7aef\u8bbe\u5907\uff0c\u6240\u4ee5\u5bf9\u4e8e\u8fd9\u7c7b\u684c\u9762\uff0c\u6211\u4eec\u4e00\u822c\u8fdb\u884c\u7279\u6b8a\u8bbe\u7f6e\uff0c\u6bd4\u5982\u5c06\u5176\u56fa\u5b9a\u5230\u67d0\u53f0\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\uff0c\u5e76\u8d4b\u4e88\u4e00\u5b9a\u4f18\u5148\u7ea7\uff0c\u4fdd\u8bc1\u8d44\u6e90\u4f18\u5148\u5206\u914d\u3002\u5728\u666e\u901a\u684c\u9762\u4e0e\u8d22\u52a1\u684c\u9762\u4ee5\u5916\uff0c\u4e5f\u6709\u6d6e\u52a8\u684c\u9762\u53ef\u4f9b\u51fa\u5dee\u4eba\u5458\u6216\u8005\u6765\u8bbf\u4eba\u5458\u4e34\u65f6\u4f7f\u7528\uff0c\u6b64\u79cd\u684c\u9762\u4e0e\u4e00\u822c\u529e\u516c\u684c\u9762\u65e0\u5f02\uff0c\u4f46\u53ef\u80fd\u8981\u6c42\u6709\u4e25\u683c\u7684\u7528\u6237\u68c0\u67e5\u63a7\u5236\u4ee5\u53ca\u65e0\u72b6\u6001\u6a21\u5f0f\u8981\u6c42\uff0c\u9632\u6b62\u6076\u610f\u4f7f\u7528\u5bfc\u81f4\u635f\u5931\u3002 \u4ee5\u4e0a\u5373\u662f\u529e\u516c\u684c\u9762\u7684\u5178\u578b\u573a\u666f\u4e86\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u7ec4\u7f51\u65b9\u5f0f\u4e5f\u57fa\u672c\u660e\u786e\u4e86\u3002\u4e00\u822c\u684c\u9762\u4f7f\u7528OVS\u6216\u8005NAT\u7686\uff0c\u4f18\u5148\u8003\u8651OVS\uff1b\u6d6e\u52a8\u684c\u9762\u5219\u4f7f\u7528NAT\uff1b\u5bf9\u4e8e\u8d22\u52a1\u8fd9\u7c7b\u6709\u7279\u6b8a\u9700\u6c42\u7684\u684c\u9762\u6211\u4eec\u4e5f\u53ef\u8003\u8651\u4f7f\u7528\u6865\u63a5\u7f51\u7edc\u3002\u53e6\u5916\u5f53\u529e\u516c\u5ba4\u4e2d\u6709\u7c7b\u4f3c\u6253\u5370\u673a\u3001\u626b\u63cf\u4eea\u3001\u6307\u7eb9\u4eea\u7b49\u5171\u4eab\u8bbe\u5907\u65f6\uff0c\u5b83\u4eec\u7684\u7ec4\u7f51\u4ee5\u6865\u63a5\u65b9\u5f0f\u4f18\u5148\uff0c\u8fd9\u6837\u4fbf\u4fdd\u8bc1\u4e86\u6240\u6709\u4eba\u5458\u90fd\u80fd\u5bf9\u5176\u8fdb\u884c\u8bbf\u95ee\u3002","title":"2.2.2. \u529e\u516c\u684c\u9762"},{"location":"inthecloud/frontline-network/#3","text":"\u5728\u5e73\u65f6\u7684\u5b9e\u65bd\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u7ec4\u7f51\u6309\u7167\u8d44\u6e90\u7a00\u7f3a\u6027\u4f9d\u6b21\u6392\u5217\u51fa\u6865\u63a5>OVS>NAT\uff1b\u540c\u65f6\u6309\u7167\u4e00\u822c\u76f8\u5bf9\u8bbf\u95ee\u8303\u56f4\u6392\u5e8f\u6865\u63a5>=OVS>NAT\u3002\u5bf9\u4e8e\u4f7f\u7528\u9891\u7387\u8f83\u9ad8\u7684\u79c1\u6709\u4e91\u800c\u8a00\uff0c\u6211\u4eec\u6839\u636e\u5ba2\u6237\u8fd0\u7ef4\u6c34\u5e73\u3001\u5b9e\u65bd\u6539\u9020\u96be\u5ea6\uff0c\u5e76\u7ed3\u5408\u73b0\u573a\u73af\u5883\u548c\u7279\u6b8a\u9700\u6c42\u8fdb\u884c\u7efc\u5408\u8003\u8651\uff0c\u65b9\u53ef\u5f97\u5230\u6bd4\u8f83\u6ee1\u610f\u7684\u7ec4\u7f51\u89c4\u5212\u3002","title":"3. \u603b\u7ed3"},{"location":"inthecloud/frontline-storage/","text":"\u865a\u62df\u5316\u4e2d\u5b58\u50a8\u914d\u7f6e\u5178\u578b\u573a\u666f\uff0d\u542f\u52a8\u98ce\u66b4 \u684c\u9762\u79c1\u6709\u4e91\u76f8\u8f83\u4e8e\u4e00\u822c\u516c\u6709\u4e91\uff0c\u6709\u7740\u865a\u62df\u673a\u542f\u52a8\u5bc6\u5ea6\u5927\u3001\u670d\u52a1\u5668\u8d44\u6e90\u5197\u4f59\u6027\u4f4e\u7b49\u7279\u70b9\uff0c\u672c\u6587\u5c1d\u8bd5\u6a21\u62df\u684c\u9762\u4e91\u4e2d\u7684\u5e38\u89c1\u573a\u666f\u6765\u8bf4\u660e\u542f\u52a8\u98ce\u66b4\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6cd5\uff0c\u5e76\u5728\u73b0\u6709\u65b9\u6cd5\u7684\u57fa\u7840\u4e0a\u63d0\u51fa\u4e00\u4e9b\u6539\u8fdb\u63aa\u65bd\uff0c\u5bf9\u516c\u6709\u4e91\u4e5f\u6709\u4e00\u5b9a\u53c2\u8003\u4ef7\u503c\u3002 1. \u5e38\u89c1\u865a\u62df\u5316\u5e73\u53f0\u7684\u914d\u7f6e\u4ecb\u7ecd \u78c1\u76d8\u5206\u914d\u65b9\u5f0f \u73b0\u6709\u6bd4\u8f83\u6210\u719f\u7684\u5f00\u6e90\u865a\u62df\u5316/\u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u5305\u62ecOpenStack\u3001CloudStack\u548coVirt\u7b49\uff0c\u90fd\u6709\u6bd4\u8f83\u6e05\u6670\u7684\u6a21\u677f\u548c\u5b9e\u4f8b\u6982\u5ff5\uff0c\u540c\u65f6\u4e5f\u6709\u6a21\u677f\u4e0e\u5b9e\u4f8b\u955c\u50cf\u5b58\u50a8\u4f4d\u7f6e\u76f8\u5173\u7684\u5b58\u50a8\u57df\u914d\u7f6e\uff0c\u4e3a\u4e86\u533a\u5206\u865a\u62df\u673a\u4e2d\u7684\u6a21\u677f\u4e0e\u5b9e\u4f8b\uff0c\u6211\u4eec\u4e0b\u6587\u90fd\u9ed8\u8ba4\uff1a\u6a21\u677f\u5373\u539f\u59cb\u865a\u62df\u673a\uff0c\u6240\u6709\u65b0\u5b9e\u4f8b\u7684\u521b\u5efa\u90fd\u4f9d\u8d56\u4e8e\u5b83\uff1b\u5b9e\u4f8b\u5373\u4f9d\u8d56\u6a21\u677f\u521b\u5efa\u7684\u865a\u62df\u673a\uff0c\u662f\u5177\u6709\u8fd0\u884c\u751f\u547d\u5468\u671f\u7684\u865a\u62df\u673a\u901a\u79f0\u3002 \u5728\u865a\u62df\u5316\u5e73\u53f0\u4e2d\uff0c\u4e00\u822c\u6709\u4e24\u79cd\u65b0\u5efa\u5b9e\u4f8b\u7684\u65b9\u5f0f\uff1a\u514b\u9686\u4e0e\u589e\u91cf\u3002 \u514b\u9686\u5373\u5b8c\u6574\u514b\u9686\u6a21\u677f\u914d\u7f6e\u4e0e\u78c1\u76d8\uff0c\u78c1\u76d8\u7684\u521b\u5efa\u65b9\u5f0f\u4e00\u822c\u4e3acp\u6216\u8005qemu-img convert\u3002\u5982\u6b64\u521b\u5efa\u7684\u5b9e\u4f8b\uff0c\u5176\u78c1\u76d8\u4e0e\u6a21\u677f\u78c1\u76d8\u76f8\u5bf9\u72ec\u7acb\uff0c\u5728\u670d\u52a1\u5668\u5b58\u50a8\u4e0a\u62e5\u6709\u5404\u81ea\u7684\u6247\u533a\u4f4d\u7f6e\uff0c\u6240\u4ee5\u5728\u8bfb\u5199\u64cd\u4f5c\u65f6\u53d7\u673a\u68b0\u76d8\u78c1\u5934\u5f15\u8d77\u7684\u5c0f\u533a\u57df\u5e76\u53d1\u95ee\u9898\u5f71\u54cd\u8f83\u5c0f\uff0c\u7f3a\u70b9\u662f\u521b\u5efa\u65f6\u9700\u8981\u6d88\u8017\u4e00\u5b9a\u65f6\u95f4\uff0c\u4e0d\u80fd\u6ee1\u8db3\u79d2\u7ea7\u521b\u5efa\u7684\u9700\u6c42\u3002 \u589e\u91cf\u5373\u65b0\u5efa\u865a\u62df\u673a\u53ea\u590d\u5236\u6a21\u677f\u914d\u7f6e\u4fe1\u606f\uff0c\u4f46\u5176\u78c1\u76d8\u6587\u4ef6\u901a\u8fc7qemu-img\u7684backing file\u65b9\u6cd5\u521b\u5efa\uff0c\u57fa\u4e8ebacking file\u521b\u5efa\u7684\u78c1\u76d8\u4e0d\u80fd\u662fraw\u683c\u5f0f\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a 1 qemu-img create -b hda.qcow2 -f qcow2 hda-new.qcow2 \u5982\u6b64\u521b\u5efa\u7684\u78c1\u76d8\u5bf9\u6a21\u677f\u78c1\u76d8\u7684\u4f9d\u8d56\u8f83\u5927\uff0c\u975e\u589e\u91cf\u6587\u4ef6\u7684\u8bfb\u64cd\u4f5c\uff08\u6bd4\u5982\u542f\u52a8\u7cfb\u7edf\uff09\u7edd\u5927\u90e8\u5206\u5728\u6a21\u677f\u78c1\u76d8\u4e0a\u8fdb\u884c\uff0c\u6240\u4ee5\u5728\u4f20\u7edf\u673a\u68b0\u76d8\u4e0a\u591a\u4e2a\u5b9e\u4f8b\u7684\u5e76\u53d1\u542f\u52a8\u98ce\u66b4\u66f4\u5bb9\u6613\u5728\u6b64\u79cd\u683c\u5f0f\u7684\u78c1\u76d8\u4e0a\u53d1\u751f\u3002 \u96c6\u7fa4\u8c03\u5ea6\u7b56\u7565 \u5b9e\u4f8b\u7684\u542f\u52a8\u5728\u865a\u62df\u5316\u5e73\u53f0\u4e2d\u7684\u4e00\u822c\u8c03\u5ea6\u5982\u4e0b\uff1a :::{figure} ../images/schedule.png :align: center \u56fe1-1 ::: \u4ece\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u5728\u771f\u6b63\u542f\u52a8\u4e4b\u524d\u4f1a\u6839\u636e\u4e00\u5b9a\u7b56\u7565\u88ab\u5b89\u6392\u5230\u67d0\u96c6\u7fa4\u7684\u67d0\u4e00\u4e3b\u673a\u4e0a\uff0c\u800c\u4e14\u6839\u636e\u96c6\u7fa4\u72b6\u6001\u53ef\u4ee5\u52a8\u6001\u8fc1\u79fb\u81f3\u5176\u4ed6\u4e3b\u673a\uff0c\u5728\u672c\u6587\u4e2d\u6211\u4eec\u4e0d\u5c55\u5f00\u8fc1\u79fb\u7684\u60c5\u51b5\u3002 \u6211\u4eec\u5728\u5b9e\u73b0\u8c03\u5ea6\u7b56\u7565\u7684\u65f6\u5019\u4e3b\u8981\u8003\u91cf\u4ee5\u4e0b\u51e0\u70b9\uff1a \u96c6\u7fa4\u7684CPU\u7c7b\u578b\uff08Family\uff09\u3001\u96c6\u7fa4\u8d1f\u8f7d\u72b6\u6001\uff1b \u4e3b\u673a\u8fd0\u884c\u865a\u62df\u673a\u6570\u91cf\u3001\u4e3b\u673a\u5386\u53f2\u5065\u5eb7\u5ea6\uff1b \u4e3b\u673aCPU\u7528\u5ea6\u3001\u7f51\u7edc\u7528\u5ea6\u3001\u5185\u5b58\u7528\u5ea6\u3001\u5b58\u50a8I/O\u7528\u5ea6\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\u7684\u65f6\u95f4\uff1b 1.1. \u6a21\u677f\u4e0e\u5b9e\u4f8b\u540c\u4e00\u5b58\u50a8 \u5f53\u6a21\u677f\u4e0e\u5b9e\u4f8b\u5b58\u50a8\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e2d\u65f6\uff0c\u6211\u4eec\u521b\u5efa\u865a\u62df\u673a\u7684\u5e38\u7528\u65b9\u6cd5\u6709\u4e24\u79cd\u2014\u2014\u2014\u2014\u4f7f\u7528\u6a21\u677f\u7684\u78c1\u76d8\u7684hardlink\u4f5c\u4e3a\u5b9e\u4f8b\u78c1\u76d8\u7684backing file\u6765\u521b\u5efa\u589e\u91cf\u78c1\u76d8\uff0c\u6216\u8005\u76f4\u63a5\u514b\u9686\u6a21\u677f\u78c1\u76d8\u3002 \u4e8eoVirt\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u4e3b\u5b58\u50a8\u57df\u7684\u76ee\u5f55\u7ed3\u6784\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # tree data/ data/4440c3f9-ba1f-4803-86ac-d59c694c61c1/ \u251c\u2500\u2500 dom_md \u2502 \u251c\u2500\u2500 ids \u2502 \u251c\u2500\u2500 inbox \u2502 \u251c\u2500\u2500 leases \u2502 \u251c\u2500\u2500 metadata \u2502 \u2514\u2500\u2500 outbox \u251c\u2500\u2500 images \u2502 \u251c\u2500\u2500 d25c4d22-15c1-4f3c-8aef-2ed74deb4723 \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63 \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63.lease \u2502 \u2502 \u2514\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63.meta \u2502 \u251c\u2500\u2500 d6d7e74d-76fc-48c6-b3c6-3c506b98e73e \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63 \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63.lease \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63.meta \u2502 \u2502 \u251c\u2500\u2500 81031024-5942-4086-901b-f991777ff32a \u2502 \u2502 \u251c\u2500\u2500 81031024-5942-4086-901b-f991777ff32a.lease \u2502 \u2502 \u2514\u2500\u2500 81031024-5942-4086-901b-f991777ff32a.meta \u2502 \u2514\u2500\u2500 ed834c83-82c3-4ea3-a08d-82cfbb213af4 \u2502 \u251c\u2500\u2500 3e56f6dd-be45-48d0-aba8-830d0ee1f068 \u2502 \u251c\u2500\u2500 3e56f6dd-be45-48d0-aba8-830d0ee1f068.lease \u2502 \u2514\u2500\u2500 3e56f6dd-be45-48d0-aba8-830d0ee1f068.meta \u2514\u2500\u2500 master \u251c\u2500\u2500 tasks \u2514\u2500\u2500 vms \u5176\u4e2d\uff0c2bf1ba4c-3fb5-4e25-9368-cc96724b1a63\u4e3a\u6a21\u677f\u78c1\u76d8\uff0cd6d7e74d-76fc-48c6-b3c6-3c506b98e73e\u5373\u4e3a\u4ece\u6a21\u677f\u521b\u5efa\u7684\u589e\u91cf\u5b9e\u4f8b\u78c1\u76d8\u3002 \u4e0a\u56fe\u4e2d\u7684\u6a21\u677f\u78c1\u76d8\u548c\u5b9e\u4f8b\u78c1\u76d8\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\uff0coVirt\u4f7f\u7528\u4f7f\u7528\u4e86hardlink\u94fe\u63a5\u4e86\u6a21\u677fd25c4d22-15c1-4f3c-8aef-2ed74deb4723\u4e0b\u7684\u78c1\u76d82bf1ba4c-3fb5-4e25-9368-cc96724b1a63\u548c\u5b9e\u4f8b6d7e74d-76fc-48c6-b3c6-3c506b98e73e\u4e0b\u76842bf1ba4c-3fb5-4e25-9368-cc96724b1a63\u3002 :::{note} \u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\u4f7f\u7528hardlink\u7684\u800c\u975esoftlink\u7684\u539f\u56e0 \u8282\u7701inode\u4f7f\u7528\u91cf \u7531\u4e8e\u7701\u53bb\u4e86\u8bbf\u95eesoftlink\u7684inode\u8fd9\u4e00\u6b65\uff0c\u76f4\u63a5\u8bbf\u95ee\u539f\u6587\u4ef6\u7684inode\u4f1a\u5e26\u6765\u6027\u80fd\u4e0a\u7684\u7a0d\u8bb8\u63d0\u5347 \u6539\u53d8\u6e90\u6587\u4ef6\u8def\u5f84\u4e0d\u4f1a\u5f71\u54cdhardlink\u6587\u4ef6\u7684\u8bbf\u95ee \u5197\u4f59\u6027\u53ca\u5b89\u5168\u6027\u8003\u8651\uff0c\u53ea\u6709\u5220\u9664\u4e86inode\u4e0a\u7684\u6240\u6709\u5f15\u7528\uff0c\u6b64inode\u624d\u4f1a\u88ab\u5220\u9664\u3002 ::: :::{note} ids - used by sanlock - each host maintain a lockspace on each domain, allowing it to acquire resources on the leases volume. leases - used for acquiring resources. For example, the spm node acquire a resource on this volume inbox - every host can write message to the spm node using this volume outbox - the spm write messages to other hosts on this volume master - this volume is mounted on the spm node for storing stuff related to the master storage domain metadata - used to store storage domain metadata ::: 1.2. \u6a21\u677f\u4e0e\u5b9e\u4f8b\u5206\u79bb\u5b58\u50a8 \u5f53\u6a21\u677f\u78c1\u76d8\u4e0e\u5b9e\u4f8b\u78c1\u76d8\u5206\u522b\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u65f6\uff0c\u5df2\u7ecf\u4e0d\u80fd\u4f7f\u7528hardlink\u521b\u5efa\u3002oVirt\u8de8\u5b58\u50a8\u57df\u521b\u5efa\u5b9e\u4f8b\u7684\u65b9\u5f0f\u4e3a\u514b\u9686\u521b\u5efa\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528backing file\u521b\u5efa\u589e\u91cf\u78c1\u76d8\u3002\u6211\u4eec\u4ece\u5176\u5b58\u50a8\u57df\u6982\u5ff5\u53ef\u4ee5\u63a8\u6d4b\u51fa\u5b83\u8fd9\u4e48\u505a\u7684\u539f\u56e0\uff0c\u5373\uff1a \u5b58\u50a8\u57df\u95f4\u6ca1\u6709\u6a21\u677f\u4e0e\u5b9e\u4f8b\u7684\u5173\u8054\uff0c\u6613\u4e8e\u5b58\u50a8\u57df\u7ba1\u7406\uff08\u5220\u9664\u3001\u5bfc\u5165\u5b58\u50a8\u57df\u4e0e\u5176\u4e2d\u7684\u865a\u62df\u673a\uff09\uff1b \u5bf9\u4e8e\u8de8\u6587\u4ef6\u7cfb\u7edf\u7684\u5b58\u50a8\u57df\uff0c\u4f7f\u7528\u62f7\u8d1d\u800c\u4e0d\u662f\u589e\u91cf\u521b\u5efa\u66f4\u6613\u4e8e\u51cf\u5c11\u6a21\u677f\u6240\u5728\u5b58\u50a8\u57df\u8d1f\u62c5\u3002 \u800c\u6709\u65f6\u6211\u4eec\u771f\u5b9e\u90e8\u7f72\u865a\u62df\u684c\u9762\u7684\u573a\u666f\u4e2d\uff0c\u5f80\u5f80\u9700\u8981\u591a\u4e2a\u672c\u5730\u5b58\u50a8\u57df\uff08\u6bd4\u5982SAS\u76d8\u4e0eSSD\u76d8\uff09\u6df7\u5408\u4f7f\u7528\u3002\u6240\u4ee5\u5728\u4ee5\u4e0b\u7684\u6d4b\u8bd5\u4e2d\uff0c\u6211\u4e5f\u4f1a\u4f7f\u7528\u8de8\u5b58\u50a8\u57df\u521b\u5efa\u589e\u91cf\u78c1\u76d8\u7684\u65b9\u5f0f\u3002 1.3. \u65e0\u72b6\u6001\u5b9e\u4f8b\u7684\u78c1\u76d8\u4e0e\u5feb\u7167\u5206\u79bb\u5b58\u50a8 oVirt\u4e2d\u5b58\u5728\u4e00\u79cd\u201c\u65e0\u72b6\u6001\u201d\u5b9e\u4f8b\uff0c\u6b64\u79cd\u5b9e\u4f8b\u7684\u521b\u5efa\u8fc7\u7a0b\u5982\u4e0b\uff1a \u5df2\u6709\u6a21\u677f\u78c1\u76d8A\uff0c\u6211\u4eec\u6839\u636e\u91c7\u7528\u514b\u9686\u6216\u8005\u589e\u91cf\u65b9\u5f0f\u521b\u5efa\u5b9e\u4f8b\u78c1\u76d8B\uff0c\u52fe\u9009\u201c\u65e0\u72b6\u6001\u201d\u4ee5\u540e\uff0c\u865a\u62df\u673a\u8fd0\u884c\u4f1a\u81ea\u52a8\u521b\u5efa\u78c1\u76d8B\u7684\u589e\u91cf\u78c1\u76d8C\uff0c\u5b9e\u4f8b\u6240\u6709\u7684\u6539\u52a8\u90fd\u5728C\u4e0a\uff0c\u5f53\u865a\u62df\u673a\u5173\u673a\u540e\uff0c\u5e73\u53f0\u5220\u9664C\u3002\u8fd9\u6837\u4ee5\u6765\uff0c\u6240\u6709\u7684\u6539\u52a8\u4fbf\u968f\u4e4b\u5220\u9664\uff0c\u6211\u4eec\u5c31\u79f0\u8fd9\u79cd\u5de5\u4f5c\u65b9\u5f0f\u7684\u5b9e\u4f8b\u4e3a\u201c\u65e0\u72b6\u6001\u201d\u5b9e\u4f8b\u3002 \u8fd9\u79cd\u72b6\u6001\u4e0b\u865a\u62df\u673a\uff0c\u5b58\u57281-2\u4e2a\u589e\u91cf\u78c1\u76d8\uff0c\u5728\u4ee5\u4e0b\u7684\u5b9e\u9a8c\u4e2d\uff0c\u6211\u4f1a\u5c06\u5176\u5206\u522b\u653e\u7f6e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6d4b\u8bd5\u3002 2. \u542f\u52a8\u98ce\u66b4\u76f8\u5173\u7cfb\u5217\u8bd5\u9a8c \u6b64\u6b21\u5b9e\u9a8c\u7684\u76ee\u7684\u4e3a\u8003\u5bdf\u591a\u53f0\u865a\u62df\u673a\u540c\u65f6\u542f\u52a8\u5bf9\u78c1\u76d8I/O\u7684\u8d1f\u8f7d\uff0c\u4e0d\u8003\u8651qcow2\u683c\u5f0f\u4e0eraw\u683c\u5f0f\u7684\u5f71\u54cd\uff0c\u7edf\u4e00\u9002\u7528qcow2\u683c\u5f0f\u3002\u6240\u6709\u7684\u865a\u62df\u673a\u5747\u4f7f\u7528VirtIO\u63a5\u53e3\uff0cqcow2\u78c1\u76d8\uff0cbacking_file\u683c\u5f0f\u4e5f\u4e3aqcow2\uff0cWindows XP 32\u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u65e0\u4efb\u4f55\u9644\u52a0\u8f6f\u4ef6\u3002\u4e3a\u51cf\u5c11XP\u7cfb\u7edf\u542f\u52a8\u540e\u5bf9\u5feb\u7167\u78c1\u76d8\u7684\u989d\u5916\u64cd\u4f5c\uff0c\u6211\u4eec\u6240\u6709\u7684XP\u5b9e\u4f8b\u90fd\u8fd0\u884c\u4e86\u4e00\u4e2a\u5c0f\u65f6\u540e\u518d\u5173\u673a\u8fdb\u884c\u6d4b\u8bd5\u3002 \u670d\u52a1\u5668\u914d\u7f6e\u4e3a\u53cc\u8defX5670 @ 2.93GHz\uff0c64GB\u5185\u5b58\uff0c\u4e00\u5757Intel 480G\u4f01\u4e1a\u7ea7SSD\uff0c\u4e00\u5757WD 1T\u4f01\u4e1a\u7ea7\u673a\u68b0\u786c\u76d8\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e3aCentOS 7.1\u3002 \u6a21\u677f\u914d\u7f6e\uff1a file: base_xp.sh 1 2 3 4 5 6 7 8 9 #!/bin/bash /usr/libexec/qemu-kvm -no-user-config -nodefaults \\ -m 1024M -cpu host -smp 1,sockets=1,cores=1 \\ -net user \\ -monitor stdio -vga qxl -global qxl-vga.vram_size=67108864 \\ -spice port=7001,ipv4,disable-ticketing \\ -drive file=hda.qcow2,if=none,id=drive-virtio-disk0,format=qcow2,cache=none,werror=stop,rerror=stop,aio=threads \\ -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \\ -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 \u5b9e\u9a8c\u811a\u672c\uff1a \u521b\u5efa20\u4e2a\u4ee5hda.qcow2\u4e3abacking file\u7684\u78c1\u76d8\uff0c\u7528\u4e8e\u5b9e\u4f8b\u3002 file: create-imgs.sh 1 2 3 4 5 #!/bin/bash for i in `seq 11 30` do qemu-img create -f qcow2 -b hda.qcow2 hda-$i.qcow2 done \u4e00\u6b21\u6027\u542f\u52a820\u53f0\u5b9e\u4f8b\u3002 file: start-vms.sh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #!/bin/bash function startvm { /usr/libexec/qemu-kvm -no-user-config -nodefaults \\ -m 1024M -cpu host -smp 1,sockets=1,cores=1 \\ -net user \\ -vga qxl -global qxl-vga.vram_size=67108864 \\ -spice port=$1,ipv4,disable-ticketing \\ -drive file=$2,if=none,id=drive-virtio-disk0,format=qcow2,cache=none,werror=stop,rerror=stop,aio=threads \\ -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \\ -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 } for i in `seq 11 30` do startvm 70$i hda-$i.qcow2 done \u6d4b\u91cf\uff0c\u91c7\u6837\u9891\u7387\u4e3a 1 Hz\uff1a 1 iostat -cdmx 1|tee 20-xp.iostat-cdm.out \u6570\u636e\u9884\u5904\u7406\uff0c\u6211\u4eec\u53ea\u9700\u8981\u603b\u8bfb\u5199\u901f\u5ea6\uff08MB/s\uff09\u3001\u603b\u8bfb\u5199\u8bf7\u6c42\uff08Requests/s\uff09\u3001CPU\u5229\u7528\uff08%user,%sys\uff09\u3002 1 2 3 awk 'BEGIN {print \"cpu usage\\n\";i=0};$1 ~ /[0-9]/ {print i,$1+$3;i+=1;}' 20-xp.iostat-cdm.out > 20-xp.iostat-cdm-cpu.out awk 'BEGIN {print \"sdb info\\nTime IOPS RMBps WMBps\";i=0};$1 ~ /^sda/ {iops=$4+$5;print i,iops,$6,$7;i+=1;}' 20-xp.iostat-cdm.out > 20-xp.iostat-cdm-sdb.out awk 'BEGIN {print \"sdb info\\nTime IOPS RMBps WMBps\";i=0};$1 ~ /^sdb/ {iops=$4+$5;print i,iops,$6,$7;i+=1;}' 20-xp.iostat-cdm.out > 20-xp.iostat-cdm-sdb.out \u53ef\u89c6\u5316\u793a\u4f8b\uff0c\u7531\u4e8e\u8bf7\u6c42\u6570\u6bd4\u901f\u5ea6\u9ad8\u5f88\u591a\u500d\uff0c\u4e3a\u65b9\u4fbf\u6570\u636e\u663e\u793a\u6211\u4eec\u5c06\u8bf7\u6c42\u6570\u9664\u4ee510\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 #!/usr/bin/env python import numpy as np import matplotlib.pyplot as plt f_c = file('20-xp.iostat-cdm-sda.out').readlines() c = np.array(map(str.split,f_c[2:]),dtype='float') plt.plot(c[:,0],c[:,1]/10,label=\"IO Requests/s\", color=\"red\", linewidth=2) plt.plot(c[:,0],c[:,2],label=\"Read MB/s\", color=\"blue\", linewidth=2) plt.plot(c[:,0],c[:,3],label=\"Write MB/s\", color=\"blue\", linewidth=2) plt.legend() plt.show() 2.1. WD 15K \u542f\u52a8xp\u5b9e\u9a8c \u6240\u6709\u5b9e\u4f8b\u4e8eWD 1T\u786c\u76d8\u4e0a\u542f\u52a8\u7684\u7ed3\u679c\u5982\u4e0b\uff1a \u542f\u52a8\u5355\u53f0XP\u7684CPU\u53caI/O\u7528\u5ea6\uff0c\u7cfb\u7edf\u5728\u7b2c8\u79d2\u5de6\u53f3\u8fdb\u5165\u684c\u9762\uff1a :::{figure} ../images/1-xp-sata-cpu.png :align: center \u56fe2-1 ::: :::{figure} ../images/1-xp-sata-io.png :align: center \u56fe2-2 ::: \u542f\u52a820\u53f0XP\u7684CPU\u53caI/O\u7528\u5ea6\uff0c\u5168\u90e8\u7cfb\u7edf\u5728\u7b2c300\u79d2\u5de6\u53f3\u8fdb\u5165\u684c\u9762\uff1a :::{figure} ../images/20-xp-sata-cpu.png :align: center \u56fe2-3 ::: :::{figure} ../images/20-xp-sata-io.png :align: center \u56fe2-4 ::: 2.2. Intel 120G SSD\u542f\u52a8xp\u5b9e\u9a8c \u6240\u6709\u5b9e\u4f8b\u4e8eIntel 480G SSD\u786c\u76d8\u4e0a\u542f\u52a8\u7684\u7ed3\u679c\u5982\u4e0b\uff1a \u542f\u52a8\u5355\u53f0XP\u7684CPU\u53caI/O\u7528\u5ea6\uff0c\u7cfb\u7edf\u5728\u7b2c6\u79d2\u5de6\u53f3\u8fdb\u5165\u684c\u9762\uff1a :::{figure} ../images/1-xp-ssd-cpu.png :align: center \u56fe2-5 ::: :::{figure} ../images/1-xp-ssd-io.png :align: center \u56fe2-6 ::: \u542f\u52a820\u53f0XP\u7684CPU\u53caI/O\u7528\u5ea6\uff0c\u5168\u90e8\u7cfb\u7edf\u5728\u7b2c35\u79d2\u5de6\u53f3\u8fdb\u5165\u684c\u9762\uff1a :::{figure} ../images/20-xp-ssd-cpu.png :align: center \u56fe2-7 ::: :::{figure} ../images/20-xp-ssd-io.png :align: center \u56fe2-8 ::: 2.3. \u5c0f\u7ed3 \u4ece\u4e0a\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u603b\u7ed3\u51faXP\u81ea\u542f\u52a8\u65f6\u4f1a\u6709\u5927\u91cf\u7684\u8bfb\u8bf7\u6c42\u4ee5\u53ca\u5927\u91cf\u6570\u636e\u8bfb\u51fa\uff0c\u5199\u8bf7\u6c42\u76f8\u5bf9\u5c11\u5f88\u591a\uff0c\u540c\u65f6CPU\u7528\u5ea6\u968f\u7740I/O\u8bf7\u6c42\u91cf\u4e0a\u5347\uff1b\u800c\u5728\u8fdb\u5165\u684c\u9762\u65f6\u523b\u5de6\u53f3\u4f1a\u6709\u5c11\u91cf\u8bfb\u8bf7\u6c42\u548c\u5c11\u91cf\u6570\u636e\u8bfb\u51fa\uff0c\u6709\u8f83\u591a\u7684\u5199I/O\u8bf7\u6c42\u548c\u5c11\u91cf\u6570\u636e\u5199\u5165\uff0c\u540c\u65f6CPU\u7528\u5ea6\u76f8\u5bf9\u524d\u4e00\u9636\u6bb5\u8f83\u4e3a\u5e73\u7f13\u3002 \u4e00\u822c\u6211\u4eec\u79f0\u542f\u52a8\u65f6\u7684\u524d\u6bb5\u65f6\u95f4\u9020\u6210\u7684I/O\u98ce\u66b4\u4e3a\u201c\u542f\u52a8\u98ce\u66b4\u201d\uff0c\u8fdb\u5165\u684c\u9762\u65f6\u7684\u79f0\u4e4b\u4e3a\u201c\u767b\u5f55\u98ce\u66b4\u201d\u3002 3. \u79c1\u6709\u4e91\u4e2d\u5904\u7406\u542f\u52a8\u98ce\u66b4\u7684\u5e38\u7528\u65b9\u6cd5 \u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e0b\u6211\u4eec\u5728\u79c1\u6709\u4e91\u4e2d\u5904\u7406\u542f\u52a8\u98ce\u66b4\u7684\u65b9\u6cd5\uff0c\u5176\u4e2d\u4e00\u4e9b\u53ef\u80fd\u5e76\u4e0d\u9002\u7528\u4e8e\u6240\u6709\u573a\u666f\uff0c\u4f46\u76f8\u4fe1\u4ecd\u6709\u4e9b\u53c2\u8003\u53ca\u6298\u817e\u4ef7\u503c\u3002 3.1. \u542f\u52a8\u6392\u961f \u542f\u52a8\u6392\u961f\u662f\u4e00\u79cd\u6539\u5584\u542f\u52a8\u98ce\u66b4\u6bd4\u8f83\u5e38\u89c1\u7684\u505a\u6cd5\uff0c\u5b83\u5728\u865a\u62df\u5316\u5e73\u53f0\u5206\u914d\u5b9e\u4f8b\u5230\u67d0\u53f0\u670d\u52a1\u5668\u540e\u6267\u884c\uff0c\u5373\u6211\u4eec\u4e0d\u8003\u8651\u5b9e\u4f8b\u5728\u591a\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u8c03\u5ea6\uff0c\u5176\u57fa\u672c\u539f\u7406\u5982\u4e0b\u3002 ```{image} ../images/storage-01.png :align: center ``` \u5b9e\u4f8b\u5728\u542f\u52a8\u65f6\u90fd\u4f1a\u88ab\u52a0\u8fdb\u56fa\u5b9a\u957f\u5ea6\u4e3am+n\u7684\u961f\u5217\u672b\u7aef\uff0c\u5176\u4e2dm\u4e3a\u5b9e\u4f8b\u8fd0\u884c\u65f6\u78c1\u76d8\u6240\u5728\u5b58\u50a8\u7684\u6700\u4f18\u5b9e\u4f8b\u542f\u52a8\u5e76\u53d1\u6570\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u542f\u52a8\u961f\u5217\u3002n\u4e3a\u7b49\u5f85\u542f\u52a8\u7684\u5b9e\u4f8b\u6570\u76ee\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u4e3a\u5f85\u542f\u52a8\u961f\u5217\u3002\u6211\u4eec\u5c06\u5b9e\u4f8b\u81ea\u542f\u52a8\u5230\u5176iops\u964d\u81f3\u5176\u7a7a\u8f7d\u8fd0\u884c\u6c34\u5e73\u89c6\u4e3a\u5b8c\u5168\u542f\u52a8\uff0c\u6b64\u6bb5\u65f6\u95f4\u4e3at\u3002\u5f53\u961f\u5217m\u4e2d\u6709\u5b9e\u4f8b\u5b8c\u5168\u542f\u52a8\u540e\uff0c\u5c06\u5176\u4ece\u961f\u5217\u4e2d\u79fb\u9664\uff0c\u961f\u5217n\u4e2d\u7684\u9996\u7aef\u7684\u5b9e\u4f8b\u52a0\u5165\u81f3m\u961f\u5217\u5c3e\u7aef\u5e76\u5f00\u59cb\u542f\u52a8\u3002 \u4f7f\u7528\u542f\u52a8\u6392\u961f\u65f6\uff0c\u6709\u4ee5\u4e0b\u51e0\u70b9\u8bbe\u8ba1\u539f\u5219\u9700\u8981\u6ce8\u610f\uff1a t\u548cm\u7684\u503c\u53ef\u4ee5\u6839\u636e\u5b9e\u4f8b\u8fd0\u884c\u7684\u6240\u5904\u73af\u5883\u81ea\u52a8\u52a8\u6001\u8c03\u6574\uff08\u540e\u53f0\u81ea\u52a8\u6d4b\u91cf\u670d\u52a1\u5668\u3001\u5b58\u50a8\u670d\u52a1\u6c34\u5e73\uff09\uff0c\u7ba1\u7406\u5458\u4e5f\u53ef\u624b\u52a8\u8c03\u6574\u3002 \u5b9e\u4f8b\u4f1a\u6839\u636e\u5176\u4f18\u5148\u7ea7\u63d2\u961f\u81f3n\u7684\u9996\u7aef\uff0c\u4f46\u4e0d\u53ef\u63d2\u961f\u81f3m\u961f\u5217\u4e2d\u3002 \u5f53\u961f\u5217n\u6ee1\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u62d2\u7edd\u542f\u52a8\u6216\u8005\u7b49\u5f85\u8d44\u6e90\u4ee5\u542f\u52a8\u5b9e\u4f8b\uff1b\u67d0\u4e9b\u8bbe\u8ba1\u4e2d\u4e5f\u53ef\u5c06m\u4e0en\u5408\u5e76\u4e3a\u4e00\u4e2a\u542f\u52a8\u961f\u5217\u3002 \u6b64\u79cd\u65b9\u5f0f\u80fd\u591f\u6bd4\u8f83\u9ad8\u6548\u5730\u5229\u7528\u670d\u52a1\u5668\u548c\u5b58\u50a8\u8d44\u6e90\uff0c\u800c\u4e14\u5bf9\u5df2\u542f\u52a8\u5b9e\u4f8b\u7684\u9644\u5e26\u5f71\u54cd\u53c8\u8f83\u5c11\u3002 3.2. \u5b58\u50a8\u5206\u5c42\u9009\u62e9 \u542f\u52a8\u6392\u961f\u7684\u65b9\u5f0f\u662f\u4ece\u7b56\u7565\u4e0a\u89e3\u51b3\u95ee\u9898\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4ece\u5b9e\u4f8b\u78c1\u76d8\u5b58\u50a8\u4f4d\u7f6e\u7684\u9009\u62e9\u4e0a\u8fdb\u4e00\u6b65\u964d\u4f4e\u542f\u52a8\u98ce\u66b4\u5e26\u6765\u7684\u5f71\u54cd\u3002 \u6a21\u677f\u78c1\u76d8\u3001\u5b9e\u4f8b\u78c1\u76d8\u3001\u589e\u91cf\u78c1\u76d8\u4ee5\u53ca\u201c\u65e0\u72b6\u6001\u78c1\u76d8\u201d\u7684\u6240\u5728\u5b58\u50a8\u4f4d\u7f6e\u7684\u6027\u80fd\u80fd\u591f\u76f4\u63a5\u5f71\u54cd\u5b9e\u4f8b\u7684\u542f\u52a8\u8fc7\u7a0b\u3002 3.2.1. \u7edf\u4e00\u9ad8\u901f\u5b58\u50a8\u6539\u5584\u6574\u4f53I/O\u5206\u5e03 \u4ece\u7b2c\u4e8c\u8282\u7684\u5b9e\u9a8c\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u5355\u53f0XP\u5b9e\u4f8b\u542f\u52a8\u7684\u524d10\u79d2\u662fIOPS\u6d88\u8017\u6700\u5927\u7684\u65f6\u671f\u3002\u5728\u542f\u52a8\u98ce\u66b4\u6765\u4e34\u4e4b\u524d\uff0c\u6211\u4eec\u53ea\u8981\u51c6\u5907\u597dIOPS\u5145\u8db3\u4e14\u9002\u5f53\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u518d\u9002\u91cf\u8c03\u6574\u6211\u4eec\u7684I/O\u8c03\u5ea6\u7b97\u6cd5\u5373\u53ef\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u7f13\u51b2\u7b2c\u4e00\u6ce2\u98ce\u66b4\uff0c\u800c\u540e\u7684\u767b\u5f55\u98ce\u66b4\u4fbf\u4e5f\u4fbf\u4e0d\u662f\u95ee\u9898\u4e86\u3002 \u5047\u8bbe\u6211\u4eec\u73b0\u5728\u6709IOPS\u5145\u8db3\u4e14\u9002\u5f53\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u6211\u4eec\u5c06\u6a21\u677f\u3001\u5b9e\u4f8b\u3001\u5feb\u7167\u78c1\u76d8\u5168\u90e8\u653e\u7f6e\u5230\u8fd9\u53f0\u8bbe\u5907\u4e0a\uff0c\u4ece\u800c\u6bd4\u8f83\u201c\u4e0d\u8d1f\u8d23\u4efb\u201d\u5730\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\u3002 \u4e3a\u4ec0\u4e48\u8bf4\u201c\u4e0d\u8d1f\u8d23\u4efb\u201d\u5462\uff1f \u56e0\u4e3a\u867d\u7136\u4e00\u80a1\u8111\u7684\u5168\u90e8\u4e0aSSD\u4f1a\u6539\u5584I/O\u60c5\u51b5\u800c\u51cf\u7f13\u542f\u52a8\u98ce\u66b4\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u4f46\u6210\u672c\u4e0a\u5bf9\u6bd4\u6839\u636e\u5b9e\u4f8b\u5b9e\u9645\u8bfb\u5199I/O\u5206\u914d\u5408\u7406\u89c4\u5212\u5b58\u50a8\u7684\u65b9\u6848\uff0c\u5c31\u663e\u5f97\u4e9b\u8bb8\u6d6a\u8d39\u4e86\u3002 \u5f53\u7136\uff0c\u4e0d\u8bba\u662f\u540e\u7aef\u5b58\u50a8\u8fd8\u662f\u524d\u7aef\u670d\u52a1\u5668OS\uff0c\u4f7f\u7528\u54cd\u5e94\u65f6\u95f4\u77ed\u3001\u8bfb\u5199\u5e26\u5bbd\u5927\u7684\u78c1\u76d8\u603b\u662f\u6709\u76ca\u7684\u3002\u73b0\u5728\u5236\u9020SSD\u7684\u6280\u672f\u4e0d\u65ad\u63d0\u9ad8\uff0c\u6210\u672c\u3001\u5bff\u547d\u3001\u901f\u5ea6\u3001\u5bb9\u91cf\u7b49\u4e0e\u673a\u68b0\u786c\u76d8\u76f8\u6bd4\u4f18\u52bf\u4e5f\u8d8a\u6765\u8d8a\u7a81\u51fa\uff0c\u56e0\u6b64\u6211\u76f8\u4fe1\u5728\u865a\u62df\u5316\u684c\u9762\u9886\u57df\u4e2dSSD\u4f1a\u4ee3\u66ff\u673a\u68b0\u786c\u76d8\u4f1a\u6210\u4e3a\u4e3b\u6d41\u3002 3.2.2. \u589e\u91cf\u78c1\u76d8\u9ad8\u901f\u5b58\u50a8\u6c60\u6539\u5584\u5b9e\u4f8bI/O\u5206\u5e03 \u4ece\u7b2c\u4e8c\u8282\u7684\u5b9e\u9a8c\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u5b9e\u4f8b\u542f\u52a8\u65f6\u4f1a\u6709\u5927\u91cf\u7684\u8bfb\u8bf7\u6c42\u548c\u76f8\u5bf9\u8f83\u5c11\u7684\u5199\u8bf7\u6c42\uff0c\u800c\u6211\u4eec\u7684\u5b9e\u4f8b\u5373\u662f\u4ece\u6a21\u677f\u6bcd\u76d8\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u5c06CED\uff08\u521b\u5efa\u3001\u4fee\u6539\u3001\u5220\u9664\uff09\u6570\u636e\u5199\u5165\u589e\u91cf\u76d8\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u4e0d\u59a8\u5c06\u6a21\u677f\u78c1\u76d8\u653e\u7f6e\u5728\u4e00\u822c\u7684SSD\uff08MLC\u3001TLC\uff09\u5b58\u50a8\u4e0a\u6ee1\u8db3\u8bfb\u8bf7\u6c42\u8981\u6c42\uff0c\u589e\u91cf\u78c1\u76d8\u653e\u7f6e\u5728\u6210\u672c\u76f8\u5bf9\u4f4e\u5ec9\u7684SATA\u76d8RAID\u9635\u5217\u5b58\u50a8\u4e0a\u6765\u6ee1\u8db3\u5e73\u7a33\u4e14\u5206\u6563\u7684\u5199\u8bf7\u6c42\u3002\u8fd9\u6837\u4ee5\u6765\uff0c\u6211\u4eec\u5c31\u8ba9\u5b83\u4eec\u5404\u53d6\u6240\u9700\uff0c\u4ece\u800c\u59a5\u5f53\u5730\u6539\u5584\u542f\u52a8\u98ce\u66b4\u5e26\u6765\u7684\u5f71\u54cd\u3002 :::{figure} ../images/layer-1.png :align: center \u56fe3-1 \u589e\u91cf\u78c1\u76d8\u8bfb\u5199\u8bf7\u6c42 ::: :::{figure} ../images/20-xp-ssd-sata.png :align: center \u56fe3-2 \u6a21\u677f\u4f4d\u4e8eSSD\uff0c\u5b9e\u4f8b\u4f4d\u4e8eSATA\u7684\u8bfb\u5199\u8bf7\u6c42 ::: \u5f53\u7136\uff0c\u968f\u7740\u684c\u9762\u4e2d\u5b89\u88c5\u7684\u81ea\u542f\u52a8\u8f6f\u4ef6\u548c\u670d\u52a1\u8d8a\u6765\u8d8a\u591a\uff0c\u800c\u8fd9\u4e9b\u540e\u6765\u8005\u90fd\u5199\u5165\u4e86\u6211\u4eec\u7684\u589e\u91cf\u76d8\u4e2d\uff0c\u6240\u4ee5\u589e\u91cf\u76d8\u7684\u8bfb\u8bf7\u6c42\u6570\u5728\u540e\u671f\u4f1a\u6709\u4e00\u5b9a\u91cf\u7684\u4e0a\u5347\uff0c\u4ece\u800c\u62d6\u6162\u6574\u4f53\u7684\u8bfb\u8bf7\u6c42\u6c34\u5e73\u3002\u6839\u636e\u5b89\u88c5\u8f6f\u4ef6\u7684\u201c\u91cd\u5ea6\u201d\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u63d0\u524d\u5728\u6a21\u677f\u4e2d\u5b89\u88c5\u6bd4\u8f83\u201c\u91cd\u201d\u7684\u8f6f\u4ef6\uff0c\u5c3d\u91cf\u4f7f\u589e\u91cf\u78c1\u76d8\u4e2d\u7684\u9759\u6001\u6570\u636e\uff08\u6bd4\u5982\u6587\u6863\u3001\u5a92\u4f53\u6587\u4ef6\u7b49\uff09\u5360\u6bd4\u6269\u5927\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u540e\u671f\u7684\u8bfb\u8bf7\u6c42\u65f6\u95f4\u8f83\u4e3a\u5206\u6563\uff0c\u4fdd\u8bc1\u7cfb\u7edf\u7684\u542f\u52a8\u901f\u5ea6\u4e0d\u53d7\u592a\u591a\u5f71\u54cd\u3002 3.2.3. \u65e0\u72b6\u6001\u5b9e\u4f8b\u78c1\u76d8\u9ad8\u901f\u5b58\u50a8\u6c60\u6539\u5584\u5b9e\u4f8bI/O\u5206\u5e03 \u7531\u4e8e\u65e0\u72b6\u6001\u684c\u9762\u5728\u684c\u9762\u4e91\u4e2d\u7684\u91cd\u8981\u4f4d\u7f6e\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u8981\u7279\u522b\u8bf4\u660e\u4e00\u4e0b\uff0c\u770b\u770b\u5982\u4f55\u653e\u7f6e\u5728\u5b58\u50a8\u4e2d\u653e\u7f6e\u5b83\u4eec\u7684\u78c1\u76d8\uff0c\u4ece\u800c\u8fbe\u5230\u65e2\u7701\u94b1\u53c8\u529e\u4e86\u5b9e\u4e8b\u513f\u7684\u6548\u679c\u3002 \u9996\u5148\uff0c\u6a21\u677f\u4f1a\u627f\u53d7\u542f\u52a8\u65f6\u7684\u5927\u91cf\u8bfb\u8bf7\u6c42\uff0c\u90a3\u4e48\u6211\u4eec\u80af\u5b9a\u662f\u8981\u628a\u6a21\u677f\u653e\u7f6e\u5230SSD\u8fd9\u6837\u7684\u9ad8IOPS\u5b58\u50a8\u4e86\u3002 \u7136\u540e\uff0c\u6211\u4eec\u518d\u770b\u4e00\u4e0b\u201c\u65e0\u72b6\u6001\u201d\u78c1\u76d8\uff0c\u5373\u5c06\u5b9e\u4f8b\u78c1\u76d8\u4f5c\u4e3abacking_file\u7684\u78c1\u76d8\u3002\u5728\u684c\u9762\u4e91\u4e2d\u5b83\u7684\u751f\u547d\u5468\u671f\u77ed\uff0c\u751f\u6210\u9891\u7387\u9ad8\uff0c\u5e76\u4e14\u7528\u6237\u4f7f\u7528\u7684\u8f6f\u4ef6\u548c\u6587\u6863\u90fd\u5df2\u7ecf\u88ab\u201c\u6a21\u677f\u5316\u201d\uff0c\u540e\u6765\u5f88\u5c11\u5bf9\u7cfb\u7edf\u6709\u5927\u91cf\u5199\u7684\u60c5\u51b5\u4ea7\u751f\u3002\u6240\u4ee5\uff0c\u5b83\u627f\u53d7\u7684\u8bfb\u5199\u8bf7\u6c42\u91cf\u8f83\u4f4e\uff0c\u4f46\u662f\u5b83\u7684\u6bcf\u4e00\u6b21\u751f\u6210\u548c\u5220\u9664\u5bf9\u6240\u5728\u7269\u7406\u5b58\u50a8\u53c8\u6709\u9891\u7e41\u7684\u91cd\u590d\u5199\u5165\u64cd\u4f5c\u3002\u8003\u8651\u5230SSD\u7684\u64e6\u9664\u6b21\u6570\u6709\u9650\uff0c\u6211\u4eec\u6700\u597d\u5c06\u5b83\u653e\u7f6e\u5728\u673a\u68b0\u78c1\u76d8\u7684\u5b58\u50a8\u4e2d\u3002 \u6700\u540e\uff0c\u4ece\u6a21\u677f\u521b\u5efa\u7684\u5b9e\u4f8b\u78c1\u76d8\u4e5f\u4f1a\u627f\u53d7\u5927\u91cf\u7684\u8bfb\u8bf7\u6c42\uff0c\u4f46\u662f\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u8003\u8651\u4e24\u79cd\u72b6\u51b5\uff1a\u5f53\u5b9e\u4f8b\u78c1\u76d8\u4e2d\u6709\u8f83\u591a\u7684\u62d6\u6162\u542f\u52a8\u65f6\u95f4\u7684\u8f6f\u4ef6\u548c\u670d\u52a1\u65f6\uff0c\u4e3a\u4fdd\u8bc1\u542f\u52a8\u65f6IOPS\u4e0d\u4f1a\u6210\u4e3a\u74f6\u9888\uff0c\u6211\u4eec\u6700\u597d\u628a\u5b83\u4e5f\u653e\u7f6e\u5230SSD\u4e2d\uff1b\u5f53\u5b9e\u4f8b\u78c1\u76d8\u4e2d\u9759\u6001\u6570\u636e\u5360\u6bd4\u8f83\u591a\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u5c06\u5176\u653e\u7f6e\u5728\u673a\u68b0\u76d8\u7684\u9635\u5217\u5b58\u50a8\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e0e\u201c\u65e0\u72b6\u6001\u201d\u78c1\u76d8\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002 :::{figure} ../images/layer-2.png :align: center \u56fe3-3 \u65e0\u72b6\u6001\u5b9e\u4f8b\u7684\u8bfb\u5199\u8bf7\u6c42 ::: 3.3. \u5176\u4ed6\u63d0\u5347\u684c\u9762\u4e91\u5b58\u50a8\u6027\u80fd\u7684\u65b9\u5f0f 3.3.1. fscache FS-Cache \u662f\u4e00\u79cd\u5c06\u901a\u8fc7\u7f51\u7edc\u83b7\u53d6\u7684\u6570\u636e\u7f13\u5b58\u5230\u672c\u5730\u5e38\u9a7b\u5b58\u50a8\u4ee5\u52a0\u901f\u672c\u5730\u5e94\u7528\u8bbf\u95ee\uff0c\u4ece\u800c\u51cf\u5c11\u7f51\u7edc\u7f51\u7edc\u6d41\u91cf\u7684\u6280\u672f\u3002 :::{figure} ../images/fs-cache.png :align: center \u56fe3-4 FS-Cache\u539f\u7406\u56fe ::: FS-Cache\u5728\u8bbe\u8ba1\u4e4b\u521d\uff0c\u5c31\u5c3d\u91cf\u4fdd\u6301\u5bf9\u7ba1\u7406\u5458\u548c\u7528\u6237\u900f\u660e\u7684\u7279\u6027\u3002\u4e0d\u540c\u4e8eSolaris\u7cfb\u7edf\u7684cachefs\uff0cFS-Cache\u5141\u8bb8\u670d\u52a1\u5668\u7aef\u7684\u6587\u4ef6\u7cfb\u7edf\u76f4\u63a5\u4e0e\u5ba2\u6237\u7aef\u7684\u672c\u5730cache\u8fdb\u884c\u4ea4\u4e92\uff0c\u800c\u4e0d\u9700\u8981\u989d\u5916\u6302\u8f7d\u6587\u4ef6\u7cfb\u7edf\u3002\u6bd4\u5982\u5728NFS\u4e0a\u4f7f\u7528FS-Cache\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u6302\u8f7d\u9009\u9879\u4e2d\u52a0\u4e00\u4e2a\u53c2\u6570\u5c31\u53ef\u4ee5\u542f\u7528\u5b83\u3002 FS-Cache\u5728\u4e0d\u6539\u53d8\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\u57fa\u672c\u64cd\u4f5c\u7684\u524d\u63d0\u4e0b\uff0c\u63d0\u4f9b\u4e86\u6587\u4ef6\u7cfb\u7edf\u4e2d\u4e00\u4e2a\u5e38\u9a7bcache\u7528\u4e8e\u6570\u636e\u7684\u6682\u5b58\u3002\u6bd4\u5982\uff0c\u4e00\u4e2aNFS\u5ba2\u6237\u7aef\u5373\u4f7f\u4e4b\u524d\u914d\u7f6e\u4e86FS-Cache\u5e76\u4e14\u6709\u4e00\u90e8\u5206\u6570\u636e\u88abcache\uff0c\u5173\u95ed\u540e\u5b83\u540e\u4ecd\u7136\u53ef\u4ee5\u6302\u8f7dNFS\u5e76\u4e14\u4f7f\u7528\u88abcache\u7684\u6570\u636e\u90e8\u5206\u3002FS-Cache\u4e5f\u53ef\u9690\u85cf\u6389\u5ba2\u6237\u7aef\u6587\u4ef6\u7cfb\u7edf\u9a71\u52a8\u7684\u6240\u6709I/O\u9519\u8bef\u3002\u5728\u914d\u7f6eFS-Cache\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2acache\u7684\u540e\u7aef\uff0c\u8fd9\u4e2a\u540e\u7aef\u7684\u6587\u4ef6\u7cfb\u7edf\u9700\u8981\u652f\u6301bmap\u548c\u6269\u5c55\u5c5e\u6027\u3002 \u4f46FS-Cache\u4e0d\u80fdcache\u4efb\u610f\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u9700\u8981\u7684\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u9a71\u52a8\u9700\u8981\u80fd\u591f\u4e0eFS-Cache\u4ea4\u4e92\u3001\u5b58\u50a8\u6570\u636e\u3001\u5efa\u7acb\u548c\u9a8c\u8bc1\u5143\u6570\u636e\u3002FS-Cache\u901a\u8fc7cache\u540e\u7aef\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6570\u636e\u7684\u952e\u7d22\u5f15\u548c\u4e00\u81f4\u6027\u68c0\u67e5\u6765\u4fdd\u8bc1\u6570\u636e\u7684\u6301\u4e45\u7279\u6027\uff0c\u5373\u6570\u636e\u7684\u6709\u6548\u6027\u6821\u9a8c\u3002 FS-Cache\u5728\u79c1\u6709\u4e91\u4e2d\u4e00\u822c\u9002\u7528\u4e8e\u6559\u5b66\u3001\u529e\u516c\u7b49\u6a21\u677f\u76f8\u540c\u7684\u6279\u91cf\u684c\u9762\uff0c\u4e0d\u9002\u7528\u4e8e\u5b58\u50a8\u6a21\u677f\u5927\u591a\u76f8\u5f02\u7684\u865a\u62df\u670d\u52a1\u5668\u3002 3.3.2. bcache bcache\u662fLinux\u5185\u6838\u5757\u8bbe\u5907\u5c42\u7684cache\u6a21\u5757\uff0c\u5b83\u53ef\u4ee5\u8ba9\u4e00\u5757\u6216\u591a\u5757SSD\u7528\u4f5c\u4e3a\u666e\u901a\u786c\u76d8\u7684cache\uff0c\u6709\u70b9\u7c7b\u4f3c\u201c\u6df7\u5408\u786c\u76d8\u201d\u3002 bcache\u6709\u70b9\u7c7b\u4f3cZFS\u4e2d\u7684L2Arc\uff0c\u4f46\u662f\u9664\u53bb\u5f53\u4f5cwrite through\u7684cache\u5916\uff0c\u5b83\u4e5f\u53ef\u5f53\u505awrite back\u7684cache\uff0c\u5e76\u4e14\u6587\u4ef6\u7cfb\u7edf\u5bf9\u5b83\u6765\u8bf4\u662f\u900f\u660e\u7684\u3002\u5728\u4f7f\u7528\u4e0abcache\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u542f\u7528\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u989d\u5916\u8bbe\u7f6e\u5c31\u53ef\u4ee5\u6ee1\u8db3\u6211\u4eec\u5927\u90e8\u5206\u9700\u6c42\u3002\u4f46\u662f\uff0c\u5b83\u4e0d\u4f1a\u53bbcache\u987a\u5e8fI/O\uff0c\u53ea\u4f1acache SSD\u64c5\u957f\u7684\u968f\u673aI/O\uff0c\u8fd9\u70b9\u7279\u6027\u8ba9\u5b83\u7684\u5e94\u7528\u8303\u56f4\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u6709\u6240\u9650\u5236\u4e86\u3002 \u8fd8\u6709\u4e00\u70b9\u6bd4\u8f83\u6709\u7528\u7684\u7279\u6027\uff0c\u5373\u6389\u7535\u540e\u5b83\u7684\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\uff0c\u8fd9\u6837\u5b83\u5c31\u6709\u70b9\u50cf\u4e00\u4e2a\u5e26\u7535\u6c60\u7684raid\u63a7\u5236\u5668\u4e86\u3002\u5173\u4e8e\u8fd9\u70b9\uff0c\u793e\u533a\u548c\u5546\u4e1a\u516c\u53f8\u5df2\u7ecf\u6709\u505a\u4e86\u5f88\u591a\u5de5\u4f5c\uff0c\u6240\u4ee5\u6211\u4eec\u653e\u5fc3\u7528\u5c31\u597d\u4e86\u3002 \u4f46\u7531\u4e8e\u5b83\u662f\u5757\u8bbe\u5907\u7ea7\u522b\u7684cache\uff0c\u5b83\u5bf9\u5355\u4e2a\u670d\u52a1\u5668\u7684\u63d0\u5347\u6bd4\u8f83\u5927\uff0c\u4f46\u662f\u5bf9\u4e8e\u8dd1\u5728\u5916\u63a5\u5b58\u50a8\u8bbe\u5907\u4e0a\u7684\u865a\u62df\u673a\u5c31\u6ca1\u6709\u4ec0\u4e48\u6548\u679c\u4e86\u3002\u6240\u4ee5\u9664\u53bb\u5546\u4e1a\u5b58\u50a8\u8bbe\u5907\u7684\u9009\u62e9\u5916\uff0cbcache\u548cfscache\u8ba9\u6211\u4eec\u591a\u4e86\u4e00\u4e2a\u81ea\u5efa\u5b58\u50a8\u7684\u7406\u7531\u3002 3.3.3. SSD PCI-E \u5361 PCI Express SSD\u4ea7\u54c1\u901a\u5e38\u91c7\u7528\u7279\u6b8a\u7684\u9a71\u52a8\u5668\u901a\u8fc7PCI\u603b\u7ebf\u8fdb\u884c\u76f4\u63a5\u5b58\u50a8\u5668\u8bbf\u95ee(Direct Memory Access\uff0c\u7b80\u79f0DMA)\uff0c\u800c\u975e\u53ea\u662f\u5c06\u95ea\u5b58\u6216DRAM\u5185\u5b58\u5c01\u88c5\u6210SCSI\u8fde\u63a5\u7684\u786c\u76d8\u9a71\u52a8\u5668\u3002\u8fd9\u662f\u4e00\u79cd\u6bd4\u8f83\u9769\u547d\u6027\u7684\u6539\u53d8\uff0c\u5b83\u4f7f\u5f97\u968f\u673a\u8bfb\u5199\u6027\u80fd\u76f8\u6bd4\u5176\u4ed6\u5b58\u50a8\u8bbe\u5907\u90fd\u6709\u8d28\u7684\u63d0\u5347\u3002 \u5b58\u50a8\u8bbe\u5907\u8fde\u63a5\u670d\u52a1\u5668\u6709\u4ee5\u4e0b\u51e0\u79cd\u5e38\u89c1\u65b9\u5f0f\uff1a PCI-E\u603b\u7ebf\u8fde\u63a5RAID\u63a7\u5236\u5668\uff0c\u518d\u8fde\u63a5SAS\u6216SATA\u786c\u76d8\u3002 \u901a\u8fc7PCI-E\u603b\u7ebf\u8fde\u63a5HBA\u5361\uff0c\u518d\u8fde\u63a5\u5230\u78c1\u76d8\u9635\u5217\u3002 SSD\u6302\u8f7d\u5230PCI-E SSD\u5361\uff0c\u518d\u6302\u5230PCIe\u63d2\u69fd\u3002 \u6211\u4eec\u53ef\u4ee5\u770b\u5230CPU\u901a\u8fc7PCI-E SSD\u5361\u63d0\u4f9b\u7684\u77ed\u8def\u5f84\u6765\u8bbf\u95eeSSD\uff0c\u7ed3\u5408flash\u7684\u9ad8\u901f\u8bfb\u5199\u6027\u80fd\uff0c\u6781\u5927\u7684\u63d0\u5347\u5b58\u50a8\u6027\u80fd\uff0c\u7a81\u7834\u5b58\u50a8I/O\u74f6\u9888\u3002 \u800c\u76ee\u524d\u5728\u684c\u9762\u4e91\u4e2d\uff0c\u8fd9\u662f\u4e00\u79cd\u5962\u4f88\u7684\u89e3\u51b3\u65b9\u6848\u3002 4. \u603b\u7ed3 \u4ece\u6a21\u62df\u8bd5\u9a8c\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u670d\u52a1\u5668\u8fd0\u884c\u4e00\u5b9a\u6570\u91cf\uff0820-50\uff09\u7684\u865a\u62df\u684c\u9762\u4e0b\u7684\u5b58\u50a8I/O\u8d1f\u8f7d\uff0c\u4e86\u89e3\u5230\u684c\u9762\u5728\u542f\u52a8\u65f6\u7684\u8bfb\u5199\u8bf7\u6c42\u5206\u5e03\u72b6\u51b5\uff0c\u800c\u540e\u6211\u4eec\u518d\u6839\u636e\u5b9e\u9a8c\u7ed3\u679c\u63d0\u51fa\u684c\u9762\u529f\u80fd\u7684\u7b80\u5355\u4f18\u5316\u7b56\u7565\u3002 \u603b\u4e4b\uff0c\u76ee\u524d\u8981\u5b8c\u5168\u907f\u514d\u542f\u52a8\u98ce\u66b4\u3001\u767b\u5f55\u98ce\u66b4\u9700\u8981\u8f83\u5927\u7684\u6210\u672c\u6295\u5165\uff0c\u800c\u5728\u79c1\u6709\u684c\u9762\u4e91\u4e2d\uff0c\u6211\u4eec\u6700\u597d\u5408\u7406\u89c4\u5212\u5b58\u50a8\u4ee5\u51cf\u5c11\u98ce\u66b4\u5e26\u6765\u7684\u5f71\u54cd\u3002 \u5bf9\u4e8e\u8bfb\u8005\u6765\u8bf4\uff0c\u627e\u5230\u5408\u9002\u7684\u5c31\u597d\uff0c\u6bd5\u7adf\u67b6\u6784\u6ca1\u6709\u5b8c\u7f8e\u7684\uff0c\u90fd\u662f\u5728\u7ecf\u9a8c\u4e2d\u8fdb\u5316\u7684\u3002","title":"\u300a\u8fd0\u7ef4\u524d\u7ebf\u300b\u865a\u62df\u5316\u5b58\u50a8\u542f\u52a8\u98ce\u66b4\u8349\u7a3f"},{"location":"inthecloud/frontline-storage/#-","text":"\u684c\u9762\u79c1\u6709\u4e91\u76f8\u8f83\u4e8e\u4e00\u822c\u516c\u6709\u4e91\uff0c\u6709\u7740\u865a\u62df\u673a\u542f\u52a8\u5bc6\u5ea6\u5927\u3001\u670d\u52a1\u5668\u8d44\u6e90\u5197\u4f59\u6027\u4f4e\u7b49\u7279\u70b9\uff0c\u672c\u6587\u5c1d\u8bd5\u6a21\u62df\u684c\u9762\u4e91\u4e2d\u7684\u5e38\u89c1\u573a\u666f\u6765\u8bf4\u660e\u542f\u52a8\u98ce\u66b4\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6cd5\uff0c\u5e76\u5728\u73b0\u6709\u65b9\u6cd5\u7684\u57fa\u7840\u4e0a\u63d0\u51fa\u4e00\u4e9b\u6539\u8fdb\u63aa\u65bd\uff0c\u5bf9\u516c\u6709\u4e91\u4e5f\u6709\u4e00\u5b9a\u53c2\u8003\u4ef7\u503c\u3002","title":"\u865a\u62df\u5316\u4e2d\u5b58\u50a8\u914d\u7f6e\u5178\u578b\u573a\u666f\uff0d\u542f\u52a8\u98ce\u66b4"},{"location":"inthecloud/frontline-storage/#1","text":"\u78c1\u76d8\u5206\u914d\u65b9\u5f0f \u73b0\u6709\u6bd4\u8f83\u6210\u719f\u7684\u5f00\u6e90\u865a\u62df\u5316/\u4e91\u8ba1\u7b97\u5e73\u53f0\uff0c\u5305\u62ecOpenStack\u3001CloudStack\u548coVirt\u7b49\uff0c\u90fd\u6709\u6bd4\u8f83\u6e05\u6670\u7684\u6a21\u677f\u548c\u5b9e\u4f8b\u6982\u5ff5\uff0c\u540c\u65f6\u4e5f\u6709\u6a21\u677f\u4e0e\u5b9e\u4f8b\u955c\u50cf\u5b58\u50a8\u4f4d\u7f6e\u76f8\u5173\u7684\u5b58\u50a8\u57df\u914d\u7f6e\uff0c\u4e3a\u4e86\u533a\u5206\u865a\u62df\u673a\u4e2d\u7684\u6a21\u677f\u4e0e\u5b9e\u4f8b\uff0c\u6211\u4eec\u4e0b\u6587\u90fd\u9ed8\u8ba4\uff1a\u6a21\u677f\u5373\u539f\u59cb\u865a\u62df\u673a\uff0c\u6240\u6709\u65b0\u5b9e\u4f8b\u7684\u521b\u5efa\u90fd\u4f9d\u8d56\u4e8e\u5b83\uff1b\u5b9e\u4f8b\u5373\u4f9d\u8d56\u6a21\u677f\u521b\u5efa\u7684\u865a\u62df\u673a\uff0c\u662f\u5177\u6709\u8fd0\u884c\u751f\u547d\u5468\u671f\u7684\u865a\u62df\u673a\u901a\u79f0\u3002 \u5728\u865a\u62df\u5316\u5e73\u53f0\u4e2d\uff0c\u4e00\u822c\u6709\u4e24\u79cd\u65b0\u5efa\u5b9e\u4f8b\u7684\u65b9\u5f0f\uff1a\u514b\u9686\u4e0e\u589e\u91cf\u3002 \u514b\u9686\u5373\u5b8c\u6574\u514b\u9686\u6a21\u677f\u914d\u7f6e\u4e0e\u78c1\u76d8\uff0c\u78c1\u76d8\u7684\u521b\u5efa\u65b9\u5f0f\u4e00\u822c\u4e3acp\u6216\u8005qemu-img convert\u3002\u5982\u6b64\u521b\u5efa\u7684\u5b9e\u4f8b\uff0c\u5176\u78c1\u76d8\u4e0e\u6a21\u677f\u78c1\u76d8\u76f8\u5bf9\u72ec\u7acb\uff0c\u5728\u670d\u52a1\u5668\u5b58\u50a8\u4e0a\u62e5\u6709\u5404\u81ea\u7684\u6247\u533a\u4f4d\u7f6e\uff0c\u6240\u4ee5\u5728\u8bfb\u5199\u64cd\u4f5c\u65f6\u53d7\u673a\u68b0\u76d8\u78c1\u5934\u5f15\u8d77\u7684\u5c0f\u533a\u57df\u5e76\u53d1\u95ee\u9898\u5f71\u54cd\u8f83\u5c0f\uff0c\u7f3a\u70b9\u662f\u521b\u5efa\u65f6\u9700\u8981\u6d88\u8017\u4e00\u5b9a\u65f6\u95f4\uff0c\u4e0d\u80fd\u6ee1\u8db3\u79d2\u7ea7\u521b\u5efa\u7684\u9700\u6c42\u3002 \u589e\u91cf\u5373\u65b0\u5efa\u865a\u62df\u673a\u53ea\u590d\u5236\u6a21\u677f\u914d\u7f6e\u4fe1\u606f\uff0c\u4f46\u5176\u78c1\u76d8\u6587\u4ef6\u901a\u8fc7qemu-img\u7684backing file\u65b9\u6cd5\u521b\u5efa\uff0c\u57fa\u4e8ebacking file\u521b\u5efa\u7684\u78c1\u76d8\u4e0d\u80fd\u662fraw\u683c\u5f0f\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a 1 qemu-img create -b hda.qcow2 -f qcow2 hda-new.qcow2 \u5982\u6b64\u521b\u5efa\u7684\u78c1\u76d8\u5bf9\u6a21\u677f\u78c1\u76d8\u7684\u4f9d\u8d56\u8f83\u5927\uff0c\u975e\u589e\u91cf\u6587\u4ef6\u7684\u8bfb\u64cd\u4f5c\uff08\u6bd4\u5982\u542f\u52a8\u7cfb\u7edf\uff09\u7edd\u5927\u90e8\u5206\u5728\u6a21\u677f\u78c1\u76d8\u4e0a\u8fdb\u884c\uff0c\u6240\u4ee5\u5728\u4f20\u7edf\u673a\u68b0\u76d8\u4e0a\u591a\u4e2a\u5b9e\u4f8b\u7684\u5e76\u53d1\u542f\u52a8\u98ce\u66b4\u66f4\u5bb9\u6613\u5728\u6b64\u79cd\u683c\u5f0f\u7684\u78c1\u76d8\u4e0a\u53d1\u751f\u3002 \u96c6\u7fa4\u8c03\u5ea6\u7b56\u7565 \u5b9e\u4f8b\u7684\u542f\u52a8\u5728\u865a\u62df\u5316\u5e73\u53f0\u4e2d\u7684\u4e00\u822c\u8c03\u5ea6\u5982\u4e0b\uff1a :::{figure} ../images/schedule.png :align: center \u56fe1-1 ::: \u4ece\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u4e2a\u5b9e\u4f8b\u5728\u771f\u6b63\u542f\u52a8\u4e4b\u524d\u4f1a\u6839\u636e\u4e00\u5b9a\u7b56\u7565\u88ab\u5b89\u6392\u5230\u67d0\u96c6\u7fa4\u7684\u67d0\u4e00\u4e3b\u673a\u4e0a\uff0c\u800c\u4e14\u6839\u636e\u96c6\u7fa4\u72b6\u6001\u53ef\u4ee5\u52a8\u6001\u8fc1\u79fb\u81f3\u5176\u4ed6\u4e3b\u673a\uff0c\u5728\u672c\u6587\u4e2d\u6211\u4eec\u4e0d\u5c55\u5f00\u8fc1\u79fb\u7684\u60c5\u51b5\u3002 \u6211\u4eec\u5728\u5b9e\u73b0\u8c03\u5ea6\u7b56\u7565\u7684\u65f6\u5019\u4e3b\u8981\u8003\u91cf\u4ee5\u4e0b\u51e0\u70b9\uff1a \u96c6\u7fa4\u7684CPU\u7c7b\u578b\uff08Family\uff09\u3001\u96c6\u7fa4\u8d1f\u8f7d\u72b6\u6001\uff1b \u4e3b\u673a\u8fd0\u884c\u865a\u62df\u673a\u6570\u91cf\u3001\u4e3b\u673a\u5386\u53f2\u5065\u5eb7\u5ea6\uff1b \u4e3b\u673aCPU\u7528\u5ea6\u3001\u7f51\u7edc\u7528\u5ea6\u3001\u5185\u5b58\u7528\u5ea6\u3001\u5b58\u50a8I/O\u7528\u5ea6\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\u7684\u65f6\u95f4\uff1b","title":"1. \u5e38\u89c1\u865a\u62df\u5316\u5e73\u53f0\u7684\u914d\u7f6e\u4ecb\u7ecd"},{"location":"inthecloud/frontline-storage/#11","text":"\u5f53\u6a21\u677f\u4e0e\u5b9e\u4f8b\u5b58\u50a8\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e2d\u65f6\uff0c\u6211\u4eec\u521b\u5efa\u865a\u62df\u673a\u7684\u5e38\u7528\u65b9\u6cd5\u6709\u4e24\u79cd\u2014\u2014\u2014\u2014\u4f7f\u7528\u6a21\u677f\u7684\u78c1\u76d8\u7684hardlink\u4f5c\u4e3a\u5b9e\u4f8b\u78c1\u76d8\u7684backing file\u6765\u521b\u5efa\u589e\u91cf\u78c1\u76d8\uff0c\u6216\u8005\u76f4\u63a5\u514b\u9686\u6a21\u677f\u78c1\u76d8\u3002 \u4e8eoVirt\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u4e3b\u5b58\u50a8\u57df\u7684\u76ee\u5f55\u7ed3\u6784\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # tree data/ data/4440c3f9-ba1f-4803-86ac-d59c694c61c1/ \u251c\u2500\u2500 dom_md \u2502 \u251c\u2500\u2500 ids \u2502 \u251c\u2500\u2500 inbox \u2502 \u251c\u2500\u2500 leases \u2502 \u251c\u2500\u2500 metadata \u2502 \u2514\u2500\u2500 outbox \u251c\u2500\u2500 images \u2502 \u251c\u2500\u2500 d25c4d22-15c1-4f3c-8aef-2ed74deb4723 \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63 \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63.lease \u2502 \u2502 \u2514\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63.meta \u2502 \u251c\u2500\u2500 d6d7e74d-76fc-48c6-b3c6-3c506b98e73e \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63 \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63.lease \u2502 \u2502 \u251c\u2500\u2500 2bf1ba4c-3fb5-4e25-9368-cc96724b1a63.meta \u2502 \u2502 \u251c\u2500\u2500 81031024-5942-4086-901b-f991777ff32a \u2502 \u2502 \u251c\u2500\u2500 81031024-5942-4086-901b-f991777ff32a.lease \u2502 \u2502 \u2514\u2500\u2500 81031024-5942-4086-901b-f991777ff32a.meta \u2502 \u2514\u2500\u2500 ed834c83-82c3-4ea3-a08d-82cfbb213af4 \u2502 \u251c\u2500\u2500 3e56f6dd-be45-48d0-aba8-830d0ee1f068 \u2502 \u251c\u2500\u2500 3e56f6dd-be45-48d0-aba8-830d0ee1f068.lease \u2502 \u2514\u2500\u2500 3e56f6dd-be45-48d0-aba8-830d0ee1f068.meta \u2514\u2500\u2500 master \u251c\u2500\u2500 tasks \u2514\u2500\u2500 vms \u5176\u4e2d\uff0c2bf1ba4c-3fb5-4e25-9368-cc96724b1a63\u4e3a\u6a21\u677f\u78c1\u76d8\uff0cd6d7e74d-76fc-48c6-b3c6-3c506b98e73e\u5373\u4e3a\u4ece\u6a21\u677f\u521b\u5efa\u7684\u589e\u91cf\u5b9e\u4f8b\u78c1\u76d8\u3002 \u4e0a\u56fe\u4e2d\u7684\u6a21\u677f\u78c1\u76d8\u548c\u5b9e\u4f8b\u78c1\u76d8\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\uff0coVirt\u4f7f\u7528\u4f7f\u7528\u4e86hardlink\u94fe\u63a5\u4e86\u6a21\u677fd25c4d22-15c1-4f3c-8aef-2ed74deb4723\u4e0b\u7684\u78c1\u76d82bf1ba4c-3fb5-4e25-9368-cc96724b1a63\u548c\u5b9e\u4f8b6d7e74d-76fc-48c6-b3c6-3c506b98e73e\u4e0b\u76842bf1ba4c-3fb5-4e25-9368-cc96724b1a63\u3002 :::{note} \u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\u4f7f\u7528hardlink\u7684\u800c\u975esoftlink\u7684\u539f\u56e0 \u8282\u7701inode\u4f7f\u7528\u91cf \u7531\u4e8e\u7701\u53bb\u4e86\u8bbf\u95eesoftlink\u7684inode\u8fd9\u4e00\u6b65\uff0c\u76f4\u63a5\u8bbf\u95ee\u539f\u6587\u4ef6\u7684inode\u4f1a\u5e26\u6765\u6027\u80fd\u4e0a\u7684\u7a0d\u8bb8\u63d0\u5347 \u6539\u53d8\u6e90\u6587\u4ef6\u8def\u5f84\u4e0d\u4f1a\u5f71\u54cdhardlink\u6587\u4ef6\u7684\u8bbf\u95ee \u5197\u4f59\u6027\u53ca\u5b89\u5168\u6027\u8003\u8651\uff0c\u53ea\u6709\u5220\u9664\u4e86inode\u4e0a\u7684\u6240\u6709\u5f15\u7528\uff0c\u6b64inode\u624d\u4f1a\u88ab\u5220\u9664\u3002 ::: :::{note} ids - used by sanlock - each host maintain a lockspace on each domain, allowing it to acquire resources on the leases volume. leases - used for acquiring resources. For example, the spm node acquire a resource on this volume inbox - every host can write message to the spm node using this volume outbox - the spm write messages to other hosts on this volume master - this volume is mounted on the spm node for storing stuff related to the master storage domain metadata - used to store storage domain metadata :::","title":"1.1. \u6a21\u677f\u4e0e\u5b9e\u4f8b\u540c\u4e00\u5b58\u50a8"},{"location":"inthecloud/frontline-storage/#12","text":"\u5f53\u6a21\u677f\u78c1\u76d8\u4e0e\u5b9e\u4f8b\u78c1\u76d8\u5206\u522b\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u65f6\uff0c\u5df2\u7ecf\u4e0d\u80fd\u4f7f\u7528hardlink\u521b\u5efa\u3002oVirt\u8de8\u5b58\u50a8\u57df\u521b\u5efa\u5b9e\u4f8b\u7684\u65b9\u5f0f\u4e3a\u514b\u9686\u521b\u5efa\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528backing file\u521b\u5efa\u589e\u91cf\u78c1\u76d8\u3002\u6211\u4eec\u4ece\u5176\u5b58\u50a8\u57df\u6982\u5ff5\u53ef\u4ee5\u63a8\u6d4b\u51fa\u5b83\u8fd9\u4e48\u505a\u7684\u539f\u56e0\uff0c\u5373\uff1a \u5b58\u50a8\u57df\u95f4\u6ca1\u6709\u6a21\u677f\u4e0e\u5b9e\u4f8b\u7684\u5173\u8054\uff0c\u6613\u4e8e\u5b58\u50a8\u57df\u7ba1\u7406\uff08\u5220\u9664\u3001\u5bfc\u5165\u5b58\u50a8\u57df\u4e0e\u5176\u4e2d\u7684\u865a\u62df\u673a\uff09\uff1b \u5bf9\u4e8e\u8de8\u6587\u4ef6\u7cfb\u7edf\u7684\u5b58\u50a8\u57df\uff0c\u4f7f\u7528\u62f7\u8d1d\u800c\u4e0d\u662f\u589e\u91cf\u521b\u5efa\u66f4\u6613\u4e8e\u51cf\u5c11\u6a21\u677f\u6240\u5728\u5b58\u50a8\u57df\u8d1f\u62c5\u3002 \u800c\u6709\u65f6\u6211\u4eec\u771f\u5b9e\u90e8\u7f72\u865a\u62df\u684c\u9762\u7684\u573a\u666f\u4e2d\uff0c\u5f80\u5f80\u9700\u8981\u591a\u4e2a\u672c\u5730\u5b58\u50a8\u57df\uff08\u6bd4\u5982SAS\u76d8\u4e0eSSD\u76d8\uff09\u6df7\u5408\u4f7f\u7528\u3002\u6240\u4ee5\u5728\u4ee5\u4e0b\u7684\u6d4b\u8bd5\u4e2d\uff0c\u6211\u4e5f\u4f1a\u4f7f\u7528\u8de8\u5b58\u50a8\u57df\u521b\u5efa\u589e\u91cf\u78c1\u76d8\u7684\u65b9\u5f0f\u3002","title":"1.2. \u6a21\u677f\u4e0e\u5b9e\u4f8b\u5206\u79bb\u5b58\u50a8"},{"location":"inthecloud/frontline-storage/#13","text":"oVirt\u4e2d\u5b58\u5728\u4e00\u79cd\u201c\u65e0\u72b6\u6001\u201d\u5b9e\u4f8b\uff0c\u6b64\u79cd\u5b9e\u4f8b\u7684\u521b\u5efa\u8fc7\u7a0b\u5982\u4e0b\uff1a \u5df2\u6709\u6a21\u677f\u78c1\u76d8A\uff0c\u6211\u4eec\u6839\u636e\u91c7\u7528\u514b\u9686\u6216\u8005\u589e\u91cf\u65b9\u5f0f\u521b\u5efa\u5b9e\u4f8b\u78c1\u76d8B\uff0c\u52fe\u9009\u201c\u65e0\u72b6\u6001\u201d\u4ee5\u540e\uff0c\u865a\u62df\u673a\u8fd0\u884c\u4f1a\u81ea\u52a8\u521b\u5efa\u78c1\u76d8B\u7684\u589e\u91cf\u78c1\u76d8C\uff0c\u5b9e\u4f8b\u6240\u6709\u7684\u6539\u52a8\u90fd\u5728C\u4e0a\uff0c\u5f53\u865a\u62df\u673a\u5173\u673a\u540e\uff0c\u5e73\u53f0\u5220\u9664C\u3002\u8fd9\u6837\u4ee5\u6765\uff0c\u6240\u6709\u7684\u6539\u52a8\u4fbf\u968f\u4e4b\u5220\u9664\uff0c\u6211\u4eec\u5c31\u79f0\u8fd9\u79cd\u5de5\u4f5c\u65b9\u5f0f\u7684\u5b9e\u4f8b\u4e3a\u201c\u65e0\u72b6\u6001\u201d\u5b9e\u4f8b\u3002 \u8fd9\u79cd\u72b6\u6001\u4e0b\u865a\u62df\u673a\uff0c\u5b58\u57281-2\u4e2a\u589e\u91cf\u78c1\u76d8\uff0c\u5728\u4ee5\u4e0b\u7684\u5b9e\u9a8c\u4e2d\uff0c\u6211\u4f1a\u5c06\u5176\u5206\u522b\u653e\u7f6e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6d4b\u8bd5\u3002","title":"1.3. \u65e0\u72b6\u6001\u5b9e\u4f8b\u7684\u78c1\u76d8\u4e0e\u5feb\u7167\u5206\u79bb\u5b58\u50a8"},{"location":"inthecloud/frontline-storage/#2","text":"\u6b64\u6b21\u5b9e\u9a8c\u7684\u76ee\u7684\u4e3a\u8003\u5bdf\u591a\u53f0\u865a\u62df\u673a\u540c\u65f6\u542f\u52a8\u5bf9\u78c1\u76d8I/O\u7684\u8d1f\u8f7d\uff0c\u4e0d\u8003\u8651qcow2\u683c\u5f0f\u4e0eraw\u683c\u5f0f\u7684\u5f71\u54cd\uff0c\u7edf\u4e00\u9002\u7528qcow2\u683c\u5f0f\u3002\u6240\u6709\u7684\u865a\u62df\u673a\u5747\u4f7f\u7528VirtIO\u63a5\u53e3\uff0cqcow2\u78c1\u76d8\uff0cbacking_file\u683c\u5f0f\u4e5f\u4e3aqcow2\uff0cWindows XP 32\u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u65e0\u4efb\u4f55\u9644\u52a0\u8f6f\u4ef6\u3002\u4e3a\u51cf\u5c11XP\u7cfb\u7edf\u542f\u52a8\u540e\u5bf9\u5feb\u7167\u78c1\u76d8\u7684\u989d\u5916\u64cd\u4f5c\uff0c\u6211\u4eec\u6240\u6709\u7684XP\u5b9e\u4f8b\u90fd\u8fd0\u884c\u4e86\u4e00\u4e2a\u5c0f\u65f6\u540e\u518d\u5173\u673a\u8fdb\u884c\u6d4b\u8bd5\u3002 \u670d\u52a1\u5668\u914d\u7f6e\u4e3a\u53cc\u8defX5670 @ 2.93GHz\uff0c64GB\u5185\u5b58\uff0c\u4e00\u5757Intel 480G\u4f01\u4e1a\u7ea7SSD\uff0c\u4e00\u5757WD 1T\u4f01\u4e1a\u7ea7\u673a\u68b0\u786c\u76d8\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e3aCentOS 7.1\u3002 \u6a21\u677f\u914d\u7f6e\uff1a file: base_xp.sh 1 2 3 4 5 6 7 8 9 #!/bin/bash /usr/libexec/qemu-kvm -no-user-config -nodefaults \\ -m 1024M -cpu host -smp 1,sockets=1,cores=1 \\ -net user \\ -monitor stdio -vga qxl -global qxl-vga.vram_size=67108864 \\ -spice port=7001,ipv4,disable-ticketing \\ -drive file=hda.qcow2,if=none,id=drive-virtio-disk0,format=qcow2,cache=none,werror=stop,rerror=stop,aio=threads \\ -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \\ -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 \u5b9e\u9a8c\u811a\u672c\uff1a \u521b\u5efa20\u4e2a\u4ee5hda.qcow2\u4e3abacking file\u7684\u78c1\u76d8\uff0c\u7528\u4e8e\u5b9e\u4f8b\u3002 file: create-imgs.sh 1 2 3 4 5 #!/bin/bash for i in `seq 11 30` do qemu-img create -f qcow2 -b hda.qcow2 hda-$i.qcow2 done \u4e00\u6b21\u6027\u542f\u52a820\u53f0\u5b9e\u4f8b\u3002 file: start-vms.sh 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #!/bin/bash function startvm { /usr/libexec/qemu-kvm -no-user-config -nodefaults \\ -m 1024M -cpu host -smp 1,sockets=1,cores=1 \\ -net user \\ -vga qxl -global qxl-vga.vram_size=67108864 \\ -spice port=$1,ipv4,disable-ticketing \\ -drive file=$2,if=none,id=drive-virtio-disk0,format=qcow2,cache=none,werror=stop,rerror=stop,aio=threads \\ -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \\ -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 } for i in `seq 11 30` do startvm 70$i hda-$i.qcow2 done \u6d4b\u91cf\uff0c\u91c7\u6837\u9891\u7387\u4e3a 1 Hz\uff1a 1 iostat -cdmx 1|tee 20-xp.iostat-cdm.out \u6570\u636e\u9884\u5904\u7406\uff0c\u6211\u4eec\u53ea\u9700\u8981\u603b\u8bfb\u5199\u901f\u5ea6\uff08MB/s\uff09\u3001\u603b\u8bfb\u5199\u8bf7\u6c42\uff08Requests/s\uff09\u3001CPU\u5229\u7528\uff08%user,%sys\uff09\u3002 1 2 3 awk 'BEGIN {print \"cpu usage\\n\";i=0};$1 ~ /[0-9]/ {print i,$1+$3;i+=1;}' 20-xp.iostat-cdm.out > 20-xp.iostat-cdm-cpu.out awk 'BEGIN {print \"sdb info\\nTime IOPS RMBps WMBps\";i=0};$1 ~ /^sda/ {iops=$4+$5;print i,iops,$6,$7;i+=1;}' 20-xp.iostat-cdm.out > 20-xp.iostat-cdm-sdb.out awk 'BEGIN {print \"sdb info\\nTime IOPS RMBps WMBps\";i=0};$1 ~ /^sdb/ {iops=$4+$5;print i,iops,$6,$7;i+=1;}' 20-xp.iostat-cdm.out > 20-xp.iostat-cdm-sdb.out \u53ef\u89c6\u5316\u793a\u4f8b\uff0c\u7531\u4e8e\u8bf7\u6c42\u6570\u6bd4\u901f\u5ea6\u9ad8\u5f88\u591a\u500d\uff0c\u4e3a\u65b9\u4fbf\u6570\u636e\u663e\u793a\u6211\u4eec\u5c06\u8bf7\u6c42\u6570\u9664\u4ee510\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 #!/usr/bin/env python import numpy as np import matplotlib.pyplot as plt f_c = file('20-xp.iostat-cdm-sda.out').readlines() c = np.array(map(str.split,f_c[2:]),dtype='float') plt.plot(c[:,0],c[:,1]/10,label=\"IO Requests/s\", color=\"red\", linewidth=2) plt.plot(c[:,0],c[:,2],label=\"Read MB/s\", color=\"blue\", linewidth=2) plt.plot(c[:,0],c[:,3],label=\"Write MB/s\", color=\"blue\", linewidth=2) plt.legend() plt.show()","title":"2. \u542f\u52a8\u98ce\u66b4\u76f8\u5173\u7cfb\u5217\u8bd5\u9a8c"},{"location":"inthecloud/frontline-storage/#21-wd-15k-xp","text":"\u6240\u6709\u5b9e\u4f8b\u4e8eWD 1T\u786c\u76d8\u4e0a\u542f\u52a8\u7684\u7ed3\u679c\u5982\u4e0b\uff1a \u542f\u52a8\u5355\u53f0XP\u7684CPU\u53caI/O\u7528\u5ea6\uff0c\u7cfb\u7edf\u5728\u7b2c8\u79d2\u5de6\u53f3\u8fdb\u5165\u684c\u9762\uff1a :::{figure} ../images/1-xp-sata-cpu.png :align: center \u56fe2-1 ::: :::{figure} ../images/1-xp-sata-io.png :align: center \u56fe2-2 ::: \u542f\u52a820\u53f0XP\u7684CPU\u53caI/O\u7528\u5ea6\uff0c\u5168\u90e8\u7cfb\u7edf\u5728\u7b2c300\u79d2\u5de6\u53f3\u8fdb\u5165\u684c\u9762\uff1a :::{figure} ../images/20-xp-sata-cpu.png :align: center \u56fe2-3 ::: :::{figure} ../images/20-xp-sata-io.png :align: center \u56fe2-4 :::","title":"2.1. WD 15K \u542f\u52a8xp\u5b9e\u9a8c"},{"location":"inthecloud/frontline-storage/#22-intel-120g-ssdxp","text":"\u6240\u6709\u5b9e\u4f8b\u4e8eIntel 480G SSD\u786c\u76d8\u4e0a\u542f\u52a8\u7684\u7ed3\u679c\u5982\u4e0b\uff1a \u542f\u52a8\u5355\u53f0XP\u7684CPU\u53caI/O\u7528\u5ea6\uff0c\u7cfb\u7edf\u5728\u7b2c6\u79d2\u5de6\u53f3\u8fdb\u5165\u684c\u9762\uff1a :::{figure} ../images/1-xp-ssd-cpu.png :align: center \u56fe2-5 ::: :::{figure} ../images/1-xp-ssd-io.png :align: center \u56fe2-6 ::: \u542f\u52a820\u53f0XP\u7684CPU\u53caI/O\u7528\u5ea6\uff0c\u5168\u90e8\u7cfb\u7edf\u5728\u7b2c35\u79d2\u5de6\u53f3\u8fdb\u5165\u684c\u9762\uff1a :::{figure} ../images/20-xp-ssd-cpu.png :align: center \u56fe2-7 ::: :::{figure} ../images/20-xp-ssd-io.png :align: center \u56fe2-8 :::","title":"2.2. Intel 120G SSD\u542f\u52a8xp\u5b9e\u9a8c"},{"location":"inthecloud/frontline-storage/#23","text":"\u4ece\u4e0a\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u603b\u7ed3\u51faXP\u81ea\u542f\u52a8\u65f6\u4f1a\u6709\u5927\u91cf\u7684\u8bfb\u8bf7\u6c42\u4ee5\u53ca\u5927\u91cf\u6570\u636e\u8bfb\u51fa\uff0c\u5199\u8bf7\u6c42\u76f8\u5bf9\u5c11\u5f88\u591a\uff0c\u540c\u65f6CPU\u7528\u5ea6\u968f\u7740I/O\u8bf7\u6c42\u91cf\u4e0a\u5347\uff1b\u800c\u5728\u8fdb\u5165\u684c\u9762\u65f6\u523b\u5de6\u53f3\u4f1a\u6709\u5c11\u91cf\u8bfb\u8bf7\u6c42\u548c\u5c11\u91cf\u6570\u636e\u8bfb\u51fa\uff0c\u6709\u8f83\u591a\u7684\u5199I/O\u8bf7\u6c42\u548c\u5c11\u91cf\u6570\u636e\u5199\u5165\uff0c\u540c\u65f6CPU\u7528\u5ea6\u76f8\u5bf9\u524d\u4e00\u9636\u6bb5\u8f83\u4e3a\u5e73\u7f13\u3002 \u4e00\u822c\u6211\u4eec\u79f0\u542f\u52a8\u65f6\u7684\u524d\u6bb5\u65f6\u95f4\u9020\u6210\u7684I/O\u98ce\u66b4\u4e3a\u201c\u542f\u52a8\u98ce\u66b4\u201d\uff0c\u8fdb\u5165\u684c\u9762\u65f6\u7684\u79f0\u4e4b\u4e3a\u201c\u767b\u5f55\u98ce\u66b4\u201d\u3002","title":"2.3. \u5c0f\u7ed3"},{"location":"inthecloud/frontline-storage/#3","text":"\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e0b\u6211\u4eec\u5728\u79c1\u6709\u4e91\u4e2d\u5904\u7406\u542f\u52a8\u98ce\u66b4\u7684\u65b9\u6cd5\uff0c\u5176\u4e2d\u4e00\u4e9b\u53ef\u80fd\u5e76\u4e0d\u9002\u7528\u4e8e\u6240\u6709\u573a\u666f\uff0c\u4f46\u76f8\u4fe1\u4ecd\u6709\u4e9b\u53c2\u8003\u53ca\u6298\u817e\u4ef7\u503c\u3002","title":"3. \u79c1\u6709\u4e91\u4e2d\u5904\u7406\u542f\u52a8\u98ce\u66b4\u7684\u5e38\u7528\u65b9\u6cd5"},{"location":"inthecloud/frontline-storage/#31","text":"\u542f\u52a8\u6392\u961f\u662f\u4e00\u79cd\u6539\u5584\u542f\u52a8\u98ce\u66b4\u6bd4\u8f83\u5e38\u89c1\u7684\u505a\u6cd5\uff0c\u5b83\u5728\u865a\u62df\u5316\u5e73\u53f0\u5206\u914d\u5b9e\u4f8b\u5230\u67d0\u53f0\u670d\u52a1\u5668\u540e\u6267\u884c\uff0c\u5373\u6211\u4eec\u4e0d\u8003\u8651\u5b9e\u4f8b\u5728\u591a\u53f0\u670d\u52a1\u5668\u4e0a\u7684\u8c03\u5ea6\uff0c\u5176\u57fa\u672c\u539f\u7406\u5982\u4e0b\u3002 ```{image} ../images/storage-01.png :align: center ``` \u5b9e\u4f8b\u5728\u542f\u52a8\u65f6\u90fd\u4f1a\u88ab\u52a0\u8fdb\u56fa\u5b9a\u957f\u5ea6\u4e3am+n\u7684\u961f\u5217\u672b\u7aef\uff0c\u5176\u4e2dm\u4e3a\u5b9e\u4f8b\u8fd0\u884c\u65f6\u78c1\u76d8\u6240\u5728\u5b58\u50a8\u7684\u6700\u4f18\u5b9e\u4f8b\u542f\u52a8\u5e76\u53d1\u6570\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u542f\u52a8\u961f\u5217\u3002n\u4e3a\u7b49\u5f85\u542f\u52a8\u7684\u5b9e\u4f8b\u6570\u76ee\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u4e3a\u5f85\u542f\u52a8\u961f\u5217\u3002\u6211\u4eec\u5c06\u5b9e\u4f8b\u81ea\u542f\u52a8\u5230\u5176iops\u964d\u81f3\u5176\u7a7a\u8f7d\u8fd0\u884c\u6c34\u5e73\u89c6\u4e3a\u5b8c\u5168\u542f\u52a8\uff0c\u6b64\u6bb5\u65f6\u95f4\u4e3at\u3002\u5f53\u961f\u5217m\u4e2d\u6709\u5b9e\u4f8b\u5b8c\u5168\u542f\u52a8\u540e\uff0c\u5c06\u5176\u4ece\u961f\u5217\u4e2d\u79fb\u9664\uff0c\u961f\u5217n\u4e2d\u7684\u9996\u7aef\u7684\u5b9e\u4f8b\u52a0\u5165\u81f3m\u961f\u5217\u5c3e\u7aef\u5e76\u5f00\u59cb\u542f\u52a8\u3002 \u4f7f\u7528\u542f\u52a8\u6392\u961f\u65f6\uff0c\u6709\u4ee5\u4e0b\u51e0\u70b9\u8bbe\u8ba1\u539f\u5219\u9700\u8981\u6ce8\u610f\uff1a t\u548cm\u7684\u503c\u53ef\u4ee5\u6839\u636e\u5b9e\u4f8b\u8fd0\u884c\u7684\u6240\u5904\u73af\u5883\u81ea\u52a8\u52a8\u6001\u8c03\u6574\uff08\u540e\u53f0\u81ea\u52a8\u6d4b\u91cf\u670d\u52a1\u5668\u3001\u5b58\u50a8\u670d\u52a1\u6c34\u5e73\uff09\uff0c\u7ba1\u7406\u5458\u4e5f\u53ef\u624b\u52a8\u8c03\u6574\u3002 \u5b9e\u4f8b\u4f1a\u6839\u636e\u5176\u4f18\u5148\u7ea7\u63d2\u961f\u81f3n\u7684\u9996\u7aef\uff0c\u4f46\u4e0d\u53ef\u63d2\u961f\u81f3m\u961f\u5217\u4e2d\u3002 \u5f53\u961f\u5217n\u6ee1\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u62d2\u7edd\u542f\u52a8\u6216\u8005\u7b49\u5f85\u8d44\u6e90\u4ee5\u542f\u52a8\u5b9e\u4f8b\uff1b\u67d0\u4e9b\u8bbe\u8ba1\u4e2d\u4e5f\u53ef\u5c06m\u4e0en\u5408\u5e76\u4e3a\u4e00\u4e2a\u542f\u52a8\u961f\u5217\u3002 \u6b64\u79cd\u65b9\u5f0f\u80fd\u591f\u6bd4\u8f83\u9ad8\u6548\u5730\u5229\u7528\u670d\u52a1\u5668\u548c\u5b58\u50a8\u8d44\u6e90\uff0c\u800c\u4e14\u5bf9\u5df2\u542f\u52a8\u5b9e\u4f8b\u7684\u9644\u5e26\u5f71\u54cd\u53c8\u8f83\u5c11\u3002","title":"3.1. \u542f\u52a8\u6392\u961f"},{"location":"inthecloud/frontline-storage/#32","text":"\u542f\u52a8\u6392\u961f\u7684\u65b9\u5f0f\u662f\u4ece\u7b56\u7565\u4e0a\u89e3\u51b3\u95ee\u9898\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4ece\u5b9e\u4f8b\u78c1\u76d8\u5b58\u50a8\u4f4d\u7f6e\u7684\u9009\u62e9\u4e0a\u8fdb\u4e00\u6b65\u964d\u4f4e\u542f\u52a8\u98ce\u66b4\u5e26\u6765\u7684\u5f71\u54cd\u3002 \u6a21\u677f\u78c1\u76d8\u3001\u5b9e\u4f8b\u78c1\u76d8\u3001\u589e\u91cf\u78c1\u76d8\u4ee5\u53ca\u201c\u65e0\u72b6\u6001\u78c1\u76d8\u201d\u7684\u6240\u5728\u5b58\u50a8\u4f4d\u7f6e\u7684\u6027\u80fd\u80fd\u591f\u76f4\u63a5\u5f71\u54cd\u5b9e\u4f8b\u7684\u542f\u52a8\u8fc7\u7a0b\u3002","title":"3.2. \u5b58\u50a8\u5206\u5c42\u9009\u62e9"},{"location":"inthecloud/frontline-storage/#321-io","text":"\u4ece\u7b2c\u4e8c\u8282\u7684\u5b9e\u9a8c\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u5355\u53f0XP\u5b9e\u4f8b\u542f\u52a8\u7684\u524d10\u79d2\u662fIOPS\u6d88\u8017\u6700\u5927\u7684\u65f6\u671f\u3002\u5728\u542f\u52a8\u98ce\u66b4\u6765\u4e34\u4e4b\u524d\uff0c\u6211\u4eec\u53ea\u8981\u51c6\u5907\u597dIOPS\u5145\u8db3\u4e14\u9002\u5f53\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u518d\u9002\u91cf\u8c03\u6574\u6211\u4eec\u7684I/O\u8c03\u5ea6\u7b97\u6cd5\u5373\u53ef\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u7f13\u51b2\u7b2c\u4e00\u6ce2\u98ce\u66b4\uff0c\u800c\u540e\u7684\u767b\u5f55\u98ce\u66b4\u4fbf\u4e5f\u4fbf\u4e0d\u662f\u95ee\u9898\u4e86\u3002 \u5047\u8bbe\u6211\u4eec\u73b0\u5728\u6709IOPS\u5145\u8db3\u4e14\u9002\u5f53\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u6211\u4eec\u5c06\u6a21\u677f\u3001\u5b9e\u4f8b\u3001\u5feb\u7167\u78c1\u76d8\u5168\u90e8\u653e\u7f6e\u5230\u8fd9\u53f0\u8bbe\u5907\u4e0a\uff0c\u4ece\u800c\u6bd4\u8f83\u201c\u4e0d\u8d1f\u8d23\u4efb\u201d\u5730\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\u3002 \u4e3a\u4ec0\u4e48\u8bf4\u201c\u4e0d\u8d1f\u8d23\u4efb\u201d\u5462\uff1f \u56e0\u4e3a\u867d\u7136\u4e00\u80a1\u8111\u7684\u5168\u90e8\u4e0aSSD\u4f1a\u6539\u5584I/O\u60c5\u51b5\u800c\u51cf\u7f13\u542f\u52a8\u98ce\u66b4\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u4f46\u6210\u672c\u4e0a\u5bf9\u6bd4\u6839\u636e\u5b9e\u4f8b\u5b9e\u9645\u8bfb\u5199I/O\u5206\u914d\u5408\u7406\u89c4\u5212\u5b58\u50a8\u7684\u65b9\u6848\uff0c\u5c31\u663e\u5f97\u4e9b\u8bb8\u6d6a\u8d39\u4e86\u3002 \u5f53\u7136\uff0c\u4e0d\u8bba\u662f\u540e\u7aef\u5b58\u50a8\u8fd8\u662f\u524d\u7aef\u670d\u52a1\u5668OS\uff0c\u4f7f\u7528\u54cd\u5e94\u65f6\u95f4\u77ed\u3001\u8bfb\u5199\u5e26\u5bbd\u5927\u7684\u78c1\u76d8\u603b\u662f\u6709\u76ca\u7684\u3002\u73b0\u5728\u5236\u9020SSD\u7684\u6280\u672f\u4e0d\u65ad\u63d0\u9ad8\uff0c\u6210\u672c\u3001\u5bff\u547d\u3001\u901f\u5ea6\u3001\u5bb9\u91cf\u7b49\u4e0e\u673a\u68b0\u786c\u76d8\u76f8\u6bd4\u4f18\u52bf\u4e5f\u8d8a\u6765\u8d8a\u7a81\u51fa\uff0c\u56e0\u6b64\u6211\u76f8\u4fe1\u5728\u865a\u62df\u5316\u684c\u9762\u9886\u57df\u4e2dSSD\u4f1a\u4ee3\u66ff\u673a\u68b0\u786c\u76d8\u4f1a\u6210\u4e3a\u4e3b\u6d41\u3002","title":"3.2.1. \u7edf\u4e00\u9ad8\u901f\u5b58\u50a8\u6539\u5584\u6574\u4f53I/O\u5206\u5e03"},{"location":"inthecloud/frontline-storage/#322-io","text":"\u4ece\u7b2c\u4e8c\u8282\u7684\u5b9e\u9a8c\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u5b9e\u4f8b\u542f\u52a8\u65f6\u4f1a\u6709\u5927\u91cf\u7684\u8bfb\u8bf7\u6c42\u548c\u76f8\u5bf9\u8f83\u5c11\u7684\u5199\u8bf7\u6c42\uff0c\u800c\u6211\u4eec\u7684\u5b9e\u4f8b\u5373\u662f\u4ece\u6a21\u677f\u6bcd\u76d8\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u5c06CED\uff08\u521b\u5efa\u3001\u4fee\u6539\u3001\u5220\u9664\uff09\u6570\u636e\u5199\u5165\u589e\u91cf\u76d8\u3002\u90a3\u4e48\uff0c\u6211\u4eec\u4e0d\u59a8\u5c06\u6a21\u677f\u78c1\u76d8\u653e\u7f6e\u5728\u4e00\u822c\u7684SSD\uff08MLC\u3001TLC\uff09\u5b58\u50a8\u4e0a\u6ee1\u8db3\u8bfb\u8bf7\u6c42\u8981\u6c42\uff0c\u589e\u91cf\u78c1\u76d8\u653e\u7f6e\u5728\u6210\u672c\u76f8\u5bf9\u4f4e\u5ec9\u7684SATA\u76d8RAID\u9635\u5217\u5b58\u50a8\u4e0a\u6765\u6ee1\u8db3\u5e73\u7a33\u4e14\u5206\u6563\u7684\u5199\u8bf7\u6c42\u3002\u8fd9\u6837\u4ee5\u6765\uff0c\u6211\u4eec\u5c31\u8ba9\u5b83\u4eec\u5404\u53d6\u6240\u9700\uff0c\u4ece\u800c\u59a5\u5f53\u5730\u6539\u5584\u542f\u52a8\u98ce\u66b4\u5e26\u6765\u7684\u5f71\u54cd\u3002 :::{figure} ../images/layer-1.png :align: center \u56fe3-1 \u589e\u91cf\u78c1\u76d8\u8bfb\u5199\u8bf7\u6c42 ::: :::{figure} ../images/20-xp-ssd-sata.png :align: center \u56fe3-2 \u6a21\u677f\u4f4d\u4e8eSSD\uff0c\u5b9e\u4f8b\u4f4d\u4e8eSATA\u7684\u8bfb\u5199\u8bf7\u6c42 ::: \u5f53\u7136\uff0c\u968f\u7740\u684c\u9762\u4e2d\u5b89\u88c5\u7684\u81ea\u542f\u52a8\u8f6f\u4ef6\u548c\u670d\u52a1\u8d8a\u6765\u8d8a\u591a\uff0c\u800c\u8fd9\u4e9b\u540e\u6765\u8005\u90fd\u5199\u5165\u4e86\u6211\u4eec\u7684\u589e\u91cf\u76d8\u4e2d\uff0c\u6240\u4ee5\u589e\u91cf\u76d8\u7684\u8bfb\u8bf7\u6c42\u6570\u5728\u540e\u671f\u4f1a\u6709\u4e00\u5b9a\u91cf\u7684\u4e0a\u5347\uff0c\u4ece\u800c\u62d6\u6162\u6574\u4f53\u7684\u8bfb\u8bf7\u6c42\u6c34\u5e73\u3002\u6839\u636e\u5b89\u88c5\u8f6f\u4ef6\u7684\u201c\u91cd\u5ea6\u201d\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u63d0\u524d\u5728\u6a21\u677f\u4e2d\u5b89\u88c5\u6bd4\u8f83\u201c\u91cd\u201d\u7684\u8f6f\u4ef6\uff0c\u5c3d\u91cf\u4f7f\u589e\u91cf\u78c1\u76d8\u4e2d\u7684\u9759\u6001\u6570\u636e\uff08\u6bd4\u5982\u6587\u6863\u3001\u5a92\u4f53\u6587\u4ef6\u7b49\uff09\u5360\u6bd4\u6269\u5927\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u540e\u671f\u7684\u8bfb\u8bf7\u6c42\u65f6\u95f4\u8f83\u4e3a\u5206\u6563\uff0c\u4fdd\u8bc1\u7cfb\u7edf\u7684\u542f\u52a8\u901f\u5ea6\u4e0d\u53d7\u592a\u591a\u5f71\u54cd\u3002","title":"3.2.2. \u589e\u91cf\u78c1\u76d8\u9ad8\u901f\u5b58\u50a8\u6c60\u6539\u5584\u5b9e\u4f8bI/O\u5206\u5e03"},{"location":"inthecloud/frontline-storage/#323-io","text":"\u7531\u4e8e\u65e0\u72b6\u6001\u684c\u9762\u5728\u684c\u9762\u4e91\u4e2d\u7684\u91cd\u8981\u4f4d\u7f6e\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u8981\u7279\u522b\u8bf4\u660e\u4e00\u4e0b\uff0c\u770b\u770b\u5982\u4f55\u653e\u7f6e\u5728\u5b58\u50a8\u4e2d\u653e\u7f6e\u5b83\u4eec\u7684\u78c1\u76d8\uff0c\u4ece\u800c\u8fbe\u5230\u65e2\u7701\u94b1\u53c8\u529e\u4e86\u5b9e\u4e8b\u513f\u7684\u6548\u679c\u3002 \u9996\u5148\uff0c\u6a21\u677f\u4f1a\u627f\u53d7\u542f\u52a8\u65f6\u7684\u5927\u91cf\u8bfb\u8bf7\u6c42\uff0c\u90a3\u4e48\u6211\u4eec\u80af\u5b9a\u662f\u8981\u628a\u6a21\u677f\u653e\u7f6e\u5230SSD\u8fd9\u6837\u7684\u9ad8IOPS\u5b58\u50a8\u4e86\u3002 \u7136\u540e\uff0c\u6211\u4eec\u518d\u770b\u4e00\u4e0b\u201c\u65e0\u72b6\u6001\u201d\u78c1\u76d8\uff0c\u5373\u5c06\u5b9e\u4f8b\u78c1\u76d8\u4f5c\u4e3abacking_file\u7684\u78c1\u76d8\u3002\u5728\u684c\u9762\u4e91\u4e2d\u5b83\u7684\u751f\u547d\u5468\u671f\u77ed\uff0c\u751f\u6210\u9891\u7387\u9ad8\uff0c\u5e76\u4e14\u7528\u6237\u4f7f\u7528\u7684\u8f6f\u4ef6\u548c\u6587\u6863\u90fd\u5df2\u7ecf\u88ab\u201c\u6a21\u677f\u5316\u201d\uff0c\u540e\u6765\u5f88\u5c11\u5bf9\u7cfb\u7edf\u6709\u5927\u91cf\u5199\u7684\u60c5\u51b5\u4ea7\u751f\u3002\u6240\u4ee5\uff0c\u5b83\u627f\u53d7\u7684\u8bfb\u5199\u8bf7\u6c42\u91cf\u8f83\u4f4e\uff0c\u4f46\u662f\u5b83\u7684\u6bcf\u4e00\u6b21\u751f\u6210\u548c\u5220\u9664\u5bf9\u6240\u5728\u7269\u7406\u5b58\u50a8\u53c8\u6709\u9891\u7e41\u7684\u91cd\u590d\u5199\u5165\u64cd\u4f5c\u3002\u8003\u8651\u5230SSD\u7684\u64e6\u9664\u6b21\u6570\u6709\u9650\uff0c\u6211\u4eec\u6700\u597d\u5c06\u5b83\u653e\u7f6e\u5728\u673a\u68b0\u78c1\u76d8\u7684\u5b58\u50a8\u4e2d\u3002 \u6700\u540e\uff0c\u4ece\u6a21\u677f\u521b\u5efa\u7684\u5b9e\u4f8b\u78c1\u76d8\u4e5f\u4f1a\u627f\u53d7\u5927\u91cf\u7684\u8bfb\u8bf7\u6c42\uff0c\u4f46\u662f\u63a5\u4e0b\u6765\u6211\u4eec\u8981\u8003\u8651\u4e24\u79cd\u72b6\u51b5\uff1a\u5f53\u5b9e\u4f8b\u78c1\u76d8\u4e2d\u6709\u8f83\u591a\u7684\u62d6\u6162\u542f\u52a8\u65f6\u95f4\u7684\u8f6f\u4ef6\u548c\u670d\u52a1\u65f6\uff0c\u4e3a\u4fdd\u8bc1\u542f\u52a8\u65f6IOPS\u4e0d\u4f1a\u6210\u4e3a\u74f6\u9888\uff0c\u6211\u4eec\u6700\u597d\u628a\u5b83\u4e5f\u653e\u7f6e\u5230SSD\u4e2d\uff1b\u5f53\u5b9e\u4f8b\u78c1\u76d8\u4e2d\u9759\u6001\u6570\u636e\u5360\u6bd4\u8f83\u591a\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u5c06\u5176\u653e\u7f6e\u5728\u673a\u68b0\u76d8\u7684\u9635\u5217\u5b58\u50a8\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e0e\u201c\u65e0\u72b6\u6001\u201d\u78c1\u76d8\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002 :::{figure} ../images/layer-2.png :align: center \u56fe3-3 \u65e0\u72b6\u6001\u5b9e\u4f8b\u7684\u8bfb\u5199\u8bf7\u6c42 :::","title":"3.2.3. \u65e0\u72b6\u6001\u5b9e\u4f8b\u78c1\u76d8\u9ad8\u901f\u5b58\u50a8\u6c60\u6539\u5584\u5b9e\u4f8bI/O\u5206\u5e03"},{"location":"inthecloud/frontline-storage/#33","text":"","title":"3.3. \u5176\u4ed6\u63d0\u5347\u684c\u9762\u4e91\u5b58\u50a8\u6027\u80fd\u7684\u65b9\u5f0f"},{"location":"inthecloud/frontline-storage/#331-fscache","text":"FS-Cache \u662f\u4e00\u79cd\u5c06\u901a\u8fc7\u7f51\u7edc\u83b7\u53d6\u7684\u6570\u636e\u7f13\u5b58\u5230\u672c\u5730\u5e38\u9a7b\u5b58\u50a8\u4ee5\u52a0\u901f\u672c\u5730\u5e94\u7528\u8bbf\u95ee\uff0c\u4ece\u800c\u51cf\u5c11\u7f51\u7edc\u7f51\u7edc\u6d41\u91cf\u7684\u6280\u672f\u3002 :::{figure} ../images/fs-cache.png :align: center \u56fe3-4 FS-Cache\u539f\u7406\u56fe ::: FS-Cache\u5728\u8bbe\u8ba1\u4e4b\u521d\uff0c\u5c31\u5c3d\u91cf\u4fdd\u6301\u5bf9\u7ba1\u7406\u5458\u548c\u7528\u6237\u900f\u660e\u7684\u7279\u6027\u3002\u4e0d\u540c\u4e8eSolaris\u7cfb\u7edf\u7684cachefs\uff0cFS-Cache\u5141\u8bb8\u670d\u52a1\u5668\u7aef\u7684\u6587\u4ef6\u7cfb\u7edf\u76f4\u63a5\u4e0e\u5ba2\u6237\u7aef\u7684\u672c\u5730cache\u8fdb\u884c\u4ea4\u4e92\uff0c\u800c\u4e0d\u9700\u8981\u989d\u5916\u6302\u8f7d\u6587\u4ef6\u7cfb\u7edf\u3002\u6bd4\u5982\u5728NFS\u4e0a\u4f7f\u7528FS-Cache\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u6302\u8f7d\u9009\u9879\u4e2d\u52a0\u4e00\u4e2a\u53c2\u6570\u5c31\u53ef\u4ee5\u542f\u7528\u5b83\u3002 FS-Cache\u5728\u4e0d\u6539\u53d8\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\u57fa\u672c\u64cd\u4f5c\u7684\u524d\u63d0\u4e0b\uff0c\u63d0\u4f9b\u4e86\u6587\u4ef6\u7cfb\u7edf\u4e2d\u4e00\u4e2a\u5e38\u9a7bcache\u7528\u4e8e\u6570\u636e\u7684\u6682\u5b58\u3002\u6bd4\u5982\uff0c\u4e00\u4e2aNFS\u5ba2\u6237\u7aef\u5373\u4f7f\u4e4b\u524d\u914d\u7f6e\u4e86FS-Cache\u5e76\u4e14\u6709\u4e00\u90e8\u5206\u6570\u636e\u88abcache\uff0c\u5173\u95ed\u540e\u5b83\u540e\u4ecd\u7136\u53ef\u4ee5\u6302\u8f7dNFS\u5e76\u4e14\u4f7f\u7528\u88abcache\u7684\u6570\u636e\u90e8\u5206\u3002FS-Cache\u4e5f\u53ef\u9690\u85cf\u6389\u5ba2\u6237\u7aef\u6587\u4ef6\u7cfb\u7edf\u9a71\u52a8\u7684\u6240\u6709I/O\u9519\u8bef\u3002\u5728\u914d\u7f6eFS-Cache\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2acache\u7684\u540e\u7aef\uff0c\u8fd9\u4e2a\u540e\u7aef\u7684\u6587\u4ef6\u7cfb\u7edf\u9700\u8981\u652f\u6301bmap\u548c\u6269\u5c55\u5c5e\u6027\u3002 \u4f46FS-Cache\u4e0d\u80fdcache\u4efb\u610f\u7f51\u7edc\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u9700\u8981\u7684\u5171\u4eab\u6587\u4ef6\u7cfb\u7edf\u9a71\u52a8\u9700\u8981\u80fd\u591f\u4e0eFS-Cache\u4ea4\u4e92\u3001\u5b58\u50a8\u6570\u636e\u3001\u5efa\u7acb\u548c\u9a8c\u8bc1\u5143\u6570\u636e\u3002FS-Cache\u901a\u8fc7cache\u540e\u7aef\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6570\u636e\u7684\u952e\u7d22\u5f15\u548c\u4e00\u81f4\u6027\u68c0\u67e5\u6765\u4fdd\u8bc1\u6570\u636e\u7684\u6301\u4e45\u7279\u6027\uff0c\u5373\u6570\u636e\u7684\u6709\u6548\u6027\u6821\u9a8c\u3002 FS-Cache\u5728\u79c1\u6709\u4e91\u4e2d\u4e00\u822c\u9002\u7528\u4e8e\u6559\u5b66\u3001\u529e\u516c\u7b49\u6a21\u677f\u76f8\u540c\u7684\u6279\u91cf\u684c\u9762\uff0c\u4e0d\u9002\u7528\u4e8e\u5b58\u50a8\u6a21\u677f\u5927\u591a\u76f8\u5f02\u7684\u865a\u62df\u670d\u52a1\u5668\u3002","title":"3.3.1. fscache"},{"location":"inthecloud/frontline-storage/#332-bcache","text":"bcache\u662fLinux\u5185\u6838\u5757\u8bbe\u5907\u5c42\u7684cache\u6a21\u5757\uff0c\u5b83\u53ef\u4ee5\u8ba9\u4e00\u5757\u6216\u591a\u5757SSD\u7528\u4f5c\u4e3a\u666e\u901a\u786c\u76d8\u7684cache\uff0c\u6709\u70b9\u7c7b\u4f3c\u201c\u6df7\u5408\u786c\u76d8\u201d\u3002 bcache\u6709\u70b9\u7c7b\u4f3cZFS\u4e2d\u7684L2Arc\uff0c\u4f46\u662f\u9664\u53bb\u5f53\u4f5cwrite through\u7684cache\u5916\uff0c\u5b83\u4e5f\u53ef\u5f53\u505awrite back\u7684cache\uff0c\u5e76\u4e14\u6587\u4ef6\u7cfb\u7edf\u5bf9\u5b83\u6765\u8bf4\u662f\u900f\u660e\u7684\u3002\u5728\u4f7f\u7528\u4e0abcache\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u542f\u7528\uff0c\u5e76\u4e14\u4e0d\u9700\u8981\u989d\u5916\u8bbe\u7f6e\u5c31\u53ef\u4ee5\u6ee1\u8db3\u6211\u4eec\u5927\u90e8\u5206\u9700\u6c42\u3002\u4f46\u662f\uff0c\u5b83\u4e0d\u4f1a\u53bbcache\u987a\u5e8fI/O\uff0c\u53ea\u4f1acache SSD\u64c5\u957f\u7684\u968f\u673aI/O\uff0c\u8fd9\u70b9\u7279\u6027\u8ba9\u5b83\u7684\u5e94\u7528\u8303\u56f4\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u6709\u6240\u9650\u5236\u4e86\u3002 \u8fd8\u6709\u4e00\u70b9\u6bd4\u8f83\u6709\u7528\u7684\u7279\u6027\uff0c\u5373\u6389\u7535\u540e\u5b83\u7684\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\uff0c\u8fd9\u6837\u5b83\u5c31\u6709\u70b9\u50cf\u4e00\u4e2a\u5e26\u7535\u6c60\u7684raid\u63a7\u5236\u5668\u4e86\u3002\u5173\u4e8e\u8fd9\u70b9\uff0c\u793e\u533a\u548c\u5546\u4e1a\u516c\u53f8\u5df2\u7ecf\u6709\u505a\u4e86\u5f88\u591a\u5de5\u4f5c\uff0c\u6240\u4ee5\u6211\u4eec\u653e\u5fc3\u7528\u5c31\u597d\u4e86\u3002 \u4f46\u7531\u4e8e\u5b83\u662f\u5757\u8bbe\u5907\u7ea7\u522b\u7684cache\uff0c\u5b83\u5bf9\u5355\u4e2a\u670d\u52a1\u5668\u7684\u63d0\u5347\u6bd4\u8f83\u5927\uff0c\u4f46\u662f\u5bf9\u4e8e\u8dd1\u5728\u5916\u63a5\u5b58\u50a8\u8bbe\u5907\u4e0a\u7684\u865a\u62df\u673a\u5c31\u6ca1\u6709\u4ec0\u4e48\u6548\u679c\u4e86\u3002\u6240\u4ee5\u9664\u53bb\u5546\u4e1a\u5b58\u50a8\u8bbe\u5907\u7684\u9009\u62e9\u5916\uff0cbcache\u548cfscache\u8ba9\u6211\u4eec\u591a\u4e86\u4e00\u4e2a\u81ea\u5efa\u5b58\u50a8\u7684\u7406\u7531\u3002","title":"3.3.2. bcache"},{"location":"inthecloud/frontline-storage/#333-ssd-pci-e","text":"PCI Express SSD\u4ea7\u54c1\u901a\u5e38\u91c7\u7528\u7279\u6b8a\u7684\u9a71\u52a8\u5668\u901a\u8fc7PCI\u603b\u7ebf\u8fdb\u884c\u76f4\u63a5\u5b58\u50a8\u5668\u8bbf\u95ee(Direct Memory Access\uff0c\u7b80\u79f0DMA)\uff0c\u800c\u975e\u53ea\u662f\u5c06\u95ea\u5b58\u6216DRAM\u5185\u5b58\u5c01\u88c5\u6210SCSI\u8fde\u63a5\u7684\u786c\u76d8\u9a71\u52a8\u5668\u3002\u8fd9\u662f\u4e00\u79cd\u6bd4\u8f83\u9769\u547d\u6027\u7684\u6539\u53d8\uff0c\u5b83\u4f7f\u5f97\u968f\u673a\u8bfb\u5199\u6027\u80fd\u76f8\u6bd4\u5176\u4ed6\u5b58\u50a8\u8bbe\u5907\u90fd\u6709\u8d28\u7684\u63d0\u5347\u3002 \u5b58\u50a8\u8bbe\u5907\u8fde\u63a5\u670d\u52a1\u5668\u6709\u4ee5\u4e0b\u51e0\u79cd\u5e38\u89c1\u65b9\u5f0f\uff1a PCI-E\u603b\u7ebf\u8fde\u63a5RAID\u63a7\u5236\u5668\uff0c\u518d\u8fde\u63a5SAS\u6216SATA\u786c\u76d8\u3002 \u901a\u8fc7PCI-E\u603b\u7ebf\u8fde\u63a5HBA\u5361\uff0c\u518d\u8fde\u63a5\u5230\u78c1\u76d8\u9635\u5217\u3002 SSD\u6302\u8f7d\u5230PCI-E SSD\u5361\uff0c\u518d\u6302\u5230PCIe\u63d2\u69fd\u3002 \u6211\u4eec\u53ef\u4ee5\u770b\u5230CPU\u901a\u8fc7PCI-E SSD\u5361\u63d0\u4f9b\u7684\u77ed\u8def\u5f84\u6765\u8bbf\u95eeSSD\uff0c\u7ed3\u5408flash\u7684\u9ad8\u901f\u8bfb\u5199\u6027\u80fd\uff0c\u6781\u5927\u7684\u63d0\u5347\u5b58\u50a8\u6027\u80fd\uff0c\u7a81\u7834\u5b58\u50a8I/O\u74f6\u9888\u3002 \u800c\u76ee\u524d\u5728\u684c\u9762\u4e91\u4e2d\uff0c\u8fd9\u662f\u4e00\u79cd\u5962\u4f88\u7684\u89e3\u51b3\u65b9\u6848\u3002","title":"3.3.3. SSD PCI-E \u5361"},{"location":"inthecloud/frontline-storage/#4","text":"\u4ece\u6a21\u62df\u8bd5\u9a8c\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u670d\u52a1\u5668\u8fd0\u884c\u4e00\u5b9a\u6570\u91cf\uff0820-50\uff09\u7684\u865a\u62df\u684c\u9762\u4e0b\u7684\u5b58\u50a8I/O\u8d1f\u8f7d\uff0c\u4e86\u89e3\u5230\u684c\u9762\u5728\u542f\u52a8\u65f6\u7684\u8bfb\u5199\u8bf7\u6c42\u5206\u5e03\u72b6\u51b5\uff0c\u800c\u540e\u6211\u4eec\u518d\u6839\u636e\u5b9e\u9a8c\u7ed3\u679c\u63d0\u51fa\u684c\u9762\u529f\u80fd\u7684\u7b80\u5355\u4f18\u5316\u7b56\u7565\u3002 \u603b\u4e4b\uff0c\u76ee\u524d\u8981\u5b8c\u5168\u907f\u514d\u542f\u52a8\u98ce\u66b4\u3001\u767b\u5f55\u98ce\u66b4\u9700\u8981\u8f83\u5927\u7684\u6210\u672c\u6295\u5165\uff0c\u800c\u5728\u79c1\u6709\u684c\u9762\u4e91\u4e2d\uff0c\u6211\u4eec\u6700\u597d\u5408\u7406\u89c4\u5212\u5b58\u50a8\u4ee5\u51cf\u5c11\u98ce\u66b4\u5e26\u6765\u7684\u5f71\u54cd\u3002 \u5bf9\u4e8e\u8bfb\u8005\u6765\u8bf4\uff0c\u627e\u5230\u5408\u9002\u7684\u5c31\u597d\uff0c\u6bd5\u7adf\u67b6\u6784\u6ca1\u6709\u5b8c\u7f8e\u7684\uff0c\u90fd\u662f\u5728\u7ecf\u9a8c\u4e2d\u8fdb\u5316\u7684\u3002","title":"4. \u603b\u7ed3"}]}