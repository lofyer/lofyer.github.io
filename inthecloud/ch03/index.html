<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=lofyer><link href=https://docs.lofyer.org/inthecloud/ch03/ rel=canonical><link rel=icon href=../../images/favicon.ico><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.4"><title>第三章 合适的虚拟化平台 - Lofyer's Docs</title><link rel=stylesheet href=../../assets/stylesheets/main.bb3983ee.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.e6a45f82.min.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title="Lofyer's Docs" class="md-header__button md-logo" aria-label="Lofyer's Docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lofyer's Docs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 第三章 合适的虚拟化平台 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../datanote/ class=md-tabs__link> DataNote </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> InTheCloud </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Lofyer's Docs" class="md-nav__button md-logo" aria-label="Lofyer's Docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Lofyer's Docs </label> <div class=md-nav__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <div class="md-nav__link md-nav__link--index "> <a href=../../datanote/ >DataNote</a> <label for=__nav_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=DataNote data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> DataNote </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../datanote/ch01/ class=md-nav__link> 第一章 数据收集、统计 </a> </li> <li class=md-nav__item> <a href=../../datanote/ch02/ class=md-nav__link> 第二章 机器学习基础 </a> </li> <li class=md-nav__item> <a href=../../datanote/ch03/ class=md-nav__link> 第三章 ABM建模基础 </a> </li> <li class=md-nav__item> <a href=../../datanote/ch04/ class=md-nav__link> 第四章 数据处理平台 </a> </li> <li class=md-nav__item> <a href=../../datanote/ch05/ class=md-nav__link> 第五章 外汇交易基础 </a> </li> <li class=md-nav__item> <a href=../../datanote/ch06/ class=md-nav__link> 第六章 信号交易系统 </a> </li> <li class=md-nav__item> <a href=../../datanote/ch07/ class=md-nav__link> 第七章 指导白皮书 </a> </li> <li class=md-nav__item> <a href=../../datanote/ch08/ class=md-nav__link> 第八章 代理人模型 </a> </li> <li class=md-nav__item> <a href=../../datanote/about/ class=md-nav__link> 关于 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__link--index "> <a href=../ >InTheCloud</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=InTheCloud data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> InTheCloud </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ch01/ class=md-nav__link> 第一章 随便说些什么 </a> </li> <li class=md-nav__item> <a href=../ch02/ class=md-nav__link> 第二章 一个可靠的存储后端 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 第三章 合适的虚拟化平台 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 第三章 合适的虚拟化平台 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#31 class=md-nav__link> 3.1 虚拟化平台简介 </a> <nav class=md-nav aria-label="3.1 虚拟化平台简介"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ovirt class=md-nav__link> oVirt </a> </li> <li class=md-nav__item> <a href=#openstack class=md-nav__link> OpenStack </a> </li> <li class=md-nav__item> <a href=#cloudstack class=md-nav__link> CloudStack </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#32-ovirt class=md-nav__link> 3.2 搭建 oVirt 管理引擎 </a> <nav class=md-nav aria-label="3.2 搭建 oVirt 管理引擎"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 系统准备 </a> </li> <li class=md-nav__item> <a href=#repo class=md-nav__link> 添加 repo </a> </li> <li class=md-nav__item> <a href=#ovirt_1 class=md-nav__link> 搭建普通 oVirt 虚拟化平台 </a> </li> <li class=md-nav__item> <a href=#ovirthosted-engine class=md-nav__link> 搭建管理端高可用 oVirt（hosted engine） </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ch04/ class=md-nav__link> 第四章 数据抓取与机器学习算法 </a> </li> <li class=md-nav__item> <a href=../ch05/ class=md-nav__link> 第五章 数据处理平台 </a> </li> <li class=md-nav__item> <a href=../appendix01/ class=md-nav__link> 附录一 OpenStack概念、部署、与高级网络应用 </a> </li> <li class=md-nav__item> <a href=../appendix02/ class=md-nav__link> 附录二 公有云参考 </a> </li> <li class=md-nav__item> <a href=../appendix03/ class=md-nav__link> 附录三 PaaS/OpenShif </a> </li> <li class=md-nav__item> <a href=../appendix04/ class=md-nav__link> 附录四 Docker 使用及自建repo </a> </li> <li class=md-nav__item> <a href=../appendix05/ class=md-nav__link> 附录五 常用功能运维工具 </a> </li> <li class=md-nav__item> <a href=../appendix06/ class=md-nav__link> 附录六 文档参考资源以及建议书单 </a> </li> <li class=md-nav__item> <a href=../appendix07/ class=md-nav__link> 待整理扩展内容 </a> </li> <li class=md-nav__item> <a href=../about/ class=md-nav__link> 关于作者与文档 </a> </li> <li class=md-nav__item> <a href=../frontline-network/ class=md-nav__link> 《运维前线》私有云桌面网络组建草稿 </a> </li> <li class=md-nav__item> <a href=../frontline-storage/ class=md-nav__link> 《运维前线》虚拟化存储启动风暴草稿 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#31 class=md-nav__link> 3.1 虚拟化平台简介 </a> <nav class=md-nav aria-label="3.1 虚拟化平台简介"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ovirt class=md-nav__link> oVirt </a> </li> <li class=md-nav__item> <a href=#openstack class=md-nav__link> OpenStack </a> </li> <li class=md-nav__item> <a href=#cloudstack class=md-nav__link> CloudStack </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#32-ovirt class=md-nav__link> 3.2 搭建 oVirt 管理引擎 </a> <nav class=md-nav aria-label="3.2 搭建 oVirt 管理引擎"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 系统准备 </a> </li> <li class=md-nav__item> <a href=#repo class=md-nav__link> 添加 repo </a> </li> <li class=md-nav__item> <a href=#ovirt_1 class=md-nav__link> 搭建普通 oVirt 虚拟化平台 </a> </li> <li class=md-nav__item> <a href=#ovirthosted-engine class=md-nav__link> 搭建管理端高可用 oVirt（hosted engine） </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=_1>第三章 合适的虚拟化平台</h1> <h2 id=31>3.1 虚拟化平台简介</h2> <p>Welcome to the core!</p> <p>嗯，笔者撸了个 OpenStack 和 k8s 的部署 <a href=https://github.com/lofyer/openstack-pxe-deployment>脚本</a> ，PXE 哦。</p> <p>云计算目前主流实现有 SaaS（Software-as-a-service）、PaaS（Platform-as-a-service）和 IaaS（Infrastructure-as-a-service）。IaaS 和 PaaS 都算作基础件，SaaS 可以与基础件自由组合或者单独使用。</p> <p>虚拟化技术已经很受重视而且被推到了一个浪尖。如今诸多开源虚拟化平台，比如 XenServer、CloudStack、OpenStack、Eucalyptus、oVirt、OpenVZ、Docker、LXC 等，我们都看花了眼，些许慌乱不知哪个适合自己了。</p> <p>各平台实现方式：全虚拟化，半虚拟化，应用虚拟化。</p> <p>IaaS 云计算平台，综合来说具有以下特性：</p> <ul> <li>虚拟化：虚拟化作为云计算平台的核心，是资源利用的主要形式之一。网络、存储、CPU 乃至 GPU 等主要通过虚拟主机进行实体化。</li> <li>分布式：分布式可利用共享的存储，通过网络将资源进行整合，是实现资源化的必备条件。</li> <li>高可用：于规模庞大的云平台，提供存储、管理节点、重要服务的高度可用性是十分必要的。笔者在写这篇文章时，oVirt 3.4 已经可以做到管理节点的高度可用。</li> <li>兼容性：云计算平台众多，各家有各家的特点，同一数据中心部署不同的平台的可能性极大，因此，主要服务（比如虚拟网络、存储、虚机等）要有一定兼容性，比如 oVirt 可以利用 OpenStack 的 Nouveau 提供的虚拟网络、Foreman 可以方便地在 oVirt 上部署新机器等。另外，也有 DeltaCloud、libvirt 等 API，用户可以利用它们自由地实现自己的云综合管理工具。</li> <li>资源池化：网络、存储、CPU 或者 GPU 可以综合或者单独划分资源池，通过配额进行分配，从而保证其合理利用。</li> <li>安全性：现代企业对于安全性的要求已经十分苛刻，除去传统数据加密、访问控制，甚至对于社会工程也要有一定防护能力；用户数据具有对非企业管理员具有防护性能，即使将虚拟机磁盘文件拷贝出来也不能直接获取其内容。</li> <li>需求导向性：在计算水平上，优质资源最先提供给重要服务；服务水平上，平台具有可定制能力。</li> </ul> <h3 id=ovirt>oVirt</h3> <p>oVirt 目前两种部署方式：</p> <table> <thead> <tr> <th>部署方式</th> <th>示例</th> </tr> </thead> <tbody> <tr> <td>管理独占一台物理机</td> <td>.. image:: ../images/03-01.png</td> </tr> <tr> <td>高可用管理引擎</td> <td>.. image:: ../images/03-02.png</td> </tr> </tbody> </table> <div class="admonition note"> <p class=admonition-title>常见名次</p> <p><strong>管理引擎（engine）</strong>：提供平台 web 管理、api，各种扩展服务，vdsm 以及 libvirt 服务的重要节点。</p> <p><strong>宿主机（node/host）</strong>：为平台的的功能提供支持，主要是虚拟化能力。</p> <p><strong>数据中心（data center）</strong>：以数据共享方式（Shared/Local）划分的容器，可以包含多个集群。</p> <p><strong>存储域（storage domain）</strong>：平台所依赖的各种存储空间。</p> <p><strong>逻辑网络（logic network）</strong>：物理网络或者虚拟网络的抽象代表。</p> <p><strong>池（pool）</strong>：用于批量创建虚拟机。</p> <p><strong>集群策略（cluster policy）</strong>：宿主机/虚拟机运行或者迁移时所遵循的原则。</p> <p><strong>DWH/Reports</strong>：可以查看当前状态报告（需要 ovirt-engine-reports）。</p> <p><strong>可信服务</strong>： 需要 OpenAttestation 。</p> <p><strong>电源管理</strong>： 如果没有物理电源控制器，可以直接指定某一台主机为代理机，以构建更稳健的集群。</p> </div> <h3 id=openstack>OpenStack</h3> <p>OpenStack 云计算中引入的概念已经先入为主，让国内许多较晚接触云计算的人认为这就是标准概念。</p> <p>更多内容请参考附录一。</p> <h3 id=cloudstack>CloudStack</h3> <p>可能也不错，我没用过。</p> <h2 id=32-ovirt>3.2 搭建 oVirt 管理引擎</h2> <p>搭建 oVirt 平台的步骤：</p> <ol> <li>安装 Redhat 类操作系统（Redhat、CentOS、Fedora）</li> <li>从 yum 安装 oVirt，并执行 engine-setup，或者直接从 oVirt 提供的 <a href=http://plain.resources.ovirt.org/releases/3.4/iso/ovirt-live-3.4.0.el6ev.iso>iso</a> 进行安装</li> <li>添加宿主机</li> <li>添加存储域</li> <li>创建虚拟机</li> </ol> <h3 id=_2>系统准备</h3> <p>所有机器的 SELINUX 都设置为 permissive。</p> <blockquote> <p><em>/etc/selinux/config</em></p> </blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>SELINUX=permissive
</code></pre></div> </td></tr></table> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># setenfoce permissive
</code></pre></div> </td></tr></table> <p>如有需要，清除 iptables 规则。</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># iptables -F
# service iptables save
</code></pre></div> </td></tr></table> <p>每台机器上都要添加作为虚拟机运行的 engine 的 FQDN，此处为 ha.example.com。</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># echo -e &#39;192.168.10.100\tha.example.com&#39; &gt;&gt; /etc/hosts
</code></pre></div> </td></tr></table> <p>存储可以使用之前的 glusterfs，方式为 NFS_V3，注意将 brick 的权限设置为 vdsm.kvm 或者 36:36。</p> <p>:::{note}</p> <p><strong>普通 NFS 服务器设置</strong></p> <p>因为考虑到 NFS4 的权限配置较为复杂，推荐 NFS 使用 V3，修改 nfsmount.conf 中的 Version 为 3。</p> <p>:::</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># gluster volume create gluster-vol1 replica 2 \
gs1.example.com:/gluster_brick0 gs2.example.com:/gluster_brick0 \
gs3.example.com:/gluster_brick0 gs4.example.com:/gluster_brick0 \
gs1.example.com:/gluster_brick1 gs2.example.com:/gluster_brick1 \
gs3.example.com:/gluster_brick1 gs4.example.com:/gluster_brick1 force
</code></pre></div> </td></tr></table> <p>由于管理端以及节点的网络服务依赖于 <strong>network</strong> 而非 <strong>NetworkManager</strong> ，我们需要启用前者禁用后者，在每一台服务器上都进行如下类似配置修改网络。</p> <blockquote> <p><em>/etc/sysconfig/network-scripts/ifcfg-eth0</em></p> </blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>NAME=eth0
DEVICE=eth0
ONBOOT=yes
BOOTPROTO=static
# 注意修改此处的IP
IPADDR=192.168.10.101
NETMASK=255.255.255.0
GATEWAY=192.168.10.1
DNS1=192.168.10.1
</code></pre></div> </td></tr></table> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># chkconfig NetworkManager off
# chkconfig network on
# service NetworkManager stop; service network restart
</code></pre></div> </td></tr></table> <h3 id=repo>添加 repo</h3> <p>:::{note}</p> <p><strong>oVirt3.4.2 特别说明</strong></p> <p>2014 年六七月的初次安装 oVirt 的用户可能会遇到添加宿主机失败的问题，暂时解决办法为卸载 python-pthreading-0.1.3-1 及以后的版本，安装老版本，比如 <a href=ftp://ftp.icm.edu.pl/vol/rzm2/linux-fedora/linux/epel/6/i386/python-pthreading-0.1.3-0.el6.noarch.rpm>ftp://ftp.icm.edu.pl/vol/rzm2/linux-fedora/linux/epel/6/i386/python-pthreading-0.1.3-0.el6.noarch.rpm</a> ，再尝试安装 vdsm 并添加宿主机。</p> <p>:::</p> <p>使用 rpm：</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># yum localinstall http://plain.resources.ovirt.org/releases/ovirt-release/ovirt-release34.rpm
# yum install ovirt-hosted-engine-setup
</code></pre></div> </td></tr></table> <p>或者手动添加：</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>[ovirt-stable]
name=Latest oVirt Releases
baseurl=http://resources.ovirt.org/releases/stable/rpm/EL/$releasever/
enabled=1
skip_if_unavailable=1
gpgcheck=0

[ovirt-3.4-stable]
name=Latest oVirt 3.4.z Releases
baseurl=http://resources.ovirt.org/releases/3.4/rpm/EL/$releasever/
enabled=1
skip_if_unavailable=1
gpgcheck=0

[epel]
name=Extra Packages for Enterprise Linux 6 - $basearch
#baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch
mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&amp;arch=$basearch
failovermethod=priority
enabled=1
gpgcheck=0

[ovirt-glusterfs-epel]
name=GlusterFS is a clustered file-system capable of scaling to several petabytes.
baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/$basearch/
enabled=1
skip_if_unavailable=1
gpgcheck=0

[ovirt-glusterfs-noarch-epel]
name=GlusterFS is a clustered file-system capable of scaling to several petabytes.
baseurl=http://download.gluster.org/pub/gluster/glusterfs/LATEST/EPEL.repo/epel-$releasever/noarch
enabled=1
skip_if_unavailable=1
gpgcheck=0
</code></pre></div> </td></tr></table> <p><strong>从下面两种方式中选择之一进行搭建</strong></p> <p>{ref}<code>label2</code></p> <p>{ref}<code>label3</code></p> <p>(label2)=</p> <h3 id=ovirt_1>搭建普通 oVirt 虚拟化平台</h3> <p>笔者写此文时 oVirt 已经更新到 3.4。</p> <p>在此，我们会用到之前创建的 distributed-replicated 存储，这样可用保证系统服务的高度可用性有所提高。</p> <p>对于初次使用 oVirt 的用户，建议使用此种搭建方式，<strong>太折腾的话就吓走好多目标读者了</strong> 。</p> <p>使用之前的四台机器，分别为 gs1.example.com，gs2.example.com，gs3.example.com 和 gs4.example.com，其中，将 gs1 作为管理机安装 ovirt-engine，其余三台作为节点（node），存储使用已经创建好的 glusterfs。</p> <p>```{image} ../images/03-03.png :align: center</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>  1</span>
<span class=normal>  2</span>
<span class=normal>  3</span>
<span class=normal>  4</span>
<span class=normal>  5</span>
<span class=normal>  6</span>
<span class=normal>  7</span>
<span class=normal>  8</span>
<span class=normal>  9</span>
<span class=normal> 10</span>
<span class=normal> 11</span>
<span class=normal> 12</span>
<span class=normal> 13</span>
<span class=normal> 14</span>
<span class=normal> 15</span>
<span class=normal> 16</span>
<span class=normal> 17</span>
<span class=normal> 18</span>
<span class=normal> 19</span>
<span class=normal> 20</span>
<span class=normal> 21</span>
<span class=normal> 22</span>
<span class=normal> 23</span>
<span class=normal> 24</span>
<span class=normal> 25</span>
<span class=normal> 26</span>
<span class=normal> 27</span>
<span class=normal> 28</span>
<span class=normal> 29</span>
<span class=normal> 30</span>
<span class=normal> 31</span>
<span class=normal> 32</span>
<span class=normal> 33</span>
<span class=normal> 34</span>
<span class=normal> 35</span>
<span class=normal> 36</span>
<span class=normal> 37</span>
<span class=normal> 38</span>
<span class=normal> 39</span>
<span class=normal> 40</span>
<span class=normal> 41</span>
<span class=normal> 42</span>
<span class=normal> 43</span>
<span class=normal> 44</span>
<span class=normal> 45</span>
<span class=normal> 46</span>
<span class=normal> 47</span>
<span class=normal> 48</span>
<span class=normal> 49</span>
<span class=normal> 50</span>
<span class=normal> 51</span>
<span class=normal> 52</span>
<span class=normal> 53</span>
<span class=normal> 54</span>
<span class=normal> 55</span>
<span class=normal> 56</span>
<span class=normal> 57</span>
<span class=normal> 58</span>
<span class=normal> 59</span>
<span class=normal> 60</span>
<span class=normal> 61</span>
<span class=normal> 62</span>
<span class=normal> 63</span>
<span class=normal> 64</span>
<span class=normal> 65</span>
<span class=normal> 66</span>
<span class=normal> 67</span>
<span class=normal> 68</span>
<span class=normal> 69</span>
<span class=normal> 70</span>
<span class=normal> 71</span>
<span class=normal> 72</span>
<span class=normal> 73</span>
<span class=normal> 74</span>
<span class=normal> 75</span>
<span class=normal> 76</span>
<span class=normal> 77</span>
<span class=normal> 78</span>
<span class=normal> 79</span>
<span class=normal> 80</span>
<span class=normal> 81</span>
<span class=normal> 82</span>
<span class=normal> 83</span>
<span class=normal> 84</span>
<span class=normal> 85</span>
<span class=normal> 86</span>
<span class=normal> 87</span>
<span class=normal> 88</span>
<span class=normal> 89</span>
<span class=normal> 90</span>
<span class=normal> 91</span>
<span class=normal> 92</span>
<span class=normal> 93</span>
<span class=normal> 94</span>
<span class=normal> 95</span>
<span class=normal> 96</span>
<span class=normal> 97</span>
<span class=normal> 98</span>
<span class=normal> 99</span>
<span class=normal>100</span>
<span class=normal>101</span>
<span class=normal>102</span>
<span class=normal>103</span>
<span class=normal>104</span>
<span class=normal>105</span>
<span class=normal>106</span>
<span class=normal>107</span>
<span class=normal>108</span>
<span class=normal>109</span>
<span class=normal>110</span>
<span class=normal>111</span>
<span class=normal>112</span>
<span class=normal>113</span>
<span class=normal>114</span>
<span class=normal>115</span>
<span class=normal>116</span>
<span class=normal>117</span>
<span class=normal>118</span>
<span class=normal>119</span>
<span class=normal>120</span>
<span class=normal>121</span>
<span class=normal>122</span>
<span class=normal>123</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>在 gs1 上运行如下命令。

```{code}

# yum install ovirt-engine
# engine-setup --offline
[ INFO  ] Stage: Initializing
[ INFO  ] Stage: Environment setup
          Configuration files: [&#39;/etc/ovirt-engine-setup.conf.d/10-packaging.conf&#39;]
          Log file: /var/log/ovirt-engine/setup/ovirt-engine-setup-20140508054649.log
          Version: otopi-1.2.0 (otopi-1.2.0-1.el6)
[ INFO  ] Stage: Environment packages setup
[ INFO  ] Stage: Programs detection
[ INFO  ] Stage: Environment setup
[ INFO  ] Stage: Environment customization

          --== PRODUCT OPTIONS ==--


          --== PACKAGES ==--


          --== NETWORK CONFIGURATION ==--

          Host fully qualified DNS name of this server [gs1.example.com]:
          Setup can automatically configure the firewall on this system.
          Note: automatic configuration of the firewall may overwrite current settings.
          Do you want Setup to configure the firewall? (Yes, No) [Yes]:
          The following firewall managers were detected on this system: iptables
          Firewall manager to configure (iptables): iptables
[ INFO  ] iptables will be configured as firewall manager.

          --== DATABASE CONFIGURATION ==--

          Where is the Engine database located? (Local, Remote) [Local]:
          Setup can configure the local postgresql server automatically for the engine to run. This may conflict with existing applications.
          Would you like Setup to automatically configure postgresql and create Engine database, or prefer to perform that manually? (Automatic, Manual) [Automatic]:

          --== OVIRT ENGINE CONFIGURATION ==--

          Application mode (Both, Virt, Gluster) [Both]:
          Default storage type: (NFS, FC, ISCSI, POSIXFS) [NFS]:
          Engine admin password:
          Confirm engine admin password:

          --== PKI CONFIGURATION ==--

          Organization name for certificate [example.com]:

          --== APACHE CONFIGURATION ==--

          Setup can configure apache to use SSL using a certificate issued from the internal CA.
          Do you wish Setup to configure that, or prefer to perform that manually? (Automatic, Manual) [Automatic]:
          Setup can configure the default page of the web server to present the application home page. This may conflict with existing applications.
          Do you wish to set the application as the default page of the web server? (Yes, No) [Yes]:

          --== SYSTEM CONFIGURATION ==--

          Configure WebSocket Proxy on this machine? (Yes, No) [Yes]:
          Configure an NFS share on this server to be used as an ISO Domain? (Yes, No) [Yes]: no

          --== MISC CONFIGURATION ==--


          --== END OF CONFIGURATION ==--

[ INFO  ] Stage: Setup validation

          --== CONFIGURATION PREVIEW ==--

          Engine database name                    : engine
          Engine database secured connection      : False
          Engine database host                    : localhost
          Engine database user name               : engine
          Engine database host name validation    : False
          Engine database port                    : 5432
          PKI organization                        : example.com
          Application mode                        : both
          Firewall manager                        : iptables
          Update Firewall                         : True
          Configure WebSocket Proxy               : True
          Host FQDN                               : gs1.example.com
          Datacenter storage type                 : nfs
          Configure local Engine database         : True
          Set application as default page         : True
          Configure Apache SSL                    : True

          Please confirm installation settings (OK, Cancel) [OK]: ok
[ INFO  ] Stage: Transaction setup
[ INFO  ] Stopping engine service
[ INFO  ] Stopping websocket-proxy service
[ INFO  ] Stage: Misc configuration
[ INFO  ] Stage: Package installation
[ INFO  ] Stage: Misc configuration
[ INFO  ] Initializing PostgreSQL
[ INFO  ] Creating PostgreSQL &#39;engine&#39; database
[ INFO  ] Configuring PostgreSQL
[ INFO  ] Creating Engine database schema
[ INFO  ] Creating CA
[ INFO  ] Configuring WebSocket Proxy
[ INFO  ] Generating post install configuration file &#39;/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf&#39;
[ INFO  ] Stage: Transaction commit
[ INFO  ] Stage: Closing up

          --== SUMMARY ==--

          SSH fingerprint: 1B:FD:08:A2:FD:83:20:8A:65:F5:0D:F6:CB:BF:46:C7
          Internal CA 28:7E:D6:6B:F7:F2:6C:B5:60:27:44:C3:7F:3C:22:63:E5:68:DD:F4
          Web access is enabled at:
              http://gs1.example.com:80/ovirt-engine
              https://gs1.example.com:443/ovirt-engine
          Please use the user &quot;admin&quot; and password specified in order to login into oVirt Engine

          --== END OF SUMMARY ==--

[ INFO  ] Starting engine service
[ INFO  ] Restarting httpd
[ INFO  ] Generating answer file &#39;/var/lib/ovirt-engine/setup/answers/20140508054842-setup.conf&#39;
[ INFO  ] Stage: Clean up
          Log file is located at /var/log/ovirt-engine/setup/ovirt-engine-setup-20140508054649.log
[ INFO  ] Stage: Pre-termination
[ INFO  ] Stage: Termination
[ INFO  ] Execution of setup completed successfully
</code></pre></div> </td></tr></table> <p>至此，管理节点安装结束，参考 {ref}<code>label1</code> 加入节点以及存储域。</p> <p>(label3)=</p> <h3 id=ovirthosted-engine>搭建管理端高可用 oVirt（hosted engine）</h3> <p>高可用，我们可以这么划分：</p> <ul> <li>存储的高可用：传统存储使用 DRBD/Heartbeat 或者独立的存储设备保证高可用，在灵活性、可扩展性、成本上都有一定局限。在与主机同台使用 Ceph 或者 Glusterfs 可以较好地保证资源充分利用地同时，又满足了高度可用的要求。</li> <li>管理高可用：因为比如 oVirt、OpenStack 这种拥有大型数据库的设施不像存储设施那样高效的同步，需要独立的管理运行在集群中的某一台机器上来同步集群消息，所以，管理端的高可用也是十分必要的。</li> <li>虚拟机/服务高可用：虚拟机在宕机时可自动重启，在主机资源紧张时可用迁移到其他负载较低的主机上，从而保证服务的质量以及连续性。</li> </ul> <p>```{image} ../images/03-03.png :align: center</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>```{eval-rst}
.. epigraph::

    1. 宿主机的CPU架构建议选择Westmere（Westmere E56xx/L56xx/X56xx）、Nehalem（Intel Core i7 9xx）、Penryn（Intel Core 2 Duo P9xxx）或者Conroe（Intel Celeron_4x0）中的之一。

    CPU Family table 参阅
        `Intel Architecture and Processor Identification With CPUID Model and Family Numbers &lt;https://software.intel.com/en-us/articles/intel-architecture-and-processor-identification-with-cpuid-model-and-family-numbers&gt;`_

    2. 建议参考第11节提前安装含有oVirt管理的虚拟机，硬盘格式为RAW，从而在安装管理机时作为OVF导入或者覆盖虚拟磁盘，减少失败风险时间。
</code></pre></div> </td></tr></table> <p>安装 ovirt-hosted-engine-setup，并回答一些问题，注意高亮部分：</p> <p>```{code-block} bash :emphasize-lines: 21,36,123,138-144,150,166,173</p> <h1 id=hosted-engine-deploy>hosted-engine --deploy</h1> <p>[ INFO ] Stage: Initializing Continuing will configure this host for serving as hypervisor and create a VM where you have to install oVirt Engine afterwards. Are you sure you want to continue? (Yes, No)[Yes]: yes [ INFO ] Generating a temporary VNC password. [ INFO ] Stage: Environment setup Configuration files: [] Log file: /var/log/ovirt-hosted-engine-setup/ovirt-hosted-engine-setup-20140508182241.log Version: otopi-1.2.0 (otopi-1.2.0-1.el6) [ INFO ] Hardware supports virtualization [ INFO ] Bridge ovirtmgmt already created [ INFO ] Stage: Environment packages setup [ INFO ] Stage: Programs detection [ INFO ] Stage: Environment setup [ INFO ] Stage: Environment customization</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>      --== STORAGE CONFIGURATION ==--

      During customization use CTRL-D to abort.
      Please specify the storage you would like to use (nfs3, nfs4)[nfs3]:
</code></pre></div> </td></tr></table> <h1 id=hosted-engine>此处的存储域只存储hosted-engine的相关文件，不作为主数据域</h1> <h1 id=glusternfslocalhostdata>建议挂载gluster的nfs时使用localhost:data形式</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>      Please specify the full shared storage connection path to use (example: host:/path): 192.168.10.101:/gluster-vol1/ovirt_data/hosted_engine
</code></pre></div> </td></tr></table> <p>[ INFO ] Installing on first host Please provide storage domain name. [hosted_storage]: Local storage datacenter name is an internal name and currently will not be shown in engine's admin UI.Please enter local datacenter name [hosted_datacenter]:</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>      --== SYSTEM CONFIGURATION ==--


      --== NETWORK CONFIGURATION ==--

      iptables was detected on your computer, do you wish setup to configure it? (Yes, No)[Yes]: no
      Please indicate a pingable gateway IP address [192.168.10.1]:

      --== VM CONFIGURATION ==--
</code></pre></div> </td></tr></table> <h1 id=engine>虚拟engine的安装方式</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>      Please specify the device to boot the VM from (cdrom, disk, pxe) [cdrom]:
      The following CPU types are supported by this host:
              - model_Conroe: Intel Conroe Family
      Please specify the CPU type to be used by the VM [model_Conroe]:
      Please specify path to installation media you would like to use [None]: /tmp/centos.iso
      Please specify the number of virtual CPUs for the VM [Defaults to minimum requirement: 2]:
      Please specify the disk size of the VM in GB [Defaults to minimum requirement: 25]:
      You may specify a MAC address for the VM or accept a randomly generated default [00:16:3e:59:9b:e2]:
      Please specify the memory size of the VM in MB [Defaults to minimum requirement: 4096]: 4096
      Please specify the console type you would like to use to connect to the VM (vnc, spice) [vnc]:

      --== HOSTED ENGINE CONFIGURATION ==--

      Enter the name which will be used to identify this host inside the Administrator Portal [hosted_engine_1]:
      Enter &#39;admin@internal&#39; user password that will be used for accessing the Administrator Portal:
      Confirm &#39;admin@internal&#39; user password:
      Please provide the FQDN for the engine you would like to use.
      This needs to match the FQDN that you will use for the engine installation within the VM.
      Note: This will be the FQDN of the VM you are now going to create,
      it should not point to the base host or to any other existing machine.
      Engine FQDN: ha.example.com
</code></pre></div> </td></tr></table> <p>[WARNING] Failed to resolve ha.example.com using DNS, it can be resolved only locally Please provide the name of the SMTP server through which we will send notifications [localhost]: Please provide the TCP port number of the SMTP server [25]: Please provide the email address from which notifications will be sent [root@localhost]: Please provide a comma-separated list of email addresses which will get notifications [root@localhost]: [ INFO ] Stage: Setup validation</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>      --== CONFIGURATION PREVIEW ==--

      Engine FQDN                        : ha.example.com
      Bridge name                        : ovirtmgmt
      SSH daemon port                    : 22
      Gateway address                    : 192.168.10.1
      Host name for web application      : hosted_engine_1
      Host ID                            : 1
      Image size GB                      : 25
      Storage connection                 : 192.168.10.101:/gluster-vol1/ovirt_data/hosted_data/
      Console type                       : vnc
      Memory size MB                     : 4096
      MAC address                        : 00:16:3e:59:9b:e2
      Boot type                          : cdrom
      Number of CPUs                     : 2
      ISO image (for cdrom boot)         : /tmp/centos.iso
      CPU Type                           : model_Conroe

      Please confirm installation settings (Yes, No)[No]: yes
</code></pre></div> </td></tr></table> <p>[ INFO ] Generating answer file '/etc/ovirt-hosted-engine/answers.conf' [ INFO ] Stage: Transaction setup [ INFO ] Stage: Misc configuration [ INFO ] Stage: Package installation [ INFO ] Stage: Misc configuration [ INFO ] Configuring libvirt [ INFO ] Configuring VDSM [ INFO ] Starting vdsmd [ INFO ] Waiting for VDSM hardware info [ INFO ] Waiting for VDSM hardware info [ INFO ] Waiting for VDSM hardware info [ INFO ] Waiting for VDSM hardware info [ INFO ] Creating Storage Domain [ INFO ] Creating Storage Pool [ INFO ] Connecting Storage Pool [ INFO ] Verifying sanlock lockspace initialization [ INFO ] Initializing sanlock lockspace [ INFO ] Initializing sanlock metadata [ INFO ] Creating VM Image [ INFO ] Disconnecting Storage Pool [ INFO ] Start monitoring domain [ INFO ] Configuring VM [ INFO ] Updating hosted-engine configuration [ INFO ] Stage: Transaction commit [ INFO ] Stage: Closing up The following network ports should be opened: tcp:5900 tcp:5901 udp:5900 udp:5901 An example of the required configuration for iptables can be found at: /etc/ovirt-hosted-engine/iptables.example In order to configure firewalld, copy the files from /etc/ovirt-hosted-engine/firewalld to /etc/firewalld/services and execute the following commands: firewall-cmd -service hosted-console [ INFO ] Creating VM You can now connect to the VM with the following command: /usr/bin/remote-viewer vnc://localhost:5900 Use temporary password "2067OGHU" to connect to vnc console. Please note that in order to use remote-viewer you need to be able to run graphical applications. This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding). Otherwise you can run the command from a terminal in your preferred desktop environment. If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command: virsh -c qemu+tls://192.168.1.150/system console HostedEngine If you need to reboot the VM you will need to start it manually using the command: hosted-engine --vm-start You can then set a temporary password using the command: hosted-engine --add-console-password The VM has been started. Install the OS and shut down or reboot it. To continue please make a selection:</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>      (1) Continue setup - VM installation is complete
      (2) Reboot the VM and restart installation
      (3) Abort setup
</code></pre></div> </td></tr></table> <h1 id=terminal>需要在另外一个有图形能力的terminal中运行</h1> <h1 id=remote-viewer-vnc192168101015900>"remote-viewer vnc://192.168.10.101:5900"连接虚拟机。</h1> <h1 id=engine-setup>完成engine-setup后关闭虚拟机；可以在虚拟机运行状态下执行</h1> <h1 id=hosted-engine-add-console-password>"hosted-engine --add-console-password"更换控制台密码。</h1> <h1 id=cdromgs1engine>如果之前选择cdrom进行安装的话，此处可以在gs1上用已经安装好engine的</h1> <h1 id=_3>虚拟磁盘进行覆盖，类似</h1> <h1 id=mount-t-nfs-1921681010119216810101gluster-vol1ovirt_datahosted_data-mnt-mv-engine-diskraw-mntovirt_datahosted_datavm_uuid>"mount -t nfs 192.168.10.101:192.168.10.101:/gluster-vol1/ovirt_data/hosted_data/ /mnt; mv engine-disk.raw /mnt/ovirt_data/hosted_data/.../vm_UUID"</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>      (1, 2, 3)[1]: 1
      Waiting for VM to shut down...
</code></pre></div> </td></tr></table> <p>[ INFO ] Creating VM You can now connect to the VM with the following command: /usr/bin/remote-viewer vnc://localhost:5900 Use temporary password "2067OGHU" to connect to vnc console. Please note that in order to use remote-viewer you need to be able to run graphical applications. This means that if you are using ssh you have to supply the -Y flag (enables trusted X11 forwarding). Otherwise you can run the command from a terminal in your preferred desktop environment. If you cannot run graphical applications you can connect to the graphic console from another host or connect to the console using the following command: virsh -c qemu+tls://192.168.1.150/system console HostedEngine If you need to reboot the VM you will need to start it manually using the command: hosted-engine --vm-start You can then set a temporary password using the command: hosted-engine --add-console-password Please install and setup the engine in the VM. You may also be interested in installing ovirt-guest-agent-common package in the VM. To continue make a selection from the options below: (1) Continue setup - engine installation is complete (2) Power off and restart the VM (3) Abort setup</p> <h1 id=engine-setup-offlineengine>此处参考第一次操作，连接虚拟机控制台后进行"engine-setup --offline"以安装engine</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>      (1, 2, 3)[1]: 1
</code></pre></div> </td></tr></table> <p>[ INFO ] Engine replied: DB Up!Welcome to Health Status! [ INFO ] Waiting for the host to become operational in the engine. This may take several minutes... [ INFO ] Still waiting for VDSM host to become operational... [ INFO ] The VDSM Host is now operational Please shutdown the VM allowing the system to launch it as a monitored service.</p> <h1 id=_4>到此，需要连接虚拟机控制台关闭虚拟机</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>      The system will wait until the VM is down.
</code></pre></div> </td></tr></table> <p>[ INFO ] Enabling and starting HA services Hosted Engine successfully set up [ INFO ] Stage: Clean up [ INFO ] Stage: Pre-termination [ INFO ] Stage: Termination</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>此时，运行”hosted-engine –vm-start”以启动虚拟管理机。

:::{note}

1. 若要重新部署

# vdsClient -s 0 list

# vdsClient -s 0 destroy &lt;ID of the vm you get from the first command&gt;

2. 若要添加第二台机器

# yum install ovirt-hosted-engine-setup

# hosted-engine --deploy

然后指定存储路径即可自动判断此为第 2+台机器。

:::

(label1)=

## 3.3 添加节点以及存储域

你看到这的话应该已经有了一个数据中心、几个宿主机，也可能有一个虚拟机（engine），还差一个存储虚拟机镜像的地方就可以拥有基本的 oVirt 平台了。

### 添加节点（宿主机）

对于第 11 节的普通 oVirt、第 12 节的 ha 平台，你可能需要添加更多节点以支持更好的 SLA（service level agreement）。
添加节点目前有三种方式：

- 通过 oVirt 的节点 ISO 安装系统后加入。
- 直接将现有 CentOS 或者 Fedora 转化为节点（可以为当前管理机）。
- 指定使用外部提供者（Foreman）。

在此我们使用第二种方法。

```{image} ../images/03-05.png
:align: center
</code></pre></div> </td></tr></table> <h3 id=_5>添加存储域</h3> <p>存储域有 3 种，Data（数据域）、ISO（ISO 域）、Export（导出域）。</p> <p>其中，数据域是为必需，在创建任何虚拟机之前需要有一个可用的数据域用于存储虚拟磁盘以及快照文件；ISO 域中可以存放 ISO 和 VFD 格式的系统镜像或者驱动文件，可在多个数据中心间共享；导出域用于导出或导入 OVF 格式的虚机。</p> <p>而根据数据域的存储类型，我们有 5 种（NFS、POSIX 兼容、Glusterfs、iSCSI、光纤）可选，在此，选择 glusterfs 导出的 NFS。</p> <p>```{image} ../images/03-06.png :align: center</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>:::{note}

确保存储域目录被 vdsm.kvm 可读，即所有者为 36:36，或者 vdsm.kvm。
导出域在已加入数据中心后不可共享，如果它意外损坏，请参考 &lt;http://blog.lofyer.org/blog/2014/05/11/cloud-6-5-advanced-ovirt/&gt; 手动修复，或者删除 dom_md/metadata 中的 POOL_UUID 的值以及\_SHA_CKSUM 行。
若要使用 oVirt 的 gluster 支持，请安装 vdsm-gluster 包。

:::

## 3.4 连接虚拟机

虚拟机运行后，通过 web 界面，你可用使用以下几种方式连接虚拟机（可通过控制台选项进行修改）：

```{image} ../images/03-08.png
:align: center
</code></pre></div> </td></tr></table> <h3 id=spice-html5>Spice-Html5</h3> <blockquote> <p>首先在服务器端打开 spice 代理：</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># engine-setup --otopi-environment=&quot;OVESETUP_CONFIG/websocketProxyConfig=bool:True&quot; # 如果未setup或者要在其他机器setup，可做此步
# yum install -y numpy # 安装numpy以加速转换。
# engine-config -s WebSocketProxy=&quot;192.168.10.100:6100&quot;
# service ovirt-websocket-proxy restart
# service ovirt-engine restart
</code></pre></div> </td></tr></table> <p>连接之前，要信任以下两处 https 证书：</p> <blockquote> <p><a href=https://192.168.10.100>https://192.168.10.100</a></p> <p><a href=https://192.168.10.100:6100>https://192.168.10.100:6100</a></p> <p>然后点击控制台按钮即可在浏览器的新标签中打开 spice-html5 桌面。</p> </blockquote> </blockquote> <h3 id=_6>浏览器插件</h3> <blockquote> <p>对于 Redhat 系列系统，可安装 spice-xpi 插件；Windows 系统可以安装 SpiceX 的控件。</p> </blockquote> <h3 id=_7>本地客户端</h3> <blockquote> <p>访问 <a href=http://virt-manager.org/download/ >virt-manager 官网</a> 下载 virt-viewer 客户端，使用它打开下载到本地的 console.vv 文件。</p> </blockquote> <h3 id=spice-proxygateway-squid>spice proxy/gateway - squid 代理</h3> <blockquote> <p>设置 squid 代理，将所有 spice 端口代理至 3128 端口。</p> <blockquote> <blockquote> <blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>
</code></pre></div> </td></tr></table> </blockquote> </blockquote> <h1 id=yum-install-squid>yum install squid</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>修改/etc/squid/squid.conf。
</code></pre></div> </td></tr></table> <blockquote> <blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>
</code></pre></div> </td></tr></table> </blockquote> </blockquote> <h1 id=5>第 5 行</h1> <p>acl localhost src 192.168.0.150</p> <h1 id=41>第 41 行修改为</h1> <p>http_access allow CONNECT Safe_ports</p> <h1 id=acl-spice_servers-dst-19216810024>acl spice_servers dst 192.168.10.0/24</h1> <h1 id=http_access-allow-spice_servers>http_access allow spice_servers</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>启用squid服务。
</code></pre></div> </td></tr></table> <blockquote> <blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>
</code></pre></div> </td></tr></table> </blockquote> </blockquote> <h1 id=chkconfig-squid-on>chkconfig squid on</h1> <h1 id=service-squid-restart>service squid restart</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>设置engine的SpiceProxy
</code></pre></div> </td></tr></table> <blockquote> <blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>
</code></pre></div> </td></tr></table> </blockquote> </blockquote> <h1 id=engine-config-s-spiceproxydefaulthttpfqdnor-ip3128>engine-config -s SpiceProxyDefault="http://FQDN<em>or</em>外网 IP:3128"</h1> <h1 id=service-ovirt-engine-restart>service ovirt-engine restart</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>可通过集群设置中设置所有宿主机的Spice代理，或者在虚拟机设置中单一设置某台虚拟机通过代理访问。
</code></pre></div> </td></tr></table> </blockquote> </blockquote> <h3 id=rdp-windows-ie>RDP 插件（仅适用于 Windows 虚机及 IE 浏览器）</h3> <blockquote> <p>如果虚拟机的操作系统选择为 Windows，并且内部启动了远程桌面服务，使用 IE 浏览器访问用户或者管理员入口时，可以启用 RDP 控件。</p> </blockquote> <h2 id=35-ovirt>3.5 oVirt 使用进阶</h2> <h3 id=_8>数据库修改非同步数据</h3> <p>如果出现网络错误，很有可能导致数据不同步，从而导致界面上虚拟机状态一直处于异常状态，这点 OpenStack 也有一样的缺点。连接引擎数据库，修改其中的 vm_dynamic, image, vm_static 等数据表即可。</p> <h3 id=engine-config>engine-config 参数配置</h3> <p>平台安装完以后，可用通过 engine-config 命令进行详细参数配置。</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># 查看设置说明
# engine-config -l
# 查看当前设置
# engine-config -a
</code></pre></div> </td></tr></table> <p><strong>示例：重设管理员密码</strong></p> <blockquote> <blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>
</code></pre></div> </td></tr></table> </blockquote> <h1 id=engine-config-s-adminpasswordinteractive>engine-config -s AdminPassword=interactive</h1> <p>Please enter a password: # 密码 Please reenter password: # 密码</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>
</code></pre></div> </td></tr></table> </blockquote> <h3 id=ovirt-shell-api>ovirt-shell 与 API</h3> <p>Restful API（Application User Interface）是 oVirt 的一大特点，用户可以通过它将其与第三方的界面或者应用进行集成。访问 <a href=http://192.168.10.100/api?rsdl>http://192.168.10.100/api?rsdl</a> 以获取其用法。</p> <p>:::{note}</p> <p>访问 API 使用 GET、POST、PUT、DELETE 方法</p> <p>获取内容时使用 GET； 添加新内容或者执行动作使用 POST； 更新内容使用 PUT； 删除内容使用 DELETE；</p> <p>详细用法参考 <a href=http://www.ovirt.org/Api>http://www.ovirt.org/Api</a>，SDK 示例参考 <a href=http://www.ovirt.org/Testing/PythonApi>http://www.ovirt.org/Testing/PythonApi</a></p> <p>:::</p> <p>ovirt-shell 则是全部使用 Restful API 写成的 shell，通过它可以完成图形界面所不能提供的功能。</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># ovirt-shell -I -u admin@internal -l https://192.168.10.100/api
============================================================================
                        &gt;&gt;&gt; connected to oVirt manager 3.4.0.0 &lt;&lt;&lt;
============================================================================

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                              Welcome to oVirt shell
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
[oVirt shell (connected)]#
</code></pre></div> </td></tr></table> <p><strong>示例：使用 ovirt-shell 或者 API 来连接虚拟机。</strong></p> <blockquote> <blockquote> <ol> <li>获取虚拟机列表及其所在宿主机</li> </ol> </blockquote> <ul> <li>ovirtshell</li> </ul> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># ovirt-shell -I -u admin@internal -l https://192.168.10.100/api -E &quot;list vms&quot;
id         : 124e8020-c9d7-4e86-81e1-0d4e28ff1cd4
name       : aaa
# ovirt-shell -I -u admin@internal -l https://192.168.10.100/api -E &quot;show vm aaa&quot;
id                                : 124e8020-c9d7-4e86-81e1-0d4e28ff1cd4
name                              : aaa
...
display-address                   : 192.168.10.100
...
display-port                      : 5912
display-secure_port               : 5913
...
</code></pre></div> </td></tr></table> <ul> <li>restapi</li> </ul> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># curl -u admin@internal:admin https://192.168.10.100/api/vms | less
&lt;name&gt;aaa&lt;/name&gt;
&lt;description&gt;&lt;/description&gt;
...
&lt;display&gt;
    &lt;type&gt;spice&lt;/type&gt;
    &lt;address&gt;192.168.10.100&lt;/address&gt;
    &lt;port&gt;5912&lt;/port&gt;
    &lt;secure_port&gt;5913&lt;/secure_port&gt;
    &lt;monitors&gt;1&lt;/monitors&gt;
    &lt;single_qxl_pci&gt;false&lt;/single_qxl_pci&gt;
    &lt;allow_override&gt;false&lt;/allow_override&gt;
    &lt;smartcard_enabled&gt;false&lt;/smartcard_enabled&gt;
&lt;/display&gt;
...
</code></pre></div> </td></tr></table> <ol> <li> <p>获取/设置控制台密码</p> </li> <li> <p>ovirtshell</p> </li> </ol> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># ovirt-shell -I -u admin@internal -l https://192.168.10.100/api -E     &quot;action vm aaa ticket&quot;
# [oVirt shell (connected)]# action vm aaa ticket

status-state : complete
ticket-expiry: 7200
ticket-value : MfY9P5kpmNpw
vm-id        : 124e8020-c9d7-4e86-81e1-0d4e28ff1cd4
</code></pre></div> </td></tr></table> <ul> <li>restapi</li> </ul> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># curl -k -u admin@internal:admin https://192.168.10.100/api/vms/124e8020-c9d7-4e86-81e1-0d4e28ff1cd4/ticket -X POST -H &quot;Content-type: application/xml&quot; -d &#39;&lt;action&gt;&lt;ticket&gt;&lt;expiry&gt;120&lt;/expiry&gt;&lt;/ticket&gt;&lt;/action&gt;&#39;
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;action&gt;
    &lt;ticket&gt;
        &lt;value&gt;jRUqhrks6JiT&lt;/value&gt;
        &lt;expiry&gt;120&lt;/expiry&gt;
    &lt;/ticket&gt;
    ...
    &lt;status&gt;
        &lt;state&gt;complete&lt;/state&gt;
    &lt;/status&gt;
&lt;/action&gt;
</code></pre></div> </td></tr></table> <ol> <li>连接虚拟机</li> </ol> <p>除了以上获取的显示端口、宿主机 IP，我们需要额外获取一个根证书。</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># wget http://192.168.10.100/ca.crt
</code></pre></div> </td></tr></table> <ul> <li>ovirt-shell</li> </ul> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># ovirt-shell -I -u admin@internal -l https://192.168.10.100/api \
-E &quot;console aaa&quot;
</code></pre></div> </td></tr></table> <ul> <li>virt-viewer</li> </ul> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># remote-viewer --spice-ca-file=ca.crt spice://192.168.10.100?port=5912&amp;tls-port=5913&amp;password=jRUqhrks6JiT
</code></pre></div> </td></tr></table> </blockquote> <h3 id=hooks>主机 hooks</h3> <p>主机 hooks 位于各个宿主机上，用于扩展 oVirt 的平台功能，比如网络、USB 设备、SRIOV 等。原理是在某一事件触发时（比如虚拟机启动之前），修改 libvirt 启动 XML 文件、环境变量或者主机配置，从而改变 qemu 的启动参数。</p> <p>更多 hooks 内容请参考 <a href=https://github.com/oVirt/vdsm/tree/master/vdsm_hooks>vdsm-hooks</a> 。</p> <p><strong>示例：使用 libvirt 内部网络</strong></p> <blockquote> <blockquote> <ol> <li>准备所需文件。</li> </ol> </blockquote> <p>拷贝 <a href=https://raw.githubusercontent.com/oVirt/vdsm/master/vdsm_hooks/extnet/extnet_vnic.py>extnet_vnic.py</a> 至/usr/libexec/vdsm/hooks/before_vm_start/，不要忘记添加可执行权限。</p> <ol> <li>查看，添加 libvirt 网络。</li> </ol> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># virsh net-list
</code></pre></div> </td></tr></table> <p>在 <em>extnet_vnic.py</em> 文件中 <strong>newnet = os.environ.get('extnet')</strong> 前一行添加如下代码，替换其中的 <strong>default</strong> 为要使用的 libvirt 网络， <strong>其他的 hooks 脚本多数可以这样修改，也可以在 engine-config 的 CustomProperty 中指定</strong> ：</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># 注意此处使用双引号
params = &quot;default&quot;
# 同上部分粗体字，因为大部分hooks检查engine-config中的环境变量，简便起见，我直接在hooks脚本中设置了环境变量
os.environ.__setitem__(&quot;extnet&quot;,params)
</code></pre></div> </td></tr></table> <ol> <li>虚拟机一定要添加网络配置，否则会启动失败，在虚拟机启动时，第一个网络配置文件会被替换为 <strong>default</strong> 网络。</li> </ol> </blockquote> <p>::::{note}</p> <p>如果忘记了 libvirt 密码，可以用以下命令重置。</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># saslpasswd2 -a libvirt root
</code></pre></div> </td></tr></table> <p>::::</p> <h3 id=_9>第三方界面</h3> <p>oVirt 现在自带的 gwt 界面对浏览器和客户的要求较高，有一些人由于这个原因抛弃它使用第三方的 web 界面，参考 <a href=https://github.com/jennykang/oVirtDash>oVirt Dash</a> 、 <a href="https://gerrit.ovirt.org/gitweb?p=samples-portals.git;a=shortlog;h=HEAD">ovirt sample-portals</a> 。</p> <h3 id=_10>主机策略</h3> <p>参考这个 <a href=http://www.ovirt.org/images/2/2a/Scheduler-Deep-Dive-oVirt.pdf>PDF</a> 。（没记错的话，里面那个显卡透穿的问题，是当初我问的。。）</p> <p><strong>示例：</strong></p> <h3 id=virt-install>使用 virt-install 安装系统</h3> <p><strong>示例：</strong></p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># virt-install \
--name centos7 \
--ram 2048 \
--disk path=/var/kvm/images/centos7.img,format=qcow2 \
--vcpus 2 \
--os-type linux \
--os-variant rhel7 \
--graphics none \
--console pty,target_type=serial \
--location &#39;http://mirrors.aliyun.com/centos/7/os/x86_64/&#39; \
--extra-args &#39;console=ttyS0,115200n8 serial&#39;
</code></pre></div> </td></tr></table> <h3 id=_11>虚拟机文件系统扩容</h3> <p>oVirt 3.4 磁盘可以进行在线扩容，但是对于磁盘内的文件系统需要单独支持，在此列出常用 Linux 以及 Windows 扩容方法。</p> <p><strong>Linux 文件系统扩容（镜像扩容后操作）</strong></p> <blockquote> <p>在镜像扩容后进行如下操作。</p> <ol> <li>重写分区表</li> </ol> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># fdisk /dev/sda
&gt; d
&gt; 3
&gt; n
&gt; 3
&gt; w
然后
# kpartprobe
或者
# reboot
</code></pre></div> </td></tr></table> <ol> <li>在线扩容文件系统</li> </ol> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># resize2fs /dev/sda3
</code></pre></div> </td></tr></table> <p><strong>Linux 文件系统扩容（lvm）</strong></p> <p>在创建好一个新的分区或者一个新的磁盘后，将新空间(比如 10G)添加到 PV，VG，扩容 LV，然后扩容文件系统。</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># vgextend vg_livecd /dev/sdb
# lvextend /dev/vg_livecd/lv_root -L +10G
# resize2fs /dev/vg_livecd/lv_root
</code></pre></div> </td></tr></table> <p><strong>Linux 文件系统扩容（libguestfs）</strong></p> <p>具体内容请参考 <a href=http://libguestfs.org/ >libguestfs site</a> 。</p> <ol> <li>检视磁盘</li> </ol> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># virt-filesystem --all --long -h -a hda.img
</code></pre></div> </td></tr></table> <ol> <li>创建待扩容磁盘副本，同时扩容 10G（假设原磁盘大小为 10G）</li> </ol> <p>对于 RAW 格式：</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># truncate -r hda.img hda-new.img
# truncate -s +10G hda-new.img
</code></pre></div> </td></tr></table> <p>对于 QCOW2 等有压缩格式：</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># qemu-img create -f qcow2 -o preallocation=metadata hda-new.img 20G
</code></pre></div> </td></tr></table> <ol> <li>扩展分区尺寸</li> </ol> <p>普通分区扩展，/boot 分区扩容 200M，其余全部给/分区：</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># virt-resize --resize /dev/sda1=+200M --expand /dev/sda2 hda.img hda-new.img
</code></pre></div> </td></tr></table> <p>LVM 分区扩展，扩容 lv_root 逻辑卷：</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># virt-resize --expand /dev/sda2 --LV-expand /dev/vg_livecd/lv_root hda.qcow2 hda-new.qcow2
</code></pre></div> </td></tr></table> <p><strong>FAT/NTFS 扩容</strong></p> <p>XP 使用 Paragon Partion Manager；Windows 7 在磁盘管理中即可扩容。</p> </blockquote> <h3 id=p2vv2p>P2V/V2P</h3> <p><strong>V2V</strong></p> <blockquote> <p>在此以 ESXi 迁移至 oVirt 为例。</p> <ol> <li>在 oVirt 上创建一个 NFS 导出域</li> <li>安装 libguestfs，并创建.netrc 文件，文件内容为 ESXi 的登陆信息：</li> </ol> <p><em>~/.netrc</em></p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>machine 192.168.1.135 login root password 1234567
</code></pre></div> </td></tr></table> <ol> <li>开始迁移，确保 ESXi 的虚拟机已正常关闭：</li> </ol> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># virt-v2v -ic esx://192.168.1.135/?no_verify=1 -o rhev -os 192.168.1.111:/export --network mgmtnet myvm
myvm_myvm: 100% [====================================================]D 0h04m48s
virt-v2v: myvm configured with virtio drivers.
</code></pre></div> </td></tr></table> <ol> <li>从导出域导入虚拟机并运行：</li> </ol> <p>导入虚拟机：</p> <p>```{image} ../images/03-11.png :align: center</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>运行虚拟机：

```{image} ../images/03-12.png
:align: center
</code></pre></div> </td></tr></table> <p><strong>P2V</strong></p> <p>oVirt 的 P2V 方式我所知的有三种，一是使用 VMWare 的 P2V 工具转化为 VM 以后，再通过 virt-v2v 转化为 oVirt 的 VM，二是使用 clonezilla 或者 ghost 制作系统后，再将其安装到 oVirt 中，三则是使用 virt-p2v 工具。笔者在此使用 virt-p2v 工具示例，成文时只在 CentOS 6.5 以上版本测试，CentOS 7 未测试，RHEL 7.1 以上有此工具。</p> <ol> <li>在服务器端安装所需包：</li> </ol> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>yum install -y virt-p2v virt-v2v
</code></pre></div> </td></tr></table> <ol> <li>将/usr/share/virt-v2v/中的 ISO 文件 dd 到 U 盘或者烧录到光盘，然后在要转化的机器上启动。</li> <li>修改服务器端/etc/virt-v2v.conf，修改 rhevm 的配置，形如：</li> </ol> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>&lt;virt-v2v&gt;
  &lt;profile name=&quot;rhev-sparse&quot;&gt;
    &lt;method&gt;rhev&lt;/method&gt;
    &lt;storage format=&#39;qcow2&#39; allocation=&#39;sparse&#39;&gt;
      nfs.example.com:/ovirt-export
    &lt;/storage&gt;
    &lt;network type=&quot;default&quot;&gt;
      &lt;network type=&quot;network&quot; name=&quot;ovirtmgmt&quot;/&gt;
    &lt;/network&gt;
  &lt;/profile&gt;
&lt;/virt-v2v&gt;
</code></pre></div> </td></tr></table> <ol> <li>开始转换（我是使用 libvirt 的 profile 示例）</li> </ol> <p>```{image} ../images/03-13.png :align: center</p> <p>```</p> <ol> <li>转换完成后关闭计算机，并修改虚拟机的配置以完全适应 OS。</li> </ol> </blockquote> <h3 id=ui>UI 插件</h3> <p>详细内容请参考 <a href=http://www.ovirt.org/Features/UIPlugins>oVirt 官网关于 UI 插件的介绍</a> 以及附录部分内容，在此我仅使用 ShellInABox 举例，你可以考虑将上面的 libguestfs 扩容加进来，更多 UI Plugin 请 <strong>git clone git://gerrit.ovirt.org/samples-uiplugins.git</strong> 。</p> <p><strong>ShellInABox oVirt UI plugin</strong></p> <blockquote> <blockquote> <ol> <li>在宿主机上安装 ShellInABox。</li> </ol> </blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># yum install shellinabox
# chkconfig shellinaboxd on
</code></pre></div> </td></tr></table> <p>修改 shellinabox 配置 <strong>OPTS</strong> ：</p> <blockquote> <p><em>/etc/sysconfig/shellinaboxd</em></p> </blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>OPTS=&quot;--disable-ssl --service /:SSH&quot;
</code></pre></div> </td></tr></table> <ol> <li>拷贝 uiplugin 文件并启动服务。</li> </ol> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code># git clone git://gerrit.ovirt.org/samples-uiplugins.git
# cp -r samples-uiplugins/shellinabox-plugin/* /usr/share/ovirt-engine/ui-plugins/
# service shellinaboxd start
# service ovirt-engine restart
</code></pre></div> </td></tr></table> <p>```{image} ../images/03-09.png :align: center</p> <p>```</p> <p>:::{note}</p> <p>shellinabox 插件链接问题</p> <p>由于 3.3 到 3.4 之后链接的变化，shellinabox.json 中的 <strong>/webadmin/webadmin/plugin/ShellBoxPlugin/start.html</strong> 需要替换为 <strong>plugin/ShellBoxPlugin/start.html</strong> 。</p> <p>:::</p> <p>:::{note}</p> <p>shellinabox 的 root 登陆问题</p> <p>echo -e "pts0npts1npts2" &gt;&gt; /etc/securetty</p> <p>:::</p> </blockquote> <h3 id=sysprepcloud-init>使用 SysPrep/Cloud-Init 重置虚拟机信息</h3> <p>参考 <a href=https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Virtualization/3.4/html/Administration_Guide/sect-Sealing_Templates_in_Preparation_for_Deployment.html>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Virtualization/3.4/html/Administration_Guide/sect-Sealing_Templates_in_Preparation_for_Deployment.html</a> .</p> <p><strong>初始化 Redhat 系列 Linux</strong></p> <blockquote> <blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>
</code></pre></div> </td></tr></table> </blockquote> <h1 id=touch-unconfigured>touch /.unconfigured</h1> <h1 id=rm-i-etcsshsshhost>rm -i /etc/ssh/ssh<em>host</em>*</h1> <h1 id=echo-hostnamelocalhostlocaldomain-etcsysconfignetwork>echo "HOSTNAME=localhost.localdomain" &gt;&gt; /etc/sysconfig/network</h1> <h1 id=rm-i-etcudevrulesd70-persistent>rm -i /etc/udev/rules.d/70-persistent*</h1> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>删除 */etc/sysconfig/network-scripts/ifcfg-** 文件中的 **HWADDR=** 字段，删除 */var/log/** 、 */root/*.log* ，然后关机即可。

修改密码

```{code}

# virt-sysprep --root-password password:123456 -a os.img
</code></pre></div> </td></tr></table> <p><strong>初始化 Windows 7</strong></p> <blockquote> <ol> <li>使用http://www.drbl-winroll.org工具批量修改。</li> <li>使用位于 <em>C:\Windows\system32\sysprep</em> 目录下的工具。</li> </ol> </blockquote> <p>```{image} ../images/03-10.jpg :align: center</p> <p>```</p> </blockquote> <h3 id=_12>与其他平台集成、与认证服务器集成</h3> <p>oVirt 平台目前可以使用 Foreman，OpenStack Network，OpenStack Image 的部分功能，具体实施请参阅附录一内容。</p> <p>与认证服务器集成时很有可能遇到各种问题，比如与 AD 集成时不能使用 Administrator 用户进行 engine-manage-domains，与 IPA 集成时需要修改 minss 之类的参数，与 LDAP 集成时需要 Kerberos 或者使用 3.5 版本中的 aaa 认证插件。</p> <h3 id=libvirtqemukernel>后端（libvirt/qemu/kernel）优化</h3> <p>如果你觉得现有平台的性能达不到预期，或者有其他的需求，可以从以下几方面进行调节或优化。</p> <ul> <li>qemu ： 我写了 <a href=https://github.com/lofyer/qemu-cmd-reloaded>一系列 qemu 的脚本</a> ，你可以调节里面的参数直接启动虚拟机进行调试或者优化。</li> <li>libvirt ： <a href=http://libvirt.org>libvirt</a> 的目的是统一各种虚拟化后端的调用方式（kvm/xen/lxc/OpenVZ//VirtualBox/VMWare/Hyper-V 等等），主要一个特性是用统一的描述文件来定义虚拟机配置（xml 文件），在 Linux 下你可以使用 <a href=http://virt-manager.org>Virt Manager</a> 进行调试，相关文档参考 <a href=https://libvirt.org/html/index.html>libvirt ref</a> 。</li> <li>kernel ： 基本上大部分的内核相关配置都可以通过 <strong>/sys</strong> 或者 <strong>/proc</strong> 进行调节，而针对内核所谓的“优化”，在非大规模部署的情况下，其优势很难体现出来，还有一方面，目前的 KVM 效率，CPU、内存管理、网络等方面都比较优秀，在 I/O 方面还有部分不足，可以在 <a href=http://www.linux-kvm.org/page/Virtio>VIRTIO</a> 上进行相关的优化，还有开启 <a href=http://www.kernel.org/doc/Documentation/vm/hugetlbpage.txt>HugePage</a> 等操作。</li> </ul> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../ch02/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 第二章 一个可靠的存储后端" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> 第二章 一个可靠的存储后端 </div> </div> </a> <a href=../ch04/ class="md-footer__link md-footer__link--next" aria-label="下一页: 第四章 数据抓取与机器学习算法" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> 第四章 数据抓取与机器学习算法 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2021 lofyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.indexes", "search.suggest", "search.highlight", "search.share"], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "../../assets/javascripts/workers/search.361d90f1.min.js"}</script> <script src=../../assets/javascripts/bundle.289a2a4b.min.js></script> <script src=../../javascripts/config.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>