<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=lofyer><link href=https://docs.lofyer.org/blog/archive/2014/page/2/ rel=canonical><link href=../../../2015/ rel=prev><link href=../../../2013/ rel=next><link rel=icon href=../../../../../images/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.39"><title>2014 - Lofyer's Blog</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.8c3ca2c6.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.06af60db.min.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#2014 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../../.. title="Lofyer's Blog" class="md-header__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lofyer's Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 2014 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> Index </a> </li> <li class=md-tabs__item> <a href=../../../../../wangsheng/ class=md-tabs__link> WangSheng </a> </li> <li class=md-tabs__item> <a href=../../../../../datanote/ class=md-tabs__link> Archive Docs </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../../ class=md-tabs__link> Archive Blog </a> </li> <li class=md-tabs__item> <a href=../../../../../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title="Lofyer's Blog" class="md-nav__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Lofyer's Blog </label> <div class=md-nav__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../wangsheng/ class=md-nav__link> <span class=md-ellipsis> WangSheng </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../../datanote/ class=md-nav__link> <span class=md-ellipsis> Archive Docs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Archive Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Archive Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=true> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> 归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../2022/ class=md-nav__link> <span class=md-ellipsis> 2022 </span> </a> </li> <li class=md-nav__item> <a href=../../../2021/ class=md-nav__link> <span class=md-ellipsis> 2021 </span> </a> </li> <li class=md-nav__item> <a href=../../../2020/ class=md-nav__link> <span class=md-ellipsis> 2020 </span> </a> </li> <li class=md-nav__item> <a href=../../../2019/ class=md-nav__link> <span class=md-ellipsis> 2019 </span> </a> </li> <li class=md-nav__item> <a href=../../../2018/ class=md-nav__link> <span class=md-ellipsis> 2018 </span> </a> </li> <li class=md-nav__item> <a href=../../../2017/ class=md-nav__link> <span class=md-ellipsis> 2017 </span> </a> </li> <li class=md-nav__item> <a href=../../../2016/ class=md-nav__link> <span class=md-ellipsis> 2016 </span> </a> </li> <li class=md-nav__item> <a href=../../../2015/ class=md-nav__link> <span class=md-ellipsis> 2015 </span> </a> </li> <li class=md-nav__item> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=../../ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 2014 </span> </a> </li> <li class=md-nav__item> <a href=../../../2013/ class=md-nav__link> <span class=md-ellipsis> 2013 </span> </a> </li> <li class=md-nav__item> <a href=../../../2012/ class=md-nav__link> <span class=md-ellipsis> 2012 </span> </a> </li> <li class=md-nav__item> <a href=../../../2011/ class=md-nav__link> <span class=md-ellipsis> 2011 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../../category/lab/ class=md-nav__link> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=2014>2014</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-04-03 00:00:00">2014年4月3日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/inthecloud/ class=md-meta__link>inthecloud</a></li> <li class=md-meta__item> 需要 2 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=7-gluster><a href=../../../../2014/04/03/7-gluster%E7%AE%80%E8%BF%B0/ class=toclink>7. Gluster简述</a></h2> <p>这一节会简述下glusterfs功能和特性。</p> <p>glusterfs设计符合奥卡姆剃刀原则，即“若无必要，勿增实体”。</p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-src/cloud-5-2-1/ ><img alt=cloud-5.2-1 src=/blog/images/cloud-5.2-1.png></a></p> <h3 id=_1><a class=toclink href=../../../../2014/04/03/7-gluster%E7%AE%80%E8%BF%B0/#_1>功能特性</a></h3> <p>gluster集群组成的存储可以通过NFS、CIFS、Glusterfs、HTTP、FTP协议交给用户使用；</p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-des/glusterfs_architecture/ ><img alt=GlusterFS_Architecture src=/blog/images/GlusterFS_Architecture.png></a></p> <p>gluster支持四种存储逻辑组合：Striped、Replicated、Striped-Replicated、Distributed；</p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-des/distributed_volume/ ><img alt=Distributed_Volume src=/blog/images/Distributed_Volume.png></a></p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-des/distributed_striped_volume/ ><img alt=Distributed_Striped_Volume src=/blog/images/Distributed_Striped_Volume.png></a></p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-des/distributed_replicated_volume/ ><img alt=Distributed_Replicated_Volume src=/blog/images/Distributed_Replicated_Volume.png></a></p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-des/distributed_striped_replicated_volume/ ><img alt=Distributed_Striped_Replicated_Volume src=/blog/images/Distributed_Striped_Replicated_Volume.png></a></p> <p>支持跨网备份（geo-replication）；</p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-des/geo-rep_lan/ ><img alt=Geo-Rep_LAN src=/blog/images/Geo-Rep_LAN.png></a></p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-des/geo-rep_wan/ ><img alt=Geo-Rep_WAN src=/blog/images/Geo-Rep_WAN.png></a></p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-des/geo-rep03_internet/ ><img alt=Geo-Rep03_Internet src=/blog/images/Geo-Rep03_Internet.png></a></p> <p><a href=http://blog.lofyer.org/5-2-cloud-gluster-des/geo-rep04_cascading/ ><img alt=Geo-Rep04_Cascading src=/blog/images/Geo-Rep04_Cascading.png></a></p> <p>统一对象视图，与UNIX设计哲学类似，所有皆对象；</p> <p>跨平台兼容性高，可作为hadoop、openstack、ovirt、Amazon EC的后端；</p> <h3 id=_2><a class=toclink href=../../../../2014/04/03/7-gluster%E7%AE%80%E8%BF%B0/#_2>名词解释</a></h3> <p>砖块（brick）：即服务器节点上导出的一个目录，作为glusterfs的最基本单元；</p> <p>扩展属性（xattr）：用户/程序以之将数据和元数据关联起来；</p> <p>GFID：glusterfs中的每一个文件或者目录都有一个独立的128位GFID，与普通文件系统中的inode类似；</p> <p>glusterd：运行于所有服务器中的管理守护程序；</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-04-01 00:00:00">2014年4月1日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/inthecloud/ class=md-meta__link>inthecloud</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=5><a href=../../../../2014/04/01/5-%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E7%9A%84%E6%95%85%E4%BA%8B/ class=toclink>5. 分布式存储的故事</a></h2> <p>计算机领域中有诸多有意思的东西可以把玩，在这儿且看看分布式存储。</p> <p><strong>集群文件系统</strong>在某些场景下又可以称作网络文件系统、并行文件系统，在70年代由IBM提出并实现原型。</p> <p>有几种方法可以实现集群形式，但多数仅仅是节点直连存储而不是将存储之上的文件系统进行合理“分布”。分布式文件系统同时挂载于多个服务器上，并在它们之间共享，可以提供类似于位置无关的数据定位或冗余等特点。并行文件系统是一种集群式的文件系统，它将数据分布于多个节点，其主要目的是提供冗余和提高读写性能。</p> <p><strong>共享磁盘（Shared-disk）/Storage-area network(SAN)</strong></p> <p>从应用程序使用的文件级别，到SAN之间的块级别的操作，诸如权限控制和传输，都是发生在客户端节点上。共享磁盘（Shared-disk）文件系统，在并行控制上做了很多工作，以至于其拥有比较一致连贯的文件系统视图，从而避免了多个客户端试图同时访问同一设备时数据断片或丢失的情况发生。其中有种技术叫做围栏（Fencing），就是在某个或某些节点发生断片时，集群自动将这些节点隔离（关机、断网、自恢复），保证其他节点数据访问的正确性。<strong>元数据（Metadata）</strong>类似目录，可以让所有的机器都能查找使用所有信息，在不同的架构中有不同的保存方式，有的均匀分布于集群，有的存储在中央节点。</p> <p>实现的方式有SCSI，iSCSI，AoE，FC，Infiniband等，比较著名的产品有Redhat GFS、Sun QFS、Vmware VMFS等。</p> <p><strong>分布式文件系统</strong></p> <p>分布式文件系统则不是块级别的共享的形式了，所有加进来的存储（文件系统）都是整个文件系统的一部分，所有数据的传输也是依靠网络来的。</p> <p>它的设计有这么几个原则：</p> <ul> <li><em>访问透明</em>   客户端在其上的文件操作与本地文件系统无异</li> <li>_位置透明  _ 其上的文件不代表其存储位置，只要给了全名就能访问</li> <li><em>并发透明</em>   所有客户端持有的文件系统的状态在任何时候都是一致的，不会出现A修改了F文件，但是B愣了半天才发现。</li> <li>_失败透明  _ 理解为阻塞操作，不成功不回头。</li> <li><em>异构性</em>   文件系统可以在多种硬件以及操作系统下部署使用。</li> <li><em>扩展性</em>        随时添加进新的节点，无视其资格新旧。</li> <li><em>冗余透明</em>   客户端不需要了解文件存在于多个节点上这一事实。</li> <li><em>迁移透明</em>   客户端不需要了解文件根据负载均衡策略迁移的状况。</li> </ul> <p>实现的方式有NFS、CIFS、SMB、NCP等，比较著名的产品有Google GFS、Hadoop HDFS、GlusterFS、Lustre等。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-03-28 00:00:00">2014年3月28日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/inthecloud/ class=md-meta__link>inthecloud</a></li> <li class=md-meta__item> 需要 2 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=4-><a href=../../../../2014/03/28/4-%E5%9C%A8%E4%BA%91%E7%AB%AF--%E7%9B%AE%E5%BD%95--%E8%BF%9B%E5%BA%A6/ class=toclink>4. 在云端--目录--进度</a></h2> <p><strong>UPDATE: 2015-05-30 下半部分不如预期中容易，每个算法都要验证并说出所以然，恕小弟不才。</strong></p> <p><strong>UPDATE: 2015-01-01 上半部分基本完结，下半部分正在添加，<a href=https://inthecloud.readthedocs.org title=InTheCloud>在线阅读</a>。如果要成书的话，需要大量添加截图、行动指导以及概念说明。</strong></p> <p><strong>UPDATE: 2014-06-01 移步<a href=http://github.com/lofyer/InTheCloud title=http://github.com/lofyer/InTheCloud>http://github.com/lofyer/InTheCloud</a></strong></p> <p><strong>UPDATE: 2014-05-30 放入github，以rst格式编写。</strong></p> <p><strong>UPDATE: 2014-05-15 oVirt章节完成以后整理成word文档，内容更加丰富。</strong></p> <p>每一章节都可扩展，避免局部发胖，可以从新调整目录结构，比如再加一级父目录和子目录。 硬件部分在搭建的时候可以穿插进来，并不设专门章节讲解。 角度不要起太高，容易扯淡。 不忘资源整合，要有数据。 兼顾智能家居（家庭云）。</p> <p>第一章 随便说些什么 ...1.1 我所看到的 ...1.2 今天天气怎样 ...1.3 根据需求来架构 第二章 一个可靠的存储后端 ...2.1 谈谈分布式存储 ...2.2 Glusterfs简述 ......功能特性 ...2.3 搭建Glusterfs作为基础存储 ......添加DNS或者修改hosts文件 ......准备磁盘作为砖块 ......添加卷 ......挂载卷 ...2.4 Glusterfs应用示例及技巧 ......文件权限 ......砖块组合 ......normal、replica、striped卷组合 ......作为nfs挂载 ......作为cifs挂载 ......修复裂脑（split-brain） ......砖块复用 ......高可用业务IP 第三章 一个合适的虚拟化平台 ...3.1 虚拟化平台简介 ...3.2 搭建oVirt管理引擎 ......系统准备 ......添加repo ......搭建普通oVirt虚拟化平台 ......搭建管理端高可用oVirt（hosted engine） ...3.3 添加节点以及存储域 ......添加节点（宿主机） ......添加存储域 ...3.4 连接虚拟机 ......Spice-Html5 ......浏览器插件 ......本地客户端 ......spice proxy - gateway - squid代理 ......RDP插件（仅适用于Windows虚机及IE浏览器） ...3.5 oVirt使用进阶 ......engine-config参数配置 ......engine-config参数配置 ......ovirt-shell与API ......主机hooks ......主机策略 ......虚拟机文件系统扩容 ......P2V/V2P ......UI 插件 ......使用SysPrep/Cloud-Init重置虚拟机信息 ......与其他平台集成、与认证服务器集成 ......后端（libvirt/qemu/kernel）优化 第四章 数据抓取与机器学习算法 ...4.1 数据收集 ......简单抓取 ......分布式抓取 ......使用Nutch + Solr ...4.2 爬虫示例 ......58同城 ......知乎 ......新浪微博 ...4.3 numpy 快查 ...4.4 机器学习常用分类算法及Python实现 ......信息分类基础 ......K邻近算法 ......决策树 ......朴素贝叶斯 ......Logistic回归 ......SVM ......AdaBoost ...4.5 无监督学习 ...4.6 数据可视化 ......数据统计 ......地理位置表示 ...4.7 机器学习工具 第五章 Hadoop部署及使用 ...5.1 Hadoop简介 ...5.2 模块部署（单机/集群） ......单节点部署 ......集群部署 ...5.3 本地数据处理 ...5.4 实时数据处理 ...5.5 使用进阶 ......基于Solr和Nutch的搜索引擎 附录一 OpenStack/Docker/Foreman 以及其他很有用的资源 ...OpenStack RDO快速部署 ......RDO快速部署 ......添加镜像 ......从ISO安装新实例 ......与owncloud集成 ......oVirt使用Glance与Neutron服务 ...Docker 使用以及相关集成 ......镜像操作 ......Registry操作 ...Foreman 部署指导 ...常用性能测量及优化工具 ...SDN学习/mininet ...HAProxy ...常用运维工具 ......Ganglia ......zabbix ......nagios ......foreman ......chef ......puppet 附录二 公有云参考 ...虚拟机占用主机资源隔离 ......网络 ......CPU ......磁盘IO ......设备 ...资源用度、计费 附录三 PaaS ...这是什么 ...当前的形势 附录四 文档参考资源以及建议书单 ...Server World ...OVF ...快速安装脚本 ...常用爬虫 ...Django based WebAdmin ...书单 实践 构建先进的家居云 ...系统架构 ...构建元素 ...OS X Server</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-03-25 00:00:00">2014年3月25日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/inthecloud/ class=md-meta__link>inthecloud</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=2><a href=../../../../2014/03/25/2-%E7%95%85%E6%83%B3%E5%90%A7/ class=toclink>2. 畅想吧</a></h2> <p>单纯人与人的连接关系渐渐已经不能够描述社会这个复杂体了，工业机器也开始走进人的生活，并开始和人互动。Google在2013年一口气收了8家机器人公司，这让我感到...对的，兴奋。</p> <p>有人说到2020年全球数据总量将达到40ZB，这其中就包含“你幸福吗？”、“你小康了吗？”、“今天中午吃什么？”...你觉得，从数据能判断你的什么？我觉得，该了解的不该了解的，基本都有了。</p> <p>那我们能拿这些数据做什么呢？</p> <p><strong>你现在所能看到的，找到的，听到的，都将会是你进行创造的来源，它们为你服务。</strong></p> <p>我有一只狗，名字叫卡尔， 它能听懂我说话， 帮我发个邮件给阿牛，它会去做。 帮我开台桌面一会儿我要连上去画图，它会去开。 帮我预定曹阳影城的两张门票，它会去订。 帮我找点有意思的新闻，它会整理发送给我。 帮我去给东东和小李送个快递，它也会去送。 帮我买一身衣服，它会买你喜欢的风格。 帮我把找找另外一只拖鞋在哪，它屁颠屁颠的找到了。 ......</p> <p>有很多事情可以帮你甚至代替你去做（原谅我这个robot控）况且，“云”落地总要实体化的。</p> <p><strong>健壮的身体里，同样要有个健康的灵魂。</strong></p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-03-25 00:00:00">2014年3月25日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/inthecloud/ class=md-meta__link>inthecloud</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=3><a href=../../../../2014/03/25/3-%E8%A6%81%E6%9C%89%E5%85%89/ class=toclink>3. 要有光</a></h2> <p>在这里，是整个系统的不同角度视图。</p> <p>+-------------------------------------+ | +--------------------------------+ | | | +---------------------------+ | | | | | +-----------------------+ | | | | | | | | | | | | | | | appliance | | | | | | | +-----------------------+ | | | | | | vm+map_reduce | | | | | +---------------------------+ | | | | hdfs + hypervisor | | | +--------------------------------+ | <br> | glusterfs | +-------------------------------------+</p> <p>Cluster | +--Board | | | +--Storage | | | +--Dev_Extension_Board | +--Network | +--UPS | | | +--Active/Backup | +--Safety | | | +--TSL | | | +--Supervision</p> <p>整个存储是比较倾向gluster作为后端，当然，hdfs是可以使用gluster作为后端的。hdfs的优势之一是可移植性高，可以用廉价的硬件组建（扩展）对性能要求不苛刻的集群。</p> <p>每一个hypervisor都承载一定数量的计算，当然主要是靠虚拟机内的MapReduce。TBD</p> <p>Appliance的是使本地计算资源以及互联网资源的融合，作为集群的表现点，拥有识别并体现彼此特征的能力。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-03-24 00:00:00">2014年3月24日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/inthecloud/ class=md-meta__link>inthecloud</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=1><a href=../../../../2014/03/24/1-%E4%BC%97%E8%AF%B4%E7%BA%B7%E7%BA%AD/ class=toclink>1. 众说纷纭</a></h2> <p>作为公司的一名小小员工，从客户交流到现场部署、从SDN交换机到Neutron、从QEMU到IAAS，我都有过了解或接触，并将其记录成文，<strong>是总结，亦是探索</strong>。期间难免会有这样或者那样的想法，<strong>而将这些想法实践出来的过程是会让人觉得生活依旧是美好的</strong>。</p> <h3 id=_1><a class=toclink href=../../../../2014/03/24/1-%E4%BC%97%E8%AF%B4%E7%BA%B7%E7%BA%AD/#_1>状况</a></h3> <p>接下来是以我目前水平能看到的： 和多数行业一样，不管哪个公司，他们技术和关系，在不同客户那里都有不同的权重，这点的南北差异尤为明显； 风（宏观调控）让云去哪，云就去哪； AppEngine或者OpenShift目前更像是资源（公共数据中心）一厢情愿的产物；</p> <h3 id=_2><a class=toclink href=../../../../2014/03/24/1-%E4%BC%97%E8%AF%B4%E7%BA%B7%E7%BA%AD/#_2>需求</a></h3> <p>以我所遇到的客户来看，部分客户不会明确的说使用“云”，他们的需求在多数情况下可以有这样或者那样的传统方案替代； 明确要求使用“云”的客户，总会要求周边指标（用户接入、终端协议、视频流占用带宽、UPS、存储复用等）以及各种各样的定制。 所以，在需求上的灵活变通，也是有些许重要性的，<strong>不要把技术人员的固执带到客户那</strong>。</p> <h3 id=_3><a class=toclink href=../../../../2014/03/24/1-%E4%BC%97%E8%AF%B4%E7%BA%B7%E7%BA%AD/#_3>还有什么</a></h3> <p>TBD</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-03-21 00:00:00">2014年3月21日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/inthecloud/ class=md-meta__link>inthecloud</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=0><a href=../../../../2014/03/21/0-%E4%BB%8A%E5%A4%A9%E5%A4%A9%E6%B0%94%E6%80%8E%E4%B9%88%E6%A0%B7/ class=toclink>0. 今天天气怎么样？</a></h2> <p>7:50 手机闹铃响了，随之而来的是你订阅的RSS、Flipboard推送的新闻。随手翻阅下，完后Siri说今天天气挺暖和的，可以穿你最喜欢的高领毛衣，起床。 8:30 高速公路上，地图告诉你前方拥堵，正好这时领导打来电话，你告诉Siri说“接听”。挂了电话以后，红灯亮了，汽车记录下你这次堵车的时间，并默默再次计算预计到时。 9:20 到达公司门口，没有保安，取而代之的是连接公司LDAP服务器的瞳孔识别。 10:00 收到信息，来自楼下快件派发柜，你订购的球鞋到了。 10:30 客户预约的拜访，你告诉Siri说把公司地址导航路线发送给客户张三。 11:10 通过公司IM告诉前台临时允许车牌号为K9031的车辆进来并发送车位信息给客户。 11:20 和客户在临时会客厅谈话，期间你把演说内容通过手势（食指一划）推送到客户邮箱，他们感到很意外（<strong>加分点</strong>）。</p> <p>12:30 午餐时间，Siri还记得你在决心减肥期间，提醒你不要吃最喜欢的红烧肉，末了来一句“两个人被老虎追，谁最危险？Bingo，胖的那个”。 14:30 有客户如约送来了10T的财务数据，你通知技术部小李对这些数据进行方案II处理，百分之30的处理任务交给武汉机房的机器，因为这些从机柜到主板都是你依照节能环保的原则主持设计的。 16:00 Siri告诉你，抱歉，六点钟有局部降雨。 17:00 你把今天的备忘录存进公司派发给你的虚拟桌面，下班。 19:00 老婆大人的晚饭做好了，你也再次连上虚拟桌面把备忘录整理归档。 20:30 跑步结束，它告诉你这几周换季期间，要增加运动量，你说“可以”。 23:00 休息，Siri通过文字悄悄告诉你，明天结婚纪念日，记住。</p> <p><strong>所有已知未知的暗流，让人有了继续折腾下去的欲望。</strong></p> <p>我是一个着重实践的人，是的，比如磁盘不拆开的话我可能就对扇区、磁道、柱面没什么深刻概念（拆了也就有助于理解驱动，见下图）。所以，这一些列文章将尽量从操作或者现象中总结规律。一些原理性的东西会尽量用我觉得容易理解的形式表现出来。</p> <p><a href=http://blog.lofyer.org/cloud-0-how-is-today/img_20140428_100857/ ><img alt=IMG_20140428_100857 src=/blog/images/IMG_20140428_100857.png></a></p> <p>整本“书”的结构将会是这个样子： 介绍下主流“云”的现状，会引用许多现成（尽量）客观的信息片段；<strong>畅想一下</strong>；从中选择部分组成一个完整系统，进行搭建（或模拟）并本地调优（避免过早优化）；避免烂尾，结尾送两首短诗吧。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-03-19 00:00:00">2014年3月19日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/inthecloud/ class=md-meta__link>inthecloud</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=-1><a href=../../../../2014/03/19/-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E7%9A%84%E5%BA%8F%E5%8F%B7%E9%82%A3%E4%B9%88%E5%A5%87%E8%91%A9/ class=toclink>-1. 为什么我的序号那么奇葩</a></h2> <p>好的，本文作为未来几十或者上百篇系列文章的第一篇，就不负众望地来个开场白吧：</p> <p><strong>序号为0的那篇注定作为系列文章（姑且称之为“书”吧）的序言了，但是又不好意思当-0，就-1吧，跟大家随便聊聊。</strong></p> <p>从07年那会儿，甚至更早，拥有千万用户（包括盗版受害者在内）的行业先锋VMware，又有Google数据中心以及Amazon各种在线服务，这些实打实的东西遵循计算能力的摩尔定律，再顺应日益增长的商业需求，就有了“云”和“大数据”这两个让许多企业再次躁动的概念。</p> <p>稍微有些行业经验（至少以为是或者看来是）的人觉得这俩只是个噱头；搞大型机的说，嗯，这个，呵呵；搞IDC的觉得一台机器现在当二十台甚至更多卖，不错；搞互联网服务的就有些挠头，咦，这啥？噢，就那玩意儿啊，干嘛起这名？</p> <p>不管大家都怎么看吧，先引用一句关于“大数据”的经典：</p> <p><em>“Big Data is like teenage sex: everyone talks about it, nobody really knows how to do it, everyone thinks everyone else is doing it, so everyone claims they are doing it.”</em></p> <p>有时，你我或许都会有迷惘，我这么做（说），对么？</p> <p>那就这样吧，<strong>但行好事，莫问前程</strong>。</p> <p>顺便提一下，本“书”对读者的要求是：<strong>1.没阅读障碍；2.能提出尽量没有偏见的问题。</strong></p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-02-10 00:00:00">2014年2月10日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/cloud-infra/ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 27 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=deploy-asterisk-on-centos><a href=../../../../2014/02/10/deploy-asterisk-on-centos/ class=toclink>Deploy Asterisk on CentOS</a></h2> <p>Get the latest packages. <strong>up to 2014-02-10</strong></p> <h2 id=rpm-uvh-httppackagesasteriskorgcentos6currentx86_64rpmsasterisknow-version-301-2_centos6noarchrpm><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#rpm-uvh-httppackagesasteriskorgcentos6currentx86_64rpmsasterisknow-version-301-2_centos6noarchrpm>rpm -Uvh http://packages.asterisk.org/centos/6/current/x86_64/RPMS/asterisknow-version-3.0.1-2_centos6.noarch.rpm</a></h2> <h2 id=yum-install-asterisk-asterisk-configs-enablerepoasterisk-12><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-asterisk-asterisk-configs-enablerepoasterisk-12>yum install asterisk asterisk-configs --enablerepo=asterisk-12</a></h2> <h2 id=yum-install-dahdi-linux-dahdi-tools-libpri><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-dahdi-linux-dahdi-tools-libpri>yum install dahdi-linux dahdi-tools libpri</a></h2> <h2 id=chkconfig-dahdi-on><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-dahdi-on>chkconfig dahdi on</a></h2> <h2 id=chkconfig-asterisk-on><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-asterisk-on>chkconfig asterisk on</a></h2> <h2 id=service-dahdi-start><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-dahdi-start>service dahdi start</a></h2> <h2 id=service-asterisk-start><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-asterisk-start>service asterisk start</a></h2> <p>You can use freepbx on http://localhost .</p> <h2 id=yum-install-freepbx><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-freepbx>yum install freepbx</a></h2> <hr> <p>title: "use MAXS to control your device via ejabberd(plus ssh, jingle voice talk as a bonus)" date: 2014-02-26 categories: - "cloud-infra"</p> <hr> <p>Let's see what we have got here: A xmpp server based on ejabberd on my host: lofyer.org. Windows client: <a href=https://download.jitsi.org/jitsi/nightly/ >Jitsi(Recommended)</a>, <a href=http://www.pidgin.im/ >Pidgin</a>. (Optional)A Android client: <a href=http://www.xabber.org/ >Xabber.</a> <a href=http://f-droid.org/wiki/page/org.projectmaxs.main>MAXS</a> on my Nexus 5 Android phone.</p> <h3 id=1-prepare-the-serverdebian-7><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#1-prepare-the-serverdebian-7>1. Prepare the server(Debian 7)</a></h3> <h2 id=apt-get-install-ejabberd><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#apt-get-install-ejabberd>apt-get install ejabberd</a></h2> <h2 id=cd-etcejabberd-wget-httppeoplecollaboracomrobot101olpc-ejabberdejabberdcfg><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#cd-etcejabberd-wget-httppeoplecollaboracomrobot101olpc-ejabberdejabberdcfg>cd /etc/ejabberd/; wget http://people.collabora.com/~robot101/olpc-ejabberd/ejabberd.cfg</a></h2> <p>Change <strong>hosts</strong> and <strong>admin</strong> section to your <strong>FQDN</strong>. Here's a example:</p> <p>{hosts, ["lofyer.org"]}. {acl, admin, {user, "mypassword", "lofyer.org"}}.</p> <p>Then you should restart ejabberd, and maybe a reboot is essential.</p> <h2 id=etcinitdejabberd-restart><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#etcinitdejabberd-restart>/etc/init.d/ejabberd restart</a></h2> <h4 id=enable-jinglevoice-and-video><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#enable-jinglevoice-and-video>Enable Jingle(voice and video)</a></h4> <p>You need JingleNodes module on your server.</p> <h2 id=apt-get-install-erlang-tools><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#apt-get-install-erlang-tools>apt-get install erlang-tools</a></h2> <h2 id=git-clone-gitgitprocess-onenetexmppmainlinegit-exmpp><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#git-clone-gitgitprocess-onenetexmppmainlinegit-exmpp>git clone git://git.process-one.net/exmpp/mainline.git exmpp</a></h2> <h2 id=cd-exmpp-configure-make-make-install><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#cd-exmpp-configure-make-make-install>cd exmpp; ./configure; make; make install</a></h2> <h2 id=svn-checkout-httpjinglenodesgooglecodecomsvn-jinglenodes><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#svn-checkout-httpjinglenodesgooglecodecomsvn-jinglenodes>svn checkout http://jinglenodes.googlecode.com/svn/ jinglenodes</a></h2> <h2 id=cd-jinglenodes-configure-prefixusr-make-make-install><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#cd-jinglenodes-configure-prefixusr-make-make-install>cd jinglenodes; ./configure --prefix=/usr/; make; make install</a></h2> <p>Add following content to your ejabberd.cfg in the <strong>modules</strong> section.</p> <p>{mod_jinglenodes, [ {host, "jinglenodes.@HOST@"}, {public_ip, "192.168.1.148"}, {purge_period, 5000}, {relay_timeout, 60000} ]},</p> <h4 id=enable-web-registeroptional><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#enable-web-registeroptional>Enable web register(optional)</a></h4> <p>Add to ejabberd.cfg, 'modules' section the basic configuration:</p> <p>{modules, [ ... {mod_register_web, []}, ... ]}.</p> <p>In the 'listen' section enable the web page:</p> <p>{listen, [ ... {5281, ejabberd_http, [ tls, {certfile, "/etc/ejabberd/ejabberd.pem"}, {request_handlers, [ {["register"], mod_register_web} ]} ]}, ... ]}.</p> <h4 id=use-your-own-certificate><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#use-your-own-certificate>Use your own certificate</a></h4> <p>openssl req -new -x509 -newkey rsa:1024 -days 3650 -keyout privkey.pem -out server.pem openssl rsa -in privkey.pem -out privkey.pem cat privkey.pem &gt;&gt; server.pem rm privkey.pem</p> <p>The port numbers you should open are: 5281(http://localhost:5281/register/) 5280(http://localhost:5280/admin) and 5222(for c2s).</p> <p>Register users:</p> <h2 id=ejabberdctl-register-admin-lofyerorg-mypassword><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ejabberdctl-register-admin-lofyerorg-mypassword>ejabberdctl register admin lofyer.org mypassword</a></h2> <h2 id=ejabberdctl-register-myphone-lofyerorg-mypassword><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ejabberdctl-register-myphone-lofyerorg-mypassword>ejabberdctl register myphone lofyer.org mypassword</a></h2> <h2 id=ejabberdctl-register-mypc-lofyerorg-mypassword><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ejabberdctl-register-mypc-lofyerorg-mypassword>ejabberdctl register mypc lofyer.org mypassword</a></h2> <h3 id=2-pidgin-and-maxs-test><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#2-pidgin-and-maxs-test>2. Pidgin and MAXS test</a></h3> <h3 id=pidgin-adminlofyerorg-maxs-myphonelofyerorg-by-the-way-guarantee-that-there-is-only-one-running-jabber-client-on-your-phone-during-this-period-pidgin-add-a-friend-shell-test-sms-test-and-a-msg-to-my-gf><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#pidgin-adminlofyerorg-maxs-myphonelofyerorg-by-the-way-guarantee-that-there-is-only-one-running-jabber-client-on-your-phone-during-this-period-pidgin-add-a-friend-shell-test-sms-test-and-a-msg-to-my-gf>Pidgin: admin@lofyer.org MAXS: myphone@lofyer.org By the way, guarantee that there is only one running jabber client on your phone during this period. <strong>Pidgin</strong> Add a friend <a href=http://blog.lofyer.org/ejabber-howto/pidgin/ ><img alt=pidgin src=/blog/images/pidgin.png></a> <strong>Shell test</strong> <a href=http://blog.lofyer.org/ejabber-howto/shell/ ><img alt=shell src=/blog/images/shell.png></a> <strong>SMS test</strong> <a href=http://blog.lofyer.org/ejabber-howto/sms-send/ ><img alt=SMS-SEND src=/blog/images/SMS-SEND.png></a> And a msg to my GF. <a href=http://blog.lofyer.org/ejabber-howto/sms-receive/ ><img alt=sms-receive src=/blog/images/sms-receive.jpg></a></a></h3> <p>title: "foreman/puppet/cfengine/bcfg2/chef howto" date: 2014-02-21 categories: - "linux-admin"</p> <hr> <h3 id=which-one-is-the-best-automatic-management-tool-tbd><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#which-one-is-the-best-automatic-management-tool-tbd><a href=http://uberblo.gs/2012/06/cfengine-bcfg2-chef-and-puppet title=cfengine-bcfg2-chef-and-puppet>Which one is the best automatic management tool</a> TBD</a></h3> <p>title: "Gitlab quick deploy" date: 2014-06-08 categories: - "linux-admin"</p> <hr> <p>Well, Gitweb + ssh://git@host is out of date. Even we use it for almost 2 years.</p> <p>We are migrating our repositories to Gitlab which we benefit from its "issue" a lot.</p> <p>Please follow this scripts I wrote.</p> <h3 id=httpsrawgithubusercontentcomlofyeronekey-deploymastergitlabinstallsh><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#httpsrawgithubusercontentcomlofyeronekey-deploymastergitlabinstallsh><a href=https://raw.githubusercontent.com/lofyer/onekey-deploy/master/gitlab/install.sh title="Gitlab quick deploy">https://raw.githubusercontent.com/lofyer/onekey-deploy/master/gitlab/install.sh</a></a></h3> <p>title: "Grafana+InfluxDB+Collectd/Telegraf on RPi2" date: 2017-03-06 categories: - "linux-admin"</p> <hr> <p>Grafana will provide a visual view for the sites, InfluxDB is the data box, and collectd/telegraf is the agent on the server. Here we go.</p> <p><strong>Install Grafana:</strong></p> <h2 id=download-deb-from-httpsgithubcomfg2itgrafana-on-raspberry><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#download-deb-from-httpsgithubcomfg2itgrafana-on-raspberry>Download deb from https://github.com/fg2it/grafana-on-raspberry</a></h2> <p>root@raspberrypi:~# rpm -i grafana.deb root@raspberrypi:~# service grafana-server start</p> <p><strong>Install InfluxDB:</strong> Download from <a href=https://portal.influxdata.com/downloads>https://portal.influxdata.com/downloads</a></p> <p>root@raspberrypi:~# tar xf influxdb-1.2.0_linux_armhf.tar.gz root@raspberrypi:~# cp -a influxdb-1.2.0-1/* /</p> <p>vim /etc/influxdb/influxdb.ini:</p> <p>[admin] enabled=true</p> <p>[http] enabled=true</p> <p>[collectd] enabled=true bind-address=":25826" database="collectd"</p> <p>Then run "influxdb &amp;" and check it out in http://localhost:8083, add db named "collectd".</p> <p><strong>Install Collectd:</strong></p> <p>root@raspberrypi:~# apt-get install collectd</p> <p>In /etc/collectd/collectd.conf, find :</p> <p><plugin network> <server &quot;localhost&quot; &quot;25826&quot;></server> </plugin></p> <p>Then restart collectd service.</p> <h3 id=now-you-can-visit-httplocalhost3000-to-add-influxdb-source-and-add-panel><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#now-you-can-visit-httplocalhost3000-to-add-influxdb-source-and-add-panel>Now you can visit http://localhost:3000 to add InfluxDB source and add panel.</a></h3> <p>title: "Hercules with Jason UI, emulator of IBM mainframe" date: 2017-04-26 categories: - "linux-admin"</p> <hr> <p>Hercules is an open source software implementation of the mainframe System/370 and ESA/390 architectures, in addition to the new 64-bit z/Architecture. Hercules runs under Linux, Windows (98, NT, 2000, and XP), Solaris, FreeBSD, and Mac OS X (10.3 and later).</p> <p><a href=http://lofyer.org:8081/ >Online web interface.(deprecated)</a></p> <p>Jason 1.00 is an integrated graphical frontend to the Hercules S/370, ESA/390 and z/Architecture Emulator. What, you haven't heard of Hercules before? It's a masterpiece that emulates IBM mainframes, from old good IBM System/360 and up to the modern z Series... No, it has nothing to do with IBM compatible... No, it can't emulate Xbox 360... Oh, you are asking what a mainframe is? Then probably you don't need Jason.</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/Hercules-with-Jason.zip>Download Hercules with Jason</a>.</p> <h3 id=_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#_1><a href=https://blog.lofyer.org/wp-content/uploads/QQ截图20170426111158.png><img alt src=/blog/images/QQ截图20170426111158-1024x545.png></a></a></h3> <p>title: "Heartbeat and drbd test high availability" date: 2014-01-16 categories: - "linux-admin"</p> <hr> <p>Hosts: 192.168.1.101 ha1.lofyer.org, 2 hard drive disks, two ethernet ports 192.168.1.103 ha2.lofyer.org, almost same as ha1</p> <p>Server host, this is the IP of heartbeat service: 192.168.1.100</p> <h3 id=install><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#install>Install</a></h3> <p>The repos you need in centos</p> <p>[epel] name=Extra Packages for Enterprise Linux 6 - $basearch</p> <h2 id=baseurlhttpdownloadfedoraprojectorgpubepel6basearch><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#baseurlhttpdownloadfedoraprojectorgpubepel6basearch>baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch</a></h2> <p>mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&amp;arch=$basearch failovermethod=priority enabled=1 gpgcheck=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6</p> <p>[elrepo] name=ELRepo.org Community Enterprise Linux Repository - el6 baseurl=http://elrepo.org/linux/elrepo/el6/$basearch/ mirrorlist=http://elrepo.org/mirrors-elrepo.el6 enabled=1 gpgcheck=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-elrepo.org protect=0</p> <h2 id=yum-install-drbd84-kmod-drbd84-heartbeat-mysql-server><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-drbd84-kmod-drbd84-heartbeat-mysql-server>yum install drbd84 kmod-drbd84 heartbeat mysql-server</a></h2> <h3 id=setup><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#setup>Setup</a></h3> <h4 id=1-drbd-configuration-both-hosts><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#1-drbd-configuration-both-hosts>1. Drbd configuration both hosts</a></h4> <p><strong>Add following content to file: /etc/hosts</strong></p> <p>192.168.1.101 ha1.lofyer.org 192.168.1.103 ha2.lofyer.org</p> <p><strong>Disable selinux and iptables</strong></p> <h2 id=sed-i-senforcingpermissive-etcselinuxconfig><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#sed-i-senforcingpermissive-etcselinuxconfig>sed -i 's/enforcing/permissive/' /etc/selinux/config</a></h2> <h2 id=setenforce-0><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#setenforce-0>setenforce 0</a></h2> <h2 id=chkconfig-iptables-off><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-iptables-off>chkconfig iptables off</a></h2> <h2 id=service-iptables-stop><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-iptables-stop>service iptables stop</a></h2> <p><strong>Prepare the disk partion</strong></p> <h2 id=fdisk-devsdb-eof><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#fdisk-devsdb-eof>fdisk /dev/sdb &lt;&lt; EOF</a></h2> <p>n p 1</p> <p>w EOF</p> <p><strong>Configuration for mysql</strong> # mkdir db # sed -i 's/datadir=\/var\/lib\/mysql/datadir=\/db/' /etc/my.cnf <strong>Configuration for drbd</strong> file: /etc/drbd.conf</p> <p>global { minor-count 64; usage-count yes; } common { syncer { rate 1000M; } } resource ha { protocol C; handlers { pri-on-incon-degr "/usr/lib/drbd/notify-pri-on-incon-degr.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"; pri-lost-after-sb "/usr/lib/drbd/notify-pri-lost-after-sb.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"; local-io-error "/usr/lib/drbd/notify-local-io-error.sh; /usr/lib/drbd/notify-emergency-shutdown.sh; echo o &gt; /proc/sysrq-trigger ; halt -f"; fence-peer /usr/lib/heartbeat/drbd-peer-outdater -t 5; pri-lost "/usr/lib/drbd/notify-pri-lost.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"; split-brain "/usr/lib/drbd/notify-split-brain.sh root"; out-of-sync "/usr/lib/drbd/notify-out-of-sync.sh root"; } startup { wfc-timeout 60; degr-wfc-timeout 120; outdated-wfc-timeout 2; } disk { on-io-error detach; fencing resource-only; } syncer { rate 1000M; } on ha1.lofyer.org { device /dev/drbd0; disk /dev/sdb1; address 192.168.1.101:7788; meta-disk internal; } on ha2.lofyer.org { device /dev/drbd0; disk /dev/sdb1; address 192.168.1.103:7788; meta-disk internal; } }</p> <p><strong>Chmod for drbd</strong></p> <p># chgrp haclient /sbin/drbdsetup # chmod o-x /sbin/drbdsetup # chmod u+s /sbin/drbdsetup # chgrp haclient /sbin/drbdmeta # chmod o-x /sbin/drbdmeta # chmod u+s /sbin/drbdmeta</p> <p><strong>Resource for drbd</strong></p> <p># modprobe drbd # dd if=/dev/zero of=/dev/hdb1 bs=1M count=100 # drbdadm create-md ha # service drbd start # chkconfig drbd on </p> <p><strong>Watch drbd status</strong></p> <h2 id=watch-n-1-service-drbd-status><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#watch-n-1-service-drbd-status>watch -n 1 service drbd status</a></h2> <p>You can see that both hosts are Secondary/Secondary.</p> <h4 id=2-drbd-configuration-on-one-of-hosts-like-ha1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#2-drbd-configuration-on-one-of-hosts-like-ha1>2. Drbd configuration on one of hosts, like ha1</a></h4> <p><strong>Make ha1 Primary</strong></p> <p># drbdadm -- --overwrite-data-of-peer primary ha # service drbd status</p> <p>Then you should see Primary and wait for both hosts are UpToDate. <strong>Initialization for Mysql</strong> Make a</p> <h2 id=mkfsext4-devdrbd0><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#mkfsext4-devdrbd0>mkfs.ext4 /dev/drbd0</a></h2> <h2 id=mount-devdrbd0-db><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#mount-devdrbd0-db>mount /dev/drbd0 /db</a></h2> <h2 id=service-mysqld-start><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-mysqld-start>service mysqld start</a></h2> <p>Now you should see what you have got in /db, then umount /db, stop mysql-server and make ha1 Secondary.</p> <h2 id=service-mysqld-stop><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-mysqld-stop>service mysqld stop</a></h2> <h2 id=umount-devdrbd0><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#umount-devdrbd0>umount /dev/drbd0</a></h2> <h2 id=drbdadm-secondary-ha><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#drbdadm-secondary-ha>drbdadm secondary ha</a></h2> <h4 id=3-heartbeat-configuration-on-both-hosts><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#3-heartbeat-configuration-on-both-hosts>3. Heartbeat configuration on both hosts</a></h4> <p><strong>cluster authkey</strong></p> <h2 id=echo-ne-auth-1n1-sha1-dd-ifdevurandom-bs512-count1-openssl-md5-etchadauthkeys><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#echo-ne-auth-1n1-sha1-dd-ifdevurandom-bs512-count1-openssl-md5-etchadauthkeys>(echo -ne "auth 1\n1 sha1 "; dd if=/dev/urandom bs=512 count=1 | openssl md5) &gt; /etc/ha.d/authkeys</a></h2> <h2 id=cat-etchadauthkeys><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#cat-etchadauthkeys>cat /etc/ha.d/authkeys</a></h2> <p>auth 1 1 sha1 71461fc5e160d7846c2f4b524f952128</p> <h2 id=chmod-600-etchadauthkeys><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chmod-600-etchadauthkeys>chmod 600 /etc/ha.d/authkeys</a></h2> <h2 id=scp-etchadauthkeys-node2etchad><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#scp-etchadauthkeys-node2etchad>scp /etc/ha.d/authkeys node2:/etc/ha.d/</a></h2> <p>YOU SHOULD MODIFY THE IP IN THE FILE. file: /etc/ha.d/ha.cf</p> <p>debugfile /var/log/ha-debug logfile /var/log/ha-log logfacility local0 autojoin none ucast eth0 192.168.1.101 ucast eth1 192.168.1.102 ping 192.168.1.100 respawn hacluster /usr/lib64/heartbeat/ipfail respawn hacluster /usr/lib64/heartbeat/dopd apiauth dopd gid=haclient uid=hacluster udpport 694 warntime 5 deadtime 15 initdead 60 keepalive 2 node ha1.lofyer.org node ha2.lofyer.org auto_failback off </p> <p>The service will be serve on IP 192.168.1.100. file: /etc/ha.d/haresources</p> <p>mysql.lofyer.org 192.168.1.100 drbddisk::ha Filesystem::/dev/drbd0::/db::ext4 mysql</p> <p>If you just wanna a virtual ip, use this</p> <p>hosta.vf.com IPaddr::192.168.0.100/24/eth0:0</p> <p><strong>Add mysql entry to heartbeat</strong> file: /etc/ha.d/resource.d/mysql</p> <h2 id=binbash><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#binbash>!/bin/bash</a></h2> <p>. /etc/ha.d/shellfuncs case "<span class=arithmatex>\(1" in start) res=\`/etc/init.d/mysqld start\` ret=\)</span>? ha_log $res exit <span class=arithmatex>\(ret ;; stop) res=\`/etc/init.d/mysqld stop\` ret=\)</span>? ha_log $res exit $ret ;; status) if [[ `ps -ef | grep '[m]ysqld'` &gt; 1 ]]; then echo "running" else echo "stopped" fi ;; *) echo "Usage: mysqld {start|stop|status}" exit 1 ;; esac exit 0</p> <p>Add excute permission to it.</p> <h2 id=chmod-755-etchadresourcedmysql><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chmod-755-etchadresourcedmysql>chmod 755 /etc/ha.d/resource.d/mysql</a></h2> <p><strong>Add heartbeat service to system</strong></p> <h2 id=chkconfig-add-heartbeat><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-add-heartbeat>chkconfig --add heartbeat</a></h2> <h2 id=chkconfig-heartbeat-on><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-heartbeat-on>chkconfig heartbeat on</a></h2> <h2 id=service-heartbeat-start><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-heartbeat-start>service heartbeat start</a></h2> <p><em>You may need modify order of drbd and heartbeat service. In /etc/init.d/, the number 85 and 15 represent the order number which the script is to be run at start up time and shutdown time. # chkconfig: - 85 15</em></p> <h3 id=test-ha><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#test-ha>Test HA</a></h3> <hr> <p>title: "ltsp相关" date: 2013-03-15 categories: - "linux-admin"</p> <hr> <p>参考： https://help.ubuntu.com/community/UbuntuLTSP</p> <p>安装： apt-get install ltsp-server-standalone</p> <p>启动要素： nbd-server dhcpd tftp-hpa openssh-server</p> <p>绑定客户端地址： [dhcpd.conf] host client201 { hardware ethernet 08:00:27:89:70:01; fixed-address 192.168.0.201; } 另外一种是在启动pxe配置文件中指定 http://wiki.phys.ethz.ch/readme/setting_up_an_ltsp_server_for_diskless_clients</p> <p>session &amp; windows [/usr/share/xsession/*] Exec=/root/.xsession</p> <p>[/root/.xsession] #!/bin/bash gnome-session &amp; firefox logout</p> <p>获取session list [/usr/share/ldm/ldminfod] [/etc/X11/xinit/Xsession] [/etc/X11/Xsession] **failsafe [/etc/X11/xdm/Xsession] [/usr/lib/X11/xdm/Xsession] *[/usr/share/xsession]</p> <p>**default session exported by Xsession.d echo $DEFAULTS_PATH /usr/share/gconf/</p> <p>修改default session [/var/lib/tftp.../lts.conf] LDM_SESSION="gnome-session &amp;;firefox;logout"</p> <p>FatClient [/var/lib/tftp.../lts.conf] [default] LDM_DIRECTX=true</p> <p>[00:A1:08:EB:43:27] LTSP_FATCLIENT=false</p> <p>AutoLogin [/var/lib/tftp.../lts.conf] [Default] LDM_AUTOLOGIN = True</p> <p>[192.168.1.101] LDM_USERNAME = user1 LDM_PASSWORD = password1</p> <p>[192.168.1.102] LDM_USERNAME = user2 LDM_PASSWORD = password2</p> <h3 id=ltsconf-global-defaults-for-all-clients-if-you-refer-to-the-local-server-just-use-the-server-keyword-as-value-see-lts_parameterstxt-for-valid-values-default-x_color_depth24-localdevtrue-soundtrue-use_local_swaptrue-nbd_swapfalse-syslog_hostserver-xkblayoutde-screen_02shell-screen_03shell-screen_04shell-screen_05shell-screen_06shell-screen_07ldm-ldm_directxtrue-allows-greater-scalability-and-performance-turn-this-off-if-you-want-greater-security-instead-ldm_directxtrue-ldm_syslogtrue-writes-to-servers-syslog-ldm_syslogtrue><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ltsconf-global-defaults-for-all-clients-if-you-refer-to-the-local-server-just-use-the-server-keyword-as-value-see-lts_parameterstxt-for-valid-values-default-x_color_depth24-localdevtrue-soundtrue-use_local_swaptrue-nbd_swapfalse-syslog_hostserver-xkblayoutde-screen_02shell-screen_03shell-screen_04shell-screen_05shell-screen_06shell-screen_07ldm-ldm_directxtrue-allows-greater-scalability-and-performance-turn-this-off-if-you-want-greater-security-instead-ldm_directxtrue-ldm_syslogtrue-writes-to-servers-syslog-ldm_syslogtrue>一些参考配置 [lts.conf] # Global defaults for all clients # if you refer to the local server, just use the # "server" keyword as value # see lts_parameters.txt for valid values ################ [default] X_COLOR_DEPTH=24 LOCALDEV=True SOUND=True USE_LOCAL_SWAP=True NBD_SWAP=False SYSLOG_HOST=server #XKBLAYOUT=de SCREEN_02=shell SCREEN_03=shell SCREEN_04=shell SCREEN_05=shell SCREEN_06=shell SCREEN_07=ldm # LDM_DIRECTX=True allows greater scalability and performance # Turn this off if you want greater security instead. LDM_DIRECTX=True # LDM_SYSLOG=True writes to server's syslog LDM_SYSLOG=True</a></h3> <p>title: "IPA服务器搭建" date: 2012-11-27 categories: - "linux-admin"</p> <hr> <p>IPASERVER+DNS(DDWRT)+IPACLIENT</p> <p>SERVER: ipa-server-install时这里可以不要内部dns 注意host以及domain要在dns里有记录 添加用户 ipa user-add 设置密码 ipa passwd demo DNS: 下面是ddwrt的dnsmasq配置 <code>domain=ovirt.engine local=/ovirt.engine/ expand-hosts address=/ovirtmgmt.ovirt.engine/192.168.1.106 ptr-record=106.1.168.192.in-addr.arpa,"ovirtmgmt.ovirt.engine" address=/ipa.ovirt.engine/192.168.1.108 ptr-record=108.1.168.192.in-addr.arpa,"ipa.ovirt.engine" srv-host=_kerberos-master._tcp,ipa.ovirt.engine,88,0,100 srv-host=_kerberos-master._udp,ipa.ovirt.engine,88,0,100 srv-host=_kerberos._tcp,ipa.ovirt.engine,88,0,100 srv-host=_kerberos._udp,ipa.ovirt.engine,88,0,100 srv-host=_kpasswd._tcp,ipa.ovirt.engine,464,0,100 srv-host=_kpasswd._udp,ipa.ovirt.engine,464,0,100 srv-host=_ldap._tcp,ipa.ovirt.engine,389,0,100</code> <a href=http://69.164.197.168/wp-content/uploads/2012/11/QQ截图20121127132532.png><img alt src=/blog/images/QQ截图20121127132532.png title=QQ截图20121127132532></a></p> <p>IPACLIENT: install时注意域名及主机名正确</p> <p>OVIRT: 初次使用要在SERVER运行 kinit admin</p> <h3 id=reinstall-ipa-server-install-uninstall-u-ls-ld-varlibpki-ca-if-it-exists-run-pkiremove-pki_instance_rootvarlib-pki_instance_namepki-ca-force-yum-reinstall-pki-selinux><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#reinstall-ipa-server-install-uninstall-u-ls-ld-varlibpki-ca-if-it-exists-run-pkiremove-pki_instance_rootvarlib-pki_instance_namepki-ca-force-yum-reinstall-pki-selinux>reinstall出错时： # ipa-server-install --uninstall -U # ls -ld /var/lib/pki-ca If it exists run: # pkiremove -pki_instance_root=/var/lib -pki_instance_name=pki-ca --force # yum reinstall pki-selinux</a></h3> <p>title: "Intergrate owncloud with AD(LDAP)" date: 2014-04-24 categories: - "linux-admin"</p> <hr> <p>Windows 2008R2 server with AD role built. User group: <strong>owncloudgrp</strong> User in <strong>owncloudgrp</strong>: aaa, beta Users must have <strong>logon name, first name, last name</strong> set.</p> <h3 id=configure-the-owncloud><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#configure-the-owncloud>Configure the owncloud:</a></h3> <p>Server:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc1/ ><img alt=oc1 src=/blog/images/oc1.png></a></p> <p>User Filter:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc2/ ><img alt=oc2 src=/blog/images/oc2.png></a></p> <p>Login Filter:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc3/ ><img alt=oc3 src=/blog/images/oc3.png></a></p> <p>Group Filter: Every time you change these two sections, <strong>wait for a few seconds</strong> until more than zero users discovered.</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc4/ ><img alt=oc4 src=/blog/images/oc4.png></a></p> <p>Advanced - Connection Settings:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc5/ ><img alt=oc5 src=/blog/images/oc5.png></a></p> <p>Advanced - Directory Settings:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc6/ ><img alt=oc6 src=/blog/images/oc6.png></a></p> <p>Expert: Add internal username: sAMAccountName</p> <h3 id=_2><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#_2><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc7/ ><img alt=oc7 src=/blog/images/oc7.png></a></a></h3> <p>title: "use Foreman/Nagios/Icinga to make life easy..." date: 2013-09-24 categories: - "linux-admin"</p> <hr> <h2 id=install-nagios-in-gentoocentos><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#install-nagios-in-gentoocentos>Install nagios in Gentoo/CentOS</a></h2> <h3 id=gentoo><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#gentoo>Gentoo</a></h3> <h2 id=emerge-nagios><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#emerge-nagios>emerge nagios</a></h2> <h4 id=option-recompile-apache-for-php-support><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#option-recompile-apache-for-php-support>Option: recompile apache for php support</a></h4> <p>add use flag "apache2" to /etc/portage/make.conf</p> <h2 id=emerge-ask-changed-use-deep-world><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#emerge-ask-changed-use-deep-world>emerge --ask --changed-use --deep @world</a></h2> <h4 id=copy-following-content-to-etcapache2vhostsd><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#copy-following-content-to-etcapache2vhostsd>Copy following content to /etc/apache2/vhosts.d/</a></h4> <p>ScriptAlias /nagios/cgi-bin "/usr/lib64/nagios/cgi-bin" <directory &quot; usr lib64 nagios cgi-bin&quot;></p> <h2 id=sslrequiressl><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#sslrequiressl>SSLRequireSSL</a></h2> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code>Options ExecCGI
AllowOverride None
Order allow,deny
Allow from all
</code></pre></div></td></tr></table></div> <h2 id=order-denyallow><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#order-denyallow>Order deny,allow</a></h2> <h2 id=deny-from-all><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#deny-from-all>Deny from all</a></h2> <h2 id=allow-from-127001><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#allow-from-127001>Allow from 127.0.0.1</a></h2> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code>AuthName &quot;Nagios Access&quot;
AuthType Basic
AuthUserFile /etc/nagios/auth.users
Require valid-user
</code></pre></div></td></tr></table></div> <p>Alias /nagios "/usr/share/nagios/htdocs" <directory &quot; usr share nagios htdocs&quot;></p> <h2 id=sslrequiressl_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#sslrequiressl_1>SSLRequireSSL</a></h2> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code>Options None
AllowOverride None
Order allow,deny
Allow from all
</code></pre></div></td></tr></table></div> <h2 id=order-denyallow_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#order-denyallow_1>Order deny,allow</a></h2> <h2 id=deny-from-all_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#deny-from-all_1>Deny from all</a></h2> <h2 id=allow-from-127001_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#allow-from-127001_1>Allow from 127.0.0.1</a></h2> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code>AuthName &quot;Nagios Access&quot;
AuthType Basic
AuthUserFile /etc/nagios/auth.users
Require nagiosadmin
</code></pre></div></td></tr></table></div> <h4 id=create-password-for-nagiosadmin><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#create-password-for-nagiosadmin>Create password for nagiosadmin</a></h4> <h2 id=htpasswd2-c-etcnagiosauthusers-nagiosadmin><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#htpasswd2-c-etcnagiosauthusers-nagiosadmin>htpasswd2 -c /etc/nagios/auth.users nagiosadmin</a></h2> <h4 id=add-nagios-to-apache-config><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#add-nagios-to-apache-config>Add NAGIOS to apache config</a></h4> <p>/etc/conf.d/apache</p> <p>APACHE2_OPTS="... -D NAGIOS -D PHP5"</p> <p>Add user nagios to apache group</p> <h2 id=usermod-a-g-nagios-apache><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#usermod-a-g-nagios-apache>usermod -a -G nagios apache</a></h2> <p>Start service</p> <h2 id=rc-service-nagios-restart><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#rc-service-nagios-restart>rc-service nagios restart</a></h2> <h2 id=rc-service-apache2-restart><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#rc-service-apache2-restart>rc-service apache2 restart</a></h2> <h3 id=centos><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#centos>CentOS</a></h3> <h2 id=yum-install-nagios><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-nagios>yum install "nagios*"</a></h2> <h2 id=htpasswd-c-etcnagiospasswd-admin><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#htpasswd-c-etcnagiospasswd-admin>htpasswd -c /etc/nagios/passwd admin</a></h2> <h2 id=chkconfig-nagios-on><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-nagios-on>chkconfig nagios on</a></h2> <h2 id=chkconfig-httpd-on><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-httpd-on>chkconfig httpd on</a></h2> <h2 id=service-nagios-start><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-nagios-start>service nagios start</a></h2> <h2 id=service-httpd-start><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-httpd-start>service httpd start</a></h2> <h3 id=add-routershosts-add-service-add-hooks><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#add-routershosts-add-service-add-hooks>Add routers/hosts, add service, add hooks</a></h3> <h3 id=intergrate-with-ovirt><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#intergrate-with-ovirt>Intergrate with oVirt</a></h3> <h2 id=using-foreman><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#using-foreman>using Foreman</a></h2> <h3 id=install_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#install_1>Install</a></h3> <h3 id=use><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#use>USE</a></h3> <h3 id=intergrate-with-ovirt_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#intergrate-with-ovirt_1>Intergrate with oVirt</a></h3> <h3 id=tbd><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#tbd>TBD</a></h3> <p>title: "OAuth2 Guide" date: 2017-07-28 categories: - "linux-admin" - "draft"</p> <hr> <p>这是一篇OAuth2的入门短文，这就开始。</p> <p>整体可以参考<a href=https://www.ory.am/run-oauth2-server-open-source-api-security.html>Hydra OAuth2的搭建过程</a>，非常详细，过程就不讲了，直接看图更直观。</p> <p><img alt src=/blog/images/ORY%20Hydra%20Consent%20Flow.png></p> <h3 id=hostserverclientusercallback_urlopenid><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#hostserverclientusercallback_urlopenid>建议过程：在host上搭建server以后，创建client、user、callback_url，还能绑定OpenID，多好。</a></h3> <p>title: "OpenLDAP step by step how-to" date: 2014-04-14 categories: - "linux-admin"</p> <hr> <p>I need an authentication system with compatibility and many extended features(like bio-device). So, I've got AD, IPA and OpenLDAP to choose from. AD comes from MS and it is too "heavy" for the not-very-large system. IPA and OpenLDAP are almost same, but I prefer latter, since it's compatible with oVirt(This why I choose CentOS rather than debian).</p> <h2 id=the-simplest-openldap-server><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#the-simplest-openldap-server>The simplest OpenLDAP server</a></h2> <p>A basic LDAP without any security or additional features.</p> <h2 id=openldap-with-sasl><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#openldap-with-sasl>OpenLDAP with SASL</a></h2> <p>Add SASL to our LDAP.</p> <h2 id=openldap-with-samba><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#openldap-with-samba>OpenLDAP with SAMBA</a></h2> <p>To add Windows PC to our domain.</p> <h2 id=openldap-with-kerberos><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#openldap-with-kerberos>OpenLDAP with Kerberos</a></h2> <p>This is what we want finally. ============================================================</p> <h2 id=1-the-simplest-openldap-server><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#1-the-simplest-openldap-server>1. The simplest OpenLDAP server</a></h2> <p>I've got 2 ways to setup an openldap server: <strong>389-ds script</strong> and <strong>manually configure</strong>.</p> <h3 id=11-using-389-ds-script><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#11-using-389-ds-script>1.1 Using 389-ds script</a></h3> <p><a href=http://www.unixmen.com/setup-directory-serverldap-in-centos-6-4-rhel-6-4/ title="Setup 389-ds">Here's the original article.</a></p> <h4 id=preparation><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#preparation>Preparation</a></h4> <p>Before setup, this configuration should be modified. Add following:</p> <p>192.168.1.80 ldap.lofyer.org</p> <p>Add following:</p> <p>net.ipv4.tcp_keepalive_time = 30 net.ipv4.ip_local_port_range = 1024 65000 fs.file-max = 64000</p> <p>Add following:</p> <p>* soft nofile 8192 * hard nofile 8192</p> <p>Add following:</p> <p>session required /lib/security/pam_limits.so</p> <p>Then <strong>reboot</strong> the machine to make above configurations work.</p> <h4 id=setup-389-ds><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#setup-389-ds>Setup 389-ds</a></h4> <h2 id=useradd-ldapadmin><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#useradd-ldapadmin>useradd ldapadmin</a></h2> <h2 id=passwd-ldapadmin><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#passwd-ldapadmin>passwd ldapadmin</a></h2> <h2 id=yum-install-y-389-ds-openldap-clients><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-y-389-ds-openldap-clients>yum install -y 389-ds openldap-clients</a></h2> <h2 id=setup-ds-adminpl><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#setup-ds-adminpl>setup-ds-admin.pl</a></h2> <p>Then you'll see some questions like this(sorry for the high-lighting...):</p> <p>============================================================================== This program will set up the 389 Directory and Administration Servers.</p> <p>It is recommended that you have "root" privilege to set up the software. Tips for using this program: - Press "Enter" to choose the default and go to the next screen - Type "Control-B" then "Enter" to go back to the previous screen - Type "Control-C" to cancel the setup program</p> <p>Would you like to continue with set up? [yes]: ## Press Enter ## </p> <p>============================================================================== Your system has been scanned for potential problems, missing patches, etc. The following output is a report of the items found that need to be addressed before running this software in a production environment.</p> <p>389 Directory Server system tuning analysis version 23-FEBRUARY-2012.</p> <p>NOTICE : System is i686-unknown-linux2.6.32-431.el6.i686 (1 processor).</p> <p>WARNING: 622MB of physical memory is available on the system. 1024MB is recommended for best performance on large production system.</p> <p>WARNING : The warning messages above should be reviewed before proceeding.</p> <p>Would you like to continue? [no]: yes ## Type Yes and Press Enter ##</p> <p>============================================================================== Choose a setup type: 1. Express Allows you to quickly set up the servers using the most common options and pre-defined defaults. Useful for quick evaluation of the products. 2. Typical Allows you to specify common defaults and options. 3. Custom Allows you to specify more advanced options. This is recommended for experienced server administrators only. To accept the default shown in brackets, press the Enter key.</p> <p>Choose a setup type [2]: ## Press Enter ##</p> <p>============================================================================== Enter the fully qualified domain name of the computer on which you're setting up server software. Using the form . Example: eros.example.com.</p> <p>To accept the default shown in brackets, press the Enter key.</p> <p>Warning: This step may take a few minutes if your DNS servers can not be reached or if DNS is not configured correctly. If you would rather not wait, hit Ctrl-C and run this program again with the following command line option to specify the hostname:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code>General.FullMachineName=your.hostname.domain.name
</code></pre></div></td></tr></table></div> <p>Computer name [ldap.lofyer.org]: ## Press Enter ##</p> <p>============================================================================== he servers must run as a specific user in a specific group. It is strongly recommended that this user should have no privileges on the computer (i.e. a non-root user). The setup procedure will give this user/group some permissions in specific paths/files to perform server-specific operations.</p> <p>If you have not yet created a user and group for the servers, create this user and group using your native operating system utilities.</p> <p>System User [nobody]: ldapadmin ## Enter LDAP user name created above # System Group [nobody]: ldapadmin</p> <p>============================================================================== Server information is stored in the configuration directory server. This information is used by the console and administration server to configure and manage your servers. If you have already set up a configuration directory server, you should register any servers you set up or create with the configuration server. To do so, the following information about the configuration server is required: the fully qualified host name of the form .(e.g. hostname.example.com), the port number (default 389), the suffix, the DN and password of a user having permission to write the configuration information, usually the configuration directory administrator, and if you are using security (TLS/SSL). If you are using TLS/SSL, specify the TLS/SSL (LDAPS) port number (default 636) instead of the regular LDAP port number, and provide the CA certificate (in PEM/ASCII format).</p> <p>If you do not yet have a configuration directory server, enter 'No' to be prompted to set up one. Do you want to register this software with an existing configuration directory server? [no]: ## Press Enter ##</p> <p>============================================================================== Please enter the administrator ID for the configuration directory server. This is the ID typically used to log in to the console. You will also be prompted for the password. Configuration directory server administrator ID [admin]: ## Press Enter ## Password: ## create password ## Password (confirm): ## re-type password ##</p> <p>============================================================================== The information stored in the configuration directory server can be separated into different Administration Domains. If you are managing multiple software releases at the same time, or managing information about multiple domains, you may use the Administration Domain to keep them separate.</p> <p>If you are not using administrative domains, press Enter to select the default. Otherwise, enter some descriptive, unique name for the administration domain, such as the name of the organization responsible for managing the domain.</p> <p>Administration Domain [lofyer.org]: ## Press Enter ##</p> <p>============================================================================== The standard directory server network port number is 389. However, if you are not logged as the superuser, or port 389 is in use, the default value will be a random unused port number greater than 1024. If you want to use port 389, make sure that you are logged in as the superuser, that port 389 is not in use. Directory server network port [389]: ## Press Enter ##</p> <p>============================================================================== Each instance of a directory server requires a unique identifier. This identifier is used to name the various instance specific files and directories in the file system, as well as for other uses as a server instance identifier.</p> <p>Directory server identifier [server]: ## Press Enter ##</p> <p>============================================================================== The suffix is the root of your directory tree. The suffix must be a valid DN. It is recommended that you use the dc=domaincomponent suffix convention. For example, if your domain is example.com, you should use dc=example,dc=com for your suffix. Setup will create this initial suffix for you, but you may have more than one suffix. Use the directory server utilities to create additional suffixes.</p> <p>Suffix [dc=lofyer, dc=org]: ## Press Enter ##</p> <p>=============================================================================</p> <p>Certain directory server operations require an administrative user. This user is referred to as the Directory Manager and typically has a bind Distinguished Name (DN) of cn=Directory Manager. You will also be prompted for the password for this user. The password must be at least 8 characters long, and contain no spaces. Press Control-B or type the word "back", then Enter to back up and start over. Directory Manager DN [cn=Directory Manager]: ## Press Enter ## Password: ## Enter the password ## Password (confirm): </p> <p>============================================================================== The Administration Server is separate from any of your web or application servers since it listens to a different port and access to it is restricted.</p> <p>Pick a port number between 1024 and 65535 to run your Administration Server on. You should NOT use a port number which you plan to run a web or application server on, rather, select a number which you will remember and which will not be used for anything else. Administration port [9830]: ## Press Enter ##</p> <p>============================================================================== The interactive phase is complete. The script will now set up your servers. Enter No or go Back if you want to change something.</p> <p>Are you ready to set up your servers? [yes]: ## Press Enter ## Creating directory server . . . Your new DS instance 'server' was successfully created. Creating the configuration directory server . . . Beginning Admin Server creation . . . Creating Admin Server files and directories . . . Updating adm.conf . . . Updating admpw . . . Registering admin server with the configuration directory server . . . Updating adm.conf with information from configuration directory server . . . Updating the configuration for the httpd engine . . . Starting admin server . . . output: Starting dirsrv-admin: output: [ OK ] The admin server was successfully started. Admin server was successfully created, configured, and started. Exiting . . . Log file is '/tmp/setupo1AlDy.log' </p> <p>Then make these two services start on startup.</p> <h2 id=chkconfig-dirsrv-on><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-dirsrv-on>chkconfig dirsrv on</a></h2> <h2 id=chkconfig-dirsrv-admin-on><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-dirsrv-admin-on>chkconfig dirsrv-admin on</a></h2> <p>With 389-ds scripts, you could use 389-console, please refer to the link above.</p> <h3 id=12-manually-configure><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#12-manually-configure>1.2 Manually configure</a></h3> <p><a href=https://n40lab.wordpress.com/2013/11/22/creating-a-simple-ldap-directory-with-openldap-2-4-in-centos-6-4/ title="simple ldap">Here's the original article.</a></p> <h4 id=install-the-packages><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#install-the-packages>Install the packages</a></h4> <h2 id=yum-install-openldap-clients-servers><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-openldap-clients-servers>yum install openldap{,-clients,-servers}</a></h2> <h4 id=change-the-configuration><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#change-the-configuration>Change the configuration</a></h4> <p><em>/etc/openldap/slapd.d/cn\=config.ldif</em> Delete <strong>olcAllows: bind_v2</strong> if you want only v3. Modify <strong>olcIdleTimeout</strong> from 0 to 30 if you want close the idle connection for more than 30 seconds.</p> <p>Before next step, run this command to generate a SHA encrypted password.</p> <h2 id=slappasswd><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#slappasswd>slappasswd</a></h2> <p>New password: Re-enter new password: {SSHA}aW7TYJ3faz13RKsnr3uiCsbgi55RKhW9</p> <p>Then copy the output to your clipboard.</p> <p><em>/etc/openldap/slapd.d/cn\=config/olcDatabase\=\{2\}bdb.ldif</em> Modify <strong>olcSuffix</strong>, <strong>RootDN</strong>, <strong>olcRootPW</strong> to this:</p> <p>... olcSuffix: dc=lofyer, dc=org olcRootPW: {SSHA}aW7TYJ3faz13RKsnr3uiCsbgi55RKhW9 RootDN: cn=admin, dc=lofyer, dc=org ...</p> <h4 id=start-service><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#start-service>Start service</a></h4> <h2 id=service-slapd-start><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-slapd-start>service slapd start</a></h2> <h2 id=chkconfig-slpad-on><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-slpad-on>chkconfig slpad on</a></h2> <h4 id=add-rootdn-and-groups><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#add-rootdn-and-groups>Add rootdn and groups</a></h4> <p>dn: dc=lofyer,dc=org objectclass: dcObject objectclass: organization o: Lofyer Org dc: lofyer</p> <p>dn: ou=People,dc=lofyer,dc=org objectClass: organizationalUnit objectClass: top ou: People</p> <p>dn: ou=Groups,dc=lofyer,dc=org objectClass: organizationalUnit objectClass: top</p> <p>ou: Groups dn: cn=admin,dc=lofyer,dc=org objectclass: organizationalRole cn: admin</p> <p>Import the ldif:</p> <h2 id=ldapadd-x-d-cnadmindclofyerdcorg-w-f-etcopenldapschemalofyerorgldif><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ldapadd-x-d-cnadmindclofyerdcorg-w-f-etcopenldapschemalofyerorgldif>ldapadd -x -D "cn=admin,dc=lofyer,dc=org" -W -f /etc/openldap/schema/lofyer.org.ldif</a></h2> <h2 id=ldapsearch-x-b-dclofyerdcorg-objectclass><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ldapsearch-x-b-dclofyerdcorg-objectclass>ldapsearch -x -b 'dc=lofyer,dc=org' '(objectclass=*)'</a></h2> <h4 id=create-a-user><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#create-a-user>Create a user</a></h4> <p>Add following content to <em>user.ldif</em></p> <p>dn: uid=demo,ou=People,dc=lofyer,dc=org objectclass: top objectclass: person objectclass: inetOrgPerson objectclass: organizationalPerson uid: demo cn: demo sn: demo givenName: demo</p> <p>Provide a password:</p> <h2 id=ldapadd-x-w-d-cnadmindclofyerdcorg-f-userldif><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ldapadd-x-w-d-cnadmindclofyerdcorg-f-userldif>ldapadd -x -W -D "cn=admin,dc=lofyer,dc=org" -f user.ldif</a></h2> <p>New password: Re-enter new password: Enter LDAP Password:</p> <h4 id=add-or-delete-a-member-from-groupmyteam><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#add-or-delete-a-member-from-groupmyteam>Add or delete a member from group(myteam)</a></h4> <p><strong>Add:</strong> dn: cn=myteam,ou=Groups,dc=lofyer,dc=org changetype: modify add: member member: uid=user1,ou=People,dc=lofyer,dc=org</p> <h2 id=ldapmodify-x-d-cnadmindclofyerdcorg-w-f-addldif><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ldapmodify-x-d-cnadmindclofyerdcorg-w-f-addldif>ldapmodify -x -D "cn=admin,dc=lofyer,dc=org" -W -f add.ldif</a></h2> <p><strong>Delete:</strong></p> <p>dn: cn=myteam,ou=Groups,dc=lofyer,dc=org changetype: modify delete: member member: uid=user1,ou=People,dc=lofyer,dc=org</p> <h2 id=ldapmodify-x-d-cnadmindclofyerdcorg-w-f-deleteldif><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ldapmodify-x-d-cnadmindclofyerdcorg-w-f-deleteldif>ldapmodify -x -D "cn=admin,dc=lofyer,dc=org" -W -f delete.ldif</a></h2> <h3 id=use-tsl><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#use-tsl>Use TSL</a></h3> <p><a href="http://www.overclockers.com/forums/showthread.php?t=726947" title="Setup ldap">Here's the original article.</a></p> <h3 id=not-necessarygenerate-ca><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#not-necessarygenerate-ca>(NOT NECESSARY)Generate CA</a></h3> <p>Follow this script.</p> <h2 id=binbash_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#binbash_1>!/bin/bash</a></h2> <h2 id=change-to-the-directory-and-clear-out-the-old-certs><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#change-to-the-directory-and-clear-out-the-old-certs>Change to the directory and clear out the old certs</a></h2> <p>cd /etc/openldap/certs rm -rf *</p> <h2 id=this-echo-statement-is-actually-putting-the-word-password-without-the-quotes-in-a-temporary-password-file-to-help><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#this-echo-statement-is-actually-putting-the-word-password-without-the-quotes-in-a-temporary-password-file-to-help>This echo statement is actually putting the word “password” (without the quotes) in a temporary password file to help</a></h2> <h2 id=automate-the-process-this-will-be-the-password-for-your-certificate-change-this-as-appropriate><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#automate-the-process-this-will-be-the-password-for-your-certificate-change-this-as-appropriate>automate the process. This will be the password for your certificate. Change this as appropriate</a></h2> <p>echo "mypassword" &gt; /etc/openldap/certs/password export PATH=/usr/bin/:$PATH echo falkdjfdajkasdndwndoqndwapqmhfaksj &gt;&gt; noise.txt</p> <h2 id=associate-the-password-with-the-certificates-which-will-be-generated-in-the-current-directory><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#associate-the-password-with-the-certificates-which-will-be-generated-in-the-current-directory>Associate the password with the certificates which will be generated in the current directory</a></h2> <p>certutil -N -d . -f /etc/openldap/certs/password certutil -G -d . -z noise.txt -f /etc/openldap/certs/password</p> <h2 id=generate-a-ca-certificate-for-the-389-server><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#generate-a-ca-certificate-for-the-389-server>Generate a CA certificate for the 389 server</a></h2> <p>certutil -S -n "CA certificate" -s "cn=CACert" -x -t "CT,," -m 1000 -v 120 -d . -z /etc/openldap/certs/noise.txt -f /etc/openldap/certs/password</p> <h2 id=anwsers-are-y-y><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#anwsers-are-y-y>anwsers are Y, , Y</a></h2> <h2 id=this-builds-the-server-cert><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#this-builds-the-server-cert>This builds the server cert</a></h2> <p>certutil -S -n "OpenLDAP Server" -s "cn=ldap.lofyer.org" -c "CA certificate" -t "u,u,u" -m 1001 -v 120 -d . -z /etc/openldap/certs/noise.txt -f /etc/openldap/certs/password</p> <h2 id=this-exports-the-cacert-in-case-you-need-it><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#this-exports-the-cacert-in-case-you-need-it>This exports the cacert in case you need it</a></h2> <p>pk12util -d . -o cacert.p12 -n "CA certificate"</p> <h2 id=this-exports-the-server-cert-which-you-will-need-on-the-windows-ad><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#this-exports-the-server-cert-which-you-will-need-on-the-windows-ad>This exports the server-cert which you will need on the windows AD</a></h2> <p>pk12util -d . -o servercert.p12 -n "OpenLDAP Server"</p> <h2 id=this-exports-the-ca-cert-for-ldap-clients><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#this-exports-the-ca-cert-for-ldap-clients>This exports the CA cert for ldap clients</a></h2> <p>certutil -L -d . -n "CA certificate" -a &gt; /etc/openldap/certs/cacert.pem</p> <h2 id=make-the-files-in-here-readable><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#make-the-files-in-here-readable>Make the files in here readable</a></h2> <p>chmod 644 *</p> <h2 id=set-the-system-to-use-ldaps><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#set-the-system-to-use-ldaps>Set the system to use LDAPS</a></h2> <p>sed -i 's/SLAPD_LDAPS=no/SLAPD_LDAPS=yes/g' /etc/sysconfig/ldap</p> <h2 id=add-a-firewall-exception-in-case-the-user-has-not-configured-their-firewall-properly><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#add-a-firewall-exception-in-case-the-user-has-not-configured-their-firewall-properly>Add a firewall exception in case the user has not configured their firewall properly</a></h2> <h2 id=iptables-i-input-m-state-state-new-p-tcp-dport-636-j-accept><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#iptables-i-input-m-state-state-new-p-tcp-dport-636-j-accept>iptables -I INPUT -m state --state NEW -p tcp --dport 636 -j ACCEPT</a></h2> <h2 id=etcinitdiptables-save><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#etcinitdiptables-save>/etc/init.d/iptables save</a></h2> <h2 id=restart-slapd-to-make-the-changes-take-effect><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#restart-slapd-to-make-the-changes-take-effect>Restart slapd to make the changes take effect</a></h2> <h2 id=etcinitdslapd-restart><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#etcinitdslapd-restart>/etc/init.d/slapd restart</a></h2> <p>I think you should notice that the private key password is "mypassword". Then you will get three files: <strong>cacert.p12</strong>, <strong>cacert.pem</strong>, <strong>servercert.p12</strong>. And, that's all.</p> <h2 id=2-add-sasl-to-openldap><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#2-add-sasl-to-openldap>2. Add SASL to OpenLDAP</a></h2> <p>OKay, we'll add SASL to our ldap connections.</p> <h3 id=install-cyrus-sasl-package><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#install-cyrus-sasl-package>Install cyrus-sasl package.</a></h3> <h2 id=yum-install-cyrus-sasl-gssapi><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-cyrus-sasl-gssapi>yum install cyrus-sasl-gssapi</a></h2> <h2 id=yum-install-cyrus-sasl-ldap><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-cyrus-sasl-ldap>yum install cyrus-sasl-ldap</a></h2> <hr> <p>title: "owncloud webdav intergration" date: 2013-01-03 categories: - "linux-admin"</p> <hr> <p>安装好owncloud后，可以使用webdav协议进行远程挂载，比如</p> <p>mount -t davfs {http://localhost/remote.php/webdav,http://localhost/files/webdav.php} /mnt</p> <p>2003上需启动webclient服务 而在2008上, webclient被集成到desktop experience组件中, 从service manager-&gt;feature中添加desktop experience,并且修改注册表HKEY_LOCAL_MACHINE-&gt;SYSTEM-&gt;CurrentControlSet-&gt;Services-&gt;WebClient-&gt;Parameters-&gt;BasicAuthLevel 的值为 2，重启服务 此时可映射网络驱动器，钩选“connect using different credentials”，输入其用户名密码即可 或者命令行</p> <p>NET USE * http://localhost/remote.php/webdav 123456 /user:admin</p> <h3 id=ps-1-owncloudapp-webdev-2-owncloudapacheapachewww-datawww-datahtaccesss><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ps-1-owncloudapp-webdev-2-owncloudapacheapachewww-datawww-datahtaccesss>PS： 1. owncloud第三方app WebDev安装后会造成不能添加用户的麻烦 2. 修改owncloud目录权限为apache.apache或者www-data.www-data以使.htaccesss生效</a></h3> <p>title: "Using X server in Windows Linux Subsystem" date: 2016-10-09 categories: - "linux-admin"</p> <hr> <p>1. Turn on "Developer Mode" in Control panel. <a href=http://blog.lofyer.org/wp-content/uploads/developer-mode.png><img alt=developer-mode src=/blog/images/developer-mode.png></a> <a href=http://blog.lofyer.org/wp-content/uploads/sss.png><img alt=sss src=/blog/images/sss.png></a></p> <p>2. Run "bash" <a href=http://blog.lofyer.org/wp-content/uploads/bash.png><img alt=bash src=/blog/images/bash.png></a></p> <p>3. Install Xming(Xserver for Windows) <a href=https://sourceforge.net/projects/xming/ >Download</a></p> <p>4. Launch your app</p> <h2 id=export-display0><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#export-display0>export DISPLAY=:0</a></h2> <h2 id=firefox><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#firefox>firefox</a></h2> <p><a href=http://blog.lofyer.org/wp-content/uploads/launch.png><img alt=launch src=/blog/images/launch.png></a></p> <p>5. You can create a link on your desktop like this <a href=http://blog.lofyer.org/wp-content/uploads/aaa.png><img alt=aaa src=/blog/images/aaa.png></a></p> <p>and ~/.bashrc</p> <p>alias home='cd /mnt/c/Users/rex/Desktop' home export DISPLAY=:0</p> <p>Tips:</p> <h3 id=use-powershell-bash-instead-of-bash-you-can-access-your-service-in-this-way><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#use-powershell-bash-instead-of-bash-you-can-access-your-service-in-this-way>Use "powershell bash" instead of "bash", you can access your service in this way.</a></h3> <p>title: "Configure corosync and pacemaker" date: 2015-02-28 categories: - "linux-admin"</p> <hr> <p>Env: node1 eth0 192.168.0.201 node2 eth0 192.168.0.202</p> <h3 id=1-install-essential-packages><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#1-install-essential-packages>1. Install essential packages</a></h3> <p>Add following content to <em>/etc/yum.repos.d/ha.repo</em>, since you will need crmsh later:</p> <p>[haclustering] name=HA Clustering baseurl=http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/CentOS_CentOS-6/ enabled=1 gpgcheck=0</p> <p>Install packages:</p> <h2 id=yum-install-pacemaker-corosync-crmsh-y><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#yum-install-pacemaker-corosync-crmsh-y>yum install pacemaker corosync crmsh -y</a></h2> <h3 id=2-configure-corosync><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#2-configure-corosync>2. Configure corosync</a></h3> <p>Using configuration files below if you need broadcast:</p> <p>service { # Load the Pacemaker Cluster Resource Manager ver: 0 name: pacemaker use_mgmtd: no use_logd: no }</p> <p>totem { version: 2 secauth: off interface { member { memberaddr: 192.168.0.201 } member { memberaddr: 192.168.0.202 } ringnumber: 0 bindnetaddr: 192.168.0.0 mcastport: 5405 ttl: 1 } transport: udpu }</p> <p>logging { fileline: off to_logfile: yes to_syslog: yes logfile: /var/log/cluster/corosync.log debug: off timestamp: on logger_subsys { subsys: AMF debug: off } }</p> <p>Here's a sample using multicast:</p> <p>service { # Load the Pacemaker Cluster Resource Manager ver: 0 name: pacemaker use_mgmtd: no use_logd: no }</p> <p>totem { version: 2</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span></pre></div></td><td class=code><div><pre><span></span><code>    # secauth: Enable mutual node authentication. If you choose to
    # enable this (&quot;on&quot;), then do remember to create a shared
    # secret with &quot;corosync-keygen&quot;.
    secauth: off

    threads: 0

    # interface: define at least one interface to communicate
    # over. If you define more than one interface stanza, you must
    # also set rrp\_mode.
    interface {
            ringnumber: 0
            bindnetaddr: 192.168.1.0
            mcastaddr: 239.255.1.1
            mcastport: 5405
            ttl: 1
    }
</code></pre></div></td></tr></table></div> <p>}</p> <p>logging { fileline: off to_stderr: no to_logfile: yes logfile: /var/log/cluster/corosync.log to_syslog: yes debug: off timestamp: on logger_subsys { subsys: AMF debug: off } }</p> <p>Note that if the <strong>ver</strong> in the <strong>service</strong> section of pacemaker is <strong>0</strong>, pacemaker will be loaded automatically, or else you will start the pacemaker service manually.</p> <p>Copy this configuration file to the other host and start the service:</p> <h2 id=scp-etccorosynccorosyncconf-root1921680202etccorosynccorosyncconf><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#scp-etccorosynccorosyncconf-root1921680202etccorosynccorosyncconf>scp /etc/corosync/corosync.conf root@192.168.0.202:/etc/corosync/corosync.conf</a></h2> <p>On 192.168.0.201:</p> <h2 id=chkconfig-corosync-on><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-corosync-on>chkconfig corosync on</a></h2> <h2 id=service-corosync-start><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-corosync-start>service corosync start</a></h2> <p>On 192.168.0.202:</p> <h2 id=chkconfig-corosync-on_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-corosync-on_1>chkconfig corosync on</a></h2> <h2 id=service-corosync-start_1><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#service-corosync-start_1>service corosync start</a></h2> <h3 id=3-configure-corosync-using-crmsh><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#3-configure-corosync-using-crmsh>3. Configure corosync using crmsh</a></h3> <p>Add virtual IP to your cluster:</p> <h2 id=crm-configure><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#crm-configure>crm configure</a></h2> <p>crm(live)configure# primitive vip1 ocf<img alt=💓 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f493.svg title=:heartbeat:>IPaddr2 params ip=192.168.0.209 cidr_netmask=24 op monitor interval=10s crm(live)configure# property stonith-enabled=false # To prevent split-brain crm(live)configure# property no-quorum-policy=stop # To prevent split-brain crm(live)configure# commit</p> <p>Test:</p> <p>crm(live)configure# migrate vip1 crm(live)configure# unmigrate vip1</p> <h3 id=you-will-see-1921680209-migrating-between-these-two-nodes><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#you-will-see-1921680209-migrating-between-these-two-nodes>You will see 192.168.0.209 migrating between these two nodes.</a></h3> <p>title: "Deploy Skype for Business Server 2015" date: 2015-08-12 categories: - "cloud-infra"</p> <hr> <h2 id=server-preparation><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#server-preparation>Server Preparation</a></h2> <p>ad(ad.virtfan.com): Windows Server 2012 R2 lync(lync.virtfan.com): Windows Server 2012 R2 Following instruction is for <strong>LAN</strong>.</p> <p>Ref: <a href=https://technet.microsoft.com/en-us/library/dn933900.aspx>https://technet.microsoft.com/en-us/library/dn933900.aspx</a> <a href=http://lync.community.ge/post/2012/07/18/Install-Lync-2013-in-windows-server-2008-r2-(Part-1).aspx>Install lync 2013 server in win2008r2</a></p> <h2 id=procedure><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#procedure>Procedure</a></h2> <p>1. After a fresh installation of Windows Server 2012 R2, we will <strong>update</strong> it to latest. 2. We need create an AD DS with AD CS in ad.virtfan.com. So that we can retrieve CA to complete our deployment. 3. Then we start setting up Skype Server in lync.virtfan.com(in domain virtfan.com). 4. Set up DNS, add more users, use lync to communicate.</p> <h3 id=ad-preparation><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#ad-preparation>AD Preparation</a></h3> <p>Following steps are in ad.virtfan.com. 1. Assign a static IP. Change computer name to ad. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8a%e5%8d%8811-42-27/ ><img alt="屏幕快照 2015-08-13 上午11.42.27" src=/blog/images/屏幕快照-2015-08-13-上午11.42.27-1024x632.png></a> 2. Add Active Directory Domain Service and DNS Roles. Create a new forest(virtfan.com) with level Windows 2008 R2. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8a%e5%8d%8811-59-27/ ><img alt="屏幕快照 2015-08-13 上午11.59.27" src=/blog/images/屏幕快照-2015-08-13-上午11.59.27-300x172.png></a> 3. Add Active Directory Certificate Service Role with all the six features checked. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%8812-07-28/ ><img alt="屏幕快照 2015-08-13 下午12.07.28" src=/blog/images/屏幕快照-2015-08-13-下午12.07.28-300x128.png></a> 4. (Optional)Run gpmc.msc, right click on the Default Domain Policy to edit. Change Password Complexity to False. Run gpupdate /force to update the group policy. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%8812-15-33/ ><img alt="屏幕快照 2015-08-13 下午12.15.33" src=/blog/images/屏幕快照-2015-08-13-下午12.15.33-1024x543.png></a></p> <h3 id=skype-server-preparation><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#skype-server-preparation>Skype Server Preparation</a></h3> <p>Following steps are in lync.virtfan.com. <strong>Make sure you have got more than 32GB space in C:</strong>. 1. Assign a static IP, change name to lync and join domain virtfan.com. Add following features: <em>.Net Framework 3.5, .Net Framework 4.5 -&gt; WCF Services -&gt; HTTP Activation, Media Foundation, Remote Server Administration Tools -&gt; Role Administration Tools -&gt; AD DS and AD LDS Tools -&gt; Windows Identity Foundation 3.5</em> 2. Add IIS Role with following features: <em>静态内容、默认文档、HTTP 错误、ASP.NET、.NET 扩展性、Internet 服务器 API (ISAPI)扩展、ISAPI 筛选器、HTTP 日志记录、日志记录工具、跟踪、客户端证书映射身份验证、Windows 身份验证、请求筛选、静态内容压缩、动态内容压缩、IIS 管理控制台、IIS 管理脚本和工具</em> 3. <strong>Logon as VIRTFAN\Administrator</strong> and add feature .Net3.5. 4. Install KB2982006. 5. Mount Skype Business 2015 ISO and run Setup to install.</p> <h3 id=setting-up-skype-server><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#setting-up-skype-server>Setting up Skype Server</a></h3> <p>Following steps are in lync.virtfan.com and logon as VIRTFAN\Administrator and add feature .Net3.5. 1. Create a directory in C:\share, make it sharable and writable. 2. Run Skype for Business Server 部署向导(Deploy Wizard) from Start menu. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%881-47-56/ ><img alt="屏幕快照 2015-08-13 下午1.47.56" src=/blog/images/屏幕快照-2015-08-13-下午1.47.56.png></a> 3. Then we will are going to follow the steps in Prepare Active Directory. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%881-51-16/ ><img alt="屏幕快照 2015-08-13 下午1.51.16" src=/blog/images/屏幕快照-2015-08-13-下午1.51.16.png></a> 4. Click Prepare the first Standard Edition Server. It will create database. 5. Install management utilities. 6. Run Skype for Business Server topology generator from Start menu to generate a topology. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-31-16/ ><img alt="屏幕快照 2015-08-13 下午2.31.16" src=/blog/images/屏幕快照-2015-08-13-下午2.31.16.png></a> 7. Create a new topology like this: <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-37-53/ ><img alt="屏幕快照 2015-08-13 下午2.37.53" src=/blog/images/屏幕快照-2015-08-13-下午2.37.53.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-38-07/ ><img alt="屏幕快照 2015-08-13 下午2.38.07" src=/blog/images/屏幕快照-2015-08-13-下午2.38.07.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-39-23/ ><img alt="屏幕快照 2015-08-13 下午2.39.23" src=/blog/images/屏幕快照-2015-08-13-下午2.39.23.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-40-04/ ><img alt="屏幕快照 2015-08-13 下午2.40.04" src=/blog/images/屏幕快照-2015-08-13-下午2.40.04.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-40-47/ ><img alt="屏幕快照 2015-08-13 下午2.40.47" src=/blog/images/屏幕快照-2015-08-13-下午2.40.47.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-41-15/ ><img alt="屏幕快照 2015-08-13 下午2.41.15" src=/blog/images/屏幕快照-2015-08-13-下午2.41.15.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-41-44/ ><img alt="屏幕快照 2015-08-13 下午2.41.44" src=/blog/images/屏幕快照-2015-08-13-下午2.41.44.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-42-14/ ><img alt="屏幕快照 2015-08-13 下午2.42.14" src=/blog/images/屏幕快照-2015-08-13-下午2.42.14.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-42-49/ ><img alt="屏幕快照 2015-08-13 下午2.42.49" src=/blog/images/屏幕快照-2015-08-13-下午2.42.49.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-43-32/ ><img alt="屏幕快照 2015-08-13 下午2.43.32" src=/blog/images/屏幕快照-2015-08-13-下午2.43.32.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-43-58/ ><img alt="屏幕快照 2015-08-13 下午2.43.58" src=/blog/images/屏幕快照-2015-08-13-下午2.43.58.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-44-27/ ><img alt="屏幕快照 2015-08-13 下午2.44.27" src=/blog/images/屏幕快照-2015-08-13-下午2.44.27.png></a> Click Finish and right click on the Skype for Business Server to edit property. Fill in the admin url like: <em>https://admin.virtfan.com</em> Select a fronted server as central server. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-46-44/ ><img alt="屏幕快照 2015-08-13 下午2.46.44" src=/blog/images/屏幕快照-2015-08-13-下午2.46.44.png></a> 8. Publish topology. 9. Click Install or update Skype for Business Server System. And follow its guide. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-52-18/ ><img alt="屏幕快照 2015-08-13 下午2.52.18" src=/blog/images/屏幕快照-2015-08-13-下午2.52.18.png></a> 10. When you are in Step.3(Assign Certificate). Click Request to request certificate from ad.virtfan.com. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-53-49/ ><img alt="屏幕快照 2015-08-13 下午2.53.49" src=/blog/images/屏幕快照-2015-08-13-下午2.53.49.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-54-39/ ><img alt="屏幕快照 2015-08-13 下午2.54.39" src=/blog/images/屏幕快照-2015-08-13-下午2.54.39.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-54-39/ ><img alt="屏幕快照 2015-08-13 下午2.54.39" src=/blog/images/屏幕快照-2015-08-13-下午2.54.39.png></a> 11. Run start-cspool from cmd to start the server. Warning is OK, error is not OK. 12. Define your DNS and port-forwarding(443) so that we can use Skype from WAN.</p> <p>https://meet.virtfan.com -&gt; lync.virtfan.com's IP https://lync.virtfan.com -&gt; lync.virtfan.com's IP https://dialin.virtfan.com -&gt; lync.virtfan.com's IP https://admin.virtfan.com -&gt; lync.virtfan.com's IP (optional)https://ad.virtfan.com -&gt; ad.virtfan.com's IP</p> <p>13. Add domain users and assign users via https://admin.virtfan.com. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%883-10-58/ ><img alt="屏幕快照 2015-08-13 下午3.10.58" src=/blog/images/屏幕快照-2015-08-13-下午3.10.58-1024x538.png></a></p> <h2 id=lyncskype-client><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#lyncskype-client>Lync/Skype Client</a></h2> <p>1. Install Lync/Skype within Microsoft Office 2013 or Office365. 2. Download and install CA from https://ad.virtfan.com/certsrv/ or you can put it somewhere else. 3. Configure your client like this: <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/lync/ ><img alt=lync src=/blog/images/lync.png></a> 4. Click Logon.</p> <p>Here you go!</p> <h2 id=wan><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#wan>WAN</a></h2> <p>If you are using servers behind a firewall or a router, you should add something like this. 1. On your DNS provider, set these 6 A records lync/admin/dialin/meet/lyncdiscover/lyncdiscoverinternal.virtfan.com to your WAN IP. 2. Port forward from 443,5601 to lync server LAN IP. (Alternative)2. If you are using Apache virtualhost, you'll need export certificate and its private key of lync.virtfan.com to the Apache server with <a href=https://github.com/iSECPartners/jailbreak-Windows.git>jailbreak</a> and configure all 6 domain names like this:</p> <h2 id=vi-apacheconfdsslconf><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#vi-apacheconfdsslconf>vi /apache/conf.d/ssl.conf</a></h2> <p>... <virtualhost \*:443> ServerName skype.virtfan.com SSLEngine on SSLProxyEngine on SSLCertificateFile /etc/httpd/conf.d/lync-ca/lync.virtfan.com.cer SSLCertificateKeyFile /etc/httpd/conf.d/lync-ca/lync.virtfan.com.key ProxyRequests Off ProxyPass / https://skype.virtfan.com/ ProxyPassReverse / https://skype.virtfan.com/ </virtualhost> ...</p> <h2 id=vi-etchttpdconfdvproxyconf><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#vi-etchttpdconfdvproxyconf>vi /etc/httpd/conf.d/vproxy.conf</a></h2> <p><virtualhost \*:80> ServerName lyncdiscover.virtfan.com ProxyRequests Off ProxyPass / http://lyncdiscover.virtfan.com/ ProxyPassReverse / http://lyncdiscover.virtfan.com/ </virtualhost></p> <p><virtualhost \*:80> ServerName lyncdiscoverinternal.virtfan.com ProxyRequests Off ProxyPass / http://lyncdiscoverinternal.virtfan.com/ ProxyPassReverse / http://lyncdiscoverinternal.virtfan.com/ </virtualhost></p> <h2 id=vi-etchosts><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#vi-etchosts>vi /etc/hosts</a></h2> <p>... 192.168.122.222 admin.virtfan.com 192.168.122.222 lync.virtfan.com 192.168.122.222 dialin.virtfan.com 192.168.122.222 skype.virtfan.com 192.168.122.222 meet.virtfan.com 192.168.122.222 lyncdiscover.virtfan.com 192.168.122.222 lyncdiscoverinternal.virtfan.com ...</p> <p>And configure iptables:</p> <h2 id=iptables-t-nat-a-prerouting-p-tcp-dport-5061-j-dnat-to-destination-1921681222225061><a class=toclink href=../../../../2014/02/10/deploy-asterisk-on-centos/#iptables-t-nat-a-prerouting-p-tcp-dport-5061-j-dnat-to-destination-1921681222225061>iptables -t nat -A PREROUTING -p tcp --dport 5061 -j DNAT --to-destination 192.168.122.222:5061</a></h2> <p>3. DO NOT ADD "Internal Server" in your lync client, "External Server" will be enough.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-01-19 00:00:00">2014年1月19日</time></li> <li class=md-meta__item> 分类于 <a href=../../../../category/mylife/ class=md-meta__link>mylife</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=2013-2014><a href=../../../../2014/01/19/2013-2014/ class=toclink>2013-2014</a></h2> <p>今年已经24岁了，从一个普通人生的轨迹来看，这些年应该还能接受。 2013年，成长了些，在这要感谢敖总辛苦栽培。 关于互联网行业，应该是爆发的节奏的才对，要厚积。 关于科技行业，小米这类公司看的很准，下手也是外科手术式的准。 KP我觉得还是随身带着吧，手机少看些，因为形势至少还在意料内，每天耽误时间从中间甄别出可用信息的机会成本至少就目前来说有些高，不如直接获取知识来的实在。</p> <p>那么就2014，就列出来一些清单吧。 1. 在新年期间把MyIDC建设以及对应手册完成。 2. 掌握CLisp的常用特性。 3. 学习一些WPF编程。 4. 掌握法语基本语法，基本句式。 5. 入门无线电，考取A类执照。 6. 保持每天的锻炼。 7. 以上计划随工作重点可能有变。</p> </div> </article> <nav class=md-pagination> <a href=../../ class=md-pagination__link>1</a> <span class=md-pagination__current>2</span> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2024 lofyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.prune", "navigation.instant", "navigation.instant.progess"], "search": "../../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../../../assets/javascripts/bundle.525ec568.min.js></script> <script src=../../../../../javascripts/config.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>