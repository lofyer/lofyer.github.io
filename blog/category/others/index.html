<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=lofyer><link href=https://docs.lofyer.org/blog/category/others/ rel=canonical><link href=../new-world/ rel=prev><link href=../ovs/ rel=next><link rel=icon href=../../../images/favicon.ico><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.12"><title>others - Lofyer's Blog</title><link rel=stylesheet href=../../../assets/stylesheets/main.fad675c6.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.356b1318.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#others class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title="Lofyer's Blog" class="md-header__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lofyer's Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> others </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Index </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> 博客 </a> </li> <li class=md-tabs__item> <a href=../../../datanote/ class=md-tabs__link> Docs </a> </li> <li class=md-tabs__item> <a href=../../../about/about/ class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../template_password/ class=md-tabs__link> [密码保护]Template </a> </li> <li class=md-tabs__item> <a href=../../../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Lofyer's Blog" class="md-nav__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Lofyer's Blog </label> <div class=md-nav__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> 博客 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 博客 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../archive/2022/ class=md-nav__link> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 分类 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lab/ class=md-nav__link> <span class=md-ellipsis> Lab </span> </a> </li> <li class=md-nav__item> <a href=../abm/ class=md-nav__link> <span class=md-ellipsis> abm </span> </a> </li> <li class=md-nav__item> <a href=../ai/ class=md-nav__link> <span class=md-ellipsis> ai </span> </a> </li> <li class=md-nav__item> <a href=../cloud-infra/ class=md-nav__link> <span class=md-ellipsis> cloud-infra </span> </a> </li> <li class=md-nav__item> <a href=../collect/ class=md-nav__link> <span class=md-ellipsis> collect </span> </a> </li> <li class=md-nav__item> <a href=../devices/ class=md-nav__link> <span class=md-ellipsis> devices </span> </a> </li> <li class=md-nav__item> <a href=../diary/ class=md-nav__link> <span class=md-ellipsis> diary </span> </a> </li> <li class=md-nav__item> <a href=../draft/ class=md-nav__link> <span class=md-ellipsis> draft </span> </a> </li> <li class=md-nav__item> <a href=../filecoin/ class=md-nav__link> <span class=md-ellipsis> filecoin </span> </a> </li> <li class=md-nav__item> <a href=../followmyheart/ class=md-nav__link> <span class=md-ellipsis> followmyheart </span> </a> </li> <li class=md-nav__item> <a href=../fpga/ class=md-nav__link> <span class=md-ellipsis> fpga </span> </a> </li> <li class=md-nav__item> <a href=../hpc/ class=md-nav__link> <span class=md-ellipsis> hpc </span> </a> </li> <li class=md-nav__item> <a href=../inthecloud/ class=md-nav__link> <span class=md-ellipsis> inthecloud </span> </a> </li> <li class=md-nav__item> <a href=../linux-admin/ class=md-nav__link> <span class=md-ellipsis> linux-admin </span> </a> </li> <li class=md-nav__item> <a href=../modeling/ class=md-nav__link> <span class=md-ellipsis> modeling </span> </a> </li> <li class=md-nav__item> <a href=../my-books/ class=md-nav__link> <span class=md-ellipsis> my-books </span> </a> </li> <li class=md-nav__item> <a href=../mylife/ class=md-nav__link> <span class=md-ellipsis> mylife </span> </a> </li> <li class=md-nav__item> <a href=../new-world/ class=md-nav__link> <span class=md-ellipsis> new-world </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> others </span> </a> </li> <li class=md-nav__item> <a href=../ovs/ class=md-nav__link> <span class=md-ellipsis> ovs </span> </a> </li> <li class=md-nav__item> <a href=../tech/ class=md-nav__link> <span class=md-ellipsis> tech </span> </a> </li> <li class=md-nav__item> <a href=../%E4%BA%91%E8%AE%A1%E7%AE%97/ class=md-nav__link> <span class=md-ellipsis> 云计算 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Docs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../datanote/ class=md-nav__link> <span class=md-ellipsis> DataNote </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../inthecloud/ class=md-nav__link> <span class=md-ellipsis> InTheCloud </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../wangsheng/ class=md-nav__link> <span class=md-ellipsis> WangSheng </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../about/about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../../../template_password/ class=md-nav__link> <span class=md-ellipsis> [密码保护]Template </span> </a> </li> <li class=md-nav__item> <a href=../../../tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=others>others</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-12-19 00:00:00">2013年12月19日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>others</a></li> <li class=md-meta__item> 需要 17 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=qemu><a href=../../2013/12/19/create-a-dummy-vga-adpter/ class=toclink>QEMU相关</a></h2> <p>创建一个“虚拟”显示适配器，适用于那些“你知道你想干什么并且在干什么”的人。 原文参考 <a href=http://www.geeks3d.com/20091230/vga-hack-how-to-make-a-vga-dummy-plug/ >http://www.geeks3d.com/20091230/vga-hack-how-to-make-a-vga-dummy-plug/</a> <a href="http://blog.zorinaq.com/?e=11">http://blog.zorinaq.com/?e=11</a></p> <p>手头有两块ATI显卡，而且都有这个DVI-I接口，并且目前我的状况是两个显示器都接到了两个主板显示（集显）接口。 <a href=http://blog.lofyer.org/2013/12/create-dummy-vga-adpter/sldldvi/ ><img alt=sldldvi src=/blog/images/sldldvi.jpg></a> 原文说需要一个75欧姆的电阻，我手里暂时只有100欧姆的，而且不多，如果强烈按照原作者的意思的话效果可能会有所不同，参考现有任意款VGA控制器原理。 [连接示意图] 来自第一个链接 <a href=http://blog.lofyer.org/2013/12/create-dummy-vga-adpter/vga_dummy_electronic_schema/ ><img alt=vga_dummy_electronic_schema src=/blog/images/vga_dummy_electronic_schema.jpg></a> [效果图] 请无视我的背景，如果有人好奇的话，那是上篇文章的eZ430以及一包十块白沙。 <a href=http://blog.lofyer.org/2013/12/create-dummy-vga-adpter/qq%e5%9b%be%e7%89%8720131220001003/ ><img alt=QQ图片20131220001003 src=/blog/images/QQ图片20131220001003-757x1024.jpg></a> [结果] <a href=http://blog.lofyer.org/2013/12/create-dummy-vga-adpter/qq%e6%88%aa%e5%9b%be20131220001602/ ><img alt=QQ截图20131220001602 src=/blog/images/QQ截图20131220001602.png></a></p> <p>看见第3个显示器没？ 就是它了，你可以拿它做很多事，比如你有多块显卡，并且你想充分利用其性能，参考lucid mvp，效果上类似吧。--- title: "Gpu Passthrough in Xen" date: 2013-07-22 categories: - "cloud-infra"</p> <hr> <p>Considering that Xen's gpu passthrough is about one year ahead of kvm, so let us try that. The process is something like kvm one as I wrote before. <a href=http://blog.lofyer.org/2013/05/pass-host-gpu-to-guest-via-qemu-ncursescurses/ title="KVM GPU-Passthrough, VGA-Passthrough">KVM GPU-Passthrough, VGA-Passthrough</a></p> <h3 id=result-i-failed-in-trying-passthrough-the-graphic-card-to-win7-or-xp-now-im-try-some-patchs-and-re-compile-xen-with-my-graphic-card-biosbin><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#result-i-failed-in-trying-passthrough-the-graphic-card-to-win7-or-xp-now-im-try-some-patchs-and-re-compile-xen-with-my-graphic-card-biosbin>Result: I failed in trying passthrough the graphic card to Win7 or XP. Now I'm try some patchs and re-compile Xen with my graphic card bios.bin.</a></h3> <p>HOST: CPU: i5-3470 GPU: ATI Radeon HD 7850 OS: openSuse 12.3 KDE</p> <h3 id=0-disable-radeon-driver><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#0-disable-radeon-driver>0. Disable Radeon Driver</a></h3> <h2 id=echo-blacklist-radeon-etcmodprobedmodprobeconf><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#echo-blacklist-radeon-etcmodprobedmodprobeconf>echo "blacklist radeon" &gt;&gt; /etc/modprobe.d/modprobe.conf</a></h2> <h2 id=mkinitrd><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#mkinitrd>mkinitrd</a></h2> <h3 id=1-install-xen-utils><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#1-install-xen-utils>1. Install Xen-utils</a></h3> <p>Install Xen and its utilities via Yast.</p> <h3 id=2-modify-grubcfg><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#2-modify-grubcfg>2. Modify grub.cfg</a></h3> <p>... echo 'Loading Xen 4.3.0_06-1.3 ...' multiboot /xen-4.3.0_06-1.3.gz placeholder iommu=1 echo 'Loading Linux 3.10.1-3.g0cd5432-xen ...' module /vmlinuz-3.10.1-3.g0cd5432-xen placeholder root=UUID=da6ac064-2a5e-48c7-8834-307cbcb551c3 ro resume=/dev/disk/by-id/ata-ST500DM002-1BD142_Z3THR3V3-part3 splash=silent quiet showopts xen-pciback.hide=(00:00.0)(01:00.1) echo 'Loading initial ramdisk ...' module /initrd-3.10.1-3.g0cd5432-xen ...</p> <p>Then reboot the host.</p> <h3 id=3-bind-the-device><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#3-bind-the-device>3. Bind the device</a></h3> <h4 id=using-scripts><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#using-scripts>Using Scripts</a></h4> <p>File: bind_lib.sh</p> <p>#!/bin/bash # # License: GPLv2 # Author: Peter Maloney # # Script to bind devices to pciback (or pci-stub)</p> <p>find_new_id() { device="<span class=arithmatex id=device>\(1" len=\)</span> if [ "<span class=arithmatex device:5:12=device:5:12>\(len" -eq 12 \]; then device="\)</span>" fi lspci -n | grep "${device}" | cut -d' ' -f3 | sed -r "s/:/ /" }</p> <p>bindstub() { device="$1" echo "binddevice $device"</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span></pre></div></td><td class=code><div><pre><span></span><code>   if \[ ! -e &quot;/sys/bus/pci/devices/$device&quot; \]; then
       echo &quot;    ERROR: Device does not exist... cancelling&quot;
       return
   fi

   # with pci-stub, you do new\_id, then unbind, then bind

   echo &quot;create new\_id&quot;
   chmod +w /sys/bus/pci/drivers/pci-stub/new\_id
   new\_id=&quot;$(find\_new\_id &quot;$device&quot;)&quot;
   echo &quot;    echo \\&quot;$new\_id\\&quot; &gt; /sys/bus/pci/drivers/pci-stub/new\_id&quot;
   echo &quot;$new\_id&quot; &gt; /sys/bus/pci/drivers/pci-stub/new\_id

   echo &quot;unbind&quot;
   if \[ ! -e &quot;/sys/bus/pci/devices/$device/driver&quot; \]; then
       echo &quot;    no driver to unbind&quot;
   else
       chmod +w &quot;/sys/bus/pci/devices/${device}/driver/unbind&quot;
       echo &quot;    echo -n \\&quot;$device\\&quot; &gt; \\&quot;/sys/bus/pci/devices/$device/driver/unbind\\&quot;&quot;
       echo -n &quot;$device&quot; &gt; &quot;/sys/bus/pci/devices/$device/driver/unbind&quot;
   fi

   echo &quot;bind&quot;
   chmod +w /sys/bus/pci/drivers/pci-stub/bind
   echo &quot;    echo -n \\&quot;$device\\&quot; &gt; /sys/bus/pci/drivers/pci-stub/bind&quot;
   echo -n &quot;$device&quot; &gt; /sys/bus/pci/drivers/pci-stub/bind

   echo
</code></pre></div></td></tr></table></div> <p>}</p> <p>bindback() { device="$1" echo "binddevice $device"</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span></pre></div></td><td class=code><div><pre><span></span><code>   if \[ ! -e &quot;/sys/bus/pci/devices/$device&quot; \]; then
       echo &quot;ERROR: Device does not exist... cancelling&quot;
       return
   fi

   # with pciback, you do unbind, then new\_slot, then bind

   echo &quot;unbind&quot;
   if \[ ! -e &quot;/sys/bus/pci/devices/$device/driver&quot; \]; then
       echo &quot;    no driver to unbind&quot;
   else
       chmod +w &quot;/sys/bus/pci/devices/${device}/driver/unbind&quot;
       echo &quot;    echo -n \\&quot;$device\\&quot; &gt; \\&quot;/sys/bus/pci/devices/$device/driver/unbind\\&quot;&quot;
       echo -n &quot;$device&quot; &gt; &quot;/sys/bus/pci/devices/$device/driver/unbind&quot;
   fi

   echo &quot;create new\_slot&quot;
   chmod +w /sys/bus/pci/drivers/pciback/new\_slot
   echo &quot;    echo -n \\&quot;$device\\&quot; &gt; /sys/bus/pci/drivers/pciback/new\_slot&quot;
   echo -n &quot;$device&quot; &gt; /sys/bus/pci/drivers/pciback/new\_slot

   echo &quot;bind&quot;
   chmod +w /sys/bus/pci/drivers/pciback/bind
   echo &quot;    echo -n \\&quot;$device\\&quot; &gt; /sys/bus/pci/drivers/pciback/bind&quot;
   echo -n &quot;$device&quot; &gt; /sys/bus/pci/drivers/pciback/bind

   echo
</code></pre></div></td></tr></table></div> <p>}</p> <h2 id=source-bind_libsh><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#source-bind_libsh>source bind_lib.sh</a></h2> <h2 id=modprobe-xen-pciback><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#modprobe-xen-pciback>modprobe xen-pciback</a></h2> <h2 id=bindback-000001000><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#bindback-000001000>bindback "0000:01:00.0"</a></h2> <h2 id=bindback-000001001><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#bindback-000001001>bindback "0000:01:00.1"</a></h2> <h4 id=using-xen-tools><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#using-xen-tools>Using xen-tools</a></h4> <h2 id=xl-pci-assignable-add-01000><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-pci-assignable-add-01000>xl pci-assignable-add 01:00.0</a></h2> <h2 id=xl-pci-assignable-add-01001><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-pci-assignable-add-01001>xl pci-assignable-add 01:00.1</a></h2> <h2 id=xl-pci-attach-domain-0-01000><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-pci-attach-domain-0-01000>xl pci-attach Domain-0 01:00.0</a></h2> <h2 id=xl-pci-attach-domain-0-01001><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-pci-attach-domain-0-01001>xl pci-attach Domain-0 01:00.1</a></h2> <h3 id=4-create-vm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#4-create-vm>4. Create VM</a></h3> <p>File: win7</p> <p>name="win77" description="None" uuid="db64c1a6-1f84-4eff-48df-53c4b03b389e" memory=2048 maxmem=2048 vcpus=4 on_poweroff="destroy" on_reboot="destroy" on_crash="destroy" localtime=1</p> <p>builder="hvm" device_model="/usr/lib/xen/bin/qemu-dm" kernel="/usr/lib/xen/boot/hvmloader" boot="dc" disk=[ 'file:/var/lib/xen//blog/images/windowsvistax64/disk0.raw,hda,w','file:/home/lofyer/Driver.iso,hdc:cdrom,r' ]</p> <h2 id=vif-bridgevirbr0-mac00123e6c2f02-modelrtl8139><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#vif-bridgevirbr0-mac00123e6c2f02-modelrtl8139>vif=[ 'bridge=virbr0, mac=00:12:3e:6c:2f:02, model=rtl8139' ]</a></h2> <p>stdvga=1 vnc=1 vnclisten="0.0.0.0" vncconsole=0</p> <h2 id=vncunused1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#vncunused1>vncunused=1</a></h2> <p>soundhw="all"</p> <p>monitor=1 viridian=1 sdl=0</p> <h2 id=usb1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#usb1>usb=1</a></h2> <p>acpi=1 apic=1 pae=1</p> <h2 id=usbdevicetablet><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#usbdevicetablet>usbdevice='tablet'</a></h2> <p>serial="pty"</p> <h2 id=add-by-lofyer><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#add-by-lofyer>Add by lofyer</a></h2> <p>device_model_version = "qemu-xen-traditional" gfx_passthru=0 pci_power_mgmt=1 xen_platform_pci=1 pci_msitranslate=1 hap=1 pci = [ '01:00.0' , '01:00.1' ]</p> <h2 id=xl-create-win7-remote-viewer-vnclocalhost5900><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-create-win7-remote-viewer-vnclocalhost5900>xl create win7 # remote-viewer vnc://localhost:5900</a></h2> <p>Then you should see Windows boot logo in vnc for few seconds, after that it will switch to the second monitor that attached to your ATI card.</p> <h4 id=gfx_gpupassthru><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#gfx_gpupassthru>gfx_gpupassthru</a></h4> <p>As Xen wiki said:</p> <blockquote> <p>When you specify "gfx_passthru=1" the passthru graphics card will be made the primary graphics card in the VM, and the Xen Qemu-dm emulated Cirrus graphics card is disabled. If you use "gfx_passthru=0", or don't have gfx_passthru= option at all, then the Xen Qemu-dm emulated Cirrus graphics card will be the primary in the VM, and the passthru graphics card will be secondary.</p> </blockquote> <h3 id=so-alter-gfx_passthru-to-1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#so-alter-gfx_passthru-to-1>So, alter gfx_passthru to 1.</a></h3> <p>title: "mingw编译remoteviewer" date: 2012-11-17 categories: - "cloud-infra"</p> <hr> <p><strong>UPDATE 2015.3.18 fedora 21中编译： # yum install mingw* libtool* auto-buildrequires intltool glib2-devel icoutils msitools # ./autogen.sh # mingw64-configure # mingw64-make -j4 # rpmbuild -bb mingw-virt-viewer.spec 编译msi过程中，可能会提示缺少storageencryption.rng，从以下地址下载即可。 https://raw.githubusercontent.com/wido/libvirt/master/docs/schemas/storageencryption.rng</strong></p> <p>在fedora环境中，需要的有spice-gtk，libusbx，usbredir，remote-review，全部下载最新git源 spice-gtk，usbredir http://cgit.freedesktop.org/spice libusbx git://github.com/libusbx/libusbx.git remote-viewer git.fedorahosted.org/git/virt-viewer.git</p> <p>libusbx和usbredir：</p> <p>mingw32-configure;mingw32-make;mingw32-make install</p> <p>spice-gtk： mingw32-configure --with-sasl=no --with-audio=gstreamer --enable-smartcard=no --with-gtk=2.0 --without-python 因为virtviewer要gtk2.0的，所以这也就2.0的；mingw32下没找到pygtk，图省事儿就不要python了，其他的缺啥下啥</p> <p>mingw32-make mingw32-make install</p> <p>virt-viewer：</p> <p>mingw32-configure mingw32-make mingw32-make install</p> <p>生成remote viewer.exe</p> <p>安装包 运行nsiswrapper生成windows安装包</p> <p>nsiswrapper --run --name "Virt-Viewer" --outfile "Virt-Viewer-for-Windows.exe" --with-gtk /usr/i686-pc-mingw32/sys-root/mingw/bin/virt-viewer.exe</p> <p>缺少的dll从网上下或者windows环境中安装的virtviewer加到$PATH中 这样会缺少三个xml文件，在virtviewer/src里，直接copy过去</p> <p>export PATH=$PATH:/usr/i686-pc-mingw32/sys-root/mingw/bin:.</p> <p>windows client中使用usbredir： 需要libwdi或者zadig或者usbclerk <a href=http://lists.freedesktop.org/archives/spice-devel/2012-November/011629.html title="usbredir in windows client">链接</a></p> <h3 id=todo-libvirt><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#todo-libvirt>todo: 只有libvirt不是最新的了，可是目前来看没影响</a></h3> <p>title: "NVIDIA GRID vGPU and KVMGT for KVM" date: 2017-10-25 categories: - "cloud-infra"</p> <hr> <p>This article will tell you how to use NVIDIA vGPU and KVMGT in KVM hypervisor with mdev. I'll use NVIDIA M60 and RHEL 7.4 for testing.</p> <h2 id=1-nvidia-vgpu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#1-nvidia-vgpu>1. NVIDIA vGPU</a></h2> <h3 id=11-prepare-drivers-and-utilities><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#11-prepare-drivers-and-utilities>1.1. Prepare drivers and utilities</a></h3> <h3 id=12-create-vgpu-with-command-line><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#12-create-vgpu-with-command-line>1.2. Create vGPU with command line</a></h3> <h3 id=13-passthrough-vgpu-to-vm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#13-passthrough-vgpu-to-vm>1.3. Passthrough vGPU to vm</a></h3> <h2 id=2-kvmgt><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#2-kvmgt>2. KVMGT</a></h2> <h3 id=21-prepare-drivers-and-utilities><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#21-prepare-drivers-and-utilities>2.1. Prepare drivers and utilities</a></h3> <h3 id=22-create-vgpu-with-command-line><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#22-create-vgpu-with-command-line>2.2. Create vGPU with command line</a></h3> <h3 id=23-passthrough-vgpu-to-vm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#23-passthrough-vgpu-to-vm>2.3. Passthrough vGPU to vm</a></h3> <h2 id=3-amd-vgpu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#3-amd-vgpu>3. AMD vGPU</a></h2> <h3 id=31-prepare-drivers-and-utilities><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#31-prepare-drivers-and-utilities>3.1. Prepare drivers and utilities</a></h3> <h3 id=32-create-vgpu-with-command-line><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#32-create-vgpu-with-command-line>3.2. Create vGPU with command line</a></h3> <h3 id=33-passthrough-vgpu-to-vm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#33-passthrough-vgpu-to-vm>3.3. Passthrough vGPU to vm</a></h3> <h2 id=ref><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#ref>Ref:</a></h2> <h3 id=httpswwwkraxelorgblogtagvgpu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#httpswwwkraxelorgblogtagvgpu><a href=https://www.kraxel.org/blog/tag/vgpu/ >https://www.kraxel.org/blog/tag/vgpu/</a></a></h3> <p>title: "QEMU 3D" date: 2016-12-29 categories: - "cloud-infra"</p> <hr> <p>Except from virgl(virtio-vga), KVMGT/XenGT, CUDA vGPU, I will introduce you another way of using 3D app in QEMU, c'est la <a href=http://xqemu.com/ >XQEMU</a></p> <p><a href=https://blog.lofyer.org/wp-content/uploads/EmuCR-XQEMU-20170109.7z>Download prebuilt EmuCR-XQEMU-20170109</a></p> <p><a href=https://www.emuparadise.me/roms-isos-games.php>Download games!</a></p> <p>As you can see, this is a emulator forked from QEMU to let you playing XBOX games in PC.(not interested though...)</p> <h3 id=get-xqemu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#get-xqemu>Get XQEMU</a></h3> <p>git clone https://github.com/espes/xqemu.git</p> <h3 id=compile-xqemu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#compile-xqemu><a href=https://github.com/espes/xqemu/wiki/Getting-Started#compile-xqemu></a>Compile XQEMU</a></h3> <h4 id=for-mac-os-x><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#for-mac-os-x><a href=https://github.com/espes/xqemu/wiki/Getting-Started#for-mac-os-x></a>For Mac OS X</a></h4> <p>./configure --cc=clang --enable-opengl --disable-vnc --disable-user --target-list=xbox-softmmu --extra-cflags="-march=native" --enable-debug make</p> <h4 id=for-windows><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#for-windows><a href=https://github.com/espes/xqemu/wiki/Getting-Started#for-windows></a>For Windows</a></h4> <ol> <li>Install MSYS2 x86_64: Follow all the steps on <a href=http://msys2.github.io/ >http://msys2.github.io/</a></li> <li> <p>Open the "MinGW-w64 Win64 Shell" and run:</p> <p>pacman -S git python2 make autoconf automake-wrapper mingw-w64-x86_64-libtool mingw-w64-x86_64-gcc mingw-w64-x86_64-pkg-config mingw-w64-x86_64-glib2 mingw-w64-x86_64-glew mingw-w64-x86_64-SDL git clone https://github.com/espes/xqemu cd xqemu git submodule update --init pixman</p> <p>./configure --cc=gcc --python=python2 --enable-opengl --disable-vnc --disable-user --target-list=xbox-softmmu --extra-cflags="-march=native" --enable-debug make</p> </li> </ol> <p><strong>There's a bug with timers on Windows that makes it run much slower than it should. YOU should fix it for me.</strong></p> <h4 id=for-linux><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#for-linux><a href=https://github.com/espes/xqemu/wiki/Getting-Started#for-linux></a>For Linux</a></h4> <h5 id=requirements><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#requirements><a href=https://github.com/espes/xqemu/wiki/Getting-Started#requirements></a>Requirements:</a></h5> <ul> <li><a href=http://wiki.qemu.org/Hosts/Linux>Everything QEMU requires</a></li> <li>OpenGL with GLX and GLEW</li> </ul> <p>For <strong>Debian</strong> most build dependencies can be installed by running:</p> <p>apt-get build-dep qemu apt-get install libglew-dev libtxc-dxtn-s2tc0</p> <h5 id=building><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#building><a href=https://github.com/espes/xqemu/wiki/Getting-Started#building></a>Building:</a></h5> <p>./configure --python=python2 --enable-opengl --disable-vnc --disable-user --enable-kvm --disable-xen --audio-drv-list=alsa --target-list=xbox-softmmu --extra-cflags="-march=native" --disable-werror --enable-debug make</p> <h3 id=run-xqemu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#run-xqemu><a href=https://github.com/espes/xqemu/wiki/Getting-Started#run-xqemu></a>Run XQEMU</a></h3> <p>XQEMU is a Low-Level Emulator, so you need to find a copy of the stuff the Xbox runs when it turns on:</p> <h5 id=xbox-mcp-x-boot-rom><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xbox-mcp-x-boot-rom><a href=https://github.com/espes/xqemu/wiki/Getting-Started#xbox-mcp-x-boot-rom></a>Xbox MCP-X boot rom</a></h5> <p>MD5 (mcpx_1.0.bin) = d49c52a4102f6df7bcf8d0617ac475ed</p> <p>If your mcpx dump has an MD5 of 196a5f59a13382c185636e691d6c323d you dumped it badly and it's a couple bytes off. It should start with 0x33 0xC0 and end with 0x02 0xEE.</p> <h5 id=xbox-10-compatible-bios-cromwell-3944-4034-4036><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xbox-10-compatible-bios-cromwell-3944-4034-4036><a href=https://github.com/espes/xqemu/wiki/Getting-Started#xbox-10-compatible-bios-cromwell-3944-4034-4036-></a>Xbox 1.0 compatible bios (cromwell, 3944, 4034, 4036, ...)</a></h5> <p>You can use a retail bios <em>or</em> a modified 'debug' bios. Just like a real xbox, running a retail bios will not boot unofficial software.</p> <h6 id=debug-bios><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#debug-bios><a href=https://github.com/espes/xqemu/wiki/Getting-Started#debug-bios></a>Debug BIOS</a></h6> <p>People have reported success with the 'COMPLEX 4627' modified debug bios. It's convenient to note that this bios does <em>not</em> necessarily require a <em>populated</em> hard disk image to load an application from DVD (though an empty drive still needs to be attached), so you can skip the next step in some cases.</p> <p>v1.0.2 1M dump: MD5 (Complex_4627Debug.bin) = 19b5c6d3d42a707bba620634fe6d4baf</p> <p><em>or sometimes</em></p> <p>1MB dump: MD5 (complex_4627debug.bin) = e8dd61cc6abdbd06aac185e371312dc1</p> <h6 id=retail-bios><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#retail-bios><a href=https://github.com/espes/xqemu/wiki/Getting-Started#retail-bios></a>Retail BIOS</a></h6> <p>1M dump: MD5 (3944.bin) = e8b39b98cf775496c1c76e4f7756e6ed</p> <p><em>or sometimes</em></p> <p>256k dump: MD5 (3944.bin) = 542c62cb976a4993c8c5027dff9638ce</p> <h5 id=xbox-dashboard-files-on-a-hard-disk-image><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xbox-dashboard-files-on-a-hard-disk-image><a href=https://github.com/espes/xqemu/wiki/Getting-Started#xbox-dashboard-files-on-a-hard-disk-image></a>Xbox dashboard files on a hard disk image</a></h5> <p>Create an Xbox hard-disk image, using xboxhdm or otherwise:</p> <ul> <li>Create an <a href=http://sourceforge.net/projects/xboxhdm2/ >xboxhdm</a> cd-rom with the dashboard files</li> <li>Create a blank hard-disk file: <code>qemu-img create -f qcow2 xbox_harddisk.qcow2 8G</code></li> <li>Run xboxhdm with qemu or something: <code>i386-softmmu/qemu-system-i386 -hda xbox_harddisk.qcow2 -cdrom linux.iso</code></li> </ul> <hr> <p>Launch XQEMU with something like...</p> <p>xbox-softmmu/qemu-system-xbox -cpu pentium3 -machine xbox,bootrom=mcpx_rom.bin -m 64 -drive file=xbox_harddisk.qcow2,index=0,media=disk,locked=on -drive index=1,media=cdrom -bios xbox_bios.bin -usb -device usb-hub,bus=usb-bus.0,port=3 -device usb-xbox-gamepad,bus=usb-bus.0,port=3.2</p> <p>On Linux, you can use <a href=http://www.linux-kvm.org/page/Main_Page>KVM</a> by passing <code>accel=kvm,kernel_irqchip=off</code> to -machine. This is not yet recommended.</p> <p>To skip the Xbox logo animation you can pass <code>short_animation</code> to the -machine option (Example: <code>-machine xbox,short_animation,bootrom=mcpx_rom.bin</code>).</p> <h3 id=to-run-a-game-from-a-xbox-dvd-image-you-must-specify-a-file-for-the-dvd-device><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#to-run-a-game-from-a-xbox-dvd-image-you-must-specify-a-file-for-the-dvd-device>To run a game from a Xbox DVD image you must specify a <code>file</code> for the DVD device</a></h3> <p>title: "qemu uefi" date: 2015-06-08 categories: - "cloud-infra"</p> <hr> <p>Here's a collection of kinds of bioses.</p> <p><a href=https://www.kraxel.org/repos/jenkins/ >https://www.kraxel.org/repos/jenkins/</a></p> <p>Download <strong>edk2.git-ovmf-x64*.rpm</strong>, and extract it:</p> <p>(root)# rpm2cpi edk2.git-ovmf-x64-0-20150606.b1038.g5d832d6.noarch.rpm|cpio -mvid ./usr/share/doc/edk2.git-ovmf-x64-0 ./usr/share/doc/edk2.git-ovmf-x64-0/License.txt ./usr/share/doc/edk2.git-ovmf-x64-0/README ./usr/share/edk2.git ./usr/share/edk2.git/ovmf-x64 ./usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd ./usr/share/edk2.git/ovmf-x64/OVMF-with-csm.fd ./usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd ./usr/share/edk2.git/ovmf-x64/OVMF_CODE-with-csm.fd ./usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd ./usr/share/edk2.git/ovmf-x64/OVMF_VARS-with-csm.fd ./usr/share/edk2.git/ovmf-x64/UefiShell.iso 22227 blocks</p> <p>Run qemu with these fd bios files like this:</p> <p>qemu --boot loader_type=pflash,loader_ro=yes,loader=OVMF_CODE-pure-efi.fd,nvram_template=OVMF_VARS-pure-efi.fd XXX</p> <p>or</p> <h3 id=qemu-bios-ovmf-pure-efifd-xxx><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#qemu-bios-ovmf-pure-efifd-xxx>qemu -bios OVMF-pure-efi.fd XXX</a></h3> <p>title: "Add usbdevice to libvirt by modifying cgroup" date: 2013-10-31 categories: - "cloud-infra" tags: - "Libvirt" - "Device Redirection"</p> <hr> <p>CGROUP means Control group. In my case, usb-redir works fine while usb-host not. <a href=https://www.kernel.org/doc/Documentation/cgroups/devices.txt title="Cgroup HowTO">https://www.kernel.org/doc/Documentation/cgroups/devices.txt</a></p> <h3 id=just-do-it><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#just-do-it>Just do it</a></h3> <h2 id=sed-i-sdevices-devices><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#sed-i-sdevices-devices>sed -i 's/devices /#devices /'</a></h2> <h2 id=reboot><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#reboot>reboot</a></h2> <h3 id=add-fine-control-list><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#add-fine-control-list>Add fine control list</a></h3> <h4 id=review-the-rules-to-libvirt-and-leave-all-the-character-device-to-it><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#review-the-rules-to-libvirt-and-leave-all-the-character-device-to-it>Review the rules to libvirt, and leave all the character device to it</a></h4> <h2 id=cgget-libvirt><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#cgget-libvirt>cgget libvirt</a></h2> <p>To remove "c" device</p> <h2 id=echo-c-sysfscgrouplibvirtdevicesdeny><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#echo-c-sysfscgrouplibvirtdevicesdeny>echo c &gt; /sys/fs/cgroup/libvirt/devices.deny</a></h2> <p>To add all the "c" devices</p> <h2 id=echo-c-rwm-sysfscgrouplibvirtdevicesallow><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#echo-c-rwm-sysfscgrouplibvirtdevicesallow>echo "c *:* rwm" &gt; /sys/fs/cgroup/libvirt/devices.allow</a></h2> <p>devices.deny/allow is something like end-point.</p> <h4 id=about-hierarchy><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#about-hierarchy>About hierarchy</a></h4> <h3 id=a-child-will-not-have-more-permission-than-its-parent><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#a-child-will-not-have-more-permission-than-its-parent><strong>A child will not have more permission than its parent.</strong></a></h3> <p>title: "Intel iGVT-g vGPU in KVM - KVMGT howto" date: 2015-01-22 categories: - "cloud-infra"</p> <hr> <p>As previous article says, this is a vGPU solution in KVM by Intel.(All these genius)</p> <p><a href=https://01.org/zh/kvm/blogs/albcamus/2014/kvmgt-first-release title=https://01.org/zh/kvm/blogs/albcamus/2014/kvmgt-first-release>https://01.org/zh/kvm/blogs/albcamus/2014/kvmgt-first-release</a></p> <h3 id=cpu-i5-4460-os-ubuntu-1404-desktop><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#cpu-i5-4460-os-ubuntu-1404-desktop>CPU: i5-4460 OS: Ubuntu 14.04 Desktop</a></h3> <p>title: "KVMGT in Linux 4.10 - 流媒体服务器、游戏、车载大屏等场景的应用技术预研" date: 2017-04-12 categories: - "cloud-infra"</p> <hr> <p>UPDATE: 2018-04，现在KVMGT相关upstream基本已全部进入master，可以参考<a href=http://GVTg_Setup_Guide>GVTg_Setup_Guide</a>或者<a href=https://github.com/intel/gvt-linux/wiki/GVTd_Setup_Guide>GVTd_Setup_Guide</a>，如果需要本地显示参考<a href=https://github.com/intel/gvt-linux/wiki/Dma_Buf_User_Guide>DMA_BUF User Guide</a>。</p> <p>UPDATE: 2017-08-08，Intel有了X系列处理器i9，这个核数肯定适合跑桌面了。</p> <p>UPDATE：鉴于KVMGT的产品化集成难度较之前有所降低，所以最近有很多人都打算搞搞集成，那我先来集成一把吧。</p> <p>果不其然，直接并进内核了（书要改吗。。当然不，本文简单增补即可。。）</p> <p>4.10非常具有的代表性即是添加了Mediated Device(vfio-mdev)，Intel有自家方案，nVidia也要支持，但Linux社区说你俩给个统一框架吧，要不太乱，于是就有了它。如此以来，N家的显卡便可以很快开发出对应的驱动（不要相信他们家销售说的话，14年偶尔问了一下说要支持的，都过去80年啦），可以看看N家去年(2016.9)放的PPT，<a href=https://blog.lofyer.org/wp-content/uploads/02x03-Neo_Jia_and_Kirti_Wankhede-vGPU_on_KVM-A_VFIO_based_Framework.pdf>02x03-Neo_Jia_and_Kirti_Wankhede-vGPU_on_KVM-A_VFIO_based_Framework</a>。</p> <p>相较于之前的文章<a href=https://blog.lofyer.org/intel-igvt-g-vgpu-in-kvm-kvmgt-howto/ >intel-igvt-g-vgpu-in-kvm-kvmgt-howto</a>，这次的并入减少了我们的不少工作。</p> <p>4.10 ChangeLog：<a href=https://kernelnewbies.org/Linux_4.10>https://kernelnewbies.org/Linux_4.10</a></p> <p>参考<a href=https://github.com/01org/gvt-linux/wiki/GVTg_Setup_Guide>https://github.com/01org/gvt-linux/wiki/GVTg_Setup_Guide</a></p> <p>另外，RHEL 7.4也已加入了KVMGT/XenGT，可以试用一下。</p> <p>来看看支持哪些CPU吧：</p> <blockquote> <p>As a long-standing member of the open source community, Intel works upstream to ensure that full, open source implementations of Intel® GVT exist for open source virtualization hypervisors, KVM* and Xen*, known respectively as KVMGT and XenGT. KVMGT and XenGT deliver excellent virtual GPU performance in VMs across 5th and 6th generation Intel® Core™ processors (Intel® Core™ i3, Intel® Core™ i5, and Intel® Core™ i7 processors) with Intel Processor Graphics as well as Intel® Xeon® processors E3 v4 family with Intel Processor Graphics.</p> </blockquote> <p>首先安装并编译4.10的内核：</p> <p>$ git clone https://github.com/01org/gvt-linux $ sudo yum install openssl-devel ncurses-devel $ cd gvt-linux $ git checkout gvt-stable-4.10 $ echo ""|make oldconfig $ make menuconfig</p> <p>搜索关键字kvmgt, mdev,vfio-iommu-type1，并将其标记为“M”。 模块标记完成后，进行编译安装。</p> <p>$ make -j4 $ sudo make modules_install $ sudo make install $ sudo grub2-mkconfig -o /boot/grub2/grub.cfg</p> <p>从elrepo安装的缺少模块和编译环境。</p> <h2 id=rpm-import-httpswwwelrepoorgrpm-gpg-key-elrepoorg><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#rpm-import-httpswwwelrepoorgrpm-gpg-key-elrepoorg>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</a></h2> <h2 id=rpm-uvh-httpwwwelrepoorgelrepo-release-70-2el7elreponoarchrpm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#rpm-uvh-httpwwwelrepoorgelrepo-release-70-2el7elreponoarchrpm>rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</a></h2> <h2 id=yum-enablerepoelrepo-kernel-install-kernel-ml-kernel-ml-devel><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#yum-enablerepoelrepo-kernel-install-kernel-ml-kernel-ml-devel>yum --enablerepo=elrepo-kernel install kernel-ml kernel-ml-devel</a></h2> <p>然后修改grub文件：</p> <p>menuentry 'CentOS Linux (4.10.10) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted <span class=arithmatex>\(menuentry\_id\_option 'gnulinux-3.10.0-514.10.2.el7.x86\_64-advanced-6a3987e2-9cb7-4b38-9a53-1642aefada46' { load\_video set gfxpayload=keep insmod gzio insmod part\_msdos insmod ext2 set root='hd0,msdos1' if \[ x\)</span>feature_platform_search_hint = xy ]; then search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 --hint='hd0,msdos1' 3fc34ea6-30d7-491e-931d-d0941884fb6b else search --no-floppy --fs-uuid --set=root 3fc34ea6-30d7-491e-931d-d0941884fb6b fi linux16 /vmlinuz-4.10.10 root=/dev/mapper/cl-root ro rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quiet LANG=en_US.UTF-8 i915.enable_gvt=1 kvm.ignore_msrs=1 initrd16 /initramfs-4.10.10.img }</p> <p>为什么添加ignore_msrs呢？</p> <blockquote> <p>Since some windows guest 3rd patry application / tools (like GPU-Z / Passmark9.0) will trigger MSR read / write directly, if it access the unhandled msr register, guest will trigger BSOD soon. So we added the "kvm.ignore_msrs=1" into grub for workaround.</p> </blockquote> <p>然后继续编译QEMU，这次只要下载upstream的即可。</p> <p>$ git clone git://git.qemu.org/qemu.git $ cd qemu $ git checkout v2.8.1 $ git submodule update --init roms/seabios $ ./configure --prefix=/usr \ --enable-kvm \ --disable-xen \ --enable-debug-info \ --enable-debug \ --enable-sdl \ --enable-vhost-net \ --enable-spice \ --disable-debug-tcg \ --target-list=x86_64-softmmu $ make -j4 $ cd roms/seabios $ make -j8 $ cd - $ sudo make install $ sudo cp roms/seabios/out/bios.bin /usr/bin/bios.bin</p> <hr> <p>title: "Slic for qemu-kvm" date: 2013-12-25 categories: - "cloud-infra"</p> <hr> <p>This article is a howto for activation-ready of Windows. SLIC 2.0 is for 2003 &amp; XP, and 2.1 for Win7 &amp; 2008 Original seabios reads slic table from exactly the host. However, if your motherboard(not OEM) happen to own none, you will most probably make one by your self.</p> <h4 id=seabios><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#seabios>Seabios</a></h4> <p>You could get the lastest code from here.</p> <p>git clone git://git.seabios.org/seabios.git seabios</p> <p>Or, you can download from here.</p> <p><a href=http://code.coreboot.org/p/seabios/downloads/get/seabios-1.7.2.2.tar.gz title=seabios-1.7.2.2.tar.gz>seabios-1.7.2.2.tar.gz</a></p> <h4 id=slic-bin><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#slic-bin>SLIC-BIN</a></h4> <p>Here's a collection of various slic table. <a href=http://blog.lofyer.org/slic-for-qemu-kvm/slic-2-1-bins/ >SLIC 2.1 BINS</a></p> <h4 id=seaslic-patch><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#seaslic-patch>Seaslic patch</a></h4> <p>This is patch for seabios to make it slic table enabled. Download from here.</p> <p><a href="https://cloud.lofyer.org/public.php?service=files&t=3aa0db051506d88bce8e6d03d621f47e" title=Seaslic.tar.xz>Seaslic.tar.xz, seabios-1.7.2 compatible</a> Here's the patch content.</p> <p>--- a/src/acpi.c 2013-01-19 06:44:54.000000000 +0600 +++ b/src/acpi.c 2013-05-07 01:16:30.000000000 +0600 @@ -214,6 +214,11 @@</p> <p>#include "acpi-dsdt.hex"</p> <p>+#define CONFIG_OEM_SLIC +#ifdef CONFIG_OEM_SLIC +#include "acpi-slic.hex" +#endif + static void build_header(struct acpi_table_header *h, u32 sig, int len, u8 rev) { @@ -226,6 +231,10 @@ h-&gt;oem_revision = cpu_to_le32(1); memcpy(h-&gt;asl_compiler_id, CONFIG_APPNAME4, 4); h-&gt;asl_compiler_revision = cpu_to_le32(1); + #ifdef CONFIG_OEM_SLIC + if (sig == RSDT_SIGNATURE) // only RSDT is checked by win7 &amp; vista + memcpy(h-&gt;oem_id, ((struct acpi_table_header*)SLIC)-&gt;oem_id, 14); + #endif h-&gt;checksum -= checksum(h, len); }</p> <p>@@ -827,6 +836,15 @@ ACPI_INIT_TABLE(build_srat()); if (pci-&gt;device == PCI_DEVICE_ID_INTEL_ICH9_LPC) ACPI_INIT_TABLE(build_mcfg_q35()); + #ifdef CONFIG_OEM_SLIC + void *buf = malloc_high(sizeof(SLIC)); + if (!buf) + warn_noalloc(); + else { + memcpy(buf, SLIC, sizeof(SLIC)); + ACPI_INIT_TABLE(buf); + } + #endif</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code> u16 i, external\_tables = qemu\_cfg\_acpi\_additional\_tables();
</code></pre></div></td></tr></table></div> <h4 id=compile><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#compile>Compile</a></h4> <p>You don't have to apply the seaslic patch with patch.sh, you can do that by hand. Before you start, do this:</p> <p>xxd -i /sys/firmware/acpi/tables/SLIC | grep -v len | sed 's/unsigned ch ar.*/static char SLIC[] = {/' &gt; seabios.submodule/src/acpi-slic.hex</p> <p>Or,</p> <p>xxd -i DELL.BIN | grep -v len | sed 's/unsigned ch ar.*/static char SLIC[] = {/' &gt; seabios.submodule/src/acpi-slic.hex</p> <p>After applying the patch, you can compile the bios.bin, and copy that to <strong>/usr/share/qemu-kvm/my-bios.bin</strong> or rewrite <strong>bios.bin</strong> instead. Here's my bios.bin with Dell[DELL-QA09-NVDA]2.1.BIN from SLIC BIN</p> <p><a href=https://raw.githubusercontent.com/lofyer/qemu-cmd-reloaded/master/qemu-slic/my-bin.tar.xz>my-bin.tar.xz</a></p> <h4 id=qemu-cmd><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#qemu-cmd>Qemu-cmd</a></h4> <p>qemu-kvm XXX -bios /usr/share/qemu-kvm/my-bios.bin -acpitable file=Dell[DELL-QA09-NVDA]2.1.BIN</p> <h3 id=in-the-guest-you-could-see-that-slic-by-sysfirmwareacpitablesslic-in-linux-or-slic_toolkit-in-windows><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#in-the-guest-you-could-see-that-slic-by-sysfirmwareacpitablesslic-in-linux-or-slic_toolkit-in-windows>In the guest, you could see that SLIC by /sys/firmware/acpi/tables/SLIC in Linux or SLIC_Toolkit in Windows.</a></h3> <p>title: "GPU Passthrough, VGA Passthrough in KVM" date: 2013-05-23 categories: - "cloud-infra" - "linux-admin"</p> <hr> <p>To inspire you, I've got a video from someone else. Better mutt the volume by the way. <a href="http://www.youtube.com/watch?v=Qi1LdFkRzIs" title="Arch Linux KVM Crysis HD Gpu Passthrough">Arch Linux KVM Crysis HD Gpu Passthrough</a> Or you can download it to see. <a href=http://blog.lofyer.org/wp-content/uploads/Arch-Linux-KVM-Crysis-HD.flv title="Download the video">Download the video in HD</a> </p> <p>Here's the links I refer to: <a href=http://thread.gmane.org/gmane.comp.emulators.kvm.devel/71981 title=http://thread.gmane.org/gmane.comp.emulators.kvm.devel/71981>http://thread.gmane.org/gmane.comp.emulators.kvm.devel/71981</a> <a href="https://bbs.archlinux.org/viewtopic.php?id=162768" title="https://bbs.archlinux.org/viewtopic.php?id=162768">https://bbs.archlinux.org/viewtopic.php?id=162768</a> <a href="https://docs.google.com/document/d/1ef_nfl652L0HLn_wGvnpgjsBJd9LZzaV_-rIcEEoK8Y/edit?pli=1" title="https://docs.google.com/document/d/1ef_nfl652L0HLn_wGvnpgjsBJd9LZzaV_-rIcEEoK8Y/edit?pli=1">https://docs.google.com/document/d/1ef_nfl652L0HLn_wGvnpgjsBJd9LZzaV_-rIcEEoK8Y/edit?pli=1</a> <a href=http://www.linux-kvm.org/page/VGA_device_assignment title=http://www.linux-kvm.org/page/VGA_device_assignment>http://www.linux-kvm.org/page/VGA_device_assignment</a> <a href=http://www.linux-kvm.org/page/VGA_device_assignment title=http://www.linux-kvm.org/page/VGA_device_assignment>http://www.linux-kvm.org/page/How_to_assign_devices_with_VT-d_in_KVM</a></p> <h3 id=result-vgapassthrough-success-in-host-f19-guest-windows7-gpupassthrough-success-in-fedora-rawhide><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#result-vgapassthrough-success-in-host-f19-guest-windows7-gpupassthrough-success-in-fedora-rawhide>Result: VGAPassthrough: success in host F19, guest Windows7 GPUPassthrough: success in Fedora-Rawhide</a></h3> <p>HOST: CPU: Core i5 3470 GPU: ATI HD Radeon 7850 OS: Fedora-Rawhide QEMU: qemu-1.5.1 <a href=http://blog.lofyer.org/2013/05/pass-host-gpu-to-guest-via-qemu-ncursescurses/kvm-vgapassthrough/ ><img alt=kvm-vgapassthrough src=/blog/images/kvm-vgapassthrough.png></a> So, here's the steps</p> <h3 id=0-enable-the-mainboard-vxt-iommu-and-alter-the-video-device-to-intel-hd><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#0-enable-the-mainboard-vxt-iommu-and-alter-the-video-device-to-intel-hd>0. Enable the mainboard VxT, iommu and alter the video device to Intel HD</a></h3> <h3 id=1-see-what-we-have-got-now><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#1-see-what-we-have-got-now>1. See what we have got now.</a></h3> <p>lspci;lspci -n</p> <p>We have output below</p> <p>... 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Pitcairn PRO [Radeon HD 7850] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] ...</p> <p>... 01:00.0 0300: 1002:6819 01:00.1 0403: 1002:aab0 ...</p> <p>You can see the pci bus and vendor.</p> <h3 id=2-modify-the-kernel-parameter-morprobed-and-libvirtconf><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#2-modify-the-kernel-parameter-morprobed-and-libvirtconf>2. Modify the kernel parameter, morprobe.d and libvirt.conf</a></h3> <p>Add follow parameters to grub.conf</p> <p>intel_iommu=on pci-stub.ids=1002:6819,1002:aab0,vfio_iommu_type1.allow_unsafe_interrupts=1</p> <p>NOTE: If you have got an AMD cpu, please replace "interl_iommu=on" with "iommu=pt iommu=1" Add modprobe.conf to /etc/modprobe.d/ with this content:</p> <p>blacklist radeon options kvm ignore_msrs=1 options kvm allow_unsafe_interrupts=1 options kvm-amd npt=0 options kvm_intel emulate_invalid_guest_state=0 options vfio_iommu_type1 allow_unsafe_interrupts=1</p> <p>change the following options in /etc/libvirt/qemu.conf:</p> <h2 id=the-user-id-for-qemu-processes-run-by-the-system-instance><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#the-user-id-for-qemu-processes-run-by-the-system-instance>The user ID for QEMU processes run by the system instance.</a></h2> <p>user = "root"</p> <h2 id=the-group-id-for-qemu-processes-run-by-the-system-instance><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#the-group-id-for-qemu-processes-run-by-the-system-instance>The group ID for QEMU processes run by the system instance.</a></h2> <p>group = "root"</p> <p>......</p> <h2 id=if-clear_emulator_capabilities-is-enabled-libvirt-will-drop-all><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#if-clear_emulator_capabilities-is-enabled-libvirt-will-drop-all>If clear_emulator_capabilities is enabled, libvirt will drop all</a></h2> <h2 id=privileged-capabilities-of-the-qemukvm-emulator-this-is-enabled-by><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#privileged-capabilities-of-the-qemukvm-emulator-this-is-enabled-by>privileged capabilities of the QEmu/KVM emulator. This is enabled by</a></h2> <h2 id=default><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#default>default.</a></h2> <h2 id=_1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#_1></a></h2> <h2 id=warning-disabling-this-option-means-that-a-compromised-guest-can><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#warning-disabling-this-option-means-that-a-compromised-guest-can>Warning: Disabling this option means that a compromised guest can</a></h2> <h2 id=exploit-the-privileges-and-possibly-do-damage-to-the-host><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#exploit-the-privileges-and-possibly-do-damage-to-the-host>exploit the privileges and possibly do damage to the host.</a></h2> <h2 id=_2><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#_2></a></h2> <p>clear_emulator_capabilities = 0</p> <p>Reboot.</p> <h3 id=3-using-scripts-below><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#3-using-scripts-below>3. Using scripts below</a></h3> <h4 id=version-1-vfio-passthrough><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#version-1-vfio-passthrough>Version 1: VFIO-Passthrough</a></h4> <p>File: vfio-bind</p> <h2 id=binbash><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#binbash>!/bin/bash</a></h2> <p>modprobe vfio-pci for var in "<span class=arithmatex>\(@"; do for dev in <span class=arithmatex>\((ls /sys/bus/pci/devices/\)</span>var/iommu\_group/devices); do vendor=\)</span>(cat /sys/bus/pci/devices/<span class=arithmatex>\(dev/vendor) device=\)</span>(cat /sys/bus/pci/devices/<span class=arithmatex>\(dev/device) if \[ -e /sys/bus/pci/devices/\)</span>dev/driver ]; then echo <span class=arithmatex>\(dev &gt; /sys/bus/pci/devices/\)</span>dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id done done</p> <p>Bind the device</p> <p>./vfio-bind 0000:01:00.0 0000:01:00.1</p> <p>Start VM</p> <h2 id=binbash_1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#binbash_1>!/bin/bash</a></h2> <p>sudo modprobe vfio-pci</p> <p>sudo qemu-system-x86_64 -no-user-config -nodefaults -m 2048M -smp 4 -boot menu=on \ -net nic -net user -enable-kvm -monitor stdio -vga qxl -global qxl-vga.vram_size=67108864 \ -spice port=6000,ipv4,disable-ticketing \ -device intel-hda,id=sound0,bus=pcie.0,addr=0x4 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -drive file=Windows7.iso,if=none,id=drive-ide0-1-0,readonly=on,format=raw -device ide-cd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0 \ -drive file=/home/lofyer/gpu_passthrough/f17.qcow2,if=none,id=drive-virtio-disk0,format=qcow2,cache=none,werror=stop,rerror=stop,aio=threads -device virtio-blk-pci,scsi=off,bus=pcie.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \ -device virtio-balloon-pci,id=balloon0,bus=pcie.0,addr=0x8 \ -M q35 \ -device piix4-ide,bus=pcie.0 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -fda virtio.vfd</p> <h4 id=version-2-pci-passthrough><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#version-2-pci-passthrough>Version 2: PCI-Passthrough</a></h4> <p>Bind device</p> <h2 id=binbash_2><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#binbash_2>!/bin/bash</a></h2> <p>modprobe pci-stub for id in 6819 aab0; do echo 1002 $id &gt; /sys/bus/pci/drivers/pci-stub/new_id done for pci in 0000:01:00.{0,1}; do echo <span class=arithmatex>\(pci &gt; "/sys/bus/pci/devices/\)</span>pci/driver/unbind" echo $pci &gt; /sys/bus/pci/drivers/pci-stub/bind done</p> <p>Start VM</p> <h2 id=binbash_3><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#binbash_3>!/bin/bash</a></h2> <p>qemu-system-x86_64 \ -hda ../f17.qcow2 \ -cdrom /run/media/lofyer/Cache/OS_ISO/cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso \ -m 2048 -balloon virtio -smp 4 -enable-kvm \ -device pci-assign,host=01:00.0</p> <hr> <p>title: "kvm perfermance test, including periphery virtual device" date: 2013-09-14 categories: - "cloud-infra" - "linux-admin"</p> <hr> <p>I mean <em><strong>test</strong></em>, not <em><strong>profiling</strong></em>.</p> <h3 id=to-virtual-server-and-virtual-desktop-we-should-inspect-them-from-different-standards><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#to-virtual-server-and-virtual-desktop-we-should-inspect-them-from-different-standards>To virtual server and virtual desktop, we should inspect them from different standards.</a></h3> <p>For an server: response time, throughput, concurrent, utilization For and desktop: response time, video/audio latency, utilization</p> <h3 id=tools-we-can-use-to-test><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#tools-we-can-use-to-test>Tools we can use to test</a></h3> <h4 id=cpu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#cpu>CPU:</a></h4> <p>SPEC(open, but not free) Unixbench Super PI Compile linux kernel pcmark(not open, not free, but cracked can be found..) ffmpeg convert</p> <h4 id=graphic><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#graphic>graphic:</a></h4> <p>3dmark</p> <h4 id=fshd><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#fshd>fs,hd:</a></h4> <p>hdparm iozone blogbench dbench</p> <h4 id=net><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#net>net:</a></h4> <p>iperf</p> <h4 id=ram><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#ram>ram</a></h4> <p>ramspeed</p> <h3 id=how-to-start><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#how-to-start>How to start</a></h3> <p>Initial host env: i5-3470, 8G, gentoo-linux-3.11+, qemu-1.6.0 Kernel para:</p> <p>TBD</p> <nav class=md-post__action> <a href=../../2013/12/19/create-a-dummy-vga-adpter/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-04-15 00:00:00">2013年4月15日</time></li> <li class=md-meta__item> 分类于 <a href=../ai/ class=md-meta__link>ai</a>, <a href=../linux-admin/ class=md-meta__link>linux-admin</a>, <a href=./ class=md-meta__link>others</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=rex><a href=../../2013/04/15/rex%E8%AE%BE%E8%AE%A1/ class=toclink>Rex设计</a></h2> <p><a href=https://blog.loyfer.org/wp-content/uploads/2013/04/rex-11.png><img alt=rex-1 src=/blog/images/rex-11.png></a></p> <p>目前已完成 capture，dlayer和tlayer。 IplImage 和 Mat转换可考虑不用了 在写交互的部分，后期完成可能会用gtk。 需要的传感器： 加速度（FPV向） ROI：移动检测 抛弃gtk（时间长，没意思），转用ncurses</p> <nav class=md-post__action> <a href=../../2013/04/15/rex%E8%AE%BE%E8%AE%A1/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2012-03-15 00:00:00">2012年3月15日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>others</a></li> <li class=md-meta__item> 需要 17 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=yacy><a href=../../2012/03/15/yacy/ class=toclink>Yacy</a></h2> <p>寒假前没事儿给翻译成了中文，在1.02中出现。三千多行。。。</p> <p><a href=http://gitorious.org/yacy>http://gitorious.org/yacy</a></p> <h3 id=httpsgithubcomyacyyacy_search_serverblobmasterlocaleszhlng><a class=toclink href=../../2012/03/15/yacy/#httpsgithubcomyacyyacy_search_serverblobmasterlocaleszhlng>https://github.com/yacy/yacy_search_server/blob/master/locales/zh.lng</a></h3> <p>title: "Unix/Linux/MacOS Monitor Tools" date: 2013-11-29 categories: - "linux-admin"</p> <hr> <h3 id=system><a class=toclink href=../../2012/03/15/yacy/#system>System</a></h3> <p><strong>Web</strong> munin Nagios Icinga foreman monit monitorix Suricata</p> <h3 id=network><a class=toclink href=../../2012/03/15/yacy/#network>Network</a></h3> <p><strong>Web</strong> ntop cacti <strong>Terminal</strong> iftop tcpdump netstat iptraf vnstat</p> <h3 id=cpumemory><a class=toclink href=../../2012/03/15/yacy/#cpumemory>Cpu/Memory</a></h3> <p><strong>Terminal</strong> top htop vmstat pmap</p> <h3 id=io><a class=toclink href=../../2012/03/15/yacy/#io>IO</a></h3> <h3 id=terminal-iotop-iostat><a class=toclink href=../../2012/03/15/yacy/#terminal-iotop-iostat><strong>Terminal</strong> iotop iostat</a></h3> <p>title: "All about text terminal" date: 2016-08-04 categories: - "linux-admin"</p> <hr> <p><a href=http://www.tldp.org/HOWTO/html_single/Text-Terminal-HOWTO/ >http://www.tldp.org/HOWTO/html_single/Text-Terminal-HOWTO/</a></p> <h3 id=consoleterminal-pctty-in-linuxvduvideo-display-unit-tektronix-vector-graphics-regis-dec-sixel-dec-and-naplps-north-american-presentation-level-protocol-syntaxapollosunsgihttpwwwccaorgvector-windows-ntrdpitu-t120icalinuxicams-x-windowswindowsgnomewindow-terminal-80-escapeesc-asciiibmebcdicesctermcapterminal-capabilitiesterm-decvtvt100vt220linuxlinuxvt100-wyse60-50-vt-220-102-100-52-tv950-925-912-pcterm-ansi-ibm3101-adm-1l-wang-2110-flow-controldc1dc3rtsctsdtrdsr><a class=toclink href=../../2012/03/15/yacy/#consoleterminal-pctty-in-linuxvduvideo-display-unit-tektronix-vector-graphics-regis-dec-sixel-dec-and-naplps-north-american-presentation-level-protocol-syntaxapollosunsgihttpwwwccaorgvector-windows-ntrdpitu-t120icalinuxicams-x-windowswindowsgnomewindow-terminal-80-escapeesc-asciiibmebcdicesctermcapterminal-capabilitiesterm-decvtvt100vt220linuxlinuxvt100-wyse60-50-vt-220-102-100-52-tv950-925-912-pcterm-ansi-ibm3101-adm-1l-wang-2110-flow-controldc1dc3rtsctsdtrdsr>控制台(console)和终端(terminal)比较容易混淆，一般来说与主机显示输出与控制接口直接相连的显示器和键盘叫做控制台，其他不与主机控制接口直接相连的则叫做终端。 现代PC的模拟终端(tty in Linux)是模拟当年接到主机上的客户机之间的串口输入输出行为，准确的说是含有键盘作为输入和VDU(video display unit)作为输出与回显的客户端。 有些真实的终端是能够显示黑白图片的，也就是位图，这些终端协议包括Tektronix Vector Graphics, ReGIS (DEC), Sixel (DEC), and NAPLPS (North American Presentation Level Protocol Syntax)。更为炫酷的是在Apollo、Sun、SGI主机上的矢量终端(http://www.cca.org/vector/)，早期电影里你看到的那些能画图的绿色显示器就是它了。 瘦客户端早期是文字终端，后来才开始有图形界面和鼠标的终端。根据其与主机的计算量相对大小可分为胖客户端和瘦客户端。 Windows NT版本开始提供的RDP服务是基于ITU T.120协议，ICA协议是在其基础上的兼容扩展。Linux可使用免费的ICA客户端，但需要向MS支付许可费。 现代的终端，包括X-Windows、Windows、Gnome等全部叫做窗口终端(Window Terminal)。 上世纪80年代的内存价格约为每兆数千美元，所以文字终端更容易流行。 终端一般都遵循一定的控制标准，即escape(ESC)控制序列，最常见的例子是我们常用的银行密码键盘。 美国的终端多以ASCII作为字母标准(除了IBM的EBCDIC)，但是这些终端的ESC控制序列并不都一样，所以往往引起兼容性的问题。为此引入了termcap("terminal capabilities")，也就是现在的环境变量TERM。 现代的模拟终端最早是由DEC引入的VT系列(vt100、vt220)，Linux中的终端模型linux也与vt100类似。 模拟软件可模拟的终端类型一般有Wyse60, 50; VT 220, 102, 100, 52: TV950, 925, 912; PCTERM; ANSI; IBM3101; ADM-1l; WANG 2110。 流控(flow control)是用来防止终端、电脑、猫或其他设备处理过多字符而导致信息丢失等现象的发生，可分为软件控制和硬件控制，软件控制即发送DC1/DC3控制序列，硬件控制即分别控制串口/并口的RTS/CTS或DTR/DSR引脚高低电平。当然，现在模拟终端的流控全由软件控制了。</a></h3> <p>title: "tcp协议之上的CCNx" date: 2012-10-26 categories: - "linux-admin"</p> <hr> <h3 id=lwnccnx-06googlejacobsonnbc-p2pbtserver-062linux><a class=toclink href=../../2012/03/15/yacy/#lwnccnx-06googlejacobsonnbc-p2pbtserver-062linux>刚在lwn上看到了个有意思的东西，ccnx，主要作用于媒体中心传播数据（视频）。 在06年于google的演讲中，Jacobson说设计了一种新的媒体传输协议，举了奥运会期间NBC传播同一赛事，大家都卡卡的例子。 类似p2p或者bt吧，几千用户请求同一视频，对于已经从server中出去的数据，就让用户互传，当然，数据包里带有签名，防止新用户的重复请求。 <a href=http://www.ccnx.org/software-download-information-request/download-releases/ title=CCNx>目前最新的是0.62版本</a>，用于linux发行版下载效果应该不错，目测缺点是路由负载可能会高那么点。</a></h3> <p>title: "RTX内核" date: 2012-10-13 categories: - "devices"</p> <hr> <p>下载了最新的MDK后，发现里面有个RTX内核，玩了一下，和UCOSII很像。</p> <p>semaphore，message，mailbox，mutex等同步与通信机制，代码易读，可移植性也好，在mini2440上运行完美，我只用了4个led 观察。</p> <p>喜欢的话可以看看，这是RTX内核源码，移植需要更改MDK中board 部分内容。</p> <h3 id=rtx><a class=toclink href=../../2012/03/15/yacy/#rtx>点击下载 <a href=http://69.164.197.168/wp-content/uploads/2012/10/RTX.rar>RTX</a></a></h3> <p>title: "OpenVPN" date: 2013-02-05 categories: - "linux-admin"</p> <hr> <p>服务端: 生成证书等相关文件 /etc/openvpn/easy-rsa/2.0 生成证书</p> <h2 id=build-ca><a class=toclink href=../../2012/03/15/yacy/#build-ca>./build-ca</a></h2> <p>生成服务器认证</p> <h2 id=build-key-server-server><a class=toclink href=../../2012/03/15/yacy/#build-key-server-server>./build-key-server server</a></h2> <p>生成客户端</p> <h2 id=build-key-client1><a class=toclink href=../../2012/03/15/yacy/#build-key-client1>./build-key client1</a></h2> <p>更新数据库</p> <h2 id=build-dh><a class=toclink href=../../2012/03/15/yacy/#build-dh>./build-dh</a></h2> <p><strong>/etc/openvpn/server.conf</strong></p> <p>local 192.168.1.132 port 1194 proto udp dev tap ca /etc/openvpn/easy-rsa/2.0/keys/ca.crt cert /etc/openvpn/easy-rsa/2.0/keys/server.crt key /etc/openvpn/easy-rsa/2.0/keys/server.key # This file should be kept secret dh /etc/openvpn/easy-rsa/2.0/keys/dh1024.pem server 192.168.0.0 255.255.255.0 ifconfig-pool-persist ipp.txt push "route 192.168.1.0 255.255.255.0" push "redirect-gateway def1 bypass-dhcp" push "dhcp-option DNS 116.228.111.118" push "dhcp-option DNS 180.168.255.18" client-to-client duplicate-cn keepalive 10 120 comp-lzo user nobody group nobody persist-key persist-tun status openvpn-status.log verb 3</p> <p>运行:</p> <h2 id=openvpn-config-etcopenvpnserverconf-daemon><a class=toclink href=../../2012/03/15/yacy/#openvpn-config-etcopenvpnserverconf-daemon>openvpn --config /etc/openvpn/server.conf --daemon</a></h2> <p>客户端: Windows:</p> <p>client1.ovpn</p> <p>client dev tap proto udp remote hostname 1194 persist-key persist-tun ca ca.crt cert client1.crt key client1.key comp-lzo</p> <p>其他需要文件为ca.crt, client1.crt, client1.key 放到安装目录的config中</p> <p>连接外网: #打开ipv4的ipforwad #当次</p> <h2 id=echo-1-procsysnetipv4ip_forward><a class=toclink href=../../2012/03/15/yacy/#echo-1-procsysnetipv4ip_forward>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</a></h2> <h2 id=_1><a class=toclink href=../../2012/03/15/yacy/#_1>保存</a></h2> <p>sysctl -a | grep ip_forward sysctl -w net.ipv4.ip_forward=1 </p> <h2 id=server192168001921681100><a class=toclink href=../../2012/03/15/yacy/#server192168001921681100>在server上将来自子网192.168.0.0的转换为来自192.168.1.100</a></h2> <h3 id=iptables-t-nat-a-postrouting-s-1921680024-o-eth0-j-snat-to-source-1921681100><a class=toclink href=../../2012/03/15/yacy/#iptables-t-nat-a-postrouting-s-1921680024-o-eth0-j-snat-to-source-1921681100>iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j SNAT --to-source 192.168.1.100</a></h3> <p>title: "Git Exp." date: 2013-04-08 categories: - "linux-admin" tags: - "Git"</p> <hr> <p>Supposing that you had a git server, we can use exist git as your own working bare.<br> <strong>[On your own git server] Create a repo.</strong> Clone an exist git.</p> <p>$ git clone git@exist-server:exist.git</p> <p>Make its master branch writable.</p> <p>$ echo -e "[receive]ntdenyCurrentBranch = ignore" &gt;&gt; exist.git/.git/config</p> <p><strong>[On your client] Create a branch &amp; make a change.</strong> Clone exist.git as your own git-src, in which you can see the old commits and branch.</p> <p>$ git clone git@your-server:exist.git $ cd exist</p> <p>We create a new branch based on its master.</p> <p>$ git checkout -b mybranch $ echo "Add README" &gt; README $ git add README $ git commit -m "Add READEME in ROOT"</p> <p>Since this is our first commit, we should push our branch to origin. Next time you should just type 'git push'</p> <p>$ git push origin mybranch</p> <p><strong>[On your own git server] An update in master.</strong> Let's get some new commits.</p> <p>$ git pull</p> <p>Here we get something like this... <a href=http://69.164.197.168/wp-content/uploads/2013/04/git21.png><img alt=git2 src=/blog/images/git21.png></a><br> Now we get commit0 and commitA on mybranch, with commit0 and commit1 on branch master. What we want is something like this. <a href=http://69.164.197.168/wp-content/uploads/2013/04/git3.png><img alt=git3 src=/blog/images/git3.png></a><br> <strong>[On your client] Merge commit1 to mybranch</strong> Way 1.Just merge them from your own git server</p> <p>$ git pull origin master</p> <p>Way 2.Pull commit1 to local master, then rebase <strong><em>or</em></strong> merge it to mybranch Merge:</p> <p>$ git merge master</p> <p>Rebase:</p> <p>$ git rebase master</p> <p>Final step:</p> <p>$ git push</p> <h3 id=theres-a-little-difference-between-merge-and-rebase-in-history-reference-httpgitbookliuhui998com4_2html><a class=toclink href=../../2012/03/15/yacy/#theres-a-little-difference-between-merge-and-rebase-in-history-reference-httpgitbookliuhui998com4_2html><em>There's a little difference between merge and rebase in history. Reference: <a href=http://gitbook.liuhui998.com/4_2.html title="GitBook - Rebase">http://gitbook.liuhui998.com/4_2.html</a></em></a></h3> <p>title: "Build a robot assistant with nowadays cloud apis" date: 2018-12-11 categories: - "ai" - "cloud-infra" tags: - "AI"</p> <hr> <p>好多年前就想做个Jarvis，当时技术所限，构建出一个比较初级的机器人后觉得它还不如一条狗。</p> <p>现在随着AI以及计算技术的成熟，尤其Google Assistant已经可以跟人自然语音对话了，所以觉得可以再尝试一下，加之工作需要，所以便又再开启。</p> <p>现在随着AI以及计算技术的成熟，尤其Google Assistant已经可以跟人自然语音对话了，所以觉得可以再尝试一下，加之工作需要，所以便又再开启。</p> <p>当然，这里我们首先选取交互平台为微信（Web API），交互形式为语音、文字等不限形式。然后再来看看哪些平台提供的最好用且最像人。</p> <h2 id=1-google-assistant><a class=toclink href=../../2012/03/15/yacy/#1-google-assistant>1. Google Assistant</a></h2> <h2 id=2><a class=toclink href=../../2012/03/15/yacy/#2>2. 小爱同学（小米）/天猫精灵</a></h2> <h2 id=3-xiaoi><a class=toclink href=../../2012/03/15/yacy/#3-xiaoi>3. 图灵/XiaoI</a></h2> <h2 id=4><a class=toclink href=../../2012/03/15/yacy/#4>4. 自建</a></h2> <p>结论（对，有结论了）：</p> <h3 id=12343pyweixinok><a class=toclink href=../../2012/03/15/yacy/#12343pyweixinok>1没中文，2最难用，3比较傻，4需要各种训练。直接用3+pyweixin自定义回复就OK了。</a></h3> <p>title: "incrontab howto - filesystem status change notify" date: 2015-03-31 categories: - "linux-admin"</p> <hr> <p><strong>1. Install incrontab.</strong></p> <p><strong>2. Edit /etc/incron.allow</strong></p> <p>root</p> <p><strong>3. Use incrontab command</strong></p> <p><path> <mask> <command> IN_ACCESS File was accessed (read) (*) IN_ATTRIB Metadata changed (permissions, timestamps, extended attributes, etc.) (*) IN_CLOSE_WRITE File opened for writing was closed (*) IN_CLOSE_NOWRITE File not opened for writing was closed (*) IN_CREATE File/directory created in watched directory (*) IN_DELETE File/directory deleted from watched directory (*) IN_DELETE_SELF Watched file/directory was itself deleted IN_MODIFY File was modified (*) IN_MOVE_SELF Watched file/directory was itself moved IN_MOVED_FROM File moved out of watched directory (*) IN_MOVED_TO File moved into watched directory (*) IN_OPEN File was opened (*)</p> <p>When monitoring a directory, the events marked with an asterisk (*) above can occur for files in the directory, in which case the name field in the returned event data identifies the name of the file within the directory.</p> <p>The IN_ALL_EVENTS symbol is defined as a bit mask of all of the above events. Two additional convenience symbols are IN_MOVE, which is a combination of IN_MOVED_FROM and IN_MOVED_TO, and IN_CLOSE which combines IN_CLOSE_WRITE and IN_CLOSE_NOWRITE.</p> <p>The following further symbols can be specified in the mask: IN_DONT_FOLLOW Don't dereference pathname if it is a symbolic link IN_ONESHOT Monitor pathname for only one event</p> <p>IN_ONLYDIR Only watch pathname if it is a directory</p> <p>Additionaly, there is a symbol which doesn't appear in the inotify symbol set. It it IN_NO_LOOP. This symbol disables monitoring events until the current one is completely handled (until its child process exits). </p> <p>Command translation</p> <p>$$ dollar sign $@ watched filesystem path (see above) $# event-related file name $% event flags (textually) $&amp; event flags (numerically)</p> <h2 id=incrontab-l><a class=toclink href=../../2012/03/15/yacy/#incrontab-l>incrontab -l</a></h2> <h2 id=incrontab-e><a class=toclink href=../../2012/03/15/yacy/#incrontab-e>incrontab -e</a></h2> <p>/var/www IN_ACCESS echo /var/www/ wass accessed at $$date</p> <p>Access your web server in a browser and watch the status change.</p> <h2 id=tail-varlogsyslog><a class=toclink href=../../2012/03/15/yacy/#tail-varlogsyslog>tail /var/log/syslog</a></h2> <hr> <p>title: "Something about curl -- Connecting IPA Server using json as an example" date: 2013-04-10 categories: - "linux-admin" tags: - "curl"</p> <hr> <p>With Arduino as a server.</p> <p>What we want is to keep a cookie and build a HEADER <a href=http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html title=HTTP/1.1>http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html</a> [P1]</p> <p>curl -e curl -H referer:whereicamefrom.com curl -d @file.txt curl -d "somecmd" curl -cookie curl -D</p> <p>[P2] <strong>Communicating with ipa server</strong> <a href=https://git.fedorahosted.org/cgit/freeipa.git/tree/API.txt title="freeipa api">https://git.fedorahosted.org/cgit/freeipa.git/tree/API.txt</a></p> <p>Get ca.crt</p> <p>curl -k https://$YOURHOST/ipa/config/ca.crt &gt;&gt; /tmp/ipa.ca.cert</p> <p>Get sessionid</p> <p>sessid=$(curl -v -H referer:https://ipa.test.net/ipa/ui/index.html -H "Content-Type:application/x-www-form-urlencoded" -H "Accept:*/*" --negotiate -u : --cacert ./ca.crt -d "user=admin" -d "password=12345678" -D cookie.txt -X POST -k <br> https://ipa.test.net/ipa/session/login_password 2&gt;&amp;1 | grep -o "ipa_session=[a-zA-Z0-9]*")</p> <p>Post a json file with cmd in it</p> <p>curl -v -H referer:https://ipa.test.net/ipa/ui/index.html -H "Content-Type:application/json" -H "Accept:applicaton/json" -negotiate -u : --cacert ./ca.crt --cookie $sessid -d @ipa.json -X POST -k <br> https://ipa.test.net/ipa/session/json</p> <p>Here's a json file</p> <p>{ "method":"user_find", "params":[ [""], {"uid":"admin"} ], "id":0 }</p> <p>{ "method":"user_add", "params":[ [], { "uid":"test1", "cn":"cn", "givenname":"test1", "sn":"test1" } ], "id":0 }</p> <hr> <p>title: "如何正确计算CPU利用率？" date: 2017-07-05 categories: - "linux-admin" tags: - "Performance"</p> <hr> <p>我们平时使用的CPU利用率方法是极具误导性的，并且一年更甚一年。那么什么是CPU利用率？是你的CPU到底有多忙，是像“% CPU”这样到处在用的指标所显示的那样吗？</p> <p>在top命令里，你看到90%的CPU利用率是这样：</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/cpubusyidle.png><img alt src=/blog/images/cpubusyidle.png></a></p> <p>然而它真正想表达的是这个意思： <a href=https://blog.lofyer.org/wp-content/uploads/cpubusystalledidle.png><img alt src=/blog/images/cpubusystalledidle.png></a></p> <p>Stall(这里译作“怠速”)是说这个处理器没有在跑指令，比如在等待内存I/O的时候。我上图所画的比例（“忙”与“怠速”之间）是我在真实生产环境中遇到的，并且你的CPU也很可能是处于“怠速”状态。</p> <p>这些对你有什么意义呢？理解CPU怠速多少，会直接影响到你在减少代码或者减少内存I/O的调优工作。</p> <p><strong>那么真正的CPU利用率怎么算呢？</strong></p> <p>平时的CPU利用都是非空闲时间，即CPU不运行idle线程（比如Windows里的空闲进程）的时间。你的操作系统那会平时会在上下文切换的时候跟踪它，但是假如一个非idle线程开始运行100毫秒后停止，那内核会认为后面这段时间CPU也在这个非idle线程上。</p> <p>在老旧的分时系统里，这么算没毛病。阿波罗登月舱的导航系统计算机将这里的idle线程叫做“DUMMY JOB”，工程师用利用它来测算计算机的利用率，可以参考之前我写过的<a href=http://www.brendangregg.com/usemethod.html#Apollo>这样一篇文章</a>。</p> <p><strong>那么它有什么毛病呢？</strong></p> <p>现在的CPU比内存已经快了很多倍，但等待内存的时间仍然被算进CPU时间中。当你在top命令中看到较高的“%CPU”的时候，你可能认为它到达了一个性能瓶颈，就是散热片和风扇下面的那个CPU，但实际上，这是那一根根内存条的锅。</p> <p><strong>如何分辨CPU到底在忙啥？</strong></p> <p>使用性能监测计数器（PMC）——一种能够用perf或者其他工具命令查看的硬件计数器。比如，观测整个系统10秒钟：</p> <h2 id=perf-stat-a-sleep-10><a class=toclink href=../../2012/03/15/yacy/#perf-stat-a-sleep-10>perf stat -a -- sleep 10</a></h2> <p>Performance counter stats for 'system wide':</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code> 641398.723351      task-clock (msec)         #   64.116 CPUs utilized            (100.00%)
       379,651      context-switches          #    0.592 K/sec                    (100.00%)
        51,546      cpu-migrations            #    0.080 K/sec                    (100.00%)
    13,423,039      page-faults               #    0.021 M/sec
</code></pre></div></td></tr></table></div> <p>1,433,972,173,374 cycles # 2.236 GHz (75.02%) <not supported> stalled-cycles-frontend<br> <not supported> stalled-cycles-backend <br> 1,118,336,816,068 instructions # 0.78 insns per cycle (75.01%) 249,644,142,804 branches # 389.218 M/sec (75.01%) 7,791,449,769 branch-misses # 3.12% of all branches (75.01%)</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code>  10.003794539 seconds time elapsed
</code></pre></div></td></tr></table></div> <p>这里的一个关键指标就是instructions per cylce（IPC，每CPU周期执行指令数），它能够显示每CPU周期内每个CPU运行了多少指令，越高说明效率越高。上述示例中，这一值为0.78，但这并不说明CPU利用率为78%，因为现代CPU的IPC最大值为4.0（新的已经到了5.0），也就是4-wide。CPU在执行指令时，单个指令会被分割为多个步骤，比如取指令、解码、执行、内存访问、写寄存器等，这些命令如果在单个CPU周期内最多执行一个，那么需要5个CPU周期来完成一条命令，IPC就是0.2，如果采用指令流水线，即3~5-wide的CPU，那么完美状态下1个CPU周期就可以完成一条命令，IPC就是1。（译者注：作者文中使用了CPU clock cycle表示通常所说的CPU周期，为了避免与晶振时钟周期混肴我并没有将其译为CPU时钟周期。）</p> <p>当然，还有数百个其他你可以用来测量的性能计数器。</p> <p>如果在虚拟化环境中，guest一般不能直接访问PMC，这取决于hypervisor是否支持。我最近写的一篇<a href=http://www.brendangregg.com/blog/2017-05-04/the-pmcs-of-ec2.html>The PMCs of EC2: Measuring IPC</a>展示了AWS EC2中基于Xen的虚拟机如何使用PMC。</p> <p><strong>最佳实践</strong></p> <p>如果你的IPC小于1.0，你可能遇到了内存操作密集型，软件调优策略可以有减少内存I/O，增强内存本地访问性，尤其是在NUMA系統上。硬件调优策略则是使用CPU cache较大以及更快的内存、总线和内联技术。</p> <p>如果你的IPC &gt; 1.0，你可能是指令密集型。可以试图减少指令的执行数量，比如消除不必要的工作和缓存操作等，可以用一下<a href=http://www.brendangregg.com/FlameGraphs/cpuflamegraphs.html>CPU火焰图</a>。硬件调优方面，可以尝试高主频、多核、超线程的CPU。</p> <p><strong>性能检测产品应该告诉你什么呢？</strong></p> <p>性能检测工具都应该显示出每个进程的IPC，或者是按照指令周期与怠速周期，比如%INS和%STL，下图为Linux中的tiptop命令：</p> <p>tiptop - [root] Tasks: 96 total, 3 displayed screen 0: default</p> <p>PID [ %CPU] %SYS P Mcycle Minstr IPC %MISS %BMIS %BUS COMMAND 3897 35.3 28.5 4 274.06 178.23 0.65 0.06 0.00 0.0 java 1319+ 5.5 2.6 6 87.32 125.55 1.44 0.34 0.26 0.0 nm-applet 900 0.9 0.0 6 25.91 55.55 2.14 0.12 0.21 0.0 dbus-daemo</p> <p><strong>CPU利用率具有误导性的其他理由</strong></p> <p>使得这个%CPU指标错误的理由除了CPU在内存的怠速周期外，还有如下因素： 1. 温度也能使CPU进入怠速； 2. Turboboost（睿频）引起时钟频率变化； 3. SpeedStep引起时钟频率变化； 4. 一分钟内的80%的平均利用率并不能表示100%的突发利用率（类似网络QoS）； 5. 自旋锁：CPU在很严肃地瞎忙；</p> <p><strong>Update: CPU利用率真的错了吗？</strong> 自这篇文章发布以后，留言讨论非常激烈，已经有了上百条了。首先谢谢你们对这话题感兴趣并花时间阅读，但我在这里还是要统一回复：<strong>我对disk的iowait并不关心（译者注：PC CPU不能直接操作外部存储）</strong>，并且文中也已经给出了内存操作密集型的对应调优措施。</p> <p>然后，CPU利用率到底是从本质上错了还是仅仅是了？我认为需要人将高CPU利用率视为处理单元的瓶颈的事儿，是错的。那么这个指标的计算方法从技术上讲正确吗？如果CPU在怠速期间不能被其他任何进程使用，那么这不就是所谓的“使用等待”（听起来有点矛盾）。某些情况下，%CPU作为一个操作系统层面的指标是技术正确但是容易误导人的。在超线程中，怠速周期可以被其他线程使用，所以%CPU的算法也会将其算在内，而实际上并没有利用。那样是不对的，这篇文章中我强调的是解释问题并提出对策，并且，这个指标也有技术上的问题。 <strong>结论</strong></p> <p>CPU利用率已成为一个极具误导性的指标：它算进了等待主存的周期，而这类周期在现代的CPU负载中占据不少。如果使用额外指标，你就能搞清楚%CPU到底意味着什么，包括每CPU周期执行指令数（IPC）。IPC &lt; 1.0可能意味着你的应用是内存密集型，而IPC &gt; 1.0则可能是指令密集型。我在之前的一篇文章</p> <p>显示%CPU的性能监控产品也应该显示PMC测量指标，并给予充分解释，这样才不会误导用户。比如，它们可以一起显示%CPU和IPC，或者指令周期与怠速周期。有了这些指标，开发或管理人员才能在应用和操作系统中选择正确的调优方式。</p> <p>本文翻译自Brendan Gregg的博客文章《CPU Utilization is Wrong》，原文链接为<a href=http://www.brendangregg.com/blog/2017-05-09/cpu-utilization-is-wrong.html>http://www.brendangregg.com/blog/2017-05-09/cpu-utilization-is-wrong.html</a>，就是那本《性能之巅（中译）》的作者，调试工具dtrace的作者，现就职于NetFlix。</p> <h3 id=pspccpucpuidlepcbg><a class=toclink href=../../2012/03/15/yacy/#pspccpucpuidlepcbg>PS：为什么要翻译这个文章呢？因为很多时候总感觉PC的这个CPU利用率的百分比显示没能真实反应我的CPU到底忙不忙，在学校的时候用单片机也是算idle，但到了PC后隐约感觉这么算不对，看了BG的文章后才恍然大悟。另外这篇文章之前已经被翻译过，但作者又有更新，也挺有意思的，我就重新翻了一遍，并加了一些弹幕。</a></h3> <p>title: "inspire设计" date: 2013-02-25 categories: - "linux-admin"</p> <hr> <p>client : android/pc/arduino</p> <p>server : linux</p> <p>node : with client service installed</p> <p>action : cmd src dest</p> <p>backend: recognize the cmd, get src type from the dest, search src in the node</p> <h3 id=schedule-done1-voice-recognization-test-complete-todo2-use-its-api-in-cpython-abort-no-idea><a class=toclink href=../../2012/03/15/yacy/#schedule-done1-voice-recognization-test-complete-todo2-use-its-api-in-cpython-abort-no-idea>SCHEDULE [DONE]1. voice recognization test complete [TODO]2. use its api in C/python [*Abort*] No idea...</a></h3> <p>title: "docker using linux bridge" date: 2018-11-08 categories: - "cloud-infra"</p> <hr> <p>A. Change docker bridge dockerd -H unix:// -b br_eth0 --fixed-cidr=172.20.230.1/24 --default-gateway 172.20.0.1</p> <p>B. Create manually, but flexibly Recreate veth pair if your docker instance was restarted or exited.</p> <p>[root@172-20-17-247 ~]# docker run --network none -it tianon/network-toolbox /bin/bash [root@172-20-17-247 ~]# docker inspect --format '{{.State.Pid}}' 3 74406 [root@172-20-17-247 ~]# ip link add centos3-cont type veth peer name centos3-host [root@172-20-17-247 ~]# brctl addif br_eth0 centos3-host [root@172-20-17-247 ~]# ifconfig centos3-host up [root@172-20-17-247 ~]# ip link set netns 74406 dev centos3-cont [root@172-20-17-247 ~]# nsenter -t 74406 -n ip link set centos3-cont up [root@172-20-17-247 ~]# nsenter -t 74406 -n ip addr add 172.20.77.141/16 dev centos3-cont [root@172-20-17-247 ~]# nsenter -t 74406 -n ip route add default via 172.20.0.1</p> <p>[root@172-20-17-247 ~]# docker exec -it 3 bash root@39eb1da6e842:/# ping google.com PING google.com (172.217.25.206): 56 data bytes 64 bytes from 172.217.25.206: icmp_seq=0 ttl=55 time=87.434 ms ^C--- google.com ping statistics --- 1 packets transmitted, 1 packets received, 0% packet loss round-trip min/avg/max/stddev = 87.434/87.434/87.434/0.000 ms</p> <p>C. With pipework script https://github.com/jpetazzo/pipework [root@172-20-17-247 ~]# pipework br_eth0 -i eth2 CONTAINERID 172.20.100.22/16 [root@172-20-17-247 ~]# pipework route CONTAINERID replace default via 172.20.0.1</p> <h3 id=ref-1-httpsclcnetworkwordpresscom20170531docker-container-and-vm-networking><a class=toclink href=../../2012/03/15/yacy/#ref-1-httpsclcnetworkwordpresscom20170531docker-container-and-vm-networking>Ref: [1] <a href=https://clcnetwork.wordpress.com/2017/05/31/docker-container-and-vm-networking/ >https://clcnetwork.wordpress.com/2017/05/31/docker-container-and-vm-networking/</a></a></h3> <p>title: "Using solr+nutch+django to build your own search engine portal" date: 2015-01-14 categories: - "linux-admin"</p> <hr> <h2 id=using-solr><a class=toclink href=../../2012/03/15/yacy/#using-solr>Using Solr</a></h2> <h4 id=solr-tutorial><a class=toclink href=../../2012/03/15/yacy/#solr-tutorial>Solr tutorial</a></h4> <h4 id=deploy-solr-in-tomcat><a class=toclink href=../../2012/03/15/yacy/#deploy-solr-in-tomcat>Deploy Solr in Tomcat</a></h4> <h2 id=using-nutch><a class=toclink href=../../2012/03/15/yacy/#using-nutch>Using Nutch</a></h2> <h2 id=using-nutch-with-solr><a class=toclink href=../../2012/03/15/yacy/#using-nutch-with-solr>Using Nutch with Solr</a></h2> <hr> <p>title: "Using Gpu in Pi" date: 2013-06-14 categories: - "devices"</p> <hr> <p><strong>We had a wiki here.</strong> <a href=http://elinux.org/RPi_Xorg_rpi_Driver#Design title="RPi gpu driver design">http://elinux.org/RPi_Xorg_rpi_Driver#Design</a></p> <p><strong>And vc sdk on github. It's also in /opt/vc.</strong> <a href=https://github.com/raspberrypi title="raspberry on github">https://github.com/raspberrypi</a></p> <p><strong>X using gpu.</strong> <a href=https://github.com/simonjhall/fbdev_exa title="X using gpu">https://github.com/simonjhall/fbdev_exa</a></p> <p><strong>Playback accelerating.</strong> <a href=http://wiki.matthiasbock.net/index.php/Hardware-accelerated_video_playback_on_the_Raspberry_Pi title="RPi playback">http://wiki.matthiasbock.net/index.php/Hardware-accelerated_video_playback_on_the_Raspberry_Pi</a></p> <p><strong>Compile gstreamer{*} in Pi</strong> <a href=http://permalink.gmane.org/gmane.comp.video.gstreamer.devel/43011>http://permalink.gmane.org/gmane.comp.video.gstreamer.devel/43011</a></p> <p><strong>Using wayland instead of X</strong> Here's the build instruction <a href=http://wayland.freedesktop.org/raspberrypi.html title="Build Wayland">http://wayland.freedesktop.org/raspberrypi.html</a> For recently PI_DEBIAN img, we should just</p> <p>apt-get install weston weston-dev</p> <p>Using xwayland to run X application in wayland..</p> <p>Notes: 1. If you're going to compile cairo using egl, you shall meet a problem like undeclared 'None', just DEFINE one as 0L. 2. Using soft link rather than copying one when library is missing.</p> <p><strong>Waiting4Test</strong> <strong>Tuning Rasbian</strong> Speedup CPU: raspi-config arm_freq=900 I always use this hack and my rpi run without problem Change scheduler/elevator at boot time: we use more responsive/less disk io usage scheduler: modify the /boot/cmdline.txt</p> <p>dwc_otg.lpm_enable=0 root=/dev/mmcblk0p2 rootfstype=ext4 rootflags=commit=120,data=writeback elevator=deadline rootwait quiet</p> <p>Tuning sysctl.conf: as manual say, sysctl.conf is the “Configuration file for setting system variables”... well there are lot of variables you can put inside this file and for everyone we can write a book. Our goal is to gain more speed and tell our system to use less io/ram. Let’s put in the /etc/sysctl.conf:</p> <p>vm.dirty_background_ratio = 20 vm.dirty_expire_centisecs = 0 vm.dirty_ratio = 80 vm.dirty_writeback_centisecs = 1200 vm.overcommit_ratio = 2 vm.laptop_mode = 5 vm.swappiness = 10</p> <p><strong>Tuning SDCard:</strong> Quite hard to understand, but changing the partition alignment of the SDCard can highly improve the write speed of our sdcard. Basically we have to align the first partition to the erase block size of our sdcard. I suggest to read an reread the reference link. To do that in our sdcard that contain our RaspberryPI Debian distro we have to: backup our filesystem from linux: cd /media/mymmcblk0p2/ (the partitition that’s contain debian fs) tar -cvpzf /home/gibbio/RPI-TC_fs.tgz --exclude=./proc --exclude=./lost+found --exclude=./sys --exclude=./mnt --exclude=./media --exclude=./dev ./ cd /media/mymmcblk0p1/ (the partitition that’s contain boot kernel etc) tar -cvpzf /home/gibbio/RPI-TC_boot.tgz ./ Now use printcsd.py to find the erase block size, most sd have 128K so we use 128K/Sector size = 256 sectors (mine have 64k so we have to use 64k/512b = 128 sector alignement)</p> <p>sfdisk -f -H224 -S56 /dev/mmcblk0 Checking that no-one is using this disk right now ... OK Disk /dev/mmcblk0: 244448 cylinders, 224 heads, 56 sectors/track Old situation: Units = cylinders of 6422528 bytes, blocks of 1024 bytes, counting from 0 Device Boot Start End #cyls #blocks Id System /dev/mmcblk0p1 0 - 0 0 0 Empty /dev/mmcblk0p2 0 - 0 0 0 Empty /dev/mmcblk0p3 0 - 0 0 0 Empty /dev/mmcblk0p4 0 - 0 0 0 Empty Input in the following format; absent fields get a default value. Usually you only need to specify and (and perhaps ). /dev/mmcblk0p1 :,8,c /dev/mmcblk0p1 0+ 7 8- 50175+ c W95 FAT32 (LBA) (enter enter) /dev/mmcblk0p2 : /dev/mmcblk0p2 8 1246 1239 7771008 83 Linux /dev/mmcblk0p3 : /dev/mmcblk0p3 0 - 0 0 0 Empty /dev/mmcblk0p4 : /dev/mmcblk0p4 0 - 0 0 0 Empty New situation: Units = cylinders of 6422528 bytes, blocks of 1024 bytes, counting from 0 Device Boot Start End #cyls #blocks Id System /dev/mmcblk0p1 0+ 7 8- 50175+ c W95 FAT32 (LBA) /dev/mmcblk0p2 8 1246 1239 7771008 83 Linux /dev/mmcblk0p3 0 - 0 0 0 Empty /dev/mmcblk0p4 0 - 0 0 0 Empty Warning: no primary partition is marked bootable (active) This does not matter for LILO, but the DOS MBR will not boot this disk. Do you want to write this to disk? [ynq] y Successfully wrote the new partition table Re-reading the partition table ... If you created or changed a DOS partition, /dev/foo7, say, then use dd(1) to zero the first 512 bytes: dd if=/dev/zero of=/dev/foo7 bs=512 count=1 (See fdisk(8).)</p> <p>gibbio # fdisk -l... Disk /dev/mmcblk0: 8010 MB, 8010072064 bytes 224 heads, 56 sectors/track, 1247 cylinders, total 15644672 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x000ee283 Device Boot Start End Blocks Id System /dev/mmcblk0p1 1 100351 50175+ c W95 FAT32 (LBA) /dev/mmcblk0p2 100352 15642367 7771008 83 Linux</p> <h3 id=now-create-ext4-fs-mke2fs-t-ext4-e-stripe-width32-m-0-devmmcblk0p2-make-fat32-partition-via-gparted-gibbio-fdisk-devmmcblk0-command-m-for-help-p-disk-devmmcblk0-8010-mb-8010072064-bytes-224-heads-56-sectorstrack-1247-cylinders-total-15644672-sectors-units-sectors-of-1-512-512-bytes-sector-size-logicalphysical-512-bytes-512-bytes-io-size-minimumoptimal-512-bytes-512-bytes-disk-identifier-0x000ee283-device-boot-start-end-blocks-id-system-devmmcblk0p1-1-100351-50175-c-w95-fat32-lba-devmmcblk0p2-100352-15642367-7771008-83-linux-command-m-for-help-x-expert-command-m-for-help-p-disk-devmmcblk0-224-heads-56-sectors-1247-cylinders-nr-af-hd-sec-cyl-hd-sec-cyl-start-size-id-1-00-0-2-0-223-56-7-1-100351-0c-2-00-0-1-8-223-56-1023-100352-15542016-83-3-00-0-0-0-0-0-0-0-0-00-4-00-0-0-0-0-0-0-0-0-00-expert-command-m-for-help-b-partition-number-1-4-1-new-beginning-of-data-1-100351-default-1-128-expert-command-m-for-help-w-the-partition-table-has-been-altered-calling-ioctl-to-re-read-partition-table-syncing-disks-now-eject-the-sdcard-reinsert-and-make-the-restore-from-the-tgz-cd-mediamymmcblk0p2-tar-xvpzf-rpi-tc_fstgz-c-mkdir-proc-mnt-sys-boot-dev-umount-mediamymmcblk0p2-cd-mediamymmcblk0p1-tar-xvpzf-rpi-tc_boottgz-c-umount-mediamymmcblk0p1-eject-the-sdcard-plug-into-our-raspberry-pi-and-power-on><a class=toclink href=../../2012/03/15/yacy/#now-create-ext4-fs-mke2fs-t-ext4-e-stripe-width32-m-0-devmmcblk0p2-make-fat32-partition-via-gparted-gibbio-fdisk-devmmcblk0-command-m-for-help-p-disk-devmmcblk0-8010-mb-8010072064-bytes-224-heads-56-sectorstrack-1247-cylinders-total-15644672-sectors-units-sectors-of-1-512-512-bytes-sector-size-logicalphysical-512-bytes-512-bytes-io-size-minimumoptimal-512-bytes-512-bytes-disk-identifier-0x000ee283-device-boot-start-end-blocks-id-system-devmmcblk0p1-1-100351-50175-c-w95-fat32-lba-devmmcblk0p2-100352-15642367-7771008-83-linux-command-m-for-help-x-expert-command-m-for-help-p-disk-devmmcblk0-224-heads-56-sectors-1247-cylinders-nr-af-hd-sec-cyl-hd-sec-cyl-start-size-id-1-00-0-2-0-223-56-7-1-100351-0c-2-00-0-1-8-223-56-1023-100352-15542016-83-3-00-0-0-0-0-0-0-0-0-00-4-00-0-0-0-0-0-0-0-0-00-expert-command-m-for-help-b-partition-number-1-4-1-new-beginning-of-data-1-100351-default-1-128-expert-command-m-for-help-w-the-partition-table-has-been-altered-calling-ioctl-to-re-read-partition-table-syncing-disks-now-eject-the-sdcard-reinsert-and-make-the-restore-from-the-tgz-cd-mediamymmcblk0p2-tar-xvpzf-rpi-tc_fstgz-c-mkdir-proc-mnt-sys-boot-dev-umount-mediamymmcblk0p2-cd-mediamymmcblk0p1-tar-xvpzf-rpi-tc_boottgz-c-umount-mediamymmcblk0p1-eject-the-sdcard-plug-into-our-raspberry-pi-and-power-on>now create ext4 FS: mke2fs -t ext4 -E stripe-width=32 -m 0 /dev/mmcblk0p2 make FAT32 partition via gparted gibbio # fdisk /dev/mmcblk0 Command (m for help): p Disk /dev/mmcblk0: 8010 MB, 8010072064 bytes 224 heads, 56 sectors/track, 1247 cylinders, total 15644672 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x000ee283 Device Boot Start End Blocks Id System /dev/mmcblk0p1 1 100351 50175+ c W95 FAT32 (LBA) /dev/mmcblk0p2 100352 15642367 7771008 83 Linux Command (m for help): x Expert command (m for help): p Disk /dev/mmcblk0: 224 heads, 56 sectors, 1247 cylinders Nr AF Hd Sec Cyl Hd Sec Cyl Start Size ID 1 00 0 2 0 223 56 7 1 100351 0c 2 00 0 1 8 223 56 1023 100352 15542016 83 3 00 0 0 0 0 0 0 0 0 00 4 00 0 0 0 0 0 0 0 0 00 Expert command (m for help): b Partition number (1-4): 1 New beginning of data (1-100351, default 1): 128 Expert command (m for help): w The partition table has been altered! Calling ioctl() to re-read partition table. Syncing disks. Now eject the sdcard, reinsert and make the restore from the tgz: cd /media/mymmcblk0p2/ tar -xvpzf RPI-TC_fs.tgz -C ./ mkdir proc mnt sys boot dev umount /media/mymmcblk0p2/ cd /media/mymmcblk0p1/ tar -xvpzf RPI-TC_boot.tgz -C ./ umount /media/mymmcblk0p1/ Eject the sdcard, plug into our Raspberry Pi and power on!</a></h3> <p>title: "deploy &amp; debug ovirt in the intellij ide" date: 2013-04-05 categories: - "cloud-infra"</p> <hr> <p>Before we start, we need intellij enterprise version and a register tool.. [url]</p> <p>[Summary] 1. We should open the pom.xml file instead of the project directory. 2. Modify the extension of the directory in the project properties. 3. Modify the .m2 file in your personal directory to make jboss know where to deploy the project. 4. We need seperate run/debug config to make it clearer.</p> <p>[Steps] <em>OVIRT_HOME=/home/demo JBOSS_HOME=/usr/jboss-as JDK=/usr/java/jdk1.7.0_17 $ cmd as demo # cmd as root</em> <strong>1.Compile the ovirt from src</strong> in $OVIRT_HOME</p> <p>$ mvn clean install -Pgwt-admin,gwt-user -DskipTests=true</p> <p><strong>2.Deploy ovirt</strong> You need ~/.m2/settings.xml file in /root/ and /home/demo directory.</p> <p>oVirtEnvSettings </p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code>    oVirtEnvSettings
                    /usr/jboss-as
                       /usr/java/jdk1.7.0\_17
</code></pre></div></td></tr></table></div> <p>in $OVIRT_HOME/ear</p> <h2 id=mvn-clean-install-pdepsetup><a class=toclink href=../../2012/03/15/yacy/#mvn-clean-install-pdepsetup>mvn clean install -Pdep,setup</a></h2> <p><strong>3.Run jboss</strong> You should export an environment variant and a runtime configuration file.</p> <p>$ echo -e "ENGINE_USR=admin111nENGINE_ETC=/etc/ovirt-engine" &gt; $OVIRT_HOME/backend/manager/conf/engine.conf.defaults</p> <h2 id=export-engine_defaultsovirt_homebackendmanagerconfengineconfdefaults><a class=toclink href=../../2012/03/15/yacy/#export-engine_defaultsovirt_homebackendmanagerconfengineconfdefaults>export ENGINE_DEFAULTS=$OVIRT_HOME/backend/manager/conf/engine.conf.defaults</a></h2> <h2 id=usrjboss-asbinstandalonesh><a class=toclink href=../../2012/03/15/yacy/#usrjboss-asbinstandalonesh>/usr/jboss-as/bin/standalone.sh</a></h2> <h3 id=update-now-there-is-readmedeveloper-in-the-source-dir-just-follow-it><a class=toclink href=../../2012/03/15/yacy/#update-now-there-is-readmedeveloper-in-the-source-dir-just-follow-it>UPDATE: Now there is README.developer in the source dir, just follow it.</a></h3> <p>title: "Compile Android Spice(aSpice)" date: 2013-09-02 categories: - "cloud-infra"</p> <hr> <p>Ref: <a href=http://comments.gmane.org/gmane.comp.emulators.spice.devel/13944 title=http://comments.gmane.org/gmane.comp.emulators.spice.devel/13944>http://comments.gmane.org/gmane.comp.emulators.spice.devel/13944</a> <a href=https://github.com/iiordanov/remote-desktop-clients/blob/master/BUILDING>https://github.com/iiordanov/remote-desktop-clients/blob/master/BUILDING</a></p> <p>Before following the BUILDING instruction in the repo, you need download <a href=http://dl.google.com/android/ndk/android-ndk-r9d-linux-x86_64.tar.bz2>android-ndk-r9d</a>, or else you will get lots of error.</p> <p>I was using Eclipse for android neon, android-sdk-25.</p> <p>cebero is no longer needed. <strong>update 2016</strong></p> <p>编译环境 ubuntu-14.04，按理12.04、16.04也可以</p> <ol> <li>下载所需包并解压 android-ndk-r9d-linux-x86_64.tar.bz2 gstreamer-1.0-android-arm-release-1.4.5.tar.bz2</li> </ol> <p>链接：http://pan.baidu.com/s/1c1AWPmo 密码：t4ku</p> <p>demo@ubuntu:~$ tar xf Downloads/android-ndk-r9d-linux-x86_64.tar.bz2 -C /home/demo/ demo@ubuntu:~$ sudo tar xf Downloads/gstreamer-1.0-android-arm-release-1.4.5.tar.bz2 -C /opt/gstreamer</p> <ol> <li>修改bVNC为aSPICE 在文件~/remote-desktop-clients/eclipse_projects/bVNC/AndroidManifest.xml中， 将android:label="bVNC" and android:name="bVNC"修改为android:label="aSPICE" and android:name="aSPICE" respectively.</li> </ol> <p>然后在这个bVNC目录中执行命令： demo@ubuntu:bVNC$ find jni/src -name \*.h -o -name \*.c -exec sed -i 's/aSPICE/bVNC/' {} \;</p> <ol> <li>编译 demo@ubuntu:bVNC$ /home/demo/android-ndk-r9d/ndk-build GSTREAMER_SDK_ROOT_ANDROID=/opt/gstreamer -j 4</li> </ol> <p>1. Install/update sqlitegen plugin v0.1.19 into Eclipse from: https://github.com/iiordanov/sqlitegen-secure/releases/download/v0.1.19/sqlitegen_eclipse_site_0.1.19.jar</p> <p>NOTE: Using an older version of the plugin may not work because of the switch to the sqlcipher release of sqlite.</p> <p>2. Clone the FreeRDP project in the parent directory of where you cloned bVNC project: git clone git://github.com/FreeRDP/FreeRDP.git</p> <p>Check out a commit known to work with bVNC: git checkout stable-1.1</p> <p>You should now have bVNC and FreeRDP side by side in the same directory.</p> <p>Add bVNC, ZoomerWithKeys and PubkeyGenerator from the bVNC/eclipse_projects/ directory to Eclipse as existing Android projects. Add FreeRDPCore from the FreeRDP/client/Android/ directory to Eclipse as an Existing Android Project.</p> <p>3. Ensure ZoomerWithKeys, PubkeyGenerator, and FreeRDPCore projects are called exactly as written here by right-clicking on each of them, then selecting Refactor-&gt;Rename</p> <p>3. Add the ZoomerWithKeys, PubkeyGenerator, and FreeRDPCore projects as Library References to bVNC (right-click on the bVNC project and select Properties -&gt; Android -&gt; Library). If they are not, add them.</p> <p>4. Ensure that ZoomerWithKeys, PubkeyGenerator, and FreeRDPCore are specified as "Required projects on the build path" (right- click on the bVNC project, and select Properties -&gt; Java Build Path -&gt; Projects). If they are not, add them.</p> <p>5. Ensure that ZoomerWithKeys, PubkeyGenerator, and FreeRDPCore are referenced in Properties -&gt; Project References (put checkmarks on projects).</p> <p>6. To build and successfully run aSPICE, you need to: - Unpack gstreamer-sdk 1.4.5 into /opt/gstreamer. I obtained my copy from: https://gstreamer.freedesktop.org/data/pkg/android/1.4.5/gstreamer-1.0-android-arm-release-1.4.5.tar.bz2 Newer versions either crash or have GNUtls errors that need work.</p> <p>- Edit AndroidManifest.xml and change android:label="bVNC" and android:name="bVNC" to android:label="aSPICE" and android:name="aSPICE" respectively.</p> <p>- cd bVNC/eclipse_projects/bVNC</p> <p>- Replace all instances of aSPICE with bVNC in native code (.c and .h files). This requirement should go away in the future. You can use the following command: find jni/src -name \*.h -o -name \*.c -exec sed -i 's/aSPICE/bVNC/' {} \;</p> <p>- ndk-build GSTREAMER_SDK_ROOT_ANDROID=/opt/gstreamer -j 4</p> <p>- Unfortunately, currently ndk-build destroys other pre-existing libraries in eclipse_projects/bVNC/libs, so after successfully building libspice and libgstreamer, one has to git checkout the files which were deleted.</p> <p>- Force one boolean variable to be true. You can use the following command: find ./ -name \*.java -exec sed -i 's/isSpice = .*;/isSpice = true;/' {} \;</p> <p>- You may have to select the "Android private libraries" entry in Project Properties-&gt;Java Build Path-&gt;Order and Export if you have it.</p> <p>- Enable requesting the RECORD_AUDIO permission in AndroidManifest.xml with the following sed command: sed -i 's//&lt;\/uses-permission&gt;/g' AndroidManifest.xml</p> <p>Please inform me if (6) needs to be expanded (i.e. if you needed to do anything else in addition to the above.</p> <nav class=md-post__action> <a href=../../2012/03/15/yacy/ > 继续阅读 </a> </nav> </div> </article> <nav class=md-pagination> </nav> </div> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2022 lofyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.6c14ae12.min.js></script> <script src=../../../javascripts/config.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>