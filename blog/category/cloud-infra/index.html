<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=lofyer><link href=https://docs.lofyer.org/blog/category/cloud-infra/ rel=canonical><link href=../ai/ rel=prev><link href=../collect/ rel=next><link rel=icon href=../../../images/favicon.ico><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.26"><title>cloud-infra - Lofyer's Blog</title><link rel=stylesheet href=../../../assets/stylesheets/main.6543a935.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#cloud-infra class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title="Lofyer's Blog" class="md-header__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lofyer's Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> cloud-infra </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Index </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> 博客 </a> </li> <li class=md-tabs__item> <a href=../../../datanote/ class=md-tabs__link> Docs </a> </li> <li class=md-tabs__item> <a href=../../../about/about/ class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../template_password/ class=md-tabs__link> [密码保护]Template </a> </li> <li class=md-tabs__item> <a href=../../../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Lofyer's Blog" class="md-nav__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Lofyer's Blog </label> <div class=md-nav__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> 博客 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 博客 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../archive/2023/ class=md-nav__link> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 分类 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lab/ class=md-nav__link> <span class=md-ellipsis> Lab </span> </a> </li> <li class=md-nav__item> <a href=../abm/ class=md-nav__link> <span class=md-ellipsis> abm </span> </a> </li> <li class=md-nav__item> <a href=../ai/ class=md-nav__link> <span class=md-ellipsis> ai </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> cloud-infra </span> </a> </li> <li class=md-nav__item> <a href=../collect/ class=md-nav__link> <span class=md-ellipsis> collect </span> </a> </li> <li class=md-nav__item> <a href=../devices/ class=md-nav__link> <span class=md-ellipsis> devices </span> </a> </li> <li class=md-nav__item> <a href=../diary/ class=md-nav__link> <span class=md-ellipsis> diary </span> </a> </li> <li class=md-nav__item> <a href=../draft/ class=md-nav__link> <span class=md-ellipsis> draft </span> </a> </li> <li class=md-nav__item> <a href=../filecoin/ class=md-nav__link> <span class=md-ellipsis> filecoin </span> </a> </li> <li class=md-nav__item> <a href=../followmyheart/ class=md-nav__link> <span class=md-ellipsis> followmyheart </span> </a> </li> <li class=md-nav__item> <a href=../fpga/ class=md-nav__link> <span class=md-ellipsis> fpga </span> </a> </li> <li class=md-nav__item> <a href=../hpc/ class=md-nav__link> <span class=md-ellipsis> hpc </span> </a> </li> <li class=md-nav__item> <a href=../inthecloud/ class=md-nav__link> <span class=md-ellipsis> inthecloud </span> </a> </li> <li class=md-nav__item> <a href=../linux-admin/ class=md-nav__link> <span class=md-ellipsis> linux-admin </span> </a> </li> <li class=md-nav__item> <a href=../modeling/ class=md-nav__link> <span class=md-ellipsis> modeling </span> </a> </li> <li class=md-nav__item> <a href=../my-books/ class=md-nav__link> <span class=md-ellipsis> my-books </span> </a> </li> <li class=md-nav__item> <a href=../mylife/ class=md-nav__link> <span class=md-ellipsis> mylife </span> </a> </li> <li class=md-nav__item> <a href=../new-world/ class=md-nav__link> <span class=md-ellipsis> new-world </span> </a> </li> <li class=md-nav__item> <a href=../others/ class=md-nav__link> <span class=md-ellipsis> others </span> </a> </li> <li class=md-nav__item> <a href=../ovs/ class=md-nav__link> <span class=md-ellipsis> ovs </span> </a> </li> <li class=md-nav__item> <a href=../tech/ class=md-nav__link> <span class=md-ellipsis> tech </span> </a> </li> <li class=md-nav__item> <a href=../%E4%BA%91%E8%AE%A1%E7%AE%97/ class=md-nav__link> <span class=md-ellipsis> 云计算 </span> </a> </li> <li class=md-nav__item> <a href=../%E5%8D%9A%E6%96%87/ class=md-nav__link> <span class=md-ellipsis> 博文 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../datanote/ class=md-nav__link> <span class=md-ellipsis> Docs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../about/about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../../../template_password/ class=md-nav__link> <span class=md-ellipsis> [密码保护]Template </span> </a> </li> <li class=md-nav__item> <a href=../../../tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=cloud-infra>cloud-infra</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2021-11-29 00:00:00">2021年11月29日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a>, <a href=../mylife/ class=md-meta__link>mylife</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2021/11/29/%E5%85%B3%E4%BA%8E%E4%BA%A7%E5%93%81%E5%8C%96%E7%9A%84%E4%BA%A7%E5%93%81%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/ class=toclink>关于产品的一点思考</a></h2> <p>最近在做一些小东西，但是也没匀出来时间写点啥，趁机整理整理吧。当然不能太抽象，太抽象就容易形而上学，而且让人觉得学究派。</p> <p>一个系统甭管是啥，但凡需要作为产品输出，那就要有一些属性的，现代汉语对它的释义也挺准确的——“生产出来的物品”。</p> <p>作为大千产品的用户，我有一些直观的体验，自己在做的时候也努力带给别人同样的体验。</p> <p>暂时先总结这么几个。</p> <p><strong>场景需求优先</strong>：先满足我的原始（original）需求，即我这个需求的动力是什么，然后再扩展。</p> <p><strong>低学习成本</strong>：一定不要让我在使用的过程中老是咨询厂家、翻看说明书，对to B而言就是你不要老让厂商帮你运维。</p> <p><strong>无入侵</strong>：产品提供的服务不要给我造成额外困扰。</p> <p><strong>行为尊重</strong>：用户做的动作里哪些是需要的，哪些是多余的，产品行为里哪些是别人要看的，哪些别人甚至都不需要知道，想的越多，客户越觉得被尊重。</p> <p><strong>不要自大</strong>：厂商不要自大，做一个领域，和做这个领域的产品，是两码事儿。见过自诩很懂某领域的人，但是做的工作极难批量复制，那不叫卖产品叫卖人天。</p> <p><strong>不要遵守原则</strong>：只要保证客户人财安全，你可以随意创新，不要管别人的这黄金法则那必胜定律，用户的认知从长远来看可能都是错的。</p> <p><strong>可配置</strong>：产品化与某些场景追求的高性能并不冲突，一切皆可为配置。</p> <p><strong>测试即产品</strong>：毫不夸张，没有靠谱的测试团队那产品必然不行，不要吝啬在测试上的资源，他们可以以较小成本帮你发现成数以万计个潜在问题，也不要把客户当测试，你会很难堪。</p> <p><strong>隐藏复杂性</strong>：产品内部的行为可以很复杂，但是对客户呈现的一定是简单直白的行为，没人关心你的内部实现。</p> <p><strong>社会责任感</strong>：无论to B还是C的生意，做的东西要有严谨生命周期、升级策略、迁移方法，要不然就是对客户不负责像Google那样丢失B/C类用户的甩手掌柜。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2021-05-28 00:00:00">2021年5月28日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a>, <a href=../draft/ class=md-meta__link>draft</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=k8s><a href=../../2021/05/28/%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%BA%94%E7%94%A8k8s/ class=toclink>实时操作系统中应用K8S</a></h2> <h3 id=_1><a class=toclink href=../../2021/05/28/%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%BA%94%E7%94%A8k8s/#_1>背景</a></h3> <p>想做这个东西的背景也很简单，就是KVM虚拟化里配上国产还是VxWorks的实时操作系统，实时性都比物理机差好几倍，无法满足某些客户的需求，常规的一些优化手段抓破头也不行了。看过WindRiver的StarlingX觉得它们的无论延迟还是抖动的控制都相对好一些，但是VxWorks本身是个黑盒子（可能对于某些有源码的人不是。。），所以就只能跳出来看这个问题，为了满足客户的需求，批量管理运维、快速发布回收、状态实时监控，都21世纪了我为什么要用虚拟化呢？（后来事实证明大家也很少用虚拟化做这个事儿。。）</p> <p>那就实时Linux系统配K8s，满足大规模、边缘、嵌入式场景，雷达、舰载、攻防。。。而且这个场景下想象空间比虚拟化大点。</p> <h3 id=_2><a class=toclink href=../../2021/05/28/%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%BA%94%E7%94%A8k8s/#_2>准备</a></h3> <p>OS：RHEL 8.4 with rt kernel</p> <h3 id=_3><a class=toclink href=../../2021/05/28/%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%BA%94%E7%94%A8k8s/#_3>测试</a></h3> <p>懒了，直接上测试结果以演示容器配RTLINUX是否值得投入，如果性能满足需求，那做这个市场还需要个牌照和资质，不过问题不大。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2021-02-25 00:00:00">2021年2月25日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a>, <a href=../devices/ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 3 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/ class=toclink>裸金属笔记</a></h2> <p>裸金属相关，简单点就是尽量不用计算虚拟化。</p> <hr> <h3 id=nitro-smartnicfpgaarm-based-bare-metal-hypervisor2021-02-25><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#nitro-smartnicfpgaarm-based-bare-metal-hypervisor2021-02-25>动手做自己的Nitro SmartNIC(FPGA/ARM-based Bare Metal Hypervisor(2021-02-25)</a></h3> <h4 id=0-background><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#0-background>0. BackGround</a></h4> <p>裸金属服务很酷，甲方都想要，但是最好不要有绑定。BlueField 1/2、AWS Nitro、Aliyun X-Dragon MOC之类的智能网卡也不错，虽然ZStack已经纯软件实现了类似功能，但是这篇文章仍然会探索一个如何低成本（不到100块）的“智能网卡”方案（要不然前期的调研都白瞎了）。</p> <p><strong>做弹性裸金属并不难，但是要高性能的同时又要安全，而且在私有云、产品化的语境下，我们就需要好好思考一番了。</strong></p> <h4 id=1><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#1>1. 功能定义</a></h4> <h5 id=11><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#11>1.1. 带外管理</a></h5> <p>带外管理也不是个问题，如果:</p> <ol> <li>服务器自带BMC。</li> <li>你有能力让服务器厂商给你定制，因为你需要定制BIOS部分功能以让其在启动时认到智能网卡提供的虚拟设备。</li> <li>自己做OpenBMC。</li> </ol> <p>但是，由于多数用户没有让服务器厂商高度定制服务器的能力，因而我们需要在“无米”的状态下做“炊”。</p> <h6 id=111><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#111>1.1.1. 电源管理</a></h6> <p>通过“智能网卡”我们至少要能实现主机的开关机，这个相对来说还比较容易实现，无论何种主板，电源控制接口现在服务器上都有，若干个高/低电平就可以控制。</p> <p>但是考虑到集群断电的情况，“智能网卡”要优先启动才能进一步控制它管理的物理机，所以这个设备我们一定要轻、快、稳。</p> <p>如果使用服务器内PCIE供电，那么我们又要修改BIOS来保证智能网卡优先启动，但是这个。。。成本不止100块了。</p> <p>所以考虑使用独立供电的嵌入式设备，无论使用插到服务器PCIE插槽上的ARM/FPGA/X86 SoC还是树莓派，我们都要给它独立供电。</p> <h6 id=112><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#112>1.1.2. 与主机通信</a></h6> <p>这里的通信仅仅涉及控制面的内容，数据面（网络、存储）不涉及。</p> <p>我们尊重传统，仅考虑两种情况，即与主机OS通信和与主机设备通信。</p> <p>前者一个agent走TCP/IP就能搞定，后者我们需要与主板的I3CI2C/SPI接口通信。</p> <h5 id=12><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#12>1.2. 设备模拟/透传</a></h5> <p><em>存储</em></p> <p>存储侧我们目前可以直接提供的baremetal设备有 SCSI（iSCSI）、NVMe（oF）、VirtIO等。</p> <p>由于产品化必须考虑到适配各种硬件的问题，所以我们不会定制修改BIOS，这里只要一个小小的trick即可让服务器从智能网卡提供的vda或者其他接口的“虚拟”硬盘启动，从而保证云平台存储资源可以以较高性能提供给baremetal。</p> <details> <summary>Option Rom</summary> <p>Option Rom 也是智能网卡带的选项了，启动后可以直接认到virtio/nvme的虚拟硬盘。</p> </details> <p><em>网络</em></p> <p>网络多数情况下是问题但又不是问题，我们选择智能网卡的原因是因为它可以解决大多数问题。虚拟网络资源直接给物理机的目的可以很容易地通过SDN交换机实现，但是我们既然用了一个智能网卡设备那么就应该通过它来回避各种外部环境仍然需要定制的问题。以BF2为例，它内部集成的ovs-dpdk以及Mellanox传统的内部虚拟交换技术加持，我们可以给baremetal一个“虚拟”接口，但是所有流量都在云平台的管控下，用户极难自行修改。</p> <p>如果不选择智能网卡，那么只有SDN交换机和系统内SDN两种方案，SDN交换机甚至比智能网卡的适配都简单，技术不是难点，同智能网卡一样你很难说服客户的采购来一套裸金属专用的SDN交换机，更不要说这个交换机不在他们的网工管辖范围内了。</p> <p>那么只剩系统内的overlay网络接入方案了，Linux一直不是问题，Windows系统需要agent做一些小工作才可以，即使用户自己改了，我们也可以“内挂”anti-spoofing。</p> <h5 id=13-hypervisor><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#13-hypervisor>1.3. Hypervisor模拟</a></h5> <p>“智能网卡”中要模拟hypervisor，这里的模拟是为了让多数云平台的agent比如libvirt或者基于libvirt的定制agent能够对弹性裸金属设备的调用行为与虚拟机保持一致。为什么要做这个工作呢，我单独的控制面不行吗？</p> <p>也行，但是不酷，更何况你后续的存储与网络设备不仅给裸金属也要给虚拟机，两套API两套数据库管理同一个网络/存储就是在给云平台的管控面开发找事儿。</p> <p>所以这个我们一般要对agent（libvirt）做一些修改，这个难度相比下来不大。</p> <h4 id=21-proof-of-concept><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#21-proof-of-concept>2.1. Proof of Concept</a></h4> <h5 id=21-arm-or-x86><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#21-arm-or-x86>2.1. ARM or X86作为智能网卡</a></h5> <p>如果使用ARM或者X86主机作为“智能网卡”，那么存储方案有iSCSI和NVMe-over-TCP，网络方案目前看只有系统内SDN的方法了，好处在于“智能网卡”的门槛低。</p> <p>我们先做一个OpenBMC的原型机，准备如下材料:</p> <p>笔记本; 树莓派/NVIDIA Jeston; 视频采集卡; 杜邦线; 网线； rtl-sdr（谁能拒绝一个可以听广播看电视的裸金属呢）；</p> <p>当然，一台服务器也是必要的。。。不会吧，你家里连台服务器都没有？你还做锤子钢铁侠哦？赶紧上咸鱼500块买个二手服务器吧，不想做钢铁侠了还可以卖掉。</p> <p>算了，毕竟太吵，一个ATX或者其他类型主板的台式机就可以了。</p> <p><img alt src=/blog/images/WechatIMG2-1024x768.jpeg></p> <p>TBD</p> <h5 id=22-fpga-arm-soc1000><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#22-fpga-arm-soc1000>2.2. FPGA ARM SoC作为智能网卡（有点小贵，1000多块，但是来都来了）</a></h5> <p>1000多一块的有PCI-E插槽的Xilinx ARM SoC开发版，贵，但是你可以基于PCI/PCI-E接口实现独立的网络、存储，非常有意思，但是难度在于FPGA编程。</p> <p>不过还好，我们先尝试用Pynq写一些简单的PCI/PCI-E通信，然后再堆上复杂的，但是中间会有很多IP我们要购买，没钱怎么整，社区找现成的，low点，能用。</p> <p>因为我们的目标是要基于这个FPGA实现存储和网络设备的接入，那么总归是一个大点的工程，如果做的先进点实现virtio网络/存储的接入，那对于提供虚拟化的云平台将善莫大焉。</p> <hr> <h3 id=windowsoverlay-2020-05-21><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#windowsoverlay-2020-05-21>"Windows中使用overlay网络的一些方案" "2020-05-21"</a></h3> <h4 id=_2><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#_2>引言</a></h4> <p>21世纪了，智能网卡还是贵，交换机客户没法直接买，软件技术栈都好找，性能再加强，ebpf不错，要是Windows的Linux子系统里支持这个那软裸金属方案至此可以画上一个句（分）号了。</p> <p>关于如何在Windows裸金属中给用户交付流畅且易配置的云平台overlay网络，从而跟虚拟化打通，也是个最近要考虑的点。</p> <h4 id=sdn><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#sdn>SDN交换机与智能网卡</a></h4> <p>我们可以用国内品牌，他们也提供ovs接口，but，对于小体量的客户或者采购严格的客户就很难，仅适合自有IDC且有决心的客户。</p> <p>为了使用一个功能，软件绑定就算了，硬件你还要我买你的，固定资产无法二次利用，别想了。</p> <h4 id=grevxlanwindows><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#grevxlanwindows>GRE/VXLAN(Windows)</a></h4> <p>Windows从08/12后自带了NVGRE，VXLAN的话是从16开始支持，听起来也不错，所以这个对于新晋用户是<strong>可以接受的</strong>。</p> <h4 id=ovs><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#ovs>OVS</a></h4> <p>Windows下有ovs，但是仅支持2012后的，这样就没法解决Windows2008的问题（再过几年就不用操心这个问题了），当然主要的问题还是没有官方背书。</p> <hr> <h3 id=xilinxintel-fpga-2019-04-29><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#xilinxintel-fpga-2019-04-29>"使用Xilinx/Intel FPGA加速虚拟化" "2019-04-29"</a></h3> <p>UPDATE: <a href=http://tech.mytrix.me/2019/05/devconf-19-virtio-%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F/ >老王的笔记</a>中也总结了一些关于devconf的内容。</p> <p>This article is just a collection of ideas and posts.</p> <p>Recently I was doing some performance-tunning of QEMU/KVM with kinds of pure-software ways. However, it ended with the existence of QEMU/KVM's process load.</p> <p>I just remembered that I used to do some co-sim work with National Instruments LabView about ten years ago...(during college life...fk...I'm still young...)</p> <h4 id=trial-no1><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no1>Trial No.1</a></h4> <p>TBD: Start QEMU instance(s) with passthrough-ed PCI(PCI-SRIOV) devices like ethernet controller or NVMe controller designed in PCI FPGA to offload the emulated works.</p> <h4 id=trial-no2><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no2>Trial No.2</a></h4> <p>TBD: Start QEMU instance with devices ported to passthrough-ed PCI FPGA as many as possible, i.e. usb controller, ethernet controller and etc..(Like a dock with kinds of devices...)</p> <p>But I think it will be replaced by Trial No.1.</p> <h4 id=trial-no3><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no3>Trial No.3</a></h4> <p>TBD: Co-Sim.</p> <h4 id=trial-no4><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no4>Trial No.4</a></h4> <p>SoC FPGA, as DOM0.</p> <h4 id=trial-no5><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no5>Trial No.5</a></h4> <p>ASIC offload with slight host management.</p> <h4 id=references><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#references>References</a></h4> <p>[1] Running Xilinx in QEMU, <a href=https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842060/QEMU>https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842060/QEMU</a></p> <p>[2] Building Xen Hypervisor with Petalinux 2019.1, <a href=https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/99188792/Building+Xen+Hypervisor+with+Petalinux+2019.1>https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/99188792/Building+Xen+Hypervisor+with+Petalinux+2019.1</a></p> <p>[3] QEMU SystemC and TLM CoSimulation, <a href=https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842109/QEMU+SystemC+and+TLM+CoSimulation>https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842109/QEMU+SystemC+and+TLM+CoSimulation</a></p> <hr> <h3 id=windowsebpf-2022-02-10><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#windowsebpf-2022-02-10>"Windows中使用eBPF" "2022-02-10"</a></h3> <h4 id=_3><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#_3>背景</a></h4> <p>也挺有意思的，前年念叨着<a href=https://blog.lofyer.org/sdn-windows-linux-baremetal/ >Windows内的SDN方案咋做</a>，去年微软终于就搞了个<a href=https://github.com/Microsoft/ebpf-for-windows>eBPF for Windows</a>，如此以来结合Windows新版本自带的NVGRE/VxLAN网络，安全组、EIP、LB啥的在纯软裸金属里都好说了。</p> <p>另外，迫于适配智能与半智能网卡的压力，ZStack已经提供了ovs与linux bridge两个技术栈的网络（新建集群的时候可以选，虽然不是第一个但早些时候收到的需求确实不硬开发也忙。。），所以现在看起来一切都很合理。</p> <p>当然，产品的东西跟新技术并不是什么强绑定关系，技术只是锦上添花实现产品的工具，稳定优先。</p> <h4 id=_4><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#_4>测试</a></h4> <h3 id=ebpf-for-windows><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#ebpf-for-windows>编译eBPF for Windows</a></h3> <h3 id=_5><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#_5>测试程序</a></h3> <h3 id=vxlannvgre><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#vxlannvgre>VxLAN/NVGRE集成</a></h3> <hr> <p>title: "Xilinx FPGA中应用P4网络数据面编程" date: 2019-07-11 categories: - "cloud-infra" - "devices"</p> <hr> <h2 id=0-background_1><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#0-background_1>0. Background</a></h2> <p>As we all know, P4 is about to be the future of OpenFlow 2.0, and to achieve an totally software defined network with programmable control plane and data plane.</p> <h2 id=1-basic-knowledge><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#1-basic-knowledge>1. Basic Knowledge</a></h2> <p>Since we've got P4 working on X86 server</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/WechatIMG1.jpeg><img alt src=/blog/images/WechatIMG1-768x1024.jpeg></a></p> <p>In SDN controller ONOS.</p> <h2 id=2-softwarehardware-plant><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#2-softwarehardware-plant>2. Software/Hardware Plant</a></h2> <h3 id=21-pureway-p4-bitstream><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#21-pureway-p4-bitstream>2.1. Pureway: P4 bitstream</a></h3> <h3 id=22-easyway-p4-on-petalinux><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#22-easyway-p4-on-petalinux>2.2. Easyway: P4 on PetaLinux</a></h3> <h2 id=3-further-exploration><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#3-further-exploration>3. Further Exploration</a></h2> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2021-01-06 00:00:00">2021年1月6日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a>, <a href=../tech/ class=md-meta__link>tech</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=rdmagpu><a href=../../2021/01/06/%E8%99%9A%E6%8B%9F%E6%A1%8C%E9%9D%A2%E4%B8%AD%E9%80%9A%E8%BF%87rdma%E8%BF%9B%E8%A1%8Cgpu%E8%B7%A8%E8%8A%82%E7%82%B9%E8%B0%83%E7%94%A8%E4%BB%8E%E8%80%8C%E5%8A%A0%E9%80%9F%E6%B8%B2%E6%9F%93/ class=toclink>虚拟桌面中通过RDMA进行GPU跨节点调用从而加速渲染</a></h2> <p>许久没关注过VDI了，一直坚持的观点就是协议要牛逼，否则就是渣。</p> <p>VOI、IDV都不太行，GPU本机显示还是有些小问题，要么远程的，要么就没有虚拟化。</p> <p>直到离开VDI行业三年多后发现还有这个炫酷的东西满足了当时我对单机虚拟化的期望，https://looking-glass.io，虚拟机与宿主机可以共享显示（iGPU），或者独占显示但是键鼠仍然与原生一致。</p> <p>PS：ArchLinux社区万岁，<a href=https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E4%BD%BF%E7%94%A8Looking_Glass%E5%B0%86%E5%AE%A2%E6%88%B7%E6%9C%BA%E7%94%BB%E9%9D%A2%E6%B5%81%E5%BC%8F%E4%BC%A0%E8%BE%93%E5%88%B0%E5%AE%BF%E4%B8%BB%E6%9C%BA>这是原文</a>。</p> <p>之前Intel的老板说用iGVT可以，但是仅限于Intel集显，没有可复制性。现在发现这玩意儿以后，关于边缘计算的场景真的又可以展开一些了，朋友，之前机场工控机虚拟化管理还要大屏的需求我们再聊一聊？</p> <p>原理说复杂也不复杂，作者思路从被广泛采用的桌面截取（OBS、DX API、NVIDIA Stream）到共享内存（IVSHMEM），纯内存交换。</p> <p>很有意义，远程桌面协议换成共享内存协议，然后可以进一步用RDMA，再配上virtio-gpu，就可以跨节点渲染了，虚拟化版本的virgl。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2020-07-24 00:00:00">2020年7月24日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=nvme-in-the-cloudzstack><a href=../../2020/07/24/nvme-in-the-cloudzstack%E9%80%82%E5%90%88%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E5%AD%98%E5%82%A8/ class=toclink>NVMe in the Cloud(ZStack)，（适合）云原生的存储</a></h2> <p>NVMe作为新的存储协议，更能将新的存储介质的性能发挥出来，与此同时，与SCSI存储对等的NVMeOverRDMA和NVMeOverTCP也已经开始在数据中心中崭露头角（忽略FC，发展太慢了）。 传统云平台中的对这些存储设备的使用是没有任何问题的，但是在不改变存储对接架构的情况下发挥出其原生性能则是一个挑战。 关于瓶颈的问题，我们可以从不同的存储对接路径去分析。</p> <p>当然，不同于公有云的机器完全自定义，硬件自己随便攒，私有云为了要达成产品化需要考虑的因素比公有云更为繁杂（当然在私有云大规模这个方向上就弱很多了）。</p> <p>NVMeOverTCP的好处除了其性能之外，还有就是万兆以上线速，有多少来多少。</p> <p>作为对比，我们使用Linux新版本自带的NVMe over TCP/RoCEv2 target。</p> <p>硬件测试设备与软件：LightBits, Linux NVMe over TCP target, Linux NVMe over ROCEv2 target</p> <p>软件测试方法：https://blogs.oracle.com/linux/nvme-over-tcp</p> <p>测试客户端：100Gb x 2、25Gb x 4</p> <p>测试云平台：ZStack 3.8，io_uring，spdk</p> <p>对接方法：</p> <h2 id=direct-to-guest><a class=toclink href=../../2020/07/24/nvme-in-the-cloudzstack%E9%80%82%E5%90%88%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E5%AD%98%E5%82%A8/#direct-to-guest>Direct to Guest</a></h2> <h3 id=passthrough><a class=toclink href=../../2020/07/24/nvme-in-the-cloudzstack%E9%80%82%E5%90%88%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E5%AD%98%E5%82%A8/#passthrough>PassThrough</a></h3> <h3 id=directconnect><a class=toclink href=../../2020/07/24/nvme-in-the-cloudzstack%E9%80%82%E5%90%88%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E5%AD%98%E5%82%A8/#directconnect>DirectConnect</a></h3> <h2 id=via-host><a class=toclink href=../../2020/07/24/nvme-in-the-cloudzstack%E9%80%82%E5%90%88%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E5%AD%98%E5%82%A8/#via-host>Via Host</a></h2> <h3 id=cluster-filesystem><a class=toclink href=../../2020/07/24/nvme-in-the-cloudzstack%E9%80%82%E5%90%88%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E5%AD%98%E5%82%A8/#cluster-filesystem>Cluster Filesystem</a></h3> <h3 id=shared-block><a class=toclink href=../../2020/07/24/nvme-in-the-cloudzstack%E9%80%82%E5%90%88%E4%BA%91%E5%8E%9F%E7%94%9F%E7%9A%84%E5%AD%98%E5%82%A8/#shared-block>Shared Block</a></h3> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-11-17 00:00:00">2019年11月17日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=armx86><a href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/ class=toclink>ARM/X86服务器的安卓市场（虚拟化、容器）</a></h2> <h2 id=0><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#0>0. 背景</a></h2> <p>随着国产化进程的推进，相当的应用已经可在国产化服务器（ARM/X86）上运行，本文将使用容器以及虚拟化两种技术对ARM/X86服务器上运行高性能的Android桌面进行探索。</p> <p>调研了一圈实现，业界性价比最高的还是用板卡。。但是初始研究成本高一些，决心做的话可以先买一些现成的深圳货，但是对于入门的厂商来说还是用arm服务器跑容器合适，毕竟是安卓。</p> <h2 id=1-armx86><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#1-armx86>1. ARM/X86服务器</a></h2> <h3 id=11><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#11>1.1. 虚拟化</a></h3> <p>使用X86服务器去虚拟化Android的厂商确实不多，社区有提供X86版本Android模，使用X86去模拟ARM版本的Android几乎没人做（效率极差）。</p> <p>但是随着国内这几年ARM服务器市场上来，不少厂商早就开始探索ARM服务器去虚拟ARM版Android了，虽然效率较X86有很大提升，但是相比容器技术代价仍然很高，模拟出的手机定价低导致大家都是探索性的尝试。</p> <h3 id=12><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#12>1.2. 容器</a></h3> <p>这已经是一个较为成熟的技术了，但是缺点在于虚拟出的设备不完善。</p> <p>Docker-Android</p> <p>Anbox(LXC)</p> <p>Xdroid</p> <h3 id=2-gpu><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#2-gpu>2. GPU</a></h3> <h4 id=nvidia><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#nvidia>NVIDIA</a></h4> <h4 id=mali><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#mali>Mali</a></h4> <h2 id=3><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#3>3. 桌面协议</a></h2> <p>凡上上规模的Android模拟都需要成熟的桌面协议，而这又与他采用GPU设备相关。</p> <p>由于qemu的ARM模拟的VGA设备由于其天生架构问题，不能正常使用，因而暂时需要使用virtio-vga设备方可显示（https://www.linux-kvm.org//blog/images/0/09/Qemu-gfx-2016.pdf）。</p> <h3 id=31><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#31>3.1. 带内协议</a></h3> <p>VNC</p> <p>SPICE</p> <p>RDP/ICA</p> <p>PCoIP</p> <h3 id=32><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#32>3.2. 带外协议</a></h3> <p>VNC</p> <p>SPICE</p> <p>PCoIP--- title: "Building the infrastructure for cloud security" date: 2015-02-08 categories: - "cloud-infra"</p> <hr> <p><strong>Host</strong> TPM Attesation Mt. Wilson Geo-tag HyTrust McAfee ePO</p> <p><strong>VM management</strong> SSO SDN VLAN Firewall</p> <h3 id=vm-appliance-mystery-hill><a class=toclink href=../../2019/11/17/armx86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%AE%89%E5%8D%93%E5%B8%82%E5%9C%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AE%B9%E5%99%A8/#vm-appliance-mystery-hill><strong>VM Appliance</strong> Mystery Hill</a></h3> <p>title: "Home-based hybridcloud（家庭作坊式混合云）" date: 2017-10-24 categories: - "cloud-infra" - "linux-admin"</p> <hr> <p>名字起的不好听，不过无所谓，也是混合云了，做到了什么地步呢？ 在数据层面，家中机器和linode以及gcp公有云全通，任意地点的客户端可以通过局域网地址访问家中和公有云，而这一且，只需要一个公网IP。那么如何组建呢？</p> <ol> <li> <p><strong>选择一个趁手的VPN</strong>，这里我使用的是SoftEther，全平台全功能，图形界面客户端全都有，自带域名反向解析，自带公网，又那么稳定，为啥不用。 只要在家中的一台PC上装好服务端，把5555端口通过路由器（有公网IP）映射出去即可完成VPN服务器的搭建。</p> </li> <li> <p><strong>Linode服务器集群选择一台作为网关（边界路由器）</strong>，负责作为客户端接入VPN服务器，那么它就有了192.168.0段的地址，其它机器上因为linode没有VPC的概念，所以得加条到192.168.0.0/24的路由。</p> </li> <li> <p>总结下来，接入到home的VPN服务器会给所有客户端一个home的IP地址，然后加的路由表（使linode集群的10段暴露出去）都围绕这个地址展开达到互通的目的。</p> </li> <li> <p>目前我把linode上分散在全球8个机房的私有服务器都加了进来，当然，安全线路。尝试了一次kcptun加速VPN连接，但是linux下失败了，windows成功。</p> </li> </ol> <p>这是图，PC-Server为VPN服务器，LINODE为公有云，也加入了Google的公有云进去（没画），Windows-PC为个人服务器。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/homebasedhybridcloud-1.png><img alt src=/blog/images/homebasedhybridcloud-1.png></a></p> <p>联通之后，Google的CDN、DNS可以混合到Linode去使用了，再展开点，大数据、数据库都可以结合Linode去跑了。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-05-10 00:00:00">2019年5月10日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a>, <a href=../devices/ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 4 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=sdr><a href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/ class=toclink>软件定义无线电（SDR）的设备、软件与应用指南</a></h2> <p><a href=https://blog.lofyer.org/wp-content/uploads/www.youtube.com_watch_v-mks0TAwqQUlistPLbBQHMnVMR41tOomyB0o7UKAxwKINkFFnindex4.png><img alt src=/blog/images/www.youtube.com_watch_v-mks0TAwqQUlistPLbBQHMnVMR41tOomyB0o7UKAxwKINkFFnindex4.png></a></p> <p><strong>注意：本文内容仅限于实验室安全测试目的，禁止用于任何商业或违反当地法律法规的活动。</strong></p> <p><strong>不管是较贵的Ettus还是入门的HackRF，抑或是最初级的RTL-SDR设备，都可以使用这篇教程中的绝大部分内容。</strong></p> <p><a href="https://www.youtube.com/watch?v=Wt_c_H6HQAU&list=PLbBQHMnVMR41tOomyB0o7UKAxwKINkFFn">GRCon2019</a></p> <p>https://www.gnuradio.org/grcon/grcon17/presentations/</p> <p>https://www.gnuradio.org/grcon/grcon18/presentations/</p> <p>https://www.gnuradio.org/grcon/grcon19/presentations/</p> <p>https://github.com/mossmann/hackrf/wiki</p> <p>https://www.hackrf.net/hackrf%E4%B8%8Egnuradio%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/</p> <p>http://www.hackrf.net/faq/</p> <p>https://wiki.myriadrf.org/LimeSDR</p> <p>https://myriadrf.org/news/limesdr-made-simple-part-1/</p> <p><a href=https://blog.lofyer.org/software-defined-radio-device-software-application-guide/ >雪碧0xroot的PPT</a></p> <h2 id=0><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#0>0. 环境准备</a></h2> <h3 id=01><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#01>0.1 硬件</a></h3> <table> <thead> <tr> <th></th> <th>HackRF One</th> <th>Ettus B200</th> <th>Ettus B210</th> <th>BladeRF x40</th> <th>LimeSDR</th> <th>LimeSDR mini</th> </tr> </thead> <tbody> <tr> <td>Frequency Range</td> <td>1MHz-6GHz</td> <td>70MHz-6GHz</td> <td>70MHz-6GHz</td> <td>300MHz-3.8GHz</td> <td>100kHz-3.8GHz</td> <td>100kHz-3.5GHz</td> </tr> <tr> <td>RF Bandwidth</td> <td>20MHz</td> <td>61.44MHz</td> <td>61.44MHz</td> <td>40MHz</td> <td>61.44MHz</td> <td>30.72MHz</td> </tr> <tr> <td>Sample Depth</td> <td>8 bits</td> <td>12 bits</td> <td>12 bits</td> <td>12 bits</td> <td>12 bits</td> <td>12 bits</td> </tr> <tr> <td>Sample Rate</td> <td>20MSPS</td> <td>61.44MSPS</td> <td>61.44MSPS</td> <td>40MSPS</td> <td>3.2MSPS</td> <td>61.44MSPS</td> </tr> <tr> <td>Transmitter Channels</td> <td>1</td> <td>1</td> <td>2</td> <td>1</td> <td>2</td> <td>1</td> </tr> <tr> <td>Receivers</td> <td>1</td> <td>1</td> <td>2</td> <td>1</td> <td>2</td> <td>1</td> </tr> <tr> <td>Duplex</td> <td>Half</td> <td>Full</td> <td>Full</td> <td>Full</td> <td>Full</td> <td>Full</td> </tr> <tr> <td>Interface</td> <td>USB 2.0</td> <td>USB 3.0</td> <td>USB 3.0</td> <td>USB 3.0</td> <td>USB 3.0</td> <td>USB 3.0</td> </tr> <tr> <td>Programmable Logic Gates</td> <td>64 macrocell CPLD</td> <td>75k</td> <td>100k</td> <td>40k (115k avail)</td> <td>40k</td> <td>40k</td> </tr> <tr> <td>Chipset</td> <td>MAX5864, MAX2837, RFFC5072</td> <td>AD9364</td> <td>AD9361</td> <td>LMS6002M</td> <td>LMS7002M</td> <td>LMS7002M</td> </tr> <tr> <td>Open Source</td> <td>Full</td> <td>Schematic, Firmware</td> <td>Schematic, Firmware</td> <td>Schematic, Firmware</td> <td>Full</td> <td>Full</td> </tr> <tr> <td>Oscillator Precision</td> <td>+/-20ppm</td> <td>+/-2ppm</td> <td>+/-2ppm</td> <td>+/-1ppm</td> <td> +/-1ppm initial</td> <td></td> </tr> <tr> <td>+/-4ppm stable</td> <td> +/-1ppm initial</td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </tbody> </table> <p>+/-4ppm stable | | Transmit Power | -10dBm+ (15dBm @ 2.4GHz) | 10dBm+ | 10dBm+ | 6dBm |  0 to 10dBm | 0 to 10dBm | | Price | 249€ euros VAT Exc. | 991€ euros VAT Exc. | 1658€ euros VAT Exc. | 625€ euros VAT Exc. | 332€ euros VAT Exc. | 190€ euros VAT Exc. |</p> <h3 id=02><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#02>0.2 驱动</a></h3> <h3 id=03><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#03>0.3 软件</a></h3> <p>https://unicorn.360.com/blog/2017/04/12/LimeSDR-Getting-Started-Quickly/</p> <p>https://oneguyoneblog.com/2016/09/15/sdrsharp-sdr-installing-windows-10/</p> <p>下载SDR#后，重启按F7进入“禁用驱动签名”的运行模式，运行其中的install-rtlsdr.bat，替换第0个驱动</p> <h2 id=1><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#1>1. 接收信号</a></h2> <p>接收信号建议使用gqrx（MacOS、Linux），也可以用sdrsharp（Windows）。</p> <p>https://www.rtl-sdr.com/big-list-rtl-sdr-supported-software/</p> <p>$ port info gqrx</p> <p>$ sudo port install gqrx</p> <p>接收信号以后，你可以做的内容就比较多了，这里我会举一些比较有意思的例子。</p> <h3 id=11><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#11>1.1. 听广播/看电视</a></h3> <p>http://dalvikplanet.blogspot.com/2017/03/how-to-get-working-rtl2832u-r820t2-on.html</p> <h3 id=12><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#12>1.2. 接收气象云图</a></h3> <p>SDR软件</p> <p>虚拟声卡</p> <p>WXtoimg</p> <p>gpredict/orbitron</p> <p>https://www.rtl-sdr.com/rtl-sdr-tutorial-receiving-noaa-weather-satellite-/blog/images/</p> <p>https://wischu.com/archives/528.html</p> <p>GSM嗅探</p> <p>https://www.cnblogs.com/k1two2/p/7000942.html</p> <h3 id=13-gps><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#13-gps>1.3. 接收GPS信息</a></h3> <p>https://swling.com/blog/2016/04/guest-post-using-the-hackrf-one-for-dgps-beacon-reception/</p> <p>http://sdrgps.blogspot.com/2016/12/rtl-sdr-to-orbit-with-limesdr.html</p> <h3 id=14-direction-finding-and-passive-rador><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#14-direction-finding-and-passive-rador>1.4. 方向探测与被动雷达 Direction Finding and Passive Rador</a></h3> <p>https://www.rtl-sdr.com/ksdr/</p> <h3 id=15-whatever-you-want-legally><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#15-whatever-you-want-legally>1.5. 接收whatever you want LEGALLY</a></h3> <p>zigbee https://github.com/bastibl/gr-ieee802-15-4</p> <p>https://github.com/BastilleResearch/scapy-radio/tree/master/gnuradio/gr-zigbee</p> <h2 id=2><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#2>2. 发送信号</a></h2> <h3 id=21-gps><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#21-gps>2.1. 发送GPS信号</a></h3> <p>https://gist.github.com/gyaresu/343ae51ecbb70486e270</p> <p>https://www.cnblogs.com/k1two2/p/5477291.html#4245780</p> <p>https://gorgias.me/2017/07/30/HackRF-GPS-%E6%AC%BA%E9%AA%97/</p> <p>https://github.com/osqzss/LimeGPS</p> <h3 id=22><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#22>2.2. 发送文字/音视频</a></h3> <p>Windows软件sdrangel</p> <p>http://gareth.codes/hackrf-transmit/</p> <p>https://github.com/fsphil/hacktv</p> <p>http://www.irrational.net/2014/03/02/digital-atv/</p> <p>http://www.hackrf.net/2014/06/hackrf_nbfm_tx_n_ctcss_squelch/</p> <p>http://www.xn--hrdin-gra.se/blog/wp-content/uploads/2015/08/nbfm-tx.grc</p> <p>https://gist.github.com/gyaresu/343ae51ecbb70486e270</p> <p>https://nuclearrambo.com/wordpress/transferring-a-text-file-over-the-air-with-limesdr-mini/</p> <p>https://github.com/martinmarinov/TempestSDR</p> <h2 id=3><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#3>3. 收发信号</a></h2> <h3 id=gsm><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#gsm>GSM</a></h3> <p>https://www.evilsocket.net/2016/03/31/how-to-build-your-own-rogue-gsm-bts-for-fun-and-profit/</p> <p>https://yatebts.com/open_source/</p> <p>https://cn0xroot.com/2017/01/10/iot-mode-fuzzing-with-openbt/</p> <h3 id=lte><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#lte>LTE</a></h3> <p>https://yq.aliyun.com/articles/310348</p> <p>https://www.cnblogs.com/k1two2/p/5666667.html</p> <p>https://cn0xroot.com/2017/04/12/limesdr-getting-started-quickly/</p> <h3 id=openbtslimesdr><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#openbtslimesdr>OpenBTS+LimeSDR</a></h3> <p>Prepare:</p> <p>Ubuntu Desktop 16.04 &amp; LimeSDR 1.4s with <strong>LimeSuite 17.12(If not, OpenUSRP will fail.)</strong></p> <h4 id=install-build-essential-packages><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-build-essential-packages>Install build-essential packages</a></h4> <h2 id=packages-for-soapysdr-available-at-myriadrf-ppa><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#packages-for-soapysdr-available-at-myriadrf-ppa>packages for soapysdr available at myriadrf PPA</a></h2> <p>sudo add-apt-repository -y ppa:myriadrf/drivers sudo apt-get update</p> <h2 id=install-core-library-and-build-dependencies><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-core-library-and-build-dependencies>install core library and build dependencies</a></h2> <p>sudo apt-get install -y git g++ cmake libsqlite3-dev</p> <h2 id=install-hardware-support-dependencies><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-hardware-support-dependencies>install hardware support dependencies</a></h2> <p>sudo apt-get install -y libsoapysdr-dev libi2c-dev libusb-1.0-0-dev</p> <h2 id=install-graphics-dependencies><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-graphics-dependencies>install graphics dependencies</a></h2> <p>sudo apt-get install -y libwxgtk3.0-dev freeglut3-dev</p> <h2 id=install-for-building-uhd><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-for-building-uhd>Install for building uhd</a></h2> <p>sudo apt-get install libboost-all-dev libusb-1.0-0-dev python-mako doxygen python-docutils cmake build-essential</p> <h4 id=change-to-uhd-driver-via-uhd><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#change-to-uhd-driver-via-uhd>Change to UHD driver via uhd</a></h4> <p>$ cd ~ # build and install limesuite $ git clone https://github.com/myriadrf/LimeSuite.git $ cd LimeSuite $ mkdir builddir &amp;&amp; cd builddir $ cmake ../ $ make -j4 $ sudo make install $ sudo ldconfig</p> <p>$ cd ~ # build uhd, install, enable lime, rebuild $ git clone https://github.com/EttusResearch/uhd.git $ cd uhd/host/ $ mkdir build &amp;&amp; cd build $ cmake ../ $ make -j4 $ sudo make install $ git clone https://github.com/jocover/OpenUSRP.git lib/ursp/OpenUSRP # DO NOT GO OUT $ echo "INCLUDE_SUBDIRECTORY(OpenUSRP)"&gt;&gt;lib/ursp/CMakeLists.txt $ cmake ../ $ make -j4 $ sudo make install</p> <h4 id=or-change-to-uhd-driver-via-soapysdr><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#or-change-to-uhd-driver-via-soapysdr>Or, Change to UHD driver via SoapySDR</a></h4> <p>$ git clone https://github.com/pothosware/SoapySDR $ cd SoapySDR $ mkdir builddir;cd builddir; cmake ../ $ make -j4 $ sudo make install</p> <p>$ git clone https://github.com/myriadrf/LimeSuite $ cd LimeSuite</p> <h4 id=build-openbts><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#build-openbts>Build OpenBTS</a></h4> <h2 id=4-sdr><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#4-sdr>4. SDR</a></h2> <p>软件定义无线电的内容即是可以灵活定义信号的处理过程，比如输出到TCP/UDP、文字音视频解码等。其中比较有名的有GNURadio、SoapySDR、Pothos（IDE）等（这里以GNURadio为例）。推荐在Linux中安装，当然也可在MacOS或者Windows中使用MacPorts进行安装，除此之外，也有<a href=https://mirrors.tuna.tsinghua.edu.cn/help/pybombs/ >PyBombs</a>可选。</p> <p>在MacOS中安装需要使用MacPorts、XQuartz，MacPorts安装内容如下。</p> <p>$ port info gnuradio $ sudo port install gnuradio+wxgui gr-osmosdr sox $ port content gnuradio $ sudo port install hackrf $ sudo port install rtl-sdr $ sudo port search gr- # if you wanna more modules in gnuradio, don't be shy</p> <p>然后打开XQuartz，将/opt/local/bin/gnuradio-companion加入到X自定义应用程序菜单中（建议修改默认的X终端程序内容为_xterm -e "source ~/.bash_profile;/bin/bash"_）。</p> <p>https://greatscottgadgets.com/sdr/</p> <p>https://gist.github.com/machinaut/addf3438ef0c1a9cad38</p> <p>https://osmocom.org/projects/gr-osmosdr/wiki/GrOsmoSDR#RTL-SDRSource</p> <p>https://pypi.org/project/pyrtlsdr/#description</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2018-08-13 00:00:00">2018年8月13日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a>, <a href=../hpc/ class=md-meta__link>hpc</a></li> <li class=md-meta__item> 需要 2 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=hpc><a href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/ class=toclink>HPC相关</a></h2> <h3 id=hpc2018-08-13><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#hpc2018-08-13>HPC入门指南(2018-08-13)</a></h3> <h4 id=1-history><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#1-history>1. History</a></h4> <p>Wikipedia is good. <a href=https://en.wikipedia.org/wiki/Supercomputer>https://en.wikipedia.org/wiki/Supercomputer</a></p> <h4 id=2-stack><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#2-stack>2. Stack</a></h4> <h5 id=21-hardware><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#21-hardware>2.1. Hardware</a></h5> <p>Storage Network Server Cooler</p> <h5 id=22-software><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#22-software>2.2. Software</a></h5> <p>Infrastructure deployment Parallel Filesystem Workload Management Development</p> <p>Finally, we've got a PPT.</p> <p>但是这个PPT很长，我只能截一些出来。</p> <p><img alt src=/blog/images/20220129131347-1024x470.jpg></p> <p><img alt src=/blog/images/20220129131424-1024x509.jpg></p> <h3 id=hpc2022-02><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#hpc2022-02>HPC增补(2022-02)</a></h3> <p>HPC的生意目前来看还是集成，部分组件可以标准化，但是克雷、富士通、IBM、NVIDIA都有自己的盘子，库也都是为自家架构优化，这些都没有问题，理解。</p> <p>想搞高性能向HPC技术方向学习，也没有问题，但是搞完过后想复制，那就铺人天了。一堆定制设备、一堆专有技术栈，加上已知最好的设备和软件都是国外垄断，生意做着做着就自己就成集成商了。集成商没啥不好，毕竟150W刀一个P的算力，这生意走量。国产化版本堆算力早些年成本差不多两倍，但现在差距在逐步缩小。</p> <p>HPC的生意不好做，进不去圈子，但是汤可以喝，而且大厂们也想喝这个汤，不信你看GPFS都卖给了谁。后来做的纯软裸金属算是产品入局了，但是再往上走适配一个已经很很很完整的生态，想想都觉得累。</p> <h3 id=rdmasap><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#rdmasap>算了，回头把RDMA技术栈补一补，这样或许可以再搞些其他的花样，只是产品化的路没那么好走，但是集成的生意要啥产品化呢，还是要的，你看SAP模块化也厉害的一塌糊涂。</a></h3> <p>title: "构建基于ARM的超算集群" date: 2019-08-26 categories: - "cloud-infra" - "devices" - "hpc"</p> <hr> <h2 id=background><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#background>Background</a></h2> <p>Nowadays ARM-based servers are being applied to many scenarios, so we are going to port some workload to the minimal ARM SoC with NVIDIA GPU to evaluate the feasibility of production usage.</p> <h2 id=preparation><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#preparation>Preparation</a></h2> <p>Hardware: Legacy ARM SoC boards, e.g. Raspberry Pi, Beagle Board, NVIDIA Jetson(GPU) and standard ARM-based servers.</p> <p>MPI: OpenMPICH and MPICH2.</p> <p>Share Storage: ARM-based Glusterfs with pNFS.</p> <p>Application: ANY</p> <h2 id=buildinstallation><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#buildinstallation>Build/Installation</a></h2> <p>Ref:</p> <p>[1] <a href=https://developer.arm.com/solutions/hpc>https://developer.arm.com/solutions/hpc</a></p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-10-26 00:00:00">2017年10月26日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2017/10/26/%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E8%BF%81%E4%BA%91%E5%BF%85%E5%A4%87/ class=toclink>备份工具（迁云必备）</a></h2> <ul> <li> <p>UrBackup <a href=https://www.urbackup.org/features.html>https://www.urbackup.org/features.html</a> </p> </li> <li> <p>Amanda <a href=http://amanda.zmanda.com/ >http://amanda.zmanda.com/</a> </p> </li> <li> <p>Bacula <a href=https://blog.bacula.org/ >https://blog.bacula.org/</a> </p> </li> <li> <p>BareOS <a href=https://www.bareos.org>https://www.bareos.org</a> </p> </li> <li> <p>Duplicati <a href=https://www.duplicati.com>https://www.duplicati.com</a> </p> </li> <li> <p>kvmBackup <a href=https://github.com/bioinformatics-ptp/kvmBackup>https://github.com/bioinformatics-ptp/kvmBackup</a></p> </li> </ul> <p>直接说结论吧，使用下来，UrBackup与Duplicati是较为合适的两个选择。</p> <p>UrBackup采用传统的CS架构，对全平台提供支持，备份选项较为丰富，而且支持公网中继； Duplicati则是较为轻量级的选择，只要安装agent即可，支持备份目标地址较为丰富，除了传统接口外也支持AWS S3接口； Bacula与BareOS（前者变种）属于同一体系，但后者支持更好广泛些； Amanda除了硬盘文件备份，也多了一个MySQL数据库的备份产品； 最后一个KVMBackup则是一个脚本，限制比较多，适合单纯的KVM环境备份。</p> <p>如果与ZStack对接，这俩都可以，备份存储地址可以选择FTP，这样就可以直接使用ZStack的ZStore镜像存储，格式使用raw，然后就直接启动了。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-07-15 00:00:00">2017年7月15日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>cloud-infra</a>, <a href=../draft/ class=md-meta__link>draft</a></li> <li class=md-meta__item> 需要 7 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/ class=toclink>云计算笔记</a></h2> <hr> <h3 id=use-dhcp-or-dnsmasq-as-dhcp-server-in-libvirt-based-environment-2015-08-26><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#use-dhcp-or-dnsmasq-as-dhcp-server-in-libvirt-based-environment-2015-08-26>"Use dhcp or dnsmasq as DHCP server in libvirt-based environment" "2015-08-26"</a></h3> <p>Default dhcp and dnsmasq are conflict in a OS. Just change to another if one failed.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code># yum install dhcp
</code></pre></div></td></tr></table></div> <p>/etc/sysconfig/dhcpd is no longer needed in RHEL-7. However, it is still working in other distributions. <strong>Just assign an IP to the interface which in the subnet you want dhcp serve</strong>.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span></pre></div></td><td class=code><div><pre><span></span><code>[root@localhost ~]# vi /etc/sysconfig/dhcpd
DHCPDARGS=&quot;eth0 eth1&quot;;

[root@localhost ~]# yum -y install dhcp
[root@localhost ~]# vi /etc/dhcp/dhcpd.conf
# create new
# specify domain name
option domain-name &quot;example.com&quot;;
# specify name server&#39;s hostname or IP address
option domain-name-servers dhcp.example.com;
# default lease time
default-lease-time 600;
# max lease time
max-lease-time 7200;
# this DHCP server to be declared valid
authoritative;
# specify network address and subnet mask
subnet 10.0.0.0 netmask 255.255.255.0 {
    # specify the range of lease IP address
    range dynamic-bootp 10.0.0.200 10.0.0.254;
    # specify broadcast address
    option broadcast-address 10.0.0.255;
    # specify default gateway
    option routers 10.0.0.1;
    optiondomain-name-servers 192.168.188.11, 192.168.188.12
}
[root@localhost ~]# systemctl start dhcpd 
[root@localhost ~]# systemctl enable dhcpd 
ln -s &#39;/usr/lib/systemd/system/dhcpd.service&#39; &#39;/etc/systemd/system/multi-user.target.wants/dhcpd.service&#39;
</code></pre></div></td></tr></table></div> <p><code>Dnsmasq</code> is very useful in libvirt/qemu/docker based environment. To bind 192.168.200.0/24 to interface br0(192.168.200.22-bridge2eth1):</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code>#!/bin/bash
/usr/sbin/dnsmasq --strict-order --pid-file=/var/run/libvirt/network/br0--conf-file= --except-interface lo --bind-interfaces br0 --listen-address 192.168.200.22 --dhcp-range 192.168.200.2,192.168.200.254 --dhcp-leasefile=/var/lib/libvirt/dnsmasq/br0.leases --dhcp-lease-max=253 --dhcp-no-override --dhcp-hostsfile=/var/lib/libvirt/dnsmasq/br0.hostsfile --addn-hosts=/var/lib/libvirt/dnsmasq/br0.addnhosts
</code></pre></div></td></tr></table></div> <hr> <h3 id=kvm-2015-09-18><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#kvm-2015-09-18>"《KVM私有云架构设计与实践》目录" "2015-09-18"</a></h3> <p>书籍目前已出版，购买链接在下文提供，也可直接联系作者购买，微信lofyer_org。</p> <p><a href=http://product.dangdang.com/25074443.html>当当</a> <a href="https://www.amazon.cn/%E7%A7%81%E6%9C%89%E4%BA%91%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E8%92%8B%E8%BF%AA/dp/B07143VQ2M/ref=sr_1_1?ie=UTF8&qid=1495023849&sr=8-1&keywords=kvm%E7%A7%81%E6%9C%89%E4%BA%91">亚马逊</a> <a href="https://search.jd.com/Search?keyword=kvm%E7%A7%81%E6%9C%89%E4%BA%91&enc=utf-8&wq=kvm%E7%A7%81%E6%9C%89%E4%BA%91&pvid=fab47274675745f28319953ba27d24c5">京东</a></p> <p><a href=https://blog.lofyer.org/wp-content/uploads/21495029670_.pic_.jpg><img alt src=/blog/images/21495029670_.pic_-1024x1024.jpg></a></p> <hr> <h3 id=openstack-2017-05-05><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#openstack-2017-05-05>"OpenStack自动化部署与高可用虚拟控制节点设计" "2017-05-05"</a></h3> <p>为了大家的部署方便与维护着想，我决定把这俩东西再完善一下然后再把实现源码放出来，虽不能做到产品级但是也能对付很多场景了。</p> <p>自动部署（类似mirantis但更友好） 0. livecd+独立配置分区 1. 环境配置 2. PXE安装 3. 自动化脚本</p> <p>Hosted-crotroller（控制节点虚拟化） 1. etcd 2. 健康检查与评分 3. 脑裂防护 4. 使用Paxos写事务机制，如果时间差机制不工作的话。</p> <p>下面给大家简单解释一Paxos和时间差机制的原理（解释的不够到位，有兴趣的看实现吧）：</p> <ol> <li>Paxos，原文可参考<a href=https://www.quora.com/Distributed-Systems-What-is-a-simple-explanation-of-the-Paxos-algorithm>https://www.quora.com/Distributed-Systems-What-is-a-simple-explanation-of-the-Paxos-algorithm</a></li> </ol> <p><strong>此场景实用于一写多。</strong></p> <p>两人结婚，牧师问他俩，“你们愿意吗？”，“我愿意”，“我愿意”。 那么OK，就结了。</p> <p>这时候假如有一对姐妹同时喜欢一个男的，牧师问他仨，“你们愿意吗”，“我愿意”，“我愿意”，“我愿意”。 如果这样，那么男的就能娶俩，如果任何一个没回答，那抱歉了一个都娶不成。</p> <p>在实现时，主节点问下面节点，我要给你们都写个东西，你们都准备好没？“好了”，“好了”，“好了”，“没好”。 75%（&gt;50%）（Quorum）的人都准备好了，那么我就写了，没准备好的那个我记住你了。</p> <ol> <li>Paxos时间差机制（sanlock变种） <strong>这个机制我设计成只针对这个场景的，要求时间同步至数秒级别（这要求已经极低了。。），多写一，也可以扩展。</strong></li> </ol> <p>控制节点要你们去存储上填个表格，你们现在都能写，对吧？“对”，“对”，“对”，“不能”。。 OK，不能的那个我记住你了，其他人都来写吧。</p> <p>控制节点看看表，再看看这个地方之前记的时间，嗯，过去2分钟了，写一下，我在A身上跑着； 然后A看看表，再看看这个地方之前记的时间，嗯，还没过去2分钟，不写，之前体检合格，控制节点在我身上； 然后B看看表，再看看这个地方之前记的时间，嗯，过去2分钟了，签个到留个时间，体检优秀； 然后C看看表，再看看这个地方之前记的时间，嗯，过去2分钟了，签个到留个时间，体检合格；</p> <p>然后控制节点每隔1分钟看一下，嗯，你们都很健康。 又过了3分钟，哎？那个C你没写啊，去跟D站一起。</p> <p>忽然，大家在填表的时候发现，控制节点都过了3分钟没写了，B就启动一下控制节点。 A发现自己与外界失去联系，就把自己身上都控制节点关了，等待救援。</p> <ol> <li>基于etcd的时间差机制 <strong>上述的简化版，填的表格更少，时间差一致</strong> 大家一起写etcd的那个地方。“好”，“好”，“好”。 哎？C你没写，再见。 哎？控制节点呢？来A你检查一下启一下控制节点，B现在状态不佳。 由于控制节点之前在你A上，它现在不行了，扣A个10分，现在分没B高啊。 A你清理下现场让B去启动吧。</li> </ol> <h3 id=_2><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#_2>试图设计一个任何场景都能应对的功能。</a></h3> <p>title: "Openstack 配置及其API的简单使用" date: 2013-07-18 categories: - "cloud-infra"</p> <hr> <h3 id=neutronquantum><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#neutronquantum>安装除Neutron（Quantum）以外所有东西</a></h3> <p>在开始之前，假设有三个NIC</p> <p>禁用selinux，并修改网络配置/etc/sysconfig/network-scripts/ifcfg-ethX</p> <h2 id=internal><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#internal>Internal</a></h2> <p>DEVICE=eth0 TYPE=Ethernet BOOTPROTO=static IPADDR=192.168.1.11 NETMASK=255.255.255.0 GATEWAY=192.168.1.1 DNS1=192.168.1.1 DEFROUTE=yes ONBOOT=yes</p> <h2 id=external><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#external>External</a></h2> <p>DEVICE=eth1 TYPE=Ethernet BOOTPROTO=static IPADDR=192.168.1.12 NETMASK=255.255.255.0 DEFROUTE=yes ONBOOT=yes</p> <h2 id=public-bridge><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#public-bridge>Public Bridge</a></h2> <p>DEVICE=eth2 TYPE=Ethernet BOOTPROTO=static IPADDR=192.168.1.13 NETMASK=255.255.255.0 DEFROUTE=yes ONBOOT=yes</p> <p>于Feodra18中安装Openstack，可参考文档，按照这个来的话对Openstack的设计理念将会有所了解 <a href=https://fedoraproject.org/wiki/Getting_started_with_OpenStack_on_Fedora_18 title="Getting started with OpenStack on Fedora 18">Getting started with OpenStack on Fedora 18</a> 或者运行</p> <p>/<em>安装完成后管理员界面为http://localhost/dashboard用户名admin，密码secrete</em>/</p> <h2 id=openstack-demo-install><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#openstack-demo-install>openstack-demo-install</a></h2> <p>以上两种方法把除了Neutron（quantum）其他的服务都配置好了，关于quantum的配置见文末</p> <h3 id=_3><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#_3>添加虚拟机实例</a></h3> <p>可参考文档 <a href=https://fedoraproject.org/wiki/Getting_started_with_OpenStack_on_Fedora_18 title="Getting started with OpenStack on Fedora 18">Getting started with OpenStack on Fedora 18</a> 在终端操作之前需要设置环境变量，将它们两者之一写到一个文件，然后source一下</p> <p>export OS_USERNAME=admin export OS_PASSWORD=secrete export OS_TENANT_NAME=admin export OS_AUTH_URL=http://127.0.0.1:5000/v2.0/</p> <p>export ADMIN_TOKEN=<span class=arithmatex>\((openssl rand -hex 10) export SERVICE_ENDPOINT=http://127.0.0.1:35357/v2.0/ export SERVICE_TOKEN=\)</span>ADMIN_TOKEN</p> <p>source FileA</p> <p>这个libvirt支持kvm以及xen虚拟化，所以支持的镜像也比较多，这里下载一个已经安装好的f17的qcow2镜像</p> <h2 id=axel-n-5-httpberrangefedorapeopleorgblogimages2012-11-15f17-x86_64-openstack-sdaqcow2><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#axel-n-5-httpberrangefedorapeopleorgblogimages2012-11-15f17-x86_64-openstack-sdaqcow2>axel -n 5 http://berrange.fedorapeople.org//blog/images/2012-11-15/f17-x86_64-openstack-sda.qcow2</a></h2> <p>/<em>注册镜像</em>/</p> <h2 id=glance-add-namef17-jeos-is_publictrue-disk_formatqcow2-container_formatbare-f17-x86_64-openstack-sdaqcow2><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#glance-add-namef17-jeos-is_publictrue-disk_formatqcow2-container_formatbare-f17-x86_64-openstack-sdaqcow2>glance add name=f17-jeos is_public=true disk_format=qcow2 container_format=bare &lt; f17-x86_64-openstack-sda.qcow2</a></h2> <p>然后以demo用户进入dashboard，会看到添加进来的image，根据image启动实例，打开vnc界面（非localhost访问要改ip）。</p> <h3 id=neutronquantum_1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#neutronquantum_1>安装操蛋的Neutron（quantum）服务</a></h3> <p>这东西刚改名，nova自带的有network服务，可这个可以虚拟L2 L3 switch，那就比较有意思了</p> <p>/<em>注册quantum</em>/</p> <h2 id=keystone-service-create-name-quantum-type-network-description-openstack-networking-service><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#keystone-service-create-name-quantum-type-network-description-openstack-networking-service>keystone service-create --name quantum --type network --description 'OpenStack Networking Service'</a></h2> <h2 id=keystone-endpoint-create-region-myregion-service-id-26a55b340e254ad5bb78c0b14391e153-publicurl-http1921681119696-adminurl-http1921681119696-internalurl-http1921681119696><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#keystone-endpoint-create-region-myregion-service-id-26a55b340e254ad5bb78c0b14391e153-publicurl-http1921681119696-adminurl-http1921681119696-internalurl-http1921681119696>keystone endpoint-create --region myregion --service-id 26a55b340e254ad5bb78c0b14391e153 --publicurl "http://192.168.1.11:9696/" --adminurl "http://192.168.1.11:9696/" --internalurl "http://192.168.1.11:9696/"</a></h2> <p>/<em>(可选)添加quantum服务用户</em>/ get_id.sh:</p> <p>$ function get_id () { echo <code>"$@" | awk '/ id / { print $4 }'</code> }</p> <h2 id=admin_roleget_id-keystone-role-create-nameadmin><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#admin_roleget_id-keystone-role-create-nameadmin>ADMIN_ROLE=$(get_id keystone role-create --name=admin)</a></h2> <h2 id=quantum_userget_id-keystone-user-create-namequantum-passservicepass-emaildemoexamplecom-tenant-id-service><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum_userget_id-keystone-user-create-namequantum-passservicepass-emaildemoexamplecom-tenant-id-service>QUANTUM_USER=$(get_id keystone user-create --name=quantum --pass="servicepass" --email=demo@example.com --tenant-id service)</a></h2> <h2 id=keystone-user-role-add-user_id-quantum_user-role_id-admin_role-tenant_id-service><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#keystone-user-role-add-user_id-quantum_user-role_id-admin_role-tenant_id-service>keystone user-role-add --user_id $QUANTUM_USER --role_id $ADMIN_ROLE --tenant_id service</a></h2> <p>/<em>服务插件二选一，linuxbrideg和openvswitch，这里使用后者，先安装插件</em>/</p> <h2 id=yum-install-openstack-quantum-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#yum-install-openstack-quantum-openvswitch>yum install openstack-quantum-openvswitch</a></h2> <p>/<em>启动并添加服务</em>/</p> <h2 id=quantum-server-setup-plugin-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum-server-setup-plugin-openvswitch>quantum-server-setup --plugin openvswitch</a></h2> <h2 id=quantum-node-setup-plugin-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum-node-setup-plugin-openvswitch>quantum-node-setup --plugin openvswitch</a></h2> <h2 id=service-quantum-server-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-server-start>service quantum-server start</a></h2> <h2 id=chkconfig-quantum-server-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-server-on>chkconfig quantum-server on</a></h2> <h2 id=service-openvswitch-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-openvswitch-start>service openvswitch start</a></h2> <h2 id=chkconfig-openvswitch-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-openvswitch-on>chkconfig openvswitch on</a></h2> <h2 id=ovs-vsctl-add-br-br-int><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ovs-vsctl-add-br-br-int>ovs-vsctl add-br br-int</a></h2> <h2 id=chkconfig-quantum-openvswitch-agent-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-openvswitch-agent-on>chkconfig quantum-openvswitch-agent on</a></h2> <h2 id=service-quantum-openvswitch-agent-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-openvswitch-agent-start>service quantum-openvswitch-agent start</a></h2> <h2 id=quantum-dhcp-setup-plugin-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum-dhcp-setup-plugin-openvswitch>quantum-dhcp-setup --plugin openvswitch</a></h2> <h2 id=chkconfig-quantum-dhcp-agent-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-dhcp-agent-on>chkconfig quantum-dhcp-agent on</a></h2> <h2 id=service-quantum-dhcp-agent-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-dhcp-agent-start>service quantum-dhcp-agent start</a></h2> <h2 id=ovs-vsctl-add-br-br-ex><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ovs-vsctl-add-br-br-ex>ovs-vsctl add-br br-ex</a></h2> <h2 id=ovs-vsctl-add-port-br-ex-eth1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ovs-vsctl-add-port-br-ex-eth1>ovs-vsctl add-port br-ex eth1</a></h2> <h2 id=quantum-l3-setup-plugin-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum-l3-setup-plugin-openvswitch>quantum-l3-setup --plugin openvswitch</a></h2> <h2 id=chkconfig-quantum-l3-agent-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-l3-agent-on>chkconfig quantum-l3-agent on</a></h2> <h2 id=service-quantum-l3-agent-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-l3-agent-start>service quantum-l3-agent start</a></h2> <h2 id=chkconfig-quantum-metadata-agent-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-metadata-agent-on>chkconfig quantum-metadata-agent on</a></h2> <h2 id=service-quantum-metadata-agent-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-metadata-agent-start>service quantum-metadata-agent start</a></h2> <p>修改并配置网络 /etc/sysconf/network-scripts/ifcfg-eth1，/etc/sysconf/network-scripts/ifcfg-br-ex</p> <h2 id=external_1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#external_1>External</a></h2> <p>DEVICE=eth1 TYPE=Ethernet BOOTPROTO=none NM_CONTROLLED=no BRIDGE=br-ex ONBOOT=yes</p> <h2 id=public-bridge_1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#public-bridge_1>Public Bridge</a></h2> <p>DEVICE=br-ex TYPE=Bridge BOOTPROTO=static IPADDR=192.168.2.11 NETMASK=255.255.255.0 NM_CONTROLLED=no ONBOOT=yes</p> <h2 id=ip-addr-del-1000924-dev-eth1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ip-addr-del-1000924-dev-eth1>ip addr del 10.0.0.9/24 dev eth1</a></h2> <h2 id=ip-addr-add-1000924-dev-br-ex><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ip-addr-add-1000924-dev-br-ex>ip addr add 10.0.0.9/24 dev br-ex</a></h2> <p>这里类似VPN的重写HEADER</p> <p>echo 1 &gt; /proc/sys/net/ipv4/conf/all/forwarding sysctl -w net.ipv4.ip_forward=1 iptables -A FORWARD -i eth0 -o br-ex -s 10.10.10.0/24 -m conntrack --ctstate NEW -j ACCEPT iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT iptables -A POSTROUTING -s 10.10.10.0/24 -t nat -j MASQUERADE</p> <p>最后重启机器即可</p> <h3 id=curlopenstack-api><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#curlopenstack-api>通过curl使用openstack api</a></h3> <p><a href=http://catn.com/2013/04/23/create-an-openstack-instance-with-just-curl/ title=http://catn.com/2013/04/23/create-an-openstack-instance-with-just-curl/ >参考这篇文章</a> 注意区分token和固定id</p> <h4 id=_4><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#_4>获取可用镜像</a></h4> <p>curl -s http://10.199.0.250:8774/v2/51ad87714b86442d9a74537d6f890060/images -X GET -H "X-Auth-Project-Id: admin" -H "Accept: application/json" -H "X-Auth-Token: 6083193874684f38865b086a8a5f4b7b" | python -mjson.tool</p> <h4 id=_5><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#_5>创建虚拟机</a></h4> <p>curl -i http://10.199.0.250:8774/v2/51ad87714b86442d9a74537d6f890060/servers -X POST -H "X-Auth-Project-Id: admin" -H "Content-Type: application/json" -H "Accept: application/json" -H "X-Auth-Token: 6083193874684f38865b086a8a5f4b7b" -d '{"server": {"name": "instance1", "imageRef": "992f5732-af50-40fc-987f-25951cbce943", "key_name": "damion-flybook", "flavorRef": "3", "max_count": 1, "min_count": 1}}'</p> <hr> <p>title: "A design of user frontend for kinds of Cloud with accounting." date: 2015-05-06 categories: - "cloud-infra" tags: - "Cloud Computing" - "TBD"</p> <hr> <p>I like Linode.com very much, so I'd like to make a frontend with something like that in functions.</p> <p>Here's the draft.</p> <p><a href=http://blog.lofyer.org/a-design-of-user-frontend-for-kinds-of-cloud-with-accounting/untitled-page/ ><img alt="Untitled Page" src=/blog/images/Untitled-Page-1024x650.png></a></p> <h3 id=2017><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#2017>更新一下，两年前的架构设计，终于在2017年的客户那用上了，而且上了人工干预的运行前调度器，哇哈哈。</a></h3> <p>title: "Cloud Init how to" date: 2015-03-10 categories: - "cloud-infra"</p> <hr> <p>OS: CentOS 6</p> <h2 id=yum-install-y-cloud-init><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#yum-install-y-cloud-init>yum install -y cloud-init</a></h2> <hr> <p>title: "How to solve the 'boot storm' problem: BCACHE" date: 2013-05-27 categories: - "cloud-infra" - "linux-admin"</p> <hr> <p><strong>Some solutions</strong> Way 1. Add more cpus.(ABANDONED) Way 2. Add a SSD as "boot cache" Way 3. Sort the boot process</p> <p><strong>POC:</strong> <strong>Way 2:</strong> Sometimes we need cache the boot section of the OS into a SSD, since no SSD on hand, let's try to use a block device made in /dev/shm</p> <p><strong>Way 3:</strong> Considering that the parallelization of the "boot action", we have to predict the action in the near future</p> <h3 id=experiment-using-bcache-nowor-flashcache><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#experiment-using-bcache-nowor-flashcache>Experiment: Using BCACHE now...or flashcache</a></h3> <p>title: "A light-weighted VM webadmin" date: 2013-06-18 categories: - "cloud-infra" - "linux-admin"</p> <hr> <p>The infrastructure of it: Management: Based on django, communicate with Agent Agent: A daemon, used for communicating with Management and managing the VMs</p> <h3 id=to-make-great-use-of-kvm-httpsgithubcomlofyerwebadmin><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#to-make-great-use-of-kvm-httpsgithubcomlofyerwebadmin>TO MAKE GREAT USE OF KVM. <a href=https://github.com/lofyer/webadmin>https://github.com/lofyer/webadmin</a></a></h3> <p>title: "MyIDC--Everything's traceable" date: 2013-12-11 categories: - "cloud-infra"</p> <hr> <p>相关手册参考<a href="https://cloud.lofyer.org/public.php?service=files&t=ad02817153cc4e4602921447eb49d10a" title=MyIDC_Book>MyIDC_Book</a></p> <p>细节索引： gluster hadoop(with ARM as an option) drbd/heartbeat foreman/puppet nagios ovirt openstack owncloud asterisk</p> <p>配置细节参考： <a href=https://github.com/lofyer/myidc-main title="MyIDC Source">MyIDC Source</a></p> <p><strong>Infrastructure:</strong></p> <p>Board： x86小板 SBSA小板 Cabinet： 亚克力自制 网络： 电信拨号接入外网 SDN 资源分配： 高可用监视与控制服务（os1-2） 高可用存储(os3-n) 并行计算（os3-n） 高可用虚拟机服务（os1/2+os3-n） 独立外设接入设备 安全： 证书认证（在量子计算机面向大众之前这个还是很靠谱的） 应用商店： 社会工程学测试 leapmotion控制插件 语音控制插件 手机控制插件</p> <hr> <p>title: "openvswitch howto" date: 2013-07-25 categories: - "linux-admin"</p> <hr> <p>Here, I use kernel-3.4.58.</p> <h2 id=emerge-net-miscopenvswitch-1110><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#emerge-net-miscopenvswitch-1110>emerge =net-misc/openvswitch-1.11.0</a></h2> <hr> <p>title: "硬盘、RAID组与Ceph分布式存储IOPS计算公式" date: 2017-06-04 categories: - "linux-admin" tags: - "Storage" - "Performance"</p> <hr> <p><strong>防怼说明：本文用于速算，想把难以量化的环境变量以及各种组合拿来说事儿的请自行Google，或者问厂商和IDC要报告去。</strong></p> <p><strong>机械硬盘</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code>7200硬盘IOPS = 1000/(3 + 1000*(7200/60)/2) = 140
10k硬盘IOPS = 1000/(3 + 60000/10000/2) = 167
15k硬盘IOPS = 1000/(3 + 60000/15000/2) = 200
</code></pre></div></td></tr></table></div> <p>其中3为寻道延迟，7200/10k/15k为转速（rpm），1000*(7200/60)/2为旋转延迟（旋转延迟一般用转一圈所需时间的1/2表示），结果为理论峰值，实际还会有系统延迟导致测得IOPS一般低于此值。</p> <p><strong>RAID组</strong> 由于RAID组需要校验以提供恢复功能，所以会存在一定写惩罚，这个系数如下： RAID0: 1 RAID1: 2 RAID5: 4 RAID6: 6 RAID1-0: 2</p> <p>所以RAID组IOPS = 硬盘写IOPS<em>硬盘数量</em>写操作百分比/写惩罚系数 + 硬盘读IOPS<em>硬盘数量</em>读操作百分比。</p> <p>以4块IOPS为180的SAS硬盘组RAID 6然后百分百随机写操作为例：</p> <p>IOPS = 180*4/6 = 120</p> <p><strong>Ceph的IOPS经验公式</strong> 由于Ceph存储结构不同于物理硬件，所以影响其IOPS的因素主要有网络、副本数量、日志、OSD（硬盘）数量、OSD服务器数量、OSD IOPS等，这里给出一个来自Mirantis的经验公式：</p> <p>IOPS = 硬盘IOPS * 硬盘数量 * 0.88 / 副本数量， 其中0.88为4-8k随机读操作占比（88%）。</p> <p>关于Ceph的IOPS计算仅供参考，计算结果可能会跟物理环境实测有较大偏差。</p> </div> </article> <nav class=md-pagination> <span class=md-pagination__current>1</span> <a href=page/2/ class=md-pagination__link>2</a> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2022 lofyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.ad660dcc.min.js></script> <script src=../../../javascripts/config.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>