<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=lofyer><link href=https://docs.lofyer.org/blog/category/devices/ rel=canonical><link href=../collect/ rel=prev><link href=../diary/ rel=next><link rel=icon href=../../../images/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.34"><title>devices - Lofyer's Blog</title><link rel=stylesheet href=../../../assets/stylesheets/main.35f28582.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#devices class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title="Lofyer's Blog" class="md-header__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lofyer's Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> devices </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Index </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a href=../../../datanote/ class=md-tabs__link> Docs </a> </li> <li class=md-tabs__item> <a href=../../../about/about/ class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../template_password/ class=md-tabs__link> [密码保护]Template </a> </li> <li class=md-tabs__item> <a href=../../../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Lofyer's Blog" class="md-nav__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Lofyer's Blog </label> <div class=md-nav__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ class=md-nav__link> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../archive/2022/ class=md-nav__link> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 分类 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lab/ class=md-nav__link> <span class=md-ellipsis> Lab </span> </a> </li> <li class=md-nav__item> <a href=../abm/ class=md-nav__link> <span class=md-ellipsis> abm </span> </a> </li> <li class=md-nav__item> <a href=../ai/ class=md-nav__link> <span class=md-ellipsis> ai </span> </a> </li> <li class=md-nav__item> <a href=../cloud-infra/ class=md-nav__link> <span class=md-ellipsis> cloud-infra </span> </a> </li> <li class=md-nav__item> <a href=../collect/ class=md-nav__link> <span class=md-ellipsis> collect </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> devices </span> </a> </li> <li class=md-nav__item> <a href=../diary/ class=md-nav__link> <span class=md-ellipsis> diary </span> </a> </li> <li class=md-nav__item> <a href=../draft/ class=md-nav__link> <span class=md-ellipsis> draft </span> </a> </li> <li class=md-nav__item> <a href=../filecoin/ class=md-nav__link> <span class=md-ellipsis> filecoin </span> </a> </li> <li class=md-nav__item> <a href=../followmyheart/ class=md-nav__link> <span class=md-ellipsis> followmyheart </span> </a> </li> <li class=md-nav__item> <a href=../fpga/ class=md-nav__link> <span class=md-ellipsis> fpga </span> </a> </li> <li class=md-nav__item> <a href=../hpc/ class=md-nav__link> <span class=md-ellipsis> hpc </span> </a> </li> <li class=md-nav__item> <a href=../inthecloud/ class=md-nav__link> <span class=md-ellipsis> inthecloud </span> </a> </li> <li class=md-nav__item> <a href=../linux-admin/ class=md-nav__link> <span class=md-ellipsis> linux-admin </span> </a> </li> <li class=md-nav__item> <a href=../modeling/ class=md-nav__link> <span class=md-ellipsis> modeling </span> </a> </li> <li class=md-nav__item> <a href=../my-books/ class=md-nav__link> <span class=md-ellipsis> my-books </span> </a> </li> <li class=md-nav__item> <a href=../mylife/ class=md-nav__link> <span class=md-ellipsis> mylife </span> </a> </li> <li class=md-nav__item> <a href=../new-world/ class=md-nav__link> <span class=md-ellipsis> new-world </span> </a> </li> <li class=md-nav__item> <a href=../others/ class=md-nav__link> <span class=md-ellipsis> others </span> </a> </li> <li class=md-nav__item> <a href=../ovs/ class=md-nav__link> <span class=md-ellipsis> ovs </span> </a> </li> <li class=md-nav__item> <a href=../tech/ class=md-nav__link> <span class=md-ellipsis> tech </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../datanote/ class=md-nav__link> <span class=md-ellipsis> Docs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../../about/about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../../../template_password/ class=md-nav__link> <span class=md-ellipsis> [密码保护]Template </span> </a> </li> <li class=md-nav__item> <a href=../../../tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=devices>devices</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2021-02-25 00:00:00">2021年2月25日</time></li> <li class=md-meta__item> 分类于 <a href=../cloud-infra/ class=md-meta__link>cloud-infra</a>, <a href=./ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 3 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/ class=toclink>裸金属笔记</a></h2> <p>裸金属相关，简单点就是尽量不用计算虚拟化。</p> <hr> <h3 id=nitro-smartnicfpgaarm-based-bare-metal-hypervisor2021-02-25><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#nitro-smartnicfpgaarm-based-bare-metal-hypervisor2021-02-25>动手做自己的Nitro SmartNIC(FPGA/ARM-based Bare Metal Hypervisor(2021-02-25)</a></h3> <h4 id=0-background><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#0-background>0. BackGround</a></h4> <p>裸金属服务很酷，甲方都想要，但是最好不要有绑定。BlueField 1/2、AWS Nitro、Aliyun X-Dragon MOC之类的智能网卡也不错，虽然ZStack已经纯软件实现了类似功能，但是这篇文章仍然会探索一个如何低成本（不到100块）的“智能网卡”方案（要不然前期的调研都白瞎了）。</p> <p><strong>做弹性裸金属并不难，但是要高性能的同时又要安全，而且在私有云、产品化的语境下，我们就需要好好思考一番了。</strong></p> <h4 id=1><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#1>1. 功能定义</a></h4> <h5 id=11><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#11>1.1. 带外管理</a></h5> <p>带外管理也不是个问题，如果:</p> <ol> <li>服务器自带BMC。</li> <li>你有能力让服务器厂商给你定制，因为你需要定制BIOS部分功能以让其在启动时认到智能网卡提供的虚拟设备。</li> <li>自己做OpenBMC。</li> </ol> <p>但是，由于多数用户没有让服务器厂商高度定制服务器的能力，因而我们需要在“无米”的状态下做“炊”。</p> <h6 id=111><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#111>1.1.1. 电源管理</a></h6> <p>通过“智能网卡”我们至少要能实现主机的开关机，这个相对来说还比较容易实现，无论何种主板，电源控制接口现在服务器上都有，若干个高/低电平就可以控制。</p> <p>但是考虑到集群断电的情况，“智能网卡”要优先启动才能进一步控制它管理的物理机，所以这个设备我们一定要轻、快、稳。</p> <p>如果使用服务器内PCIE供电，那么我们又要修改BIOS来保证智能网卡优先启动，但是这个。。。成本不止100块了。</p> <p>所以考虑使用独立供电的嵌入式设备，无论使用插到服务器PCIE插槽上的ARM/FPGA/X86 SoC还是树莓派，我们都要给它独立供电。</p> <h6 id=112><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#112>1.1.2. 与主机通信</a></h6> <p>这里的通信仅仅涉及控制面的内容，数据面（网络、存储）不涉及。</p> <p>我们尊重传统，仅考虑两种情况，即与主机OS通信和与主机设备通信。</p> <p>前者一个agent走TCP/IP就能搞定，后者我们需要与主板的I3CI2C/SPI接口通信。</p> <h5 id=12><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#12>1.2. 设备模拟/透传</a></h5> <p><em>存储</em></p> <p>存储侧我们目前可以直接提供的baremetal设备有 SCSI（iSCSI）、NVMe（oF）、VirtIO等。</p> <p>由于产品化必须考虑到适配各种硬件的问题，所以我们不会定制修改BIOS，这里只要一个小小的trick即可让服务器从智能网卡提供的vda或者其他接口的“虚拟”硬盘启动，从而保证云平台存储资源可以以较高性能提供给baremetal。</p> <details> <summary>Option Rom</summary> <p>Option Rom 也是智能网卡带的选项了，启动后可以直接认到virtio/nvme的虚拟硬盘。</p> </details> <p><em>网络</em></p> <p>网络多数情况下是问题但又不是问题，我们选择智能网卡的原因是因为它可以解决大多数问题。虚拟网络资源直接给物理机的目的可以很容易地通过SDN交换机实现，但是我们既然用了一个智能网卡设备那么就应该通过它来回避各种外部环境仍然需要定制的问题。以BF2为例，它内部集成的ovs-dpdk以及Mellanox传统的内部虚拟交换技术加持，我们可以给baremetal一个“虚拟”接口，但是所有流量都在云平台的管控下，用户极难自行修改。</p> <p>如果不选择智能网卡，那么只有SDN交换机和系统内SDN两种方案，SDN交换机甚至比智能网卡的适配都简单，技术不是难点，同智能网卡一样你很难说服客户的采购来一套裸金属专用的SDN交换机，更不要说这个交换机不在他们的网工管辖范围内了。</p> <p>那么只剩系统内的overlay网络接入方案了，Linux一直不是问题，Windows系统需要agent做一些小工作才可以，即使用户自己改了，我们也可以“内挂”anti-spoofing。</p> <h5 id=13-hypervisor><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#13-hypervisor>1.3. Hypervisor模拟</a></h5> <p>“智能网卡”中要模拟hypervisor，这里的模拟是为了让多数云平台的agent比如libvirt或者基于libvirt的定制agent能够对弹性裸金属设备的调用行为与虚拟机保持一致。为什么要做这个工作呢，我单独的控制面不行吗？</p> <p>也行，但是不酷，更何况你后续的存储与网络设备不仅给裸金属也要给虚拟机，两套API两套数据库管理同一个网络/存储就是在给云平台的管控面开发找事儿。</p> <p>所以这个我们一般要对agent（libvirt）做一些修改，这个难度相比下来不大。</p> <h4 id=21-proof-of-concept><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#21-proof-of-concept>2.1. Proof of Concept</a></h4> <h5 id=21-arm-or-x86><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#21-arm-or-x86>2.1. ARM or X86作为智能网卡</a></h5> <p>如果使用ARM或者X86主机作为“智能网卡”，那么存储方案有iSCSI和NVMe-over-TCP，网络方案目前看只有系统内SDN的方法了，好处在于“智能网卡”的门槛低。</p> <p>我们先做一个OpenBMC的原型机，准备如下材料:</p> <p>笔记本; 树莓派/NVIDIA Jeston; 视频采集卡; 杜邦线; 网线； rtl-sdr（谁能拒绝一个可以听广播看电视的裸金属呢）；</p> <p>当然，一台服务器也是必要的。。。不会吧，你家里连台服务器都没有？你还做锤子钢铁侠哦？赶紧上咸鱼500块买个二手服务器吧，不想做钢铁侠了还可以卖掉。</p> <p>算了，毕竟太吵，一个ATX或者其他类型主板的台式机就可以了。</p> <p><img alt src=/blog/images/WechatIMG2-1024x768.jpeg></p> <p>TBD</p> <h5 id=22-fpga-arm-soc1000><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#22-fpga-arm-soc1000>2.2. FPGA ARM SoC作为智能网卡（有点小贵，1000多块，但是来都来了）</a></h5> <p>1000多一块的有PCI-E插槽的Xilinx ARM SoC开发版，贵，但是你可以基于PCI/PCI-E接口实现独立的网络、存储，非常有意思，但是难度在于FPGA编程。</p> <p>不过还好，我们先尝试用Pynq写一些简单的PCI/PCI-E通信，然后再堆上复杂的，但是中间会有很多IP我们要购买，没钱怎么整，社区找现成的，low点，能用。</p> <p>因为我们的目标是要基于这个FPGA实现存储和网络设备的接入，那么总归是一个大点的工程，如果做的先进点实现virtio网络/存储的接入，那对于提供虚拟化的云平台将善莫大焉。</p> <hr> <h3 id=windowsoverlay-2020-05-21><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#windowsoverlay-2020-05-21>"Windows中使用overlay网络的一些方案" "2020-05-21"</a></h3> <h4 id=_2><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#_2>引言</a></h4> <p>21世纪了，智能网卡还是贵，交换机客户没法直接买，软件技术栈都好找，性能再加强，ebpf不错，要是Windows的Linux子系统里支持这个那软裸金属方案至此可以画上一个句（分）号了。</p> <p>关于如何在Windows裸金属中给用户交付流畅且易配置的云平台overlay网络，从而跟虚拟化打通，也是个最近要考虑的点。</p> <h4 id=sdn><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#sdn>SDN交换机与智能网卡</a></h4> <p>我们可以用国内品牌，他们也提供ovs接口，but，对于小体量的客户或者采购严格的客户就很难，仅适合自有IDC且有决心的客户。</p> <p>为了使用一个功能，软件绑定就算了，硬件你还要我买你的，固定资产无法二次利用，别想了。</p> <h4 id=grevxlanwindows><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#grevxlanwindows>GRE/VXLAN(Windows)</a></h4> <p>Windows从08/12后自带了NVGRE，VXLAN的话是从16开始支持，听起来也不错，所以这个对于新晋用户是<strong>可以接受的</strong>。</p> <h4 id=ovs><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#ovs>OVS</a></h4> <p>Windows下有ovs，但是仅支持2012后的，这样就没法解决Windows2008的问题（再过几年就不用操心这个问题了），当然主要的问题还是没有官方背书。</p> <hr> <h3 id=xilinxintel-fpga-2019-04-29><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#xilinxintel-fpga-2019-04-29>"使用Xilinx/Intel FPGA加速虚拟化" "2019-04-29"</a></h3> <p>UPDATE: <a href=http://tech.mytrix.me/2019/05/devconf-19-virtio-%E7%A1%AC%E4%BB%B6%E5%8A%A0%E9%80%9F/ >老王的笔记</a>中也总结了一些关于devconf的内容。</p> <p>This article is just a collection of ideas and posts.</p> <p>Recently I was doing some performance-tunning of QEMU/KVM with kinds of pure-software ways. However, it ended with the existence of QEMU/KVM's process load.</p> <p>I just remembered that I used to do some co-sim work with National Instruments LabView about ten years ago...(during college life...fk...I'm still young...)</p> <h4 id=trial-no1><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no1>Trial No.1</a></h4> <p>TBD: Start QEMU instance(s) with passthrough-ed PCI(PCI-SRIOV) devices like ethernet controller or NVMe controller designed in PCI FPGA to offload the emulated works.</p> <h4 id=trial-no2><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no2>Trial No.2</a></h4> <p>TBD: Start QEMU instance with devices ported to passthrough-ed PCI FPGA as many as possible, i.e. usb controller, ethernet controller and etc..(Like a dock with kinds of devices...)</p> <p>But I think it will be replaced by Trial No.1.</p> <h4 id=trial-no3><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no3>Trial No.3</a></h4> <p>TBD: Co-Sim.</p> <h4 id=trial-no4><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no4>Trial No.4</a></h4> <p>SoC FPGA, as DOM0.</p> <h4 id=trial-no5><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#trial-no5>Trial No.5</a></h4> <p>ASIC offload with slight host management.</p> <h4 id=references><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#references>References</a></h4> <p>[1] Running Xilinx in QEMU, <a href=https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842060/QEMU>https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842060/QEMU</a></p> <p>[2] Building Xen Hypervisor with Petalinux 2019.1, <a href=https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/99188792/Building+Xen+Hypervisor+with+Petalinux+2019.1>https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/99188792/Building+Xen+Hypervisor+with+Petalinux+2019.1</a></p> <p>[3] QEMU SystemC and TLM CoSimulation, <a href=https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842109/QEMU+SystemC+and+TLM+CoSimulation>https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842109/QEMU+SystemC+and+TLM+CoSimulation</a></p> <hr> <h3 id=windowsebpf-2022-02-10><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#windowsebpf-2022-02-10>"Windows中使用eBPF" "2022-02-10"</a></h3> <h4 id=_3><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#_3>背景</a></h4> <p>也挺有意思的，前年念叨着<a href=https://blog.lofyer.org/sdn-windows-linux-baremetal/ >Windows内的SDN方案咋做</a>，去年微软终于就搞了个<a href=https://github.com/Microsoft/ebpf-for-windows>eBPF for Windows</a>，如此以来结合Windows新版本自带的NVGRE/VxLAN网络，安全组、EIP、LB啥的在纯软裸金属里都好说了。</p> <p>另外，迫于适配智能与半智能网卡的压力，ZStack已经提供了ovs与linux bridge两个技术栈的网络（新建集群的时候可以选，虽然不是第一个但早些时候收到的需求确实不硬开发也忙。。），所以现在看起来一切都很合理。</p> <p>当然，产品的东西跟新技术并不是什么强绑定关系，技术只是锦上添花实现产品的工具，稳定优先。</p> <h4 id=_4><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#_4>测试</a></h4> <h3 id=ebpf-for-windows><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#ebpf-for-windows>编译eBPF for Windows</a></h3> <h3 id=_5><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#_5>测试程序</a></h3> <h3 id=vxlannvgre><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#vxlannvgre>VxLAN/NVGRE集成</a></h3> <hr> <p>title: "Xilinx FPGA中应用P4网络数据面编程" date: 2019-07-11 categories: - "cloud-infra" - "devices"</p> <hr> <h2 id=0-background_1><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#0-background_1>0. Background</a></h2> <p>As we all know, P4 is about to be the future of OpenFlow 2.0, and to achieve an totally software defined network with programmable control plane and data plane.</p> <h2 id=1-basic-knowledge><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#1-basic-knowledge>1. Basic Knowledge</a></h2> <p>Since we've got P4 working on X86 server</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/WechatIMG1.jpeg><img alt src=/blog/images/WechatIMG1-768x1024.jpeg></a></p> <p>In SDN controller ONOS.</p> <h2 id=2-softwarehardware-plant><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#2-softwarehardware-plant>2. Software/Hardware Plant</a></h2> <h3 id=21-pureway-p4-bitstream><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#21-pureway-p4-bitstream>2.1. Pureway: P4 bitstream</a></h3> <h3 id=22-easyway-p4-on-petalinux><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#22-easyway-p4-on-petalinux>2.2. Easyway: P4 on PetaLinux</a></h3> <h2 id=3-further-exploration><a class=toclink href=../../2021/02/25/%E8%A3%B8%E9%87%91%E5%B1%9E%E7%AC%94%E8%AE%B0/#3-further-exploration>3. Further Exploration</a></h2> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-05-10 00:00:00">2019年5月10日</time></li> <li class=md-meta__item> 分类于 <a href=../cloud-infra/ class=md-meta__link>cloud-infra</a>, <a href=./ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 4 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=sdr><a href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/ class=toclink>软件定义无线电（SDR）的设备、软件与应用指南</a></h2> <p><a href=https://blog.lofyer.org/wp-content/uploads/www.youtube.com_watch_v-mks0TAwqQUlistPLbBQHMnVMR41tOomyB0o7UKAxwKINkFFnindex4.png><img alt src=/blog/images/www.youtube.com_watch_v-mks0TAwqQUlistPLbBQHMnVMR41tOomyB0o7UKAxwKINkFFnindex4.png></a></p> <p><strong>注意：本文内容仅限于实验室安全测试目的，禁止用于任何商业或违反当地法律法规的活动。</strong></p> <p><strong>不管是较贵的Ettus还是入门的HackRF，抑或是最初级的RTL-SDR设备，都可以使用这篇教程中的绝大部分内容。</strong></p> <p><a href="https://www.youtube.com/watch?v=Wt_c_H6HQAU&list=PLbBQHMnVMR41tOomyB0o7UKAxwKINkFFn">GRCon2019</a></p> <p>https://www.gnuradio.org/grcon/grcon17/presentations/</p> <p>https://www.gnuradio.org/grcon/grcon18/presentations/</p> <p>https://www.gnuradio.org/grcon/grcon19/presentations/</p> <p>https://github.com/mossmann/hackrf/wiki</p> <p>https://www.hackrf.net/hackrf%E4%B8%8Egnuradio%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/</p> <p>http://www.hackrf.net/faq/</p> <p>https://wiki.myriadrf.org/LimeSDR</p> <p>https://myriadrf.org/news/limesdr-made-simple-part-1/</p> <p><a href=https://blog.lofyer.org/software-defined-radio-device-software-application-guide/ >雪碧0xroot的PPT</a></p> <h2 id=0><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#0>0. 环境准备</a></h2> <h3 id=01><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#01>0.1 硬件</a></h3> <table> <thead> <tr> <th></th> <th>HackRF One</th> <th>Ettus B200</th> <th>Ettus B210</th> <th>BladeRF x40</th> <th>LimeSDR</th> <th>LimeSDR mini</th> </tr> </thead> <tbody> <tr> <td>Frequency Range</td> <td>1MHz-6GHz</td> <td>70MHz-6GHz</td> <td>70MHz-6GHz</td> <td>300MHz-3.8GHz</td> <td>100kHz-3.8GHz</td> <td>100kHz-3.5GHz</td> </tr> <tr> <td>RF Bandwidth</td> <td>20MHz</td> <td>61.44MHz</td> <td>61.44MHz</td> <td>40MHz</td> <td>61.44MHz</td> <td>30.72MHz</td> </tr> <tr> <td>Sample Depth</td> <td>8 bits</td> <td>12 bits</td> <td>12 bits</td> <td>12 bits</td> <td>12 bits</td> <td>12 bits</td> </tr> <tr> <td>Sample Rate</td> <td>20MSPS</td> <td>61.44MSPS</td> <td>61.44MSPS</td> <td>40MSPS</td> <td>3.2MSPS</td> <td>61.44MSPS</td> </tr> <tr> <td>Transmitter Channels</td> <td>1</td> <td>1</td> <td>2</td> <td>1</td> <td>2</td> <td>1</td> </tr> <tr> <td>Receivers</td> <td>1</td> <td>1</td> <td>2</td> <td>1</td> <td>2</td> <td>1</td> </tr> <tr> <td>Duplex</td> <td>Half</td> <td>Full</td> <td>Full</td> <td>Full</td> <td>Full</td> <td>Full</td> </tr> <tr> <td>Interface</td> <td>USB 2.0</td> <td>USB 3.0</td> <td>USB 3.0</td> <td>USB 3.0</td> <td>USB 3.0</td> <td>USB 3.0</td> </tr> <tr> <td>Programmable Logic Gates</td> <td>64 macrocell CPLD</td> <td>75k</td> <td>100k</td> <td>40k (115k avail)</td> <td>40k</td> <td>40k</td> </tr> <tr> <td>Chipset</td> <td>MAX5864, MAX2837, RFFC5072</td> <td>AD9364</td> <td>AD9361</td> <td>LMS6002M</td> <td>LMS7002M</td> <td>LMS7002M</td> </tr> <tr> <td>Open Source</td> <td>Full</td> <td>Schematic, Firmware</td> <td>Schematic, Firmware</td> <td>Schematic, Firmware</td> <td>Full</td> <td>Full</td> </tr> <tr> <td>Oscillator Precision</td> <td>+/-20ppm</td> <td>+/-2ppm</td> <td>+/-2ppm</td> <td>+/-1ppm</td> <td> +/-1ppm initial</td> <td></td> </tr> <tr> <td>+/-4ppm stable</td> <td> +/-1ppm initial</td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </tbody> </table> <p>+/-4ppm stable | | Transmit Power | -10dBm+ (15dBm @ 2.4GHz) | 10dBm+ | 10dBm+ | 6dBm |  0 to 10dBm | 0 to 10dBm | | Price | 249€ euros VAT Exc. | 991€ euros VAT Exc. | 1658€ euros VAT Exc. | 625€ euros VAT Exc. | 332€ euros VAT Exc. | 190€ euros VAT Exc. |</p> <h3 id=02><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#02>0.2 驱动</a></h3> <h3 id=03><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#03>0.3 软件</a></h3> <p>https://unicorn.360.com/blog/2017/04/12/LimeSDR-Getting-Started-Quickly/</p> <p>https://oneguyoneblog.com/2016/09/15/sdrsharp-sdr-installing-windows-10/</p> <p>下载SDR#后，重启按F7进入“禁用驱动签名”的运行模式，运行其中的install-rtlsdr.bat，替换第0个驱动</p> <h2 id=1><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#1>1. 接收信号</a></h2> <p>接收信号建议使用gqrx（MacOS、Linux），也可以用sdrsharp（Windows）。</p> <p>https://www.rtl-sdr.com/big-list-rtl-sdr-supported-software/</p> <p>$ port info gqrx</p> <p>$ sudo port install gqrx</p> <p>接收信号以后，你可以做的内容就比较多了，这里我会举一些比较有意思的例子。</p> <h3 id=11><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#11>1.1. 听广播/看电视</a></h3> <p>http://dalvikplanet.blogspot.com/2017/03/how-to-get-working-rtl2832u-r820t2-on.html</p> <h3 id=12><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#12>1.2. 接收气象云图</a></h3> <p>SDR软件</p> <p>虚拟声卡</p> <p>WXtoimg</p> <p>gpredict/orbitron</p> <p>https://www.rtl-sdr.com/rtl-sdr-tutorial-receiving-noaa-weather-satellite-/blog/images/</p> <p>https://wischu.com/archives/528.html</p> <p>GSM嗅探</p> <p>https://www.cnblogs.com/k1two2/p/7000942.html</p> <h3 id=13-gps><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#13-gps>1.3. 接收GPS信息</a></h3> <p>https://swling.com/blog/2016/04/guest-post-using-the-hackrf-one-for-dgps-beacon-reception/</p> <p>http://sdrgps.blogspot.com/2016/12/rtl-sdr-to-orbit-with-limesdr.html</p> <h3 id=14-direction-finding-and-passive-rador><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#14-direction-finding-and-passive-rador>1.4. 方向探测与被动雷达 Direction Finding and Passive Rador</a></h3> <p>https://www.rtl-sdr.com/ksdr/</p> <h3 id=15-whatever-you-want-legally><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#15-whatever-you-want-legally>1.5. 接收whatever you want LEGALLY</a></h3> <p>zigbee https://github.com/bastibl/gr-ieee802-15-4</p> <p>https://github.com/BastilleResearch/scapy-radio/tree/master/gnuradio/gr-zigbee</p> <h2 id=2><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#2>2. 发送信号</a></h2> <h3 id=21-gps><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#21-gps>2.1. 发送GPS信号</a></h3> <p>https://gist.github.com/gyaresu/343ae51ecbb70486e270</p> <p>https://www.cnblogs.com/k1two2/p/5477291.html#4245780</p> <p>https://gorgias.me/2017/07/30/HackRF-GPS-%E6%AC%BA%E9%AA%97/</p> <p>https://github.com/osqzss/LimeGPS</p> <h3 id=22><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#22>2.2. 发送文字/音视频</a></h3> <p>Windows软件sdrangel</p> <p>http://gareth.codes/hackrf-transmit/</p> <p>https://github.com/fsphil/hacktv</p> <p>http://www.irrational.net/2014/03/02/digital-atv/</p> <p>http://www.hackrf.net/2014/06/hackrf_nbfm_tx_n_ctcss_squelch/</p> <p>http://www.xn--hrdin-gra.se/blog/wp-content/uploads/2015/08/nbfm-tx.grc</p> <p>https://gist.github.com/gyaresu/343ae51ecbb70486e270</p> <p>https://nuclearrambo.com/wordpress/transferring-a-text-file-over-the-air-with-limesdr-mini/</p> <p>https://github.com/martinmarinov/TempestSDR</p> <h2 id=3><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#3>3. 收发信号</a></h2> <h3 id=gsm><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#gsm>GSM</a></h3> <p>https://www.evilsocket.net/2016/03/31/how-to-build-your-own-rogue-gsm-bts-for-fun-and-profit/</p> <p>https://yatebts.com/open_source/</p> <p>https://cn0xroot.com/2017/01/10/iot-mode-fuzzing-with-openbt/</p> <h3 id=lte><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#lte>LTE</a></h3> <p>https://yq.aliyun.com/articles/310348</p> <p>https://www.cnblogs.com/k1two2/p/5666667.html</p> <p>https://cn0xroot.com/2017/04/12/limesdr-getting-started-quickly/</p> <h3 id=openbtslimesdr><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#openbtslimesdr>OpenBTS+LimeSDR</a></h3> <p>Prepare:</p> <p>Ubuntu Desktop 16.04 &amp; LimeSDR 1.4s with <strong>LimeSuite 17.12(If not, OpenUSRP will fail.)</strong></p> <h4 id=install-build-essential-packages><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-build-essential-packages>Install build-essential packages</a></h4> <h2 id=packages-for-soapysdr-available-at-myriadrf-ppa><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#packages-for-soapysdr-available-at-myriadrf-ppa>packages for soapysdr available at myriadrf PPA</a></h2> <p>sudo add-apt-repository -y ppa:myriadrf/drivers sudo apt-get update</p> <h2 id=install-core-library-and-build-dependencies><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-core-library-and-build-dependencies>install core library and build dependencies</a></h2> <p>sudo apt-get install -y git g++ cmake libsqlite3-dev</p> <h2 id=install-hardware-support-dependencies><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-hardware-support-dependencies>install hardware support dependencies</a></h2> <p>sudo apt-get install -y libsoapysdr-dev libi2c-dev libusb-1.0-0-dev</p> <h2 id=install-graphics-dependencies><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-graphics-dependencies>install graphics dependencies</a></h2> <p>sudo apt-get install -y libwxgtk3.0-dev freeglut3-dev</p> <h2 id=install-for-building-uhd><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-for-building-uhd>Install for building uhd</a></h2> <p>sudo apt-get install libboost-all-dev libusb-1.0-0-dev python-mako doxygen python-docutils cmake build-essential</p> <h4 id=change-to-uhd-driver-via-uhd><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#change-to-uhd-driver-via-uhd>Change to UHD driver via uhd</a></h4> <p>$ cd ~ # build and install limesuite $ git clone https://github.com/myriadrf/LimeSuite.git $ cd LimeSuite $ mkdir builddir &amp;&amp; cd builddir $ cmake ../ $ make -j4 $ sudo make install $ sudo ldconfig</p> <p>$ cd ~ # build uhd, install, enable lime, rebuild $ git clone https://github.com/EttusResearch/uhd.git $ cd uhd/host/ $ mkdir build &amp;&amp; cd build $ cmake ../ $ make -j4 $ sudo make install $ git clone https://github.com/jocover/OpenUSRP.git lib/ursp/OpenUSRP # DO NOT GO OUT $ echo "INCLUDE_SUBDIRECTORY(OpenUSRP)"&gt;&gt;lib/ursp/CMakeLists.txt $ cmake ../ $ make -j4 $ sudo make install</p> <h4 id=or-change-to-uhd-driver-via-soapysdr><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#or-change-to-uhd-driver-via-soapysdr>Or, Change to UHD driver via SoapySDR</a></h4> <p>$ git clone https://github.com/pothosware/SoapySDR $ cd SoapySDR $ mkdir builddir;cd builddir; cmake ../ $ make -j4 $ sudo make install</p> <p>$ git clone https://github.com/myriadrf/LimeSuite $ cd LimeSuite</p> <h4 id=build-openbts><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#build-openbts>Build OpenBTS</a></h4> <h2 id=4-sdr><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#4-sdr>4. SDR</a></h2> <p>软件定义无线电的内容即是可以灵活定义信号的处理过程，比如输出到TCP/UDP、文字音视频解码等。其中比较有名的有GNURadio、SoapySDR、Pothos（IDE）等（这里以GNURadio为例）。推荐在Linux中安装，当然也可在MacOS或者Windows中使用MacPorts进行安装，除此之外，也有<a href=https://mirrors.tuna.tsinghua.edu.cn/help/pybombs/ >PyBombs</a>可选。</p> <p>在MacOS中安装需要使用MacPorts、XQuartz，MacPorts安装内容如下。</p> <p>$ port info gnuradio $ sudo port install gnuradio+wxgui gr-osmosdr sox $ port content gnuradio $ sudo port install hackrf $ sudo port install rtl-sdr $ sudo port search gr- # if you wanna more modules in gnuradio, don't be shy</p> <p>然后打开XQuartz，将/opt/local/bin/gnuradio-companion加入到X自定义应用程序菜单中（建议修改默认的X终端程序内容为_xterm -e "source ~/.bash_profile;/bin/bash"_）。</p> <p>https://greatscottgadgets.com/sdr/</p> <p>https://gist.github.com/machinaut/addf3438ef0c1a9cad38</p> <p>https://osmocom.org/projects/gr-osmosdr/wiki/GrOsmoSDR#RTL-SDRSource</p> <p>https://pypi.org/project/pyrtlsdr/#description</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-04-08 00:00:00">2019年4月8日</time></li> <li class=md-meta__item> 分类于 <a href=../ai/ class=md-meta__link>ai</a>, <a href=./ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 7 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=nvidia-jetson><a href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/ class=toclink>NVIDIA Jetson使用指导</a></h2> <p>本文将以NVIDIA Jetson为硬件基础，为你展现NVIDIA的力量，可以将其作为Jetson Nano的入门参考手册（教程）。</p> <h3 id=1><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#1>1. 入门篇</a></h3> <p>入门篇的有两章内容，来自NVIDIA JETSON包装盒自带的内容。</p> <h4 id=11><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#11>1.1. 准备环境</a></h4> <p>Ref.1: <a href=https://developer.nvidia.com/embedded/learn/get-started-jetson-nano-devkit>https://developer.nvidia.com/embedded/learn/get-started-jetson-nano-devkit</a></p> <p>Ref.2: <a href=https://developer.nvidia.com/embedded/downloads>https://developer.nvidia.com/embedded/downloads</a></p> <p>这里我使用的是一个Jetson Nano开发板，起初我以为随便一个USB数据线就能把它跑起来，但是我想多了。18W的快充头插上后可以正常启动，但是一旦运行比如WebGL测试的页面直接就关机了，因而我把小米音箱的电源适配器（5V2A）给它用了，还真能跑的动。</p> <p>但是为了接下来的内容，我特意买了一个5V4A的5.5mm OD的电源适配器，要不然以我现在的环境很难保证能过了接下来的准备环境阶段。</p> <p>要使用这个板子，你需要提前下载<a href=https://developer.nvidia.com/embedded/dlc/jetson-nano-dev-kit-sd-card-image>SDK的SD卡镜像</a>，以及Host OS（PC，Ubuntu 18.04）所需的<a href=https://developer.nvidia.com/embedded/dlc/nv-sdk-manager>SDK Manager</a>。</p> <p>下载完成之后，从Ref.1的链接中下载所需的镜像烧录软件或者别的烧录软件也行，将SD卡镜像烧录至TF卡中（这里我使用的是64G TF卡，A2）。烧录完毕将其插入核心板下面的卡槽中（有些不好找），见下图。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片_20190411181357.jpg><img alt src=/blog/images/微信图片_20190411181357.jpg></a></p> <p>然后通过HDMI/DP线将之与显示器连接（启动阶段的分辨率需要修改，要不然小点的屏幕没法显示启动logo，这个不是重点以后再说），插上蓝牙USB键鼠，接入USB电源，你就可以看到信仰之NVIDIA logo。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片_20190411181347.jpg><img alt src=/blog/images/微信图片_20190411181347.jpg></a></p> <p>这里你需要等它初始化完成，初始化工作包括扩展跟文件系统、解压乱七八糟的包之类的，总之等看到Ubuntu Desktop的安装配置界面后可以开始操作了。</p> <p>进入桌面后的第一件事儿，可以先打开Chromium，访问<a href=https://webglsamples.org/ >WebGL的示例网站</a>，随便开个demo试试会不会关机，如果关机那么恭喜你可以找个正经的USB电源了（Ref.1里有Adafruit的USB和DC电源适配器购买链接）。</p> <p>当你的DC电源到了以后，先不要直接插上，因为需要设置一下跳线，如图所示。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/f449ce42a97d019b5225c7c220e72ba7.png><img alt src=/blog/images/f449ce42a97d019b5225c7c220e72ba7.png></a></p> <p>看到Power Jack/USB Jumper没，由于我手里没有跳线帽，所以我直接短接了它们，如图所示（看我意念焊接术）。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片编辑_20190411181008.jpg><img alt src=/blog/images/微信图片编辑_20190411181008.jpg></a></p> <p>然后再插上刚入手的DC 5V4A，即可空出你的USB并将之与Host PC相连了。</p> <h4 id=12-sdk><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#12-sdk>1.2. 准备SDK</a></h4> <p><strong>这一节你可以先跳过去，等跑完下面的小节后再看，因为这部分并不影响接下来的操作。</strong></p> <p>准备SDK的内容主要包括：下载安装Host PC、开发板所需CUDA、OpenCV之类的，需要开发板的USB连接到Host PC上作数据连接用（我没有尝试过那个USB口既作电源又作数据传输）。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/捕获-1.png><img alt src=/blog/images/捕获-1.png></a></p> <p>这里我并不打算过多介绍，只要按照引导进行操作即可。</p> <h4 id=13-hello-ai-world><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#13-hello-ai-world>1.3. Hello AI World</a></h4> <p>这个示例为你充分避开了各种依赖库的复杂安装步骤以及非常多的专业术语，对新手较为友好，但是我会仍会将其以链接形式展现，在最后章节的连接中。</p> <p>第一步，从Hello World开始，你仍然需要最基础的工具。</p> <p>$ sudo apt install git make cmake $ git clone https://github.com/dusty-nv/jetson-inference $ cd jetson-inference $ git submodule update --init $ mkdir build $ cd build $ cmake ../ $ make -j4 $ sudo make install $ cd aarch64/bin</p> <p>这一顿操作后，你会拥有个Hello AI World的全部成果。但是，what the hell an I doing?</p> <p>来，对于一些Linux不熟悉的同学来说只要知道这里的cmake与make是编译源码的指令就行，cmake用来生成Makefile，make会根据Makefile里定义的动作调用gcc开始编译。</p> <p>然后让我们看第一个例子，使用<a href=http://www.image-net.org/ >ImageNet</a>的图片素材来训练我们的“机器人”让它能够识别各种物体，其中你会看到当前目录下有两个imagenet开头的文件，让我们从imagenet-console开始。</p> <p>在图形界面上打开终端后，执行如下命令。</p> <p>$ ./imagenet-console orange_0.jpg output_0.jpg $ nautilus .</p> <p>然后经过机器人的推理以后，你会得到一张橘子、另一张还是橘子的图片，并且新橘子图片的左上角标识了机器人认为它有多大概率是橘子。</p> <p><img alt src=/blog/images/捕获.png></p> <p>是不是有感觉了？OK，我们继续。</p> <p>既然它可以看图片，那么它当然也可以看视频或者摄像头中的内容，那么接下来我们让它看到摄像头中的橘子试试。</p> <p>这里我需要给Jetson Nano接一个USB摄像头，接入以后可以在终端键入cheese打开拍照应用程序看它是否工作。</p> <p>然后终端中运行如下命令。</p> <p>./imagenet-camera</p> <p>Oops，segmentation fault了，<a href=https://github.com/dusty-nv/jetson-inference/blob/master/docs/imagenet-camera-2.md>如文档所说</a>，默认的摄像头是板载CSI摄像头，所以这里需要修改代码让它使用后来插入的USB摄像头。</p> <p>$ vi ../../../imagenet-camera/imagenet-camera.cpp</p> <p>...</p> <h2 id=include-imageneth><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#include-imageneth>include "imageNet.h"</a></h2> <h2 id=define-default_camera-0-1-for-onboard-camera-or-change-to-index-of-devvideo-v4l2-camera-0><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#define-default_camera-0-1-for-onboard-camera-or-change-to-index-of-devvideo-v4l2-camera-0>define DEFAULT_CAMERA 0 // -1 for onboard camera, or change to index of /dev/video V4L2 camera (&gt;=0)</a></h2> <p>bool signal_recieved = false; ...</p> <p>将DEFAULT_CAMERA修改为0以后，便会启用/dev/video0路径上的摄像头，然后重新编译。</p> <p>$ cd ../../ # build $ cmake ../ $ make -j4</p> <p>然后进到bin目录下再运行一次imagenet-camera即可。</p> <p><strong>PS：不是所有的摄像头都叫罗技C920，由于摄像头原生编码的问题，可能会导致上述程序黑屏，那么我们需要是适当修改一些内容。笔者暂时跳过这里，等改好以后再看。关于兼容列表可以参考<a href=https://elinux.org/Jetson_Nano#Ecosystem_Products_and_Sensors>eLinux的链接</a>。</strong></p> <h4 id=14><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#14>1.4. 写一个小程序</a></h4> <p>如果你跟着github的教程，那么应该到你自己写一段代码的时间了，直接粘贴吧。</p> <p>// include imageNet header for image recognition</p> <h2 id=include><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#include>include <jetson-inference imagenet.h></a></h2> <p>// // include loadImage header for loading images</p> <h2 id=include_1><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#include_1>include <jetson-utils loadimage.h></a></h2> <p>int main( int argc, char** argv ) { // a command line argument containing the image filename is expected, // // so make sure we have at least 2 args (the first arg is the program) if( argc &lt; 2 ) { printf("my-recognition: expected image filename as argument\n"); printf("example usage: ./my-recognition my_image.jpg\n"); return 0; }</p> <p>// retrieve the image filename from the array of command line args const char* imgFilename = argv[1]; float* imgCPU = NULL; // CPU pointer to floating-point RGBA image data float* imgCUDA = NULL; // GPU pointer to floating-point RGBA image data int imgWidth = 0; // width of the image (in pixels) int imgHeight = 0; // height of the image (in pixels)</p> <p>// load the image from disk as float4 RGBA (32 bits per channel, 128 bits per pixel) if( !loadImageRGBA(imgFilename, (float4**)&amp;imgCPU, (float4**)&amp;imgCUDA, &amp;imgWidth, &amp;imgHeight) ) { printf("failed to load image '%s'\n", imgFilename); return 0; } imageNet* net = imageNet::Create(imageNet::GOOGLENET);</p> <p>if( !net ) { printf("failed to load image recognition network\n"); return 0; } float confidence = 0.0; const int classIndex = net-&gt;Classify(imgCUDA, imgWidth, imgHeight, &amp;confidence); if( classIndex &gt;= 0 ) { // retrieve the name/description of the object class index const char* classDescription = net-&gt;GetClassDesc(classIndex); // print out the classification results printf("image is recognized as '%s' (class #%i) with %f%% confidence\n", classDescription, classIndex, confidence * 100.0f); } else { // if Classify() returned &lt; 0, an error occurred printf("failed to classify image\n"); } delete net; // this is the end of the example! return 0; }</p> <h2 id=require-cmake-28-or-greater><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#require-cmake-28-or-greater>require CMake 2.8 or greater</a></h2> <p>cmake_minimum_required(VERSION 2.8)</p> <h2 id=declare-my-recognition-project><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#declare-my-recognition-project>declare my-recognition project</a></h2> <p>project(my-recognition)</p> <h2 id=import-jetson-inference-and-jetson-utils-packages><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#import-jetson-inference-and-jetson-utils-packages>import jetson-inference and jetson-utils packages.</a></h2> <h2 id=note-that-if-you-didnt-do-sudo-make-install><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#note-that-if-you-didnt-do-sudo-make-install>note that if you didn't do "sudo make install"</a></h2> <h2 id=while-building-jetson-inference-this-will-error><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#while-building-jetson-inference-this-will-error>while building jetson-inference, this will error.</a></h2> <p>find_package(jetson-utils) find_package(jetson-inference)</p> <h2 id=cuda-and-qt4-are-required><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#cuda-and-qt4-are-required>CUDA and Qt4 are required</a></h2> <p>find_package(CUDA) find_package(Qt4)</p> <h2 id=setup-qt4-for-build><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#setup-qt4-for-build>setup Qt4 for build</a></h2> <p>include(<span qt_95_definitions=QT_DEFINITIONS class=arithmatex>\({QT\_USE\_FILE}) add\_definitions(\)</span>)</p> <h2 id=compile-the-my-recognition-program><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#compile-the-my-recognition-program>compile the my-recognition program</a></h2> <p>cuda_add_executable(my-recognition my-recognition.cpp)</p> <h2 id=link-my-recognition-to-jetson-inference-library><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#link-my-recognition-to-jetson-inference-library>link my-recognition to jetson-inference library</a></h2> <p>target_link_libraries(my-recognition jetson-inference)</p> <p>然后编译并运行。</p> <p>$ cmake . $ make $ ./my.cpp polarbear.jpg</p> <p>输出结果如下。</p> <p>[cuda] cudaAllocMapped 5089520 bytes, CPU 0x100c30000 GPU 0x100c30000</p> <p>imageNet -- loading classification network model from: -- prototxt networks/googlenet.prototxt -- model networks/bvlc_googlenet.caffemodel -- class_labels networks/ilsvrc12_synset_words.txt -- input_blob 'data' -- output_blob 'prob' -- batch_size 2</p> <p>[TRT] TensorRT version 5.0.6 [TRT] detected model format - caffe (extension '.caffemodel') [TRT] desired precision specified for GPU: FASTEST [TRT] requested fasted precision for device GPU without providing valid calibrator, disabling INT8 [TRT] native precisions detected for GPU: FP32, FP16 [TRT] selecting fastest native precision for GPU: FP16 [TRT] attempting to open engine cache file /usr/local/bin/networks/bvlc_googlenet.caffemodel.2.1.GPU.FP16.engine [TRT] loading network profile from engine cache... /usr/local/bin/networks/bvlc_googlenet.caffemodel.2.1.GPU.FP16.engine [TRT] device GPU, /usr/local/bin/networks/bvlc_googlenet.caffemodel loaded [TRT] device GPU, CUDA engine context initialized with 2 bindings [TRT] binding -- index 0 -- name 'data' -- type FP32 -- in/out INPUT -- # dims 3 -- dim #0 3 (CHANNEL) -- dim #1 224 (SPATIAL) -- dim #2 224 (SPATIAL) [TRT] binding -- index 1 -- name 'prob' -- type FP32 -- in/out OUTPUT -- # dims 3 -- dim #0 1000 (CHANNEL) -- dim #1 1 (SPATIAL) -- dim #2 1 (SPATIAL) [TRT] binding to input 0 data binding index: 0 [TRT] binding to input 0 data dims (b=2 c=3 h=224 w=224) size=1204224 [cuda] cudaAllocMapped 1204224 bytes, CPU 0x101310000 GPU 0x101310000 [TRT] binding to output 0 prob binding index: 1 [TRT] binding to output 0 prob dims (b=2 c=1000 h=1 w=1) size=8000 [cuda] cudaAllocMapped 8000 bytes, CPU 0x101440000 GPU 0x101440000 device GPU, /usr/local/bin/networks/bvlc_googlenet.caffemodel initialized. [TRT] networks/bvlc_googlenet.caffemodel loaded imageNet -- loaded 1000 class info entries networks/bvlc_googlenet.caffemodel initialized. class 0296 - 1.000000 (ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus) image is recognized as 'ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus' (class #296) with 100.000000% confidence</p> <p>简言之，程序使用ImageNet的图片配上GoogleNet的模型对你的图片进行推理，然后得出它认为这是北极熊的可能性。</p> <p>因为这篇文章的目的是入门，也就是带进来以后看哪个方向就自己看，所以相关数学知识在这里已经忽略了，如果你能写出厉害的理论paper又做出很厉害的工程实现，那么大牛就请继续往下过，顺便留个言交个朋友让我膜拜一下。你也可以查看文末的链接进一步扩展阅读什么是GoogleNet，什么是CNN，然后撸一遍机器学习、深度学习、强化学习啥的，也可能一路懵懂复习到信号与系统、高等数学，你要书的话我这还卖，另外我的学习笔记可以参阅<a href=https://datanote.readthedocs.io/zh/master/ >DataNote</a>。</p> <h3 id=2><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#2>2. 进阶篇</a></h3> <h3 id=21><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#21>2.1. 重新训练模型</a></h3> <h3 id=22><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#22>2.2. 作为推理节点</a></h3> <h3 id=23><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#23>2.3. 深度学习实验</a></h3> <h3 id=24-tensorflow><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#24-tensorflow>2.4. TensorFlow实验</a></h3> <p>安装TensorFlow</p> <p>$ sudo apt-get install libhdf5-serial-dev hdf5-tools libhdf5-dev zlib1g-dev zip libjpeg8-dev $ sudo apt-get install python3-pip $ sudo pip3 install -U pip $ sudo pip3 install -U numpy grpcio absl-py py-cpuinfo psutil portpicker six mock requests gast h5py astor termcolor protobuf keras-applications keras-preprocessing wrapt google-pasta $ sudo pip3 install --pre --extra-index-url https://developer.download.nvidia.com/compute/redist/jp/v42 tensorflow-gpu==1.14.0+nv19.9</p> <p>https://devtalk.nvidia.com/default/topic/1048776/official-tensorflow-for-jetson-nano-/</p> <p>https://www.tensorflow.org/tutorials</p> <p>with jupyter</p> <h4 id=25-tensorrt><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#25-tensorrt>2.5. TensorRT实验</a></h4> <h3 id=3><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#3>3. 行业方案篇</a></h3> <p>太阳底下没有新东西，我发现把之前的笔记稍微整理点可以新开一个目录出一个系列，那么，这里我就直接写关键字吧，以后说不定又冒出什么新东西了呢。</p> <p>在继续之前，我们需要抓住一样内容，即凡是人类自己通过观察、模仿、学习可以获得的重复能力，机器/深度/强化等内容理论来说都可以帮你实现，即使是创造力。</p> <p>然后我们再讲方案，即在这个小小的盒子，它有多少能力，能干啥。</p> <h3 id=31><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#31>3.1. 边缘计算</a></h3> <p>工业现场</p> <p>计算转移</p> <p>CDN</p> <p>军用头戴</p> <h3 id=32><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#32>3.2. 云游戏</a></h3> <p>4K/8K/HDR/60FPS家用主机、服务端</p> <p>无主机头戴</p> <h3 id=33><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#33>3.3. 教学设备</a></h3> <p>甭管便宜的贵的只要带卡都能当教学设备，不信你看研究生论文有多少CUDA相关。</p> <h3 id=34><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#34>3.4. 残障辅助</a></h3> <p>手语翻译（<a href=https://github.com/EvilPort2/Sign-Language>https://github.com/EvilPort2/Sign-Language</a>），可按照中国残联手语进行训练（<a href=http://www.cdpf.org.cn/special/zgsy/node_305701.htm>http://www.cdpf.org.cn/special/zgsy/node_305701.htm</a>）。</p> <p>apt install python3-keras</p> <p>辅助视觉（物体/人脸识别后转语音）</p> <h2 id=_1><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#_1>参考：</a></h2> <h3 id=_2><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#_2>文献</a></h3> <p>[1] NVIDIA AI Two Days Demo: <a href=https://developer.nvidia.com/embedded/twodaystoademo>https://developer.nvidia.com/embedded/twodaystoademo</a></p> <p>[2] CNN Architecture: <a href=https://medium.com/@sidereal/cnns-architectures-lenet-alexnet-vgg-googlenet-resnet-and-more-666091488df5>https://medium.com/@sidereal/cnns-architectures-lenet-alexnet-vgg-googlenet-resnet-and-more-666091488df5</a></p> <p>[3] eLinux: <a href=https://www.elinux.org/Jetson>https://www.elinux.org/Jetson</a></p> <h3 id=_3><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#_3>术语</a></h3> <p>[1] ImageNet: <a href=http://image-net.org/download>http://image-net.org/download</a></p> <p>[2] TensorRT: <a href=https://developer.nvidia.com/tensorrt>https://developer.nvidia.com/tensorrt</a></p> <p>[3] DeepStream: <a href=https://developer.nvidia.com/deepstream-sdk>https://developer.nvidia.com/deepstream-sdk</a></p> <p>[4] cuDNN</p> <p>[5] PyTorch</p> <h3 id=6-nvdla><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#6-nvdla>[6] NVDLA</a></h3> <p>title: "向NVIDIA Jetson Nano中移植QEMU-KVM" date: 2019-04-14 categories: - "cloud-infra" - "devices"</p> <hr> <p>因为Jetson如果作为边缘设备，那么我们需要进一步探索虚拟化在其上的可能性，从而使FT有更容易的路线可走，还有既然它的芯片是PCIE的，那理应可以透传。</p> <p>参考：<a href=https://elinux.org/Jetson/Nano/Upstream>https://elinux.org/Jetson/Nano/Upstream</a></p> <p>什么build rootfs、uboot之类的就不要了，那是后期嵌入式的活，我们在现有环境上build kernel即可。</p> <h2 id=1_1><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#1_1>1. 准备环境</a></h2> <p>访问链接<a href=https://developer.nvidia.com/embedded/downloads>https://developer.nvidia.com/embedded/downloads</a>并下载源码包，包括Jetson自有以及L4T源码，也可以点击如下链接直接下载。</p> <p>https://developer.nvidia.com/embedded/dlc/l4t-sources-32-1-jetson-nano</p> <p>解压其中的kernel部分。</p> <p>https://developer.nvidia.com/embedded/dlc/l4t-jetson-driver-package-32-1-jetson-nano</p> <p>下载并解压后，得到如下文件系统。</p> <h2 id=2-kernel><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#2-kernel>2. 准备kernel</a></h2> <p>Host: sudo su sudo apt install nfs-kernel-server sudo echo "/home/lofyer/Downloads *(rw,no_root_squash,no_subtree_check)" &gt;&gt; /etc/exports sudo exportfs -avf</p> <p>Jetson Nano: sudo su apt instlal libncurses-dev mount root@192.168.0.59:/home/lofyer/Downloads /mnt cd /mnt/ cp /proc/config.gz . gunzip config.gz mv config .config make menuconfig # find and enable kvm, tegra hypervisor make -j4; make -j4 modules_install make -j4 Image cp arch/arm64/boot/Image /boot/Image-kvm</p> <p>然后编辑启动项，默认从新kernel启动。</p> <h2 id=vi-bootextlinuxextlinuxconf><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#vi-bootextlinuxextlinuxconf>vi /boot/extlinux/extlinux.conf</a></h2> <p>TIMEOUT 10 DEFAULT secondary</p> <p>MENU TITLE p3450-porg eMMC boot options</p> <p>LABEL primary MENU LABEL primary kernel LINUX /boot/Image INITRD /boot/initrd APPEND ${cbootargs} rootfstype=ext4 root=/dev/mmcblk0p1 rw rootwait</p> <p>LABEL secondary MENU LABEL kernel with kvm LINUX /boot/Image-kvm INITRD /boot/initrd APPEND ${cbootargs} rootfstype=ext4 root=/dev/mmcblk0p1 rw rootwait</p> <h2 id=3-qemu-kvm><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#3-qemu-kvm>3. 尝试qemu-kvm</a></h2> <p>自带的：</p> <p>apt install qemu-kvm kvm --help</p> <p>自己编的：</p> <p>git clone https://github.com/qemu/qemu cd qemu ./configure --enable-kvm make -j4</p> <p>只能使用machine类型为arm进行加速。</p> <h2 id=4-ft><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#4-ft>4. 看看FT</a></h2> <h3 id=_4><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#_4>算了，现在不看了，等下半年。</a></h3> <p>title: "基于ARM(NVIDIA-JETSON-NANO)编译NetLogo" date: 2019-04-06 categories: - "abm" - "devices" -tags: - "NVIDIA" - "Jetson Nano" - "NetLogo"</p> <hr> <p>本文主要目的为测试这块板子的性能，看看其是否有作为边缘节点的能力。</p> <h3 id=env><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#env>Env</a></h3> <p>Ubuntu 18.04(jetson-nano-sd-r32.1-2019-03-18)</p> <h3 id=prepare><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#prepare>Prepare</a></h3> <p>$ sudo set -i 's/ports.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list $ sudo apt install -y curl x11vnc openjdk openjfx libopenjfx-jni libopenjfx-java</p> <h3 id=build><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#build>Build</a></h3> <p>$ git clone https://github.com/NetLogo/NetLogo $ cd NetLogo $ git submodule update --init $ ./sbt netlogo/compile</p> <p>Run and Package</p> <p>$ ./sbt netlogo/run $ ./sbt dist/buildNetLogo</p> <h3 id=addon-add-vnc-server-to-your-board><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#addon-add-vnc-server-to-your-board>Addon: Add VNC server to your board</a></h3> <p>$ sudo apt install -y x11nvc $ x11vnc # to generate ~/.vnc files $ echo 'x11vnc --loop &amp;' &gt;&gt; ~/.xsessionrc</p> <h3 id=ref><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#ref>Ref</a></h3> <p><a href=https://github.com/NetLogo/NetLogo/wiki/Building>https://github.com/NetLogo/NetLogo/wiki/Building</a></p> <p><a href=https://github.com/NetLogo/NetLogo/wiki/Releasing>https://github.com/NetLogo/NetLogo/wiki/Releasing</a></p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-11-16 00:00:00">2013年11月16日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 2 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=how-to-lockunlockroot-nexus-5><a href=../../2013/11/16/how-to-lockunlockroot-nexus-5/ class=toclink>how to lock/unlock/root nexus 5</a></h2> <p>今日入手Nexus5美版（D820） blahblahblah... 好吧，开始unlock以及root</p> <p>先下载这个包，里面包含CM的镜像，unlock/lock的apk http://cloud.lofyer.org/public.php?service=files&amp;t=af14640b4f32d2e491d80a117db2bbe9</p> <p>下载完成后，同时按住音量上下键再按开机，进入bootloader的前奏（相当于bios选项），此时电脑上应该会有所表示（比如windows的弹出要安装驱动啦，没驱动下个sdk搜索一下，比如linux的dmesg啦）</p> <p>解压下载的文件，运行里面的root-$YOUROS（win、mac、linux）脚本，然后你看到请求unlock的选项，选择unlock并按电源键确认，此时pc上的脚本也会让你下一步； 下一步就是出现红色的机器人，说正在写脚本以及镜像，在写的时候pc上的脚本再下一步就可以自动让它退出了，然后稍等几分钟让它重启，重启的时候你会看到google标志下面的锁标志。</p> <h3 id=rootapkbootloader><a class=toclink href=../../2013/11/16/how-to-lockunlockroot-nexus-5/#rootapkbootloader>出于莫名其妙的安全感，在root以后可以安装压缩包里面的apk文件将bootloader再次锁上，这样，就这样。</a></h3> <p>title: "wrt54g v5添加usb" date: 2012-10-12 categories: - "devices"</p> <hr> <p>1.dd-wrt.com下载固件包及源码包</p> <p>2.编译添加或者配置usb存储支持</p> <p>3.按接口图添加usb</p> <p><a href="http://www.home-wifi.com/forum.php?mod=viewthread&page=1&tid=3962">http://www.home-wifi.com/forum.php?mod=viewthread&amp;page=1&amp;tid=3962</a></p> <blockquote> <p>注意焊点位置，两个数据线左边D+，右边D-，下边的472是4.7k的下拉电阻，右边两个电阻是另一组USB口。所以直接引线就可以，但是我的优盘经常不能识别，就又在USB座上把两条数据线对地接了10k的下拉电阻，相当于和图上的472并起来，现在使用很正常。 <a href=http://blog.lofyer.org/wrt54gs-64ram-8flash/bh/ ><img alt=bh src=/blog/images/bh.jpg></a></p> <p>使用5V 3A电源给路由器供电，不用安装7805了，电源线直接接到电源插座</p> <p><a href=http://blog.lofyer.org/wrt54gs-64ram-8flash/lbh/ ><img alt=lbh src=/blog/images/lbh.jpg></a></p> <p><a href=http://blog.lofyer.org/wrt54gs-64ram-8flash/dd/ ><img alt=dd src=/blog/images/dd.jpg></a></p> </blockquote> <hr> <p>title: "eZ430-Chronos入手" date: 2013-12-16 categories: - "devices"</p> <hr> <p><a href=http://blog.lofyer.org/2013/12/ez430-chronos%e5%85%a5%e6%89%8b/img_20131216_160008/ ><img alt=IMG_20131216_160008 src=/blog/images/IMG_20131216_160008-1024x958.jpg></a></p> <p>入手的是433Mhz，相当于国际版。 关于官方介绍可至<a href=http://processors.wiki.ti.com/index.php/EZ430-Chronos title=eZ430-chronos>eZ430-chronos</a>查阅。 <a href=http://www.ti.com/lit/zip/slac341 title=SLAC341>下载Control Center for Windows</a> <a href=http://www.ti.com/lit/zip/slac388 title=SLAC388>下载Control Center for Linux</a></p> <p>然后将toolkit的USBRF插入PC，选择控制台中的ACC标签并“start ap，腕表选择“#”号键至ACC，再按下键即可于控制台中显示加速度传感器数值。 同样PPT为按键映射，SYNC为时间设置，TFBSL尚未使用。</p> <p>编程 TBD</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-07-28 00:00:00">2013年7月28日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 2 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=leapmotion><a href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/ class=toclink>LeapMotion相关</a></h2> <h3 id=leanmotion><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#leanmotion>LeanMotion入手</a></h3> <p>卖家太给力了，昨天就顺丰发货，今天下午我冒着炎炎烈日去取货，激动。。</p> <p>先来张盒子，看着就感觉那帮老外工业设计功底深厚。 <a href=http://blog.lofyer.org/2013/07/leapmotion-%e5%85%a5%e6%89%8b%ef%bc%8c%e6%99%92%e4%b8%80%e4%b8%8b%e5%bc%80%e7%ae%b1%e4%bb%a5%e5%8f%8a%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c/dsc_0003/ ><img alt=DSC_0003 src=/blog/images/DSC_0003-1024x680.jpg></a></p> <p>开箱：Leapmotion一台，数据线两根（一长一短），说明书一张 <a href=http://blog.lofyer.org/2013/07/leapmotion-%e5%85%a5%e6%89%8b%ef%bc%8c%e6%99%92%e4%b8%80%e4%b8%8b%e5%bc%80%e7%ae%b1%e4%bb%a5%e5%8f%8a%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c/dsc_0006/ ><img alt=DSC_0006 src=/blog/images/DSC_0006-1024x680.jpg></a></p> <p>看着感觉好爽的样子<sub>~</sub> <a href=http://blog.lofyer.org/2013/07/leapmotion-%e5%85%a5%e6%89%8b%ef%bc%8c%e6%99%92%e4%b8%80%e4%b8%8b%e5%bc%80%e7%ae%b1%e4%bb%a5%e5%8f%8a%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c/dsc_0008/ ><img alt=DSC_0008 src=/blog/images/DSC_0008-1024x680.jpg></a></p> <p>我拍的一段简单使用视频。</p> <hr> <h3 id=leapmotion2017-07><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#leapmotion2017-07>LeapMotion记录(2017-07)</a></h3> <h3 id=sdkwindowslinuxmac-sdkarduino-><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#sdkwindowslinuxmac-sdkarduino->已经在官网注册并下载了sdk（windows、linux，我没Mac），设备不出意外下个月到。 等到了再更新文章，到时会更新sdk配置，与arduino交互的相关代码。 可控的目前想到了飞行器、机械手（夹持器 - -）。</a></h3> <p>title: "LeapMotion controlled X4" date: 2013-09-15 categories: - "devices" tags: - "LeapMotion"</p> <hr> <p>两者都入手已经一个月了，可平时有些忙（惰者多忙），也就只零零散散准备了一些资料，还没开始整合。 整个流程大概是这个我用文字描述的粗略的样子：</p> <h3 id=leapmotionmap-leapmotionarduinonfr2401x4-leapmotionx4000><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#leapmotionmap-leapmotionarduinonfr2401x4-leapmotionx4000>空间建模：获取飞行器初始坐标，与leapmotion的可视区域进行map。 一级控制：leapmotion获得的手掌运动信息（可预处理）进入arduino通过nfr2401发送给X4，进行粗略运动指令传达。 二级控制：根据摄像头采集的飞行器位置数据与手掌位置信息对比，进行二阶指令传达。 回馈控制：在二级控制的基础上进行微调。 错误返回：如果超出leapmotion可视范围，则进行回馈控制将X4返回初始位置（0,0,0），超出摄像头范围，则需。。。人工重置。</a></h3> <p>title: "Leapmotion 相关" date: 2013-08-02 categories: - "devices" tags: - "LeapMotion"</p> <hr> <h3 id=windows><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#windows>在Windows中</a></h3> <p>夹持器与四轴飞行器都是Arduino-Based，通信就用串口。 代码放在<a href=http://git.lofyer.org/cgit.cgi/fun/robohand/ title=http://git.lofyer.org/cgit.cgi/fun/robohand/ >git.lofyer.org</a> 感觉VS好难。。试试在gentoo下驱动leapmotion</p> <h3 id=gentoodebian><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#gentoodebian>在Gentoo下使用，这个方式应该适用于所有非debian系</a></h3> <p>先下载sdk包，下载后解压。 看到里面有个deb的包，用alien转化为tar包</p> <p>alien -t Leap-0.8.0-x64.deb tar xf leap-0.8.0.tgz cp -irf usr/* /usr/local/ cp -irf lib/udev/rules.d/25-com-leapmotion-leap.rules /etc/udev/rules.d</p> <p>然后将普通用户加入plugdev组</p> <p>sudo usermod -a -G plugdev $USER</p> <p>刷新组关系，注销当前用户也可</p> <p>exec su -l $USER</p> <p>运行leapd与LeapControlPanel即可</p> <p>在64位机器上缺少32位库文件 freetype.so.6, libasound.so.2</p> <p>sudo emerge -avt app-emulation/emul-linux-x86-xlibs sudo emerge emul-linux-x86-soundlibs</p> <p>实例：编译MotionVisualizer</p> <p>Make -C Builds/Linux</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-06-14 00:00:00">2013年6月14日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 4 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=using-gpu-in-raspberrypi><a href=../../2013/06/14/using-gpu-in-pi/ class=toclink>Using Gpu in RaspberryPi</a></h2> <p><strong>We had a wiki here.</strong> <a href=http://elinux.org/RPi_Xorg_rpi_Driver#Design title="RPi gpu driver design">http://elinux.org/RPi_Xorg_rpi_Driver#Design</a></p> <p><strong>And vc sdk on github. It's also in /opt/vc.</strong> <a href=https://github.com/raspberrypi title="raspberry on github">https://github.com/raspberrypi</a></p> <p><strong>X using gpu.</strong> <a href=https://github.com/simonjhall/fbdev_exa title="X using gpu">https://github.com/simonjhall/fbdev_exa</a></p> <p><strong>Playback accelerating.</strong> <a href=http://wiki.matthiasbock.net/index.php/Hardware-accelerated_video_playback_on_the_Raspberry_Pi title="RPi playback">http://wiki.matthiasbock.net/index.php/Hardware-accelerated_video_playback_on_the_Raspberry_Pi</a></p> <p><strong>Compile gstreamer{*} in Pi</strong> <a href=http://permalink.gmane.org/gmane.comp.video.gstreamer.devel/43011>http://permalink.gmane.org/gmane.comp.video.gstreamer.devel/43011</a></p> <p><strong>Using wayland instead of X</strong> Here's the build instruction <a href=http://wayland.freedesktop.org/raspberrypi.html title="Build Wayland">http://wayland.freedesktop.org/raspberrypi.html</a> For recently PI_DEBIAN img, we should just</p> <p>apt-get install weston weston-dev</p> <p>Using xwayland to run X application in wayland..</p> <p>Notes: 1. If you're going to compile cairo using egl, you shall meet a problem like undeclared 'None', just DEFINE one as 0L. 2. Using soft link rather than copying one when library is missing.</p> <p><strong>Waiting4Test</strong> <strong>Tuning Rasbian</strong> Speedup CPU: raspi-config arm_freq=900 I always use this hack and my rpi run without problem Change scheduler/elevator at boot time: we use more responsive/less disk io usage scheduler: modify the /boot/cmdline.txt</p> <p>dwc_otg.lpm_enable=0 root=/dev/mmcblk0p2 rootfstype=ext4 rootflags=commit=120,data=writeback elevator=deadline rootwait quiet</p> <p>Tuning sysctl.conf: as manual say, sysctl.conf is the “Configuration file for setting system variables”... well there are lot of variables you can put inside this file and for everyone we can write a book. Our goal is to gain more speed and tell our system to use less io/ram. Let’s put in the /etc/sysctl.conf:</p> <p>vm.dirty_background_ratio = 20 vm.dirty_expire_centisecs = 0 vm.dirty_ratio = 80 vm.dirty_writeback_centisecs = 1200 vm.overcommit_ratio = 2 vm.laptop_mode = 5 vm.swappiness = 10</p> <p><strong>Tuning SDCard:</strong> Quite hard to understand, but changing the partition alignment of the SDCard can highly improve the write speed of our sdcard. Basically we have to align the first partition to the erase block size of our sdcard. I suggest to read an reread the reference link. To do that in our sdcard that contain our RaspberryPI Debian distro we have to: backup our filesystem from linux: cd /media/mymmcblk0p2/ (the partitition that’s contain debian fs) tar -cvpzf /home/gibbio/RPI-TC_fs.tgz --exclude=./proc --exclude=./lost+found --exclude=./sys --exclude=./mnt --exclude=./media --exclude=./dev ./ cd /media/mymmcblk0p1/ (the partitition that’s contain boot kernel etc) tar -cvpzf /home/gibbio/RPI-TC_boot.tgz ./ Now use printcsd.py to find the erase block size, most sd have 128K so we use 128K/Sector size = 256 sectors (mine have 64k so we have to use 64k/512b = 128 sector alignement)</p> <p>sfdisk -f -H224 -S56 /dev/mmcblk0 Checking that no-one is using this disk right now ... OK Disk /dev/mmcblk0: 244448 cylinders, 224 heads, 56 sectors/track Old situation: Units = cylinders of 6422528 bytes, blocks of 1024 bytes, counting from 0 Device Boot Start End #cyls #blocks Id System /dev/mmcblk0p1 0 - 0 0 0 Empty /dev/mmcblk0p2 0 - 0 0 0 Empty /dev/mmcblk0p3 0 - 0 0 0 Empty /dev/mmcblk0p4 0 - 0 0 0 Empty Input in the following format; absent fields get a default value. Usually you only need to specify and (and perhaps ). /dev/mmcblk0p1 :,8,c /dev/mmcblk0p1 0+ 7 8- 50175+ c W95 FAT32 (LBA) (enter enter) /dev/mmcblk0p2 : /dev/mmcblk0p2 8 1246 1239 7771008 83 Linux /dev/mmcblk0p3 : /dev/mmcblk0p3 0 - 0 0 0 Empty /dev/mmcblk0p4 : /dev/mmcblk0p4 0 - 0 0 0 Empty New situation: Units = cylinders of 6422528 bytes, blocks of 1024 bytes, counting from 0 Device Boot Start End #cyls #blocks Id System /dev/mmcblk0p1 0+ 7 8- 50175+ c W95 FAT32 (LBA) /dev/mmcblk0p2 8 1246 1239 7771008 83 Linux /dev/mmcblk0p3 0 - 0 0 0 Empty /dev/mmcblk0p4 0 - 0 0 0 Empty Warning: no primary partition is marked bootable (active) This does not matter for LILO, but the DOS MBR will not boot this disk. Do you want to write this to disk? [ynq] y Successfully wrote the new partition table Re-reading the partition table ... If you created or changed a DOS partition, /dev/foo7, say, then use dd(1) to zero the first 512 bytes: dd if=/dev/zero of=/dev/foo7 bs=512 count=1 (See fdisk(8).)</p> <p>gibbio # fdisk -l... Disk /dev/mmcblk0: 8010 MB, 8010072064 bytes 224 heads, 56 sectors/track, 1247 cylinders, total 15644672 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x000ee283 Device Boot Start End Blocks Id System /dev/mmcblk0p1 1 100351 50175+ c W95 FAT32 (LBA) /dev/mmcblk0p2 100352 15642367 7771008 83 Linux</p> <p>now create ext4 FS: mke2fs -t ext4 -E stripe-width=32 -m 0 /dev/mmcblk0p2 make FAT32 partition via gparted gibbio # fdisk /dev/mmcblk0 Command (m for help): p Disk /dev/mmcblk0: 8010 MB, 8010072064 bytes 224 heads, 56 sectors/track, 1247 cylinders, total 15644672 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x000ee283 Device Boot Start End Blocks Id System /dev/mmcblk0p1 1 100351 50175+ c W95 FAT32 (LBA) /dev/mmcblk0p2 100352 15642367 7771008 83 Linux Command (m for help): x Expert command (m for help): p Disk /dev/mmcblk0: 224 heads, 56 sectors, 1247 cylinders Nr AF Hd Sec Cyl Hd Sec Cyl Start Size ID 1 00 0 2 0 223 56 7 1 100351 0c 2 00 0 1 8 223 56 1023 100352 15542016 83 3 00 0 0 0 0 0 0 0 0 00 4 00 0 0 0 0 0 0 0 0 00 Expert command (m for help): b Partition number (1-4): 1 New beginning of data (1-100351, default 1): 128 Expert command (m for help): w The partition table has been altered! Calling ioctl() to re-read partition table. Syncing disks. Now eject the sdcard, reinsert and make the restore from the tgz: cd /media/mymmcblk0p2/ tar -xvpzf RPI-TC_fs.tgz -C ./ mkdir proc mnt sys boot dev umount /media/mymmcblk0p2/ cd /media/mymmcblk0p1/ tar -xvpzf RPI-TC_boot.tgz -C ./ umount /media/mymmcblk0p1/ Eject the sdcard, plug into our Raspberry Pi and power on!</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2012-10-21 00:00:00">2012年10月21日</time></li> <li class=md-meta__item> 分类于 <a href=./ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=arduino><a href=../../2012/10/21/arduino/ class=toclink>Arduino相关</a></h2> <p>目前最流行的是uno系列，而leonardo好象是在1.0.1后才加入的，其ide开发是在github上进行。 设计很清爽（因为没有UI设计师吧），希望别像keil一样越来越冗余。</p> <p><a href=http://69.164.197.168/wp-content/uploads/2012/10/Screenshot-from-2012-10-22-200253.png><img alt src=/blog/images/Screenshot-from-2012-10-22-200253.png title="Screenshot from 2012-10-22 20:02:53"></a></p> <hr> <h3 id=arduino-io2012><a class=toclink href=../../2012/10/21/arduino/#arduino-io2012>Arduino IO生成波形的问题(2012)</a></h3> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code>DigitalWrite(pin,HIGH);
DELAY(10);
DigitalWrite(pin,LOW)
DELAY(10);
</code></pre></div></td></tr></table></div> <p>观察波形（上升沿触发）频率是51Hz，峰值为0.520V（使用外接电源的情况下，USB作电源为0.505V）。 除掉市电滤波的原因，应该是128本身Timer造成的问题，因DELAY使用的是Timer，选中的端口同样为Timer可用的端口，故在电平维持时可看到波形有毛刺（示波器太烂了吧）。</p> <hr> <h3 id=arduinocpu><a class=toclink href=../../2012/10/21/arduino/#arduinocpu>使用Arduino显示主机CPU</a></h3> <p>https://github.com/lofyer/arduino-hostcpuload-led</p> <p>用libgtop2的库，已完成。 注意： 数据以ascii类型传输，调用led时转化为int cpu利用率算式:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code>(float)(100\*(cpu\_time2.(sys+user)-cpu\_time2.(sys+user))/(cpu\_time2.total-cpu\_time1.total))
</code></pre></div></td></tr></table></div> </div> </article> <nav class=md-pagination> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2022 lofyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.56dfad97.min.js></script> <script src=../../../javascripts/config.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>