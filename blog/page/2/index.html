<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=lofyer><link href=https://docs.lofyer.org/blog/page/2/ rel=canonical><link href=../../../inthecloud/frontline-storage/ rel=prev><link href=../../category/lab/ rel=next><link rel=icon href=../../../images/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.39"><title>首页 - Lofyer's Blog</title><link rel=stylesheet href=../../../assets/stylesheets/main.8c3ca2c6.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title="Lofyer's Blog" class="md-header__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lofyer's Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 首页 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Index </a> </li> <li class=md-tabs__item> <a href=../../../wangsheng/ class=md-tabs__link> WangSheng </a> </li> <li class=md-tabs__item> <a href=../../../datanote/ class=md-tabs__link> Archive Docs </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> Archive Blog </a> </li> <li class=md-tabs__item> <a href=../../../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Lofyer's Blog" class="md-nav__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Lofyer's Blog </label> <div class=md-nav__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../wangsheng/ class=md-nav__link> <span class=md-ellipsis> WangSheng </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../datanote/ class=md-nav__link> <span class=md-ellipsis> Archive Docs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Archive Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Archive Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=../../ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../archive/2022/ class=md-nav__link> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../category/lab/ class=md-nav__link> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=_1>首页</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-05-10 00:00:00">2019年5月10日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a>, <a href=../../category/devices/ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 4 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=sdr><a href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/ class=toclink>软件定义无线电（SDR）的设备、软件与应用指南</a></h2> <p><a href=https://blog.lofyer.org/wp-content/uploads/www.youtube.com_watch_v-mks0TAwqQUlistPLbBQHMnVMR41tOomyB0o7UKAxwKINkFFnindex4.png><img alt src=/blog/images/www.youtube.com_watch_v-mks0TAwqQUlistPLbBQHMnVMR41tOomyB0o7UKAxwKINkFFnindex4.png></a></p> <p><strong>注意：本文内容仅限于实验室安全测试目的，禁止用于任何商业或违反当地法律法规的活动。</strong></p> <p><strong>不管是较贵的Ettus还是入门的HackRF，抑或是最初级的RTL-SDR设备，都可以使用这篇教程中的绝大部分内容。</strong></p> <p><a href="https://www.youtube.com/watch?v=Wt_c_H6HQAU&list=PLbBQHMnVMR41tOomyB0o7UKAxwKINkFFn">GRCon2019</a></p> <p>https://www.gnuradio.org/grcon/grcon17/presentations/</p> <p>https://www.gnuradio.org/grcon/grcon18/presentations/</p> <p>https://www.gnuradio.org/grcon/grcon19/presentations/</p> <p>https://github.com/mossmann/hackrf/wiki</p> <p>https://www.hackrf.net/hackrf%E4%B8%8Egnuradio%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97/</p> <p>http://www.hackrf.net/faq/</p> <p>https://wiki.myriadrf.org/LimeSDR</p> <p>https://myriadrf.org/news/limesdr-made-simple-part-1/</p> <p><a href=https://blog.lofyer.org/software-defined-radio-device-software-application-guide/ >雪碧0xroot的PPT</a></p> <h2 id=0><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#0>0. 环境准备</a></h2> <h3 id=01><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#01>0.1 硬件</a></h3> <table> <thead> <tr> <th></th> <th>HackRF One</th> <th>Ettus B200</th> <th>Ettus B210</th> <th>BladeRF x40</th> <th>LimeSDR</th> <th>LimeSDR mini</th> </tr> </thead> <tbody> <tr> <td>Frequency Range</td> <td>1MHz-6GHz</td> <td>70MHz-6GHz</td> <td>70MHz-6GHz</td> <td>300MHz-3.8GHz</td> <td>100kHz-3.8GHz</td> <td>100kHz-3.5GHz</td> </tr> <tr> <td>RF Bandwidth</td> <td>20MHz</td> <td>61.44MHz</td> <td>61.44MHz</td> <td>40MHz</td> <td>61.44MHz</td> <td>30.72MHz</td> </tr> <tr> <td>Sample Depth</td> <td>8 bits</td> <td>12 bits</td> <td>12 bits</td> <td>12 bits</td> <td>12 bits</td> <td>12 bits</td> </tr> <tr> <td>Sample Rate</td> <td>20MSPS</td> <td>61.44MSPS</td> <td>61.44MSPS</td> <td>40MSPS</td> <td>3.2MSPS</td> <td>61.44MSPS</td> </tr> <tr> <td>Transmitter Channels</td> <td>1</td> <td>1</td> <td>2</td> <td>1</td> <td>2</td> <td>1</td> </tr> <tr> <td>Receivers</td> <td>1</td> <td>1</td> <td>2</td> <td>1</td> <td>2</td> <td>1</td> </tr> <tr> <td>Duplex</td> <td>Half</td> <td>Full</td> <td>Full</td> <td>Full</td> <td>Full</td> <td>Full</td> </tr> <tr> <td>Interface</td> <td>USB 2.0</td> <td>USB 3.0</td> <td>USB 3.0</td> <td>USB 3.0</td> <td>USB 3.0</td> <td>USB 3.0</td> </tr> <tr> <td>Programmable Logic Gates</td> <td>64 macrocell CPLD</td> <td>75k</td> <td>100k</td> <td>40k (115k avail)</td> <td>40k</td> <td>40k</td> </tr> <tr> <td>Chipset</td> <td>MAX5864, MAX2837, RFFC5072</td> <td>AD9364</td> <td>AD9361</td> <td>LMS6002M</td> <td>LMS7002M</td> <td>LMS7002M</td> </tr> <tr> <td>Open Source</td> <td>Full</td> <td>Schematic, Firmware</td> <td>Schematic, Firmware</td> <td>Schematic, Firmware</td> <td>Full</td> <td>Full</td> </tr> <tr> <td>Oscillator Precision</td> <td>+/-20ppm</td> <td>+/-2ppm</td> <td>+/-2ppm</td> <td>+/-1ppm</td> <td> +/-1ppm initial</td> <td></td> </tr> <tr> <td>+/-4ppm stable</td> <td> +/-1ppm initial</td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </tbody> </table> <p>+/-4ppm stable | | Transmit Power | -10dBm+ (15dBm @ 2.4GHz) | 10dBm+ | 10dBm+ | 6dBm |  0 to 10dBm | 0 to 10dBm | | Price | 249€ euros VAT Exc. | 991€ euros VAT Exc. | 1658€ euros VAT Exc. | 625€ euros VAT Exc. | 332€ euros VAT Exc. | 190€ euros VAT Exc. |</p> <h3 id=02><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#02>0.2 驱动</a></h3> <h3 id=03><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#03>0.3 软件</a></h3> <p>https://unicorn.360.com/blog/2017/04/12/LimeSDR-Getting-Started-Quickly/</p> <p>https://oneguyoneblog.com/2016/09/15/sdrsharp-sdr-installing-windows-10/</p> <p>下载SDR#后，重启按F7进入“禁用驱动签名”的运行模式，运行其中的install-rtlsdr.bat，替换第0个驱动</p> <h2 id=1><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#1>1. 接收信号</a></h2> <p>接收信号建议使用gqrx（MacOS、Linux），也可以用sdrsharp（Windows）。</p> <p>https://www.rtl-sdr.com/big-list-rtl-sdr-supported-software/</p> <p>$ port info gqrx</p> <p>$ sudo port install gqrx</p> <p>接收信号以后，你可以做的内容就比较多了，这里我会举一些比较有意思的例子。</p> <h3 id=11><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#11>1.1. 听广播/看电视</a></h3> <p>http://dalvikplanet.blogspot.com/2017/03/how-to-get-working-rtl2832u-r820t2-on.html</p> <h3 id=12><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#12>1.2. 接收气象云图</a></h3> <p>SDR软件</p> <p>虚拟声卡</p> <p>WXtoimg</p> <p>gpredict/orbitron</p> <p>https://www.rtl-sdr.com/rtl-sdr-tutorial-receiving-noaa-weather-satellite-/blog/images/</p> <p>https://wischu.com/archives/528.html</p> <p>GSM嗅探</p> <p>https://www.cnblogs.com/k1two2/p/7000942.html</p> <h3 id=13-gps><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#13-gps>1.3. 接收GPS信息</a></h3> <p>https://swling.com/blog/2016/04/guest-post-using-the-hackrf-one-for-dgps-beacon-reception/</p> <p>http://sdrgps.blogspot.com/2016/12/rtl-sdr-to-orbit-with-limesdr.html</p> <h3 id=14-direction-finding-and-passive-rador><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#14-direction-finding-and-passive-rador>1.4. 方向探测与被动雷达 Direction Finding and Passive Rador</a></h3> <p>https://www.rtl-sdr.com/ksdr/</p> <h3 id=15-whatever-you-want-legally><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#15-whatever-you-want-legally>1.5. 接收whatever you want LEGALLY</a></h3> <p>zigbee https://github.com/bastibl/gr-ieee802-15-4</p> <p>https://github.com/BastilleResearch/scapy-radio/tree/master/gnuradio/gr-zigbee</p> <h2 id=2><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#2>2. 发送信号</a></h2> <h3 id=21-gps><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#21-gps>2.1. 发送GPS信号</a></h3> <p>https://gist.github.com/gyaresu/343ae51ecbb70486e270</p> <p>https://www.cnblogs.com/k1two2/p/5477291.html#4245780</p> <p>https://gorgias.me/2017/07/30/HackRF-GPS-%E6%AC%BA%E9%AA%97/</p> <p>https://github.com/osqzss/LimeGPS</p> <h3 id=22><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#22>2.2. 发送文字/音视频</a></h3> <p>Windows软件sdrangel</p> <p>http://gareth.codes/hackrf-transmit/</p> <p>https://github.com/fsphil/hacktv</p> <p>http://www.irrational.net/2014/03/02/digital-atv/</p> <p>http://www.hackrf.net/2014/06/hackrf_nbfm_tx_n_ctcss_squelch/</p> <p>http://www.xn--hrdin-gra.se/blog/wp-content/uploads/2015/08/nbfm-tx.grc</p> <p>https://gist.github.com/gyaresu/343ae51ecbb70486e270</p> <p>https://nuclearrambo.com/wordpress/transferring-a-text-file-over-the-air-with-limesdr-mini/</p> <p>https://github.com/martinmarinov/TempestSDR</p> <h2 id=3><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#3>3. 收发信号</a></h2> <h3 id=gsm><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#gsm>GSM</a></h3> <p>https://www.evilsocket.net/2016/03/31/how-to-build-your-own-rogue-gsm-bts-for-fun-and-profit/</p> <p>https://yatebts.com/open_source/</p> <p>https://cn0xroot.com/2017/01/10/iot-mode-fuzzing-with-openbt/</p> <h3 id=lte><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#lte>LTE</a></h3> <p>https://yq.aliyun.com/articles/310348</p> <p>https://www.cnblogs.com/k1two2/p/5666667.html</p> <p>https://cn0xroot.com/2017/04/12/limesdr-getting-started-quickly/</p> <h3 id=openbtslimesdr><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#openbtslimesdr>OpenBTS+LimeSDR</a></h3> <p>Prepare:</p> <p>Ubuntu Desktop 16.04 &amp; LimeSDR 1.4s with <strong>LimeSuite 17.12(If not, OpenUSRP will fail.)</strong></p> <h4 id=install-build-essential-packages><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-build-essential-packages>Install build-essential packages</a></h4> <h2 id=packages-for-soapysdr-available-at-myriadrf-ppa><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#packages-for-soapysdr-available-at-myriadrf-ppa>packages for soapysdr available at myriadrf PPA</a></h2> <p>sudo add-apt-repository -y ppa:myriadrf/drivers sudo apt-get update</p> <h2 id=install-core-library-and-build-dependencies><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-core-library-and-build-dependencies>install core library and build dependencies</a></h2> <p>sudo apt-get install -y git g++ cmake libsqlite3-dev</p> <h2 id=install-hardware-support-dependencies><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-hardware-support-dependencies>install hardware support dependencies</a></h2> <p>sudo apt-get install -y libsoapysdr-dev libi2c-dev libusb-1.0-0-dev</p> <h2 id=install-graphics-dependencies><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-graphics-dependencies>install graphics dependencies</a></h2> <p>sudo apt-get install -y libwxgtk3.0-dev freeglut3-dev</p> <h2 id=install-for-building-uhd><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#install-for-building-uhd>Install for building uhd</a></h2> <p>sudo apt-get install libboost-all-dev libusb-1.0-0-dev python-mako doxygen python-docutils cmake build-essential</p> <h4 id=change-to-uhd-driver-via-uhd><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#change-to-uhd-driver-via-uhd>Change to UHD driver via uhd</a></h4> <p>$ cd ~ # build and install limesuite $ git clone https://github.com/myriadrf/LimeSuite.git $ cd LimeSuite $ mkdir builddir &amp;&amp; cd builddir $ cmake ../ $ make -j4 $ sudo make install $ sudo ldconfig</p> <p>$ cd ~ # build uhd, install, enable lime, rebuild $ git clone https://github.com/EttusResearch/uhd.git $ cd uhd/host/ $ mkdir build &amp;&amp; cd build $ cmake ../ $ make -j4 $ sudo make install $ git clone https://github.com/jocover/OpenUSRP.git lib/ursp/OpenUSRP # DO NOT GO OUT $ echo "INCLUDE_SUBDIRECTORY(OpenUSRP)"&gt;&gt;lib/ursp/CMakeLists.txt $ cmake ../ $ make -j4 $ sudo make install</p> <h4 id=or-change-to-uhd-driver-via-soapysdr><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#or-change-to-uhd-driver-via-soapysdr>Or, Change to UHD driver via SoapySDR</a></h4> <p>$ git clone https://github.com/pothosware/SoapySDR $ cd SoapySDR $ mkdir builddir;cd builddir; cmake ../ $ make -j4 $ sudo make install</p> <p>$ git clone https://github.com/myriadrf/LimeSuite $ cd LimeSuite</p> <h4 id=build-openbts><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#build-openbts>Build OpenBTS</a></h4> <h2 id=4-sdr><a class=toclink href=../../2019/05/10/%E8%BD%AF%E4%BB%B6%E5%AE%9A%E4%B9%89%E6%97%A0%E7%BA%BF%E7%94%B5sdr%E7%9A%84%E8%AE%BE%E5%A4%87%E8%BD%AF%E4%BB%B6%E4%B8%8E%E5%BA%94%E7%94%A8%E6%8C%87%E5%8D%97/#4-sdr>4. SDR</a></h2> <p>软件定义无线电的内容即是可以灵活定义信号的处理过程，比如输出到TCP/UDP、文字音视频解码等。其中比较有名的有GNURadio、SoapySDR、Pothos（IDE）等（这里以GNURadio为例）。推荐在Linux中安装，当然也可在MacOS或者Windows中使用MacPorts进行安装，除此之外，也有<a href=https://mirrors.tuna.tsinghua.edu.cn/help/pybombs/ >PyBombs</a>可选。</p> <p>在MacOS中安装需要使用MacPorts、XQuartz，MacPorts安装内容如下。</p> <p>$ port info gnuradio $ sudo port install gnuradio+wxgui gr-osmosdr sox $ port content gnuradio $ sudo port install hackrf $ sudo port install rtl-sdr $ sudo port search gr- # if you wanna more modules in gnuradio, don't be shy</p> <p>然后打开XQuartz，将/opt/local/bin/gnuradio-companion加入到X自定义应用程序菜单中（建议修改默认的X终端程序内容为_xterm -e "source ~/.bash_profile;/bin/bash"_）。</p> <p>https://greatscottgadgets.com/sdr/</p> <p>https://gist.github.com/machinaut/addf3438ef0c1a9cad38</p> <p>https://osmocom.org/projects/gr-osmosdr/wiki/GrOsmoSDR#RTL-SDRSource</p> <p>https://pypi.org/project/pyrtlsdr/#description</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2019-04-08 00:00:00">2019年4月8日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/ai/ class=md-meta__link>ai</a>, <a href=../../category/devices/ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 7 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=nvidia-jetson><a href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/ class=toclink>NVIDIA Jetson使用指导</a></h2> <p>本文将以NVIDIA Jetson为硬件基础，为你展现NVIDIA的力量，可以将其作为Jetson Nano的入门参考手册（教程）。</p> <h3 id=1><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#1>1. 入门篇</a></h3> <p>入门篇的有两章内容，来自NVIDIA JETSON包装盒自带的内容。</p> <h4 id=11><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#11>1.1. 准备环境</a></h4> <p>Ref.1: <a href=https://developer.nvidia.com/embedded/learn/get-started-jetson-nano-devkit>https://developer.nvidia.com/embedded/learn/get-started-jetson-nano-devkit</a></p> <p>Ref.2: <a href=https://developer.nvidia.com/embedded/downloads>https://developer.nvidia.com/embedded/downloads</a></p> <p>这里我使用的是一个Jetson Nano开发板，起初我以为随便一个USB数据线就能把它跑起来，但是我想多了。18W的快充头插上后可以正常启动，但是一旦运行比如WebGL测试的页面直接就关机了，因而我把小米音箱的电源适配器（5V2A）给它用了，还真能跑的动。</p> <p>但是为了接下来的内容，我特意买了一个5V4A的5.5mm OD的电源适配器，要不然以我现在的环境很难保证能过了接下来的准备环境阶段。</p> <p>要使用这个板子，你需要提前下载<a href=https://developer.nvidia.com/embedded/dlc/jetson-nano-dev-kit-sd-card-image>SDK的SD卡镜像</a>，以及Host OS（PC，Ubuntu 18.04）所需的<a href=https://developer.nvidia.com/embedded/dlc/nv-sdk-manager>SDK Manager</a>。</p> <p>下载完成之后，从Ref.1的链接中下载所需的镜像烧录软件或者别的烧录软件也行，将SD卡镜像烧录至TF卡中（这里我使用的是64G TF卡，A2）。烧录完毕将其插入核心板下面的卡槽中（有些不好找），见下图。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片_20190411181357.jpg><img alt src=/blog/images/微信图片_20190411181357.jpg></a></p> <p>然后通过HDMI/DP线将之与显示器连接（启动阶段的分辨率需要修改，要不然小点的屏幕没法显示启动logo，这个不是重点以后再说），插上蓝牙USB键鼠，接入USB电源，你就可以看到信仰之NVIDIA logo。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片_20190411181347.jpg><img alt src=/blog/images/微信图片_20190411181347.jpg></a></p> <p>这里你需要等它初始化完成，初始化工作包括扩展跟文件系统、解压乱七八糟的包之类的，总之等看到Ubuntu Desktop的安装配置界面后可以开始操作了。</p> <p>进入桌面后的第一件事儿，可以先打开Chromium，访问<a href=https://webglsamples.org/ >WebGL的示例网站</a>，随便开个demo试试会不会关机，如果关机那么恭喜你可以找个正经的USB电源了（Ref.1里有Adafruit的USB和DC电源适配器购买链接）。</p> <p>当你的DC电源到了以后，先不要直接插上，因为需要设置一下跳线，如图所示。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/f449ce42a97d019b5225c7c220e72ba7.png><img alt src=/blog/images/f449ce42a97d019b5225c7c220e72ba7.png></a></p> <p>看到Power Jack/USB Jumper没，由于我手里没有跳线帽，所以我直接短接了它们，如图所示（看我意念焊接术）。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片编辑_20190411181008.jpg><img alt src=/blog/images/微信图片编辑_20190411181008.jpg></a></p> <p>然后再插上刚入手的DC 5V4A，即可空出你的USB并将之与Host PC相连了。</p> <h4 id=12-sdk><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#12-sdk>1.2. 准备SDK</a></h4> <p><strong>这一节你可以先跳过去，等跑完下面的小节后再看，因为这部分并不影响接下来的操作。</strong></p> <p>准备SDK的内容主要包括：下载安装Host PC、开发板所需CUDA、OpenCV之类的，需要开发板的USB连接到Host PC上作数据连接用（我没有尝试过那个USB口既作电源又作数据传输）。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/捕获-1.png><img alt src=/blog/images/捕获-1.png></a></p> <p>这里我并不打算过多介绍，只要按照引导进行操作即可。</p> <h4 id=13-hello-ai-world><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#13-hello-ai-world>1.3. Hello AI World</a></h4> <p>这个示例为你充分避开了各种依赖库的复杂安装步骤以及非常多的专业术语，对新手较为友好，但是我会仍会将其以链接形式展现，在最后章节的连接中。</p> <p>第一步，从Hello World开始，你仍然需要最基础的工具。</p> <p>$ sudo apt install git make cmake $ git clone https://github.com/dusty-nv/jetson-inference $ cd jetson-inference $ git submodule update --init $ mkdir build $ cd build $ cmake ../ $ make -j4 $ sudo make install $ cd aarch64/bin</p> <p>这一顿操作后，你会拥有个Hello AI World的全部成果。但是，what the hell an I doing?</p> <p>来，对于一些Linux不熟悉的同学来说只要知道这里的cmake与make是编译源码的指令就行，cmake用来生成Makefile，make会根据Makefile里定义的动作调用gcc开始编译。</p> <p>然后让我们看第一个例子，使用<a href=http://www.image-net.org/ >ImageNet</a>的图片素材来训练我们的“机器人”让它能够识别各种物体，其中你会看到当前目录下有两个imagenet开头的文件，让我们从imagenet-console开始。</p> <p>在图形界面上打开终端后，执行如下命令。</p> <p>$ ./imagenet-console orange_0.jpg output_0.jpg $ nautilus .</p> <p>然后经过机器人的推理以后，你会得到一张橘子、另一张还是橘子的图片，并且新橘子图片的左上角标识了机器人认为它有多大概率是橘子。</p> <p><img alt src=/blog/images/捕获.png></p> <p>是不是有感觉了？OK，我们继续。</p> <p>既然它可以看图片，那么它当然也可以看视频或者摄像头中的内容，那么接下来我们让它看到摄像头中的橘子试试。</p> <p>这里我需要给Jetson Nano接一个USB摄像头，接入以后可以在终端键入cheese打开拍照应用程序看它是否工作。</p> <p>然后终端中运行如下命令。</p> <p>./imagenet-camera</p> <p>Oops，segmentation fault了，<a href=https://github.com/dusty-nv/jetson-inference/blob/master/docs/imagenet-camera-2.md>如文档所说</a>，默认的摄像头是板载CSI摄像头，所以这里需要修改代码让它使用后来插入的USB摄像头。</p> <p>$ vi ../../../imagenet-camera/imagenet-camera.cpp</p> <p>...</p> <h2 id=include-imageneth><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#include-imageneth>include "imageNet.h"</a></h2> <h2 id=define-default_camera-0-1-for-onboard-camera-or-change-to-index-of-devvideo-v4l2-camera-0><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#define-default_camera-0-1-for-onboard-camera-or-change-to-index-of-devvideo-v4l2-camera-0>define DEFAULT_CAMERA 0 // -1 for onboard camera, or change to index of /dev/video V4L2 camera (&gt;=0)</a></h2> <p>bool signal_recieved = false; ...</p> <p>将DEFAULT_CAMERA修改为0以后，便会启用/dev/video0路径上的摄像头，然后重新编译。</p> <p>$ cd ../../ # build $ cmake ../ $ make -j4</p> <p>然后进到bin目录下再运行一次imagenet-camera即可。</p> <p><strong>PS：不是所有的摄像头都叫罗技C920，由于摄像头原生编码的问题，可能会导致上述程序黑屏，那么我们需要是适当修改一些内容。笔者暂时跳过这里，等改好以后再看。关于兼容列表可以参考<a href=https://elinux.org/Jetson_Nano#Ecosystem_Products_and_Sensors>eLinux的链接</a>。</strong></p> <h4 id=14><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#14>1.4. 写一个小程序</a></h4> <p>如果你跟着github的教程，那么应该到你自己写一段代码的时间了，直接粘贴吧。</p> <p>// include imageNet header for image recognition</p> <h2 id=include><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#include>include <jetson-inference imagenet.h></a></h2> <p>// // include loadImage header for loading images</p> <h2 id=include_1><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#include_1>include <jetson-utils loadimage.h></a></h2> <p>int main( int argc, char** argv ) { // a command line argument containing the image filename is expected, // // so make sure we have at least 2 args (the first arg is the program) if( argc &lt; 2 ) { printf("my-recognition: expected image filename as argument\n"); printf("example usage: ./my-recognition my_image.jpg\n"); return 0; }</p> <p>// retrieve the image filename from the array of command line args const char* imgFilename = argv[1]; float* imgCPU = NULL; // CPU pointer to floating-point RGBA image data float* imgCUDA = NULL; // GPU pointer to floating-point RGBA image data int imgWidth = 0; // width of the image (in pixels) int imgHeight = 0; // height of the image (in pixels)</p> <p>// load the image from disk as float4 RGBA (32 bits per channel, 128 bits per pixel) if( !loadImageRGBA(imgFilename, (float4**)&amp;imgCPU, (float4**)&amp;imgCUDA, &amp;imgWidth, &amp;imgHeight) ) { printf("failed to load image '%s'\n", imgFilename); return 0; } imageNet* net = imageNet::Create(imageNet::GOOGLENET);</p> <p>if( !net ) { printf("failed to load image recognition network\n"); return 0; } float confidence = 0.0; const int classIndex = net-&gt;Classify(imgCUDA, imgWidth, imgHeight, &amp;confidence); if( classIndex &gt;= 0 ) { // retrieve the name/description of the object class index const char* classDescription = net-&gt;GetClassDesc(classIndex); // print out the classification results printf("image is recognized as '%s' (class #%i) with %f%% confidence\n", classDescription, classIndex, confidence * 100.0f); } else { // if Classify() returned &lt; 0, an error occurred printf("failed to classify image\n"); } delete net; // this is the end of the example! return 0; }</p> <h2 id=require-cmake-28-or-greater><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#require-cmake-28-or-greater>require CMake 2.8 or greater</a></h2> <p>cmake_minimum_required(VERSION 2.8)</p> <h2 id=declare-my-recognition-project><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#declare-my-recognition-project>declare my-recognition project</a></h2> <p>project(my-recognition)</p> <h2 id=import-jetson-inference-and-jetson-utils-packages><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#import-jetson-inference-and-jetson-utils-packages>import jetson-inference and jetson-utils packages.</a></h2> <h2 id=note-that-if-you-didnt-do-sudo-make-install><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#note-that-if-you-didnt-do-sudo-make-install>note that if you didn't do "sudo make install"</a></h2> <h2 id=while-building-jetson-inference-this-will-error><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#while-building-jetson-inference-this-will-error>while building jetson-inference, this will error.</a></h2> <p>find_package(jetson-utils) find_package(jetson-inference)</p> <h2 id=cuda-and-qt4-are-required><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#cuda-and-qt4-are-required>CUDA and Qt4 are required</a></h2> <p>find_package(CUDA) find_package(Qt4)</p> <h2 id=setup-qt4-for-build><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#setup-qt4-for-build>setup Qt4 for build</a></h2> <p>include(<span qt_95_definitions=QT_DEFINITIONS class=arithmatex>\({QT\_USE\_FILE}) add\_definitions(\)</span>)</p> <h2 id=compile-the-my-recognition-program><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#compile-the-my-recognition-program>compile the my-recognition program</a></h2> <p>cuda_add_executable(my-recognition my-recognition.cpp)</p> <h2 id=link-my-recognition-to-jetson-inference-library><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#link-my-recognition-to-jetson-inference-library>link my-recognition to jetson-inference library</a></h2> <p>target_link_libraries(my-recognition jetson-inference)</p> <p>然后编译并运行。</p> <p>$ cmake . $ make $ ./my.cpp polarbear.jpg</p> <p>输出结果如下。</p> <p>[cuda] cudaAllocMapped 5089520 bytes, CPU 0x100c30000 GPU 0x100c30000</p> <p>imageNet -- loading classification network model from: -- prototxt networks/googlenet.prototxt -- model networks/bvlc_googlenet.caffemodel -- class_labels networks/ilsvrc12_synset_words.txt -- input_blob 'data' -- output_blob 'prob' -- batch_size 2</p> <p>[TRT] TensorRT version 5.0.6 [TRT] detected model format - caffe (extension '.caffemodel') [TRT] desired precision specified for GPU: FASTEST [TRT] requested fasted precision for device GPU without providing valid calibrator, disabling INT8 [TRT] native precisions detected for GPU: FP32, FP16 [TRT] selecting fastest native precision for GPU: FP16 [TRT] attempting to open engine cache file /usr/local/bin/networks/bvlc_googlenet.caffemodel.2.1.GPU.FP16.engine [TRT] loading network profile from engine cache... /usr/local/bin/networks/bvlc_googlenet.caffemodel.2.1.GPU.FP16.engine [TRT] device GPU, /usr/local/bin/networks/bvlc_googlenet.caffemodel loaded [TRT] device GPU, CUDA engine context initialized with 2 bindings [TRT] binding -- index 0 -- name 'data' -- type FP32 -- in/out INPUT -- # dims 3 -- dim #0 3 (CHANNEL) -- dim #1 224 (SPATIAL) -- dim #2 224 (SPATIAL) [TRT] binding -- index 1 -- name 'prob' -- type FP32 -- in/out OUTPUT -- # dims 3 -- dim #0 1000 (CHANNEL) -- dim #1 1 (SPATIAL) -- dim #2 1 (SPATIAL) [TRT] binding to input 0 data binding index: 0 [TRT] binding to input 0 data dims (b=2 c=3 h=224 w=224) size=1204224 [cuda] cudaAllocMapped 1204224 bytes, CPU 0x101310000 GPU 0x101310000 [TRT] binding to output 0 prob binding index: 1 [TRT] binding to output 0 prob dims (b=2 c=1000 h=1 w=1) size=8000 [cuda] cudaAllocMapped 8000 bytes, CPU 0x101440000 GPU 0x101440000 device GPU, /usr/local/bin/networks/bvlc_googlenet.caffemodel initialized. [TRT] networks/bvlc_googlenet.caffemodel loaded imageNet -- loaded 1000 class info entries networks/bvlc_googlenet.caffemodel initialized. class 0296 - 1.000000 (ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus) image is recognized as 'ice bear, polar bear, Ursus Maritimus, Thalarctos maritimus' (class #296) with 100.000000% confidence</p> <p>简言之，程序使用ImageNet的图片配上GoogleNet的模型对你的图片进行推理，然后得出它认为这是北极熊的可能性。</p> <p>因为这篇文章的目的是入门，也就是带进来以后看哪个方向就自己看，所以相关数学知识在这里已经忽略了，如果你能写出厉害的理论paper又做出很厉害的工程实现，那么大牛就请继续往下过，顺便留个言交个朋友让我膜拜一下。你也可以查看文末的链接进一步扩展阅读什么是GoogleNet，什么是CNN，然后撸一遍机器学习、深度学习、强化学习啥的，也可能一路懵懂复习到信号与系统、高等数学，你要书的话我这还卖，另外我的学习笔记可以参阅<a href=https://datanote.readthedocs.io/zh/master/ >DataNote</a>。</p> <h3 id=2><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#2>2. 进阶篇</a></h3> <h3 id=21><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#21>2.1. 重新训练模型</a></h3> <h3 id=22><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#22>2.2. 作为推理节点</a></h3> <h3 id=23><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#23>2.3. 深度学习实验</a></h3> <h3 id=24-tensorflow><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#24-tensorflow>2.4. TensorFlow实验</a></h3> <p>安装TensorFlow</p> <p>$ sudo apt-get install libhdf5-serial-dev hdf5-tools libhdf5-dev zlib1g-dev zip libjpeg8-dev $ sudo apt-get install python3-pip $ sudo pip3 install -U pip $ sudo pip3 install -U numpy grpcio absl-py py-cpuinfo psutil portpicker six mock requests gast h5py astor termcolor protobuf keras-applications keras-preprocessing wrapt google-pasta $ sudo pip3 install --pre --extra-index-url https://developer.download.nvidia.com/compute/redist/jp/v42 tensorflow-gpu==1.14.0+nv19.9</p> <p>https://devtalk.nvidia.com/default/topic/1048776/official-tensorflow-for-jetson-nano-/</p> <p>https://www.tensorflow.org/tutorials</p> <p>with jupyter</p> <h4 id=25-tensorrt><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#25-tensorrt>2.5. TensorRT实验</a></h4> <h3 id=3><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#3>3. 行业方案篇</a></h3> <p>太阳底下没有新东西，我发现把之前的笔记稍微整理点可以新开一个目录出一个系列，那么，这里我就直接写关键字吧，以后说不定又冒出什么新东西了呢。</p> <p>在继续之前，我们需要抓住一样内容，即凡是人类自己通过观察、模仿、学习可以获得的重复能力，机器/深度/强化等内容理论来说都可以帮你实现，即使是创造力。</p> <p>然后我们再讲方案，即在这个小小的盒子，它有多少能力，能干啥。</p> <h3 id=31><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#31>3.1. 边缘计算</a></h3> <p>工业现场</p> <p>计算转移</p> <p>CDN</p> <p>军用头戴</p> <h3 id=32><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#32>3.2. 云游戏</a></h3> <p>4K/8K/HDR/60FPS家用主机、服务端</p> <p>无主机头戴</p> <h3 id=33><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#33>3.3. 教学设备</a></h3> <p>甭管便宜的贵的只要带卡都能当教学设备，不信你看研究生论文有多少CUDA相关。</p> <h3 id=34><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#34>3.4. 残障辅助</a></h3> <p>手语翻译（<a href=https://github.com/EvilPort2/Sign-Language>https://github.com/EvilPort2/Sign-Language</a>），可按照中国残联手语进行训练（<a href=http://www.cdpf.org.cn/special/zgsy/node_305701.htm>http://www.cdpf.org.cn/special/zgsy/node_305701.htm</a>）。</p> <p>apt install python3-keras</p> <p>辅助视觉（物体/人脸识别后转语音）</p> <h2 id=_1><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#_1>参考：</a></h2> <h3 id=_2><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#_2>文献</a></h3> <p>[1] NVIDIA AI Two Days Demo: <a href=https://developer.nvidia.com/embedded/twodaystoademo>https://developer.nvidia.com/embedded/twodaystoademo</a></p> <p>[2] CNN Architecture: <a href=https://medium.com/@sidereal/cnns-architectures-lenet-alexnet-vgg-googlenet-resnet-and-more-666091488df5>https://medium.com/@sidereal/cnns-architectures-lenet-alexnet-vgg-googlenet-resnet-and-more-666091488df5</a></p> <p>[3] eLinux: <a href=https://www.elinux.org/Jetson>https://www.elinux.org/Jetson</a></p> <h3 id=_3><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#_3>术语</a></h3> <p>[1] ImageNet: <a href=http://image-net.org/download>http://image-net.org/download</a></p> <p>[2] TensorRT: <a href=https://developer.nvidia.com/tensorrt>https://developer.nvidia.com/tensorrt</a></p> <p>[3] DeepStream: <a href=https://developer.nvidia.com/deepstream-sdk>https://developer.nvidia.com/deepstream-sdk</a></p> <p>[4] cuDNN</p> <p>[5] PyTorch</p> <h3 id=6-nvdla><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#6-nvdla>[6] NVDLA</a></h3> <p>title: "向NVIDIA Jetson Nano中移植QEMU-KVM" date: 2019-04-14 categories: - "cloud-infra" - "devices"</p> <hr> <p>因为Jetson如果作为边缘设备，那么我们需要进一步探索虚拟化在其上的可能性，从而使FT有更容易的路线可走，还有既然它的芯片是PCIE的，那理应可以透传。</p> <p>参考：<a href=https://elinux.org/Jetson/Nano/Upstream>https://elinux.org/Jetson/Nano/Upstream</a></p> <p>什么build rootfs、uboot之类的就不要了，那是后期嵌入式的活，我们在现有环境上build kernel即可。</p> <h2 id=1_1><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#1_1>1. 准备环境</a></h2> <p>访问链接<a href=https://developer.nvidia.com/embedded/downloads>https://developer.nvidia.com/embedded/downloads</a>并下载源码包，包括Jetson自有以及L4T源码，也可以点击如下链接直接下载。</p> <p>https://developer.nvidia.com/embedded/dlc/l4t-sources-32-1-jetson-nano</p> <p>解压其中的kernel部分。</p> <p>https://developer.nvidia.com/embedded/dlc/l4t-jetson-driver-package-32-1-jetson-nano</p> <p>下载并解压后，得到如下文件系统。</p> <h2 id=2-kernel><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#2-kernel>2. 准备kernel</a></h2> <p>Host: sudo su sudo apt install nfs-kernel-server sudo echo "/home/lofyer/Downloads *(rw,no_root_squash,no_subtree_check)" &gt;&gt; /etc/exports sudo exportfs -avf</p> <p>Jetson Nano: sudo su apt instlal libncurses-dev mount root@192.168.0.59:/home/lofyer/Downloads /mnt cd /mnt/ cp /proc/config.gz . gunzip config.gz mv config .config make menuconfig # find and enable kvm, tegra hypervisor make -j4; make -j4 modules_install make -j4 Image cp arch/arm64/boot/Image /boot/Image-kvm</p> <p>然后编辑启动项，默认从新kernel启动。</p> <h2 id=vi-bootextlinuxextlinuxconf><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#vi-bootextlinuxextlinuxconf>vi /boot/extlinux/extlinux.conf</a></h2> <p>TIMEOUT 10 DEFAULT secondary</p> <p>MENU TITLE p3450-porg eMMC boot options</p> <p>LABEL primary MENU LABEL primary kernel LINUX /boot/Image INITRD /boot/initrd APPEND ${cbootargs} rootfstype=ext4 root=/dev/mmcblk0p1 rw rootwait</p> <p>LABEL secondary MENU LABEL kernel with kvm LINUX /boot/Image-kvm INITRD /boot/initrd APPEND ${cbootargs} rootfstype=ext4 root=/dev/mmcblk0p1 rw rootwait</p> <h2 id=3-qemu-kvm><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#3-qemu-kvm>3. 尝试qemu-kvm</a></h2> <p>自带的：</p> <p>apt install qemu-kvm kvm --help</p> <p>自己编的：</p> <p>git clone https://github.com/qemu/qemu cd qemu ./configure --enable-kvm make -j4</p> <p>只能使用machine类型为arm进行加速。</p> <h2 id=4-ft><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#4-ft>4. 看看FT</a></h2> <h3 id=_4><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#_4>算了，现在不看了，等下半年。</a></h3> <p>title: "基于ARM(NVIDIA-JETSON-NANO)编译NetLogo" date: 2019-04-06 categories: - "abm" - "devices" -tags: - "NVIDIA" - "Jetson Nano" - "NetLogo"</p> <hr> <p>本文主要目的为测试这块板子的性能，看看其是否有作为边缘节点的能力。</p> <h3 id=env><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#env>Env</a></h3> <p>Ubuntu 18.04(jetson-nano-sd-r32.1-2019-03-18)</p> <h3 id=prepare><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#prepare>Prepare</a></h3> <p>$ sudo set -i 's/ports.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list $ sudo apt install -y curl x11vnc openjdk openjfx libopenjfx-jni libopenjfx-java</p> <h3 id=build><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#build>Build</a></h3> <p>$ git clone https://github.com/NetLogo/NetLogo $ cd NetLogo $ git submodule update --init $ ./sbt netlogo/compile</p> <p>Run and Package</p> <p>$ ./sbt netlogo/run $ ./sbt dist/buildNetLogo</p> <h3 id=addon-add-vnc-server-to-your-board><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#addon-add-vnc-server-to-your-board>Addon: Add VNC server to your board</a></h3> <p>$ sudo apt install -y x11nvc $ x11vnc # to generate ~/.vnc files $ echo 'x11vnc --loop &amp;' &gt;&gt; ~/.xsessionrc</p> <h3 id=ref><a class=toclink href=../../2019/04/08/nvidia-jetson%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/#ref>Ref</a></h3> <p><a href=https://github.com/NetLogo/NetLogo/wiki/Building>https://github.com/NetLogo/NetLogo/wiki/Building</a></p> <p><a href=https://github.com/NetLogo/NetLogo/wiki/Releasing>https://github.com/NetLogo/NetLogo/wiki/Releasing</a></p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2018-11-02 00:00:00">2018年11月2日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/mylife/ class=md-meta__link>mylife</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2018/11/02/%E8%BF%99%E6%98%AF%E4%B8%80%E7%AF%87%E8%A1%A8%E8%BE%BE/ class=toclink>这是一篇表达</a></h2> <p>距离上一次写已经很久了，而且似乎有个趋势就是对生活越熟悉就越麻木，也同样伴随体重的增加。</p> <p>写了一句话，我已经忘了落笔时的念想。</p> <p>要偶尔转移压力，但不是通过思考，方法或许成熟，但是经不得劳累。</p> <p>要放弃linode的集群了，因为vultr ipv6内部通信更便宜。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2018-08-13 00:00:00">2018年8月13日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a>, <a href=../../category/hpc/ class=md-meta__link>hpc</a></li> <li class=md-meta__item> 需要 2 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=hpc><a href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/ class=toclink>HPC相关</a></h2> <h3 id=hpc2018-08-13><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#hpc2018-08-13>HPC入门指南(2018-08-13)</a></h3> <h4 id=1-history><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#1-history>1. History</a></h4> <p>Wikipedia is good. <a href=https://en.wikipedia.org/wiki/Supercomputer>https://en.wikipedia.org/wiki/Supercomputer</a></p> <h4 id=2-stack><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#2-stack>2. Stack</a></h4> <h5 id=21-hardware><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#21-hardware>2.1. Hardware</a></h5> <p>Storage Network Server Cooler</p> <h5 id=22-software><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#22-software>2.2. Software</a></h5> <p>Infrastructure deployment Parallel Filesystem Workload Management Development</p> <p>Finally, we've got a PPT.</p> <p>但是这个PPT很长，我只能截一些出来。</p> <p><img alt src=/blog/images/20220129131347-1024x470.jpg></p> <p><img alt src=/blog/images/20220129131424-1024x509.jpg></p> <h3 id=hpc2022-02><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#hpc2022-02>HPC增补(2022-02)</a></h3> <p>HPC的生意目前来看还是集成，部分组件可以标准化，但是克雷、富士通、IBM、NVIDIA都有自己的盘子，库也都是为自家架构优化，这些都没有问题，理解。</p> <p>想搞高性能向HPC技术方向学习，也没有问题，但是搞完过后想复制，那就铺人天了。一堆定制设备、一堆专有技术栈，加上已知最好的设备和软件都是国外垄断，生意做着做着就自己就成集成商了。集成商没啥不好，毕竟150W刀一个P的算力，这生意走量。国产化版本堆算力早些年成本差不多两倍，但现在差距在逐步缩小。</p> <p>HPC的生意不好做，进不去圈子，但是汤可以喝，而且大厂们也想喝这个汤，不信你看GPFS都卖给了谁。后来做的纯软裸金属算是产品入局了，但是再往上走适配一个已经很很很完整的生态，想想都觉得累。</p> <h3 id=rdmasap><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#rdmasap>算了，回头把RDMA技术栈补一补，这样或许可以再搞些其他的花样，只是产品化的路没那么好走，但是集成的生意要啥产品化呢，还是要的，你看SAP模块化也厉害的一塌糊涂。</a></h3> <p>title: "构建基于ARM的超算集群" date: 2019-08-26 categories: - "cloud-infra" - "devices" - "hpc"</p> <hr> <h2 id=background><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#background>Background</a></h2> <p>Nowadays ARM-based servers are being applied to many scenarios, so we are going to port some workload to the minimal ARM SoC with NVIDIA GPU to evaluate the feasibility of production usage.</p> <h2 id=preparation><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#preparation>Preparation</a></h2> <p>Hardware: Legacy ARM SoC boards, e.g. Raspberry Pi, Beagle Board, NVIDIA Jetson(GPU) and standard ARM-based servers.</p> <p>MPI: OpenMPICH and MPICH2.</p> <p>Share Storage: ARM-based Glusterfs with pNFS.</p> <p>Application: ANY</p> <h2 id=buildinstallation><a class=toclink href=../../2018/08/13/hpc%E7%9B%B8%E5%85%B3/#buildinstallation>Build/Installation</a></h2> <p>Ref:</p> <p>[1] <a href=https://developer.arm.com/solutions/hpc>https://developer.arm.com/solutions/hpc</a></p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2018-05-23 00:00:00">2018年5月23日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/fpga/ class=md-meta__link>fpga</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=fpga-ft><a href=../../2018/05/23/fpga-ft/ class=toclink>fpga-ft</a></h2> <h3 id=fpgaft-2019-05-26><a class=toclink href=../../2018/05/23/fpga-ft/#fpgaft-2019-05-26>"基于FPGA的物理机容错（FT）或者虚拟机容错设计" "2019-05-26"</a></h3> <h4 id=1-background><a class=toclink href=../../2018/05/23/fpga-ft/#1-background>1. Background</a></h4> <p>Since the MicroBlaze provides the lockstep feature, so finally we can make a POC.</p> <h4 id=2-microblaze-ft-test><a class=toclink href=../../2018/05/23/fpga-ft/#2-microblaze-ft-test>2. MicroBlaze FT Test</a></h4> <h4 id=3-server-ft-test-via-microblaze-ft-controller><a class=toclink href=../../2018/05/23/fpga-ft/#3-server-ft-test-via-microblaze-ft-controller>3. Server FT Test via MicroBlaze FT controller</a></h4> <h4 id=4-qemu-with-colo><a class=toclink href=../../2018/05/23/fpga-ft/#4-qemu-with-colo>4. QEMU with COLO</a></h4> <p>[1] Triple Modular Redundancy: <a href=https://www.xilinx.com/support/documentation/ip_documentation/tmr/v1_0/pg268-tmr.pdf>https://www.xilinx.com/support/documentation/ip_documentation/tmr/v1_0/pg268-tmr.pdf</a></p> <p>[2] Fault Tolerance Technique for Dynamically Reconfigurable Processor: <a href=https://pdfs.semanticscholar.org/2e98/b34ee8736eba7747b223c333de5739a6e601.pdf>https://pdfs.semanticscholar.org/2e98/b34ee8736eba7747b223c333de5739a6e601.pdf</a></p> <p>[3] Xilinx Reduces Risk and Increases Efficiency for IEC61508 and ISO26262 Certified Safety Applications: <a href=https://www.xilinx.com/support/documentation/white_papers/wp461-functional-safety.pdf>https://www.xilinx.com/support/documentation/white_papers/wp461-functional-safety.pdf</a></p> <p>[4] Spartan-6 FPGA Dual-Lockstep MicroBlaze Processor with Isolation Design Flow: <a href=https://www.xilinx.com/support/documentation/application_notes/xapp584-dual-lockstep-microblaze-IDF.pdf>https://www.xilinx.com/support/documentation/application_notes/xapp584-dual-lockstep-microblaze-IDF.pdf</a></p> <p>[5] MicroBlaze Processor Reference Guide: https://www.xilinx.com/support/documentation/sw_manuals/xilinx2019_2/ug984-vivado-microblaze-ref.pdf</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2018-05-23 00:00:00">2018年5月23日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/fpga/ class=md-meta__link>fpga</a></li> <li class=md-meta__item> 需要 3 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=fpga-test><a href=../../2018/05/23/fpga-test/ class=toclink>fpga-test</a></h2> <h3 id=petalinuxpynqqemu-2019-08-22><a class=toclink href=../../2018/05/23/fpga-test/#petalinuxpynqqemu-2019-08-22>"PetaLinux/Pynq中使用QEMU（裸金属探索的路子）" "2019-08-22"</a></h3> <h4 id=background><a class=toclink href=../../2018/05/23/fpga-test/#background>Background</a></h4> <p>Before stepping into the virtio acceleration, we will build and run a Linux(PetaLinux) in FPGA.</p> <p>Despite the poor performance of simulation in X86, it's very convenient to create POC.</p> <p>We choose MPSoC zcu106(PS) to test ARM, Zynq zc702(PS) to test ARM and Kintex UltraScale kcu705(PL) to test MicroBlaze softcore.</p> <h4 id=0-essential-tools><a class=toclink href=../../2018/05/23/fpga-test/#0-essential-tools>0. Essential tools</a></h4> <p>OS: Ubuntu 16.04 Desktop</p> <p>Vivado: 2019.1</p> <p>Xilinx SDK: 2019.1</p> <p>PetalLinux SDK:  PetaLinux 2019.1</p> <p>BSP: Evaluation Board BSP or generated from Vivado/Xilinx SDK</p> <h4 id=1-build-qemu><a class=toclink href=../../2018/05/23/fpga-test/#1-build-qemu>1. Build QEMU</a></h4> <p>QEMU is in the PetaLinux SDK directory, it's not necessary to rebuild if you do not wanna modify anything.</p> <p>git clone git://github.com/Xilinx/qemu.git cd qemu apt install libglib2.0-dev libgcrypt20-dev zlib1g-dev autoconf automake libtool bison flex libpixman-1-dev git submodule update --init dtc ./configure --target-list="aarch64-softmmu,microblazeel-softmmu" --enable-fdt --disable-kvm --disable-xen make -j4</p> <h4 id=2-petalinux-project><a class=toclink href=../../2018/05/23/fpga-test/#2-petalinux-project>2. PetaLinux Project</a></h4> <h5 id=21-create-project><a class=toclink href=../../2018/05/23/fpga-test/#21-create-project>2.1. Create Project</a></h5> <p>petalinux-create -t project -n zcu106_arm_a53 --template zynqMP -s ../bsp/xilinx-zcu106-v2019.1-final.bsp petalinux-config # Decide what to build</p> <p>After the project created, pre-built images is in directory <em>pre-built</em>. You can test it via petalinux-boot</p> <p>petalinux-boot --qemu --prebuilt 3 # Start ZCU106 virtual machine with prebuilt kernel</p> <p>To accelerate the sstate mirror check process, you need download the sstate cache in Ref [5].</p> <p>If you are using petalinux as <strong>root</strong>, you need modify <em>sanity.conf</em> like this:</p> <p>cat /opt/petalinux/v2019.1/components/yocto/source/aarch64/layers/core/meta/conf/sanity.conf</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span></pre></div></td><td class=code><div><pre><span></span><code># Sanity checks for common user misconfigurations
#
# See sanity.bbclass
#
# Expert users can confirm their sanity with &quot;touch conf/sanity.conf&quot;
BB\_MIN\_VERSION = &quot;1.39.1&quot;

SANITY\_ABIFILE = &quot;${TMPDIR}/abi\_version&quot;

SANITY\_VERSION ?= &quot;1&quot;
LOCALCONF\_VERSION  ?= &quot;1&quot;
LAYER\_CONF\_VERSION ?= &quot;7&quot;
SITE\_CONF\_VERSION  ?= &quot;1&quot;

#INHERIT += &quot;sanity&quot;
</code></pre></div></td></tr></table></div> <h5 id=22-build-kernelrootfs><a class=toclink href=../../2018/05/23/fpga-test/#22-build-kernelrootfs>2.2. Build Kernel/Rootfs</a></h5> <h4 id=3-boot-from-qemu><a class=toclink href=../../2018/05/23/fpga-test/#3-boot-from-qemu>3. Boot from QEMU</a></h4> <h5 id=31-debug><a class=toclink href=../../2018/05/23/fpga-test/#31-debug>3.1. Debug</a></h5> <p>petalinux-boot --qemu --prebuilt 3</p> <h5 id=32-run-with-self-compiled-qemu><a class=toclink href=../../2018/05/23/fpga-test/#32-run-with-self-compiled-qemu>3.2. Run with self-compiled-QEMU</a></h5> <h2 id=binbash><a class=toclink href=../../2018/05/23/fpga-test/#binbash>!/bin/bash</a></h2> <p>/root/Desktop/qemu_zynq_devices/qemu/aarch64-softmmu/qemu-system-aarch64 \ -M arm-generic-fdt-7series -machine linux=on -smp 2 -m 1G \ -serial /dev/null -serial mon:stdio -display none \ -kernel /blog/images/linux/uImage -dtb /blog/images/linux/system.dtb</p> <p>Now we'll add sdcard and try to boot Ubuntu Core OS.</p> <p>qemu-img create qemu_sd.img 2G -M arm-generic-fdt-7series -machine linux=on -smp 2 -m 1G \ -serial /dev/null -serial mon:stdio -display none \ -kernel /blog/images/linux/uImage -dtb /blog/images/linux/system.dtb</p> <h4 id=4-co-sim><a class=toclink href=../../2018/05/23/fpga-test/#4-co-sim>4. Co-Sim</a></h4> <h4 id=5-boot-from-evaluation-board-sdcard><a class=toclink href=../../2018/05/23/fpga-test/#5-boot-from-evaluation-board-sdcard>5. Boot from Evaluation Board SDCard</a></h4> <p>Ref:</p> <p>[1] Build QEMU: https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842060/QEMU</p> <p>[2] Zynq UltraScale+ QEMU: https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18841606/QEMU+-+Zynq+UltraScalePlus</p> <p>[3] CoSim: https://xilinx-wiki.atlassian.net/wiki/spaces/A/pages/18842109/QEMU+SystemC+and+TLM+CoSimulation</p> <p>[4] Xilinx Evaluation Board BSP files and Yocto local mirror: https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/embedded-design-tools.html</p> <hr> <h3 id=xilinx-pynqoverlay-2020-04-14><a class=toclink href=../../2018/05/23/fpga-test/#xilinx-pynqoverlay-2020-04-14>"Xilinx Pynq的overlay网络测试" "2020-04-14"</a></h3> <h4 id=1-preparation><a class=toclink href=../../2018/05/23/fpga-test/#1-preparation>1. Preparation</a></h4> <p><a href=https://github.com/Xilinx/PYNQ-Networking>https://github.com/Xilinx/PYNQ-Networking</a></p> <h4 id=2-build><a class=toclink href=../../2018/05/23/fpga-test/#2-build>2. Build</a></h4> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-10-26 00:00:00">2017年10月26日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2017/10/26/%E5%A4%87%E4%BB%BD%E5%B7%A5%E5%85%B7%E8%BF%81%E4%BA%91%E5%BF%85%E5%A4%87/ class=toclink>备份工具（迁云必备）</a></h2> <ul> <li> <p>UrBackup <a href=https://www.urbackup.org/features.html>https://www.urbackup.org/features.html</a> </p> </li> <li> <p>Amanda <a href=http://amanda.zmanda.com/ >http://amanda.zmanda.com/</a> </p> </li> <li> <p>Bacula <a href=https://blog.bacula.org/ >https://blog.bacula.org/</a> </p> </li> <li> <p>BareOS <a href=https://www.bareos.org>https://www.bareos.org</a> </p> </li> <li> <p>Duplicati <a href=https://www.duplicati.com>https://www.duplicati.com</a> </p> </li> <li> <p>kvmBackup <a href=https://github.com/bioinformatics-ptp/kvmBackup>https://github.com/bioinformatics-ptp/kvmBackup</a></p> </li> </ul> <p>直接说结论吧，使用下来，UrBackup与Duplicati是较为合适的两个选择。</p> <p>UrBackup采用传统的CS架构，对全平台提供支持，备份选项较为丰富，而且支持公网中继； Duplicati则是较为轻量级的选择，只要安装agent即可，支持备份目标地址较为丰富，除了传统接口外也支持AWS S3接口； Bacula与BareOS（前者变种）属于同一体系，但后者支持更好广泛些； Amanda除了硬盘文件备份，也多了一个MySQL数据库的备份产品； 最后一个KVMBackup则是一个脚本，限制比较多，适合单纯的KVM环境备份。</p> <p>如果与ZStack对接，这俩都可以，备份存储地址可以选择FTP，这样就可以直接使用ZStack的ZStore镜像存储，格式使用raw，然后就直接启动了。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-10-22 00:00:00">2017年10月22日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/abm/ class=md-meta__link>abm</a>, <a href=../../category/modeling/ class=md-meta__link>modeling</a></li> <li class=md-meta__item> 需要 12 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ class=toclink>外汇学习笔记</a></h2> <p>早先把书的内容过了一遍，现在打算把书中的模型统统实现并做相应介绍。</p> <h3 id=agent-based-modeling-strategy-in-forex-trading-market><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#agent-based-modeling-strategy-in-forex-trading-market>Agent based modeling Strategy in forex trading market</a></h3> <h4 id=preface><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#preface>PREFACE</a></h4> <p>Since I've tested S1, S2, and S3 from the <a href=https://datanote.readthedocs.io/zh/latest/ >DATANOTE</a>. However, it was not so good or in other words, identical with expectation. It's time to make a change.</p> <h4 id=basic-model-and-architecture><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#basic-model-and-architecture>BASIC MODEL AND ARCHITECTURE</a></h4> <p>As you can see from my last articles, <a href=https://blog.lofyer.org/the-forex-quantum-trade-system-and-infrastructure/ >the architecture's infrastructure</a> is about to go and the <a href=https://blog.lofyer.org/%E5%9F%BA%E4%BA%8E%E5%A4%96%E6%B1%87%E5%B8%82%E5%9C%BA%E6%8A%80%E6%9C%AF%E6%8C%87%E6%A0%87%E7%9A%84abm%E5%BB%BA%E6%A8%A1/ >agent's protocol</a> is well defined. Now what we should do is to combine them together.</p> <p>In the first phase, the simulation will JUST be a Netlogo program. If the performance is just like S1-3, then it goes to phase 2 ---- treating the agents as the real from the data gained and strategy trained from the real world. And if NOT, less probable, the program must be corrected.</p> <h4 id=practical-guide><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#practical-guide>PRACTICAL GUIDE</a></h4> <h5 id=1-fake-world-fake-agent><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#1-fake-world-fake-agent>1. FAKE WORLD, FAKE AGENT</a></h5> <h5 id=2-real-world-fake-agent><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#2-real-world-fake-agent>2. REAL WORLD, FAKE AGENT</a></h5> <h5 id=3-real-world-real-agent><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#3-real-world-real-agent>3. REAL WORLD, REAL AGENT</a></h5> <p>World3 Model is a choice.(System Dynamics)</p> <h3 id=httpsinsightmakercominsight1954the-world3-model-a-detailed-world-forecaster><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#httpsinsightmakercominsight1954the-world3-model-a-detailed-world-forecaster>https://insightmaker.com/insight/1954/The-World3-Model-A-Detailed-World-Forecaster</a></h3> <p>title: "Forex data collection and backtesting with python/netlogo" date: 2017-03-13 categories: - "signal-system"</p> <hr> <p>These two sites provides free forex tick/time data. So before getting into backtesting, we must get data.</p> <p>I provide two scripts for you to download and update these data daily.</p> <p>OK, it's boring...</p> <p><a href=http://github.com/lofyer/forex-data>http://github.com/lofyer/forex-data</a></p> <p>However, there's still some work to update our data every day/week.</p> <p>Like this:</p> <p>TBD</p> <p>For the next, we'll try to apply basic strategy to backtest our data.</p> <p>Like this:</p> <h3 id=forex-data-ml-relationship><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#forex-data-ml-relationship>Forex Data ML Relationship</a></h3> <p>Data Processing with ML</p> <p>Data Overview: 1. Forex Index &lt;-&gt; Currency Rate Change 2. News -&gt; Classification -&gt; Weight &lt;-&gt; Currency Rate Change</p> <p>Caution: Strict Time Based Data pipeline.</p> <h3 id=python><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#python>外汇常用技术指标算法（附Python量化分析教程）</a></h3> <p>公式不好写，写到DataNote里吧。</p> <h2 id=bill-williams-indicators><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#bill-williams-indicators>Bill Williams Indicators</a></h2> <p><strong>Accelerator/Decelerator oscillator（AC）</strong></p> <p>Acceleration/Deceleration (AC) technical indicator signals the acceleration or deceleration of the current market driving force.</p> <p><em>How to Use Acceleration/Deceleration</em></p> <p>The indicator is fluctuating around a median 0.00 (zero) level which corresponds to a relative balance of the market driving force with the acceleration. Positive values signal a growing bullish trend, while negative values may be qualified as a bearish trend development. The indicator changes its direction before any actual trend reversals take place in the market therefore it serves as an early warning sign of probable trend direction changes. The indicator color changes alone are very important as the current green line (irrespectively of the value) warns against long positions the same way as the red one would against selling. To enter the market along with its driving force one needs to watch for both value and color. Two consecutive green columns above the zero level would suggest you to enter the market with a long position while at least two red columns below the zero level might be taken for a command to go short. Fake signals prevail in timeframes smaller than 4 hours.</p> <p><em>Acceleration/Deceleration Oscillator Formula (Calculation)</em></p> <p>AC bar chart is the difference between the value of 5/34 of the driving force bar chart and 5-period simple moving average, taken from that bar chart.</p> <p>AO = SMA(median price, 5)-SMA(median price, 34) AC = AO-SMA(AO, 5)</p> <p>--------------------------------------------------------------------------- <strong>Alligator</strong></p> <p>Alligator is an indicator designed to signal a trend absence, formation and direction. Bill Williams saw the alligator's behavior as an allegory of the market's one: the resting phase is turning into the price-hunting as the alligator awakes so that to come back to sleep after the feeding is over. The longer the alligator is sleeping the hungrier it gets and the stronger the market move will be.</p> <p><em>How to Use Alligator Indicator</em></p> <p>The Alligator indicator consists of 13-, 8- and 5-period smoothed moving averages shifted into the future by 8, 5 and 3 bars respectively which are colored blue, red and green representing the alligator’s jaw, teeth and lips. The Alligator is resting when the three averages are twisted together progressing in a narrow range. The more distant the averages become, the sooner the price move will happen. The averages continuing in an upward direction (green followed by red and blue) suggest an emerging uptrend which we interpret as a signal to buy. The averages following each other in the reversed order down the slope are a strong signal of an unfolding downtrend so selling at this point would be more than appropriate.</p> <p>Alligator Indicator Formula (Calculation)</p> <p>MEDIAN PRICE = (HIGH + LOW) / 2 ALLIGATORS JAW = SMMA (MEDEAN PRICE, 13, 8) ALLIGATORS TEETH = SMMA (MEDEAN PRICE, 8, 5) ALLIGATORS LIPS = SMMA (MEDEAN PRICE, 5, 3)</p> <p>--------------------------------------------------------------------------- <strong>Awesome oscillator（AO）</strong></p> <p>Awesome Oscillator (AO) is a momentum indicator reflecting the precise changes in the market driving force which helps to identify the trend’s strength up to the points of formation and reversal.</p> <p><em>How to Use Awesome Oscillator</em></p> <p>There are three main signals which may be seen: Saucer - three consecutive columns above the nought line the first two of which must be colored red (the second one is lower than the first one) while the third one is colored green and higher than the previous (second) one. Such a formation would be a clear Buy signal whilst inverted and vertically flipped formation would serve as a Sell signal. Nought line crossing - the histogram crosses the naught line in an upward direction changing its values from negative to that of positive ones. In this situation we have a Buy signal. The Sell signal would be a reversed pattern. Two pikes - the indicator displays a Buy signal when the figure is formed by two consecutive pikes both of which are below the naught line and the later-formed pike is closer to the zero level than the earlier-formed one. The Sell signal would be given by the reverse formation.</p> <p><em>Awesome Oscillator Trading Strategy</em></p> <p>Awesome Oscillator Strategy includes 3 ways of trading. The first way is to open a sell position when the oscillator is below the zero line forming a peak, and open a buy position when the oscillator is above the zero line forming a gap. Another way is to open a sell position when the oscillator forms two peaks above the zero line, where the second high is lower than the previous one. And, conversely, traders watch to open a buy position when the oscillator forms to lows below the zero line with the last one not as low as the previous one. The third way is to account crossing the zero line. When the oscillator crosses it from up to down, it is time to open a sell position and when it crosses from down to up, it is time to open a buy position.</p> <p><em>Awesome Oscillator Formula (Calculation)</em></p> <p>Awesome Oscillator is a 34-period simple moving average, plotted through the central points of the bars (H+L)/2, and subtracted from the 5-period simple moving average, graphed across the central points of the bars (H+L)/2. MEDIAN PRICE = (HIGH+LOW)/2 AO = SMA(MEDIAN PRICE, 5)-SMA(MEDIAN PRICE, 34) where SMA — Simple Moving Average.</p> <p>--------------------------------------------------------------------------- <strong>Fractal Indicator Definition</strong></p> <p>Fractals is an indicator highlighting the chart’s local heights and lows where the price movement had stopped and reversed. These reversal points are called respectively Highs and Lows. How to Use Fractal Indicator</p> <p>Bill Williams' Fractals are formed around a group of five consecutive bars the first two of which are successively reaching higher (or diving deeper) and the last two descending lower (or growing higher) with the middle one being the highest (or the lowest) result in the group accordingly. Buy fractal is an arrow pointing to the top Sell fractal is an arrow pointing to the bottom -------------------------------------------------------------------------- <strong>Gator Oscillator Definition</strong></p> <p>The Gator Oscillator (GO) is a supplement to the Alligator indicator and is used alongside with it showing the absolute degree of convergence/divergence of the Alligator's three SMAs pointing at the Alligator's periods of slumber and awakeness (i.e. trending and non-trending market phases). How to Use Gator Oscillator</p> <p>Being an oscillator in the form of two histograms built on either side of the naught line, the Gator Oscillator plots the absolute difference between the Alligator’s Jaw and Teeth (blue and red lines) in the positive area and the absolute difference between the Alligator’s Teeth and Lips (red and green lines) in the negative area. The histogram’s bars are colored green if exceeding the previous bar’s volume or red if falling short. The bars of the extreme values are in tune with the strong trend forces. The Alligator's activity periods are divided into the following four: Gator awakes - the bars on different sides of the naught line are colored differently. Gator eats - green bars on both sides of the naught line. Gator fills out - single red bar during the "eating" phase. Gator sleeps - the bars on both sides are red -------------------------------------------------------------------------- Market Facilitation Index Definition</p> <p>The Market Facilitation Index is designed for evaluation the willingness of the market to move the price. The indicator's absolute values alone cannot provide any trading signals unlike it's dynamics in relation to the dynamics of the volume. How to Use Market Facilitation Index</p> <p>The absolute values of the index are represented by the histogram's bars while the comparison of the index and volume dynamics are given in colors which are vital in terms of reading the indicator signs. Green bar - both MFI and volume are up. Increasing trading activity means market movement acceleration. We may join the trend. Blue bar - MFI indicator is up, volume is down. The movement is continuing although the volume has dropped. The trend will soon be reversing. Pink bar - MFI indicator is down, volume is up. The slowing down movement while volume is raising may indicate a possible break through, often a U-turn. Brown bar - both MFI and volume are down. The market is no longer interested in the current direction and is looking for signs of a future development. Market Facilitation Index Market Facilitation Index (BW MFI) Market Facilitation Index Formula (Calculation)</p> <p>BW MFI = (HIGH-LOW)/VOLUME --------------------------------------------------------------------------</p> <h2 id=oscilators><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#oscilators>Oscilators</a></h2> <h2 id=trend-indicators><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#trend-indicators>Trend Indicators</a></h2> <h2 id=volume-indicators><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#volume-indicators>Volume Indicators</a></h2> <p><strong>Accumulation/Distribution（AD）</strong></p> <p>Accumulation/Distribution is a volume-based technical analysis indicator designed to reflect cumulative inflows and outflows of money for an asset by comparing close prices with highs and lows and weighting the relation by trading volumes.</p> <p><em>How to Use Accumulation/Distribution</em></p> <p>The Accumulation/Distribution line is used for trend confirmation or possible turning points identification purposes. Trend confirmation: An uptrend in prices is confirmed if A/D line is rising; A downtrend in prices is confirmed if A/D line is falling. Divergence pattern analysis: Rising A/D line along with decreasing prices indicates the downtrend may be weakening to a bullish reversal; Falling A/D along with rising prices indicates the uptrend may be weakening to a bearish reversal.</p> <p><em>Accumulation/Distribution Indicator Formula (Calculation)</em></p> <p>A/D(t) = [((C – L) – (H – C)) / (H – L)] x Vol + A/D(t-1), where: A/D(t) – current Accumulation/Distribution value; A/D(t-1) – previous Accumulation/Distribution value; H – current high; L – current low; C – close price; Vol – volume.</p> <p>---------------------------------------------------------------------------</p> <p><strong>Average Directional Movement Index（ADX）</strong></p> <p>Average Directional Index (ADX) is a technical indicator developed by Welles Wilder to estimate trend strength and determine probable further price movements by comparing the difference between two consecutive lows with the difference between the highs.</p> <p><em>How to Use ADX Indicator</em></p> <p>ADX is a complex indicator, which results from calculation of the Plus Directional Indicator (+DI – green line) and the Minus Directional Indicator (-DI – red line), but all of them may be used for trend analysis.</p> <p>In general the indicator (bold line) move is believed to reflect current trend strength: Rising ADX (usually climbing above 25) suggests strengthening market trend – trend following indicators are becoming more useful; Falling ADX suggests the trend development is doubtful. ADX values below 20 may indicate neutral trend is present – oscillators are becoming more useful. Use of complex ADX trading system may require additional confirmation signals: Normally if +DI (green line) climbs above -DI (red line), a buy signal is generated; Normally if -DI climbs above +DI, a sell signal is generated. Average Directional Index Indicator - ADX Indicator Average Directional Index (ADX) Indicator</p> <p><em>ADX Trading Strategy</em></p> <p>ADX trading strategy aims to identify the strongest trends and distinguish between trending and non-trending conditions. ADX reading above 25 indicates trend strength, while when ADX is below 25, this shows trend weakness. Breakouts, which are not difficult to spot, also help to identify whether ADX is strong enough for the price to trend or not. Thus, when ADX rises from below 25 to above 25, trend is considered strong enough to continue in the direction of the breakout. It’s a common misperception that when ADX line starts falling this is a sign of trend reversal. Whereas, it only means that the trend strength is weakening. As long as ADX is above 25, it should be considered that a falling ADX line is simply less strong.</p> <p>ADX Formula (Calculation)</p> <p>ADX = MA [((+DI) – (-DI)) / ((+DI) + (-DI))] x 100; where: +DI – Plus Directional Indicator; -DI – Minus Directional Indicator.</p> <p>---------------------------------------------------------------------------</p> <p><strong>Average True Range（ATR）</strong> --------------------------------------------------------------------------- <strong>Bears Power</strong> --------------------------------------------------------------------------- <strong>Bollinger Bands</strong> --------------------------------------------------------------------------- <strong>Bulls Power</strong> --------------------------------------------------------------------------- <strong>Commodity Channel Index（CCI）</strong> --------------------------------------------------------------------------- <strong>DeMarker</strong> --------------------------------------------------------------------------- <strong>Envelopes</strong> --------------------------------------------------------------------------- <strong>Force</strong> --------------------------------------------------------------------------- <strong>Fractals</strong> --------------------------------------------------------------------------- <strong>Gator oscillator</strong> --------------------------------------------------------------------------- <strong>Ichimoku Kinko Hyo</strong> --------------------------------------------------------------------------- <strong>Market Facilitation Index（BWMFI）</strong> --------------------------------------------------------------------------- <strong>Momentum</strong> --------------------------------------------------------------------------- <strong>Money Flow Index</strong> --------------------------------------------------------------------------- <strong>移动平均线（Moving Average，MA）</strong></p> <p>MA=N日收市价之和／N 一般N可取短期5或10天，也可是30、65、200、280等中长期。</p> <p>Moving Average is a technical analysis tool that shows average price over a given period of time, which is used to smoothen price fluctuations and therefore to determine trend direction and strength. Depending of the method of averaging, distinguish between simple moving average (SMA), smoothed moving average (SMMA) and exponential moving average (EMA).</p> <p><em>Moving Average Trading Strategy</em></p> <p>Moving average strategy is essentially a trend following means. Its objective is to signal the beginning of a new trend or a trend reversal. Herein, its main purpose is to track the progress of the trend and not to predict market action in the same sense that technical analysis attempts to do. By its nature, Moving Average is a follower; it follows the market telling that a new trend has begun or reversed only after the fact.</p> <p><em>Moving Average Formula (Calculation)</em></p> <p>SMA = Sum (Close (i), N) / N, where: Close (i) – current close price; N – period of averaging. EMA(t) = EMA(t-1) + (K x [Close(t) – EMA(t-1)]), where: t – current period; K = 2 / (N + 1), N – period of averaging.</p> <p><em>How to Use Moving Average</em></p> <p>Generally moving average curves analysis includes the following principles: Direction of moving average curve reflects prevailing trend over a period; Low-period averaging may give more false signals, while large-period averaging tend to be lagging; To increase (decrease) sensitivity of the curve one should decrease (increase) the period of averaging; Average curves are more useful in trending environment.</p> <p>Comparing moving average with price movements: A strong buy (sell) signal arise if price crosses from below (from above) its rising (falling) moving average curve; A weak buy (sell) signal arise if price crosses from below (from above) its falling (rising) moving average curve. Comparing moving average curves of different periods: A rising (falling) lower-period curve crossing from below (above) another rising (falling) longer-period curve gives a strong buy (sell) signal; A rising (falling) lower-period curve crossing from below (above) another falling (rising) longer-period curve gives a weak buy (sell) signal. --------------------------------------------------------------------------- <strong>Moving Average of Oscillator</strong> --------------------------------------------------------------------------- <strong>抛物线转向（Stop And Reverse）</strong></p> <p>SAR（n）=SAR（n－1）+AF*[EP(n-1)-SAR(n-1)]</p> <p>其中：SAR（n）为第n日的SAR值，SAR（n－1）为第（n－1）日的值；AF为加速因子（或叫加速系数），EP为极点价（最高价或最低价）。</p> <h2 id=-coding-utf-8-><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#-coding-utf-8->-*- coding: utf-8 -*-</a></h2> <p>""" http://virtualizedfrog.wordpress.com/ 2014</p> <p>Translated from http://www.amibroker.com/library/detail.php?id=268 Requires pandas to load csv files, and matplotlib to chart the data</p> <p>The main expects table.csv file. Valid files can be downloaded on Yahoo Finance eg: http://real-chart.finance.yahoo.com/table.csv?s=%5EGSPC&amp;ignore=.csv """</p> <p>import pandas as pd from datetime import datetime import matplotlib.pyplot as plt</p> <p>def psar(barsdata, iaf = 0.02, maxaf = 0.2): length = len(barsdata) dates = list(barsdata['Date']) high = list(barsdata['High']) low = list(barsdata['Low']) close = list(barsdata['Close']) psar = close[0:len(close)] psarbull = [None] * length psarbear = [None] * length bull = True af = iaf ep = low[0] hp = high[0] lp = low[0]</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span></pre></div></td><td class=code><div><pre><span></span><code>for i in range(2,length):
    if bull:
        psar\[i\] = psar\[i - 1\] + af \* (hp - psar\[i - 1\])
    else:
        psar\[i\] = psar\[i - 1\] + af \* (lp - psar\[i - 1\])

    reverse = False

    if bull:
        if low\[i\] &lt; psar\[i\]:
            bull = False
            reverse = True
            psar\[i\] = hp
            lp = low\[i\]
            af = iaf
    else:
        if high\[i\] &gt; psar\[i\]:
            bull = True
            reverse = True
            psar\[i\] = lp
            hp = high\[i\]
            af = iaf

    if not reverse:
        if bull:
            if high\[i\] &gt; hp:
                hp = high\[i\]
                af = min(af + iaf, maxaf)
            if low\[i - 1\] &lt; psar\[i\]:
                psar\[i\] = low\[i - 1\]
            if low\[i - 2\] &lt; psar\[i\]:
                psar\[i\] = low\[i - 2\]
        else:
            if low\[i\] &lt; lp:
                lp = low\[i\]
                af = min(af + iaf, maxaf)
            if high\[i - 1\] &gt; psar\[i\]:
                psar\[i\] = high\[i - 1\]
            if high\[i - 2\] &gt; psar\[i\]:
                psar\[i\] = high\[i - 2\]

    if bull:
        psarbull\[i\] = psar\[i\]
    else:
        psarbear\[i\] = psar\[i\]

return {dates:dates, high:high, low:low, close:close, psar:psar, psarbear:psarbear, psarbull:psarbull}
</code></pre></div></td></tr></table></div> <p>if __name__ == "__main__": import sys import os</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span></pre></div></td><td class=code><div><pre><span></span><code>if len(sys.argv) &lt; 2:
    sys.exit(&quot;Usage: %s datafile.csv&quot; % sys.argv\[0\])
if not os.path.exists(sys.argv\[1\]):
    sys.exit(&quot;Error: can&#39;t open file &#39;%s&#39;: No such file&quot; % sys.argv\[1\])

barsdata = pd.read\_csv(sys.argv\[1\])
#Reindex the data: ascending dates are expected in the function
barsdata = barsdata.reindex(index=barsdata.index\[::-1\])
#Convert strings to actual timestamps
barsdata\[&#39;Date&#39;\] = \[datetime.strptime(x, &#39;%Y-%m-%d&#39;) for x in barsdata\[&#39;Date&#39;\]\]

startidx = 0
endidx = len(barsdata)

result = psar(barsdata)
dates = result\[&#39;dates&#39;\]\[startidx:endidx\]
close = result\[&#39;close&#39;\]\[startidx:endidx\]
psarbear = result\[&#39;psarbear&#39;\]\[startidx:endidx\]
psarbull = result\[&#39;psarbull&#39;\]\[startidx:endidx\]

plt.plot(dates, close)
plt.plot(dates, psarbull)
plt.plot(dates, psarbear)
plt.grid()
plt.show()
</code></pre></div></td></tr></table></div> <p>动向指标（DMI） --------------------------------------------------------------------------- <strong>Moving Averages Convergence/Divergence（MACD）</strong> --------------------------------------------------------------------------- On Balance Volume（OBV） --------------------------------------------------------------------------- 相对强弱指标（Relative Strength Index，RSI） --------------------------------------------------------------------------- Relative Vigor Index（RVI） --------------------------------------------------------------------------- 漫步随机指标（Random Walk Index,RWI） --------------------------------------------------------------------------- Standard Deviation（StdDev） --------------------------------------------------------------------------- Stochastic Oscillator --------------------------------------------------------------------------- Larry Williams' Percent Range（WPR） --------------------------------------------------------------------------- <a href=http://blog.lofyer.org/wp-content/uploads/python-quant-uqer.pdf>Python量化分析中文</a></p> <h3 id=get-ready-for-forex><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#get-ready-for-forex>Get ready for forex</a></h3> <p>这个月书的样章要完结，还有一篇稿要写。</p> <p>偶然看到高频交易，加上之前对股市的自动交易感兴趣，然后偶然看到外汇交易，metatrader，看到他们的交易策略，我就燃了。（亏）新手轻虐。</p> <p>Scott E.Page是个好老师。</p> <p>节奏要加快，再快，再快点。</p> <h2 id=abm><a class=toclink href=../../2017/10/22/%E5%A4%96%E6%B1%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#abm>基于外汇市场技术指标的ABM建模</a></h2> <p>本模型的最终模拟期望是随机，我想试试。</p> <p>货币对作为agent，这样仅需要个位数以内；</p> <p>货币对本身不拥有市场价值，初始值为此货币对相对于eurusd的比值；</p> <p>agent拥有自己的技术指标，这个指标尽量在一定范围内震荡；</p> <p>agent行动时，随之变化的指标会影响其他agent的行动；</p> <p>patch横向分层，高中低区，agent的行动只在patch间行动；</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-07-15 00:00:00">2017年7月15日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a>, <a href=../../category/draft/ class=md-meta__link>draft</a></li> <li class=md-meta__item> 需要 7 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/ class=toclink>云计算笔记</a></h2> <hr> <h3 id=use-dhcp-or-dnsmasq-as-dhcp-server-in-libvirt-based-environment-2015-08-26><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#use-dhcp-or-dnsmasq-as-dhcp-server-in-libvirt-based-environment-2015-08-26>"Use dhcp or dnsmasq as DHCP server in libvirt-based environment" "2015-08-26"</a></h3> <p>Default dhcp and dnsmasq are conflict in a OS. Just change to another if one failed.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code># yum install dhcp
</code></pre></div></td></tr></table></div> <p>/etc/sysconfig/dhcpd is no longer needed in RHEL-7. However, it is still working in other distributions. <strong>Just assign an IP to the interface which in the subnet you want dhcp serve</strong>.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span></pre></div></td><td class=code><div><pre><span></span><code>[root@localhost ~]# vi /etc/sysconfig/dhcpd
DHCPDARGS=&quot;eth0 eth1&quot;;

[root@localhost ~]# yum -y install dhcp
[root@localhost ~]# vi /etc/dhcp/dhcpd.conf
# create new
# specify domain name
option domain-name &quot;example.com&quot;;
# specify name server&#39;s hostname or IP address
option domain-name-servers dhcp.example.com;
# default lease time
default-lease-time 600;
# max lease time
max-lease-time 7200;
# this DHCP server to be declared valid
authoritative;
# specify network address and subnet mask
subnet 10.0.0.0 netmask 255.255.255.0 {
    # specify the range of lease IP address
    range dynamic-bootp 10.0.0.200 10.0.0.254;
    # specify broadcast address
    option broadcast-address 10.0.0.255;
    # specify default gateway
    option routers 10.0.0.1;
    optiondomain-name-servers 192.168.188.11, 192.168.188.12
}
[root@localhost ~]# systemctl start dhcpd 
[root@localhost ~]# systemctl enable dhcpd 
ln -s &#39;/usr/lib/systemd/system/dhcpd.service&#39; &#39;/etc/systemd/system/multi-user.target.wants/dhcpd.service&#39;
</code></pre></div></td></tr></table></div> <p><code>Dnsmasq</code> is very useful in libvirt/qemu/docker based environment. To bind 192.168.200.0/24 to interface br0(192.168.200.22-bridge2eth1):</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div><pre><span></span><code>#!/bin/bash
/usr/sbin/dnsmasq --strict-order --pid-file=/var/run/libvirt/network/br0--conf-file= --except-interface lo --bind-interfaces br0 --listen-address 192.168.200.22 --dhcp-range 192.168.200.2,192.168.200.254 --dhcp-leasefile=/var/lib/libvirt/dnsmasq/br0.leases --dhcp-lease-max=253 --dhcp-no-override --dhcp-hostsfile=/var/lib/libvirt/dnsmasq/br0.hostsfile --addn-hosts=/var/lib/libvirt/dnsmasq/br0.addnhosts
</code></pre></div></td></tr></table></div> <hr> <h3 id=kvm-2015-09-18><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#kvm-2015-09-18>"《KVM私有云架构设计与实践》目录" "2015-09-18"</a></h3> <p>书籍目前已出版，购买链接在下文提供，也可直接联系作者购买，微信lofyer_org。</p> <p><a href=http://product.dangdang.com/25074443.html>当当</a> <a href="https://www.amazon.cn/%E7%A7%81%E6%9C%89%E4%BA%91%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E8%92%8B%E8%BF%AA/dp/B07143VQ2M/ref=sr_1_1?ie=UTF8&qid=1495023849&sr=8-1&keywords=kvm%E7%A7%81%E6%9C%89%E4%BA%91">亚马逊</a> <a href="https://search.jd.com/Search?keyword=kvm%E7%A7%81%E6%9C%89%E4%BA%91&enc=utf-8&wq=kvm%E7%A7%81%E6%9C%89%E4%BA%91&pvid=fab47274675745f28319953ba27d24c5">京东</a></p> <p><a href=https://blog.lofyer.org/wp-content/uploads/21495029670_.pic_.jpg><img alt src=/blog/images/21495029670_.pic_-1024x1024.jpg></a></p> <hr> <h3 id=openstack-2017-05-05><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#openstack-2017-05-05>"OpenStack自动化部署与高可用虚拟控制节点设计" "2017-05-05"</a></h3> <p>为了大家的部署方便与维护着想，我决定把这俩东西再完善一下然后再把实现源码放出来，虽不能做到产品级但是也能对付很多场景了。</p> <p>自动部署（类似mirantis但更友好） 0. livecd+独立配置分区 1. 环境配置 2. PXE安装 3. 自动化脚本</p> <p>Hosted-crotroller（控制节点虚拟化） 1. etcd 2. 健康检查与评分 3. 脑裂防护 4. 使用Paxos写事务机制，如果时间差机制不工作的话。</p> <p>下面给大家简单解释一Paxos和时间差机制的原理（解释的不够到位，有兴趣的看实现吧）：</p> <ol> <li>Paxos，原文可参考<a href=https://www.quora.com/Distributed-Systems-What-is-a-simple-explanation-of-the-Paxos-algorithm>https://www.quora.com/Distributed-Systems-What-is-a-simple-explanation-of-the-Paxos-algorithm</a></li> </ol> <p><strong>此场景实用于一写多。</strong></p> <p>两人结婚，牧师问他俩，“你们愿意吗？”，“我愿意”，“我愿意”。 那么OK，就结了。</p> <p>这时候假如有一对姐妹同时喜欢一个男的，牧师问他仨，“你们愿意吗”，“我愿意”，“我愿意”，“我愿意”。 如果这样，那么男的就能娶俩，如果任何一个没回答，那抱歉了一个都娶不成。</p> <p>在实现时，主节点问下面节点，我要给你们都写个东西，你们都准备好没？“好了”，“好了”，“好了”，“没好”。 75%（&gt;50%）（Quorum）的人都准备好了，那么我就写了，没准备好的那个我记住你了。</p> <ol> <li>Paxos时间差机制（sanlock变种） <strong>这个机制我设计成只针对这个场景的，要求时间同步至数秒级别（这要求已经极低了。。），多写一，也可以扩展。</strong></li> </ol> <p>控制节点要你们去存储上填个表格，你们现在都能写，对吧？“对”，“对”，“对”，“不能”。。 OK，不能的那个我记住你了，其他人都来写吧。</p> <p>控制节点看看表，再看看这个地方之前记的时间，嗯，过去2分钟了，写一下，我在A身上跑着； 然后A看看表，再看看这个地方之前记的时间，嗯，还没过去2分钟，不写，之前体检合格，控制节点在我身上； 然后B看看表，再看看这个地方之前记的时间，嗯，过去2分钟了，签个到留个时间，体检优秀； 然后C看看表，再看看这个地方之前记的时间，嗯，过去2分钟了，签个到留个时间，体检合格；</p> <p>然后控制节点每隔1分钟看一下，嗯，你们都很健康。 又过了3分钟，哎？那个C你没写啊，去跟D站一起。</p> <p>忽然，大家在填表的时候发现，控制节点都过了3分钟没写了，B就启动一下控制节点。 A发现自己与外界失去联系，就把自己身上都控制节点关了，等待救援。</p> <ol> <li>基于etcd的时间差机制 <strong>上述的简化版，填的表格更少，时间差一致</strong> 大家一起写etcd的那个地方。“好”，“好”，“好”。 哎？C你没写，再见。 哎？控制节点呢？来A你检查一下启一下控制节点，B现在状态不佳。 由于控制节点之前在你A上，它现在不行了，扣A个10分，现在分没B高啊。 A你清理下现场让B去启动吧。</li> </ol> <h3 id=_2><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#_2>试图设计一个任何场景都能应对的功能。</a></h3> <p>title: "Openstack 配置及其API的简单使用" date: 2013-07-18 categories: - "cloud-infra"</p> <hr> <h3 id=neutronquantum><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#neutronquantum>安装除Neutron（Quantum）以外所有东西</a></h3> <p>在开始之前，假设有三个NIC</p> <p>禁用selinux，并修改网络配置/etc/sysconfig/network-scripts/ifcfg-ethX</p> <h2 id=internal><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#internal>Internal</a></h2> <p>DEVICE=eth0 TYPE=Ethernet BOOTPROTO=static IPADDR=192.168.1.11 NETMASK=255.255.255.0 GATEWAY=192.168.1.1 DNS1=192.168.1.1 DEFROUTE=yes ONBOOT=yes</p> <h2 id=external><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#external>External</a></h2> <p>DEVICE=eth1 TYPE=Ethernet BOOTPROTO=static IPADDR=192.168.1.12 NETMASK=255.255.255.0 DEFROUTE=yes ONBOOT=yes</p> <h2 id=public-bridge><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#public-bridge>Public Bridge</a></h2> <p>DEVICE=eth2 TYPE=Ethernet BOOTPROTO=static IPADDR=192.168.1.13 NETMASK=255.255.255.0 DEFROUTE=yes ONBOOT=yes</p> <p>于Feodra18中安装Openstack，可参考文档，按照这个来的话对Openstack的设计理念将会有所了解 <a href=https://fedoraproject.org/wiki/Getting_started_with_OpenStack_on_Fedora_18 title="Getting started with OpenStack on Fedora 18">Getting started with OpenStack on Fedora 18</a> 或者运行</p> <p>/<em>安装完成后管理员界面为http://localhost/dashboard用户名admin，密码secrete</em>/</p> <h2 id=openstack-demo-install><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#openstack-demo-install>openstack-demo-install</a></h2> <p>以上两种方法把除了Neutron（quantum）其他的服务都配置好了，关于quantum的配置见文末</p> <h3 id=_3><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#_3>添加虚拟机实例</a></h3> <p>可参考文档 <a href=https://fedoraproject.org/wiki/Getting_started_with_OpenStack_on_Fedora_18 title="Getting started with OpenStack on Fedora 18">Getting started with OpenStack on Fedora 18</a> 在终端操作之前需要设置环境变量，将它们两者之一写到一个文件，然后source一下</p> <p>export OS_USERNAME=admin export OS_PASSWORD=secrete export OS_TENANT_NAME=admin export OS_AUTH_URL=http://127.0.0.1:5000/v2.0/</p> <p>export ADMIN_TOKEN=<span class=arithmatex>\((openssl rand -hex 10) export SERVICE_ENDPOINT=http://127.0.0.1:35357/v2.0/ export SERVICE_TOKEN=\)</span>ADMIN_TOKEN</p> <p>source FileA</p> <p>这个libvirt支持kvm以及xen虚拟化，所以支持的镜像也比较多，这里下载一个已经安装好的f17的qcow2镜像</p> <h2 id=axel-n-5-httpberrangefedorapeopleorgblogimages2012-11-15f17-x86_64-openstack-sdaqcow2><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#axel-n-5-httpberrangefedorapeopleorgblogimages2012-11-15f17-x86_64-openstack-sdaqcow2>axel -n 5 http://berrange.fedorapeople.org//blog/images/2012-11-15/f17-x86_64-openstack-sda.qcow2</a></h2> <p>/<em>注册镜像</em>/</p> <h2 id=glance-add-namef17-jeos-is_publictrue-disk_formatqcow2-container_formatbare-f17-x86_64-openstack-sdaqcow2><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#glance-add-namef17-jeos-is_publictrue-disk_formatqcow2-container_formatbare-f17-x86_64-openstack-sdaqcow2>glance add name=f17-jeos is_public=true disk_format=qcow2 container_format=bare &lt; f17-x86_64-openstack-sda.qcow2</a></h2> <p>然后以demo用户进入dashboard，会看到添加进来的image，根据image启动实例，打开vnc界面（非localhost访问要改ip）。</p> <h3 id=neutronquantum_1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#neutronquantum_1>安装操蛋的Neutron（quantum）服务</a></h3> <p>这东西刚改名，nova自带的有network服务，可这个可以虚拟L2 L3 switch，那就比较有意思了</p> <p>/<em>注册quantum</em>/</p> <h2 id=keystone-service-create-name-quantum-type-network-description-openstack-networking-service><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#keystone-service-create-name-quantum-type-network-description-openstack-networking-service>keystone service-create --name quantum --type network --description 'OpenStack Networking Service'</a></h2> <h2 id=keystone-endpoint-create-region-myregion-service-id-26a55b340e254ad5bb78c0b14391e153-publicurl-http1921681119696-adminurl-http1921681119696-internalurl-http1921681119696><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#keystone-endpoint-create-region-myregion-service-id-26a55b340e254ad5bb78c0b14391e153-publicurl-http1921681119696-adminurl-http1921681119696-internalurl-http1921681119696>keystone endpoint-create --region myregion --service-id 26a55b340e254ad5bb78c0b14391e153 --publicurl "http://192.168.1.11:9696/" --adminurl "http://192.168.1.11:9696/" --internalurl "http://192.168.1.11:9696/"</a></h2> <p>/<em>(可选)添加quantum服务用户</em>/ get_id.sh:</p> <p>$ function get_id () { echo <code>"$@" | awk '/ id / { print $4 }'</code> }</p> <h2 id=admin_roleget_id-keystone-role-create-nameadmin><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#admin_roleget_id-keystone-role-create-nameadmin>ADMIN_ROLE=$(get_id keystone role-create --name=admin)</a></h2> <h2 id=quantum_userget_id-keystone-user-create-namequantum-passservicepass-emaildemoexamplecom-tenant-id-service><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum_userget_id-keystone-user-create-namequantum-passservicepass-emaildemoexamplecom-tenant-id-service>QUANTUM_USER=$(get_id keystone user-create --name=quantum --pass="servicepass" --email=demo@example.com --tenant-id service)</a></h2> <h2 id=keystone-user-role-add-user_id-quantum_user-role_id-admin_role-tenant_id-service><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#keystone-user-role-add-user_id-quantum_user-role_id-admin_role-tenant_id-service>keystone user-role-add --user_id $QUANTUM_USER --role_id $ADMIN_ROLE --tenant_id service</a></h2> <p>/<em>服务插件二选一，linuxbrideg和openvswitch，这里使用后者，先安装插件</em>/</p> <h2 id=yum-install-openstack-quantum-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#yum-install-openstack-quantum-openvswitch>yum install openstack-quantum-openvswitch</a></h2> <p>/<em>启动并添加服务</em>/</p> <h2 id=quantum-server-setup-plugin-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum-server-setup-plugin-openvswitch>quantum-server-setup --plugin openvswitch</a></h2> <h2 id=quantum-node-setup-plugin-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum-node-setup-plugin-openvswitch>quantum-node-setup --plugin openvswitch</a></h2> <h2 id=service-quantum-server-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-server-start>service quantum-server start</a></h2> <h2 id=chkconfig-quantum-server-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-server-on>chkconfig quantum-server on</a></h2> <h2 id=service-openvswitch-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-openvswitch-start>service openvswitch start</a></h2> <h2 id=chkconfig-openvswitch-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-openvswitch-on>chkconfig openvswitch on</a></h2> <h2 id=ovs-vsctl-add-br-br-int><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ovs-vsctl-add-br-br-int>ovs-vsctl add-br br-int</a></h2> <h2 id=chkconfig-quantum-openvswitch-agent-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-openvswitch-agent-on>chkconfig quantum-openvswitch-agent on</a></h2> <h2 id=service-quantum-openvswitch-agent-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-openvswitch-agent-start>service quantum-openvswitch-agent start</a></h2> <h2 id=quantum-dhcp-setup-plugin-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum-dhcp-setup-plugin-openvswitch>quantum-dhcp-setup --plugin openvswitch</a></h2> <h2 id=chkconfig-quantum-dhcp-agent-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-dhcp-agent-on>chkconfig quantum-dhcp-agent on</a></h2> <h2 id=service-quantum-dhcp-agent-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-dhcp-agent-start>service quantum-dhcp-agent start</a></h2> <h2 id=ovs-vsctl-add-br-br-ex><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ovs-vsctl-add-br-br-ex>ovs-vsctl add-br br-ex</a></h2> <h2 id=ovs-vsctl-add-port-br-ex-eth1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ovs-vsctl-add-port-br-ex-eth1>ovs-vsctl add-port br-ex eth1</a></h2> <h2 id=quantum-l3-setup-plugin-openvswitch><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#quantum-l3-setup-plugin-openvswitch>quantum-l3-setup --plugin openvswitch</a></h2> <h2 id=chkconfig-quantum-l3-agent-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-l3-agent-on>chkconfig quantum-l3-agent on</a></h2> <h2 id=service-quantum-l3-agent-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-l3-agent-start>service quantum-l3-agent start</a></h2> <h2 id=chkconfig-quantum-metadata-agent-on><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#chkconfig-quantum-metadata-agent-on>chkconfig quantum-metadata-agent on</a></h2> <h2 id=service-quantum-metadata-agent-start><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#service-quantum-metadata-agent-start>service quantum-metadata-agent start</a></h2> <p>修改并配置网络 /etc/sysconf/network-scripts/ifcfg-eth1，/etc/sysconf/network-scripts/ifcfg-br-ex</p> <h2 id=external_1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#external_1>External</a></h2> <p>DEVICE=eth1 TYPE=Ethernet BOOTPROTO=none NM_CONTROLLED=no BRIDGE=br-ex ONBOOT=yes</p> <h2 id=public-bridge_1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#public-bridge_1>Public Bridge</a></h2> <p>DEVICE=br-ex TYPE=Bridge BOOTPROTO=static IPADDR=192.168.2.11 NETMASK=255.255.255.0 NM_CONTROLLED=no ONBOOT=yes</p> <h2 id=ip-addr-del-1000924-dev-eth1><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ip-addr-del-1000924-dev-eth1>ip addr del 10.0.0.9/24 dev eth1</a></h2> <h2 id=ip-addr-add-1000924-dev-br-ex><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#ip-addr-add-1000924-dev-br-ex>ip addr add 10.0.0.9/24 dev br-ex</a></h2> <p>这里类似VPN的重写HEADER</p> <p>echo 1 &gt; /proc/sys/net/ipv4/conf/all/forwarding sysctl -w net.ipv4.ip_forward=1 iptables -A FORWARD -i eth0 -o br-ex -s 10.10.10.0/24 -m conntrack --ctstate NEW -j ACCEPT iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT iptables -A POSTROUTING -s 10.10.10.0/24 -t nat -j MASQUERADE</p> <p>最后重启机器即可</p> <h3 id=curlopenstack-api><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#curlopenstack-api>通过curl使用openstack api</a></h3> <p><a href=http://catn.com/2013/04/23/create-an-openstack-instance-with-just-curl/ title=http://catn.com/2013/04/23/create-an-openstack-instance-with-just-curl/ >参考这篇文章</a> 注意区分token和固定id</p> <h4 id=_4><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#_4>获取可用镜像</a></h4> <p>curl -s http://10.199.0.250:8774/v2/51ad87714b86442d9a74537d6f890060/images -X GET -H "X-Auth-Project-Id: admin" -H "Accept: application/json" -H "X-Auth-Token: 6083193874684f38865b086a8a5f4b7b" | python -mjson.tool</p> <h4 id=_5><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#_5>创建虚拟机</a></h4> <p>curl -i http://10.199.0.250:8774/v2/51ad87714b86442d9a74537d6f890060/servers -X POST -H "X-Auth-Project-Id: admin" -H "Content-Type: application/json" -H "Accept: application/json" -H "X-Auth-Token: 6083193874684f38865b086a8a5f4b7b" -d '{"server": {"name": "instance1", "imageRef": "992f5732-af50-40fc-987f-25951cbce943", "key_name": "damion-flybook", "flavorRef": "3", "max_count": 1, "min_count": 1}}'</p> <hr> <p>title: "A design of user frontend for kinds of Cloud with accounting." date: 2015-05-06 categories: - "cloud-infra" tags: - "Cloud Computing" - "TBD"</p> <hr> <p>I like Linode.com very much, so I'd like to make a frontend with something like that in functions.</p> <p>Here's the draft.</p> <p><a href=http://blog.lofyer.org/a-design-of-user-frontend-for-kinds-of-cloud-with-accounting/untitled-page/ ><img alt="Untitled Page" src=/blog/images/Untitled-Page-1024x650.png></a></p> <h3 id=2017><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#2017>更新一下，两年前的架构设计，终于在2017年的客户那用上了，而且上了人工干预的运行前调度器，哇哈哈。</a></h3> <p>title: "Cloud Init how to" date: 2015-03-10 categories: - "cloud-infra"</p> <hr> <p>OS: CentOS 6</p> <h2 id=yum-install-y-cloud-init><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#yum-install-y-cloud-init>yum install -y cloud-init</a></h2> <hr> <p>title: "How to solve the 'boot storm' problem: BCACHE" date: 2013-05-27 categories: - "cloud-infra" - "linux-admin"</p> <hr> <p><strong>Some solutions</strong> Way 1. Add more cpus.(ABANDONED) Way 2. Add a SSD as "boot cache" Way 3. Sort the boot process</p> <p><strong>POC:</strong> <strong>Way 2:</strong> Sometimes we need cache the boot section of the OS into a SSD, since no SSD on hand, let's try to use a block device made in /dev/shm</p> <p><strong>Way 3:</strong> Considering that the parallelization of the "boot action", we have to predict the action in the near future</p> <h3 id=experiment-using-bcache-nowor-flashcache><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#experiment-using-bcache-nowor-flashcache>Experiment: Using BCACHE now...or flashcache</a></h3> <p>title: "A light-weighted VM webadmin" date: 2013-06-18 categories: - "cloud-infra" - "linux-admin"</p> <hr> <p>The infrastructure of it: Management: Based on django, communicate with Agent Agent: A daemon, used for communicating with Management and managing the VMs</p> <h3 id=to-make-great-use-of-kvm-httpsgithubcomlofyerwebadmin><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#to-make-great-use-of-kvm-httpsgithubcomlofyerwebadmin>TO MAKE GREAT USE OF KVM. <a href=https://github.com/lofyer/webadmin>https://github.com/lofyer/webadmin</a></a></h3> <p>title: "MyIDC--Everything's traceable" date: 2013-12-11 categories: - "cloud-infra"</p> <hr> <p>相关手册参考<a href="https://cloud.lofyer.org/public.php?service=files&t=ad02817153cc4e4602921447eb49d10a" title=MyIDC_Book>MyIDC_Book</a></p> <p>细节索引： gluster hadoop(with ARM as an option) drbd/heartbeat foreman/puppet nagios ovirt openstack owncloud asterisk</p> <p>配置细节参考： <a href=https://github.com/lofyer/myidc-main title="MyIDC Source">MyIDC Source</a></p> <p><strong>Infrastructure:</strong></p> <p>Board： x86小板 SBSA小板 Cabinet： 亚克力自制 网络： 电信拨号接入外网 SDN 资源分配： 高可用监视与控制服务（os1-2） 高可用存储(os3-n) 并行计算（os3-n） 高可用虚拟机服务（os1/2+os3-n） 独立外设接入设备 安全： 证书认证（在量子计算机面向大众之前这个还是很靠谱的） 应用商店： 社会工程学测试 leapmotion控制插件 语音控制插件 手机控制插件</p> <hr> <p>title: "openvswitch howto" date: 2013-07-25 categories: - "linux-admin"</p> <hr> <p>Here, I use kernel-3.4.58.</p> <h2 id=emerge-net-miscopenvswitch-1110><a class=toclink href=../../2017/07/15/zstack-kubernetesk8sdocker-intergration/#emerge-net-miscopenvswitch-1110>emerge =net-misc/openvswitch-1.11.0</a></h2> <hr> <p>title: "硬盘、RAID组与Ceph分布式存储IOPS计算公式" date: 2017-06-04 categories: - "linux-admin" tags: - "Storage" - "Performance"</p> <hr> <p><strong>防怼说明：本文用于速算，想把难以量化的环境变量以及各种组合拿来说事儿的请自行Google，或者问厂商和IDC要报告去。</strong></p> <p><strong>机械硬盘</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div><pre><span></span><code>7200硬盘IOPS = 1000/(3 + 1000*(7200/60)/2) = 140
10k硬盘IOPS = 1000/(3 + 60000/10000/2) = 167
15k硬盘IOPS = 1000/(3 + 60000/15000/2) = 200
</code></pre></div></td></tr></table></div> <p>其中3为寻道延迟，7200/10k/15k为转速（rpm），1000*(7200/60)/2为旋转延迟（旋转延迟一般用转一圈所需时间的1/2表示），结果为理论峰值，实际还会有系统延迟导致测得IOPS一般低于此值。</p> <p><strong>RAID组</strong> 由于RAID组需要校验以提供恢复功能，所以会存在一定写惩罚，这个系数如下： RAID0: 1 RAID1: 2 RAID5: 4 RAID6: 6 RAID1-0: 2</p> <p>所以RAID组IOPS = 硬盘写IOPS<em>硬盘数量</em>写操作百分比/写惩罚系数 + 硬盘读IOPS<em>硬盘数量</em>读操作百分比。</p> <p>以4块IOPS为180的SAS硬盘组RAID 6然后百分百随机写操作为例：</p> <p>IOPS = 180*4/6 = 120</p> <p><strong>Ceph的IOPS经验公式</strong> 由于Ceph存储结构不同于物理硬件，所以影响其IOPS的因素主要有网络、副本数量、日志、OSD（硬盘）数量、OSD服务器数量、OSD IOPS等，这里给出一个来自Mirantis的经验公式：</p> <p>IOPS = 硬盘IOPS * 硬盘数量 * 0.88 / 副本数量， 其中0.88为4-8k随机读操作占比（88%）。</p> <p>关于Ceph的IOPS计算仅供参考，计算结果可能会跟物理环境实测有较大偏差。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-07-12 00:00:00">2017年7月12日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 4 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=zstack><a href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/ class=toclink>ZStack笔记</a></h2> <h3 id=zstackneutron2017-07><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#zstackneutron2017-07>ZStack与Neutron集成的探索(2017-07)</a></h3> <p>这篇文章较之前的ZStack+Neutron更为简单，由于ZStack的vxlan实现没有使用ovs，所以。。我不管了，直接ovs吧。另外，你如果使用了vyos，我没研究，可以等到下一期处理。</p> <p>以下方法仅仅从实现角度出发，理应适用于其他平台，如果是正经的集成，请自己编写模块。</p> <p>环境：单台主机有两个网卡，相同网段（纯粹方便使用而搞，不要学习），ZStack已经安装，其中eno16780032为管理网络，eno33561344为ZStack二层网络接口，三层网络novlan。</p> <h4 id=ovsodl><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#ovsodl>集成OVS/ODL</a></h4> <ol> <li>于计算节点中安装openvswitch。</li> </ol> <p>wget https://repos.fedorapeople.org/repos/openstack/openstack-ocata/rdo-release-ocata-3.noarch.rpm rpm -i rdo-release-ocata-3.noarch.rpm yum --enablerepo=* install -y openvswitch</p> <h2 id=yum-enablerepo-install-y-openvswitch-ovn><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#yum-enablerepo-install-y-openvswitch-ovn>yum --enablerepo=* install -y openvswitch-ovn*</a></h2> <p>systemctl enable openvswitch systemctl start openvswitch</p> <ol> <li>接下来我给你解释一下，要怎么做了。 首先，由于ZStack的flat网络使用了network namespace，通过一对pair将其与linuxbridge相连，ns内的叫inner0，外部的叫outer0；其中ns中会有dnsmasq启动的dhcp服务，我们将ns看作一个带dhcp的功能交换机好了，仅仅提供dhcp能力。</li> </ol> <p>然后，我们要创建一个ovs，为了将虚拟机的网口vnic1.0能够通过ovs进行控制，同时与dhcp交换机接通，我们需要一根线将ovs与linuxbridge接起来，如此一来，看下图（幸苦画的ASCII图没了！）。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/untitled_page.png><img alt src=/blog/images/untitled_page.png></a></p> <h2 id=ovs><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#ovs>创建ovs</a></h2> <p>ovs-vsctl add-br ovs-br0 ip link set dev ovs-br0 up</p> <h2 id=_1><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#_1>创建接口对</a></h2> <p>ip link add name veth0 type veth peer name veth0p</p> <h2 id=_2><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#_2>开始扎物理网线</a></h2> <p>brctl delif br_eno16780032 eno16780032 ovs-vsctl add-port ovs-br0 br_eno16780032</p> <h2 id=_3><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#_3>扎接口对</a></h2> <p>brctl addif br_eno16780032 veth0 ovs-vsctl add-port ovs-br0 veth0p ip link set dev veth0 up ip link set dev veth0p up</p> <p>最后由于我们的虚拟机接口vnic1.0每次都会创建到linuxbridge上，所以我们要把它拔下来插ovs上从而可以进行流表控制（可以保存为脚本）。</p> <p>brctl delif br_eno16780032 vnic1.0 ovs-vsctl add-port ovs-br0 vnic1.0</p> <blockquote> <p>Q: 为啥要把物理网口eno33561344放到ovs里？ A: 为了保持纯粹 ：）</p> <p>Q: 为啥不把outer0直接放到ovs里？ A: ZStack逻辑每次创建虚拟机都会试图把outer0加到linuxbridge里，如果已经加到其他网桥虚拟机创建会失败。</p> </blockquote> <p>最后，把物理机的OVS实例交给ODL处理吧，不画图了。</p> <p>ovs-vsctl set-manager tcp:opendaylight_ip:6640</p> <h2 id=_4><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#_4>也可以单独设置网桥的控制器，如果不想全被控制的话</a></h2> <p>ovs-vsctl set-controller ovs-br0 tcp:controller_ip:6633</p> <h2 id=odl><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#odl>安装ODL的插件</a></h2> <p>cd ODL_DIR ./bin/bash ./bin/client</p> <h2 id=netvirtdluxnetvirtyang><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#netvirtdluxnetvirtyang>安装netvirt与dlux界面，安装netvirt与yang</a></h2> <p>opendaylight-user@root&gt; feature:install odl-netvirt-openstack odl-dlux-all odl-dlux-yangman odl-mdsal-apidocs odl-netvirt-ui</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信截图_20170616131118.png><img alt src=/blog/images/微信截图_20170616131118.png></a></p> <blockquote> <p>物理机关机了或者新建主机了咋办？ 自己写网络配置文件、手撸脚本，方便的话可以进ZStack公司报名学习。</p> </blockquote> <p><strong>集成DPDK</strong></p> <p>为什么要做这件事儿呢？因为Intel说将DPDK与OVS结合会极大提升传输效率，<a href=https://download.01.org/packet-processing/ONPS2.1/Intel_ONP_Release_2.1_Performance_Test_Report_Rev1.0.pdf/ >https://download.01.org/packet-processing/ONPS2.1/Intel_ONP_Release_2.1_Performance_Test_Report_Rev1.0.pdf</a>。</p> <p>OK，那就开始换模块插网线吧，如果对DPDK不熟悉的同学可以去http://dpdk.org扫一眼tutorial。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片_20170905154354.jpg><img alt src=/blog/images/微信图片_20170905154354.jpg></a></p> <p>首先修改grub文件，在kernel启动参数中加入如下内容，尺寸自己酌情添加。</p> <p>iommu=pt intel_iommu=on hugepages=16 hugepagesz=2M hugepages=2048 iommu=pt intel_iommu=on isolcpus=0-3</p> <p>将上述内容加入到/etc/default/grub的CMDLINE后，执行“grub2-mkconfig &gt; /boot/grub2/grub.cfg”并重启。</p> <p>然后启用CentOS的Extra源并安装DPDK，这步操作较DPDK刚出来的时候已经良心很多了。。</p> <p>yum install dpdk dpdk-tools driverctl</p> <p>将网卡与vfio_pci绑定，没错，Intel的万兆卡。</p> <p>modprobe vfio_pci</p> <p>driverctl -v list-devices|grep Ether 0000:02:00.0 XXX driverctl set-override 0000:02:00.0 vfio-pci</p> <p>在OVS中配置使用dpdk，这里我们创建另外一个OVS桥。</p> <p>ovs-vsctl add-br ovs-br1</p> <p>ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true</p> <p>ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-socket-mem="1024,0"</p> <p>ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-lcore-mask=0xf</p> <p>ovs-vsctl set Open_vSwitch . other_config:pmd-cpu-mask=0xf</p> <p>systemctl restart openvswitch</p> <p>ovs-vsctl list Open_vSwitch [dpdk, dpdkr, dpdkvhostuser, dpdkvhostuserclient, geneve, gre, internal, ipsec_gre, lisp, patch, stt, system, tap, vxlan]</p> <p>然后，创建ovs-br1并塞俩vhost接口。</p> <p>ovs-vsctl add-br ovs-br1 -- set bridge ovs-br1 datapath_type=netdev ovs-vsctl add-port ovs-br1 vhost-user1 -- set Interface vhost-user1 type=dpdkvhostuser ovs-vsctl add-port ovs-br1 vhost-user2 -- set Interface vhost-user2 type=dpdkvhostuser</p> <p>到这里，工作基本完成，然后修改ZStack计算节点的虚拟机定义，目的是添加以下参数。</p> <p>-chardev socket,id=char1,path=/run/openvswitch/vhost-user1 \ -netdev type=vhost-user,id=mynet1,chardev=char1,vhostforce \ -device virtio-net-pci,mac=00:00:00:00:00:01,netdev=mynet1 \ -object memory-backend-file,id=mem,size=1G,mem-path=/dev/hugepages,share=on -numa node,memdev=mem -mem-prealloc</p> <p>怎么加呢？先virsh shutdown 1，然后virsh edit 1，并找到合适的地方加如下内容（开启平台设置中的NUMA选项）。</p> <p>...</p> <p><interface type=vhostuser> <model type=virtio /> <source mode=server path=/var/run/openvswitch/vhost-user1 type=unix> <link state=up> <bandwidth/> </interface> ...</p> <p>最后virsh start 1。</p> <p>然后同样方法启动第2台虚拟机，在虚拟机里尝试 iperf，对比一下数据，整体来说都会获得些许提升以榨干网卡能力。</p> <p><strong>注意：以上内容仅仅是为了好玩，不要轻易在自己的ZStack生产环境中测试！</strong></p> <p>参考： https://software.intel.com/en-us/articles/set-up-open-vswitch-with-dpdk-on-ubuntu-server https://www.ovirt.org/blog/2017/09/ovs-dpdk/ https://libvirt.org/formatdomain.html</p> <hr> <p>title: "ZStack Glusterfs 超融合方案" date: 2017-07-14 categories: - "cloud-infra" - "draft"</p> <hr> <p>ZStack 2.1版本中已经支持了NFS作为MNHA节点的存储，那么我们可以按照之前glusterfs组件oVirt超融合的方式直接使用，过程如下。</p> <p><strong>实验环境</strong> 服务器3台，双千兆网口，均已安装ZStack专家模式操作系统。</p> <p><strong>部署三节点无条带双副本分布式glusterfs存储</strong> 节点安装ZStack计算节点后，分别在三台上使用如下命令安装glusterfs。</p> <h3 id=zstack-ha-glusterfszstackglusterfsmnhanfsglusterfsipglusterfs><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#zstack-ha-glusterfszstackglusterfsmnhanfsglusterfsipglusterfs><strong>部署ZStack HA管理节点</strong> 将glusterfs的路径分别挂载至/zstack/glusterfs/mnha/，但要注意NFS/glusterfs的IP，因为glusterfs到服务端的连接不同于</a></h3> <p>title: "ZStack OpenStack API wrapper" date: 2017-09-14 categories: - "cloud-infra"</p> <hr> <h3 id=this-is-a-flag><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#this-is-a-flag>This is a flag.</a></h3> <p>title: "在ZStack中集成OpenStack Neutron组件" date: 2017-06-26 categories: - "cloud-infra" - "draft" tags: - "Cloud Computing" - "TBD"</p> <hr> <p>以笔者目前对ZStack源码的掌握，并不能较为产品化地集成Neutron，所以只能用点稍微hack的技巧将其用起来。</p> <p>实验材料：ZStack单机版，OpenStack Neutron with Dashboard and OVS bridge</p> <p>实验目的：通过修改ZStack实例的开机xml(或者新建主机时修改网络为openvswitch bridge)，调用Neutron API，并将实例网络桥接至OVS网桥。</p> <p>实验步骤：</p> <ol> <li> <p>搭建ZStack，略。</p> </li> <li> <p>搭建OpenStack Neutron实例，参考脚本https://...</p> </li> <li> <p>编写hook脚本</p> </li> <li> <p>开机测试</p> </li> <li> <p>通过OpenStack Dashboard查看</p> </li> </ol> <p>实验思考：</p> <p>这就是KVM平台的好处，互操作性杠杠的。另外，Neutron可作为VM Appliance单独提供，加上Cloud-Init就更好了。</p> <p>实验过程：</p> <p><strong>1. 集成oVirt与Neutron</strong></p> <p><strong>2. 集成ZStack与Neutron</strong></p> <p><strong>3. Neutron与其产品的集成</strong></p> <p>参考链接：</p> <p><a href=http://www.ovirt.org/develop/release-management/features/cloud/neutronvirtualappliance/ >http://www.ovirt.org/develop/release-management/features/cloud/neutronvirtualappliance/</a></p> <p>TBD</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/Neutron-appliance-topology.png><img alt src=/blog/images/Neutron-appliance-topology.png></a></p> </div> </article> <nav class=md-pagination> <a href=../../ class=md-pagination__link>1</a> <span class=md-pagination__current>2</span> <a href=../3/ class=md-pagination__link>3</a> <a href=../4/ class=md-pagination__link>4</a> <span class=md-pagination__dots>..</span> <a href=../25/ class=md-pagination__link>25</a> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2024 lofyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.prune", "navigation.instant", "navigation.instant.progess"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.525ec568.min.js></script> <script src=../../../javascripts/config.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>