<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=lofyer><link href=https://docs.lofyer.org/blog/page/3/ rel=canonical><link rel=prev href=../../..><link href=../../category/lab/ rel=next><link rel=icon href=../../../images/favicon.ico><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.4.12"><title>首页 - Lofyer's Blog</title><link rel=stylesheet href=../../../assets/stylesheets/main.fad675c6.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.356b1318.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title="Lofyer's Blog" class="md-header__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lofyer's Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 首页 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Index </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> 博客 </a> </li> <li class=md-tabs__item> <a href=../../../datanote/ class=md-tabs__link> Docs </a> </li> <li class=md-tabs__item> <a href=../../../about/about/ class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../template_password/ class=md-tabs__link> [密码保护]Template </a> </li> <li class=md-tabs__item> <a href=../../../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Lofyer's Blog" class="md-nav__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Lofyer's Blog </label> <div class=md-nav__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> 博客 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 博客 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=../../ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../archive/2022/ class=md-nav__link> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../category/lab/ class=md-nav__link> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Docs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../datanote/ class=md-nav__link> <span class=md-ellipsis> DataNote </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../inthecloud/ class=md-nav__link> <span class=md-ellipsis> InTheCloud </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../wangsheng/ class=md-nav__link> <span class=md-ellipsis> WangSheng </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../about/about/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-nav__item> <a href=../../../template_password/ class=md-nav__link> <span class=md-ellipsis> [密码保护]Template </span> </a> </li> <li class=md-nav__item> <a href=../../../tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=_1>首页</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-07-12 00:00:00">2017年7月12日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 4 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=zstack><a href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/ class=toclink>ZStack笔记</a></h2> <h3 id=zstackneutron2017-07><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#zstackneutron2017-07>ZStack与Neutron集成的探索(2017-07)</a></h3> <p>这篇文章较之前的ZStack+Neutron更为简单，由于ZStack的vxlan实现没有使用ovs，所以。。我不管了，直接ovs吧。另外，你如果使用了vyos，我没研究，可以等到下一期处理。</p> <p>以下方法仅仅从实现角度出发，理应适用于其他平台，如果是正经的集成，请自己编写模块。</p> <p>环境：单台主机有两个网卡，相同网段（纯粹方便使用而搞，不要学习），ZStack已经安装，其中eno16780032为管理网络，eno33561344为ZStack二层网络接口，三层网络novlan。</p> <h4 id=ovsodl><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#ovsodl>集成OVS/ODL</a></h4> <ol> <li>于计算节点中安装openvswitch。</li> </ol> <p>wget https://repos.fedorapeople.org/repos/openstack/openstack-ocata/rdo-release-ocata-3.noarch.rpm rpm -i rdo-release-ocata-3.noarch.rpm yum --enablerepo=* install -y openvswitch</p> <h2 id=yum-enablerepo-install-y-openvswitch-ovn><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#yum-enablerepo-install-y-openvswitch-ovn>yum --enablerepo=* install -y openvswitch-ovn*</a></h2> <p>systemctl enable openvswitch systemctl start openvswitch</p> <ol> <li>接下来我给你解释一下，要怎么做了。 首先，由于ZStack的flat网络使用了network namespace，通过一对pair将其与linuxbridge相连，ns内的叫inner0，外部的叫outer0；其中ns中会有dnsmasq启动的dhcp服务，我们将ns看作一个带dhcp的功能交换机好了，仅仅提供dhcp能力。</li> </ol> <p>然后，我们要创建一个ovs，为了将虚拟机的网口vnic1.0能够通过ovs进行控制，同时与dhcp交换机接通，我们需要一根线将ovs与linuxbridge接起来，如此一来，看下图（幸苦画的ASCII图没了！）。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/untitled_page.png><img alt src=/blog/images/untitled_page.png></a></p> <h2 id=ovs><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#ovs>创建ovs</a></h2> <p>ovs-vsctl add-br ovs-br0 ip link set dev ovs-br0 up</p> <h2 id=_1><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#_1>创建接口对</a></h2> <p>ip link add name veth0 type veth peer name veth0p</p> <h2 id=_2><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#_2>开始扎物理网线</a></h2> <p>brctl delif br_eno16780032 eno16780032 ovs-vsctl add-port ovs-br0 br_eno16780032</p> <h2 id=_3><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#_3>扎接口对</a></h2> <p>brctl addif br_eno16780032 veth0 ovs-vsctl add-port ovs-br0 veth0p ip link set dev veth0 up ip link set dev veth0p up</p> <p>最后由于我们的虚拟机接口vnic1.0每次都会创建到linuxbridge上，所以我们要把它拔下来插ovs上从而可以进行流表控制（可以保存为脚本）。</p> <p>brctl delif br_eno16780032 vnic1.0 ovs-vsctl add-port ovs-br0 vnic1.0</p> <blockquote> <p>Q: 为啥要把物理网口eno33561344放到ovs里？ A: 为了保持纯粹 ：）</p> <p>Q: 为啥不把outer0直接放到ovs里？ A: ZStack逻辑每次创建虚拟机都会试图把outer0加到linuxbridge里，如果已经加到其他网桥虚拟机创建会失败。</p> </blockquote> <p>最后，把物理机的OVS实例交给ODL处理吧，不画图了。</p> <p>ovs-vsctl set-manager tcp:opendaylight_ip:6640</p> <h2 id=_4><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#_4>也可以单独设置网桥的控制器，如果不想全被控制的话</a></h2> <p>ovs-vsctl set-controller ovs-br0 tcp:controller_ip:6633</p> <h2 id=odl><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#odl>安装ODL的插件</a></h2> <p>cd ODL_DIR ./bin/bash ./bin/client</p> <h2 id=netvirtdluxnetvirtyang><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#netvirtdluxnetvirtyang>安装netvirt与dlux界面，安装netvirt与yang</a></h2> <p>opendaylight-user@root&gt; feature:install odl-netvirt-openstack odl-dlux-all odl-dlux-yangman odl-mdsal-apidocs odl-netvirt-ui</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信截图_20170616131118.png><img alt src=/blog/images/微信截图_20170616131118.png></a></p> <blockquote> <p>物理机关机了或者新建主机了咋办？ 自己写网络配置文件、手撸脚本，方便的话可以进ZStack公司报名学习。</p> </blockquote> <p><strong>集成DPDK</strong></p> <p>为什么要做这件事儿呢？因为Intel说将DPDK与OVS结合会极大提升传输效率，<a href=https://download.01.org/packet-processing/ONPS2.1/Intel_ONP_Release_2.1_Performance_Test_Report_Rev1.0.pdf/ >https://download.01.org/packet-processing/ONPS2.1/Intel_ONP_Release_2.1_Performance_Test_Report_Rev1.0.pdf</a>。</p> <p>OK，那就开始换模块插网线吧，如果对DPDK不熟悉的同学可以去http://dpdk.org扫一眼tutorial。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片_20170905154354.jpg><img alt src=/blog/images/微信图片_20170905154354.jpg></a></p> <p>首先修改grub文件，在kernel启动参数中加入如下内容，尺寸自己酌情添加。</p> <p>iommu=pt intel_iommu=on hugepages=16 hugepagesz=2M hugepages=2048 iommu=pt intel_iommu=on isolcpus=0-3</p> <p>将上述内容加入到/etc/default/grub的CMDLINE后，执行“grub2-mkconfig &gt; /boot/grub2/grub.cfg”并重启。</p> <p>然后启用CentOS的Extra源并安装DPDK，这步操作较DPDK刚出来的时候已经良心很多了。。</p> <p>yum install dpdk dpdk-tools driverctl</p> <p>将网卡与vfio_pci绑定，没错，Intel的万兆卡。</p> <p>modprobe vfio_pci</p> <p>driverctl -v list-devices|grep Ether 0000:02:00.0 XXX driverctl set-override 0000:02:00.0 vfio-pci</p> <p>在OVS中配置使用dpdk，这里我们创建另外一个OVS桥。</p> <p>ovs-vsctl add-br ovs-br1</p> <p>ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-init=true</p> <p>ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-socket-mem="1024,0"</p> <p>ovs-vsctl --no-wait set Open_vSwitch . other_config:dpdk-lcore-mask=0xf</p> <p>ovs-vsctl set Open_vSwitch . other_config:pmd-cpu-mask=0xf</p> <p>systemctl restart openvswitch</p> <p>ovs-vsctl list Open_vSwitch [dpdk, dpdkr, dpdkvhostuser, dpdkvhostuserclient, geneve, gre, internal, ipsec_gre, lisp, patch, stt, system, tap, vxlan]</p> <p>然后，创建ovs-br1并塞俩vhost接口。</p> <p>ovs-vsctl add-br ovs-br1 -- set bridge ovs-br1 datapath_type=netdev ovs-vsctl add-port ovs-br1 vhost-user1 -- set Interface vhost-user1 type=dpdkvhostuser ovs-vsctl add-port ovs-br1 vhost-user2 -- set Interface vhost-user2 type=dpdkvhostuser</p> <p>到这里，工作基本完成，然后修改ZStack计算节点的虚拟机定义，目的是添加以下参数。</p> <p>-chardev socket,id=char1,path=/run/openvswitch/vhost-user1 \ -netdev type=vhost-user,id=mynet1,chardev=char1,vhostforce \ -device virtio-net-pci,mac=00:00:00:00:00:01,netdev=mynet1 \ -object memory-backend-file,id=mem,size=1G,mem-path=/dev/hugepages,share=on -numa node,memdev=mem -mem-prealloc</p> <p>怎么加呢？先virsh shutdown 1，然后virsh edit 1，并找到合适的地方加如下内容（开启平台设置中的NUMA选项）。</p> <p>...</p> <p><interface type=vhostuser> <model type=virtio /> <source mode=server path=/var/run/openvswitch/vhost-user1 type=unix> <link state=up> <bandwidth/> </interface> ...</p> <p>最后virsh start 1。</p> <p>然后同样方法启动第2台虚拟机，在虚拟机里尝试 iperf，对比一下数据，整体来说都会获得些许提升以榨干网卡能力。</p> <p><strong>注意：以上内容仅仅是为了好玩，不要轻易在自己的ZStack生产环境中测试！</strong></p> <p>参考： https://software.intel.com/en-us/articles/set-up-open-vswitch-with-dpdk-on-ubuntu-server https://www.ovirt.org/blog/2017/09/ovs-dpdk/ https://libvirt.org/formatdomain.html</p> <hr> <p>title: "ZStack Glusterfs 超融合方案" date: 2017-07-14 categories: - "cloud-infra" - "draft"</p> <hr> <p>ZStack 2.1版本中已经支持了NFS作为MNHA节点的存储，那么我们可以按照之前glusterfs组件oVirt超融合的方式直接使用，过程如下。</p> <p><strong>实验环境</strong> 服务器3台，双千兆网口，均已安装ZStack专家模式操作系统。</p> <p><strong>部署三节点无条带双副本分布式glusterfs存储</strong> 节点安装ZStack计算节点后，分别在三台上使用如下命令安装glusterfs。</p> <h3 id=zstack-ha-glusterfszstackglusterfsmnhanfsglusterfsipglusterfs><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#zstack-ha-glusterfszstackglusterfsmnhanfsglusterfsipglusterfs><strong>部署ZStack HA管理节点</strong> 将glusterfs的路径分别挂载至/zstack/glusterfs/mnha/，但要注意NFS/glusterfs的IP，因为glusterfs到服务端的连接不同于</a></h3> <p>title: "ZStack OpenStack API wrapper" date: 2017-09-14 categories: - "cloud-infra"</p> <hr> <h3 id=this-is-a-flag><a class=toclink href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/#this-is-a-flag>This is a flag.</a></h3> <p>title: "在ZStack中集成OpenStack Neutron组件" date: 2017-06-26 categories: - "cloud-infra" - "draft" tags: - "Cloud Computing" - "TBD"</p> <hr> <p>以笔者目前对ZStack源码的掌握，并不能较为产品化地集成Neutron，所以只能用点稍微hack的技巧将其用起来。</p> <p>实验材料：ZStack单机版，OpenStack Neutron with Dashboard and OVS bridge</p> <p>实验目的：通过修改ZStack实例的开机xml(或者新建主机时修改网络为openvswitch bridge)，调用Neutron API，并将实例网络桥接至OVS网桥。</p> <p>实验步骤：</p> <ol> <li> <p>搭建ZStack，略。</p> </li> <li> <p>搭建OpenStack Neutron实例，参考脚本https://...</p> </li> <li> <p>编写hook脚本</p> </li> <li> <p>开机测试</p> </li> <li> <p>通过OpenStack Dashboard查看</p> </li> </ol> <p>实验思考：</p> <p>这就是KVM平台的好处，互操作性杠杠的。另外，Neutron可作为VM Appliance单独提供，加上Cloud-Init就更好了。</p> <p>实验过程：</p> <p><strong>1. 集成oVirt与Neutron</strong></p> <p><strong>2. 集成ZStack与Neutron</strong></p> <p><strong>3. Neutron与其产品的集成</strong></p> <p>参考链接：</p> <p><a href=http://www.ovirt.org/develop/release-management/features/cloud/neutronvirtualappliance/ >http://www.ovirt.org/develop/release-management/features/cloud/neutronvirtualappliance/</a></p> <p>TBD</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/Neutron-appliance-topology.png><img alt src=/blog/images/Neutron-appliance-topology.png></a></p> <nav class=md-post__action> <a href=../../2017/07/12/zstack%E7%AC%94%E8%AE%B0/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-06-24 00:00:00">2017年6月24日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a>, <a href=../../category/draft/ class=md-meta__link>draft</a></li> <li class=md-meta__item> 需要 2 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=linuxbridgeovsvxlanvtep><a href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/ class=toclink>在LinuxBridge/OVS中使用VxLAN组网以及创建VTEP</a></h2> <p>这是一篇入门文章，帮助初学者理清VxLAN的基本原理与使用，ovs只是工具，新版本内核也可使用ip命令直接创建。</p> <p>本篇内容分为两篇，第一篇是使用简单VxLAN通道网络，第二篇会接入OVS模拟的VTEP设备。</p> <h2 id=vxlan><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#vxlan>一、使用VxLAN通道</a></h2> <p>原理是在网络命名空间上（仅测试环境），创建对端接口（peer/patch，虚拟化环境中即是虚拟机veth设备接口与OVS tun接口），以通过VxLAN通道与彼此通信。</p> <p>host1拥有物理接口eth0（192.168.0.101），host2拥有物理接口eth0（192.168.0.102），两者在同一局域网中。</p> <p>实验拓扑如下图。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/1.png><img alt src=/blog/images/1.png></a></p> <p>在host1上创建veth与对端接口，对端接口会与ovs网桥相连，其中veth1代表虚拟机接口（地址为10.0.0.1），veth1p代表与ovs网桥相连的接口。</p> <h2 id=_1><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#_1>添加网络命名空间</a></h2> <p>ip netns add ns-host1</p> <h2 id=_2><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#_2>添加对端接口</a></h2> <p>ip link add name veth1 type veth peer name veth1p</p> <h2 id=_3><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#_3>将虚拟机接口放入命名空间</a></h2> <p>ip link set dev veth1 netns ns-host1</p> <h2 id=ip><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#ip>设置虚拟机接口IP</a></h2> <p>ip netns exec ns-host1 ifconfig veth1 10.0.0.1/24 up</p> <h2 id=ovs><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#ovs>添加ovs网桥</a></h2> <p>ovs-vsctl add-br ovs-vxlan</p> <h2 id=_4><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#_4>将虚拟机的对端接口放入命名空间</a></h2> <p>ovs-vsctl add-port ovs-vxlan veth1p</p> <h2 id=_5><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#_5>激活接口</a></h2> <p>ip link set ovs-vxlan up ip link set veth1p up</p> <p>同样在host2上创建。</p> <p>ip netns add ns-host2 ip link add name veth1 type veth peer name veth1p ip link set dev veth1 netns ns-host2 ip netns exec ns-host2 ifconfig veth1 10.0.0.2/24 up</p> <p>ovs-vsctl add-br ovs-vxlan ovs-vsctl add-port ovs-vxlan veth1p ip link set ovs-vxlan up ip link set veth1p up</p> <p>然后，分别在host1与host2上创建VxLAN通道。</p> <p>host1，将VxLAN的对端指向host2的eth0，VNI（VXLAN Network Identifier）为123。</p> <p>ovs-vsctl add-port ovs-vxlan vxlan0 -- set interface vxlan0 type=vxlan options:remote_ip=192.168.0.102 options:key=123</p> <p>host2，将VxLAN的对端指向host2的eth0。</p> <p>ovs-vsctl add-port ovs-vxlan vxlan0 -- set interface vxlan0 type=vxlan options:remote_ip=192.168.0.101 options:key=123</p> <p>这样即可完成最简单的OVS VxLAN实验准备，在host2上的虚拟机尝试ping host1上的虚拟机。</p> <p>ip netns exec ns-host2 ping 10.0.0.1 PING 10.0.0.1 (10.0.0.1) 56(84) bytes of data. 64 bytes from 10.0.0.1: icmp_seq=1 ttl=64 time=1.74 ms 64 bytes from 10.0.0.1: icmp_seq=2 ttl=64 time=0.734 ms 64 bytes from 10.0.0.1: icmp_seq=3 ttl=64 time=0.669 ms</p> <p>这里可以将主机上的物理接口，比如eth1加入到ovs-vxlan中，从而使得与其相连的主机或者网络设备能够接入此VxLAN网络； 当添加第三台主机时，使用gre网络需要在每个gre0中设置remote_ip以两两相连，可以是星形或者环形（打开ovs生成树协议，ovs-vsctl set bridge ovs-gre stp_enable=true），而VxLAN网络</p> <h2 id=vxlan_1><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#vxlan_1>二、使用VxLAN通道连接虚拟机与物理机</a></h2> <h2 id=ovs-vtep><a class=toclink href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/#ovs-vtep>三、接入OVS VTEP设备</a></h2> <p>参考： <a href=https://sgros-students.blogspot.com/2013/11/comparison-of-brctl-and-bridge-commands.html>brctl与bridge命令对比</a> <a href=https://github.com/lofyer/scripts/blob/6e9fd04cd6209459745f83dc8b303494992b2544/libvirt/ovs-howto.txt>在oVirt中使用ovs gre网络</a> <a href=https://www.sdnlab.com/5365.html>搭建基于Open vSwitch的VxLAN隧道实验</a> <a href=http://docs.openvswitch.org/en/latest/howto/userspace-tunneling/ >Connecting VMs Using Tunnels (Userspace)</a></p> <nav class=md-post__action> <a href=../../2017/06/24/%E5%9C%A8linuxbridgeovs%E4%B8%AD%E4%BD%BF%E7%94%A8vxlan%E7%BB%84%E7%BD%91%E4%BB%A5%E5%8F%8A%E5%88%9B%E5%BB%BAvtep/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-06-02 00:00:00">2017年6月2日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a>, <a href=../../category/linux-admin/ class=md-meta__link>linux-admin</a>, <a href=../../category/draft/ class=md-meta__link>draft</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=opendedup><a href=../../2017/06/02/%E8%99%9A%E6%8B%9F%E5%8C%96%E5%B9%B3%E5%8F%B0%E9%95%9C%E5%83%8F%E5%8E%BB%E5%86%97%E6%B5%8B%E8%AF%95opendedup/ class=toclink>虚拟化平台镜像去冗测试（opendedup）</a></h2> <p>OpenDedup，是一款开源去重文件系统，https://github.com/opendedup/sdfs，可以分布式，支持NFS、iSCSI等，感觉非常厉害，作者是Veritas的银堡（Sam Silverberg）。</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>RedHat 7就开始带了VDO，但是还没测过。</p> </div> <p>可以去官网下载镜像，或者是笔者认为更加实用的NAS系统。</p> <h3 id=_1><a class=toclink href=../../2017/06/02/%E8%99%9A%E6%8B%9F%E5%8C%96%E5%B9%B3%E5%8F%B0%E9%95%9C%E5%83%8F%E5%8E%BB%E5%86%97%E6%B5%8B%E8%AF%95opendedup/#_1>简单测试</a></h3> <p>目的是减少更多本地环境占用，使用opendedup测试。</p> <ol> <li> <p>首先测试我新闻服务器上的数据，以索引文件为主，经常变动，有大有小。</p> </li> <li> <p>然后选择一款kvm软件平台。</p> </li> </ol> <p>安装：</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span></pre></div></td><td class=code><div><pre><span></span><code>wget http://www.opendedup.org/downloads/sdfs-latest.deb
sudo dpkg -i sdfs-latest.deb

sudo su
echo &quot;* hardnofile 65535&quot; &gt;&gt; /etc/security/limits.conf
echo &quot;* soft nofile 65535&quot; &gt;&gt; /etc/security/limits.conf
exit
sudo mkfs.sdfs --volume-name=pool0 --volume-capacity=256GB
sudo mkdir /media/pool0 
sudo mount.sdfs pool0 /media/pool0/
</code></pre></div></td></tr></table></div> <p>数据拷贝进去后，原9.3GB索引数据降为8.5GB，效果不如想象中好。</p> <p>可能原因：</p> <p>sdfs提供了丰富的命令行选项，我没有使用，使用后可能会达到预期，比如更小的block。</p> <nav class=md-post__action> <a href=../../2017/06/02/%E8%99%9A%E6%8B%9F%E5%8C%96%E5%B9%B3%E5%8F%B0%E9%95%9C%E5%83%8F%E5%8E%BB%E5%86%97%E6%B5%8B%E8%AF%95opendedup/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-05-23 00:00:00">2017年5月23日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/fpga/ class=md-meta__link>fpga</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=vmware-vcenter-converter-sdk><a href=../../2017/05/23/vmware-v2v/ class=toclink>"VMWare vCenter Converter SDK"</a></h2> <p>看到有公司专门做P2V、V2V，看了一下他们做了一些管理与适应各平台的边边角角工作，其技术原理是使用iotap或者VMWare Hypervisor层的 VAIO（感谢黄老师指导），从而达成CDP效果。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片_20170616172058.jpg><img alt src=/blog/images/微信图片_20170616172058.jpg></a></p> <p>但这种技术的现在的缺点有两点：</p> <ol> <li> <p>没法支持任何的并行IO类应用，比如GPFS，Oracle RAC等；</p> </li> <li> <p>本质上没法做consistent group。</p> </li> </ol> <p>更多具体内容可以查看Falcon与Commvault的相关专利，但这篇文章中2V的话还可以玩玩，那么我们试一下Converter SDK吧，也可直接<a href="https://my.vmware.com/en/group/vmware/evalcenter?p=converter">下载Converter</a>。</p> <p>下载最新的<a href="https://my.vmware.com/group/vmware/get-download?downloadGroup=CONV61_SDK">VMware vCenter Converter Standalone SDK 6.1</a></p> <nav class=md-post__action> <a href=../../2017/05/23/vmware-v2v/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-05-21 00:00:00">2017年5月21日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 10 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=openstackopendaylightsdn><a href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/ class=toclink>OpenStack、OpenDayLight、硬件SDN交换机集成</a></h2> <p>本文将讲述如何在OpenStack中使用SDN交换机，同时将OpenDayLight作为控制器，测试网络类型为vxlan。</p> <p>本文适用目标为OpenStack Neutron组件，但理论上说包括任何可使用Neutron组件服务的云管理平台，比如oVirt。</p> <p>在搭建Neutron时，笔者使用了现成的OpenStack单节点平台（可以参考https://github.com/lofyer/openstack-pxe-deployment，为防止出现3.1节末的错误，请使用Newton之前版本，我手贱部署了最新的），但为了减少搭建部署的麻烦，我会在后期尝试直接使用Neutron VM Appliance，方便集成（暂不确定是否影响性能）。</p> <p>update 2017-05-27: 当前版本zstack的云路由功能vyos所实现的nfv软路由，笔者会考虑将Neutron移植到ZStack中，如此以来SDN即可将注意力主要放在Neutron。</p> <p>update 2017-06-01: 加入盛科交换机，4.10内核的vtep可直接内核实现，参考<a href=https://www.kernel.org/doc/Documentation/networking/vxlan.txt>Linux doc</a> 。</p> <p>update 2017-06-07: OpenStack版本从Ocata切换为Newton，实验3.3重新做了。</p> <p>update 2017-06-12: 使用 Neutron appliance，并添加<a href=https://github.com/oVirt/vdsm/tree/master/vdsm_hooks/openstacknet>hooks</a>，构建ZStack SDN解决方案，来源可自行搜索oVirt的相关资料</p> <h2 id=1><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#1>1. 环境准备</a></h2> <p>Pica8 P-5101 48+4*8 10Gb SDN交换机2台（吵地脑袋疼），OpenStack Ocata，OpenDayLight Lastest,管理机器。</p> <p>mininet虚拟机地址：192.168.0.68</p> <p>操作机地址：192.168.0.55</p> <h2 id=2-mininet><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#2-mininet>2. 架构方案与mininet环境模拟实验</a></h2> <p>拓扑使用miniedit制作，同时首选项中打开“Start CLI”，操作机“ssh -Y mininet@MININET_IP”后，运行“sudo ~/mininet/examples/mininet.py”以开启。</p> <h3 id=21><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#21>2.1. 基础模拟实验——交换机互联</a></h3> <p>文字描述可参考<a href=http://blog.scottlowe.org/2012/11/27/connecting-ovs-bridges-with-patch-ports/ >http://blog.scottlowe.org/2012/11/27/connecting-ovs-bridges-with-patch-ports/</a>以及其中链接。</p> <p>miniedit拓扑：</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/WX20170521-164516.png><img alt src=/blog/images/WX20170521-164516.png></a></p> <p>目的：连接两个交换机，使得h1与h3互通。</p> <p>方法：将两个交换机上的一个端口组组成patch。</p> <p>ovs-vsctl -- add-port s1 patch1 -- set interface patch1 type=patch options:peer=patch2 -- add-port s2 patch2 -- set interface patch2 type=patch options:peer=patch1</p> <p><strong>结果：</strong></p> <p>root@mininet-vm:/home/mininet# ovs-vsctl show 918037ec-b307-45d7-a75a-f1ac4337d135 Bridge "s1" Controller "tcp:127.0.0.1:6633" is_connected: true fail_mode: secure Port "s1" Interface "s1" type: internal Port "s1-eth2" Interface "s1-eth2" Port "s1-eth1" Interface "s1-eth1" Port "patch1" Interface "patch1" type: patch options: {peer="patch2"} Bridge "s2" Controller "tcp:127.0.0.1:6633" is_connected: true fail_mode: secure Port "s2-eth1" Interface "s2-eth1" Port "s2" Interface "s2" type: internal Port "patch2" Interface "patch2" type: patch options: {peer="patch1"} ovs_version: "2.0.2"</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/WX20170521-174927.png><img alt src=/blog/images/WX20170521-174927.png></a></p> <h3 id=22><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#22>2.2. 进阶实验——流表</a></h3> <p>miniedit拓扑：同上。</p> <p>目的：阻断h1与h2、h2与h3，使得h1与h3互通。</p> <p>方法：下发如下流表。</p> <p>阻断h2与h1/h3的协议封包： ovs-ofctl add-flow s1 in_port=2,arp,ip,nw_dst=10.0.0.1,actions=drop ovs-ofctl add-flow s1 in_port=2,arp,ip,nw_dst=10.0.0.3,actions=drop</p> <p><strong>结果</strong></p> <p>mininet&gt; h1 ping h2 -c 2 PING 10.0.0.2 (10.0.0.2) 56(84) bytes of data. ^C --- 10.0.0.2 ping statistics --- 2 packets transmitted, 0 received, 100% packet loss, time 1006ms</p> <p>mininet&gt; h2 ping h1 -c 2 PING 10.0.0.1 (10.0.0.1) 56(84) bytes of data. ^C --- 10.0.0.1 ping statistics --- 2 packets transmitted, 0 received, 100% packet loss, time 1000ms</p> <p>mininet&gt; h3 ping h2 -c 2 PING 10.0.0.2 (10.0.0.2) 56(84) bytes of data. ^C --- 10.0.0.2 ping statistics --- 2 packets transmitted, 0 received, 100% packet loss, time 999ms</p> <p>mininet&gt; h2 ping h3 -c 2 PING 10.0.0.3 (10.0.0.3) 56(84) bytes of data. ^C --- 10.0.0.3 ping statistics --- 2 packets transmitted, 0 received, 100% packet loss, time 1006ms</p> <p>mininet&gt; h1 ping h3 -c 2 PING 10.0.0.3 (10.0.0.3) 56(84) bytes of data. 64 bytes from 10.0.0.3: icmp_seq=1 ttl=64 time=2.37 ms 64 bytes from 10.0.0.3: icmp_seq=2 ttl=64 time=0.561 ms</p> <p>--- 10.0.0.3 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1001ms rtt min/avg/max/mdev = 0.561/1.466/2.372/0.906 ms mininet&gt; h3 ping h1 -c 2 PING 10.0.0.1 (10.0.0.1) 56(84) bytes of data. 64 bytes from 10.0.0.1: icmp_seq=1 ttl=64 time=2.49 ms 64 bytes from 10.0.0.1: icmp_seq=2 ttl=64 time=0.548 ms</p> <p>--- 10.0.0.1 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1001ms rtt min/avg/max/mdev = 0.548/1.521/2.494/0.973 ms mininet&gt; </p> <p>root@mininet-vm:~# ovs-ofctl dump-flows s1 NXST_FLOW reply (xid=0x4): cookie=0x0, duration=485.308s, table=0, n_packets=0, n_bytes=0, idle_age=485, ip,in_port=2,nw_dst=10.0.0.1 actions=drop cookie=0x0, duration=483.569s, table=0, n_packets=3, n_bytes=294, idle_age=183, ip,in_port=2,nw_dst=10.0.0.3 actions=drop cookie=0x0, duration=1715.894s, table=0, n_packets=93, n_bytes=3906, idle_age=202, arp,in_port=1,arp_tpa=10.0.0.2 actions=drop cookie=0x0, duration=715.43s, table=0, n_packets=4, n_bytes=392, idle_age=400, ip,in_port=1,nw_dst=10.0.0.2 actions=drop</p> <h2 id=3><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#3>3. 综合实验环境配置</a></h2> <p>首先来看一下实验拓扑：</p> <p>图。。。。。。</p> <p><strong>SDN交换机</strong> 管理地址：192.168.0.250/24,</p> <p><strong>OpenStack Controller/Neutron</strong> IP: 192.168.0.80</p> <p><strong>OpenDayLight</strong> IP: 192.168.0.90 Web: http://192.168.0.90:8181/index.html</p> <h3 id=31-opendaylight><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#31-opendaylight>3.1. 设置OpenDayLight</a></h3> <p>在主机192.168.0.90上下载启动Boron版本<a href=https://www.opendaylight.org/downloads>OpenDayLight（其他版本未测试）</a>，然后解压运行（需要Java环境）：</p> <p>unzip distribution-karaf-0.5.3-Boron-SR3.zip cd distribution-karaf-0.5.3-Boron-SR3</p> <h2 id=odl><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#odl>启动ODL服务</a></h2> <p>./bin/start</p> <h2 id=openvswitch><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#openvswitch>本地安装并启动OpenvSwitch以作测试</a></h2> <p>yum localinstall -y https://repos.fedorapeople.org/repos/openstack/openstack-ocata/rdo-release-ocata-3.noarch.rpm systemctl enable openvswitch systemctl start openvswitch ovs-vsctl set-manager tcp:192.168.0.90:6640</p> <h2 id=_1><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#_1>进入客户端</a></h2> <p>./bin/client</p> <h2 id=netvirtdluxyangmanui><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#netvirtdluxyangmanui>安装netvirt与dlux界面，其中yangman为包管理器UI</a></h2> <p>opendaylight-user@root&gt; feature:install odl-netvirt-openstack odl-dlux-all odl-dlux-yangman odl-mdsal-apidocs odl-netvirt-ui</p> <p>然后访问http://192.168.0.90:8181/index.html，用户密码为admin/admin，可以看到我们刚刚添加的本地OVS。</p> <h3 id=33-openstackopendaylight><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#33-openstackopendaylight>3.3. OpenStack与OpenDayLight集成</a></h3> <p>首先要清除原有的实例和neutron网络。</p> <h2 id=_2><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#_2>实例</a></h2> <p>openstack server list +--------------------------------------+-----------+---------+------------+-------------+------------------------------------------------------+ | ID | Name | Status | Task State | Power State | Networks | +--------------------------------------+-----------+---------+------------+-------------+------------------------------------------------------+ | d45b1646-b559-4d6d-963c-af3da205aa36 | instance3 | SHUTOFF | - | Shutdown | flat-ens39=192.168.0.108; sharednet1=192.168.118.203 | +--------------------------------------+-----------+---------+------------+-------------+------------------------------------------------------+</p> <p>openstack server delete instance3</p> <h2 id=_3><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#_3>网络</a></h2> <p>openstack subnet list +--------------------------------------+-------------+--------------------------------------+------------------+ | ID | Name | Network | Subnet | +--------------------------------------+-------------+--------------------------------------+------------------+ | b0acb3ad-22d4-491c-94e7-488aca906398 | flat-subnet | b8f95552-9a45-49ae-b080-2e0041d4b2a0 | 192.168.0.0/24 | | c066992d-294d-4cd6-a3fb-0386619922c7 | subnet1 | 5ac25e6f-bf49-4217-abbc-11bf171c0a3e | 192.168.118.0/24 | +--------------------------------------+-------------+--------------------------------------+------------------+</p> <p>openstack router list +------------------------------+-------------------+--------+-------+-------------+-------+------------------------------+ | ID | Name | Status | State | Distributed | HA | Project | +------------------------------+-------------------+--------+-------+-------------+-------+------------------------------+ | 78507b26-38f0-4b4a- | router-flat-ens39 | ACTIVE | UP | False | False | de2aea51161642759a687b5768b2 | | a3c6-13d15c4f9665 | | | | | | 3b7e | +------------------------------+-------------------+--------+-------+-------------+-------+------------------------------+ ........</p> <h2 id=portroutersubnet><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#portroutersubnet>删除所有port、router、subnet后，再用如下命令检查一遍，应该为空</a></h2> <p>openstack port list</p> <p>接下来，我们将控制节点（neutron管理节点）与计算节点的OVS交于ODL管理。 首先停止相应服务。</p> <h2 id=_4><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#_4>计算节点，如果与控制节点相同则优先运行此部分内容</a></h2> <p>systemctl stop neutron-openvswitch-agent systemctl disable neutron-openvswitch-agent systemctl stop neutron-l3-agent systemctl disable neutron-l3-agent</p> <h2 id=neutron><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#neutron>Neutron控制节点</a></h2> <p>systemctl stop neutron-server systemctl stop neutron-l3-agent</p> <p>然后清空OVS数据库。</p> <p>systemctl stop openvswitch rm -rf /var/log/openvswitch/* rm -rf /etc/openvswitch/conf.db systemctl start openvswitch</p> <h2 id=_5><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#_5>清空后可看到如下</a></h2> <p>ovs-vsctl show bdf45776-c7c2-4df4-9911-007e89b67bbe ovs_version: "2.6.1"</p> <p>将其交予ODL管理。</p> <p>ovs-vsctl set-manager tcp:192.168.0.90:6640</p> <p>然后在控制节点与计算节点设置用来vxlan通信的本地端，这里只有一个节点192.168.0.80。</p> <p>ovs-vsctl set Open_vSwitch . other_config:local_ip=192.168.0.80</p> <p>设置好以后可以在节点上看到ODL自动创建了一个连接到ODL控制器的br-int。</p> <p>ovs-vsctl show bdf45776-c7c2-4df4-9911-007e89b67bbe Manager "tcp:192.168.0.90:6640" is_connected: true Bridge br-int Controller "tcp:192.168.0.90:6653" is_connected: true fail_mode: secure Port br-int Interface br-int type: internal ovs_version: "2.6.1"</p> <p local_ip=192.168.0.80>ovs-vsctl get Open_vSwitch . other_config</p> <p>此时reloadODL界面，可以看到多了个OVS。<a href=https://blog.lofyer.org/wp-content/uploads/QQ截图20170603215631.png><img alt src=/blog/images/QQ截图20170603215631-1024x474.png></a></p> <p>接下来让neutron使用ODL，我们首先需要在neutron控制节点上安装一个对应包。</p> <p>对于将ODL放置于OS控制节点的同学可以参考如下内容以修改swift端口：</p> <blockquote> <p>First, ensure that port 8080 (which will be used by OpenDaylight to listen for REST calls) is available. By default, swift-proxy-service listens on the same port, and you may need to move it (to another port or another host), or disable that service. It can be moved to a different port (e.g. 8081) by editing /etc/swift/proxy-server.conf and /etc/cinder/cinder.conf, modifying iptables appropriately, and restarting swift-proxy-service. Alternatively, OpenDaylight can be configured to listen on a different port, by modifying the jetty.port property value in etc/jetty.conf.</p> </blockquote> <p>yum install -y python-networking-odl</p> <p>修改/etc/neutron/plugins/ml2/ml2_conf.ini并添加内容。</p> <p>crudini --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 mechanism_drivers opendaylight crudini --set /etc/neutron/plugins/ml2/ml2_conf.ini ml2 tenant_network_types vxlan</p> <h2 id=ml2_conf_odlinineutron-server><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#ml2_conf_odlinineutron-server>ml2_conf_odl.ini中的设置无效且报错，可能是我姿势不对，原因是我忘了修改neutron-server的启动命令。</a></h2> <p>cat &lt;&gt; /etc/neutron/plugins/ml2/ml2_conf.ini [ml2_odl] url = http://192.168.0.90:8080/controller/nb/v2/neutron password = admin username = admin EOF</p> <p>然后修改服务后端为ODL。</p> <p>crudini --set /etc/neutron/neutron.conf DEFAULT service_plugins odl-router crudini --set /etc/neutron/dhcp_agent.ini DEFAULT force_metadata True crudini --set /etc/neutron/dhcp_agent.ini ovs ovsdb_interface vsctl</p> <p>重置neutron数据库并重启服务。</p> <p>mysql -e "DROP DATABASE IF EXISTS neutron_ml2;" -uroot -p mysql -e "CREATE DATABASE neutron_ml2 CHARACTER SET utf8;" -uroot -p neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head systemctl start neutron-server</p> <p>验证是否成功。</p> <p>curl -u admin:admin http://192.168.0.90:8080/controller/nb/v2/neutron/networks { "networks" : [ ] }</p> <p>最后在openstack中创建网络与实例。</p> <p>neutron router-create router1 neutron net-create private neutron subnet-create private --name=private_subnet 10.10.5.0/24 neutron router-interface-add router1 private_subnet nova boot --flavor <flavor> --image <image id> --nic net-id=<network id> test1 nova boot --flavor <flavor> --image <image id> --nic net-id=<network id> test2</p> <p>添加浮动IP。</p> <p>ovs-vsctl set Open_vSwitch . other_config:provider_mappings=physnet1:eth1 neutron net-create public-net -- --router:external --is-default --provider:network_type=flat --provider:physical_network=physnet1 neutron subnet-create --allocation-pool start=10.10.10.2,end=10.10.10.254 --gateway 10.10.10.1 --name public-subnet public-net 10.10.0.0/16 -- --enable_dhcp=False neutron router-gateway-set router1 public-net</p> <p>neutron floatingip-create public-net nova floating-ip-associate test1 <floating_ip></p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信截图_20170616131118.png><img alt src=/blog/images/微信截图_20170616131118.png></a></p> <p>在OpenStack O版中创建网络时ODL与OS分别出现如下错误。</p> <p>ODL: 2017-06-03 11:27:10,768 | ERROR | pool-46-thread-1 | QosInterfaceStateChangeListener | 350 - org.opendaylight.netvirt.neutronvpn-impl - 0.3.3.Boron-SR3 | Qos:Exception caught in Interface Operational State Up event java.lang.IllegalArgumentException: Supplied value "tapd5e5b153-39" does not match required pattern "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}<span class=arithmatex>\(" at com.google.common.base.Preconditions.checkArgument(Preconditions.java:145)[65:com.google.guava:18.0.0] at org.opendaylight.yang.gen.v1.urn.ietf.params.xml.ns.yang.ietf.yang.types.rev130715.Uuid.&lt;init&gt;(Uuid.java:55)[80:org.opendaylight.mdsal.model.ietf-yang-types-20130715:2013.7.15.9_3-Boron-SR3] at org.opendaylight.netvirt.neutronvpn.QosInterfaceStateChangeListener.add(QosInterfaceStateChangeListener.java:61)[350:org.opendaylight.netvirt.neutronvpn-impl:0.3.3.Boron-SR3] at org.opendaylight.netvirt.neutronvpn.QosInterfaceStateChangeListener.add(QosInterfaceStateChangeListener.java:27)[350:org.opendaylight.netvirt.neutronvpn-impl:0.3.3.Boron-SR3] at org.opendaylight.genius.datastoreutils.AsyncDataTreeChangeListenerBase\)</span>DataTreeChangeHandler.run(AsyncDataTreeChangeListenerBase.java:136)[310:org.opendaylight.genius.mdsalutil-api:0.1.3.Boron-SR3] at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)[:1.8.0_131] at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)[:1.8.0_131] at java.lang.Thread.run(Thread.java:748)[:1.8.0_131]</p> <p>OS: ERROR neutron.plugins.ml2.managers [req-8174eb6e-6a01-428e-9c3d-d9f115dfa36b - - - - -] Failed to bind port d5e5b153-390a-4129-babd-7work': None, 'id': u'f01e69c5-096e-4d01-a239-5dbe37005e9b', 'network_type': u'vxlan'}]</p> <p>原因可能是版本传参变了，ODL没及时更新，但我不会Java，会也不想去改ODL，所以我推荐读者用个老版本的Neutron，比如M版、N版啥的。</p> <h3 id=34-ovsvtep><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#34-ovsvtep>3.4. OVS创建vtep</a></h3> <p>IP： 192.168.0.101</p> <h3 id=35-openstacksdn><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#35-openstacksdn>3.5. OpenStack与SDN交换机集成</a></h3> <p>在ODL结束以后，我们再来试一下OpenStack与SDN交换机的集成，与上一节相互独立，即一个全新的OpenStack Newton环境。</p> <p>由于商业法务问题，我不会将Pica8的OpenStack插件源码全部放出来，另外放出来意义也不大，现有SDN交换机的同学可以直接向厂商索要。</p> <p>/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/</p> <p>Pica8交换机工作在OVS模式下，需要将neutron server与OVS Manager相连（管理网口），或许有其他方法。</p> <p>首先将插件文件拷贝至/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/，目录结构如下。</p> <p>/usr/lib/python2.7/site-packages/neutron/plugins/ml2/drivers/pica8/ ├── config.pyc ├── db.pyc ├── exceptions.pyc ├── <strong>init</strong>.pyc ├── mechanism_pica8.pyc ├── ml2_conf_pica8.ini ├── rpc.pyc └── vtep.ovsschema</p> <p>修改/usr/lib/python2.7/site-packages/neutron-9.3.1-py2.7.egg-info/entry_points.txt添加neutron驱动。</p> <p>... [neutron.ml2.mechanism_drivers] ... pica8 = neutron.plugins.ml2.drivers.pica8.mechanism_pica8:Pica8Driver ...</p> <p>创建/etc/neutron/plugins/ml2/ml2_conf_pica8.ini，并添加如下内容。</p> <p>[ml2_pica8]</p> <h2 id=listopt-list-of-other-vteps-ip-address-either-a-software-vtep-or><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#listopt-list-of-other-vteps-ip-address-either-a-software-vtep-or>(ListOpt) List of other VTEPs' IP address, either a software vtep or</a></h2> <h2 id=other-vendors-hardware-vtep><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#other-vendors-hardware-vtep>other vendor's hardware vtep.</a></h2> <h2 id=_6><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#_6></a></h2> <h2 id=example-vtep_list100010010001011000102><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#example-vtep_list100010010001011000102>Example: vtep_list=10.0.0.100,10.0.0.101,10.0.0.102</a></h2> <p>vtep_list=192.168.0.101</p> <h2 id=intopt-sync-interval-in-seconds-between-neutron-plugin-and-picaos><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#intopt-sync-interval-in-seconds-between-neutron-plugin-and-picaos>(IntOpt) Sync interval in seconds between Neutron plugin and PicaOS.</a></h2> <h2 id=this-field-defines-how-often-the-synchronization-is-performed><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#this-field-defines-how-often-the-synchronization-is-performed>This field defines how often the synchronization is performed.</a></h2> <h2 id=this-is-an-optional-field-if-not-set-a-value-of-180-seconds><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#this-is-an-optional-field-if-not-set-a-value-of-180-seconds>This is an optional field. If not set, a value of 180 seconds</a></h2> <h2 id=is-assumed><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#is-assumed>is assumed.</a></h2> <h2 id=_7><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#_7></a></h2> <p>sync_interval = 60</p> <h2 id=example-sync_interval-60><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#example-sync_interval-60>Example: sync_interval = 60</a></h2> <p>openstack_version = newton</p> <h2 id=example-openstack_version-kilo><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#example-openstack_version-kilo>Example: openstack_version = kilo</a></h2> <h2 id=picos-switch-configurations><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#picos-switch-configurations>PicOS Switch configurations.</a></h2> <h2 id=each-switch-to-be-managed-by-openstack-neutron-must-be-configured-here><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#each-switch-to-be-managed-by-openstack-neutron-must-be-configured-here>Each switch to be managed by Openstack Neutron must be configured here.</a></h2> <h2 id=format><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#format>Format:</a></h2> <p>[ml2_mech_pica_switch:192.168.0.250] =:,,... =: # =:project_name,,vni, # ...</p> <h2 id=ovsdb_port><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#ovsdb_port>ovsdb_port=</a></h2> <h2 id=example><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#example>Example:</a></h2> <h2 id=ml2_mech_pica_switch1921680250><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#ml2_mech_pica_switch1921680250>[ml2_mech_pica_switch:192.168.0.250]</a></h2> <h2 id=te-111physnet1dev-1dev-2dev-3><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#te-111physnet1dev-1dev-2dev-3>te-1/1/1=physnet1:dev-1,dev-2,dev-3</a></h2> <h2 id=te-112physnet2dev-4><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#te-112physnet2dev-4>te-1/1/2=physnet2:dev-4</a></h2> <h2 id=te-113physnet1project_nameadminvni3535><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#te-113physnet1project_nameadminvni3535>te-1/1/3=physnet1:project_name,admin,vni,3535</a></h2> <h2 id=ovsdb_port6640><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#ovsdb_port6640>ovsdb_port=6640</a></h2> <h2 id=source_ip192168080><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#source_ip192168080>source_ip=192.168.0.80</a></h2> <p>修改/usr/lib/systemd/system/neutron-server.service文件，在${DAEMON_ARGS}字段添加pica8的引导配置，需要停止neutron-server服务并systemctl daemon-reload。</p> <p>--config-file=/etc/neutron/plugins/ml2/ml2_conf_pica8.ini</p> <p>修改/etc/neutron/plugins/ml2/ml2_conf.ini，如下。</p> <p>type_drivers = vlan,vxlan project_network_types = vxlan mechanism_drivers = pica8,openvswitch</p> <h2 id=make-sure-the-is-consistent-in-the-following-configuration><a class=toclink href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/#make-sure-the-is-consistent-in-the-following-configuration>Make sure the <physical_network> is consistent in the following configuration</a></h2> <p>bridge_mappings=<physical_network>:br-ex network_vlan_ranges = <physical_network>:1:4094</p> <p>安装python-ovs库。</p> <p>yum install -y python-pip pip install ovs</p> <p>运行如下命令创建pica8插件数据库动作。</p> <p>neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini revision -m "add pica8 mechanism driver" --expand</p> <p>在生成的/usr/lib/python2.7/site-packages/neutron/db/migration/alembic_migrations/versions/newton/expand/94ca4fc9191b_add_pica8_mechanism_driver.py文件中添加如下内容。</p> <p>def upgrade(): op.create_table( 'pica8_interfaces_v2', sa.Column('id', sa.String(length=36), nullable=False, primary_key=True), sa.Column('switch', sa.String(length=36), nullable=False), sa.Column('interface', sa.String(10), nullable=False) ) op.create_table( 'pica8_vlan_allocations_v2', sa.Column('id', sa.String(length=36), nullable=False, primary_key=True), sa.Column('project_id', sa.String(length=255), nullable=False), sa.Column('network_id', sa.String(length=36), nullable=False), sa.Column('segmentation_id', sa.Integer, nullable=False), sa.Column('vlan_id', sa.Integer, nullable=False), sa.Column('vm_reference', sa.Integer, nullable=False, default=0), sa.Column('interface_id', sa.String(length=36), nullable=True), sa.ForeignKeyConstraint(['interface_id'], ['pica8_interfaces_v2.id'], ondelete='CASCADE') ) def downgrade(): op.drop_table('pica8_interfaces') op.drop_table('pica8_vlan_allocations_v2')</p> <p>执行如下命令升级数据库（如果失败请将最后参数替换为head）。</p> <p>neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade 94ca4fc9191b</p> <p>重启服务。</p> <p>systemctl restart openstack-nova-api systemctl restart neutron-server</p> <p>物理主机接入配置。</p> <p>Edit the file /etc/neutron/plugins/ml2/ml2_conf_pica8.ini to contain the following content: <interface_name>=<physical_network>:project_name,<project_name>,vni,<vxlan_id> <interface_name> is the interface of Pica8 switch connected to the physical host &lt; project_name &gt; is the name of the project owning the physical host <vxlan_id> is the vxlan id of the project network the physical host connects to</p> <p><a href=http://www.brianlinkletter.com/how-to-use-miniedit-mininets-graphical-user-interface/ >miniedit使用</a> <a href=http://www.pica8.com/document/v2.3/html/picos-routing-and-switching-configuration-guide>Pica8手册</a> <a href=http://docs.opendaylight.org/en/stable-boron/ >ODL手册</a> <a href=http://docs.opendaylight.org/en/stable-boron/opendaylight-with-openstack/index.html>OpenDaylight with Openstack Guide</a> <a href=http://docs.opendaylight.org/en/stable-boron/submodules/netvirt/docs/openstack-guide/openstack-with-netvirt.html#installing-opendaylight-on-an-existing-openstack>OpenStack with NetVirt</a> <a href=http://docs.opendaylight.org/en/stable-boron/submodules/netvirt/docs/openstack-guide/openstack-with-netvirt.html#installing-openstack-and-opendaylight-using-devstack>Installing OpenStack and OpenDaylight using DevStack</a> <a href=https://wiki.opendaylight.org//blog/images/5/59/CloudIntegrationwithOpenStackOVSDBNetVirt.pdf>https://wiki.opendaylight.org//blog/images/5/59/CloudIntegrationwithOpenStackOVSDBNetVirt.pdf</a></p> <nav class=md-post__action> <a href=../../2017/05/21/openstackopendaylight%E7%A1%AC%E4%BB%B6sdn%E4%BA%A4%E6%8D%A2%E6%9C%BA%E9%9B%86%E6%88%90/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-04-24 00:00:00">2017年4月24日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/my-books/ class=md-meta__link>my-books</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=kvm1><a href=../../2017/04/24/kvm%E7%A7%81%E6%9C%89%E4%BA%91%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E7%AC%AC1%E7%89%88%E9%94%99%E8%AF%AF%E4%BF%AE%E8%AE%A2%E8%AE%B0%E5%BD%95/ class=toclink>《KVM私有云架构设计与实践》第1版错误修订记录</a></h2> <p>1. P262的图9-2应当位于P265，ser2net无图。 2. 第8章部分图片不清晰，已重画。 <a href=https://blog.lofyer.org/wp-content/uploads/图8-2.png><img alt src=/blog/images/图8-2.png></a></p> <nav class=md-post__action> <a href=../../2017/04/24/kvm%E7%A7%81%E6%9C%89%E4%BA%91%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E7%AC%AC1%E7%89%88%E9%94%99%E8%AF%AF%E4%BF%AE%E8%AE%A2%E8%AE%B0%E5%BD%95/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-04-18 00:00:00">2017年4月18日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/mylife/ class=md-meta__link>mylife</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2017/04/18/%E5%86%8D%E4%B8%80%E4%B8%AA%E8%BF%91%E6%9C%9F/ class=toclink>再一个近期</a></h2> <p>最近把亚马逊购物车的几本书入了，目的是能够彻底掌握或者精通ABM建模中常用/不常用的模型。</p> <p>把DataNote写完吧，今年。</p> <p>另外我刚从亚马逊购入的书为：</p> <p>Think Complexity: Complexity Science and Computational Modeling</p> <p>Agent-Based and Individual-Based Modeling: A Practical Introduction</p> <p>Agent-based Models of the Economy: From Theories to Applications</p> <p>Agent-Based Modelling in Economics</p> <p>An Introduction to Agent-Based Modeling: Modeling Natural, Social, and Engineered Complex Systems with NetLogo (MIT Press)</p> <p>Thinking in Systems: A Primer</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/微信图片_20170428103848.jpg><img alt src=/blog/images/微信图片_20170428103848-1024x891.jpg></a></p> <nav class=md-post__action> <a href=../../2017/04/18/%E5%86%8D%E4%B8%80%E4%B8%AA%E8%BF%91%E6%9C%9F/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2017-04-10 00:00:00">2017年4月10日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 4 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=pid><a href=../../2017/04/10/%E4%B8%80%E7%A7%8D%E5%BA%94%E7%94%A8%E4%BA%8E%E4%BA%91%E5%B9%B3%E5%8F%B0%E8%B4%9F%E8%BD%BD%E7%9A%84pid%E9%9D%9E%E7%BA%BF%E6%80%A7%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/ class=toclink>一种应用于云平台负载的PID非线性控制系统设计</a></h2> <p>本文的实现效率尚有待考证，极有可能沦为扯淡文，但如果在网络资源部分可以快速应用测试。</p> <p>众所周知，很多计算机系统里的设计都可以描述为线性模型，但正如金融系统的发展，计算机系统直接面向大众以后，也会呈现出非线性的特征，比如典型的DDoS即是在系统设计之外。接下来，笔者将使用自控知识来设计一种自适应负载的云计算控制器，不仅适用于计算、也会适用于网络、存储等服务资源。</p> <p>以OpenStack平台的计算（虚拟机）为例，当用户的计算需求被量化后，那么我们就能根据其需求直接给出相应数量的计算节点。假如用户的计算需求是变化的，其值为R，且我们的程序员也是个直肠子，给出相应的计算能力为C，那么他设计的程序很有可能就是这个公式：</p> <p>N=10, R=n<em>N, C=(n+2)</em>N</p> <p>每台虚拟机的计算能力N为10，虚拟机数量为n。</p> <p>可以看出他给了两台的冗余量，啊哈，还不错。所以他期望的场景应该是这样的。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/figure_1.png><img alt src=/blog/images/figure_1.png></a></p> <p>其中黄色为实际需求，蓝色为平台提供,绿色为虚拟机数量。</p> <p>但是，假如需求呈现出短时间大量波动的话，比如下图。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/figure_2.png><img alt src=/blog/images/figure_2.png></a> 这个时候事情就不是那么美妙了，平台在即时响应的同时，伴随着大量虚拟机的上线/下线，从而造成一定的资源请求拥堵，降低控制性能。</p> <p>接下来，我们尝试引入PID回馈控制器，就是这个样子的。</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/Pid-feedback-nct-int-correct.png><img alt src=/blog/images/Pid-feedback-nct-int-correct-1024x471.png></a></p> <p>PID的Python代码实现如下：</p> <p>!/usr/bin/python</p> <p>import time</p> <p>class PID: def <strong>init</strong>(self, P=0.2, I=0.0, D=0.0):</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span>
<span class=normal>63</span>
<span class=normal>64</span>
<span class=normal>65</span>
<span class=normal>66</span>
<span class=normal>67</span>
<span class=normal>68</span>
<span class=normal>69</span>
<span class=normal>70</span>
<span class=normal>71</span>
<span class=normal>72</span></pre></div></td><td class=code><div><pre><span></span><code>    self.Kp = P
    self.Ki = I
    self.Kd = D

    self.sample_time = 0.00
    self.current_time = time.time()
    self.last_time = self.current_time

    self.clear()

def clear(self):
    #Clears PID computations and coefficients
    self.SetPoint = 0.0

    self.PTerm = 0.0
    self.ITerm = 0.0
    self.DTerm = 0.0
    self.last_error = 0.0

    # Windup Guard
    self.int_error = 0.0
    self.windup_guard = 20.0

    self.output = 0.0

def update(self, feedback_value):
    # Calculates PID value for given reference feedback

    error = self.SetPoint - feedback_value

    self.current_time = time.time()
    delta_time = self.current_time - self.last_time
    delta_error = error - self.last_error

    if (delta_time &gt;= self.sample_time):
        self.PTerm = self.Kp * error
        self.ITerm += error * delta_time

        if (self.ITerm &lt; -self.windup_guard):
            self.ITerm = -self.windup_guard
        elif (self.ITerm &gt; self.windup_guard):
            self.ITerm = self.windup_guard

        self.DTerm = 0.0
        if delta_time &gt; 0:
            self.DTerm = delta_error / delta_time

        # Remember last time and last error for next calculation
        self.last_time = self.current_time
        self.last_error = error

        self.output = self.PTerm + (self.Ki * self.ITerm) + (self.Kd * self.DTerm)

def setKp(self, proportional_gain):
    # Determines how aggressively the PID reacts to the current error with setting Proportional Gain
    self.Kp = proportional_gain

def setKi(self, integral_gain):
    # Determines how aggressively the PID reacts to the current error with setting Integral Gain
    self.Ki = integral_gain

def setKd(self, derivative_gain):
    # Determines how aggressively the PID reacts to the current error with setting Derivative Gain
    self.Kd = derivative_gain

def setWindup(self, windup):
    # unwound
    self.windup_guard = windup

def setSampleTime(self, sample_time):
    # PID that should be updated at a regular interval.
    self.sample_time = sample_time
</code></pre></div></td></tr></table></div> <p>然后在上图条件下进行PID控制，代码如下：</p> <p>import PID import time import matplotlib.pyplot as plt import numpy as np from scipy.interpolate import spline</p> <p>def test_pid(P = 0.2, I = 0.0, D= 0.0, L=100): """Self-test PID class</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span>
<span class=normal>36</span>
<span class=normal>37</span>
<span class=normal>38</span>
<span class=normal>39</span>
<span class=normal>40</span>
<span class=normal>41</span>
<span class=normal>42</span>
<span class=normal>43</span>
<span class=normal>44</span>
<span class=normal>45</span>
<span class=normal>46</span>
<span class=normal>47</span>
<span class=normal>48</span>
<span class=normal>49</span>
<span class=normal>50</span>
<span class=normal>51</span>
<span class=normal>52</span>
<span class=normal>53</span>
<span class=normal>54</span>
<span class=normal>55</span>
<span class=normal>56</span>
<span class=normal>57</span>
<span class=normal>58</span>
<span class=normal>59</span>
<span class=normal>60</span>
<span class=normal>61</span>
<span class=normal>62</span></pre></div></td><td class=code><div><pre><span></span><code>.. note::
    ...
    for i in range(1, END):
        pid.update(feedback)
        output = pid.output
        if pid.SetPoint &gt; 0:
            feedback += (output - (1/i))
        if i&gt;9:
            pid.SetPoint = 1
        time.sleep(0.02)
    ---
&quot;&quot;&quot;
pid = PID.PID(P, I, D)
pid.clear()
pid.SetPoint=0.0
pid.setSampleTime(0.01)

END = L
feedback = 0

feedback_list = []
time_list = []
setpoint_list = []

for i in range(1, END):
    pid.update(feedback)
    output = pid.output
    if pid.SetPoint &gt; 0:
        feedback += (output - (1/i))
    if i&lt;10:
        pid.SetPoint = 20
    if i&gt;20:
        pid.SetPoint = 50
    if i&gt;22:
        pid.SetPoint = 100
    if i&gt;24:
        pid.SetPoint = 10
    if i&gt;28:
        pid.SetPoint = 200
    if i&gt;30:
        pid.SetPoint = 200
    if i&gt;70:
        pid.SetPoint = 20

    feedback_list.append(feedback)
    setpoint_list.append(pid.SetPoint)
    time_list.append(i)
    time.sleep(0.02)

time_sm = np.array(time_list)
time_smooth = np.linspace(time_sm.min(), time_sm.max(), 300)
feedback_smooth = spline(time_list, feedback_list, time_smooth)

plt.plot(time_smooth, feedback_smooth)
plt.plot(time_list, setpoint_list)
plt.xlim((0, L))
plt.ylim((min(feedback_list)-0.5, max(feedback_list)+0.5))
plt.xlabel(&#39;time (s)&#39;)
plt.ylabel(&#39;PID C-R&#39;)

plt.grid(True)
plt.show()
</code></pre></div></td></tr></table></div> <p>if <strong>name</strong> == "<strong>main</strong>": test_pid(1.01, 1, 0.001, L=100)</p> <p>然后看看现在是什么样呢？</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/figure_3.png><img alt src=/blog/images/figure_3.png></a></p> <p>嗯，没错，多了一些调节量（超调量），且变化较之前平稳了一些。这些调节量是否适用于大批量的云计算环境还有待验证，但是以Web应用来看，这些调节量理应工作。</p> <p>另外，考虑到虚拟机在创建后某些应用可能短时间内不接受下调，所以我们可以动态地调节C的值，即PID的输出仅用作参考。</p> <nav class=md-post__action> <a href=../../2017/04/10/%E4%B8%80%E7%A7%8D%E5%BA%94%E7%94%A8%E4%BA%8E%E4%BA%91%E5%B9%B3%E5%8F%B0%E8%B4%9F%E8%BD%BD%E7%9A%84pid%E9%9D%9E%E7%BA%BF%E6%80%A7%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2016-11-28 00:00:00">2016年11月28日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/mylife/ class=md-meta__link>mylife</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2016/11/28/%E8%BF%91%E6%9C%9F/ class=toclink>近期</a></h2> <p>比较低靡，状况不佳。 书籍出版进入尾期，一波好几折，入圈子是要有代价的。 对模型与实验更加痴迷，由于现实所限，只得从外汇市场入手。 现在的总结与抽象能力个人感觉比以前更加强了，晚上把博客目录更新一下，还是要把书放到About里的。 亚马逊上还有几本书待买，一定很有嚼劲。 家庭方面将要迎来新开始，可喜可贺。 生活总是让人觉得平衡，有点不开心，跷跷板要垫高。</p> <nav class=md-post__action> <a href=../../2016/11/28/%E8%BF%91%E6%9C%9F/ > 继续阅读 </a> </nav> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2016-08-27 00:00:00">2016年8月27日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/mylife/ class=md-meta__link>mylife</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=-2016-08><a href=../../2016/08/27/%E8%BF%91%E6%9C%9F-2016-08/ class=toclink>近期-2016-08</a></h2> <p>整体来说心情急躁，是坏的状态。 外汇交易刚刚进入一些起步状态，新闻趋势整体OK，技术分析算法收集，然后接下来是技术分析层面的自动交易的算法，最后才是机器学习利用新闻和技术作为信号。平台方面打算部署一套OpenShift，也可作为对外的信号系统。 其他状态较为稳定，比如书籍仍在进行，第二个笔记正在写，研究生不考了，等。</p> <nav class=md-post__action> <a href=../../2016/08/27/%E8%BF%91%E6%9C%9F-2016-08/ > 继续阅读 </a> </nav> </div> </article> <nav class=md-pagination> <a href=../../ class=md-pagination__link>1</a> <a href=../../ class=md-pagination__link>2</a> <span class=md-pagination__current>3</span> <a href=../4/ class=md-pagination__link>4</a> <a href=../5/ class=md-pagination__link>5</a> <span class=md-pagination__dots>..</span> <a href=../25/ class=md-pagination__link>25</a> </nav> </div> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2022 lofyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.6c14ae12.min.js></script> <script src=../../../javascripts/config.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>