<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=lofyer><link href=https://docs.lofyer.org/blog/page/7/ rel=canonical><link href=../../../inthecloud/frontline-storage/ rel=prev><link href=../../category/lab/ rel=next><link rel=icon href=../../../images/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.34"><title>首页 - Lofyer's Blog</title><link rel=stylesheet href=../../../assets/stylesheets/main.35f28582.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title="Lofyer's Blog" class="md-header__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Lofyer's Blog </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 首页 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Index </a> </li> <li class=md-tabs__item> <a href=../../../wangsheng/ class=md-tabs__link> WangSheng </a> </li> <li class=md-tabs__item> <a href=../../../datanote/ class=md-tabs__link> Archive Docs </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> Archive Blog </a> </li> <li class=md-tabs__item> <a href=../../../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Lofyer's Blog" class="md-nav__button md-logo" aria-label="Lofyer's Blog" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Lofyer's Blog </label> <div class=md-nav__source> <a href=https://github.com/lofyer/lofyer.github.io title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> lofyer/lofyer.github.io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Index </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../wangsheng/ class=md-nav__link> <span class=md-ellipsis> WangSheng </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../../datanote/ class=md-nav__link> <span class=md-ellipsis> Archive Docs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Archive Blog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Archive Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=../../ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 首页 </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../archive/2022/ class=md-nav__link> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../category/lab/ class=md-nav__link> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=_1>首页</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-03-19 00:00:00">2014年3月19日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/inthecloud/ class=md-meta__link>inthecloud</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=-1><a href=../../2014/03/19/-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E7%9A%84%E5%BA%8F%E5%8F%B7%E9%82%A3%E4%B9%88%E5%A5%87%E8%91%A9/ class=toclink>-1. 为什么我的序号那么奇葩</a></h2> <p>好的，本文作为未来几十或者上百篇系列文章的第一篇，就不负众望地来个开场白吧：</p> <p><strong>序号为0的那篇注定作为系列文章（姑且称之为“书”吧）的序言了，但是又不好意思当-0，就-1吧，跟大家随便聊聊。</strong></p> <p>从07年那会儿，甚至更早，拥有千万用户（包括盗版受害者在内）的行业先锋VMware，又有Google数据中心以及Amazon各种在线服务，这些实打实的东西遵循计算能力的摩尔定律，再顺应日益增长的商业需求，就有了“云”和“大数据”这两个让许多企业再次躁动的概念。</p> <p>稍微有些行业经验（至少以为是或者看来是）的人觉得这俩只是个噱头；搞大型机的说，嗯，这个，呵呵；搞IDC的觉得一台机器现在当二十台甚至更多卖，不错；搞互联网服务的就有些挠头，咦，这啥？噢，就那玩意儿啊，干嘛起这名？</p> <p>不管大家都怎么看吧，先引用一句关于“大数据”的经典：</p> <p><em>“Big Data is like teenage sex: everyone talks about it, nobody really knows how to do it, everyone thinks everyone else is doing it, so everyone claims they are doing it.”</em></p> <p>有时，你我或许都会有迷惘，我这么做（说），对么？</p> <p>那就这样吧，<strong>但行好事，莫问前程</strong>。</p> <p>顺便提一下，本“书”对读者的要求是：<strong>1.没阅读障碍；2.能提出尽量没有偏见的问题。</strong></p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-02-10 00:00:00">2014年2月10日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/cloud-infra/ class=md-meta__link>cloud-infra</a></li> <li class=md-meta__item> 需要 27 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=deploy-asterisk-on-centos><a href=../../2014/02/10/deploy-asterisk-on-centos/ class=toclink>Deploy Asterisk on CentOS</a></h2> <p>Get the latest packages. <strong>up to 2014-02-10</strong></p> <h2 id=rpm-uvh-httppackagesasteriskorgcentos6currentx86_64rpmsasterisknow-version-301-2_centos6noarchrpm><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#rpm-uvh-httppackagesasteriskorgcentos6currentx86_64rpmsasterisknow-version-301-2_centos6noarchrpm>rpm -Uvh http://packages.asterisk.org/centos/6/current/x86_64/RPMS/asterisknow-version-3.0.1-2_centos6.noarch.rpm</a></h2> <h2 id=yum-install-asterisk-asterisk-configs-enablerepoasterisk-12><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-asterisk-asterisk-configs-enablerepoasterisk-12>yum install asterisk asterisk-configs --enablerepo=asterisk-12</a></h2> <h2 id=yum-install-dahdi-linux-dahdi-tools-libpri><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-dahdi-linux-dahdi-tools-libpri>yum install dahdi-linux dahdi-tools libpri</a></h2> <h2 id=chkconfig-dahdi-on><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-dahdi-on>chkconfig dahdi on</a></h2> <h2 id=chkconfig-asterisk-on><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-asterisk-on>chkconfig asterisk on</a></h2> <h2 id=service-dahdi-start><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-dahdi-start>service dahdi start</a></h2> <h2 id=service-asterisk-start><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-asterisk-start>service asterisk start</a></h2> <p>You can use freepbx on http://localhost .</p> <h2 id=yum-install-freepbx><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-freepbx>yum install freepbx</a></h2> <hr> <p>title: "use MAXS to control your device via ejabberd(plus ssh, jingle voice talk as a bonus)" date: 2014-02-26 categories: - "cloud-infra"</p> <hr> <p>Let's see what we have got here: A xmpp server based on ejabberd on my host: lofyer.org. Windows client: <a href=https://download.jitsi.org/jitsi/nightly/ >Jitsi(Recommended)</a>, <a href=http://www.pidgin.im/ >Pidgin</a>. (Optional)A Android client: <a href=http://www.xabber.org/ >Xabber.</a> <a href=http://f-droid.org/wiki/page/org.projectmaxs.main>MAXS</a> on my Nexus 5 Android phone.</p> <h3 id=1-prepare-the-serverdebian-7><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#1-prepare-the-serverdebian-7>1. Prepare the server(Debian 7)</a></h3> <h2 id=apt-get-install-ejabberd><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#apt-get-install-ejabberd>apt-get install ejabberd</a></h2> <h2 id=cd-etcejabberd-wget-httppeoplecollaboracomrobot101olpc-ejabberdejabberdcfg><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#cd-etcejabberd-wget-httppeoplecollaboracomrobot101olpc-ejabberdejabberdcfg>cd /etc/ejabberd/; wget http://people.collabora.com/~robot101/olpc-ejabberd/ejabberd.cfg</a></h2> <p>Change <strong>hosts</strong> and <strong>admin</strong> section to your <strong>FQDN</strong>. Here's a example:</p> <p>{hosts, ["lofyer.org"]}. {acl, admin, {user, "mypassword", "lofyer.org"}}.</p> <p>Then you should restart ejabberd, and maybe a reboot is essential.</p> <h2 id=etcinitdejabberd-restart><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#etcinitdejabberd-restart>/etc/init.d/ejabberd restart</a></h2> <h4 id=enable-jinglevoice-and-video><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#enable-jinglevoice-and-video>Enable Jingle(voice and video)</a></h4> <p>You need JingleNodes module on your server.</p> <h2 id=apt-get-install-erlang-tools><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#apt-get-install-erlang-tools>apt-get install erlang-tools</a></h2> <h2 id=git-clone-gitgitprocess-onenetexmppmainlinegit-exmpp><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#git-clone-gitgitprocess-onenetexmppmainlinegit-exmpp>git clone git://git.process-one.net/exmpp/mainline.git exmpp</a></h2> <h2 id=cd-exmpp-configure-make-make-install><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#cd-exmpp-configure-make-make-install>cd exmpp; ./configure; make; make install</a></h2> <h2 id=svn-checkout-httpjinglenodesgooglecodecomsvn-jinglenodes><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#svn-checkout-httpjinglenodesgooglecodecomsvn-jinglenodes>svn checkout http://jinglenodes.googlecode.com/svn/ jinglenodes</a></h2> <h2 id=cd-jinglenodes-configure-prefixusr-make-make-install><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#cd-jinglenodes-configure-prefixusr-make-make-install>cd jinglenodes; ./configure --prefix=/usr/; make; make install</a></h2> <p>Add following content to your ejabberd.cfg in the <strong>modules</strong> section.</p> <p>{mod_jinglenodes, [ {host, "jinglenodes.@HOST@"}, {public_ip, "192.168.1.148"}, {purge_period, 5000}, {relay_timeout, 60000} ]},</p> <h4 id=enable-web-registeroptional><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#enable-web-registeroptional>Enable web register(optional)</a></h4> <p>Add to ejabberd.cfg, 'modules' section the basic configuration:</p> <p>{modules, [ ... {mod_register_web, []}, ... ]}.</p> <p>In the 'listen' section enable the web page:</p> <p>{listen, [ ... {5281, ejabberd_http, [ tls, {certfile, "/etc/ejabberd/ejabberd.pem"}, {request_handlers, [ {["register"], mod_register_web} ]} ]}, ... ]}.</p> <h4 id=use-your-own-certificate><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#use-your-own-certificate>Use your own certificate</a></h4> <p>openssl req -new -x509 -newkey rsa:1024 -days 3650 -keyout privkey.pem -out server.pem openssl rsa -in privkey.pem -out privkey.pem cat privkey.pem &gt;&gt; server.pem rm privkey.pem</p> <p>The port numbers you should open are: 5281(http://localhost:5281/register/) 5280(http://localhost:5280/admin) and 5222(for c2s).</p> <p>Register users:</p> <h2 id=ejabberdctl-register-admin-lofyerorg-mypassword><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ejabberdctl-register-admin-lofyerorg-mypassword>ejabberdctl register admin lofyer.org mypassword</a></h2> <h2 id=ejabberdctl-register-myphone-lofyerorg-mypassword><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ejabberdctl-register-myphone-lofyerorg-mypassword>ejabberdctl register myphone lofyer.org mypassword</a></h2> <h2 id=ejabberdctl-register-mypc-lofyerorg-mypassword><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ejabberdctl-register-mypc-lofyerorg-mypassword>ejabberdctl register mypc lofyer.org mypassword</a></h2> <h3 id=2-pidgin-and-maxs-test><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#2-pidgin-and-maxs-test>2. Pidgin and MAXS test</a></h3> <h3 id=pidgin-adminlofyerorg-maxs-myphonelofyerorg-by-the-way-guarantee-that-there-is-only-one-running-jabber-client-on-your-phone-during-this-period-pidgin-add-a-friend-shell-test-sms-test-and-a-msg-to-my-gf><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#pidgin-adminlofyerorg-maxs-myphonelofyerorg-by-the-way-guarantee-that-there-is-only-one-running-jabber-client-on-your-phone-during-this-period-pidgin-add-a-friend-shell-test-sms-test-and-a-msg-to-my-gf>Pidgin: admin@lofyer.org MAXS: myphone@lofyer.org By the way, guarantee that there is only one running jabber client on your phone during this period. <strong>Pidgin</strong> Add a friend <a href=http://blog.lofyer.org/ejabber-howto/pidgin/ ><img alt=pidgin src=/blog/images/pidgin.png></a> <strong>Shell test</strong> <a href=http://blog.lofyer.org/ejabber-howto/shell/ ><img alt=shell src=/blog/images/shell.png></a> <strong>SMS test</strong> <a href=http://blog.lofyer.org/ejabber-howto/sms-send/ ><img alt=SMS-SEND src=/blog/images/SMS-SEND.png></a> And a msg to my GF. <a href=http://blog.lofyer.org/ejabber-howto/sms-receive/ ><img alt=sms-receive src=/blog/images/sms-receive.jpg></a></a></h3> <p>title: "foreman/puppet/cfengine/bcfg2/chef howto" date: 2014-02-21 categories: - "linux-admin"</p> <hr> <h3 id=which-one-is-the-best-automatic-management-tool-tbd><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#which-one-is-the-best-automatic-management-tool-tbd><a href=http://uberblo.gs/2012/06/cfengine-bcfg2-chef-and-puppet title=cfengine-bcfg2-chef-and-puppet>Which one is the best automatic management tool</a> TBD</a></h3> <p>title: "Gitlab quick deploy" date: 2014-06-08 categories: - "linux-admin"</p> <hr> <p>Well, Gitweb + ssh://git@host is out of date. Even we use it for almost 2 years.</p> <p>We are migrating our repositories to Gitlab which we benefit from its "issue" a lot.</p> <p>Please follow this scripts I wrote.</p> <h3 id=httpsrawgithubusercontentcomlofyeronekey-deploymastergitlabinstallsh><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#httpsrawgithubusercontentcomlofyeronekey-deploymastergitlabinstallsh><a href=https://raw.githubusercontent.com/lofyer/onekey-deploy/master/gitlab/install.sh title="Gitlab quick deploy">https://raw.githubusercontent.com/lofyer/onekey-deploy/master/gitlab/install.sh</a></a></h3> <p>title: "Grafana+InfluxDB+Collectd/Telegraf on RPi2" date: 2017-03-06 categories: - "linux-admin"</p> <hr> <p>Grafana will provide a visual view for the sites, InfluxDB is the data box, and collectd/telegraf is the agent on the server. Here we go.</p> <p><strong>Install Grafana:</strong></p> <h2 id=download-deb-from-httpsgithubcomfg2itgrafana-on-raspberry><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#download-deb-from-httpsgithubcomfg2itgrafana-on-raspberry>Download deb from https://github.com/fg2it/grafana-on-raspberry</a></h2> <p>root@raspberrypi:~# rpm -i grafana.deb root@raspberrypi:~# service grafana-server start</p> <p><strong>Install InfluxDB:</strong> Download from <a href=https://portal.influxdata.com/downloads>https://portal.influxdata.com/downloads</a></p> <p>root@raspberrypi:~# tar xf influxdb-1.2.0_linux_armhf.tar.gz root@raspberrypi:~# cp -a influxdb-1.2.0-1/* /</p> <p>vim /etc/influxdb/influxdb.ini:</p> <p>[admin] enabled=true</p> <p>[http] enabled=true</p> <p>[collectd] enabled=true bind-address=":25826" database="collectd"</p> <p>Then run "influxdb &amp;" and check it out in http://localhost:8083, add db named "collectd".</p> <p><strong>Install Collectd:</strong></p> <p>root@raspberrypi:~# apt-get install collectd</p> <p>In /etc/collectd/collectd.conf, find :</p> <p><plugin network> <server &quot;localhost&quot; &quot;25826&quot;></server> </plugin></p> <p>Then restart collectd service.</p> <h3 id=now-you-can-visit-httplocalhost3000-to-add-influxdb-source-and-add-panel><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#now-you-can-visit-httplocalhost3000-to-add-influxdb-source-and-add-panel>Now you can visit http://localhost:3000 to add InfluxDB source and add panel.</a></h3> <p>title: "Hercules with Jason UI, emulator of IBM mainframe" date: 2017-04-26 categories: - "linux-admin"</p> <hr> <p>Hercules is an open source software implementation of the mainframe System/370 and ESA/390 architectures, in addition to the new 64-bit z/Architecture. Hercules runs under Linux, Windows (98, NT, 2000, and XP), Solaris, FreeBSD, and Mac OS X (10.3 and later).</p> <p><a href=http://lofyer.org:8081/ >Online web interface.(deprecated)</a></p> <p>Jason 1.00 is an integrated graphical frontend to the Hercules S/370, ESA/390 and z/Architecture Emulator. What, you haven't heard of Hercules before? It's a masterpiece that emulates IBM mainframes, from old good IBM System/360 and up to the modern z Series... No, it has nothing to do with IBM compatible... No, it can't emulate Xbox 360... Oh, you are asking what a mainframe is? Then probably you don't need Jason.</p> <p><a href=https://blog.lofyer.org/wp-content/uploads/Hercules-with-Jason.zip>Download Hercules with Jason</a>.</p> <h3 id=_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#_1><a href=https://blog.lofyer.org/wp-content/uploads/QQ截图20170426111158.png><img alt src=/blog/images/QQ截图20170426111158-1024x545.png></a></a></h3> <p>title: "Heartbeat and drbd test high availability" date: 2014-01-16 categories: - "linux-admin"</p> <hr> <p>Hosts: 192.168.1.101 ha1.lofyer.org, 2 hard drive disks, two ethernet ports 192.168.1.103 ha2.lofyer.org, almost same as ha1</p> <p>Server host, this is the IP of heartbeat service: 192.168.1.100</p> <h3 id=install><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#install>Install</a></h3> <p>The repos you need in centos</p> <p>[epel] name=Extra Packages for Enterprise Linux 6 - $basearch</p> <h2 id=baseurlhttpdownloadfedoraprojectorgpubepel6basearch><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#baseurlhttpdownloadfedoraprojectorgpubepel6basearch>baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch</a></h2> <p>mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&amp;arch=$basearch failovermethod=priority enabled=1 gpgcheck=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-6</p> <p>[elrepo] name=ELRepo.org Community Enterprise Linux Repository - el6 baseurl=http://elrepo.org/linux/elrepo/el6/$basearch/ mirrorlist=http://elrepo.org/mirrors-elrepo.el6 enabled=1 gpgcheck=0 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-elrepo.org protect=0</p> <h2 id=yum-install-drbd84-kmod-drbd84-heartbeat-mysql-server><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-drbd84-kmod-drbd84-heartbeat-mysql-server>yum install drbd84 kmod-drbd84 heartbeat mysql-server</a></h2> <h3 id=setup><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#setup>Setup</a></h3> <h4 id=1-drbd-configuration-both-hosts><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#1-drbd-configuration-both-hosts>1. Drbd configuration both hosts</a></h4> <p><strong>Add following content to file: /etc/hosts</strong></p> <p>192.168.1.101 ha1.lofyer.org 192.168.1.103 ha2.lofyer.org</p> <p><strong>Disable selinux and iptables</strong></p> <h2 id=sed-i-senforcingpermissive-etcselinuxconfig><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#sed-i-senforcingpermissive-etcselinuxconfig>sed -i 's/enforcing/permissive/' /etc/selinux/config</a></h2> <h2 id=setenforce-0><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#setenforce-0>setenforce 0</a></h2> <h2 id=chkconfig-iptables-off><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-iptables-off>chkconfig iptables off</a></h2> <h2 id=service-iptables-stop><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-iptables-stop>service iptables stop</a></h2> <p><strong>Prepare the disk partion</strong></p> <h2 id=fdisk-devsdb-eof><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#fdisk-devsdb-eof>fdisk /dev/sdb &lt;&lt; EOF</a></h2> <p>n p 1</p> <p>w EOF</p> <p><strong>Configuration for mysql</strong> # mkdir db # sed -i 's/datadir=\/var\/lib\/mysql/datadir=\/db/' /etc/my.cnf <strong>Configuration for drbd</strong> file: /etc/drbd.conf</p> <p>global { minor-count 64; usage-count yes; } common { syncer { rate 1000M; } } resource ha { protocol C; handlers { pri-on-incon-degr "/usr/lib/drbd/notify-pri-on-incon-degr.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"; pri-lost-after-sb "/usr/lib/drbd/notify-pri-lost-after-sb.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"; local-io-error "/usr/lib/drbd/notify-local-io-error.sh; /usr/lib/drbd/notify-emergency-shutdown.sh; echo o &gt; /proc/sysrq-trigger ; halt -f"; fence-peer /usr/lib/heartbeat/drbd-peer-outdater -t 5; pri-lost "/usr/lib/drbd/notify-pri-lost.sh; /usr/lib/drbd/notify-emergency-reboot.sh; echo b &gt; /proc/sysrq-trigger ; reboot -f"; split-brain "/usr/lib/drbd/notify-split-brain.sh root"; out-of-sync "/usr/lib/drbd/notify-out-of-sync.sh root"; } startup { wfc-timeout 60; degr-wfc-timeout 120; outdated-wfc-timeout 2; } disk { on-io-error detach; fencing resource-only; } syncer { rate 1000M; } on ha1.lofyer.org { device /dev/drbd0; disk /dev/sdb1; address 192.168.1.101:7788; meta-disk internal; } on ha2.lofyer.org { device /dev/drbd0; disk /dev/sdb1; address 192.168.1.103:7788; meta-disk internal; } }</p> <p><strong>Chmod for drbd</strong></p> <p># chgrp haclient /sbin/drbdsetup # chmod o-x /sbin/drbdsetup # chmod u+s /sbin/drbdsetup # chgrp haclient /sbin/drbdmeta # chmod o-x /sbin/drbdmeta # chmod u+s /sbin/drbdmeta</p> <p><strong>Resource for drbd</strong></p> <p># modprobe drbd # dd if=/dev/zero of=/dev/hdb1 bs=1M count=100 # drbdadm create-md ha # service drbd start # chkconfig drbd on </p> <p><strong>Watch drbd status</strong></p> <h2 id=watch-n-1-service-drbd-status><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#watch-n-1-service-drbd-status>watch -n 1 service drbd status</a></h2> <p>You can see that both hosts are Secondary/Secondary.</p> <h4 id=2-drbd-configuration-on-one-of-hosts-like-ha1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#2-drbd-configuration-on-one-of-hosts-like-ha1>2. Drbd configuration on one of hosts, like ha1</a></h4> <p><strong>Make ha1 Primary</strong></p> <p># drbdadm -- --overwrite-data-of-peer primary ha # service drbd status</p> <p>Then you should see Primary and wait for both hosts are UpToDate. <strong>Initialization for Mysql</strong> Make a</p> <h2 id=mkfsext4-devdrbd0><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#mkfsext4-devdrbd0>mkfs.ext4 /dev/drbd0</a></h2> <h2 id=mount-devdrbd0-db><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#mount-devdrbd0-db>mount /dev/drbd0 /db</a></h2> <h2 id=service-mysqld-start><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-mysqld-start>service mysqld start</a></h2> <p>Now you should see what you have got in /db, then umount /db, stop mysql-server and make ha1 Secondary.</p> <h2 id=service-mysqld-stop><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-mysqld-stop>service mysqld stop</a></h2> <h2 id=umount-devdrbd0><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#umount-devdrbd0>umount /dev/drbd0</a></h2> <h2 id=drbdadm-secondary-ha><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#drbdadm-secondary-ha>drbdadm secondary ha</a></h2> <h4 id=3-heartbeat-configuration-on-both-hosts><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#3-heartbeat-configuration-on-both-hosts>3. Heartbeat configuration on both hosts</a></h4> <p><strong>cluster authkey</strong></p> <h2 id=echo-ne-auth-1n1-sha1-dd-ifdevurandom-bs512-count1-openssl-md5-etchadauthkeys><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#echo-ne-auth-1n1-sha1-dd-ifdevurandom-bs512-count1-openssl-md5-etchadauthkeys>(echo -ne "auth 1\n1 sha1 "; dd if=/dev/urandom bs=512 count=1 | openssl md5) &gt; /etc/ha.d/authkeys</a></h2> <h2 id=cat-etchadauthkeys><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#cat-etchadauthkeys>cat /etc/ha.d/authkeys</a></h2> <p>auth 1 1 sha1 71461fc5e160d7846c2f4b524f952128</p> <h2 id=chmod-600-etchadauthkeys><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chmod-600-etchadauthkeys>chmod 600 /etc/ha.d/authkeys</a></h2> <h2 id=scp-etchadauthkeys-node2etchad><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#scp-etchadauthkeys-node2etchad>scp /etc/ha.d/authkeys node2:/etc/ha.d/</a></h2> <p>YOU SHOULD MODIFY THE IP IN THE FILE. file: /etc/ha.d/ha.cf</p> <p>debugfile /var/log/ha-debug logfile /var/log/ha-log logfacility local0 autojoin none ucast eth0 192.168.1.101 ucast eth1 192.168.1.102 ping 192.168.1.100 respawn hacluster /usr/lib64/heartbeat/ipfail respawn hacluster /usr/lib64/heartbeat/dopd apiauth dopd gid=haclient uid=hacluster udpport 694 warntime 5 deadtime 15 initdead 60 keepalive 2 node ha1.lofyer.org node ha2.lofyer.org auto_failback off </p> <p>The service will be serve on IP 192.168.1.100. file: /etc/ha.d/haresources</p> <p>mysql.lofyer.org 192.168.1.100 drbddisk::ha Filesystem::/dev/drbd0::/db::ext4 mysql</p> <p>If you just wanna a virtual ip, use this</p> <p>hosta.vf.com IPaddr::192.168.0.100/24/eth0:0</p> <p><strong>Add mysql entry to heartbeat</strong> file: /etc/ha.d/resource.d/mysql</p> <h2 id=binbash><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#binbash>!/bin/bash</a></h2> <p>. /etc/ha.d/shellfuncs case "<span class=arithmatex>\(1" in start) res=\`/etc/init.d/mysqld start\` ret=\)</span>? ha_log $res exit <span class=arithmatex>\(ret ;; stop) res=\`/etc/init.d/mysqld stop\` ret=\)</span>? ha_log $res exit $ret ;; status) if [[ `ps -ef | grep '[m]ysqld'` &gt; 1 ]]; then echo "running" else echo "stopped" fi ;; *) echo "Usage: mysqld {start|stop|status}" exit 1 ;; esac exit 0</p> <p>Add excute permission to it.</p> <h2 id=chmod-755-etchadresourcedmysql><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chmod-755-etchadresourcedmysql>chmod 755 /etc/ha.d/resource.d/mysql</a></h2> <p><strong>Add heartbeat service to system</strong></p> <h2 id=chkconfig-add-heartbeat><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-add-heartbeat>chkconfig --add heartbeat</a></h2> <h2 id=chkconfig-heartbeat-on><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-heartbeat-on>chkconfig heartbeat on</a></h2> <h2 id=service-heartbeat-start><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-heartbeat-start>service heartbeat start</a></h2> <p><em>You may need modify order of drbd and heartbeat service. In /etc/init.d/, the number 85 and 15 represent the order number which the script is to be run at start up time and shutdown time. # chkconfig: - 85 15</em></p> <h3 id=test-ha><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#test-ha>Test HA</a></h3> <hr> <p>title: "ltsp相关" date: 2013-03-15 categories: - "linux-admin"</p> <hr> <p>参考： https://help.ubuntu.com/community/UbuntuLTSP</p> <p>安装： apt-get install ltsp-server-standalone</p> <p>启动要素： nbd-server dhcpd tftp-hpa openssh-server</p> <p>绑定客户端地址： [dhcpd.conf] host client201 { hardware ethernet 08:00:27:89:70:01; fixed-address 192.168.0.201; } 另外一种是在启动pxe配置文件中指定 http://wiki.phys.ethz.ch/readme/setting_up_an_ltsp_server_for_diskless_clients</p> <p>session &amp; windows [/usr/share/xsession/*] Exec=/root/.xsession</p> <p>[/root/.xsession] #!/bin/bash gnome-session &amp; firefox logout</p> <p>获取session list [/usr/share/ldm/ldminfod] [/etc/X11/xinit/Xsession] [/etc/X11/Xsession] **failsafe [/etc/X11/xdm/Xsession] [/usr/lib/X11/xdm/Xsession] *[/usr/share/xsession]</p> <p>**default session exported by Xsession.d echo $DEFAULTS_PATH /usr/share/gconf/</p> <p>修改default session [/var/lib/tftp.../lts.conf] LDM_SESSION="gnome-session &amp;;firefox;logout"</p> <p>FatClient [/var/lib/tftp.../lts.conf] [default] LDM_DIRECTX=true</p> <p>[00:A1:08:EB:43:27] LTSP_FATCLIENT=false</p> <p>AutoLogin [/var/lib/tftp.../lts.conf] [Default] LDM_AUTOLOGIN = True</p> <p>[192.168.1.101] LDM_USERNAME = user1 LDM_PASSWORD = password1</p> <p>[192.168.1.102] LDM_USERNAME = user2 LDM_PASSWORD = password2</p> <h3 id=ltsconf-global-defaults-for-all-clients-if-you-refer-to-the-local-server-just-use-the-server-keyword-as-value-see-lts_parameterstxt-for-valid-values-default-x_color_depth24-localdevtrue-soundtrue-use_local_swaptrue-nbd_swapfalse-syslog_hostserver-xkblayoutde-screen_02shell-screen_03shell-screen_04shell-screen_05shell-screen_06shell-screen_07ldm-ldm_directxtrue-allows-greater-scalability-and-performance-turn-this-off-if-you-want-greater-security-instead-ldm_directxtrue-ldm_syslogtrue-writes-to-servers-syslog-ldm_syslogtrue><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ltsconf-global-defaults-for-all-clients-if-you-refer-to-the-local-server-just-use-the-server-keyword-as-value-see-lts_parameterstxt-for-valid-values-default-x_color_depth24-localdevtrue-soundtrue-use_local_swaptrue-nbd_swapfalse-syslog_hostserver-xkblayoutde-screen_02shell-screen_03shell-screen_04shell-screen_05shell-screen_06shell-screen_07ldm-ldm_directxtrue-allows-greater-scalability-and-performance-turn-this-off-if-you-want-greater-security-instead-ldm_directxtrue-ldm_syslogtrue-writes-to-servers-syslog-ldm_syslogtrue>一些参考配置 [lts.conf] # Global defaults for all clients # if you refer to the local server, just use the # "server" keyword as value # see lts_parameters.txt for valid values ################ [default] X_COLOR_DEPTH=24 LOCALDEV=True SOUND=True USE_LOCAL_SWAP=True NBD_SWAP=False SYSLOG_HOST=server #XKBLAYOUT=de SCREEN_02=shell SCREEN_03=shell SCREEN_04=shell SCREEN_05=shell SCREEN_06=shell SCREEN_07=ldm # LDM_DIRECTX=True allows greater scalability and performance # Turn this off if you want greater security instead. LDM_DIRECTX=True # LDM_SYSLOG=True writes to server's syslog LDM_SYSLOG=True</a></h3> <p>title: "IPA服务器搭建" date: 2012-11-27 categories: - "linux-admin"</p> <hr> <p>IPASERVER+DNS(DDWRT)+IPACLIENT</p> <p>SERVER: ipa-server-install时这里可以不要内部dns 注意host以及domain要在dns里有记录 添加用户 ipa user-add 设置密码 ipa passwd demo DNS: 下面是ddwrt的dnsmasq配置 <code>domain=ovirt.engine local=/ovirt.engine/ expand-hosts address=/ovirtmgmt.ovirt.engine/192.168.1.106 ptr-record=106.1.168.192.in-addr.arpa,"ovirtmgmt.ovirt.engine" address=/ipa.ovirt.engine/192.168.1.108 ptr-record=108.1.168.192.in-addr.arpa,"ipa.ovirt.engine" srv-host=_kerberos-master._tcp,ipa.ovirt.engine,88,0,100 srv-host=_kerberos-master._udp,ipa.ovirt.engine,88,0,100 srv-host=_kerberos._tcp,ipa.ovirt.engine,88,0,100 srv-host=_kerberos._udp,ipa.ovirt.engine,88,0,100 srv-host=_kpasswd._tcp,ipa.ovirt.engine,464,0,100 srv-host=_kpasswd._udp,ipa.ovirt.engine,464,0,100 srv-host=_ldap._tcp,ipa.ovirt.engine,389,0,100</code> <a href=http://69.164.197.168/wp-content/uploads/2012/11/QQ截图20121127132532.png><img alt src=/blog/images/QQ截图20121127132532.png title=QQ截图20121127132532></a></p> <p>IPACLIENT: install时注意域名及主机名正确</p> <p>OVIRT: 初次使用要在SERVER运行 kinit admin</p> <h3 id=reinstall-ipa-server-install-uninstall-u-ls-ld-varlibpki-ca-if-it-exists-run-pkiremove-pki_instance_rootvarlib-pki_instance_namepki-ca-force-yum-reinstall-pki-selinux><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#reinstall-ipa-server-install-uninstall-u-ls-ld-varlibpki-ca-if-it-exists-run-pkiremove-pki_instance_rootvarlib-pki_instance_namepki-ca-force-yum-reinstall-pki-selinux>reinstall出错时： # ipa-server-install --uninstall -U # ls -ld /var/lib/pki-ca If it exists run: # pkiremove -pki_instance_root=/var/lib -pki_instance_name=pki-ca --force # yum reinstall pki-selinux</a></h3> <p>title: "Intergrate owncloud with AD(LDAP)" date: 2014-04-24 categories: - "linux-admin"</p> <hr> <p>Windows 2008R2 server with AD role built. User group: <strong>owncloudgrp</strong> User in <strong>owncloudgrp</strong>: aaa, beta Users must have <strong>logon name, first name, last name</strong> set.</p> <h3 id=configure-the-owncloud><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#configure-the-owncloud>Configure the owncloud:</a></h3> <p>Server:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc1/ ><img alt=oc1 src=/blog/images/oc1.png></a></p> <p>User Filter:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc2/ ><img alt=oc2 src=/blog/images/oc2.png></a></p> <p>Login Filter:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc3/ ><img alt=oc3 src=/blog/images/oc3.png></a></p> <p>Group Filter: Every time you change these two sections, <strong>wait for a few seconds</strong> until more than zero users discovered.</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc4/ ><img alt=oc4 src=/blog/images/oc4.png></a></p> <p>Advanced - Connection Settings:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc5/ ><img alt=oc5 src=/blog/images/oc5.png></a></p> <p>Advanced - Directory Settings:</p> <p><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc6/ ><img alt=oc6 src=/blog/images/oc6.png></a></p> <p>Expert: Add internal username: sAMAccountName</p> <h3 id=_2><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#_2><a href=http://blog.lofyer.org/intergrate-owncloud-adldap/oc7/ ><img alt=oc7 src=/blog/images/oc7.png></a></a></h3> <p>title: "use Foreman/Nagios/Icinga to make life easy..." date: 2013-09-24 categories: - "linux-admin"</p> <hr> <h2 id=install-nagios-in-gentoocentos><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#install-nagios-in-gentoocentos>Install nagios in Gentoo/CentOS</a></h2> <h3 id=gentoo><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#gentoo>Gentoo</a></h3> <h2 id=emerge-nagios><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#emerge-nagios>emerge nagios</a></h2> <h4 id=option-recompile-apache-for-php-support><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#option-recompile-apache-for-php-support>Option: recompile apache for php support</a></h4> <p>add use flag "apache2" to /etc/portage/make.conf</p> <h2 id=emerge-ask-changed-use-deep-world><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#emerge-ask-changed-use-deep-world>emerge --ask --changed-use --deep @world</a></h2> <h4 id=copy-following-content-to-etcapache2vhostsd><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#copy-following-content-to-etcapache2vhostsd>Copy following content to /etc/apache2/vhosts.d/</a></h4> <p>ScriptAlias /nagios/cgi-bin "/usr/lib64/nagios/cgi-bin" <directory &quot; usr lib64 nagios cgi-bin&quot;></p> <h2 id=sslrequiressl><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#sslrequiressl>SSLRequireSSL</a></h2> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code>Options ExecCGI
AllowOverride None
Order allow,deny
Allow from all
</code></pre></div></td></tr></table></div> <h2 id=order-denyallow><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#order-denyallow>Order deny,allow</a></h2> <h2 id=deny-from-all><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#deny-from-all>Deny from all</a></h2> <h2 id=allow-from-127001><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#allow-from-127001>Allow from 127.0.0.1</a></h2> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code>AuthName &quot;Nagios Access&quot;
AuthType Basic
AuthUserFile /etc/nagios/auth.users
Require valid-user
</code></pre></div></td></tr></table></div> <p>Alias /nagios "/usr/share/nagios/htdocs" <directory &quot; usr share nagios htdocs&quot;></p> <h2 id=sslrequiressl_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#sslrequiressl_1>SSLRequireSSL</a></h2> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code>Options None
AllowOverride None
Order allow,deny
Allow from all
</code></pre></div></td></tr></table></div> <h2 id=order-denyallow_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#order-denyallow_1>Order deny,allow</a></h2> <h2 id=deny-from-all_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#deny-from-all_1>Deny from all</a></h2> <h2 id=allow-from-127001_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#allow-from-127001_1>Allow from 127.0.0.1</a></h2> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div><pre><span></span><code>AuthName &quot;Nagios Access&quot;
AuthType Basic
AuthUserFile /etc/nagios/auth.users
Require nagiosadmin
</code></pre></div></td></tr></table></div> <h4 id=create-password-for-nagiosadmin><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#create-password-for-nagiosadmin>Create password for nagiosadmin</a></h4> <h2 id=htpasswd2-c-etcnagiosauthusers-nagiosadmin><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#htpasswd2-c-etcnagiosauthusers-nagiosadmin>htpasswd2 -c /etc/nagios/auth.users nagiosadmin</a></h2> <h4 id=add-nagios-to-apache-config><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#add-nagios-to-apache-config>Add NAGIOS to apache config</a></h4> <p>/etc/conf.d/apache</p> <p>APACHE2_OPTS="... -D NAGIOS -D PHP5"</p> <p>Add user nagios to apache group</p> <h2 id=usermod-a-g-nagios-apache><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#usermod-a-g-nagios-apache>usermod -a -G nagios apache</a></h2> <p>Start service</p> <h2 id=rc-service-nagios-restart><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#rc-service-nagios-restart>rc-service nagios restart</a></h2> <h2 id=rc-service-apache2-restart><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#rc-service-apache2-restart>rc-service apache2 restart</a></h2> <h3 id=centos><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#centos>CentOS</a></h3> <h2 id=yum-install-nagios><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-nagios>yum install "nagios*"</a></h2> <h2 id=htpasswd-c-etcnagiospasswd-admin><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#htpasswd-c-etcnagiospasswd-admin>htpasswd -c /etc/nagios/passwd admin</a></h2> <h2 id=chkconfig-nagios-on><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-nagios-on>chkconfig nagios on</a></h2> <h2 id=chkconfig-httpd-on><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-httpd-on>chkconfig httpd on</a></h2> <h2 id=service-nagios-start><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-nagios-start>service nagios start</a></h2> <h2 id=service-httpd-start><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-httpd-start>service httpd start</a></h2> <h3 id=add-routershosts-add-service-add-hooks><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#add-routershosts-add-service-add-hooks>Add routers/hosts, add service, add hooks</a></h3> <h3 id=intergrate-with-ovirt><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#intergrate-with-ovirt>Intergrate with oVirt</a></h3> <h2 id=using-foreman><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#using-foreman>using Foreman</a></h2> <h3 id=install_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#install_1>Install</a></h3> <h3 id=use><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#use>USE</a></h3> <h3 id=intergrate-with-ovirt_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#intergrate-with-ovirt_1>Intergrate with oVirt</a></h3> <h3 id=tbd><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#tbd>TBD</a></h3> <p>title: "OAuth2 Guide" date: 2017-07-28 categories: - "linux-admin" - "draft"</p> <hr> <p>这是一篇OAuth2的入门短文，这就开始。</p> <p>整体可以参考<a href=https://www.ory.am/run-oauth2-server-open-source-api-security.html>Hydra OAuth2的搭建过程</a>，非常详细，过程就不讲了，直接看图更直观。</p> <p><img alt src=/blog/images/ORY%20Hydra%20Consent%20Flow.png></p> <h3 id=hostserverclientusercallback_urlopenid><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#hostserverclientusercallback_urlopenid>建议过程：在host上搭建server以后，创建client、user、callback_url，还能绑定OpenID，多好。</a></h3> <p>title: "OpenLDAP step by step how-to" date: 2014-04-14 categories: - "linux-admin"</p> <hr> <p>I need an authentication system with compatibility and many extended features(like bio-device). So, I've got AD, IPA and OpenLDAP to choose from. AD comes from MS and it is too "heavy" for the not-very-large system. IPA and OpenLDAP are almost same, but I prefer latter, since it's compatible with oVirt(This why I choose CentOS rather than debian).</p> <h2 id=the-simplest-openldap-server><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#the-simplest-openldap-server>The simplest OpenLDAP server</a></h2> <p>A basic LDAP without any security or additional features.</p> <h2 id=openldap-with-sasl><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#openldap-with-sasl>OpenLDAP with SASL</a></h2> <p>Add SASL to our LDAP.</p> <h2 id=openldap-with-samba><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#openldap-with-samba>OpenLDAP with SAMBA</a></h2> <p>To add Windows PC to our domain.</p> <h2 id=openldap-with-kerberos><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#openldap-with-kerberos>OpenLDAP with Kerberos</a></h2> <p>This is what we want finally. ============================================================</p> <h2 id=1-the-simplest-openldap-server><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#1-the-simplest-openldap-server>1. The simplest OpenLDAP server</a></h2> <p>I've got 2 ways to setup an openldap server: <strong>389-ds script</strong> and <strong>manually configure</strong>.</p> <h3 id=11-using-389-ds-script><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#11-using-389-ds-script>1.1 Using 389-ds script</a></h3> <p><a href=http://www.unixmen.com/setup-directory-serverldap-in-centos-6-4-rhel-6-4/ title="Setup 389-ds">Here's the original article.</a></p> <h4 id=preparation><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#preparation>Preparation</a></h4> <p>Before setup, this configuration should be modified. Add following:</p> <p>192.168.1.80 ldap.lofyer.org</p> <p>Add following:</p> <p>net.ipv4.tcp_keepalive_time = 30 net.ipv4.ip_local_port_range = 1024 65000 fs.file-max = 64000</p> <p>Add following:</p> <p>* soft nofile 8192 * hard nofile 8192</p> <p>Add following:</p> <p>session required /lib/security/pam_limits.so</p> <p>Then <strong>reboot</strong> the machine to make above configurations work.</p> <h4 id=setup-389-ds><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#setup-389-ds>Setup 389-ds</a></h4> <h2 id=useradd-ldapadmin><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#useradd-ldapadmin>useradd ldapadmin</a></h2> <h2 id=passwd-ldapadmin><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#passwd-ldapadmin>passwd ldapadmin</a></h2> <h2 id=yum-install-y-389-ds-openldap-clients><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-y-389-ds-openldap-clients>yum install -y 389-ds openldap-clients</a></h2> <h2 id=setup-ds-adminpl><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#setup-ds-adminpl>setup-ds-admin.pl</a></h2> <p>Then you'll see some questions like this(sorry for the high-lighting...):</p> <p>============================================================================== This program will set up the 389 Directory and Administration Servers.</p> <p>It is recommended that you have "root" privilege to set up the software. Tips for using this program: - Press "Enter" to choose the default and go to the next screen - Type "Control-B" then "Enter" to go back to the previous screen - Type "Control-C" to cancel the setup program</p> <p>Would you like to continue with set up? [yes]: ## Press Enter ## </p> <p>============================================================================== Your system has been scanned for potential problems, missing patches, etc. The following output is a report of the items found that need to be addressed before running this software in a production environment.</p> <p>389 Directory Server system tuning analysis version 23-FEBRUARY-2012.</p> <p>NOTICE : System is i686-unknown-linux2.6.32-431.el6.i686 (1 processor).</p> <p>WARNING: 622MB of physical memory is available on the system. 1024MB is recommended for best performance on large production system.</p> <p>WARNING : The warning messages above should be reviewed before proceeding.</p> <p>Would you like to continue? [no]: yes ## Type Yes and Press Enter ##</p> <p>============================================================================== Choose a setup type: 1. Express Allows you to quickly set up the servers using the most common options and pre-defined defaults. Useful for quick evaluation of the products. 2. Typical Allows you to specify common defaults and options. 3. Custom Allows you to specify more advanced options. This is recommended for experienced server administrators only. To accept the default shown in brackets, press the Enter key.</p> <p>Choose a setup type [2]: ## Press Enter ##</p> <p>============================================================================== Enter the fully qualified domain name of the computer on which you're setting up server software. Using the form . Example: eros.example.com.</p> <p>To accept the default shown in brackets, press the Enter key.</p> <p>Warning: This step may take a few minutes if your DNS servers can not be reached or if DNS is not configured correctly. If you would rather not wait, hit Ctrl-C and run this program again with the following command line option to specify the hostname:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code>General.FullMachineName=your.hostname.domain.name
</code></pre></div></td></tr></table></div> <p>Computer name [ldap.lofyer.org]: ## Press Enter ##</p> <p>============================================================================== he servers must run as a specific user in a specific group. It is strongly recommended that this user should have no privileges on the computer (i.e. a non-root user). The setup procedure will give this user/group some permissions in specific paths/files to perform server-specific operations.</p> <p>If you have not yet created a user and group for the servers, create this user and group using your native operating system utilities.</p> <p>System User [nobody]: ldapadmin ## Enter LDAP user name created above # System Group [nobody]: ldapadmin</p> <p>============================================================================== Server information is stored in the configuration directory server. This information is used by the console and administration server to configure and manage your servers. If you have already set up a configuration directory server, you should register any servers you set up or create with the configuration server. To do so, the following information about the configuration server is required: the fully qualified host name of the form .(e.g. hostname.example.com), the port number (default 389), the suffix, the DN and password of a user having permission to write the configuration information, usually the configuration directory administrator, and if you are using security (TLS/SSL). If you are using TLS/SSL, specify the TLS/SSL (LDAPS) port number (default 636) instead of the regular LDAP port number, and provide the CA certificate (in PEM/ASCII format).</p> <p>If you do not yet have a configuration directory server, enter 'No' to be prompted to set up one. Do you want to register this software with an existing configuration directory server? [no]: ## Press Enter ##</p> <p>============================================================================== Please enter the administrator ID for the configuration directory server. This is the ID typically used to log in to the console. You will also be prompted for the password. Configuration directory server administrator ID [admin]: ## Press Enter ## Password: ## create password ## Password (confirm): ## re-type password ##</p> <p>============================================================================== The information stored in the configuration directory server can be separated into different Administration Domains. If you are managing multiple software releases at the same time, or managing information about multiple domains, you may use the Administration Domain to keep them separate.</p> <p>If you are not using administrative domains, press Enter to select the default. Otherwise, enter some descriptive, unique name for the administration domain, such as the name of the organization responsible for managing the domain.</p> <p>Administration Domain [lofyer.org]: ## Press Enter ##</p> <p>============================================================================== The standard directory server network port number is 389. However, if you are not logged as the superuser, or port 389 is in use, the default value will be a random unused port number greater than 1024. If you want to use port 389, make sure that you are logged in as the superuser, that port 389 is not in use. Directory server network port [389]: ## Press Enter ##</p> <p>============================================================================== Each instance of a directory server requires a unique identifier. This identifier is used to name the various instance specific files and directories in the file system, as well as for other uses as a server instance identifier.</p> <p>Directory server identifier [server]: ## Press Enter ##</p> <p>============================================================================== The suffix is the root of your directory tree. The suffix must be a valid DN. It is recommended that you use the dc=domaincomponent suffix convention. For example, if your domain is example.com, you should use dc=example,dc=com for your suffix. Setup will create this initial suffix for you, but you may have more than one suffix. Use the directory server utilities to create additional suffixes.</p> <p>Suffix [dc=lofyer, dc=org]: ## Press Enter ##</p> <p>=============================================================================</p> <p>Certain directory server operations require an administrative user. This user is referred to as the Directory Manager and typically has a bind Distinguished Name (DN) of cn=Directory Manager. You will also be prompted for the password for this user. The password must be at least 8 characters long, and contain no spaces. Press Control-B or type the word "back", then Enter to back up and start over. Directory Manager DN [cn=Directory Manager]: ## Press Enter ## Password: ## Enter the password ## Password (confirm): </p> <p>============================================================================== The Administration Server is separate from any of your web or application servers since it listens to a different port and access to it is restricted.</p> <p>Pick a port number between 1024 and 65535 to run your Administration Server on. You should NOT use a port number which you plan to run a web or application server on, rather, select a number which you will remember and which will not be used for anything else. Administration port [9830]: ## Press Enter ##</p> <p>============================================================================== The interactive phase is complete. The script will now set up your servers. Enter No or go Back if you want to change something.</p> <p>Are you ready to set up your servers? [yes]: ## Press Enter ## Creating directory server . . . Your new DS instance 'server' was successfully created. Creating the configuration directory server . . . Beginning Admin Server creation . . . Creating Admin Server files and directories . . . Updating adm.conf . . . Updating admpw . . . Registering admin server with the configuration directory server . . . Updating adm.conf with information from configuration directory server . . . Updating the configuration for the httpd engine . . . Starting admin server . . . output: Starting dirsrv-admin: output: [ OK ] The admin server was successfully started. Admin server was successfully created, configured, and started. Exiting . . . Log file is '/tmp/setupo1AlDy.log' </p> <p>Then make these two services start on startup.</p> <h2 id=chkconfig-dirsrv-on><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-dirsrv-on>chkconfig dirsrv on</a></h2> <h2 id=chkconfig-dirsrv-admin-on><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-dirsrv-admin-on>chkconfig dirsrv-admin on</a></h2> <p>With 389-ds scripts, you could use 389-console, please refer to the link above.</p> <h3 id=12-manually-configure><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#12-manually-configure>1.2 Manually configure</a></h3> <p><a href=https://n40lab.wordpress.com/2013/11/22/creating-a-simple-ldap-directory-with-openldap-2-4-in-centos-6-4/ title="simple ldap">Here's the original article.</a></p> <h4 id=install-the-packages><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#install-the-packages>Install the packages</a></h4> <h2 id=yum-install-openldap-clients-servers><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-openldap-clients-servers>yum install openldap{,-clients,-servers}</a></h2> <h4 id=change-the-configuration><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#change-the-configuration>Change the configuration</a></h4> <p><em>/etc/openldap/slapd.d/cn\=config.ldif</em> Delete <strong>olcAllows: bind_v2</strong> if you want only v3. Modify <strong>olcIdleTimeout</strong> from 0 to 30 if you want close the idle connection for more than 30 seconds.</p> <p>Before next step, run this command to generate a SHA encrypted password.</p> <h2 id=slappasswd><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#slappasswd>slappasswd</a></h2> <p>New password: Re-enter new password: {SSHA}aW7TYJ3faz13RKsnr3uiCsbgi55RKhW9</p> <p>Then copy the output to your clipboard.</p> <p><em>/etc/openldap/slapd.d/cn\=config/olcDatabase\=\{2\}bdb.ldif</em> Modify <strong>olcSuffix</strong>, <strong>RootDN</strong>, <strong>olcRootPW</strong> to this:</p> <p>... olcSuffix: dc=lofyer, dc=org olcRootPW: {SSHA}aW7TYJ3faz13RKsnr3uiCsbgi55RKhW9 RootDN: cn=admin, dc=lofyer, dc=org ...</p> <h4 id=start-service><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#start-service>Start service</a></h4> <h2 id=service-slapd-start><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-slapd-start>service slapd start</a></h2> <h2 id=chkconfig-slpad-on><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-slpad-on>chkconfig slpad on</a></h2> <h4 id=add-rootdn-and-groups><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#add-rootdn-and-groups>Add rootdn and groups</a></h4> <p>dn: dc=lofyer,dc=org objectclass: dcObject objectclass: organization o: Lofyer Org dc: lofyer</p> <p>dn: ou=People,dc=lofyer,dc=org objectClass: organizationalUnit objectClass: top ou: People</p> <p>dn: ou=Groups,dc=lofyer,dc=org objectClass: organizationalUnit objectClass: top</p> <p>ou: Groups dn: cn=admin,dc=lofyer,dc=org objectclass: organizationalRole cn: admin</p> <p>Import the ldif:</p> <h2 id=ldapadd-x-d-cnadmindclofyerdcorg-w-f-etcopenldapschemalofyerorgldif><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ldapadd-x-d-cnadmindclofyerdcorg-w-f-etcopenldapschemalofyerorgldif>ldapadd -x -D "cn=admin,dc=lofyer,dc=org" -W -f /etc/openldap/schema/lofyer.org.ldif</a></h2> <h2 id=ldapsearch-x-b-dclofyerdcorg-objectclass><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ldapsearch-x-b-dclofyerdcorg-objectclass>ldapsearch -x -b 'dc=lofyer,dc=org' '(objectclass=*)'</a></h2> <h4 id=create-a-user><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#create-a-user>Create a user</a></h4> <p>Add following content to <em>user.ldif</em></p> <p>dn: uid=demo,ou=People,dc=lofyer,dc=org objectclass: top objectclass: person objectclass: inetOrgPerson objectclass: organizationalPerson uid: demo cn: demo sn: demo givenName: demo</p> <p>Provide a password:</p> <h2 id=ldapadd-x-w-d-cnadmindclofyerdcorg-f-userldif><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ldapadd-x-w-d-cnadmindclofyerdcorg-f-userldif>ldapadd -x -W -D "cn=admin,dc=lofyer,dc=org" -f user.ldif</a></h2> <p>New password: Re-enter new password: Enter LDAP Password:</p> <h4 id=add-or-delete-a-member-from-groupmyteam><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#add-or-delete-a-member-from-groupmyteam>Add or delete a member from group(myteam)</a></h4> <p><strong>Add:</strong> dn: cn=myteam,ou=Groups,dc=lofyer,dc=org changetype: modify add: member member: uid=user1,ou=People,dc=lofyer,dc=org</p> <h2 id=ldapmodify-x-d-cnadmindclofyerdcorg-w-f-addldif><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ldapmodify-x-d-cnadmindclofyerdcorg-w-f-addldif>ldapmodify -x -D "cn=admin,dc=lofyer,dc=org" -W -f add.ldif</a></h2> <p><strong>Delete:</strong></p> <p>dn: cn=myteam,ou=Groups,dc=lofyer,dc=org changetype: modify delete: member member: uid=user1,ou=People,dc=lofyer,dc=org</p> <h2 id=ldapmodify-x-d-cnadmindclofyerdcorg-w-f-deleteldif><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ldapmodify-x-d-cnadmindclofyerdcorg-w-f-deleteldif>ldapmodify -x -D "cn=admin,dc=lofyer,dc=org" -W -f delete.ldif</a></h2> <h3 id=use-tsl><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#use-tsl>Use TSL</a></h3> <p><a href="http://www.overclockers.com/forums/showthread.php?t=726947" title="Setup ldap">Here's the original article.</a></p> <h3 id=not-necessarygenerate-ca><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#not-necessarygenerate-ca>(NOT NECESSARY)Generate CA</a></h3> <p>Follow this script.</p> <h2 id=binbash_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#binbash_1>!/bin/bash</a></h2> <h2 id=change-to-the-directory-and-clear-out-the-old-certs><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#change-to-the-directory-and-clear-out-the-old-certs>Change to the directory and clear out the old certs</a></h2> <p>cd /etc/openldap/certs rm -rf *</p> <h2 id=this-echo-statement-is-actually-putting-the-word-password-without-the-quotes-in-a-temporary-password-file-to-help><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#this-echo-statement-is-actually-putting-the-word-password-without-the-quotes-in-a-temporary-password-file-to-help>This echo statement is actually putting the word “password” (without the quotes) in a temporary password file to help</a></h2> <h2 id=automate-the-process-this-will-be-the-password-for-your-certificate-change-this-as-appropriate><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#automate-the-process-this-will-be-the-password-for-your-certificate-change-this-as-appropriate>automate the process. This will be the password for your certificate. Change this as appropriate</a></h2> <p>echo "mypassword" &gt; /etc/openldap/certs/password export PATH=/usr/bin/:$PATH echo falkdjfdajkasdndwndoqndwapqmhfaksj &gt;&gt; noise.txt</p> <h2 id=associate-the-password-with-the-certificates-which-will-be-generated-in-the-current-directory><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#associate-the-password-with-the-certificates-which-will-be-generated-in-the-current-directory>Associate the password with the certificates which will be generated in the current directory</a></h2> <p>certutil -N -d . -f /etc/openldap/certs/password certutil -G -d . -z noise.txt -f /etc/openldap/certs/password</p> <h2 id=generate-a-ca-certificate-for-the-389-server><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#generate-a-ca-certificate-for-the-389-server>Generate a CA certificate for the 389 server</a></h2> <p>certutil -S -n "CA certificate" -s "cn=CACert" -x -t "CT,," -m 1000 -v 120 -d . -z /etc/openldap/certs/noise.txt -f /etc/openldap/certs/password</p> <h2 id=anwsers-are-y-y><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#anwsers-are-y-y>anwsers are Y, , Y</a></h2> <h2 id=this-builds-the-server-cert><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#this-builds-the-server-cert>This builds the server cert</a></h2> <p>certutil -S -n "OpenLDAP Server" -s "cn=ldap.lofyer.org" -c "CA certificate" -t "u,u,u" -m 1001 -v 120 -d . -z /etc/openldap/certs/noise.txt -f /etc/openldap/certs/password</p> <h2 id=this-exports-the-cacert-in-case-you-need-it><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#this-exports-the-cacert-in-case-you-need-it>This exports the cacert in case you need it</a></h2> <p>pk12util -d . -o cacert.p12 -n "CA certificate"</p> <h2 id=this-exports-the-server-cert-which-you-will-need-on-the-windows-ad><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#this-exports-the-server-cert-which-you-will-need-on-the-windows-ad>This exports the server-cert which you will need on the windows AD</a></h2> <p>pk12util -d . -o servercert.p12 -n "OpenLDAP Server"</p> <h2 id=this-exports-the-ca-cert-for-ldap-clients><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#this-exports-the-ca-cert-for-ldap-clients>This exports the CA cert for ldap clients</a></h2> <p>certutil -L -d . -n "CA certificate" -a &gt; /etc/openldap/certs/cacert.pem</p> <h2 id=make-the-files-in-here-readable><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#make-the-files-in-here-readable>Make the files in here readable</a></h2> <p>chmod 644 *</p> <h2 id=set-the-system-to-use-ldaps><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#set-the-system-to-use-ldaps>Set the system to use LDAPS</a></h2> <p>sed -i 's/SLAPD_LDAPS=no/SLAPD_LDAPS=yes/g' /etc/sysconfig/ldap</p> <h2 id=add-a-firewall-exception-in-case-the-user-has-not-configured-their-firewall-properly><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#add-a-firewall-exception-in-case-the-user-has-not-configured-their-firewall-properly>Add a firewall exception in case the user has not configured their firewall properly</a></h2> <h2 id=iptables-i-input-m-state-state-new-p-tcp-dport-636-j-accept><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#iptables-i-input-m-state-state-new-p-tcp-dport-636-j-accept>iptables -I INPUT -m state --state NEW -p tcp --dport 636 -j ACCEPT</a></h2> <h2 id=etcinitdiptables-save><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#etcinitdiptables-save>/etc/init.d/iptables save</a></h2> <h2 id=restart-slapd-to-make-the-changes-take-effect><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#restart-slapd-to-make-the-changes-take-effect>Restart slapd to make the changes take effect</a></h2> <h2 id=etcinitdslapd-restart><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#etcinitdslapd-restart>/etc/init.d/slapd restart</a></h2> <p>I think you should notice that the private key password is "mypassword". Then you will get three files: <strong>cacert.p12</strong>, <strong>cacert.pem</strong>, <strong>servercert.p12</strong>. And, that's all.</p> <h2 id=2-add-sasl-to-openldap><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#2-add-sasl-to-openldap>2. Add SASL to OpenLDAP</a></h2> <p>OKay, we'll add SASL to our ldap connections.</p> <h3 id=install-cyrus-sasl-package><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#install-cyrus-sasl-package>Install cyrus-sasl package.</a></h3> <h2 id=yum-install-cyrus-sasl-gssapi><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-cyrus-sasl-gssapi>yum install cyrus-sasl-gssapi</a></h2> <h2 id=yum-install-cyrus-sasl-ldap><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-cyrus-sasl-ldap>yum install cyrus-sasl-ldap</a></h2> <hr> <p>title: "owncloud webdav intergration" date: 2013-01-03 categories: - "linux-admin"</p> <hr> <p>安装好owncloud后，可以使用webdav协议进行远程挂载，比如</p> <p>mount -t davfs {http://localhost/remote.php/webdav,http://localhost/files/webdav.php} /mnt</p> <p>2003上需启动webclient服务 而在2008上, webclient被集成到desktop experience组件中, 从service manager-&gt;feature中添加desktop experience,并且修改注册表HKEY_LOCAL_MACHINE-&gt;SYSTEM-&gt;CurrentControlSet-&gt;Services-&gt;WebClient-&gt;Parameters-&gt;BasicAuthLevel 的值为 2，重启服务 此时可映射网络驱动器，钩选“connect using different credentials”，输入其用户名密码即可 或者命令行</p> <p>NET USE * http://localhost/remote.php/webdav 123456 /user:admin</p> <h3 id=ps-1-owncloudapp-webdev-2-owncloudapacheapachewww-datawww-datahtaccesss><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ps-1-owncloudapp-webdev-2-owncloudapacheapachewww-datawww-datahtaccesss>PS： 1. owncloud第三方app WebDev安装后会造成不能添加用户的麻烦 2. 修改owncloud目录权限为apache.apache或者www-data.www-data以使.htaccesss生效</a></h3> <p>title: "Using X server in Windows Linux Subsystem" date: 2016-10-09 categories: - "linux-admin"</p> <hr> <p>1. Turn on "Developer Mode" in Control panel. <a href=http://blog.lofyer.org/wp-content/uploads/developer-mode.png><img alt=developer-mode src=/blog/images/developer-mode.png></a> <a href=http://blog.lofyer.org/wp-content/uploads/sss.png><img alt=sss src=/blog/images/sss.png></a></p> <p>2. Run "bash" <a href=http://blog.lofyer.org/wp-content/uploads/bash.png><img alt=bash src=/blog/images/bash.png></a></p> <p>3. Install Xming(Xserver for Windows) <a href=https://sourceforge.net/projects/xming/ >Download</a></p> <p>4. Launch your app</p> <h2 id=export-display0><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#export-display0>export DISPLAY=:0</a></h2> <h2 id=firefox><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#firefox>firefox</a></h2> <p><a href=http://blog.lofyer.org/wp-content/uploads/launch.png><img alt=launch src=/blog/images/launch.png></a></p> <p>5. You can create a link on your desktop like this <a href=http://blog.lofyer.org/wp-content/uploads/aaa.png><img alt=aaa src=/blog/images/aaa.png></a></p> <p>and ~/.bashrc</p> <p>alias home='cd /mnt/c/Users/rex/Desktop' home export DISPLAY=:0</p> <p>Tips:</p> <h3 id=use-powershell-bash-instead-of-bash-you-can-access-your-service-in-this-way><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#use-powershell-bash-instead-of-bash-you-can-access-your-service-in-this-way>Use "powershell bash" instead of "bash", you can access your service in this way.</a></h3> <p>title: "Configure corosync and pacemaker" date: 2015-02-28 categories: - "linux-admin"</p> <hr> <p>Env: node1 eth0 192.168.0.201 node2 eth0 192.168.0.202</p> <h3 id=1-install-essential-packages><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#1-install-essential-packages>1. Install essential packages</a></h3> <p>Add following content to <em>/etc/yum.repos.d/ha.repo</em>, since you will need crmsh later:</p> <p>[haclustering] name=HA Clustering baseurl=http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/CentOS_CentOS-6/ enabled=1 gpgcheck=0</p> <p>Install packages:</p> <h2 id=yum-install-pacemaker-corosync-crmsh-y><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#yum-install-pacemaker-corosync-crmsh-y>yum install pacemaker corosync crmsh -y</a></h2> <h3 id=2-configure-corosync><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#2-configure-corosync>2. Configure corosync</a></h3> <p>Using configuration files below if you need broadcast:</p> <p>service { # Load the Pacemaker Cluster Resource Manager ver: 0 name: pacemaker use_mgmtd: no use_logd: no }</p> <p>totem { version: 2 secauth: off interface { member { memberaddr: 192.168.0.201 } member { memberaddr: 192.168.0.202 } ringnumber: 0 bindnetaddr: 192.168.0.0 mcastport: 5405 ttl: 1 } transport: udpu }</p> <p>logging { fileline: off to_logfile: yes to_syslog: yes logfile: /var/log/cluster/corosync.log debug: off timestamp: on logger_subsys { subsys: AMF debug: off } }</p> <p>Here's a sample using multicast:</p> <p>service { # Load the Pacemaker Cluster Resource Manager ver: 0 name: pacemaker use_mgmtd: no use_logd: no }</p> <p>totem { version: 2</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span></pre></div></td><td class=code><div><pre><span></span><code>    # secauth: Enable mutual node authentication. If you choose to
    # enable this (&quot;on&quot;), then do remember to create a shared
    # secret with &quot;corosync-keygen&quot;.
    secauth: off

    threads: 0

    # interface: define at least one interface to communicate
    # over. If you define more than one interface stanza, you must
    # also set rrp\_mode.
    interface {
            ringnumber: 0
            bindnetaddr: 192.168.1.0
            mcastaddr: 239.255.1.1
            mcastport: 5405
            ttl: 1
    }
</code></pre></div></td></tr></table></div> <p>}</p> <p>logging { fileline: off to_stderr: no to_logfile: yes logfile: /var/log/cluster/corosync.log to_syslog: yes debug: off timestamp: on logger_subsys { subsys: AMF debug: off } }</p> <p>Note that if the <strong>ver</strong> in the <strong>service</strong> section of pacemaker is <strong>0</strong>, pacemaker will be loaded automatically, or else you will start the pacemaker service manually.</p> <p>Copy this configuration file to the other host and start the service:</p> <h2 id=scp-etccorosynccorosyncconf-root1921680202etccorosynccorosyncconf><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#scp-etccorosynccorosyncconf-root1921680202etccorosynccorosyncconf>scp /etc/corosync/corosync.conf root@192.168.0.202:/etc/corosync/corosync.conf</a></h2> <p>On 192.168.0.201:</p> <h2 id=chkconfig-corosync-on><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-corosync-on>chkconfig corosync on</a></h2> <h2 id=service-corosync-start><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-corosync-start>service corosync start</a></h2> <p>On 192.168.0.202:</p> <h2 id=chkconfig-corosync-on_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#chkconfig-corosync-on_1>chkconfig corosync on</a></h2> <h2 id=service-corosync-start_1><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#service-corosync-start_1>service corosync start</a></h2> <h3 id=3-configure-corosync-using-crmsh><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#3-configure-corosync-using-crmsh>3. Configure corosync using crmsh</a></h3> <p>Add virtual IP to your cluster:</p> <h2 id=crm-configure><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#crm-configure>crm configure</a></h2> <p>crm(live)configure# primitive vip1 ocf<img alt=💓 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f493.svg title=:heartbeat:>IPaddr2 params ip=192.168.0.209 cidr_netmask=24 op monitor interval=10s crm(live)configure# property stonith-enabled=false # To prevent split-brain crm(live)configure# property no-quorum-policy=stop # To prevent split-brain crm(live)configure# commit</p> <p>Test:</p> <p>crm(live)configure# migrate vip1 crm(live)configure# unmigrate vip1</p> <h3 id=you-will-see-1921680209-migrating-between-these-two-nodes><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#you-will-see-1921680209-migrating-between-these-two-nodes>You will see 192.168.0.209 migrating between these two nodes.</a></h3> <p>title: "Deploy Skype for Business Server 2015" date: 2015-08-12 categories: - "cloud-infra"</p> <hr> <h2 id=server-preparation><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#server-preparation>Server Preparation</a></h2> <p>ad(ad.virtfan.com): Windows Server 2012 R2 lync(lync.virtfan.com): Windows Server 2012 R2 Following instruction is for <strong>LAN</strong>.</p> <p>Ref: <a href=https://technet.microsoft.com/en-us/library/dn933900.aspx>https://technet.microsoft.com/en-us/library/dn933900.aspx</a> <a href=http://lync.community.ge/post/2012/07/18/Install-Lync-2013-in-windows-server-2008-r2-(Part-1).aspx>Install lync 2013 server in win2008r2</a></p> <h2 id=procedure><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#procedure>Procedure</a></h2> <p>1. After a fresh installation of Windows Server 2012 R2, we will <strong>update</strong> it to latest. 2. We need create an AD DS with AD CS in ad.virtfan.com. So that we can retrieve CA to complete our deployment. 3. Then we start setting up Skype Server in lync.virtfan.com(in domain virtfan.com). 4. Set up DNS, add more users, use lync to communicate.</p> <h3 id=ad-preparation><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#ad-preparation>AD Preparation</a></h3> <p>Following steps are in ad.virtfan.com. 1. Assign a static IP. Change computer name to ad. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8a%e5%8d%8811-42-27/ ><img alt="屏幕快照 2015-08-13 上午11.42.27" src=/blog/images/屏幕快照-2015-08-13-上午11.42.27-1024x632.png></a> 2. Add Active Directory Domain Service and DNS Roles. Create a new forest(virtfan.com) with level Windows 2008 R2. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8a%e5%8d%8811-59-27/ ><img alt="屏幕快照 2015-08-13 上午11.59.27" src=/blog/images/屏幕快照-2015-08-13-上午11.59.27-300x172.png></a> 3. Add Active Directory Certificate Service Role with all the six features checked. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%8812-07-28/ ><img alt="屏幕快照 2015-08-13 下午12.07.28" src=/blog/images/屏幕快照-2015-08-13-下午12.07.28-300x128.png></a> 4. (Optional)Run gpmc.msc, right click on the Default Domain Policy to edit. Change Password Complexity to False. Run gpupdate /force to update the group policy. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%8812-15-33/ ><img alt="屏幕快照 2015-08-13 下午12.15.33" src=/blog/images/屏幕快照-2015-08-13-下午12.15.33-1024x543.png></a></p> <h3 id=skype-server-preparation><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#skype-server-preparation>Skype Server Preparation</a></h3> <p>Following steps are in lync.virtfan.com. <strong>Make sure you have got more than 32GB space in C:</strong>. 1. Assign a static IP, change name to lync and join domain virtfan.com. Add following features: <em>.Net Framework 3.5, .Net Framework 4.5 -&gt; WCF Services -&gt; HTTP Activation, Media Foundation, Remote Server Administration Tools -&gt; Role Administration Tools -&gt; AD DS and AD LDS Tools -&gt; Windows Identity Foundation 3.5</em> 2. Add IIS Role with following features: <em>静态内容、默认文档、HTTP 错误、ASP.NET、.NET 扩展性、Internet 服务器 API (ISAPI)扩展、ISAPI 筛选器、HTTP 日志记录、日志记录工具、跟踪、客户端证书映射身份验证、Windows 身份验证、请求筛选、静态内容压缩、动态内容压缩、IIS 管理控制台、IIS 管理脚本和工具</em> 3. <strong>Logon as VIRTFAN\Administrator</strong> and add feature .Net3.5. 4. Install KB2982006. 5. Mount Skype Business 2015 ISO and run Setup to install.</p> <h3 id=setting-up-skype-server><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#setting-up-skype-server>Setting up Skype Server</a></h3> <p>Following steps are in lync.virtfan.com and logon as VIRTFAN\Administrator and add feature .Net3.5. 1. Create a directory in C:\share, make it sharable and writable. 2. Run Skype for Business Server 部署向导(Deploy Wizard) from Start menu. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%881-47-56/ ><img alt="屏幕快照 2015-08-13 下午1.47.56" src=/blog/images/屏幕快照-2015-08-13-下午1.47.56.png></a> 3. Then we will are going to follow the steps in Prepare Active Directory. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%881-51-16/ ><img alt="屏幕快照 2015-08-13 下午1.51.16" src=/blog/images/屏幕快照-2015-08-13-下午1.51.16.png></a> 4. Click Prepare the first Standard Edition Server. It will create database. 5. Install management utilities. 6. Run Skype for Business Server topology generator from Start menu to generate a topology. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-31-16/ ><img alt="屏幕快照 2015-08-13 下午2.31.16" src=/blog/images/屏幕快照-2015-08-13-下午2.31.16.png></a> 7. Create a new topology like this: <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-37-53/ ><img alt="屏幕快照 2015-08-13 下午2.37.53" src=/blog/images/屏幕快照-2015-08-13-下午2.37.53.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-38-07/ ><img alt="屏幕快照 2015-08-13 下午2.38.07" src=/blog/images/屏幕快照-2015-08-13-下午2.38.07.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-39-23/ ><img alt="屏幕快照 2015-08-13 下午2.39.23" src=/blog/images/屏幕快照-2015-08-13-下午2.39.23.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-40-04/ ><img alt="屏幕快照 2015-08-13 下午2.40.04" src=/blog/images/屏幕快照-2015-08-13-下午2.40.04.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-40-47/ ><img alt="屏幕快照 2015-08-13 下午2.40.47" src=/blog/images/屏幕快照-2015-08-13-下午2.40.47.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-41-15/ ><img alt="屏幕快照 2015-08-13 下午2.41.15" src=/blog/images/屏幕快照-2015-08-13-下午2.41.15.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-41-44/ ><img alt="屏幕快照 2015-08-13 下午2.41.44" src=/blog/images/屏幕快照-2015-08-13-下午2.41.44.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-42-14/ ><img alt="屏幕快照 2015-08-13 下午2.42.14" src=/blog/images/屏幕快照-2015-08-13-下午2.42.14.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-42-49/ ><img alt="屏幕快照 2015-08-13 下午2.42.49" src=/blog/images/屏幕快照-2015-08-13-下午2.42.49.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-43-32/ ><img alt="屏幕快照 2015-08-13 下午2.43.32" src=/blog/images/屏幕快照-2015-08-13-下午2.43.32.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-43-58/ ><img alt="屏幕快照 2015-08-13 下午2.43.58" src=/blog/images/屏幕快照-2015-08-13-下午2.43.58.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-44-27/ ><img alt="屏幕快照 2015-08-13 下午2.44.27" src=/blog/images/屏幕快照-2015-08-13-下午2.44.27.png></a> Click Finish and right click on the Skype for Business Server to edit property. Fill in the admin url like: <em>https://admin.virtfan.com</em> Select a fronted server as central server. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-46-44/ ><img alt="屏幕快照 2015-08-13 下午2.46.44" src=/blog/images/屏幕快照-2015-08-13-下午2.46.44.png></a> 8. Publish topology. 9. Click Install or update Skype for Business Server System. And follow its guide. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-52-18/ ><img alt="屏幕快照 2015-08-13 下午2.52.18" src=/blog/images/屏幕快照-2015-08-13-下午2.52.18.png></a> 10. When you are in Step.3(Assign Certificate). Click Request to request certificate from ad.virtfan.com. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-53-49/ ><img alt="屏幕快照 2015-08-13 下午2.53.49" src=/blog/images/屏幕快照-2015-08-13-下午2.53.49.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-54-39/ ><img alt="屏幕快照 2015-08-13 下午2.54.39" src=/blog/images/屏幕快照-2015-08-13-下午2.54.39.png></a> <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%882-54-39/ ><img alt="屏幕快照 2015-08-13 下午2.54.39" src=/blog/images/屏幕快照-2015-08-13-下午2.54.39.png></a> 11. Run start-cspool from cmd to start the server. Warning is OK, error is not OK. 12. Define your DNS and port-forwarding(443) so that we can use Skype from WAN.</p> <p>https://meet.virtfan.com -&gt; lync.virtfan.com's IP https://lync.virtfan.com -&gt; lync.virtfan.com's IP https://dialin.virtfan.com -&gt; lync.virtfan.com's IP https://admin.virtfan.com -&gt; lync.virtfan.com's IP (optional)https://ad.virtfan.com -&gt; ad.virtfan.com's IP</p> <p>13. Add domain users and assign users via https://admin.virtfan.com. <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/%e5%b1%8f%e5%b9%95%e5%bf%ab%e7%85%a7-2015-08-13-%e4%b8%8b%e5%8d%883-10-58/ ><img alt="屏幕快照 2015-08-13 下午3.10.58" src=/blog/images/屏幕快照-2015-08-13-下午3.10.58-1024x538.png></a></p> <h2 id=lyncskype-client><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#lyncskype-client>Lync/Skype Client</a></h2> <p>1. Install Lync/Skype within Microsoft Office 2013 or Office365. 2. Download and install CA from https://ad.virtfan.com/certsrv/ or you can put it somewhere else. 3. Configure your client like this: <a href=http://blog.lofyer.org/deploy-skype-for-business-server-2015/lync/ ><img alt=lync src=/blog/images/lync.png></a> 4. Click Logon.</p> <p>Here you go!</p> <h2 id=wan><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#wan>WAN</a></h2> <p>If you are using servers behind a firewall or a router, you should add something like this. 1. On your DNS provider, set these 6 A records lync/admin/dialin/meet/lyncdiscover/lyncdiscoverinternal.virtfan.com to your WAN IP. 2. Port forward from 443,5601 to lync server LAN IP. (Alternative)2. If you are using Apache virtualhost, you'll need export certificate and its private key of lync.virtfan.com to the Apache server with <a href=https://github.com/iSECPartners/jailbreak-Windows.git>jailbreak</a> and configure all 6 domain names like this:</p> <h2 id=vi-apacheconfdsslconf><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#vi-apacheconfdsslconf>vi /apache/conf.d/ssl.conf</a></h2> <p>... <virtualhost \*:443> ServerName skype.virtfan.com SSLEngine on SSLProxyEngine on SSLCertificateFile /etc/httpd/conf.d/lync-ca/lync.virtfan.com.cer SSLCertificateKeyFile /etc/httpd/conf.d/lync-ca/lync.virtfan.com.key ProxyRequests Off ProxyPass / https://skype.virtfan.com/ ProxyPassReverse / https://skype.virtfan.com/ </virtualhost> ...</p> <h2 id=vi-etchttpdconfdvproxyconf><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#vi-etchttpdconfdvproxyconf>vi /etc/httpd/conf.d/vproxy.conf</a></h2> <p><virtualhost \*:80> ServerName lyncdiscover.virtfan.com ProxyRequests Off ProxyPass / http://lyncdiscover.virtfan.com/ ProxyPassReverse / http://lyncdiscover.virtfan.com/ </virtualhost></p> <p><virtualhost \*:80> ServerName lyncdiscoverinternal.virtfan.com ProxyRequests Off ProxyPass / http://lyncdiscoverinternal.virtfan.com/ ProxyPassReverse / http://lyncdiscoverinternal.virtfan.com/ </virtualhost></p> <h2 id=vi-etchosts><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#vi-etchosts>vi /etc/hosts</a></h2> <p>... 192.168.122.222 admin.virtfan.com 192.168.122.222 lync.virtfan.com 192.168.122.222 dialin.virtfan.com 192.168.122.222 skype.virtfan.com 192.168.122.222 meet.virtfan.com 192.168.122.222 lyncdiscover.virtfan.com 192.168.122.222 lyncdiscoverinternal.virtfan.com ...</p> <p>And configure iptables:</p> <h2 id=iptables-t-nat-a-prerouting-p-tcp-dport-5061-j-dnat-to-destination-1921681222225061><a class=toclink href=../../2014/02/10/deploy-asterisk-on-centos/#iptables-t-nat-a-prerouting-p-tcp-dport-5061-j-dnat-to-destination-1921681222225061>iptables -t nat -A PREROUTING -p tcp --dport 5061 -j DNAT --to-destination 192.168.122.222:5061</a></h2> <p>3. DO NOT ADD "Internal Server" in your lync client, "External Server" will be enough.</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2014-01-19 00:00:00">2014年1月19日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/mylife/ class=md-meta__link>mylife</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=2013-2014><a href=../../2014/01/19/2013-2014/ class=toclink>2013-2014</a></h2> <p>今年已经24岁了，从一个普通人生的轨迹来看，这些年应该还能接受。 2013年，成长了些，在这要感谢敖总辛苦栽培。 关于互联网行业，应该是爆发的节奏的才对，要厚积。 关于科技行业，小米这类公司看的很准，下手也是外科手术式的准。 KP我觉得还是随身带着吧，手机少看些，因为形势至少还在意料内，每天耽误时间从中间甄别出可用信息的机会成本至少就目前来说有些高，不如直接获取知识来的实在。</p> <p>那么就2014，就列出来一些清单吧。 1. 在新年期间把MyIDC建设以及对应手册完成。 2. 掌握CLisp的常用特性。 3. 学习一些WPF编程。 4. 掌握法语基本语法，基本句式。 5. 入门无线电，考取A类执照。 6. 保持每天的锻炼。 7. 以上计划随工作重点可能有变。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-12-19 00:00:00">2013年12月19日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/others/ class=md-meta__link>others</a></li> <li class=md-meta__item> 需要 17 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=qemu><a href=../../2013/12/19/create-a-dummy-vga-adpter/ class=toclink>QEMU相关</a></h2> <p>创建一个“虚拟”显示适配器，适用于那些“你知道你想干什么并且在干什么”的人。 原文参考 <a href=http://www.geeks3d.com/20091230/vga-hack-how-to-make-a-vga-dummy-plug/ >http://www.geeks3d.com/20091230/vga-hack-how-to-make-a-vga-dummy-plug/</a> <a href="http://blog.zorinaq.com/?e=11">http://blog.zorinaq.com/?e=11</a></p> <p>手头有两块ATI显卡，而且都有这个DVI-I接口，并且目前我的状况是两个显示器都接到了两个主板显示（集显）接口。 <a href=http://blog.lofyer.org/2013/12/create-dummy-vga-adpter/sldldvi/ ><img alt=sldldvi src=/blog/images/sldldvi.jpg></a> 原文说需要一个75欧姆的电阻，我手里暂时只有100欧姆的，而且不多，如果强烈按照原作者的意思的话效果可能会有所不同，参考现有任意款VGA控制器原理。 [连接示意图] 来自第一个链接 <a href=http://blog.lofyer.org/2013/12/create-dummy-vga-adpter/vga_dummy_electronic_schema/ ><img alt=vga_dummy_electronic_schema src=/blog/images/vga_dummy_electronic_schema.jpg></a> [效果图] 请无视我的背景，如果有人好奇的话，那是上篇文章的eZ430以及一包十块白沙。 <a href=http://blog.lofyer.org/2013/12/create-dummy-vga-adpter/qq%e5%9b%be%e7%89%8720131220001003/ ><img alt=QQ图片20131220001003 src=/blog/images/QQ图片20131220001003-757x1024.jpg></a> [结果] <a href=http://blog.lofyer.org/2013/12/create-dummy-vga-adpter/qq%e6%88%aa%e5%9b%be20131220001602/ ><img alt=QQ截图20131220001602 src=/blog/images/QQ截图20131220001602.png></a></p> <p>看见第3个显示器没？ 就是它了，你可以拿它做很多事，比如你有多块显卡，并且你想充分利用其性能，参考lucid mvp，效果上类似吧。--- title: "Gpu Passthrough in Xen" date: 2013-07-22 categories: - "cloud-infra"</p> <hr> <p>Considering that Xen's gpu passthrough is about one year ahead of kvm, so let us try that. The process is something like kvm one as I wrote before. <a href=http://blog.lofyer.org/2013/05/pass-host-gpu-to-guest-via-qemu-ncursescurses/ title="KVM GPU-Passthrough, VGA-Passthrough">KVM GPU-Passthrough, VGA-Passthrough</a></p> <h3 id=result-i-failed-in-trying-passthrough-the-graphic-card-to-win7-or-xp-now-im-try-some-patchs-and-re-compile-xen-with-my-graphic-card-biosbin><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#result-i-failed-in-trying-passthrough-the-graphic-card-to-win7-or-xp-now-im-try-some-patchs-and-re-compile-xen-with-my-graphic-card-biosbin>Result: I failed in trying passthrough the graphic card to Win7 or XP. Now I'm try some patchs and re-compile Xen with my graphic card bios.bin.</a></h3> <p>HOST: CPU: i5-3470 GPU: ATI Radeon HD 7850 OS: openSuse 12.3 KDE</p> <h3 id=0-disable-radeon-driver><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#0-disable-radeon-driver>0. Disable Radeon Driver</a></h3> <h2 id=echo-blacklist-radeon-etcmodprobedmodprobeconf><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#echo-blacklist-radeon-etcmodprobedmodprobeconf>echo "blacklist radeon" &gt;&gt; /etc/modprobe.d/modprobe.conf</a></h2> <h2 id=mkinitrd><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#mkinitrd>mkinitrd</a></h2> <h3 id=1-install-xen-utils><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#1-install-xen-utils>1. Install Xen-utils</a></h3> <p>Install Xen and its utilities via Yast.</p> <h3 id=2-modify-grubcfg><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#2-modify-grubcfg>2. Modify grub.cfg</a></h3> <p>... echo 'Loading Xen 4.3.0_06-1.3 ...' multiboot /xen-4.3.0_06-1.3.gz placeholder iommu=1 echo 'Loading Linux 3.10.1-3.g0cd5432-xen ...' module /vmlinuz-3.10.1-3.g0cd5432-xen placeholder root=UUID=da6ac064-2a5e-48c7-8834-307cbcb551c3 ro resume=/dev/disk/by-id/ata-ST500DM002-1BD142_Z3THR3V3-part3 splash=silent quiet showopts xen-pciback.hide=(00:00.0)(01:00.1) echo 'Loading initial ramdisk ...' module /initrd-3.10.1-3.g0cd5432-xen ...</p> <p>Then reboot the host.</p> <h3 id=3-bind-the-device><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#3-bind-the-device>3. Bind the device</a></h3> <h4 id=using-scripts><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#using-scripts>Using Scripts</a></h4> <p>File: bind_lib.sh</p> <p>#!/bin/bash # # License: GPLv2 # Author: Peter Maloney # # Script to bind devices to pciback (or pci-stub)</p> <p>find_new_id() { device="<span class=arithmatex id=device>\(1" len=\)</span> if [ "<span class=arithmatex device:5:12=device:5:12>\(len" -eq 12 \]; then device="\)</span>" fi lspci -n | grep "${device}" | cut -d' ' -f3 | sed -r "s/:/ /" }</p> <p>bindstub() { device="$1" echo "binddevice $device"</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span></pre></div></td><td class=code><div><pre><span></span><code>   if \[ ! -e &quot;/sys/bus/pci/devices/$device&quot; \]; then
       echo &quot;    ERROR: Device does not exist... cancelling&quot;
       return
   fi

   # with pci-stub, you do new\_id, then unbind, then bind

   echo &quot;create new\_id&quot;
   chmod +w /sys/bus/pci/drivers/pci-stub/new\_id
   new\_id=&quot;$(find\_new\_id &quot;$device&quot;)&quot;
   echo &quot;    echo \\&quot;$new\_id\\&quot; &gt; /sys/bus/pci/drivers/pci-stub/new\_id&quot;
   echo &quot;$new\_id&quot; &gt; /sys/bus/pci/drivers/pci-stub/new\_id

   echo &quot;unbind&quot;
   if \[ ! -e &quot;/sys/bus/pci/devices/$device/driver&quot; \]; then
       echo &quot;    no driver to unbind&quot;
   else
       chmod +w &quot;/sys/bus/pci/devices/${device}/driver/unbind&quot;
       echo &quot;    echo -n \\&quot;$device\\&quot; &gt; \\&quot;/sys/bus/pci/devices/$device/driver/unbind\\&quot;&quot;
       echo -n &quot;$device&quot; &gt; &quot;/sys/bus/pci/devices/$device/driver/unbind&quot;
   fi

   echo &quot;bind&quot;
   chmod +w /sys/bus/pci/drivers/pci-stub/bind
   echo &quot;    echo -n \\&quot;$device\\&quot; &gt; /sys/bus/pci/drivers/pci-stub/bind&quot;
   echo -n &quot;$device&quot; &gt; /sys/bus/pci/drivers/pci-stub/bind

   echo
</code></pre></div></td></tr></table></div> <p>}</p> <p>bindback() { device="$1" echo "binddevice $device"</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span></pre></div></td><td class=code><div><pre><span></span><code>   if \[ ! -e &quot;/sys/bus/pci/devices/$device&quot; \]; then
       echo &quot;ERROR: Device does not exist... cancelling&quot;
       return
   fi

   # with pciback, you do unbind, then new\_slot, then bind

   echo &quot;unbind&quot;
   if \[ ! -e &quot;/sys/bus/pci/devices/$device/driver&quot; \]; then
       echo &quot;    no driver to unbind&quot;
   else
       chmod +w &quot;/sys/bus/pci/devices/${device}/driver/unbind&quot;
       echo &quot;    echo -n \\&quot;$device\\&quot; &gt; \\&quot;/sys/bus/pci/devices/$device/driver/unbind\\&quot;&quot;
       echo -n &quot;$device&quot; &gt; &quot;/sys/bus/pci/devices/$device/driver/unbind&quot;
   fi

   echo &quot;create new\_slot&quot;
   chmod +w /sys/bus/pci/drivers/pciback/new\_slot
   echo &quot;    echo -n \\&quot;$device\\&quot; &gt; /sys/bus/pci/drivers/pciback/new\_slot&quot;
   echo -n &quot;$device&quot; &gt; /sys/bus/pci/drivers/pciback/new\_slot

   echo &quot;bind&quot;
   chmod +w /sys/bus/pci/drivers/pciback/bind
   echo &quot;    echo -n \\&quot;$device\\&quot; &gt; /sys/bus/pci/drivers/pciback/bind&quot;
   echo -n &quot;$device&quot; &gt; /sys/bus/pci/drivers/pciback/bind

   echo
</code></pre></div></td></tr></table></div> <p>}</p> <h2 id=source-bind_libsh><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#source-bind_libsh>source bind_lib.sh</a></h2> <h2 id=modprobe-xen-pciback><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#modprobe-xen-pciback>modprobe xen-pciback</a></h2> <h2 id=bindback-000001000><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#bindback-000001000>bindback "0000:01:00.0"</a></h2> <h2 id=bindback-000001001><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#bindback-000001001>bindback "0000:01:00.1"</a></h2> <h4 id=using-xen-tools><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#using-xen-tools>Using xen-tools</a></h4> <h2 id=xl-pci-assignable-add-01000><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-pci-assignable-add-01000>xl pci-assignable-add 01:00.0</a></h2> <h2 id=xl-pci-assignable-add-01001><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-pci-assignable-add-01001>xl pci-assignable-add 01:00.1</a></h2> <h2 id=xl-pci-attach-domain-0-01000><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-pci-attach-domain-0-01000>xl pci-attach Domain-0 01:00.0</a></h2> <h2 id=xl-pci-attach-domain-0-01001><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-pci-attach-domain-0-01001>xl pci-attach Domain-0 01:00.1</a></h2> <h3 id=4-create-vm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#4-create-vm>4. Create VM</a></h3> <p>File: win7</p> <p>name="win77" description="None" uuid="db64c1a6-1f84-4eff-48df-53c4b03b389e" memory=2048 maxmem=2048 vcpus=4 on_poweroff="destroy" on_reboot="destroy" on_crash="destroy" localtime=1</p> <p>builder="hvm" device_model="/usr/lib/xen/bin/qemu-dm" kernel="/usr/lib/xen/boot/hvmloader" boot="dc" disk=[ 'file:/var/lib/xen//blog/images/windowsvistax64/disk0.raw,hda,w','file:/home/lofyer/Driver.iso,hdc:cdrom,r' ]</p> <h2 id=vif-bridgevirbr0-mac00123e6c2f02-modelrtl8139><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#vif-bridgevirbr0-mac00123e6c2f02-modelrtl8139>vif=[ 'bridge=virbr0, mac=00:12:3e:6c:2f:02, model=rtl8139' ]</a></h2> <p>stdvga=1 vnc=1 vnclisten="0.0.0.0" vncconsole=0</p> <h2 id=vncunused1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#vncunused1>vncunused=1</a></h2> <p>soundhw="all"</p> <p>monitor=1 viridian=1 sdl=0</p> <h2 id=usb1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#usb1>usb=1</a></h2> <p>acpi=1 apic=1 pae=1</p> <h2 id=usbdevicetablet><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#usbdevicetablet>usbdevice='tablet'</a></h2> <p>serial="pty"</p> <h2 id=add-by-lofyer><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#add-by-lofyer>Add by lofyer</a></h2> <p>device_model_version = "qemu-xen-traditional" gfx_passthru=0 pci_power_mgmt=1 xen_platform_pci=1 pci_msitranslate=1 hap=1 pci = [ '01:00.0' , '01:00.1' ]</p> <h2 id=xl-create-win7-remote-viewer-vnclocalhost5900><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xl-create-win7-remote-viewer-vnclocalhost5900>xl create win7 # remote-viewer vnc://localhost:5900</a></h2> <p>Then you should see Windows boot logo in vnc for few seconds, after that it will switch to the second monitor that attached to your ATI card.</p> <h4 id=gfx_gpupassthru><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#gfx_gpupassthru>gfx_gpupassthru</a></h4> <p>As Xen wiki said:</p> <blockquote> <p>When you specify "gfx_passthru=1" the passthru graphics card will be made the primary graphics card in the VM, and the Xen Qemu-dm emulated Cirrus graphics card is disabled. If you use "gfx_passthru=0", or don't have gfx_passthru= option at all, then the Xen Qemu-dm emulated Cirrus graphics card will be the primary in the VM, and the passthru graphics card will be secondary.</p> </blockquote> <h3 id=so-alter-gfx_passthru-to-1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#so-alter-gfx_passthru-to-1>So, alter gfx_passthru to 1.</a></h3> <p>title: "mingw编译remoteviewer" date: 2012-11-17 categories: - "cloud-infra"</p> <hr> <p><strong>UPDATE 2015.3.18 fedora 21中编译： # yum install mingw* libtool* auto-buildrequires intltool glib2-devel icoutils msitools # ./autogen.sh # mingw64-configure # mingw64-make -j4 # rpmbuild -bb mingw-virt-viewer.spec 编译msi过程中，可能会提示缺少storageencryption.rng，从以下地址下载即可。 https://raw.githubusercontent.com/wido/libvirt/master/docs/schemas/storageencryption.rng</strong></p> <p>在fedora环境中，需要的有spice-gtk，libusbx，usbredir，remote-review，全部下载最新git源 spice-gtk，usbredir http://cgit.freedesktop.org/spice libusbx git://github.com/libusbx/libusbx.git remote-viewer git.fedorahosted.org/git/virt-viewer.git</p> <p>libusbx和usbredir：</p> <p>mingw32-configure;mingw32-make;mingw32-make install</p> <p>spice-gtk： mingw32-configure --with-sasl=no --with-audio=gstreamer --enable-smartcard=no --with-gtk=2.0 --without-python 因为virtviewer要gtk2.0的，所以这也就2.0的；mingw32下没找到pygtk，图省事儿就不要python了，其他的缺啥下啥</p> <p>mingw32-make mingw32-make install</p> <p>virt-viewer：</p> <p>mingw32-configure mingw32-make mingw32-make install</p> <p>生成remote viewer.exe</p> <p>安装包 运行nsiswrapper生成windows安装包</p> <p>nsiswrapper --run --name "Virt-Viewer" --outfile "Virt-Viewer-for-Windows.exe" --with-gtk /usr/i686-pc-mingw32/sys-root/mingw/bin/virt-viewer.exe</p> <p>缺少的dll从网上下或者windows环境中安装的virtviewer加到$PATH中 这样会缺少三个xml文件，在virtviewer/src里，直接copy过去</p> <p>export PATH=$PATH:/usr/i686-pc-mingw32/sys-root/mingw/bin:.</p> <p>windows client中使用usbredir： 需要libwdi或者zadig或者usbclerk <a href=http://lists.freedesktop.org/archives/spice-devel/2012-November/011629.html title="usbredir in windows client">链接</a></p> <h3 id=todo-libvirt><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#todo-libvirt>todo: 只有libvirt不是最新的了，可是目前来看没影响</a></h3> <p>title: "NVIDIA GRID vGPU and KVMGT for KVM" date: 2017-10-25 categories: - "cloud-infra"</p> <hr> <p>This article will tell you how to use NVIDIA vGPU and KVMGT in KVM hypervisor with mdev. I'll use NVIDIA M60 and RHEL 7.4 for testing.</p> <h2 id=1-nvidia-vgpu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#1-nvidia-vgpu>1. NVIDIA vGPU</a></h2> <h3 id=11-prepare-drivers-and-utilities><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#11-prepare-drivers-and-utilities>1.1. Prepare drivers and utilities</a></h3> <h3 id=12-create-vgpu-with-command-line><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#12-create-vgpu-with-command-line>1.2. Create vGPU with command line</a></h3> <h3 id=13-passthrough-vgpu-to-vm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#13-passthrough-vgpu-to-vm>1.3. Passthrough vGPU to vm</a></h3> <h2 id=2-kvmgt><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#2-kvmgt>2. KVMGT</a></h2> <h3 id=21-prepare-drivers-and-utilities><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#21-prepare-drivers-and-utilities>2.1. Prepare drivers and utilities</a></h3> <h3 id=22-create-vgpu-with-command-line><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#22-create-vgpu-with-command-line>2.2. Create vGPU with command line</a></h3> <h3 id=23-passthrough-vgpu-to-vm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#23-passthrough-vgpu-to-vm>2.3. Passthrough vGPU to vm</a></h3> <h2 id=3-amd-vgpu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#3-amd-vgpu>3. AMD vGPU</a></h2> <h3 id=31-prepare-drivers-and-utilities><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#31-prepare-drivers-and-utilities>3.1. Prepare drivers and utilities</a></h3> <h3 id=32-create-vgpu-with-command-line><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#32-create-vgpu-with-command-line>3.2. Create vGPU with command line</a></h3> <h3 id=33-passthrough-vgpu-to-vm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#33-passthrough-vgpu-to-vm>3.3. Passthrough vGPU to vm</a></h3> <h2 id=ref><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#ref>Ref:</a></h2> <h3 id=httpswwwkraxelorgblogtagvgpu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#httpswwwkraxelorgblogtagvgpu><a href=https://www.kraxel.org/blog/tag/vgpu/ >https://www.kraxel.org/blog/tag/vgpu/</a></a></h3> <p>title: "QEMU 3D" date: 2016-12-29 categories: - "cloud-infra"</p> <hr> <p>Except from virgl(virtio-vga), KVMGT/XenGT, CUDA vGPU, I will introduce you another way of using 3D app in QEMU, c'est la <a href=http://xqemu.com/ >XQEMU</a></p> <p><a href=https://blog.lofyer.org/wp-content/uploads/EmuCR-XQEMU-20170109.7z>Download prebuilt EmuCR-XQEMU-20170109</a></p> <p><a href=https://www.emuparadise.me/roms-isos-games.php>Download games!</a></p> <p>As you can see, this is a emulator forked from QEMU to let you playing XBOX games in PC.(not interested though...)</p> <h3 id=get-xqemu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#get-xqemu>Get XQEMU</a></h3> <p>git clone https://github.com/espes/xqemu.git</p> <h3 id=compile-xqemu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#compile-xqemu><a href=https://github.com/espes/xqemu/wiki/Getting-Started#compile-xqemu></a>Compile XQEMU</a></h3> <h4 id=for-mac-os-x><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#for-mac-os-x><a href=https://github.com/espes/xqemu/wiki/Getting-Started#for-mac-os-x></a>For Mac OS X</a></h4> <p>./configure --cc=clang --enable-opengl --disable-vnc --disable-user --target-list=xbox-softmmu --extra-cflags="-march=native" --enable-debug make</p> <h4 id=for-windows><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#for-windows><a href=https://github.com/espes/xqemu/wiki/Getting-Started#for-windows></a>For Windows</a></h4> <ol> <li>Install MSYS2 x86_64: Follow all the steps on <a href=http://msys2.github.io/ >http://msys2.github.io/</a></li> <li> <p>Open the "MinGW-w64 Win64 Shell" and run:</p> <p>pacman -S git python2 make autoconf automake-wrapper mingw-w64-x86_64-libtool mingw-w64-x86_64-gcc mingw-w64-x86_64-pkg-config mingw-w64-x86_64-glib2 mingw-w64-x86_64-glew mingw-w64-x86_64-SDL git clone https://github.com/espes/xqemu cd xqemu git submodule update --init pixman</p> <p>./configure --cc=gcc --python=python2 --enable-opengl --disable-vnc --disable-user --target-list=xbox-softmmu --extra-cflags="-march=native" --enable-debug make</p> </li> </ol> <p><strong>There's a bug with timers on Windows that makes it run much slower than it should. YOU should fix it for me.</strong></p> <h4 id=for-linux><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#for-linux><a href=https://github.com/espes/xqemu/wiki/Getting-Started#for-linux></a>For Linux</a></h4> <h5 id=requirements><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#requirements><a href=https://github.com/espes/xqemu/wiki/Getting-Started#requirements></a>Requirements:</a></h5> <ul> <li><a href=http://wiki.qemu.org/Hosts/Linux>Everything QEMU requires</a></li> <li>OpenGL with GLX and GLEW</li> </ul> <p>For <strong>Debian</strong> most build dependencies can be installed by running:</p> <p>apt-get build-dep qemu apt-get install libglew-dev libtxc-dxtn-s2tc0</p> <h5 id=building><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#building><a href=https://github.com/espes/xqemu/wiki/Getting-Started#building></a>Building:</a></h5> <p>./configure --python=python2 --enable-opengl --disable-vnc --disable-user --enable-kvm --disable-xen --audio-drv-list=alsa --target-list=xbox-softmmu --extra-cflags="-march=native" --disable-werror --enable-debug make</p> <h3 id=run-xqemu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#run-xqemu><a href=https://github.com/espes/xqemu/wiki/Getting-Started#run-xqemu></a>Run XQEMU</a></h3> <p>XQEMU is a Low-Level Emulator, so you need to find a copy of the stuff the Xbox runs when it turns on:</p> <h5 id=xbox-mcp-x-boot-rom><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xbox-mcp-x-boot-rom><a href=https://github.com/espes/xqemu/wiki/Getting-Started#xbox-mcp-x-boot-rom></a>Xbox MCP-X boot rom</a></h5> <p>MD5 (mcpx_1.0.bin) = d49c52a4102f6df7bcf8d0617ac475ed</p> <p>If your mcpx dump has an MD5 of 196a5f59a13382c185636e691d6c323d you dumped it badly and it's a couple bytes off. It should start with 0x33 0xC0 and end with 0x02 0xEE.</p> <h5 id=xbox-10-compatible-bios-cromwell-3944-4034-4036><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xbox-10-compatible-bios-cromwell-3944-4034-4036><a href=https://github.com/espes/xqemu/wiki/Getting-Started#xbox-10-compatible-bios-cromwell-3944-4034-4036-></a>Xbox 1.0 compatible bios (cromwell, 3944, 4034, 4036, ...)</a></h5> <p>You can use a retail bios <em>or</em> a modified 'debug' bios. Just like a real xbox, running a retail bios will not boot unofficial software.</p> <h6 id=debug-bios><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#debug-bios><a href=https://github.com/espes/xqemu/wiki/Getting-Started#debug-bios></a>Debug BIOS</a></h6> <p>People have reported success with the 'COMPLEX 4627' modified debug bios. It's convenient to note that this bios does <em>not</em> necessarily require a <em>populated</em> hard disk image to load an application from DVD (though an empty drive still needs to be attached), so you can skip the next step in some cases.</p> <p>v1.0.2 1M dump: MD5 (Complex_4627Debug.bin) = 19b5c6d3d42a707bba620634fe6d4baf</p> <p><em>or sometimes</em></p> <p>1MB dump: MD5 (complex_4627debug.bin) = e8dd61cc6abdbd06aac185e371312dc1</p> <h6 id=retail-bios><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#retail-bios><a href=https://github.com/espes/xqemu/wiki/Getting-Started#retail-bios></a>Retail BIOS</a></h6> <p>1M dump: MD5 (3944.bin) = e8b39b98cf775496c1c76e4f7756e6ed</p> <p><em>or sometimes</em></p> <p>256k dump: MD5 (3944.bin) = 542c62cb976a4993c8c5027dff9638ce</p> <h5 id=xbox-dashboard-files-on-a-hard-disk-image><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#xbox-dashboard-files-on-a-hard-disk-image><a href=https://github.com/espes/xqemu/wiki/Getting-Started#xbox-dashboard-files-on-a-hard-disk-image></a>Xbox dashboard files on a hard disk image</a></h5> <p>Create an Xbox hard-disk image, using xboxhdm or otherwise:</p> <ul> <li>Create an <a href=http://sourceforge.net/projects/xboxhdm2/ >xboxhdm</a> cd-rom with the dashboard files</li> <li>Create a blank hard-disk file: <code>qemu-img create -f qcow2 xbox_harddisk.qcow2 8G</code></li> <li>Run xboxhdm with qemu or something: <code>i386-softmmu/qemu-system-i386 -hda xbox_harddisk.qcow2 -cdrom linux.iso</code></li> </ul> <hr> <p>Launch XQEMU with something like...</p> <p>xbox-softmmu/qemu-system-xbox -cpu pentium3 -machine xbox,bootrom=mcpx_rom.bin -m 64 -drive file=xbox_harddisk.qcow2,index=0,media=disk,locked=on -drive index=1,media=cdrom -bios xbox_bios.bin -usb -device usb-hub,bus=usb-bus.0,port=3 -device usb-xbox-gamepad,bus=usb-bus.0,port=3.2</p> <p>On Linux, you can use <a href=http://www.linux-kvm.org/page/Main_Page>KVM</a> by passing <code>accel=kvm,kernel_irqchip=off</code> to -machine. This is not yet recommended.</p> <p>To skip the Xbox logo animation you can pass <code>short_animation</code> to the -machine option (Example: <code>-machine xbox,short_animation,bootrom=mcpx_rom.bin</code>).</p> <h3 id=to-run-a-game-from-a-xbox-dvd-image-you-must-specify-a-file-for-the-dvd-device><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#to-run-a-game-from-a-xbox-dvd-image-you-must-specify-a-file-for-the-dvd-device>To run a game from a Xbox DVD image you must specify a <code>file</code> for the DVD device</a></h3> <p>title: "qemu uefi" date: 2015-06-08 categories: - "cloud-infra"</p> <hr> <p>Here's a collection of kinds of bioses.</p> <p><a href=https://www.kraxel.org/repos/jenkins/ >https://www.kraxel.org/repos/jenkins/</a></p> <p>Download <strong>edk2.git-ovmf-x64*.rpm</strong>, and extract it:</p> <p>(root)# rpm2cpi edk2.git-ovmf-x64-0-20150606.b1038.g5d832d6.noarch.rpm|cpio -mvid ./usr/share/doc/edk2.git-ovmf-x64-0 ./usr/share/doc/edk2.git-ovmf-x64-0/License.txt ./usr/share/doc/edk2.git-ovmf-x64-0/README ./usr/share/edk2.git ./usr/share/edk2.git/ovmf-x64 ./usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd ./usr/share/edk2.git/ovmf-x64/OVMF-with-csm.fd ./usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd ./usr/share/edk2.git/ovmf-x64/OVMF_CODE-with-csm.fd ./usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd ./usr/share/edk2.git/ovmf-x64/OVMF_VARS-with-csm.fd ./usr/share/edk2.git/ovmf-x64/UefiShell.iso 22227 blocks</p> <p>Run qemu with these fd bios files like this:</p> <p>qemu --boot loader_type=pflash,loader_ro=yes,loader=OVMF_CODE-pure-efi.fd,nvram_template=OVMF_VARS-pure-efi.fd XXX</p> <p>or</p> <h3 id=qemu-bios-ovmf-pure-efifd-xxx><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#qemu-bios-ovmf-pure-efifd-xxx>qemu -bios OVMF-pure-efi.fd XXX</a></h3> <p>title: "Add usbdevice to libvirt by modifying cgroup" date: 2013-10-31 categories: - "cloud-infra" tags: - "Libvirt" - "Device Redirection"</p> <hr> <p>CGROUP means Control group. In my case, usb-redir works fine while usb-host not. <a href=https://www.kernel.org/doc/Documentation/cgroups/devices.txt title="Cgroup HowTO">https://www.kernel.org/doc/Documentation/cgroups/devices.txt</a></p> <h3 id=just-do-it><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#just-do-it>Just do it</a></h3> <h2 id=sed-i-sdevices-devices><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#sed-i-sdevices-devices>sed -i 's/devices /#devices /'</a></h2> <h2 id=reboot><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#reboot>reboot</a></h2> <h3 id=add-fine-control-list><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#add-fine-control-list>Add fine control list</a></h3> <h4 id=review-the-rules-to-libvirt-and-leave-all-the-character-device-to-it><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#review-the-rules-to-libvirt-and-leave-all-the-character-device-to-it>Review the rules to libvirt, and leave all the character device to it</a></h4> <h2 id=cgget-libvirt><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#cgget-libvirt>cgget libvirt</a></h2> <p>To remove "c" device</p> <h2 id=echo-c-sysfscgrouplibvirtdevicesdeny><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#echo-c-sysfscgrouplibvirtdevicesdeny>echo c &gt; /sys/fs/cgroup/libvirt/devices.deny</a></h2> <p>To add all the "c" devices</p> <h2 id=echo-c-rwm-sysfscgrouplibvirtdevicesallow><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#echo-c-rwm-sysfscgrouplibvirtdevicesallow>echo "c *:* rwm" &gt; /sys/fs/cgroup/libvirt/devices.allow</a></h2> <p>devices.deny/allow is something like end-point.</p> <h4 id=about-hierarchy><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#about-hierarchy>About hierarchy</a></h4> <h3 id=a-child-will-not-have-more-permission-than-its-parent><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#a-child-will-not-have-more-permission-than-its-parent><strong>A child will not have more permission than its parent.</strong></a></h3> <p>title: "Intel iGVT-g vGPU in KVM - KVMGT howto" date: 2015-01-22 categories: - "cloud-infra"</p> <hr> <p>As previous article says, this is a vGPU solution in KVM by Intel.(All these genius)</p> <p><a href=https://01.org/zh/kvm/blogs/albcamus/2014/kvmgt-first-release title=https://01.org/zh/kvm/blogs/albcamus/2014/kvmgt-first-release>https://01.org/zh/kvm/blogs/albcamus/2014/kvmgt-first-release</a></p> <h3 id=cpu-i5-4460-os-ubuntu-1404-desktop><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#cpu-i5-4460-os-ubuntu-1404-desktop>CPU: i5-4460 OS: Ubuntu 14.04 Desktop</a></h3> <p>title: "KVMGT in Linux 4.10 - 流媒体服务器、游戏、车载大屏等场景的应用技术预研" date: 2017-04-12 categories: - "cloud-infra"</p> <hr> <p>UPDATE: 2018-04，现在KVMGT相关upstream基本已全部进入master，可以参考<a href=http://GVTg_Setup_Guide>GVTg_Setup_Guide</a>或者<a href=https://github.com/intel/gvt-linux/wiki/GVTd_Setup_Guide>GVTd_Setup_Guide</a>，如果需要本地显示参考<a href=https://github.com/intel/gvt-linux/wiki/Dma_Buf_User_Guide>DMA_BUF User Guide</a>。</p> <p>UPDATE: 2017-08-08，Intel有了X系列处理器i9，这个核数肯定适合跑桌面了。</p> <p>UPDATE：鉴于KVMGT的产品化集成难度较之前有所降低，所以最近有很多人都打算搞搞集成，那我先来集成一把吧。</p> <p>果不其然，直接并进内核了（书要改吗。。当然不，本文简单增补即可。。）</p> <p>4.10非常具有的代表性即是添加了Mediated Device(vfio-mdev)，Intel有自家方案，nVidia也要支持，但Linux社区说你俩给个统一框架吧，要不太乱，于是就有了它。如此以来，N家的显卡便可以很快开发出对应的驱动（不要相信他们家销售说的话，14年偶尔问了一下说要支持的，都过去80年啦），可以看看N家去年(2016.9)放的PPT，<a href=https://blog.lofyer.org/wp-content/uploads/02x03-Neo_Jia_and_Kirti_Wankhede-vGPU_on_KVM-A_VFIO_based_Framework.pdf>02x03-Neo_Jia_and_Kirti_Wankhede-vGPU_on_KVM-A_VFIO_based_Framework</a>。</p> <p>相较于之前的文章<a href=https://blog.lofyer.org/intel-igvt-g-vgpu-in-kvm-kvmgt-howto/ >intel-igvt-g-vgpu-in-kvm-kvmgt-howto</a>，这次的并入减少了我们的不少工作。</p> <p>4.10 ChangeLog：<a href=https://kernelnewbies.org/Linux_4.10>https://kernelnewbies.org/Linux_4.10</a></p> <p>参考<a href=https://github.com/01org/gvt-linux/wiki/GVTg_Setup_Guide>https://github.com/01org/gvt-linux/wiki/GVTg_Setup_Guide</a></p> <p>另外，RHEL 7.4也已加入了KVMGT/XenGT，可以试用一下。</p> <p>来看看支持哪些CPU吧：</p> <blockquote> <p>As a long-standing member of the open source community, Intel works upstream to ensure that full, open source implementations of Intel® GVT exist for open source virtualization hypervisors, KVM* and Xen*, known respectively as KVMGT and XenGT. KVMGT and XenGT deliver excellent virtual GPU performance in VMs across 5th and 6th generation Intel® Core™ processors (Intel® Core™ i3, Intel® Core™ i5, and Intel® Core™ i7 processors) with Intel Processor Graphics as well as Intel® Xeon® processors E3 v4 family with Intel Processor Graphics.</p> </blockquote> <p>首先安装并编译4.10的内核：</p> <p>$ git clone https://github.com/01org/gvt-linux $ sudo yum install openssl-devel ncurses-devel $ cd gvt-linux $ git checkout gvt-stable-4.10 $ echo ""|make oldconfig $ make menuconfig</p> <p>搜索关键字kvmgt, mdev,vfio-iommu-type1，并将其标记为“M”。 模块标记完成后，进行编译安装。</p> <p>$ make -j4 $ sudo make modules_install $ sudo make install $ sudo grub2-mkconfig -o /boot/grub2/grub.cfg</p> <p>从elrepo安装的缺少模块和编译环境。</p> <h2 id=rpm-import-httpswwwelrepoorgrpm-gpg-key-elrepoorg><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#rpm-import-httpswwwelrepoorgrpm-gpg-key-elrepoorg>rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</a></h2> <h2 id=rpm-uvh-httpwwwelrepoorgelrepo-release-70-2el7elreponoarchrpm><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#rpm-uvh-httpwwwelrepoorgelrepo-release-70-2el7elreponoarchrpm>rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</a></h2> <h2 id=yum-enablerepoelrepo-kernel-install-kernel-ml-kernel-ml-devel><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#yum-enablerepoelrepo-kernel-install-kernel-ml-kernel-ml-devel>yum --enablerepo=elrepo-kernel install kernel-ml kernel-ml-devel</a></h2> <p>然后修改grub文件：</p> <p>menuentry 'CentOS Linux (4.10.10) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted <span class=arithmatex>\(menuentry\_id\_option 'gnulinux-3.10.0-514.10.2.el7.x86\_64-advanced-6a3987e2-9cb7-4b38-9a53-1642aefada46' { load\_video set gfxpayload=keep insmod gzio insmod part\_msdos insmod ext2 set root='hd0,msdos1' if \[ x\)</span>feature_platform_search_hint = xy ]; then search --no-floppy --fs-uuid --set=root --hint-bios=hd0,msdos1 --hint-efi=hd0,msdos1 --hint-baremetal=ahci0,msdos1 --hint='hd0,msdos1' 3fc34ea6-30d7-491e-931d-d0941884fb6b else search --no-floppy --fs-uuid --set=root 3fc34ea6-30d7-491e-931d-d0941884fb6b fi linux16 /vmlinuz-4.10.10 root=/dev/mapper/cl-root ro rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quiet LANG=en_US.UTF-8 i915.enable_gvt=1 kvm.ignore_msrs=1 initrd16 /initramfs-4.10.10.img }</p> <p>为什么添加ignore_msrs呢？</p> <blockquote> <p>Since some windows guest 3rd patry application / tools (like GPU-Z / Passmark9.0) will trigger MSR read / write directly, if it access the unhandled msr register, guest will trigger BSOD soon. So we added the "kvm.ignore_msrs=1" into grub for workaround.</p> </blockquote> <p>然后继续编译QEMU，这次只要下载upstream的即可。</p> <p>$ git clone git://git.qemu.org/qemu.git $ cd qemu $ git checkout v2.8.1 $ git submodule update --init roms/seabios $ ./configure --prefix=/usr \ --enable-kvm \ --disable-xen \ --enable-debug-info \ --enable-debug \ --enable-sdl \ --enable-vhost-net \ --enable-spice \ --disable-debug-tcg \ --target-list=x86_64-softmmu $ make -j4 $ cd roms/seabios $ make -j8 $ cd - $ sudo make install $ sudo cp roms/seabios/out/bios.bin /usr/bin/bios.bin</p> <hr> <p>title: "Slic for qemu-kvm" date: 2013-12-25 categories: - "cloud-infra"</p> <hr> <p>This article is a howto for activation-ready of Windows. SLIC 2.0 is for 2003 &amp; XP, and 2.1 for Win7 &amp; 2008 Original seabios reads slic table from exactly the host. However, if your motherboard(not OEM) happen to own none, you will most probably make one by your self.</p> <h4 id=seabios><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#seabios>Seabios</a></h4> <p>You could get the lastest code from here.</p> <p>git clone git://git.seabios.org/seabios.git seabios</p> <p>Or, you can download from here.</p> <p><a href=http://code.coreboot.org/p/seabios/downloads/get/seabios-1.7.2.2.tar.gz title=seabios-1.7.2.2.tar.gz>seabios-1.7.2.2.tar.gz</a></p> <h4 id=slic-bin><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#slic-bin>SLIC-BIN</a></h4> <p>Here's a collection of various slic table. <a href=http://blog.lofyer.org/slic-for-qemu-kvm/slic-2-1-bins/ >SLIC 2.1 BINS</a></p> <h4 id=seaslic-patch><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#seaslic-patch>Seaslic patch</a></h4> <p>This is patch for seabios to make it slic table enabled. Download from here.</p> <p><a href="https://cloud.lofyer.org/public.php?service=files&t=3aa0db051506d88bce8e6d03d621f47e" title=Seaslic.tar.xz>Seaslic.tar.xz, seabios-1.7.2 compatible</a> Here's the patch content.</p> <p>--- a/src/acpi.c 2013-01-19 06:44:54.000000000 +0600 +++ b/src/acpi.c 2013-05-07 01:16:30.000000000 +0600 @@ -214,6 +214,11 @@</p> <p>#include "acpi-dsdt.hex"</p> <p>+#define CONFIG_OEM_SLIC +#ifdef CONFIG_OEM_SLIC +#include "acpi-slic.hex" +#endif + static void build_header(struct acpi_table_header *h, u32 sig, int len, u8 rev) { @@ -226,6 +231,10 @@ h-&gt;oem_revision = cpu_to_le32(1); memcpy(h-&gt;asl_compiler_id, CONFIG_APPNAME4, 4); h-&gt;asl_compiler_revision = cpu_to_le32(1); + #ifdef CONFIG_OEM_SLIC + if (sig == RSDT_SIGNATURE) // only RSDT is checked by win7 &amp; vista + memcpy(h-&gt;oem_id, ((struct acpi_table_header*)SLIC)-&gt;oem_id, 14); + #endif h-&gt;checksum -= checksum(h, len); }</p> <p>@@ -827,6 +836,15 @@ ACPI_INIT_TABLE(build_srat()); if (pci-&gt;device == PCI_DEVICE_ID_INTEL_ICH9_LPC) ACPI_INIT_TABLE(build_mcfg_q35()); + #ifdef CONFIG_OEM_SLIC + void *buf = malloc_high(sizeof(SLIC)); + if (!buf) + warn_noalloc(); + else { + memcpy(buf, SLIC, sizeof(SLIC)); + ACPI_INIT_TABLE(buf); + } + #endif</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div><pre><span></span><code> u16 i, external\_tables = qemu\_cfg\_acpi\_additional\_tables();
</code></pre></div></td></tr></table></div> <h4 id=compile><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#compile>Compile</a></h4> <p>You don't have to apply the seaslic patch with patch.sh, you can do that by hand. Before you start, do this:</p> <p>xxd -i /sys/firmware/acpi/tables/SLIC | grep -v len | sed 's/unsigned ch ar.*/static char SLIC[] = {/' &gt; seabios.submodule/src/acpi-slic.hex</p> <p>Or,</p> <p>xxd -i DELL.BIN | grep -v len | sed 's/unsigned ch ar.*/static char SLIC[] = {/' &gt; seabios.submodule/src/acpi-slic.hex</p> <p>After applying the patch, you can compile the bios.bin, and copy that to <strong>/usr/share/qemu-kvm/my-bios.bin</strong> or rewrite <strong>bios.bin</strong> instead. Here's my bios.bin with Dell[DELL-QA09-NVDA]2.1.BIN from SLIC BIN</p> <p><a href=https://raw.githubusercontent.com/lofyer/qemu-cmd-reloaded/master/qemu-slic/my-bin.tar.xz>my-bin.tar.xz</a></p> <h4 id=qemu-cmd><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#qemu-cmd>Qemu-cmd</a></h4> <p>qemu-kvm XXX -bios /usr/share/qemu-kvm/my-bios.bin -acpitable file=Dell[DELL-QA09-NVDA]2.1.BIN</p> <h3 id=in-the-guest-you-could-see-that-slic-by-sysfirmwareacpitablesslic-in-linux-or-slic_toolkit-in-windows><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#in-the-guest-you-could-see-that-slic-by-sysfirmwareacpitablesslic-in-linux-or-slic_toolkit-in-windows>In the guest, you could see that SLIC by /sys/firmware/acpi/tables/SLIC in Linux or SLIC_Toolkit in Windows.</a></h3> <p>title: "GPU Passthrough, VGA Passthrough in KVM" date: 2013-05-23 categories: - "cloud-infra" - "linux-admin"</p> <hr> <p>To inspire you, I've got a video from someone else. Better mutt the volume by the way. <a href="http://www.youtube.com/watch?v=Qi1LdFkRzIs" title="Arch Linux KVM Crysis HD Gpu Passthrough">Arch Linux KVM Crysis HD Gpu Passthrough</a> Or you can download it to see. <a href=http://blog.lofyer.org/wp-content/uploads/Arch-Linux-KVM-Crysis-HD.flv title="Download the video">Download the video in HD</a> </p> <p>Here's the links I refer to: <a href=http://thread.gmane.org/gmane.comp.emulators.kvm.devel/71981 title=http://thread.gmane.org/gmane.comp.emulators.kvm.devel/71981>http://thread.gmane.org/gmane.comp.emulators.kvm.devel/71981</a> <a href="https://bbs.archlinux.org/viewtopic.php?id=162768" title="https://bbs.archlinux.org/viewtopic.php?id=162768">https://bbs.archlinux.org/viewtopic.php?id=162768</a> <a href="https://docs.google.com/document/d/1ef_nfl652L0HLn_wGvnpgjsBJd9LZzaV_-rIcEEoK8Y/edit?pli=1" title="https://docs.google.com/document/d/1ef_nfl652L0HLn_wGvnpgjsBJd9LZzaV_-rIcEEoK8Y/edit?pli=1">https://docs.google.com/document/d/1ef_nfl652L0HLn_wGvnpgjsBJd9LZzaV_-rIcEEoK8Y/edit?pli=1</a> <a href=http://www.linux-kvm.org/page/VGA_device_assignment title=http://www.linux-kvm.org/page/VGA_device_assignment>http://www.linux-kvm.org/page/VGA_device_assignment</a> <a href=http://www.linux-kvm.org/page/VGA_device_assignment title=http://www.linux-kvm.org/page/VGA_device_assignment>http://www.linux-kvm.org/page/How_to_assign_devices_with_VT-d_in_KVM</a></p> <h3 id=result-vgapassthrough-success-in-host-f19-guest-windows7-gpupassthrough-success-in-fedora-rawhide><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#result-vgapassthrough-success-in-host-f19-guest-windows7-gpupassthrough-success-in-fedora-rawhide>Result: VGAPassthrough: success in host F19, guest Windows7 GPUPassthrough: success in Fedora-Rawhide</a></h3> <p>HOST: CPU: Core i5 3470 GPU: ATI HD Radeon 7850 OS: Fedora-Rawhide QEMU: qemu-1.5.1 <a href=http://blog.lofyer.org/2013/05/pass-host-gpu-to-guest-via-qemu-ncursescurses/kvm-vgapassthrough/ ><img alt=kvm-vgapassthrough src=/blog/images/kvm-vgapassthrough.png></a> So, here's the steps</p> <h3 id=0-enable-the-mainboard-vxt-iommu-and-alter-the-video-device-to-intel-hd><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#0-enable-the-mainboard-vxt-iommu-and-alter-the-video-device-to-intel-hd>0. Enable the mainboard VxT, iommu and alter the video device to Intel HD</a></h3> <h3 id=1-see-what-we-have-got-now><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#1-see-what-we-have-got-now>1. See what we have got now.</a></h3> <p>lspci;lspci -n</p> <p>We have output below</p> <p>... 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Pitcairn PRO [Radeon HD 7850] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] ...</p> <p>... 01:00.0 0300: 1002:6819 01:00.1 0403: 1002:aab0 ...</p> <p>You can see the pci bus and vendor.</p> <h3 id=2-modify-the-kernel-parameter-morprobed-and-libvirtconf><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#2-modify-the-kernel-parameter-morprobed-and-libvirtconf>2. Modify the kernel parameter, morprobe.d and libvirt.conf</a></h3> <p>Add follow parameters to grub.conf</p> <p>intel_iommu=on pci-stub.ids=1002:6819,1002:aab0,vfio_iommu_type1.allow_unsafe_interrupts=1</p> <p>NOTE: If you have got an AMD cpu, please replace "interl_iommu=on" with "iommu=pt iommu=1" Add modprobe.conf to /etc/modprobe.d/ with this content:</p> <p>blacklist radeon options kvm ignore_msrs=1 options kvm allow_unsafe_interrupts=1 options kvm-amd npt=0 options kvm_intel emulate_invalid_guest_state=0 options vfio_iommu_type1 allow_unsafe_interrupts=1</p> <p>change the following options in /etc/libvirt/qemu.conf:</p> <h2 id=the-user-id-for-qemu-processes-run-by-the-system-instance><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#the-user-id-for-qemu-processes-run-by-the-system-instance>The user ID for QEMU processes run by the system instance.</a></h2> <p>user = "root"</p> <h2 id=the-group-id-for-qemu-processes-run-by-the-system-instance><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#the-group-id-for-qemu-processes-run-by-the-system-instance>The group ID for QEMU processes run by the system instance.</a></h2> <p>group = "root"</p> <p>......</p> <h2 id=if-clear_emulator_capabilities-is-enabled-libvirt-will-drop-all><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#if-clear_emulator_capabilities-is-enabled-libvirt-will-drop-all>If clear_emulator_capabilities is enabled, libvirt will drop all</a></h2> <h2 id=privileged-capabilities-of-the-qemukvm-emulator-this-is-enabled-by><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#privileged-capabilities-of-the-qemukvm-emulator-this-is-enabled-by>privileged capabilities of the QEmu/KVM emulator. This is enabled by</a></h2> <h2 id=default><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#default>default.</a></h2> <h2 id=_1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#_1></a></h2> <h2 id=warning-disabling-this-option-means-that-a-compromised-guest-can><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#warning-disabling-this-option-means-that-a-compromised-guest-can>Warning: Disabling this option means that a compromised guest can</a></h2> <h2 id=exploit-the-privileges-and-possibly-do-damage-to-the-host><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#exploit-the-privileges-and-possibly-do-damage-to-the-host>exploit the privileges and possibly do damage to the host.</a></h2> <h2 id=_2><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#_2></a></h2> <p>clear_emulator_capabilities = 0</p> <p>Reboot.</p> <h3 id=3-using-scripts-below><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#3-using-scripts-below>3. Using scripts below</a></h3> <h4 id=version-1-vfio-passthrough><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#version-1-vfio-passthrough>Version 1: VFIO-Passthrough</a></h4> <p>File: vfio-bind</p> <h2 id=binbash><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#binbash>!/bin/bash</a></h2> <p>modprobe vfio-pci for var in "<span class=arithmatex>\(@"; do for dev in <span class=arithmatex>\((ls /sys/bus/pci/devices/\)</span>var/iommu\_group/devices); do vendor=\)</span>(cat /sys/bus/pci/devices/<span class=arithmatex>\(dev/vendor) device=\)</span>(cat /sys/bus/pci/devices/<span class=arithmatex>\(dev/device) if \[ -e /sys/bus/pci/devices/\)</span>dev/driver ]; then echo <span class=arithmatex>\(dev &gt; /sys/bus/pci/devices/\)</span>dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id done done</p> <p>Bind the device</p> <p>./vfio-bind 0000:01:00.0 0000:01:00.1</p> <p>Start VM</p> <h2 id=binbash_1><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#binbash_1>!/bin/bash</a></h2> <p>sudo modprobe vfio-pci</p> <p>sudo qemu-system-x86_64 -no-user-config -nodefaults -m 2048M -smp 4 -boot menu=on \ -net nic -net user -enable-kvm -monitor stdio -vga qxl -global qxl-vga.vram_size=67108864 \ -spice port=6000,ipv4,disable-ticketing \ -device intel-hda,id=sound0,bus=pcie.0,addr=0x4 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -drive file=Windows7.iso,if=none,id=drive-ide0-1-0,readonly=on,format=raw -device ide-cd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0 \ -drive file=/home/lofyer/gpu_passthrough/f17.qcow2,if=none,id=drive-virtio-disk0,format=qcow2,cache=none,werror=stop,rerror=stop,aio=threads -device virtio-blk-pci,scsi=off,bus=pcie.0,addr=0x7,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 \ -device virtio-balloon-pci,id=balloon0,bus=pcie.0,addr=0x8 \ -M q35 \ -device piix4-ide,bus=pcie.0 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -fda virtio.vfd</p> <h4 id=version-2-pci-passthrough><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#version-2-pci-passthrough>Version 2: PCI-Passthrough</a></h4> <p>Bind device</p> <h2 id=binbash_2><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#binbash_2>!/bin/bash</a></h2> <p>modprobe pci-stub for id in 6819 aab0; do echo 1002 $id &gt; /sys/bus/pci/drivers/pci-stub/new_id done for pci in 0000:01:00.{0,1}; do echo <span class=arithmatex>\(pci &gt; "/sys/bus/pci/devices/\)</span>pci/driver/unbind" echo $pci &gt; /sys/bus/pci/drivers/pci-stub/bind done</p> <p>Start VM</p> <h2 id=binbash_3><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#binbash_3>!/bin/bash</a></h2> <p>qemu-system-x86_64 \ -hda ../f17.qcow2 \ -cdrom /run/media/lofyer/Cache/OS_ISO/cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso \ -m 2048 -balloon virtio -smp 4 -enable-kvm \ -device pci-assign,host=01:00.0</p> <hr> <p>title: "kvm perfermance test, including periphery virtual device" date: 2013-09-14 categories: - "cloud-infra" - "linux-admin"</p> <hr> <p>I mean <em><strong>test</strong></em>, not <em><strong>profiling</strong></em>.</p> <h3 id=to-virtual-server-and-virtual-desktop-we-should-inspect-them-from-different-standards><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#to-virtual-server-and-virtual-desktop-we-should-inspect-them-from-different-standards>To virtual server and virtual desktop, we should inspect them from different standards.</a></h3> <p>For an server: response time, throughput, concurrent, utilization For and desktop: response time, video/audio latency, utilization</p> <h3 id=tools-we-can-use-to-test><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#tools-we-can-use-to-test>Tools we can use to test</a></h3> <h4 id=cpu><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#cpu>CPU:</a></h4> <p>SPEC(open, but not free) Unixbench Super PI Compile linux kernel pcmark(not open, not free, but cracked can be found..) ffmpeg convert</p> <h4 id=graphic><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#graphic>graphic:</a></h4> <p>3dmark</p> <h4 id=fshd><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#fshd>fs,hd:</a></h4> <p>hdparm iozone blogbench dbench</p> <h4 id=net><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#net>net:</a></h4> <p>iperf</p> <h4 id=ram><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#ram>ram</a></h4> <p>ramspeed</p> <h3 id=how-to-start><a class=toclink href=../../2013/12/19/create-a-dummy-vga-adpter/#how-to-start>How to start</a></h3> <p>Initial host env: i5-3470, 8G, gentoo-linux-3.11+, qemu-1.6.0 Kernel para:</p> <p>TBD</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-12-16 00:00:00">2013年12月16日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/new-world/ class=md-meta__link>new-world</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2013/12/16/%E4%BB%96%E4%BB%AC%E9%83%BD%E4%B8%8D%E8%A7%81%E4%BA%86/ class=toclink>他们都不见了</a></h2> <p>我是一个只会流浪的瞎子 游荡在拥挤着灵魂的房间里 这里很吵闹，但于我来说并不讨厌</p> <p>哇哇的孩子贴上母亲的乳房后便不再吵闹 伤心的女儿埋头伏在父亲胸前泣诉不会归来的人 犹豫的铁匠靠着窗户，喃喃低语着什么</p> <p>我忽然觉的不知所措 尽管我是瞎子 我还是能感受到别人的眼神</p> <p>我昂起头 离开了座位 忽然想去找寻一份安静</p> <p>因为路上没有什么障碍 我可以放心的迈出脚步 直到我听见后面仓促的呼吸</p> <p>是什么呢 是蒙着面的哥布林强盗 还是越狱的杀人犯？</p> <p>我从走变成了小跑 从小跑变成了狂奔 我宁可不回头</p> <p>我脚下一空失去重心 想去用手支地 可怎也够不着</p> <p>就这样我就来到了这里 我觉的快乐就是这样 而恰巧这里的一切都有我需要的意义存在</p> <p>那一天这里来了另外一个人 他说他也是个瞎子 我从来不曾看见的人啊</p> <p>你身上链锁当当 我不相信你是个罪人 我也和你一样沉浸在自由中</p> <p>我觉得 我认为 他们也说</p> <p>你说其实再往前走就可以找寻久违的光明 可我只是听说光明很温暖 恰如我现在所拥有的自由</p> <p>我待的久了 便渴望走向下一个地方 我不该停下的脚步</p> <p>天寒 略显诡异的空气没有安宁废旧城市的居民 倒下的灯塔下满是触礁者的残骸</p> <p>我不清楚这是怎么一种状态 可是我知道有些决定会影响到北极熊孩子的寿命 我想这便是这个世界本该有的状态</p> <p>你的脚步声临近 像预言中一样 我从此跟随</p> <p>人间的战争曾经让无辜的人失去他们珍惜的 但这些都不可避免 所以我说你有天赐的怜悯</p> <p>我仿佛丢失了不该丢失的指环 你赠予我玫瑰的下午 我不知道要怎么做</p> <p>你俯首 收下你谦卑的诚意 我屁颠屁颠的很乐意</p> <p>这个时候应该停下来 因为天气很好 我有时会太过忙碌而没有静心享受这世界给我准备的礼物</p> <p>如果我记得 我是可以进入你的世界 一个围绕我转动的星球上 只有春秋</p> <p>可是 我也喜欢夏冬风景 虽然我看不见 但我能体验到这两个界线明显</p> <p>阴雨天气 略有泥泞的路上 或者些许惆怅 不曾迷路的瞎子</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-12-02 00:00:00">2013年12月2日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/new-world/ class=md-meta__link>new-world</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2013/12/02/%E6%97%A0%E4%B8%BB%E4%B9%8B%E5%9C%B0/ class=toclink>无主之地</a></h2> <p>已经是一片沙子吞噬的废墟中，走过一列驼队，他们看起来像几个世纪之前的人。</p> <p>在战争之前，这片地方是个纪念馆，纪念第六次世界大战中死去的人类。如今E3星系的人已经在地下安家，地球自转和公转周期都被调成了与他们家乡一致，也就是说，在太阳落山之前，驼队还有大概三百六十个小时的旧制时间赶到传教士居所而没有E3人来阻碍，当然，机器人不算。</p> <p>地球的再次毁灭淘汰了地表以及地下百分之九十九的人类，剩下的一批大多数是一千年前志愿基因改造的后裔。可是，人类仍然好战。残余的人类各自结盟，形成红派和黑派两大阵营，其中红派利用E3人的科技，在第十二次世界大战中完胜了黑派。但是E3做事总是留一手，他们在所有的设施中都嵌入沉睡的机械生命体，在大战结束后的一个星期时间内逐渐苏醒，并控制了地球。红派不得不移居至其他星球，分散在各个星系，留守下来的人类躲避着E3人的视线生存。</p> <p>大约一个星期后，驼队到达了传教士居所，他们在太阳风暴那天逃过雷达进入撒哈拉，来到昔日古文明碎片最大发掘地。E3人对所谓的古文明并不感兴趣，他们否认经验的重要性，认为真理本就在那。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-11-16 00:00:00">2013年11月16日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/devices/ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 2 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=how-to-lockunlockroot-nexus-5><a href=../../2013/11/16/how-to-lockunlockroot-nexus-5/ class=toclink>how to lock/unlock/root nexus 5</a></h2> <p>今日入手Nexus5美版（D820） blahblahblah... 好吧，开始unlock以及root</p> <p>先下载这个包，里面包含CM的镜像，unlock/lock的apk http://cloud.lofyer.org/public.php?service=files&amp;t=af14640b4f32d2e491d80a117db2bbe9</p> <p>下载完成后，同时按住音量上下键再按开机，进入bootloader的前奏（相当于bios选项），此时电脑上应该会有所表示（比如windows的弹出要安装驱动啦，没驱动下个sdk搜索一下，比如linux的dmesg啦）</p> <p>解压下载的文件，运行里面的root-$YOUROS（win、mac、linux）脚本，然后你看到请求unlock的选项，选择unlock并按电源键确认，此时pc上的脚本也会让你下一步； 下一步就是出现红色的机器人，说正在写脚本以及镜像，在写的时候pc上的脚本再下一步就可以自动让它退出了，然后稍等几分钟让它重启，重启的时候你会看到google标志下面的锁标志。</p> <h3 id=rootapkbootloader><a class=toclink href=../../2013/11/16/how-to-lockunlockroot-nexus-5/#rootapkbootloader>出于莫名其妙的安全感，在root以后可以安装压缩包里面的apk文件将bootloader再次锁上，这样，就这样。</a></h3> <p>title: "wrt54g v5添加usb" date: 2012-10-12 categories: - "devices"</p> <hr> <p>1.dd-wrt.com下载固件包及源码包</p> <p>2.编译添加或者配置usb存储支持</p> <p>3.按接口图添加usb</p> <p><a href="http://www.home-wifi.com/forum.php?mod=viewthread&page=1&tid=3962">http://www.home-wifi.com/forum.php?mod=viewthread&amp;page=1&amp;tid=3962</a></p> <blockquote> <p>注意焊点位置，两个数据线左边D+，右边D-，下边的472是4.7k的下拉电阻，右边两个电阻是另一组USB口。所以直接引线就可以，但是我的优盘经常不能识别，就又在USB座上把两条数据线对地接了10k的下拉电阻，相当于和图上的472并起来，现在使用很正常。 <a href=http://blog.lofyer.org/wrt54gs-64ram-8flash/bh/ ><img alt=bh src=/blog/images/bh.jpg></a></p> <p>使用5V 3A电源给路由器供电，不用安装7805了，电源线直接接到电源插座</p> <p><a href=http://blog.lofyer.org/wrt54gs-64ram-8flash/lbh/ ><img alt=lbh src=/blog/images/lbh.jpg></a></p> <p><a href=http://blog.lofyer.org/wrt54gs-64ram-8flash/dd/ ><img alt=dd src=/blog/images/dd.jpg></a></p> </blockquote> <hr> <p>title: "eZ430-Chronos入手" date: 2013-12-16 categories: - "devices"</p> <hr> <p><a href=http://blog.lofyer.org/2013/12/ez430-chronos%e5%85%a5%e6%89%8b/img_20131216_160008/ ><img alt=IMG_20131216_160008 src=/blog/images/IMG_20131216_160008-1024x958.jpg></a></p> <p>入手的是433Mhz，相当于国际版。 关于官方介绍可至<a href=http://processors.wiki.ti.com/index.php/EZ430-Chronos title=eZ430-chronos>eZ430-chronos</a>查阅。 <a href=http://www.ti.com/lit/zip/slac341 title=SLAC341>下载Control Center for Windows</a> <a href=http://www.ti.com/lit/zip/slac388 title=SLAC388>下载Control Center for Linux</a></p> <p>然后将toolkit的USBRF插入PC，选择控制台中的ACC标签并“start ap，腕表选择“#”号键至ACC，再按下键即可于控制台中显示加速度传感器数值。 同样PPT为按键映射，SYNC为时间设置，TFBSL尚未使用。</p> <p>编程 TBD</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-09-19 00:00:00">2013年9月19日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/mylife/ class=md-meta__link>mylife</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2013/09/19/%E8%AE%BA%E8%BA%AB%E4%BD%93%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7/ class=toclink>论身体的重要性</a></h2> <p>高二的时候买了系列的哲学小本，里面有个叫做《自由意志》的册子，已经忘了作者是谁。因为当时正好读过歌德的谈话录，所以在阅读《自由意志》的过程中总会想到歌德口中的“精灵”，再后来通过“蝴蝶效应”结识了“混沌”，一直觉得它们是同一个东西，至少于意识。 我要表述的也是这个问题，许多试验已经表明意识确实能对身体产生物理的影响，而现在所谓的交际原则中也认为身体不经意的动作可以反应出这个人性格的某一面。 高僧说一副皮囊，他们的话不无道理，大家的身体结构基本相同，骨骼清奇的已经被烧死或者扔进黑暗（参考雾都孤儿里的那个“怪物”，剑风传奇里更多了），皮囊所包裹的是身体与意识。原生动物有意识么，非条件反射应该算吧。一只猫的皮囊包裹下的是精巧的身体以及难以去体验的意识系统（听说已经有科学家可以做到“体验”别人的意识了），假设抽去这身体，我们残忍地把皮囊留下，你应该会看到什么？ 扁桃体炎，我刚经历过教科书式的“3-5天低寒高热”，接下来是让炎症消下去的日子了。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-08-17 00:00:00">2013年8月17日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/new-world/ class=md-meta__link>new-world</a></li> <li class=md-meta__item> 需要 1 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=_1><a href=../../2013/08/17/%E6%B2%B9%E7%94%BB%E7%8C%AB/ class=toclink>油画：猫</a></h2> <p>高原，湖边，木屋。 伦敦事件已经过去十年整了，人们对它的记忆却犹如911一样深刻。他也花了将近十年去建造一个系统，一个建立在自然秩序之外的系统。所有从博物馆“凭空消失”的作品他都烧了，只在床前留下一幅十七世纪未名画家的油画：一只可爱的暹罗猫，从木盒子里小心翼翼的探出头，烛光落在它厚厚的前脚掌上。</p> <p>事件后一个月，他有些心神不宁，花光了所有积蓄从全球各地的实验室偷购材料,从已成为科技先驱的google那取得了所有数据库访问权，甚至高价从“火星人海森”那购买N-12-82星球的文明碎片。工程准备完妥后，他就开始了梭罗一样的生活，每天早上陪牧民放牧，有时也会在湖边钓鱼，当然，没鱼钩；下午从牧民那吃完饭回来后，在二楼休息四个小时，便乘电梯到地下五层工作。</p> <p>在地下一楼与地下二楼共一千二百平的空间里，整齐的排满了他喜爱的书籍，其中大部分都是用来每半年和别人交换。他打算系统启动之前将这些书都交给牧民，因为他不想冒险让这个世界永远忘却他。地下三楼和四楼的更大空间里，是满满的“Part of the World”，他称之为如此。地下六楼则承载着这栋建筑的动力源，从反应堆搭建到235提炼都是他在伦敦事件之前亲手完成。</p> <p>他喜欢制作一些挂件，脖子上就带着一只饿死的雪豹的牙齿，上面刻了用“明天的记忆”书写的一个人名，他在小学时就发明了这套符号。那时候，他就喜欢“奇奇怪怪”的世界，以至于在日记里创造了一套完整的“异星人统治的史前时代”世界观，可是星际十字军压缩并吸收了他的村庄后，他便不愿去想这些了。</p> <p>二十年来与十字军的战争从未停息，银河系方面因为科技落后于十字军五百年水平，所以已经有些沮丧而甘为人奴，至少已经有部分国家开始放弃抵抗哪怕是小撮十字军士兵的进攻了。十五年前在参与当地联盟军的一次反抗中，他又目睹了十字军的残忍————他是唯一生还者，代价是缺氧导致的左臂间歇性麻木。其后他领导了“伊恩”联盟军五年，在与十字军战斗的同时，偶尔也会参与一些所谓的“独立战争”。然后便消失了五年，直到十年前的伦敦事件。</p> <p>他又在日记里写，不要忘记自己，因为还未远去，明天，我要再看一眼太阳。</p> </div> </article> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2013-07-28 00:00:00">2013年7月28日</time></li> <li class=md-meta__item> 分类于 <a href=../../category/devices/ class=md-meta__link>devices</a></li> <li class=md-meta__item> 需要 2 分钟阅读时间 </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=leapmotion><a href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/ class=toclink>LeapMotion相关</a></h2> <h3 id=leanmotion><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#leanmotion>LeanMotion入手</a></h3> <p>卖家太给力了，昨天就顺丰发货，今天下午我冒着炎炎烈日去取货，激动。。</p> <p>先来张盒子，看着就感觉那帮老外工业设计功底深厚。 <a href=http://blog.lofyer.org/2013/07/leapmotion-%e5%85%a5%e6%89%8b%ef%bc%8c%e6%99%92%e4%b8%80%e4%b8%8b%e5%bc%80%e7%ae%b1%e4%bb%a5%e5%8f%8a%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c/dsc_0003/ ><img alt=DSC_0003 src=/blog/images/DSC_0003-1024x680.jpg></a></p> <p>开箱：Leapmotion一台，数据线两根（一长一短），说明书一张 <a href=http://blog.lofyer.org/2013/07/leapmotion-%e5%85%a5%e6%89%8b%ef%bc%8c%e6%99%92%e4%b8%80%e4%b8%8b%e5%bc%80%e7%ae%b1%e4%bb%a5%e5%8f%8a%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c/dsc_0006/ ><img alt=DSC_0006 src=/blog/images/DSC_0006-1024x680.jpg></a></p> <p>看着感觉好爽的样子<sub>~</sub> <a href=http://blog.lofyer.org/2013/07/leapmotion-%e5%85%a5%e6%89%8b%ef%bc%8c%e6%99%92%e4%b8%80%e4%b8%8b%e5%bc%80%e7%ae%b1%e4%bb%a5%e5%8f%8a%e5%9f%ba%e6%9c%ac%e6%93%8d%e4%bd%9c/dsc_0008/ ><img alt=DSC_0008 src=/blog/images/DSC_0008-1024x680.jpg></a></p> <p>我拍的一段简单使用视频。</p> <hr> <h3 id=leapmotion2017-07><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#leapmotion2017-07>LeapMotion记录(2017-07)</a></h3> <h3 id=sdkwindowslinuxmac-sdkarduino-><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#sdkwindowslinuxmac-sdkarduino->已经在官网注册并下载了sdk（windows、linux，我没Mac），设备不出意外下个月到。 等到了再更新文章，到时会更新sdk配置，与arduino交互的相关代码。 可控的目前想到了飞行器、机械手（夹持器 - -）。</a></h3> <p>title: "LeapMotion controlled X4" date: 2013-09-15 categories: - "devices" tags: - "LeapMotion"</p> <hr> <p>两者都入手已经一个月了，可平时有些忙（惰者多忙），也就只零零散散准备了一些资料，还没开始整合。 整个流程大概是这个我用文字描述的粗略的样子：</p> <h3 id=leapmotionmap-leapmotionarduinonfr2401x4-leapmotionx4000><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#leapmotionmap-leapmotionarduinonfr2401x4-leapmotionx4000>空间建模：获取飞行器初始坐标，与leapmotion的可视区域进行map。 一级控制：leapmotion获得的手掌运动信息（可预处理）进入arduino通过nfr2401发送给X4，进行粗略运动指令传达。 二级控制：根据摄像头采集的飞行器位置数据与手掌位置信息对比，进行二阶指令传达。 回馈控制：在二级控制的基础上进行微调。 错误返回：如果超出leapmotion可视范围，则进行回馈控制将X4返回初始位置（0,0,0），超出摄像头范围，则需。。。人工重置。</a></h3> <p>title: "Leapmotion 相关" date: 2013-08-02 categories: - "devices" tags: - "LeapMotion"</p> <hr> <h3 id=windows><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#windows>在Windows中</a></h3> <p>夹持器与四轴飞行器都是Arduino-Based，通信就用串口。 代码放在<a href=http://git.lofyer.org/cgit.cgi/fun/robohand/ title=http://git.lofyer.org/cgit.cgi/fun/robohand/ >git.lofyer.org</a> 感觉VS好难。。试试在gentoo下驱动leapmotion</p> <h3 id=gentoodebian><a class=toclink href=../../2013/07/28/leapmotion%E7%9B%B8%E5%85%B3/#gentoodebian>在Gentoo下使用，这个方式应该适用于所有非debian系</a></h3> <p>先下载sdk包，下载后解压。 看到里面有个deb的包，用alien转化为tar包</p> <p>alien -t Leap-0.8.0-x64.deb tar xf leap-0.8.0.tgz cp -irf usr/* /usr/local/ cp -irf lib/udev/rules.d/25-com-leapmotion-leap.rules /etc/udev/rules.d</p> <p>然后将普通用户加入plugdev组</p> <p>sudo usermod -a -G plugdev $USER</p> <p>刷新组关系，注销当前用户也可</p> <p>exec su -l $USER</p> <p>运行leapd与LeapControlPanel即可</p> <p>在64位机器上缺少32位库文件 freetype.so.6, libasound.so.2</p> <p>sudo emerge -avt app-emulation/emul-linux-x86-xlibs sudo emerge emul-linux-x86-soundlibs</p> <p>实例：编译MotionVisualizer</p> <p>Make -C Builds/Linux</p> </div> </article> <nav class=md-pagination> <a href=../../ class=md-pagination__link>1</a> <span class=md-pagination__dots>..</span> <a href=../5/ class=md-pagination__link>5</a> <a href=../6/ class=md-pagination__link>6</a> <span class=md-pagination__current>7</span> <a href=../8/ class=md-pagination__link>8</a> <a href=../9/ class=md-pagination__link>9</a> <span class=md-pagination__dots>..</span> <a href=../25/ class=md-pagination__link>25</a> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2008 - 2024 lofyer </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.prune", "navigation.instant", "navigation.instant.progess"], "search": "../../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.56dfad97.min.js></script> <script src=../../../javascripts/config.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>